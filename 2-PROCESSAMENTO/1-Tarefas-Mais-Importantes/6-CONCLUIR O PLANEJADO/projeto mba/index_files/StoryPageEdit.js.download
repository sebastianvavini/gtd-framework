var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(e){function t(t,n,o){var i=e.call(this,null)||this;return i._element=t,i}return __extends(t,e),t.prototype.getBottomCoordinate=function(){var e=$(this._element);return e.offset().top+e.outerHeight(!0)},t.prototype.init=function(e){var t=this;e.distanceFromIP=function(e){return t.distanceFromIP(e)},e.getBottomCoordinate=function(){return t.getBottomCoordinate()}},t.prototype.distanceFromIP=function(e){var t=$(this._element),n=t.offset();return new Rect(n.left,n.top,t.outerWidth(!0),t.outerHeight(!0)).getDistanceToPointFromExtendedEdge(e,EdgeSegment.Bottom)},t}(Disposable);e.BindingBase=t}(e.DistanceFromIP||(e.DistanceFromIP={}))}(e.Bindings||(e.Bindings={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(){}return e.isInterestingKeyEvent=function(e,t){return!(!(t&&(StoryApp.Utilities.isMacOsX?e.metaKey:e.ctrlKey))||e.altKey||e.shiftKey||!ArrayExtensions.contains(t,String.fromCharCode(e.which)))},e.prototype.prepareForCopy=function(e,t){var n=this;t&&(this.saveState(),this.clearState());var o=this.getCopyDiv();o.empty(),o.show(),$("<textarea />").attr("id","copyarea").val(e).appendTo(o).focus().select(),$(document).on("copy",function(e){return $(document).off("copy"),platform.setTimeout(function(){n.getCopyDiv().empty().hide(),t&&n.restoreState()}),!0})},e.prototype.prepareForPaste=function(){var e=this;StoryApp.Utilities.browser.isIE&&this.preparePasteDiv();var t=this.getSpecializedPasteEventName();$(document).on(t,function(n){$(document).off(t);var o=e.getPasteData(n);return e.useCustomPasteAction(o)?(StoryApp.Utilities.browser.isIE||e.preparePasteDiv(),e.paste(o),e.getPasteDiv().empty().hide(),e.forgetFocusedPlaceholder(),n.preventDefault(),!1):(e.forgetFocusedPlaceholder(),StoryApp.Utilities.browser.isIE&&e.restoreState(),!0)})},e.prototype.preparePasteDiv=function(){this.saveState(),this.saveFocusedPlaceholder(),this.clearState();var e=this.getPasteDiv();e.empty(),e.show(),$("<textarea />").attr("id","pastearea").val(" ").appendTo(e).focus().select()},e.prototype.getPasteData=function(e){if(null!=e&&null!=e.originalEvent){var t=e.originalEvent.clipboardData,n="text/plain";t||(t=window.clipboardData,n="Text");var o=void 0;return t&&(o=t.getData(n)),o}},e.prototype.getSpecializedPasteEventName=function(){return"paste."+this.getPasteEventName()},e}();e.CopyPasteImplementationBase=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){!function(t){var n;!function(e){e[e.Invalid=0]="Invalid",e[e.Title=1]="Title",e[e.Body=2]="Body",e[e.BodyHtml=3]="BodyHtml",e[e.VideoPlayerDescriptor=4]="VideoPlayerDescriptor",e[e.Summary=5]="Summary",e[e.SummaryHtml=6]="SummaryHtml",e[e.Author=7]="Author",e[e.UserName=8]="UserName",e[e.Image=9]="Image",e[e.ProfileImage=10]="ProfileImage",e[e.ThumbnailImage=11]="ThumbnailImage",e[e.Timestamp=12]="Timestamp",e[e.Attribution=13]="Attribution",e[e.AttributionIcon=14]="AttributionIcon",e[e.Link=15]="Link",e[e.RssLink=16]="RssLink",e[e.Duration=17]="Duration",e[e.AlbumCount=18]="AlbumCount",e[e.SuggestionId=19]="SuggestionId",e[e.Likes=20]="Likes",e[e.Longitude=21]="Longitude",e[e.Latitude=22]="Latitude",e[e.SCQueryIds=23]="SCQueryIds",e[e.CategoryInfo=24]="CategoryInfo",e[e.AudioPlayerDescriptor=25]="AudioPlayerDescriptor",e[e.Rating=26]="Rating",e[e.ReviewCount=27]="ReviewCount",e[e.Address=28]="Address",e[e.Phone=29]="Phone",e[e.PriceRange=30]="PriceRange",e[e.GifThumbnailImage=31]="GifThumbnailImage",e[e.Price=32]="Price",e[e.Size=33]="Size",e[e.Extension=34]="Extension",e[e.SourceName=35]="SourceName",e[e.AltText=36]="AltText"}(n=t.ClipPartType||(t.ClipPartType={})),t.IsImageClipPartType=function(e){switch(e){case n.Image:case n.ProfileImage:case n.ThumbnailImage:case n.AttributionIcon:case n.GifThumbnailImage:return!0;default:return!1}},t.ClipPartTypeToImageCategory=function(t){switch(t){case n.Image:return e.Model.SM.ImageCategory.Image;case n.ProfileImage:return e.Model.SM.ImageCategory.Profile;case n.ThumbnailImage:return e.Model.SM.ImageCategory.Thumbnail;case n.AttributionIcon:return e.Model.SM.ImageCategory.AttributionIcon;case n.GifThumbnailImage:return e.Model.SM.ImageCategory.GifThumbnail;default:throw StoryApp.RethrowLogger.createError("Not a recognized image clip part type.")}},t.NumberToClipPartType=function(e){switch(e){case 0:return n.Invalid;case 1:return n.Title;case 2:return n.Body;case 3:return n.BodyHtml;case 4:return n.VideoPlayerDescriptor;case 5:return n.Summary;case 6:return n.SummaryHtml;case 7:return n.Author;case 8:return n.UserName;case 9:return n.Image;case 10:return n.ProfileImage;case 11:return n.ThumbnailImage;case 12:return n.Timestamp;case 13:return n.Attribution;case 14:return n.AttributionIcon;case 15:return n.Link;case 16:return n.RssLink;case 17:return n.Duration;case 18:return n.AlbumCount;case 19:return n.SuggestionId;case 20:return n.Likes;case 21:return n.Longitude;case 22:return n.Latitude;case 23:return n.SCQueryIds;case 24:return n.CategoryInfo;case 25:return n.AudioPlayerDescriptor;case 26:return n.Rating;case 27:return n.ReviewCount;case 28:return n.Address;case 29:return n.Phone;case 30:return n.PriceRange;case 31:return n.GifThumbnailImage;case 32:return n.Price;case 33:return n.Size;case 34:return n.Extension;case 35:return n.SourceName;default:throw StoryApp.RethrowLogger.createError("Not a recognized number representing clip part type: "+e)}}}(t.WP||(t.WP={}))}(t.Decomposition||(t.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){!function(e){e[e.Invalid=0]="Invalid",e[e.Text=1]="Text",e[e.Image=2]="Image",e[e.Video=3]="Video",e[e.StatusUpdate=4]="StatusUpdate",e[e.WebPage=5]="WebPage",e[e.Folder=6]="Folder",e[e.SuggestedImage=7]="SuggestedImage",e[e.Map=8]="Map",e[e.Embed=9]="Embed",e[e.Document=10]="Document",e[e.WikipediaCard=11]="WikipediaCard",e[e.Audio=12]="Audio",e[e.ClosedCaption=13]="ClosedCaption"}(e.ClipType||(e.ClipType={}))}(e.WP||(e.WP={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e,t){this.Key=e,this.Value=t}return e}();e.ClipProperty=t}(e.WP||(e.WP={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e,t,n){this.ProviderType=e,this.Url=t,this.Properties=n}return e}();e.ClipDescriptor=t}(e.WP||(e.WP={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e,t){this.PartType=e,this.Value=t}return e}();e.ClipPart=t}(e.WP||(e.WP={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(){function e(){}return e}();e.ClipPartGroup=t}(e.WP||(e.WP={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(){function e(){}return e}();e.DecompositionResults=t}(e.WP||(e.WP={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){!function(e){e[e.UnknownFailure=0]="UnknownFailure",e[e.GenericBrokerFailure=1]="GenericBrokerFailure",e[e.UnauthenticatedUserFailure=2]="UnauthenticatedUserFailure",e[e.DisabledProviderFailure=3]="DisabledProviderFailure",e[e.ConnectedServiceFailure=4]="ConnectedServiceFailure",e[e.EmptyFile=5]="EmptyFile",e[e.UnsupportedContentType=6]="UnsupportedContentType",e[e.UploadFailed=7]="UploadFailed",e[e.Success=8]="Success",e[e.BingBrokerFailure=9]="BingBrokerFailure",e[e.PasswordAuthFailure=10]="PasswordAuthFailure"}(e.DecompositionStatus||(e.DecompositionStatus={})),function(e){function t(t){return e[t]}e.fromString=t}(e.DecompositionStatus||(e.DecompositionStatus={}))}(e.WP||(e.WP={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(){function e(){}return e}();e.DecompositionResponse=t}(e.WP||(e.WP={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){!function(e){e[e.NotRelevant=0]="NotRelevant",e[e.Offensive=1]="Offensive",e[e.Adult=2]="Adult"}(e.ReportReason||(e.ReportReason={}))}(e.WP||(e.WP={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){!function(e){e[e.Title=0]="Title",e[e.Body=1]="Body",e[e.BodyHtml=2]="BodyHtml",e[e.Summary=3]="Summary",e[e.SummaryHtml=4]="SummaryHtml",e[e.Author=5]="Author",e[e.UserName=6]="UserName",e[e.Timestamp=7]="Timestamp",e[e.Attribution=8]="Attribution",e[e.Link=9]="Link",e[e.RssLink=10]="RssLink",e[e.Duration=11]="Duration",e[e.AlbumCount=12]="AlbumCount",e[e.VideoPlayerDescriptor=13]="VideoPlayerDescriptor",e[e.SuggestionId=14]="SuggestionId",e[e.Likes=15]="Likes",e[e.Longitude=16]="Longitude",e[e.Latitude=17]="Latitude",e[e.SCQueryIds=18]="SCQueryIds",e[e.CategoryInfo=19]="CategoryInfo",e[e.LicenseName=20]="LicenseName",e[e.LicenseLink=21]="LicenseLink",e[e.AudioPlayerDescriptor=22]="AudioPlayerDescriptor",e[e.Rating=23]="Rating",e[e.ReviewCount=24]="ReviewCount",e[e.Address=25]="Address",e[e.Phone=26]="Phone",e[e.PriceRange=27]="PriceRange",e[e.Price=28]="Price",e[e.Size=29]="Size",e[e.Extension=30]="Extension",e[e.SourceName=31]="SourceName",e[e.AltText=32]="AltText"}(e.TextCategory||(e.TextCategory={}))}(e.WP||(e.WP={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(){function e(){}return e}();e.MediaPrepareUploadResponse=t}(e.WP||(e.WP={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(e.MediaPrepareUploadResponse);e.VideoPrepareUploadResponse=t}(e.WP||(e.WP={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(e.MediaPrepareUploadResponse);e.AudioPrepareUploadResponse=t}(e.WP||(e.WP={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(){function e(){}return e}();e.VideoUploadDoneResponse=t}(e.WP||(e.WP={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(){function e(){}return e}();e.AudioUploadDoneResponse=t}(e.WP||(e.WP={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(){function e(){}return e}();e.MagazineLayoutRule=t}(e.WP||(e.WP={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(e.DecompositionResponse);e.AuthenticatedDecompositionResponse=t}(e.WP||(e.WP={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e){this.Query=e}return e}();e.NLQuery=t}(e.NL||(e.NL={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e,t,n,o){this.QueryResult=e,this.SourceResult=t,this.ContentResult=n,this.PrivacyMode=o}return e}();e.NLSearchResult=t}(e.NL||(e.NL={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){!function(e){e[e.Public=0]="Public",e[e.Share=1]="Share",e[e.ShareCommercially=2]="ShareCommercially",e[e.Modify=3]="Modify",e[e.ModifyCommercially=4]="ModifyCommercially",e[e.All=5]="All"}(e.RequestLicenseType||(e.RequestLicenseType={}));var t=function(){function t(){}return t.getDefaultLicenseType=function(){switch(StoryPageEditSettings.DefaultBingLicense.toLocaleLowerCase()){case"public":return e.RequestLicenseType.Public;case"share":return e.RequestLicenseType.Share;case"sharecommercially":return e.RequestLicenseType.ShareCommercially;case"modify":return e.RequestLicenseType.Modify;case"modifycommercially":return e.RequestLicenseType.ModifyCommercially;case"all":return e.RequestLicenseType.All;default:return e.RequestLicenseType.Share}},t}();e.RequestLicenseTypeExtensions=t}(e.WP||(e.WP={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(){function t(t,n,o,i,r,a,s){void 0===r&&(r=e.SuggestionsRequestType.Unknown),void 0===a&&(a={}),void 0===s&&(s=""),this.PreviousFocus=t,this.Focus=n,this.RequestType=r,this.ClustersMax=StoryPageEditSettings.SuggestionsClustersMax,this.AllClientClusters=o,this.ContentSource=i,this.RequestParameters=a,this.RequestId=s}return t}();e.SuggestionClustersDecompositionRequest=t}(e.WP||(e.WP={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(e.DecompositionResponse);e.SuggestionClustersDecompositionResponse=t}(e.WP||(e.WP={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){!function(e){e[e.Active=0]="Active",e[e.AutoSelected=1]="AutoSelected",e[e.Inactive=2]="Inactive",e[e.Unknown=3]="Unknown"}(e.SuggestionsClusterSelection||(e.SuggestionsClusterSelection={}))}(e.WP||(e.WP={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM;!function(e){var t=function(){function t(t,o,i,r,a,s,l,c,d,u,p){void 0===a&&(a=e.SuggestionsRequestType.Unknown),void 0===s&&(s=e.RequestLicenseTypeExtensions.getDefaultLicenseType()),void 0===l&&(l=n.ContentProvider.None),void 0===c&&(c=[]),void 0===d&&(d=[]),void 0===u&&(u={}),void 0===p&&(p=""),this.PreviousFocus=t,this.Focus=o,this.UnwantedCluster=i,this.RequestType=a,this.AutoSelectedClustersMax=StoryPageEditSettings.AutoSelectedSuggestionsClustersMax,this.ClustersMax=StoryPageEditSettings.SuggestionsClustersMax,this.License=e.RequestLicenseType[s],this.AllClientClusters=r,this.ContentProvider=l,this.RequestedClusters=c,this.RequestedQueries=d,this.RequestParameters=u,this.RequestId=p,IsPerformanceModeOn&&(this.ReturnPerformance=IsPerformanceModeOn)}return t}();e.SuggestionsDecompositionRequest=t}(t.WP||(t.WP={}))}(t.Decomposition||(t.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(e.DecompositionResponse);e.SuggestionsDecompositionResponse=t}(e.WP||(e.WP={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){!function(e){e[e.InitialSelection=0]="InitialSelection",e[e.LongPolling=1]="LongPolling",e[e.AutoRefresh=2]="AutoRefresh",e[e.ClustersChanged=3]="ClustersChanged",e[e.FocusChanged=4]="FocusChanged",e[e.ManualRefresh=5]="ManualRefresh",e[e.LicenseChanged=6]="LicenseChanged",e[e.Unknown=7]="Unknown",e[e.Search=8]="Search"}(e.SuggestionsRequestType||(e.SuggestionsRequestType={}))}(e.WP||(e.WP={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e){this.Url=e}return e}();e.UrlDecompositionRequest=t}(e.WP||(e.WP={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e){this.ClipDescriptor=e}return e}();e.ClipDecompositionRequest=t}(e.WP||(e.WP={}))}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.Common,n=function(){function n(){}return n.callDecompService=function(e,t,o,i){void 0===o&&(o=!0),void 0===i&&(i=StoryApp.RequestManager.JsonContentType);var r={type:"POST",data:e,processData:o,dataType:"json",contentType:i,timeout:12e4},a=$.ajax(t,r),s=new DeferredTask;return n.executeDecompTask(t,r,Task.fromPromise(a),s,0),s},n.executeDecompTask=function(e,t,o,i,r){r++,StoryLog.StructuredTraceTag(596474019,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Executing decomp request",{decompUrl:e,requestNumber:r.toString()}),o.then(function(t){StoryLog.StructuredTraceTag(596474048,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Decomp request succeeded",{decompUrl:e,requestNumber:r.toString()}),i.resolve(t)},function(a,s,l){r<3&&("error"===s&&l&&l.match&&l.match("BadRequest")||""===l)||"timeout"===s||""===s?n.retryDecompRequest(e,t,o,i,r,1e3):(StoryLog.StructuredTraceTag(596474049,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.warning,"Call to decompose failed",{textStatus:s,errorThrown:l,decompUrl:e,timesRequested:r.toString()}),i.reject())})},n.retryDecompRequest=function(e,t,o,i,r,a){platform.setTimeout(function(){StoryLog.StructuredTraceTag(596474050,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Decomp request failed due to timeout or unknown reason, attempting to retry",{decompUrl:e,failedRequestNumber:r.toString()});var o=$.ajax(e,t);n.executeDecompTask(e,t,Task.fromPromise(o),i,r)},a)},n.prototype.decomposeSearch=function(o,i,r){i||StoryLog.RaiseRecoverableError("ArgumentNullException: descriptor");var a={license:e.WP.RequestLicenseType[r]},s={requestId:IdGenerator.generateId(36),query:o,descriptor:i,parameters:a};return StoryLog.TraceTag(17847244,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Decompose search request made. RequestId:"+s.requestId+" Descriptor: "+this.getDescriptorType(i)),n.callDecompService(JSON.stringify(s),t.UrlHelper.getInstance().decomposeSearchUrl(StoryPageSettings.LookupId))},n.prototype.decomposeBrowse=function(e){var o={requestId:IdGenerator.generateId(36),descriptor:e};return StoryLog.TraceTag(17847245,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Decompose browse request made. RequestId:"+o.requestId+" Descriptor: "+this.getDescriptorType(e)),n.callDecompService(JSON.stringify(o),t.UrlHelper.getInstance().decomposeBrowseUrl(StoryPageSettings.LookupId))},n.prototype.decomposeNext=function(e){var o={requestId:IdGenerator.generateId(36),descriptor:e};return StoryLog.TraceTag(17847246,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Decompose next request made. RequestId:"+o.requestId+" Descriptor: "+this.getDescriptorType(e)),n.callDecompService(JSON.stringify(o),t.UrlHelper.getInstance().decomposeNextUrl(StoryPageSettings.LookupId))},n.prototype.decomposeUpload=function(e,o){e&&e.getBlob()||StoryLog.StructuredTraceTag(596474051,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.error,"decomposeUpload: Attempting to upload null file.",{file:JSON.stringify(e),descriptor:o});var i=new FormData;i.append("file",e.getBlob(),e.getName());var r={descriptor:o};return i.append("request",JSON.stringify(r)),n.callDecompService(i,t.UrlHelper.getInstance().decomposeUploadUrl(StoryPageSettings.LookupId),!1,!1)},n.prototype.decomposeReport=function(e,o){var i={requestId:IdGenerator.generateId(36),userConcerns:e,descriptor:o};return StoryLog.TraceTag(596474052,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Decompose report request made. RequestId:"+i.requestId+" Descriptor: "+this.getDescriptorType(o)),n.callDecompService(JSON.stringify(i),t.UrlHelper.getInstance().decomposeReportUrl(StoryPageSettings.LookupId))},n.callDecompSuggestionsService=function(e){var n={name:"suggestions",description:"Decomposition service method suggestions to get clip parts.",type:"POST",data:JSON.stringify(e),dataType:"json",contentType:StoryApp.RequestManager.JsonContentType,timeout:6e4},o=$.ajax(t.UrlHelper.getInstance().getSuggestionsUrl(StoryPageSettings.LookupId),n);return Task.fromPromise(o).then(function(e){return e},function(e,t,n){StoryLog.StructuredTraceTag(596474053,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.warning,"Call to decompose suggestions failed",{textStatus:t,errorThrown:n})})},n.prototype.decomposeSuggestions=function(e){return n.callDecompSuggestionsService(e)},n.callDecompClustersService=function(e){var n={name:"clusters",description:"Decomposition service method clusters to get clip parts.",type:"POST",data:JSON.stringify(e),dataType:"json",contentType:StoryApp.RequestManager.JsonContentType,timeout:6e4},o=$.ajax(t.UrlHelper.getInstance().getSuggestionClustersUrl(StoryPageSettings.LookupId),n);return Task.fromPromise(o).then(function(e){return e},function(t,n,o){navigator&&!navigator.onLine?StoryLog.StructuredTraceTag(596455885,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Call to decompose clusters failed due to being offline",{textStatus:n,errorThrown:o,jqXHR:JSON.stringify(t),requestId:e.RequestId}):StoryLog.StructuredTraceTag(596474054,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.warning,"Call to decompose clusters failed",{textStatus:n,errorThrown:o,jqXHR:JSON.stringify(t),requestId:e.RequestId})})},n.prototype.decomposeClusters=function(e){return n.callDecompClustersService(e)},n.prototype.getDescriptorType=function(e){return e?e.$type:null},n}();e.DecompositionAPI=n}(e.Decomposition||(e.Decomposition={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function t(e){this.clientId=e.clientId,this.displayName=e.displayName,this.givenName=e.givenName,this.surname=e.surname,this.email=e.email,this.thumbnailUrlSmall=e.thumbnailUrlSmall,this.thumbnailUrl=e.thumbnailUrl,this.modelIpLocation=TDB.watchableTag(596132168,this,""),this.textIpLocation=TDB.watchableTag(596132169,this,[])}return t.prototype.updateLocation=function(e){var t=this;e.textIds||(e.textIds=[]),TDB.applyUpdate(function(){t.modelIpLocation.setValue(e.modelId),t.textIpLocation.setValue(e.textIds)})},t.prototype.getModelIPLocation=function(e){return this.modelIpLocation.getWatchedValue(e)},t.prototype.getTextIPLocation=function(e){return this.textIpLocation.getWatchedValue(e)},t.prototype.ConvertToStoryUser=function(){var t=new e.StoryUser;return t.clientId=this.clientId,t.displayName=this.displayName,t.givenName=this.givenName,t.surname=this.surname,t.email=this.email,t.thumbnailUrlSmall=this.thumbnailUrlSmall,t.thumbnailUrl=this.thumbnailUrl,t.onlineStatus=!0,new e.StoryUserModel(t)},t}();e.Author=t}(e.AuthorsManager||(e.AuthorsManager={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){function n(){return o||(o=StoryApp.Common.PageCompartmentManager.getInstance().createAccessor("AuthorsManager")),o}var o,i=e.Server.NotificationBus.NotificationType;t.currentAuthorsManager=n;var r=function(){function e(e,t,n,o){void 0===o&&(o=[]);var r=this;this.notificationManager=e,this.authorsManagerAPI=t,this.currentLocation={clientId:n,modelId:"",textIds:[]};var a=this.mergeAuthorsList(o,[]);this.authors=TDB.watchableTag(596132120,this,a),this.authorsStatus=TDB.watchableTag(596132121,this,""),this.cardAuthorsStatus=TDB.watchableTag(596132122,this,void 0),this.authorListListener=this.notificationManager.createListener(i.AuthorList),this.authorListListener.listen().then(function(){r.authorListUpdated()}),this.authorPositionListener=this.notificationManager.createListener(i.AuthorPosition),this.authorPositionListener.listen().then(function(e){r.authorPositionUpdated(e)}),this.stopRefreshing=!1,this.coauthorsHidden=!1,this.swspListsError=TDB.watchableTag(596132123,this,!1),this.swspRequestInProgress=TDB.watchableTag(596132124,this,!1),this.swspRequestForSpecificUser=TDB.watchableTag(596132125,this,void 0),this.swspEditors=TDB.watchableTag(596132126,this,[]),this.swspViewers=TDB.watchableTag(596132127,this,[]),this.swspUserEditorsCount=TDB.watchableTag(596132128,this,0),this.swspUserViewersCount=TDB.watchableTag(596132129,this,0),this.swspGroupEditorsCount=TDB.watchableTag(596132130,this,0),this.swspGroupViewersCount=TDB.watchableTag(596132131,this,0)}return e.prototype.authorListUpdated=function(){var t=this,n=this.getAuthors();this.refreshStoryUsers().then(function(){var o,i=e.hasNewAuthors(n,t.getAuthors());return i.additionalAuthors.length>0?(t.broadcastLocation(),o=1===i.additionalAuthors.length?ResourceManager.ResolveString(Resources.SingleAuthorJoinDescription,[i.additionalAuthors[0].displayName]):ResourceManager.ResolveString(Resources.MultipleAuthorJoinDescription,[i.additionalAuthors.length,t.getAuthors().length-1])):i.removedAuthors.length>0&&(o=1===i.removedAuthors.length?ResourceManager.ResolveString(Resources.SingleAuthorLeaveDescription,[i.removedAuthors[0].displayName]):ResourceManager.ResolveString(Resources.MultipleAuthorLeaveDescription,[i.removedAuthors.length,t.getAuthors().length-1])),o&&TDB.applyUpdate(function(){t.authorsStatus.setValue(o)}),t.authorListListener.listen()}).then(function(){t.stopRefreshing||t.authorListUpdated()})},e.hasNewAuthors=function(e,t){return{additionalAuthors:t.filter(function(t){return!e.some(function(e){return t.clientId===e.clientId})}),removedAuthors:e.filter(function(e){return!t.some(function(t){return e.clientId===t.clientId})})}},e.prototype.authorPositionUpdated=function(e){var t=this;e&&this.authorsIPLocationChanged(JSON.parse(e)),this.authorPositionListener.listen().then(function(e){t.authorPositionUpdated(e)})},e.prototype.getAuthors=function(e){return this.coauthorsHidden?this.authors.getWatchedValue(e).slice(0,1):this.authors.getWatchedValue(e).slice()},e.prototype.getAuthorStatus=function(){return this.authorsStatus},e.prototype.hasCoAuthors=function(e){return this.getAuthors(e).length>1},e.prototype.hasSwspListError=function(e){return this.swspListsError.getWatchedValue(e)},e.prototype.isRequestInProgress=function(e){return this.swspRequestInProgress.getWatchedValue(e)},e.prototype.hasSwspViewers=function(e){return this.getSwspViewers(e).length>0},e.prototype.hasSwspEditors=function(e){return this.getSwspEditors(e).length>0},e.prototype.getSwspViewers=function(e){return this.swspViewers.getWatchedValue(e)},e.prototype.getSwspEditors=function(e){return this.coauthorsHidden?[]:this.swspEditors.getWatchedValue(e)},e.prototype.getAuthorsForModel=function(e,t){for(var n=[],o=this.getAuthors(t),i=o.length,r=0;r<i;r++)o[r].getModelIPLocation(t)==e&&n.push(o[r]);return n},e.prototype.initiateLoadingWithoutRequest=function(){this.setSwspRequestInProgress(!0),this.updateEditorsAndViewers([],[])},e.prototype.refreshStoryUsers=function(){var n=this,o=$.Deferred();return this.initiateLoadingWithoutRequest(),this.authorsManagerAPI.getStoryUsers().then(function(i){if(n.setSwspRequestInProgress(!1),i&&i.statusCode===t.ChangeAudienceResponseStatusCode.Success){n.updateAuthorsList(i.authors.filter(function(e){return!0===e.onlineStatus}));var r=e.MergeUsersAndGroupsIntoAuthorsAndViewers(i);n.updateEditorsAndViewers(r.authorsModel,r.viewersModel,!0),n.setSwspListErrorFlag(!1)}else n.updateAuthorsList([]),n.updateEditorsAndViewers([],[],!0),n.setSwspListErrorFlag(!0);o.resolve()}),o.promise()},e.prototype.updateEditorsAndViewers=function(e,t,n){var o=this;void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===n&&(n=!1),TDB.applyUpdate(function(){o.swspViewers.setValue(t),o.swspEditors.setValue(e),o.swspViewers.notify(),o.swspEditors.notify(),n&&o.updateEditorsAndViewersCounters()})},e.prototype.updateEditorsAndViewersCounters=function(){var e=this.swspEditors.getValue(),n=this.swspViewers.getValue();if(CommonSettings.ShareWithSecurityGroupEnabled){for(var o=0,i=0,r=0,a=0,s=0;s<e.length;s++)e[s]instanceof t.StoryUserModel?o++:r++;for(s=0;s<n.length;s++)n[s]instanceof t.StoryUserModel?i++:a++;this.swspUserEditorsCount.setValue(o),this.swspUserViewersCount.setValue(i),this.swspGroupEditorsCount.setValue(r),this.swspGroupViewersCount.setValue(a)}else this.swspUserEditorsCount.setValue(e.length),this.swspUserViewersCount.setValue(n.length)},e.prototype.updateEditorsList=function(e){var t=this;void 0===e&&(e=[]),TDB.applyUpdate(function(){t.swspEditors.setValue(e),t.swspEditors.notify()})},e.prototype.updateViewersList=function(e){var t=this;void 0===e&&(e=[]),TDB.applyUpdate(function(){t.swspViewers.setValue(e),t.swspViewers.notify()})},e.prototype.convertEditorToViewer=function(n){if(StoryLog.TraceTag(596132160,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.info,"Convert specified author to viewer"),n){var o=this.getSwspEditors();if(o&&ArrayExtensions.contains(o,n)){var i=e.GeneratePermissionsUpdateRequest([n],t.ChangeAudienceOperationType.ConvertToViewers);return this.setSwspRequestForSpecificUser(n),this.sendChangeSharingAudienceRequest(i)}}else TDB.raiseRecoverableError("user object must be provided")},e.prototype.convertViewerToEditor=function(n){if(StoryLog.TraceTag(596132161,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.info,"Convert specified viewer to author"),n){var o=this.getSwspViewers();if(o&&ArrayExtensions.contains(o,n)){var i=e.GeneratePermissionsUpdateRequest([n],t.ChangeAudienceOperationType.ConvertToEditors);return this.setSwspRequestForSpecificUser(n),this.sendChangeSharingAudienceRequest(i)}}else TDB.raiseRecoverableError("user object must be provided")},e.prototype.removeEditor=function(n){if(StoryLog.TraceTag(596132162,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.info,"Remove specified author"),n){var o=this.getSwspEditors();if(o&&ArrayExtensions.contains(o,n)){var i=e.GeneratePermissionsUpdateRequest([n],t.ChangeAudienceOperationType.RemoveEditor);return this.setSwspRequestForSpecificUser(n),this.sendChangeSharingAudienceRequest(i)}}else TDB.raiseRecoverableError("user object must be provided")},e.prototype.removeViewer=function(n){if(StoryLog.TraceTag(596132163,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.info,"Remove specified viewer"),n){var o=this.getSwspViewers();if(o&&ArrayExtensions.contains(o,n)){var i=e.GeneratePermissionsUpdateRequest([n],t.ChangeAudienceOperationType.RemoveViewer);return this.setSwspRequestForSpecificUser(n),this.sendChangeSharingAudienceRequest(i)}}else TDB.raiseRecoverableError("user object must be provided")},e.prototype.addEditors=function(n){if(StoryLog.TraceTag(596132164,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.info,"Adding specified authors"),!n||0===n.length)return TDB.raiseRecoverableError("users object must be provided and non-empty"),null;var o=e.GeneratePermissionsUpdateRequest(n,t.ChangeAudienceOperationType.AddEditors);return this.sendChangeSharingAudienceRequest(o)},e.prototype.addViewers=function(n){if(StoryLog.TraceTag(596132165,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.info,"Adding specified viewers"),!n||0===n.length)return TDB.raiseRecoverableError("users object must be provided and non-empty"),null;var o=e.GeneratePermissionsUpdateRequest(n,t.ChangeAudienceOperationType.AddViewers);return this.sendChangeSharingAudienceRequest(o)},e.GeneratePermissionsUpdateRequest=function(e,n){var o=new t.ChangeAudienceRequest;if(o.operationType=n,CommonSettings.ShareWithSecurityGroupEnabled){o.users=[],o.groups=[];for(var i=0;i<e.length;i++)e[i]instanceof t.StoryUserModel?o.users.push(e[i].getModel()):e[i]instanceof t.SecurityGroupModel?o.groups.push(e[i].getModel()):TDB.raiseRecoverableError("Unsupported model recieved when creating request for addViewer or addEditor")}else{var r=e.map(function(e){return e.getModel()});o.users=r}return o},e.prototype.updateAuthorsList=function(e){var t=this;TDB.applyUpdate(function(){t.authors.setValue(t.mergeAuthorsList(e,t.getAuthors()))},TDB.Justification.SynchronousBrowserEvent)},e.prototype.mergeAuthorsList=function(n,o){for(var i=[],r=n.length,a=0;a<r;a++){var s=e.findAuthorIndex(o,n[a].clientId);s>0?i.push(o[s]):i.push(new t.Author(n[a]))}return i},e.findAuthorIndex=function(e,t){for(var n=e.length,o=0;o<n;o++)if(e[o].clientId==t)return o;return-1},e.prototype.getCardAuthorsStatus=function(){return this.cardAuthorsStatus},e.prototype.updateIPLocation=function(e,t){var n=this;if(void 0===t&&(t=[]),this.currentLocation.modelId!=e||!this.textIdsMatch(t)){this.currentLocation.modelId=e,this.currentLocation.textIds=t;for(var o=[],i=0,r=this.getAuthors(),a=0;a<r.length;a++)r[a].getModelIPLocation()==e&&(o.push(r[a]),this.textIdsMatch(r[a].getTextIPLocation())&&i++);var s="";o.length>0&&(s=1===o.length?ResourceManager.ResolveString(Resources.SingleCardAuthorDescription,[o[0].displayName]):ResourceManager.ResolveString(Resources.MultipleCardAuthorDescription,[o.length])),TDB.applyUpdate(function(){n.cardAuthorsStatus.setValue(s)}),ActionLogger.RecordClientAction(new ClientAction.IPPositionActionData(e,o.length,t,i)),this.broadcastLocation()}},e.prototype.textIdsMatch=function(e){if(this.currentLocation.textIds.length==e.length){for(var t=0;t<e.length&&e[t]==this.currentLocation.textIds[t];t++);if(t==e.length)return!0}return!1},e.prototype.broadcastLocation=function(){this.hasCoAuthors()&&CommonSettings.CoAuthoringEnabled&&this.notificationManager.sendMessage(JSON.stringify(this.currentLocation),i.AuthorPosition)},e.prototype.authorsIPLocationChanged=function(t){var n=this,o=this.getAuthors(),i=e.findAuthorIndex(o,t.clientId);if(i>-1){var r;t.modelId===this.currentLocation.modelId?r=ResourceManager.ResolveString(Resources.AuthorJoinsCardDescription,[o[i].displayName]):o[i].getModelIPLocation()===this.currentLocation.modelId&&(r=ResourceManager.ResolveString(Resources.AuthorLeavesCardDescription,[o[i].displayName])),r&&TDB.applyUpdate(function(){n.cardAuthorsStatus.setValue(r)}),o[i].updateLocation(t)}},e.prototype.hideCoAuthors=function(e){e!==this.coauthorsHidden&&(this.coauthorsHidden=e,this.refreshStoryUsers())},e.prototype.stopRefreshingAuthors=function(){this.stopRefreshing=!0},e.prototype.sendChangeSharingAudienceRequest=function(n){var o=this,i=$.Deferred();return this.setSwspRequestInProgress(!0),this.authorsManagerAPI.changeSharingAudience(n,function(r,a,s){if(StoryLog.StructuredTraceTag(596132166,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.info,"Changing sharing audience result",{operationType:n.operationType.toString(),statusCode:r.statusCode.toString()}),r.statusCode===t.ChangeAudienceResponseStatusCode.Success){var l=e.MergeUsersAndGroupsIntoAuthorsAndViewers(r);o.updateEditorsAndViewers(l.authorsModel,l.viewersModel,!0)}o.setRequestRelatedFlags(e.ShouldSetSwspListErrorFlag(r.statusCode),!1,void 0),i.resolve(r)},function(e,t,r){StoryLog.StructuredTraceTag(596132167,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.info,"Changing sharing audience failed",{operationType:n.operationType.toString()}),o.setRequestRelatedFlags(!0,!1,void 0),i.reject()}),i.promise()},e.MergeUsersAndGroupsIntoAuthorsAndViewers=function(e){var n=e.authors.map(function(e){return new t.StoryUserModel(e)}),o=e.viewers.map(function(e){return new t.StoryUserModel(e)});if(CommonSettings.ShareWithSecurityGroupEnabled){var i=e.groupAuthors.map(function(e){return new t.SecurityGroupModel(e)}),r=e.groupViewers.map(function(e){return new t.SecurityGroupModel(e)});n=n.concat(i),o=o.concat(r)}return{authorsModel:n,viewersModel:o}},e.prototype.setRequestRelatedFlags=function(e,t,n){this.setSwspListErrorFlag(e),this.setSwspRequestInProgress(t),this.setSwspRequestForSpecificUser(n)},e.ShouldSetSwspListErrorFlag=function(e){return e===t.ChangeAudienceResponseStatusCode.UpdateAudienceFail||e===t.ChangeAudienceResponseStatusCode.StoryNotFound||e===t.ChangeAudienceResponseStatusCode.StoryUserListRetrieveFail},e.prototype.setSwspListErrorFlag=function(e){var t=this;TDB.applyUpdate(function(){t.swspListsError.setValue(e)})},e.prototype.setSwspRequestInProgress=function(e){var t=this;TDB.applyUpdate(function(){t.swspRequestInProgress.setValue(e)})},e.prototype.setSwspRequestForSpecificUser=function(e){var t=this;TDB.applyUpdate(function(){t.swspRequestForSpecificUser.setValue(e)})},e.prototype.getCurrentSwspUserRequest=function(e){return this.swspRequestForSpecificUser.getWatchedValue(e)},e.prototype.getSwspUserEditorsCount=function(e){return this.swspUserEditorsCount.getWatchedValue(e)},e.prototype.getSwspUserViewersCount=function(e){return this.swspUserViewersCount.getWatchedValue(e)},e.prototype.getSwspGroupEditorsCount=function(e){return this.swspGroupEditorsCount.getWatchedValue(e)},e.prototype.getSwspGroupViewersCount=function(e){return this.swspGroupViewersCount.getWatchedValue(e)},e}();t.AuthorsManager=r}(t.AuthorsManager||(t.AuthorsManager={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(e){this.urlHelper=e}return e.prototype.getStoryUsers=function(){var e=$.Deferred();return $.ajax(this.urlHelper.getAudienceUrl(StoryPageSettings.LookupId),{name:"getAudience",description:"GetAudience call for fetching the authors-viewers lists",type:"GET",dataType:"json",cache:!1,success:function(t,n,o){e.resolve(t)},error:function(t,n,o){StoryLog.TraceTag(596132119,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.warning,"Failed to complete GetAudience call: "+o),e.resolve()}}),e.promise()},e.prototype.changeSharingAudience=function(e,t,n){var o=$.Deferred();return $.ajax(this.urlHelper.changeAudienceUrl(StoryPageSettings.LookupId),{name:"changeSharingAudience",description:"Changing story audience",type:"POST",dataType:"json",data:JSON.stringify(e),contentType:StoryApp.RequestManager.JsonContentType,cache:!1}).then(t,n),o.promise()},e}();e.AuthorsManagerAPI=t}(e.AuthorsManager||(e.AuthorsManager={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){!function(e){e[e.UnknownFailure=0]="UnknownFailure",e[e.Success=1]="Success",e[e.EmptyFile=2]="EmptyFile",e[e.UnsupportedContentType=3]="UnsupportedContentType",e[e.UploadFailed=4]="UploadFailed"}(e.UploadStatus||(e.UploadStatus={}))}(e.WP||(e.WP={}))}(e.Upload||(e.Upload={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e,t,n){this.Status=e,this.Url=t,this.ThumbnailUrl=n}return e}();e.UploadResponse=t}(e.WP||(e.WP={}))}(e.Upload||(e.Upload={}))}(e.Server||(e.Server={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e,t,n){this.element=e}return e.prototype.init=function(e){var t=this;this.dragHandler=e,this.mouseMoveHandle=function(e){t.mouseMove(e)},$(this.element).droppable&&$(this.element).droppable({tolerance:"pointer",accept:function(t){return!!e.accept&&e.accept.call(e,t)},over:function(n,o){e.over&&e.over.call(e,n,o),t.mouseMove(n),$(window).bind("mousemove",t.mouseMoveHandle)},out:function(n,o){e.out&&e.out.call(e,n,o),$(window).unbind("mousemove",t.mouseMoveHandle)},drop:function(t,n){e.drop&&e.drop.call(e,t,n)},activate:function(n,o){e.activate&&e.activate.call(e,n,o),t.elementTop=$(t.element).offset().top,t.elementLeft=$(t.element).offset().left},deactivate:function(n,o){e.deactivate&&e.deactivate.call(e,n,o),$(window).unbind("mousemove",t.mouseMoveHandle)}})},e.prototype.mouseMove=function(e){if(this.dragHandler.mouseMove){var t=e.pageY-this.elementTop+this.element.scrollTop,n=e.pageX-this.elementLeft+this.element.scrollLeft,o=new Point(n,t);this.dragHandler.mouseMove(e,o,new Point(e.pageX,e.pageY),this.element)}},e.prototype.dispose=function(){this.disposed||($(this.element).droppable&&$(this.element).droppable("destroy"),this.disposed=!0)},e}();e.BindingBase=t}(e.DragHandler||(e.DragHandler={}))}(e.Bindings||(e.Bindings={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e,t,n){this.element=e,this.viewElement=n}return e.prototype.init=function(e){this.dragHandler=e.dragHandler;var t=e.zOrder?e.zOrder:0;this.dragHandler.addDropTarget(this.element,e.owner,t)},e.prototype.dispose=function(){this.dragHandler&&(this.dragHandler.removeDropTarget(this.element),this.dragHandler=null)},e}();e.BindingBase=t}(e.DropTarget||(e.DropTarget={}))}(e.Bindings||(e.Bindings={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(){function e(t,n,o){var i=this;this._element=t,this.listening=!1,this.scrollHandler=function(t){for(var n=i._element.offsetTop,o=i._element.offsetParent;o&&o!=i.scrollParent;)n+=o.offsetTop,o=o.offsetParent;var r=n-i.scrollParent.scrollTop,a=r+i._element.offsetHeight,s=r<0&&a>=e.bottomBuffer;TDB.applyUpdate(function(){return i.menuVisible.setValue(!s)},TDB.Justification.SynchronousBrowserEvent)}}return e.prototype.init=function(e){this.menuVisible=e},e.prototype.updateFloatingMenu=function(e,t){var n=this;if(t&&!this.listening){var o=this.findScrollParent();if(!o)return;this.scrollParent=o,$(this.scrollParent).on("scroll",this.scrollHandler),TDB.applyUpdate(function(){n.scrollHandler(void 0)},TDB.Justification.InitialConversion),this.listening=!0}!t&&this.listening&&($(this.scrollParent).off("scroll",this.scrollHandler),this.listening=!1)},e.prototype.findScrollParent=function(){for(var e=this._element;void 0!=e.parentNode;){var t=$(e);if("auto"==t.css("overflow-y")||"scroll"==t.css("overflow-y")||"auto"==t.css("overflow"))return e;e=e.parentNode}},e.prototype.dispose=function(){$(this.scrollParent).off("scroll",this.scrollHandler)},e.bottomBuffer=50,e}();e.BindingBase=t}(e.FloatingMenu||(e.FloatingMenu={}))}(e.Bindings||(e.Bindings={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e,t,n){this._el=e}return e.prototype.updateScrollPosition=function(e,t){void 0!==t.top&&(this._el.scrollTop=t.top),void 0!==t.left&&(this._el.scrollLeft=t.left)},e}();e.BindingBase=t}(e.ScrollPosition||(e.ScrollPosition={}))}(e.Bindings||(e.Bindings={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(){function e(){}return e}(),n=function(){function e(e,t,n){var o=this;this._element=e,this._viewElement=n,this.hauntedHouse=[],this.mouseMoveHandle=function(e){o.mouseMove(e)}}return e.prototype.init=function(e){var t=this;this.allowDrop=e.allowDrop,this.generateGhost=e.generateGhost,this.generateElementList=e.generateElementList,this.onDrop=e.onDrop,this.animationTiming=void 0!==e.animationTiming?e.animationTiming:200,$(this._element).droppable&&$(this._element).droppable({tolerance:"touch",accept:function(e){var n=TDB.ViewElement.dataFor(e.get()[0]);return t.allowDrop.call(t._viewElement,n)},activate:function(e,n){var o=TDB.ViewElement.dataFor(n.draggable.get()[0]);t._elementList=[];for(var i=t.generateElementList.call(t._viewElement,o),r=i.length,a=0;a<r;a++){for(var s=i[a];void 0===s.domElement;){if(1!==s.children.length)throw StoryApp.RethrowLogger.createError("Shuffling list drop target binding only works with children view elements that have one root dom element.");s=s.children[0]}t._elementList.push(s.domElement)}t._elementList.sort(function(e,t){return $(e).offset().top-$(t).offset().top})},over:function(e,n){t.helperElement=n.helper.clone(),t.helperElement.css({position:"relative",top:"",left:"",opacity:".5"}),t.mouseMove(e),$(window).on("mousemove",t.mouseMoveHandle)},out:function(e,n){t.resetState()},drop:function(e,n){var o=TDB.ViewElement.dataFor(n.draggable.get()[0]),i=TDB.ViewElement.dataFor(t.hauntedElement);return t.onDrop.call(t._viewElement,i,o),t.resetState(!1),!0}})},e.prototype.generateNextBoundaries=function(e){this.topBoundaryElement=null,this.hauntedElement=null,this.bottomBoundaryElement=null;var t=this._elementList[0];if(e<=$(t).offset().top+$(t).height()/2)return this.topBoundaryElement=null,this.hauntedElement=t,void(this.bottomBoundaryElement=this._elementList.length>1?this._elementList[1]:null);for(var n=0;n<this._elementList.length-2;n++){var o=this._elementList[n],i=$(o).offset().top+$(o).height()/2,r=this._elementList[n+1],a=$(r).offset().top+$(r).height()/2;if(e>i&&e<a){this.topBoundaryElement=o,this.hauntedElement=r,this.bottomBoundaryElement=this._elementList[n+2];break}}null===this.hauntedElement&&this._elementList.length>0&&(this.topBoundaryElement=this._elementList.length>1?this._elementList[this._elementList.length-2]:null,this.hauntedElement=this._elementList[this._elementList.length-1],this.bottomBoundaryElement=null)},e.prototype.addGhostElement=function(e,n){void 0===n&&(n=!0);for(var o=0;o<this.hauntedHouse.length;o++){var i=this.hauntedHouse[o];if(i.hauntedElement==e)return this.curGhostPair=i,$(this.curGhostPair.ghostElement).stop(!0,!0),void $(this.curGhostPair.ghostElement).slideDown(this.animationTiming)}this.curGhostPair=new t;var r=this.helperElement.clone();this.generateGhost?this.curGhostPair.ghostElement=this.generateGhost.call(this._viewElement,r.get(0),TDB.ViewElement.dataFor(e)):(this.curGhostPair.ghostElement=document.createElement("div"),$(this.curGhostPair.ghostElement).append(r)),e.parentElement.insertBefore(this.curGhostPair.ghostElement,e),$(this.curGhostPair.ghostElement).slideUp(0),$(this.curGhostPair.ghostElement).slideDown(n?this.animationTiming:0),this.curGhostPair.hauntedElement=e,this.hauntedHouse.push(this.curGhostPair)},e.prototype.removeGhostPair=function(e,t){void 0===t&&(t=!0),null!=e&&($(e.ghostElement).stop(!0,!0),$(e.ghostElement).slideUp(t?this.animationTiming:0))},e.prototype.mouseMove=function(e){var t=e.pageY;if(null==this.hauntedElement)return this.generateNextBoundaries(t),void this.addGhostElement(this.hauntedElement,!1);var n=null!==this.topBoundaryElement?$(this.topBoundaryElement).offset().top+$(this.topBoundaryElement).height()/2:-1,o=null!==this.bottomBoundaryElement?$(this.hauntedElement).offset().top+$(this.hauntedElement).height()/2:-1,i=-1;null!==this.topBoundaryElement&&t<n?i=this._elementList.indexOf(this.hauntedElement)-1:null!==this.bottomBoundaryElement&&o<t&&(i=this._elementList.indexOf(this.hauntedElement)+1),-1!=i&&(this.removeGhostPair(this.curGhostPair),this.topBoundaryElement=i>0?this._elementList[i-1]:null,this.hauntedElement=this._elementList[i],this.bottomBoundaryElement=i+1<this._elementList.length?this._elementList[i+1]:null,this.addGhostElement(this.hauntedElement))},e.prototype.resetState=function(e){for(void 0===e&&(e=!0),$(window).off("mousemove",this.mouseMoveHandle);this.hauntedHouse.length>0;){var t=this.hauntedHouse[0];$(t.ghostElement).remove(),this.hauntedHouse.splice(0,1)}this.topBoundaryElement=null,this.hauntedElement=null,this.bottomBoundaryElement=null,this.removeGhostPair(this.curGhostPair,e)},e.prototype.dispose=function(){this.disposed||($(this._element).droppable&&$(this._element).droppable("destroy"),this.disposed=!0)},e}();e.BindingBase=n}(e.ShufflingListDropTarget||(e.ShufflingListDropTarget={}))}(e.Bindings||(e.Bindings={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e,t,n){this._element=e}return e.prototype.updateTextEllipsis=function(e,t){if(null!=t){var n=this._element.offsetHeight<this._element.scrollHeight;n!=t.getValue()&&platform.setTimeout(function(){TDB.applyUpdate(function(){t.setValue(n)})},0)}},e}();e.BindingBase=t}(e.TextEllipsis||(e.TextEllipsis={}))}(e.Bindings||(e.Bindings={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){var t=function(e){function t(t,n,o,i,r){var a=e.call(this,t,n,o)||this;return a._ve=o,a.init(r),a}return __extends(t,e),t.prototype.update=function(e){},t}(e.BindingBase);e.Binding=t}(e.DragHandler||(e.DragHandler={}))}(e.Bindings||(e.Bindings={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={})),function(e){!function(e){!function(e){!function(e){var t=function(e){function t(t,n,o,i,r){var a=e.call(this,t,n,o)||this;return a._ve=o,a.init(r),a}return __extends(t,e),t.prototype.update=function(e){},t}(e.BindingBase);e.Binding=t}(e.DropTarget||(e.DropTarget={}))}(e.Bindings||(e.Bindings={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={})),function(e){!function(e){!function(e){!function(e){var t=function(e){function t(t,n,o,i,r,a){var s=e.call(this,t,n,o)||this;s._ve=o,s.init(r),s._floatingMenuArgs=a;var l=s._floatingMenuWatcher=TDB.watcherTag(4800663,s,i,s._resolveFloatingMenu);return i._subscribeToWatchable(l,TDB.UpdatePhase.ReadWrite),s}return __extends(t,e),t.prototype.update=function(e){var t=this;e==TDB.UpdatePhase.ReadWrite&&t._floatingMenuWatcher.resolve()},t.prototype._resolveFloatingMenu=function(e){var t=this,n=t._floatingMenuArgs.call(t._ve,e);t.updateFloatingMenu(e,n)},t}(e.BindingBase);e.Binding=t}(e.FloatingMenu||(e.FloatingMenu={}))}(e.Bindings||(e.Bindings={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={})),function(e){!function(e){!function(e){!function(e){var t=function(e){function t(t,n,o,i,r){var a=e.call(this,t,n,o)||this;return a._ve=o,a.init(r),a}return __extends(t,e),t.prototype.update=function(e){},t}(e.BindingBase);e.Binding=t}(e.DistanceFromIP||(e.DistanceFromIP={}))}(e.Bindings||(e.Bindings={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={})),function(e){!function(e){!function(e){!function(e){var t=function(e){function t(t,n,o,i,r){var a=e.call(this,t,n,o)||this;a._ve=o,a._scrollPositionArgs=r;var s=a._scrollPositionWatcher=TDB.watcherTag(4800663,a,i,a._resolveScrollPosition);return i._subscribeToWatchable(s,TDB.UpdatePhase.WriteOnly),a._scrollPositionWatcher.resolve(),a}return __extends(t,e),t.prototype.update=function(e){var t=this;e==TDB.UpdatePhase.WriteOnly&&t._scrollPositionWatcher.resolve()},t.prototype._resolveScrollPosition=function(e){var t=this,n=t._scrollPositionArgs.call(t._ve,e);t.updateScrollPosition(e,n)},t}(e.BindingBase);e.Binding=t}(e.ScrollPosition||(e.ScrollPosition={}))}(e.Bindings||(e.Bindings={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={})),function(e){!function(e){!function(e){!function(e){var t=function(e){function t(t,n,o,i,r){var a=e.call(this,t,n,o)||this;return a._ve=o,a.init(r),a}return __extends(t,e),t.prototype.update=function(e){},t}(e.BindingBase);e.Binding=t}(e.ShufflingListDropTarget||(e.ShufflingListDropTarget={}))}(e.Bindings||(e.Bindings={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={})),function(e){!function(e){!function(e){!function(e){var t=function(e){function t(t,n,o,i,r){var a=e.call(this,t,n,o)||this;a._ve=o,a._textEllipsisArgs=r;var s=a._textEllipsisWatcher=TDB.watcherTag(4800663,a,i,a._resolveTextEllipsis);return i._subscribeToWatchable(s,TDB.UpdatePhase.ReadWrite),a}return __extends(t,e),t.prototype.update=function(e){var t=this;e==TDB.UpdatePhase.ReadWrite&&t._textEllipsisWatcher.resolve()},t.prototype._resolveTextEllipsis=function(e){var t=this,n=t._textEllipsisArgs.call(t._ve,e);t.updateTextEllipsis(e,n)},t}(e.BindingBase);e.Binding=t}(e.TextEllipsis||(e.TextEllipsis={}))}(e.Bindings||(e.Bindings={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Server.Decomposition.WP,o=function(){function e(e){this.licenseCheckboxChecked=TDB.watchableTag(596460822,this,!0),this.resetScrollPosition=TDB.notifierTag(596473823,this),this.disposed=!1,this.storyPageEditSettings=e.storyPageEditSettings,this.contentCollectionFactory=e.contentCollectionFactory,this.resourceFactory=e.resourceFactory}return e.prototype.dispose=function(){this.disposed=!0},e.prototype.getLicenseCheckboxChecked=function(){return this.licenseCheckboxChecked.getValue()},e.prototype.licenseCheckboxArgs=function(){var e={url:Resources.LicensenLinkUrl,message:Resources.SuggestedContentLicenseCheckboxLink,title:Resources.CreativeCommonLinkTooltip},t={buttonId:ClientAction.ButtonId.RichCheckbox_SuggestedContent,context:this,checkedWatchable:this.licenseCheckboxChecked,click:this.licenseCheckboxClicked,cssClass:{value:this.getLicenseCheckboxClass()},richTextElementsUnchecked:[new TDB.ChildArgs(VE.ClickableLinkVE,e)],richTextElementsChecked:[new TDB.ChildArgs(VE.ClickableLinkVE,e)],descriptionChecked:Resources.SuggestedContentLicenseCheckboxLink,descriptionUnchecked:Resources.SuggestedContentLicenseCheckboxLink,fontIconName:{value:FontIcons.CheckboxFontIcon},fontIconSize:FontIcons.CheckboxFontIconSize,checkedIconWrapperClass:{value:"LegalNotificationCheckboxChecked"},uncheckedIconWrapperClass:{value:"LegalNotificationCheckboxUnchecked"},visible:{watchable:this.licenseCheckboxVisible}};return new TDB.ChildArgs(VE.RichCheckboxVE,t)},e.prototype.checkLicenseCheckbox=function(){var e=this;TDB.applyUpdate(function(){e.licenseCheckboxChecked.setValue(!0)})},e.prototype.decomposeNext=function(e){this.handleDecompTaskCompletion(this.getCurrentContentCollection().decomposeNext(e))},e.prototype.handleDecompTaskCompletion=function(e){var t=this;e&&e.then(function(e){t.handleDecompTaskResolved(e)},function(){t.onDecompError()})},e.prototype.handleDecompTaskResolved=function(e){e?n.DecompositionStatus.fromString(e.Status)!==n.DecompositionStatus.Success?this.onDecompFailure(e):this.onDecompSuccess(e):this.onDecompError()},e.prototype.shouldIgnoreDecompositionResponse=function(){return this.disposed},e}();t.AddContentPageViewModel=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function t(){}return t.prototype.createAddContentPage=function(t,n){return n.source.pageType==PageType.Basic?new e.BasicContentPageViewModel(t,n):n.source.pageType===PageType.SuggestedContent?new e.SuggestedContentTabViewModel(t,n):n.source.pageType===PageType.UnavailableForClient?new e.ContentUnavailableForClientPageViewModel(t,n):void 0},t}();e.AddContentPageFactory=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function t(){this.info=t.createEmptyAttributionInfo(),this.attributionLinkURL=TDB.watchableTag(596473955,this,"")}return t.createEmptyAttributionInfo=function(){return{attributionText:"",attributionLinkURL:"",attributionOwnerID:"",attributionOwnerName:"",attributionLicenseName:"",attributionLicenseURL:""}},t.prototype.setAttributionInfo=function(e){var t=this;TDB.applyUpdate(function(){t.info=e,t.attributionLinkURL.setValue(e.attributionLinkURL)})},t.prototype.getAttributionLinkTextParts=function(t,n,o,i,r){var a=this.info.attributionText,s=a.length>20?a.substring(0,20)+"...":a,l=(this.createAttributionClickableLinkArgs(this.attributionLinkURL.getWatchedValue(t),s,e.AddContentTabIndex.AttributionLink,o),this.createAttributionClickableLinkArgs(this.attributionLinkURL.getWatchedValue(t),a,e.AddContentTabIndex.AttributionLink,o));return[new TDB.ChildArgs(VE.ClickableLinkVE,l)]},t.prototype.createAttributionClickableLinkArgs=function(e,t,n,o){return{url:e,message:t,context:this,onClickHandler:o,tabIndex:n,class:"AddContentAttributionLinkText"}},t}();e.Attribution=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function t(){}return t.prototype.createContentCollection=function(t){return new e.ContentCollection(t)},t}();e.ContentCollectionFactory=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t,n){var o=e.call(this,t)||this;return o.args=n,o}return __extends(t,e),t.prototype.ifGeneralFileErrorArgs=function(){return void 0!==this.args.generalFileError},t.prototype.ifTooLargeArgs=function(){return this.args.fileTooLargeError.length>0},t.prototype.ifFileTypeArgs=function(){return this.args.fileTypeError.length>0},t.prototype.ifEmptyFileArgs=function(){return this.args.emptyFileError.length>0},t.prototype.messageTextArgs=function(){return Resources.UploadModalDialogErrorMessage},t.prototype.filenameHeaderTextArgs=function(){return Resources.UploadFilenameLabel},t.prototype.errorHeaderTextArgs=function(){return Resources.UploadErrorLabel},t.prototype.filenameGeneralErrorTextArgs=function(){return this.args.generalFileError},t.prototype.errorGeneralErrorTextArgs=function(){return this.args.generalErrorMessage},t.prototype.filenameFileTooLargeTextArgs=function(){return this.args.fileTooLargeError.join(",")},t.prototype.errorFileTooLargeTextArgs=function(){var e=CommonSettings.IsAADUser?StoryPageEditSettings.SettingService_MaxLocalUploadAudioSizeAAD:StoryPageEditSettings.SettingService_MaxLocalUploadAudioSizeMSA,t=CommonSettings.IsAADUser?StoryPageEditSettings.SettingService_MaxLocalUploadVideoSizeAAD:StoryPageEditSettings.SettingService_MaxLocalUploadVideoSizeMSA;return ResourceManager.ResolveString(Resources.UploadModalDialogErrorFileTooLargeDescriptionWithAudioVideoAndImage,[CommonSettings.DocumentIngestionMaximumDocumentSize/1048576,e/1048576,t/1048576,StoryPageEditSettings.SettingService_MaxImageSizeBytes/1048576,CommonSettings.MaxHttpRequestLength/1048576])},t.prototype.filenameFileTypeTextArgs=function(){return this.args.fileTypeError.join(",")},t.prototype.errorFileTypeTextArgs=function(){return Resources.UploadErrorUnsupportedContentType},t.prototype.filenameEmptyFileTextArgs=function(){return this.args.emptyFileError.join(",")},t.prototype.errorEmptyTextArgs=function(){return Modernizr.videoupload?Resources.UploadErrorEmptyFile:Resources.UploadErrorVideoUnsupported},t}(TDB.ViewElement);e.FailedUploadDialogContentVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(t,n){this.resources=[],this.callbacks=[],this.trackerLocked=!1,this.remainingLoadEvents=0,this.imageLoadingMethod=e.setImageSrc,this.callbacks[0]={callback:t,context:n},this.result={loadedSuccessfully:!0,loadingTime:0,resultElements:{}}}return e.setImageSrc=function(e,t){e.src=t},e.prototype.startLoading=function(){var e=this;if(this.trackerLocked||0===this.resources.length)return!1;this.trackerLocked=!0,this.startLoadTime=platform.now();for(var t=0;t<this.resources.length;t++)!function(t){!function(){var n=t;e.resources[t].onLoadHandler=function(){return e.onResourceLoad(n,!0)},e.resources[t].onErrorHandler=function(){return e.onResourceLoad(n,!1)},e.resources[t].element.addEventListener("load",e.resources[t].onLoadHandler),e.resources[t].element.addEventListener("error",e.resources[t].onErrorHandler),e.resources[t].loadingMethod(e.resources[t].element,e.resources[t].url)}()}(t);return!0},e.prototype.addImageResource=function(e){return this.addImageResources([e])},e.prototype.addImageResources=function(e){if(this.trackerLocked)return!1;for(var t=0;t<e.length;t++)this.addResource(e[t],function(){return new Image},this.imageLoadingMethod);return!0},e.prototype.addResource=function(e,t,n){if(this.trackerLocked)return!1;var o={url:e,element:t(),loadingMethod:n};return this.resources.push(o),this.remainingLoadEvents+=1,!0},e.prototype.addCallback=function(e,t){if(this.trackerLocked)return!1;var n={callback:e,context:t};return this.callbacks.push(n),!0},e.prototype.onResourceLoad=function(e,t){var n=this.resources[e],o=platform.now()-this.startLoadTime;this.remainingLoadEvents--,this.result.resultElements[n.url]={loadedSuccessfully:t,loadingTime:o,element:n.element},t?this.result.loadingTime=Math.max(o,this.result.loadingTime):this.result.loadedSuccessfully=!1,0===this.remainingLoadEvents&&(this.executeCallbacks(),this.disposeResources())},e.prototype.executeCallbacks=function(){var e=this;0===this.remainingLoadEvents&&this.callbacks.forEach(function(t){t.callback.call(t.context,e.result)})},e.prototype.disposeResources=function(){for(var e=0;e<this.resources.length;e++){var t=this.resources[e];t.element.removeEventListener("load",t.onLoadHandler),t.element.removeEventListener("error",t.onErrorHandler),t.element=null,this.result.resultElements[t.url]&&this.result.resultElements[t.url].element&&(this.result.resultElements[t.url].element=null)}},e}();e.ResourceLoadingTracker=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(e,t){this.suggestedContentTab=e,this.language=CommonSettings.UserLocaleString.substr(0,2),this.storyPageEditSettings=t}return e.prototype.getClusterStripeMessage=function(e){var t=this.suggestedContentTab.getCurrentContentCollection(),n=this.suggestedContentTab.getSuggestionsClusterCollection(),o=this.suggestedContentTab.getActiveClusters().length;e&&(e.watchValue(n.suggestionsClusters),e.watch(this.suggestedContentTab.parent.selectionManager.selectionChanged));var i="";return StoryApp.Settings.ServiceSwitches.blockServiceSuggestedContentDecomp.getWatchedValue(e)?i=Resources.AllServicesAreOnMaintenance:this.showingClustersForUnsupportedLanguage()?i=Resources.SuggestedContentLanguageNotSupportedNonEmpty:0==o&&""==t.getCurrentSearchQuery()&&(0===this.suggestedContentTab.getAllClusters().length?i=this.getMessageForNoClusters():this.storyPageEditSettings.VisualClustersEnabled||(i=Resources.SuggestedContentNoClusterSelected)),i},e.prototype.showingClustersForUnsupportedLanguage=function(){var e=this.suggestedContentTab.getActiveClusters().length,t=this.suggestedContentTab.getCurrentContentCollection().getContentPieces().length,n=!ArrayExtensions.contains(this.storyPageEditSettings.SuggestedContentSupportedLanguages,this.language)&&!ArrayExtensions.contains(this.storyPageEditSettings.SuggestedContentPartiallySupportedLanguages,this.language);return this.suggestedContentTab.getAllClusters().length>0&&0==e&&0==t&&n},e.prototype.getMessageForNoClusters=function(){return ArrayExtensions.contains(this.storyPageEditSettings.SuggestedContentSupportedLanguages,this.language)?this.storyPageEditSettings.LandingPageEnabled?"":Resources.SuggestedContentEmptySway:ArrayExtensions.contains(this.storyPageEditSettings.SuggestedContentPartiallySupportedLanguages,this.language)?this.storyPageEditSettings.LandingPageEnabled?"":Resources.SuggestedContentLanguagePartiallySupported:Resources.SuggestedContentLanguageNotSupported},e}();e.ClusterStripeMessageGenerator=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel,o=function(e){function o(t,o){var i=e.call(this,t)||this;return i.viewModel=new n.AuthoringHintViewModel(o),i}return __extends(o,e),o.prototype.runChildrenArgs=function(e){for(var n=[],o=this.viewModel.getRunChildrenModels(e),i=o.length,r=0;r<i;r++)n.push(new TDB.ChildArgs(t.HintTextRunVE,o[r]));return n},o.prototype.ParagraphAttrArgs=function(e){var t={},n=this.viewModel.isRtl(e);return t.dir=n?"rtl":"ltr",t},o.prototype.ParagraphTextArgs=function(e){return this.viewModel.ParagraphTextArgs(e)},o.prototype.ParagraphPropsArgs=function(e){return this.viewModel.ParagraphPropsArgs(e)},o.HintTextClassName="AuthoringHintText",o.HintTextMediaClassName=o.HintTextClassName+"Media",o}(TDB.FocusableViewElement);t.AuthoringHintVEBase=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.View.ViewElements,i=function(){function e(e){this.model=e}return e.prototype.runChildrenArgs=function(e){for(var t=[],n=this.getRunChildrenModels(e),i=n.length,r=0;r<i;r++)t.push(new TDB.ChildArgs(o.HintTextRunVE,n[r]));return t},e.prototype.getRunChildrenModels=function(e){return this.model?this.model.getContent(e).runs.getCollection(e):[]},e.prototype.isRtl=function(e){return!!this.model&&this.model.getDirection(e)===n.TextDirection.RightToLeft},e.prototype.ParagraphTextArgs=function(e){if(this.model)return this.model.getContent(e).getText()},e.prototype.ParagraphPropsArgs=function(e){if(this.model)return{id:this.createNodeId()}},e.prototype.createNodeId=function(){return"_"+this.model.id},e}();t.AuthoringHintViewModel=i}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t,n){var o=e.call(this,t)||this;return o.progressUpdater=n.progressUpdater,o}return __extends(t,e),t.prototype.progressStyleArgs=function(e){return{width:this.progressUpdater.getProgress(e)+"%"}},t.prototype.progressAttrArgs=function(e){var t={};return t[Aria.Attributes.Role]=Aria.Roles.Progressbar,t[Aria.Attributes.Valuemin]="0",t[Aria.Attributes.Valuemax]="100",t[Aria.Attributes.Valuenow]=Math.floor(this.progressUpdater.getProgress(e)).toString(),t},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.progressUpdater.dispose()},t}(TDB.FocusableViewElement);e.CardProgressBarVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t,n){var o=e.call(this,t)||this;return o.args=n,o}return __extends(t,e),t.prototype.wrapperEventsInitArgs=function(){var e=this;return{mousedown:function(t){return e.swallowEvent(t)}}},t.prototype.swallowEvent=function(e){return e&&e.stopPropagation(),!0},t.prototype.onLanguageChance=function(e){this.args.setLanguage(e)},t.prototype.getLanguage=function(e){return this.args.getLanguage()},t.supportedLanguages={bat:"Bat",c:"C",coffeescript:"CoffeeScript",cpp:"C++",csharp:"C#",dockerfile:"Docker",fsharp:"F#",go:"Go",handlebars:"Handlebars",html:"HTML",jade:"Jade",java:"Java",javascript:"JavaScript",json:"JSON",less:"Less",lua:"Lua",markdown:"Markdown","objective-c":"Objective C",php:"PHP",plaintext:"Plain text",powershell:"Powershell",python:"Python",r:"R",razor:"Razor",ruby:"Ruby",scss:"SCSS",sql:"SQL",swift:"Swift",typescript:"TypeScript",v:"Visual Basic",ini:".ini"},t}(TDB.FocusableViewElement);e.CodeMenuVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(n){function o(e,t){var o=this,i={buttonId:ClientAction.ButtonId.CardAction_CollapseOrExpand,cssClass:{value:"ContainerCardCollapseButton"}};return o=n.call(this,e,i)||this,o.description=TDB.watchableOption(o,{compute:new TDB.ComputedOptionArgs(o,o.collapseButtonDescription)}),o.headerParent=t.headerParent,o.labelFontIcon=t.labelFontIcon,o.labelGlyph=t.labelGlyph,o.labelText=t.labelText,o.buttonArgs.click=o.collapsedClicked,o}return __extends(o,n),o.prototype.wrapperClassNameArgs=function(e){return this.getButtonClass(e)},o.prototype.wrapperAttrArgs=function(e){return this.getButtonAttributes(e,{id:this.buttonArgs.telemetryId?this.buttonArgs.telemetryId:void 0})},o.prototype.collapseIconArgs=function(){return new TDB.ChildArgs(t.FontIconVE,{fontIconName:{compute:new TDB.ComputedOptionArgs(this,this.collapseButtonFontIcon)},fontIconSizeClass:FontIcons.ExpandIconSize,fontIconWrapperClass:{value:"ContainerCardCollapseFontIconWrapper"}})},o.prototype.labelArgs=function(t){return new TDB.ChildArgs(e.ContainerCardLabelVE,{labelText:{watchable:this.labelText},fontIconArgs:this.labelGlyph?{value:{fontIconName:{watchable:this.labelFontIcon},fontIconSizeClass:FontIcons.CardOptionIconSize,fontIconWrapperClass:{value:"ContainerCardHeaderIconGlyph"}}}:void 0,textClass:{value:"ContainerCardHeaderLabel segoeUISemibold"},wrapperClass:{value:"ContainerCardLabelWrapper"},textPlacementLeft:!1})},o.prototype.collapseButtonFontIcon=function(e){return this.headerParent.getViewModel().isCollapsed(e)?FontIcons.ExpandIcon:FontIcons.CollapseIcon},o.prototype.collapsedClicked=function(e){return this.headerParent.onCollapse(),TDB.EventPropagation.Bypass},o.prototype.collapseButtonDescription=function(e){return this.headerParent.getViewModel().isCollapsed(e)?Resources.ExpandGroupToggleButtonDescription:Resources.CollapseGroupToggleButtonDescription},o}(t.ButtonVE);e.ContainerCardHeaderButtonVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(e){function n(t,n){var o=e.call(this,t)||this;return o._labelWrapper=TDB.watchableOption(o,n.wrapperClass),o._labelText=TDB.watchableOption(o,n.labelText),o._textClass=TDB.watchableOption(o,n.textClass),o._fontIconTemplateArgs=TDB.watchableOption(o,n.fontIconArgs),o._textPlacementLeft=!!n.textPlacementLeft,o}return __extends(n,e),n.prototype.labelWrapperClassNameArgs=function(e){return this._labelWrapper.getWatchedValue(e)},n.prototype.textClassNameArgs=function(e){return this._textClass.getWatchedValue(e)},n.prototype.textTextArgs=function(e){return this._labelText.getWatchedValue(e)},n.prototype.textStyleArgs=function(e){return this._textPlacementLeft?{float:"left"}:{float:"right"}},n.prototype.fontIconArgs=function(e){return this._fontIconTemplateArgs.getWatchedValue(e)?new TDB.ChildArgs(t.FontIconVE,this._fontIconTemplateArgs.getWatchedValue(e)):null},n}(TDB.ViewElement);e.ContainerCardLabelVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(e){this.fullProgressValue=100,this.progress=TDB.watchableTag(596473631,this,0),this.mediaModelId=e.mediaModelId,this.canBeUpdatedToLowerValue=e.canBeUpdatedToLowerValue,StoryPageSettings.ServiceBusEnabledNewSessions&&(this.notificationListener=e.notificationManager.createListener(e.notificationType),this.listenForNotifications())}return e.prototype.listenForNotifications=function(){var e=this;this.cancellationSource=new CancellationSource,this.notificationListener.listen(this.cancellationSource).then(function(t){return e.onNotification(t)})},e.prototype.getProgress=function(e){return this.progress.getWatchedValue(e)},e.prototype.onNotification=function(e){var t,n=this,o=!1;if(e){try{t=JSON.parse(e)}catch(e){return StoryLog.StructuredTraceTag(596473632,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.error,"An error occured while parsing the notification content.",{name:e.name,message:e.message}),void this.listenForNotifications()}var i=t.ModelId,r=t.Progress,a=this.canBeUpdatedToLowerValue||r>this.progress.getValue();this.mediaModelId===i&&a&&(TDB.applyUpdate(function(){return n.progress.setValue(r)}),o=r===this.fullProgressValue)}o||this.listenForNotifications()},e.prototype.dispose=function(){this.cancellationSource.cancel()},e}();e.NotificationProgressUpdater=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(e){this.fullProgress=100,this.uploader=e}return e.prototype.getProgress=function(e){return this.uploader?this.uploader.getProgress(e):this.fullProgress},e.prototype.dispose=function(){},e}();e.UploadProgressUpdater=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel,o=function(e){function o(t,o){var i=e.call(this,t)||this;return i._viewModel=new n.HintTextRunViewModel(o),i}return __extends(o,e),o.prototype.TextSpanTextArgs=function(e){var t=this.parent.ParagraphTextArgs(e);return this._viewModel.GetRunText(t)},o.prototype.TextSpanPropsArgs=function(e){var t=this.getIsPublicSharing(e);return this._viewModel.TextSpanPropsArgs(e,t)},o.prototype.hasUrlArgs=function(e){return this._viewModel.hasUrlArgs(e)},o.prototype.getIsPublicSharing=function(e){var t=this.findStoryPageEditVE();if(!t)return TDB.raiseRecoverableError("StoryPageEditVE not found"),!1;var n=t.getSharingManager();return n?n.getCurrentSharingLevel(e)===StoryAudience.Public:(TDB.raiseRecoverableError("Sharing manager instance is not set"),!1)},o.prototype.findStoryPageEditVE=function(){for(var e=this;e&&!(e instanceof t.StoryPageEditVE);)e=e.parent;return e||null},o.prototype.mouseClicked=function(t){return 1!=t.which?TDB.EventPropagation.Bubble:this.hasUrlArgs()?TDB.EventPropagation.Bypass:e.prototype.mouseClicked.call(this,t)},o}(TDB.Control);t.HintTextRunVEBase=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=function(){function e(e){this._model=e}return e.prototype.GetRunText=function(e){return e.substr(this._model.getIndex(),this._model.getLength())},e.prototype.TextSpanPropsArgs=function(e,t){var o=this._model,i={},r=o.getUrl(e);return r&&(i.href=r,i.target="_blank",i.rel=t?"nofollow":"nofollow noreferrer"),o.getEmphasis()!==n.EmphasisLevel.None&&(i.style="font-weight:bold;"),i.style?i.style+="font-style:italic":i.style="font-style:italic",i},e.prototype.hasUrlArgs=function(e){return!!this._model.getUrl(e)},e}();t.HintTextRunViewModel=o}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(e){this.model=e.model,this.definition=e.definition}return e.prototype.serialize=function(){return{cardType:this.definition?this.definition.id:"",serializedModel:this.model?this.model.serialize():""}},e}();e.Card=t}(e.AuthoringModel||(e.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t){var n=e.call(this,t)||this;return n.model=t.model,n}return __extends(t,e),t}(e.Card);e.AgaveCard=t}(e.AuthoringModel||(e.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t){var n=e.call(this,t)||this;return n.model=t.model,n}return __extends(t,e),t}(e.Card);e.TableCard=t}(e.AuthoringModel||(e.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t){var n=e.call(this,t)||this;return n.model=t.model,n}return __extends(t,e),t}(e.Card);e.ClosedCaptionCard=t}(e.AuthoringModel||(e.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t){var n=e.call(this,t)||this;return n.model=t.model,n}return __extends(t,e),t}(e.Card);e.CodeCard=t}(e.AuthoringModel||(e.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t){var n=e.call(this,t)||this;return n.model=t.model,n}return __extends(t,e),t}(e.Card);e.ComplexHeadingCard=t}(e.AuthoringModel||(e.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t){var n=e.call(this,t)||this;return n.model=t.model,n}return __extends(t,e),t}(e.Card);e.DocumentCard=t}(e.AuthoringModel||(e.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t){var n=e.call(this,t)||this;return n.model=t.model,n}return __extends(t,e),t}(e.Card);e.EmbedCard=t}(e.AuthoringModel||(e.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t){var n=e.call(this,t)||this;return n.model=t.model,n}return __extends(t,e),t}(e.Card);e.GroupCard=t}(e.AuthoringModel||(e.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t){var n=e.call(this,t)||this;return n.model=t.model,n}return __extends(t,e),t}(e.Card);e.ImportingOrEmbeddingDocumentCard=t}(e.AuthoringModel||(e.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t){var n=e.call(this,t)||this;return n.model=t.model,n}return __extends(t,e),t}(e.Card);e.MediaCard=t}(e.AuthoringModel||(e.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t){var n=e.call(this,t)||this;return n.model=t.model,n}return __extends(t,e),t}(e.Card);e.MediaContentCard=t}(e.AuthoringModel||(e.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t){var n=e.call(this,t)||this;return n.model=t.model,n}return __extends(t,e),t}(e.Card);e.SetCard=t}(e.AuthoringModel||(e.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){e[e.ShowMenu=0]="ShowMenu",e[e.AddCard=1]="AddCard",e[e.OpenFilePicker=2]="OpenFilePicker"}(e.SocketActionType||(e.SocketActionType={}))}(e.AuthoringModel||(e.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){e[e.Paragraph=0]="Paragraph",e[e.TextGroup=1]="TextGroup",e[e.ImageWithTextComposite=2]="ImageWithTextComposite",e[e.Image=3]="Image",e[e.ClosedCaption=4]="ClosedCaption"}(e.CompositeType||(e.CompositeType={}))}(e.AuthoringModel||(e.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=function(o){function i(e){var t=o.call(this)||this;return t.addResource(t),t._definition=e.definition,t._parentModelObject=e.parentModelObject,t.parentCardType=e.parentCardType,t.modelObject=TDB.watcherTag(596473613,t,t,t.calculateSocketModelObject),t.pageId=e.pageId,t}return __extends(i,o),i.prototype.getDefinition=function(){return this._definition},i.prototype.getParentModelObject=function(){return this._parentModelObject},i.prototype.getParentCardType=function(){return this.parentCardType},i.prototype.getModelObject=function(e){return this.modelObject.getWatchedValue(e)},i.prototype.modelIsImageOrVideo=function(e){return t.ObjectController.modelIsImage(e)||t.ObjectController.modelIsVideo(e)},i.prototype.modelIsAudioOrVideo=function(e){return t.ObjectController.modelIsVideo(e)||t.ObjectController.modelIsAudio(e)},i.prototype.modelIsMedia=function(e){return t.ObjectController.modelIsImage(e)||t.ObjectController.modelIsVideo(e)||t.ObjectController.modelIsAudio(e)},i.prototype.isPremium=function(){return this._definition.isPremiumSocket()},i.createSocketForModel=function(e,n){var o=t.currentStoryController().get(n).findParent(e);if(o){var r=t.ObjectController.getCardDefinitionForModelObject(o,n);if(r){var a=r.getSocketDefinitions();if(a)for(var s=a.length,l=0;l<s;l++){var c=new i({definition:a[l],parentModelObject:o,parentCardType:r.id,pageId:n});if(c.getModelObject()&&c.getModelObject().id==e.id)return c}}}},i.prototype.socketModelExists=function(e){return void 0!==this.modelObject.getWatchedValue(e)},i.prototype.isSocketContentEmpty=function(e){return t.ObjectController.modelIsEmpty(this.modelObject.getWatchedValue(e),e)},i.prototype.isSocketSupported=function(e){if(this._definition.getModelProperty()===t.SocketModelProperty.LegacyClosedCaption){if(StoryPageEditSettings.BlockAuthoring_ClosedCaption)return!1;if(this._parentModelObject instanceof n.MediaWithTextComposite){var o=this._parentModelObject.getMedia(e);return!!o&&(t.ObjectController.modelIsAudio(this._parentModelObject)&&t.MediaController.isStoryHostedAudio(o,e)||CommonSettings.IsAADUser&&t.ObjectController.modelIsVideo(this._parentModelObject)&&t.MediaController.isStoryHostedVideo(o,e))}}return!0},i.prototype.hasUnsupportedSockets=function(n){if(this._definition.getModelProperty()===t.SocketModelProperty.LegacyBackground){if(!t.ObjectController.modelIsImage(this.modelObject.getWatchedValue(n)))return this.logError("This method should not be called with a non-image type"),!1;var o=this.modelObject.getWatchedValue(n).getText(n);return!t.ObjectController.modelIsEmpty(o,n)}return this._definition.getModelProperty()===t.SocketModelProperty.LegacyLogo&&!e.Model.IsPremiumSway},i.prototype.unsupportedSocketMessage=function(){return this._definition.getModelProperty()===t.SocketModelProperty.LegacyBackground?Resources.CaptionWarning:this._definition.getModelProperty()===t.SocketModelProperty.LegacyLogo?Resources.PremiumCardHiddenInOutputWarning:null},i.prototype.calculateSocketModelObject=function(e){switch(this._definition.getModelProperty()){case t.SocketModelProperty.LegacyBackground:return this.getBackgroundModelObject(e);case t.SocketModelProperty.LegacyCaption:return this.getCaptionModelObject(e);case t.SocketModelProperty.LegacyImage:return this.getMediaModelObject(e);case t.SocketModelProperty.LegacyTitle:return this.getTitleModelObject(e);case t.SocketModelProperty.LegacyAltText:return this.getAltTextModelObject(e);case t.SocketModelProperty.LegacySubtitle:return this.getSubtitleModelObject(e);case t.SocketModelProperty.LegacyAuthor:return this.getAuthorModelObject(e);case t.SocketModelProperty.LegacyClosedCaption:return this.getClosedCaptionContainerModelObject(e);case t.SocketModelProperty.LegacyLogo:return this.getLogoModelObject(e);default:return}},i.prototype.getBackgroundModelObject=function(e){if(this._parentModelObject instanceof n.TitleComposite)return this._parentModelObject.getBackground(e);this.logError("This method should not be called with a non-title type")},i.prototype.setBackgroundModelObject=function(e){this._parentModelObject instanceof n.TitleComposite||this.logError("This method should not be called with a non-title type"),this._parentModelObject.setBackground(e)},i.prototype.addBackgroundModelObject=function(e){this._parentModelObject instanceof n.TitleComposite||this.logError("This method should not be called with a non-title type");var t=this._parentModelObject;t.getBackground()||t.setBackground(e)},i.prototype.getCaptionModelObject=function(e){if(this.modelIsMedia(this._parentModelObject))return this._parentModelObject.getText(e);this.logError("This method should not be called with a non-image or non-video or non-audio type")},i.prototype.setCaptionModelObject=function(e){this.modelIsMedia(this._parentModelObject)||this.logError("This method should not be called with a non-image or non-video or non-audio type"),this._parentModelObject.setText(e)},i.prototype.getMediaModelObject=function(e){if(this.modelIsMedia(this._parentModelObject))return this._parentModelObject.getMedia(e);this.logError("This method should not be called with a non-image or non-video or non-audio type")},i.prototype.getTitleModelObject=function(e){if(this._parentModelObject instanceof n.TitleComposite)return this._parentModelObject.getTitle(e);this.logError("This method should not be called with a non-title type")},i.prototype.setTitleModelObject=function(e){this._parentModelObject instanceof n.TitleComposite||this.logError("This method should not be called with a non-title type"),this._parentModelObject.setTitle(e)},i.prototype.getSubtitleModelObject=function(e){if(this._parentModelObject instanceof n.TitleComposite)return this._parentModelObject.getSubtitle(e);this.logError("This method should not be called with a non-title type")},i.prototype.setSubtitleModelObject=function(e){if(this._parentModelObject instanceof n.TitleComposite||this.logError("This method should not be called with a non-title type"),void 0===this._parentModelObject.setSubtitle)throw StoryApp.RethrowLogger.createError("cannot set subtitle on this object");this._parentModelObject.setSubtitle(e)},i.prototype.getAuthorModelObject=function(e){if(this._parentModelObject instanceof n.TitleComposite)return this._parentModelObject.getAuthor(e);this.logError("This method should not be called with a non-title type")},i.prototype.setAuthorModelObject=function(e){if(this._parentModelObject instanceof n.TitleComposite||this.logError("This method should not be called with a non-title type"),void 0===this._parentModelObject.setAuthor)throw StoryApp.RethrowLogger.createError("cannot set author on this object");this._parentModelObject.setAuthor(e)},i.prototype.getAltTextModelObject=function(e){if(this.modelIsImageOrVideo(this._parentModelObject))return this._parentModelObject.getDescription(e);StoryLog.StructuredTraceTag(596473614,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.error,"This method should not be called with a non-image or non-video type",{parentModelObject:this._parentModelObject?this._parentModelObject.id.toString():"undefined",modelProperty:this._definition.getModelProperty().toString(),isValidModelObject:t.StoryController.isModelObjectValid(this._parentModelObject).toString()})},i.prototype.setAltTextModelObject=function(e){this.modelIsImageOrVideo(this._parentModelObject)?this._parentModelObject.setDescription(e):StoryLog.StructuredTraceTag(596473615,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.error,"This method should not be called with a non-image type",{parentModelObject:this._parentModelObject?this._parentModelObject.id.toString():"undefined",modelProperty:this._definition.getModelProperty().toString(),isValidModelObject:t.StoryController.isModelObjectValid(this._parentModelObject).toString()})},i.prototype.addClosedCaptionModelObject=function(e){if(this.modelIsAudioOrVideo(this._parentModelObject)){var n=this._parentModelObject;StoryLog.StructuredTraceTag(596473617,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Closed caption added",{parentModelObject:n.id.toString(),parentMediaModelObject:n.getMedia().id.toString(),closedCaptionModelObject:e?e.id:"undefined",modelProperty:this._definition.getModelProperty().toString(),isValidModelObject:t.StoryController.isModelObjectValid(n).toString()}),n.closedCaptions.add(e)}else StoryLog.StructuredTraceTag(596473616,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.error,"This method should not be called with a non-media type",{parentModelObject:this._parentModelObject?this._parentModelObject.id.toString():"undefined",modelProperty:this._definition.getModelProperty().toString(),isValidModelObject:t.StoryController.isModelObjectValid(this._parentModelObject).toString()})},i.prototype.removeClosedCaptionModelObjects=function(e){if(this.modelIsAudioOrVideo(this._parentModelObject)){var n=this._parentModelObject,o=e.length,i=e.map(function(e){return e.id}).join(" ,");StoryLog.StructuredTraceTag(21094419,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Closed captions removed",{parentModelObject:n.id.toString(),parentMediaModelObject:n.getMedia().id.toString(),closedCaptionCount:o.toString(),closedCaptionModelObjectIds:i,modelProperty:this._definition.getModelProperty().toString(),isValidModelObject:t.StoryController.isModelObjectValid(n).toString()});for(var r=0;r<o;r++)n.closedCaptions.remove(e[r])}else StoryLog.StructuredTraceTag(596473618,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.error,"This method should not be called with a non-media type",{parentModelObject:this._parentModelObject?this._parentModelObject.id.toString():"undefined",modelProperty:this._definition.getModelProperty().toString(),isValidModelObject:t.StoryController.isModelObjectValid(this._parentModelObject).toString()})},i.prototype.getClosedCaptionContainerModelObject=function(e){},i.prototype.getLogoModelObject=function(e){if(this._parentModelObject instanceof n.TitleComposite)return this._parentModelObject.getLogo(e);this.logError("This method should not be called with a non-title type")},i.prototype.setLogoModelObject=function(e){if(!(this._parentModelObject instanceof n.TitleComposite))throw this.logError("This method should not be called with a non-title type"),StoryApp.RethrowLogger.createError("cannot set logo on this object");this._parentModelObject.setLogo(e)},i.prototype.addLogoModelObject=function(e){this._parentModelObject instanceof n.TitleComposite||this.logError("This method should not be called with a non-title type");var t=this._parentModelObject;t.getLogo()||t.setLogo(e)},i.prototype.logError=function(e){StoryLog.StructuredTraceTag(596473619,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.error,e,{parentModelObject:this._parentModelObject?this._parentModelObject.id.toString():"undefined",modelProperty:this._definition.getModelProperty().toString(),isValidModelObject:t.StoryController.isModelObjectValid(this._parentModelObject).toString()})},i.prototype.createDefaultModel=function(e){var n=t.currentStoryController().get(this.pageId);switch(this._definition.getModelProperty()){case t.SocketModelProperty.LegacyBackground:this.setBackgroundModelObject(t.currentImageController().get(this.pageId).create());break;case t.SocketModelProperty.LegacyCaption:this.setCaptionModelObject(n.createTextGroup());break;case t.SocketModelProperty.LegacyImage:break;case t.SocketModelProperty.LegacyTitle:this.setTitleModelObject(n.createParagraph());break;case t.SocketModelProperty.LegacyAltText:this.setAltTextModelObject(n.createParagraphsWithText(e));break;case t.SocketModelProperty.LegacySubtitle:this.setSubtitleModelObject(n.createParagraph());break;case t.SocketModelProperty.LegacyAuthor:this.setAuthorModelObject(n.createParagraph());break;case t.SocketModelProperty.LegacyClosedCaption:this.addClosedCaptionModelObject(n.createClosedCaptionComposite());break;case t.SocketModelProperty.LegacyLogo:this.addLogoModelObject(void 0);break;default:this.logError("Unknown socket model property")}var o=this.getDefinition().getTelemetryId();null!=o&&ActionLogger.RecordClientAction(new ClientAction.AddSocket(o))},i.prototype.addSocketModelObject=function(e){var n=this._definition.getModelProperty();switch(StoryLog.StructuredTraceTag(596473620,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Adding socket model object:",{parentModelObject:this._parentModelObject?this._parentModelObject.id.toString():"undefined",modelProperty:n.toString(),modelObject:e?e.id.toString():"undefined",isValidModelObject:t.StoryController.isModelObjectValid(this._parentModelObject).toString()}),n){case t.SocketModelProperty.LegacyClosedCaption:this.addClosedCaptionModelObject(e);break;case t.SocketModelProperty.LegacyBackground:this.addBackgroundModelObject(e);break;case t.SocketModelProperty.LegacyLogo:this.addLogoModelObject(e);break;default:StoryLog.StructuredTraceTag(596473621,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.warning,"This method shouldn't be called for unsupported model property",{parentModelObject:this._parentModelObject?this._parentModelObject.id.toString():"undefined",modelProperty:n.toString(),isValidModelObject:t.StoryController.isModelObjectValid(this._parentModelObject).toString()})}var o=this.getDefinition().getTelemetryId();null!=o&&ActionLogger.RecordClientAction(new ClientAction.AddSocket(o))},i.prototype.canAddSocketModelObject=function(e){var o=this._definition.getModelProperty();switch(StoryLog.StructuredTraceTag(596473622,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Information about modelObject:",{parentModelObject:this._parentModelObject?this._parentModelObject.id.toString():"undefined",modelProperty:o.toString(),modelObject:e?e.id.toString():"undefined",isValidModelObject:t.StoryController.isModelObjectValid(this._parentModelObject).toString()}),o){case t.SocketModelProperty.LegacyClosedCaption:return e instanceof n.ClosedCaptionComposite;case t.SocketModelProperty.LegacyBackground:return e instanceof n.MediaWithTextComposite;case t.SocketModelProperty.LegacyLogo:return e instanceof n.MediaWithTextComposite&&e.getMedia()instanceof n.ImageContent;default:return StoryLog.StructuredTraceTag(596473623,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.warning,"This method shouldn't be called for unsupported model property",{parentModelObject:this._parentModelObject?this._parentModelObject.id.toString():"undefined",modelProperty:o.toString(),isValidModelObject:t.StoryController.isModelObjectValid(this._parentModelObject).toString()}),!1}},i.prototype.removeContent=function(e){switch(this._definition.getModelProperty()){case t.SocketModelProperty.LegacyBackground:this.setBackgroundModelObject(void 0);break;case t.SocketModelProperty.LegacyCaption:this.setCaptionModelObject(t.currentStoryController().get(this.pageId).createTextGroup());break;case t.SocketModelProperty.LegacyImage:break;case t.SocketModelProperty.LegacyTitle:this.setTitleModelObject(t.currentStoryController().get(this.pageId).createParagraph());break;case t.SocketModelProperty.LegacyAltText:this.setAltTextModelObject(void 0);break;case t.SocketModelProperty.LegacySubtitle:this.setSubtitleModelObject(void 0);break;case t.SocketModelProperty.LegacyAuthor:this.setAuthorModelObject(void 0);break;case t.SocketModelProperty.LegacyClosedCaption:this.removeClosedCaptionModelObjects(e);break;case t.SocketModelProperty.LegacyLogo:this.setLogoModelObject(void 0);break;default:this.logError("Unknown socket model property")}},i}(Disposable);t.Socket=o}(t.AuthoringModel||(t.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(e){this.args=e,this.cardCapabilities=this.args.cardControlOverrides||{group:!0,groupType:!0,ungroup:!0,focus:!0,emphasis:!0,decorative:!0,record:!0}}return e.prototype.getId=function(){return this.args.id},e.prototype.getTelemetryId=function(){return null!=this.args.telemetryId?this.args.telemetryId:ClientAction.ButtonId.Socket_TestSocket},e.prototype.getTitle=function(){return this.args.title},e.prototype.getDefaultDataType=function(){return this.args.defaultDataType},e.prototype.getPlaceholderText=function(){return this.args.placeholderText},e.prototype.getModelProperty=function(){return this.args.modelProperty},e.prototype.getPlaceholderTextTooltip=function(){return this.args.placeholderTextTooltip},e.prototype.getAuthoringCapabilities=function(){return this.args.authoringCapabilities},e.prototype.getTextPlaceholderText=function(){return this.args.textPlaceholderText},e.prototype.getTextStyle=function(){return this.args.textStyle},e.prototype.isSocketRequired=function(){return this.args.isRequiredSocket},e.prototype.isPremiumSocket=function(){return this.args.isPremiumSocket},e.prototype.shouldShowWhenCollapsed=function(){return this.args.showWhenCollapsed},e.prototype.getHasDefaultContent=function(){return!!this.args.hasDefaultContent},e.prototype.getDefaultActionType=function(){return this.args.defaultActionType},e.prototype.isCaptionSupported=function(){return void 0===this.args.captionSupported||this.args.captionSupported},e.prototype.getCardCapabilities=function(){return this.cardCapabilities},e}();e.SocketDefinition=t}(e.AuthoringModel||(e.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(){}return e.LegacyBackground="Background",e.LegacyTitle="Title",e.LegacyImage="Image",e.LegacyVideo="Video",e.LegacyCaption="Caption",e.LegacyAltText="AltText",e.LegacySubtitle="Subtitle",e.LegacyAuthor="Author",e.LegacyClosedCaption="ClosedCaption",e.LegacyLogo="Logo",e}();e.SocketModelProperty=t}(e.AuthoringModel||(e.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t){var n=e.call(this,t)||this;return n.model=t.model,n}return __extends(t,e),t}(e.Card);e.StatusUpdateCard=t}(e.AuthoringModel||(e.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t){var n=e.call(this,t)||this;return n.model=t.model,n}return __extends(t,e),t}(e.Card);e.TextCard=t}(e.AuthoringModel||(e.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Server.AuthorsManager,o=StoryApp.View.ViewElements,i=function(){function e(e,t){this.sharingManager=t,this.invitePeople=e,this.currentCallId=void 0,this.response=TDB.watchableTag(596132114,this,new o.EntityPickerModel(o.EntityPickerModelState.Initial,[],!1))}return e.prototype.onQueryChanged=function(t,n){var i=this;this.cancelCurrentCall(),t?this.currentCallId=platform.setTimeout(function(){return i.performSearch(t,n)},e.typingTimeout):this.clearSuggestionList(o.EntityPickerModelState.Initial)},e.prototype.cancelCurrentCall=function(){this.currentCallId&&(clearTimeout(this.currentCallId),this.currentCallId=void 0)},e.prototype.performSearch=function(e,t){var n=this;this.currentCallId=void 0,this.clearSuggestionList(o.EntityPickerModelState.Searching);var i=e;this.sharingManager.getSuggestedUsers(CommonSettings.UserTenantId,e,function(e){n.onSuggestedResponse(e,i),t&&t(!0)},function(e,o,r){StoryLog.StructuredTraceTag(596132115,Diag.ULSCat.msoulscat_Story_RequestManager,Diag.ULSTraceLevel.warning,"Service returned an error when requesting suggested people.",{jqXHR:e?JSON.stringify(e):"",textStatus:o||"",errorThrown:r||""}),n.onSuggestedResponse(void 0,i),t&&t(!1)})},e.prototype.onSuggestedResponse=function(e,t){var n=this;if(t==this.invitePeople.peoplePicker.getSelectedList().getInputValue())if(this.verifyResponse(e))this.updateSuggestedPeopleListAndSelectFirst(e);else{var i=[];TDB.applyUpdate(function(){n.response.setValue(new o.EntityPickerModel(o.EntityPickerModelState.Ready,i,!0))})}},e.prototype.clearSuggestionList=function(e){var t=this;TDB.applyUpdate(function(){t.response.setValue(new o.EntityPickerModel(e,[],!0))})},e.prototype.verifyResponse=function(e){return e&&(this.verifyUsers(e)||this.verifyGroups(e))},e.prototype.verifyUsers=function(e){return e.users&&e.users.length>0},e.prototype.verifyGroups=function(e){return e.groups&&e.groups.length>0},e.prototype.updateSuggestedPeopleListAndSelectFirst=function(e){var t=this,n=this.mergeGroupsAndUsers(e);TDB.applyUpdate(function(){n[0].selected.setValue(!0),t.response.setValue(new o.EntityPickerModel(o.EntityPickerModelState.Ready,n,!1))})},e.prototype.getGroupMembers=function(e,t,n){var i=this;this.invitePeople.groupExpandingStarted(),this.sharingManager.getGroupMembers(e.user.getObjectId(),function(r){if(i.verifyResponse(r)){var a=i.mergeGroupsAndUsers(r);i.invitePeople&&i.invitePeople.peoplePicker&&i.invitePeople.peoplePicker.getSelectedList().getGroupMembersAndRemoveGroup(a,e)}else i.clearSuggestionList(o.EntityPickerModelState.Initial);i.invitePeople.groupExpandingFinished(),t.call(n)},function(e,r,a){StoryLog.StructuredTraceTag(596132116,Diag.ULSCat.msoulscat_Story_RequestManager,Diag.ULSTraceLevel.warning,"Service returned an error when requesting group expansion.",{jqXHR:e?JSON.stringify(e):"",textStatus:r||"",errorThrown:a||""}),i.clearSuggestionList(o.EntityPickerModelState.Initial),i.invitePeople.groupExpandingFinished(),t.call(n)})},e.prototype.mergeGroupsAndUsers=function(e){var t,o=this;return t=e.users.map(function(e){return{peoplePicker:o.invitePeople.peoplePicker,user:new n.StoryUserModel(e),selected:TDB.watchableTag(596132117,o.invitePeople.peoplePicker,!1),readerValue:e.givenName+" "+e.surname+" "+e.email}}),CommonSettings.ShareWithSecurityGroupEnabled&&e.groups&&(t=e.groups.map(function(e){return{peoplePicker:o.invitePeople.peoplePicker,user:new n.SecurityGroupModel(e),selected:TDB.watchableTag(596132118,o.invitePeople.peoplePicker,!1),readerValue:e.givenName+" "+e.email,getGroupMembers:o.getGroupMembers,context:o}}).concat(t)),t},e.typingTimeout=500,e}();t.PeoplePickerRequestHandler=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.View.ViewElements,i=function(){function t(e){this.authoringModel=e.authoringModel}return t.prototype.getSupportedExtensions=function(){return StoryApp.Utilities.browser.isSafari&&StoryApp.Utilities.browser.isMobile?"*":StoryPageEditSettings.ClosedCaptionUploadFormats.map(function(e){return"."+e}).join(",")},t.prototype.filesReadyForUpload=function(o){var i=this,r=o[0],a=DocumentIngestion.DocumentIngestionAPI.getFileExtension(r.name);if(StoryLog.StructuredTraceTag(20841154,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Closed caption file ready to upload",{extension:a,size:r.size.toString(),type:r.type}),!ArrayExtensions.contains(StoryPageEditSettings.ClosedCaptionUploadFormats,a))return StoryLog.StructuredTraceTag(596473558,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Closed caption file type not supported",{extension:a}),void e.Model.currentUndoManager().get(this.authoringModel.getPageId()).captureUserUpdate(function(){i.authoringModel.fileUploader.uploadFiles([FileObject.createFromFile(r)],n.ContentProvider[n.ContentProvider.MyDevice])},"User uploaded file which is not closed caption format");if(r.size>StoryPageEditSettings.MaxClosedCaptionSize)return StoryLog.StructuredTraceTag(596473559,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Closed caption file too large",{size:r.size.toString(),limit:StoryPageEditSettings.MaxClosedCaptionSize.toString()}),void t.displaySizeErrorDialog(r.name);var s=new FileReader;s.onload=function(e){var t=e.target.result;i.handleFileLoaded(t,r,i.authoringModel.fileUploader,i.authoringModel.cardDeckVE)},s.onerror=function(e){StoryLog.TraceTag(596473560,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.error,"Error happened while reading closed caption file"),t.displayGenericErrorDialog(r.name)},s.readAsText(r)},t.prototype.handleFileLoaded=function(i,r,a,s){if(!t.validateClosedCaption(i))return StoryLog.TraceTag(596473562,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Closed caption file has invalid header"),void t.displayCorruptedFileErrorDialog(r.name);StoryLog.TraceTag(596473561,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Uploading closed caption file");var l=new Blob([r],{type:t.vttMimeType}),c=FileObject.createFromBlob(l,r.name);e.Model.currentUndoManager().get(this.authoringModel.getPageId()).captureUserUpdate(function(){a.uploadFiles([c],n.ContentProvider[n.ContentProvider.MyDevice])},"User added closed caption");var d=s?s.getActiveCard():void 0;d&&d.isActiveItem()&&d instanceof o.ClosedCaptionSocketVE&&platform.setTimeout(function(){return d.showLanguageDropdown()},50)},t.validateClosedCaption=function(e){return e&&t.vttHeader===e.substr(0,t.vttHeader.length)},t.displaySizeErrorDialog=function(e){var n=ResourceManager.ResolveString(Resources.ClosedCaptionFileSizeTooLargeError,[StoryPageEditSettings.MaxClosedCaptionSize/t.sizeInMB]),o=t.createDialogHtmlContainer(e,n);ErrorDialog.ShowErrorDialog(Resources.UploadModalDialogErrorCaption,Resources.UploadModalDialogErrorMessage,"Closed caption upload: Upload failed, file is too large",null,o)},t.displayCorruptedFileErrorDialog=function(e){var n=t.createDialogHtmlContainer(e,Resources.ClosedCaptionFileCorruptedError);ErrorDialog.ShowErrorDialog(Resources.UploadModalDialogErrorCaption,Resources.UploadModalDialogErrorMessage,"Closed caption upload: Upload failed, file is corrupted",null,n)},t.displayGenericErrorDialog=function(e){var n=t.createDialogHtmlContainer(e,Resources.ClosedCaptionGenericError);ErrorDialog.ShowErrorDialog(Resources.UploadModalDialogErrorCaption,Resources.UploadModalDialogErrorMessage,"Closed caption upload: Upload failed, unknown error",null,n)},t.createDialogHtmlContainer=function(e,t){return new TDB.ChildArgs(o.FailedUploadDialogContentVE,{generalFileError:e,generalErrorMessage:t})},t.sizeInMB=1048576,t.vttHeader="WEBVTT",t.vttMimeType="text/vtt",t}();t.ClosedCaptionUploaderViewModel=i}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=function(t){function n(e,n){var o=t.call(this,e)||this;return o.viewModel=n.viewModel,o}return __extends(n,t),n.prototype.openFilePicker=function(){StoryLog.TraceTag(596473563,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Opening closed caption file picker");var t=this.findFirstNode(function(e){return"INPUT"===e.nodeName});e.View.ViewElements.UploadMediaAction.getInstance().execute(null,{uploadElement:$(t),cardsContainer:this.viewModel.authoringModel.cardDeckVE})},n.prototype.inputFilePickerAutoUploadInitArgs=function(){var e=this;return{filesReadyForUpload:function(t){return e.viewModel.filesReadyForUpload(t)}}},n.prototype.inputFilePickerAttrArgs=function(e){return{accept:this.viewModel.getSupportedExtensions()}},n.prototype.getViewModel=function(){return this.viewModel},n}(TDB.ViewElement);t.ClosedCaptionUploaderVEBase=n}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t;!function(e){e[e.EntryTextbox=1]="EntryTextbox",e[e.PasswordScopeButton=2]="PasswordScopeButton",e[e.PasswordScopeEverybody=3]="PasswordScopeEverybody",e[e.PasswordScopeEditors=4]="PasswordScopeEditors",e[e.SetButton=5]="SetButton",e[e.CancelButton=6]="CancelButton"}(t=e.PasswordManagementDialogTabOrder||(e.PasswordManagementDialogTabOrder={}));var n=function(){function n(n){var o=this;this.sharingManager=n.sharingManager;var i={onEnterClicked:function(){o.setPassword()}},r={dialogWrapperCssClass:{value:"PasswordManagementDialog"},title:Resources.SharingPasswordManagementDialogTitle,description:Resources.SharingPasswordManagementDialogTitle,allowCancel:!0,lightDismiss:!0,dialogLogMessage:"Password Management Dialog",dialogType:StoryApp.View.ViewElements.DialogType.Question,width:500,buttonsArgs:[{caption:{value:Resources.SharingPasswordManagementDialogSetButton},tabIndex:t.SetButton,isDefault:!0,dismissOnAction:!1,onAction:function(e,t){var n=new ClientAction.ButtonClickAction(ClientAction.ButtonId.PasswordManagementDialogSet,Diag.ULSCat.msoulscat_Story_Site);ActionLogger.RecordClientAction(n),o.setPassword()}},{caption:{value:Resources.SharingPasswordManagementDialogCancelButton},tabIndex:t.CancelButton,isDefault:!1,dismissOnAction:!0,isNeutralButton:!0,onAction:function(e,t){var n=new ClientAction.ButtonClickAction(ClientAction.ButtonId.PasswordManagementDialogCancel,Diag.ULSCat.msoulscat_Story_Site);ActionLogger.RecordClientAction(n)}}],contentArgs:new TDB.ChildArgs(e.PasswordManagementDialogContentVE,i,function(e){o.setPasswordDialogContent=e})};this.setPasswordDialog=StoryApp.View.Common.DialogManager.createDialog(r)}return n.prototype.showDialog=function(){StoryApp.View.Common.DialogManager.showDialog(this.setPasswordDialog)},n.createAndShow=function(e){var t=new n(e);return t.showDialog(),t},n.prototype.setPassword=function(){var e=this,t={Password:this.setPasswordDialogContent.getPasswordText(),Scope:this.setPasswordDialogContent.getPasswordScope()};this.setPasswordDialogContent.setLoadingSpinnerVisibility(!0),this.sharingManager.setPassword(StoryPageSettings.LookupId,t,function(){e.setPasswordDialogContent.setLoadingSpinnerVisibility(!1),StoryApp.View.Common.DialogManager.closeCurrentDialog()},function(){e.setPasswordDialogContent.setErrorMessageVisible(!0),e.setPasswordDialogContent.setLoadingSpinnerVisibility(!1)})},n}();e.PasswordManagementDialog=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Server.ContentSourcesManager.ContentSourcesManager,o=e.Model.SM,i=e.View.ViewModel,r=e.Server.Decomposition.WP,a=function(){function e(e,t,n){this.decompositionApi=e,this.embedController=t,this.embedCodeFormatValidator=n}return e.prototype.getEmbedMessageInfo=function(e,t){var n=this.embedController.getNativeContentSource(e);if(null==n)return null;if(!StoryPageEditSettings.AllowEmbedConversionForProviderType[n.providerType.toUpperCase()])return null;if(!this.embedCodeFormatValidator.isEmbedCodeInRightFormatForProvider(e,n.providerType))return null;var o=this.getPrimaryMessage(n);if(!o)return null;var r={url:"javascript:void(0)",click:t,cssClass:{value:"EmbedMessageLink"},text:{value:Resources.EmbedConvertMessageButton},buttonId:ClientAction.ButtonId.Embed_ConvertToNativeCard,context:this};return{context:i.MessageInfoContext.ReadyToConvert,primaryMessage:o,primaryMessageLinkArgs:[r],errorMessage:""}},e.prototype.convertToNativeCard=function(e,a,s,l,c){var d=this.embedController.getNativeContentSource(a);if(!d)return null;if(d.providerType===o.ContentProvider[o.ContentProvider.Twitter]){var u=t.TwitterConverter.generateResponse(a);return u.Status===r.DecompositionStatus[r.DecompositionStatus.Success]?(l(u,d,s),i.ConvertToNativeCardStatus.Converting):(c(),null)}var p=this.embedController.getSearchTerm(a,d);if(!p||""==p)return c(),null;s||(e.activateItem(),platform.setTimeout(function(){return e.setFocus()},10));var g=function(e){l(e,d,s)};return this.decompositionApi.decomposeSearch(p,n.getSearchDescriptor(d),r.RequestLicenseTypeExtensions.getDefaultLicenseType()).then(g,c),i.ConvertToNativeCardStatus.Converting},e.prototype.getPrimaryMessage=function(e){switch(o.ContentProvider[e.providerType]){case o.ContentProvider.Twitter:return Resources.EmbedConvertToTwitterMessageWithPlaceholder;case o.ContentProvider.YouTube:return Resources.EmbedConvertToYouTubeMessageWithPlaceholder;case o.ContentProvider.Giphy:return Resources.EmbedConvertToGiphyMessageWithPlaceholder;default:return StoryLog.TraceTag(596473546,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.warning,"Embed content source "+e.providerType+" is not mapped to a resource string"),null}},e}();t.EmbedCardNativeConverter=a}(t.Common||(t.Common={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(){}return e.prototype.isEmbedCodeInRightFormatForProvider=function(e,t){var n=StoryPageEditSettings.ValidEmbedSrcToConvert[t.toUpperCase()];return!!n&&new RegExp(n,"i").test(e)},e}();e.EmbedCodeFormatValidator=t}(e.Common||(e.Common={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryApp;!function(e){!function(t){!function(t){!function(t){var n=e.Common,o=e.View.ViewElements,i=StoryAppEdit.Model.AuthoringModel,r=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.triggerPreviewEntered=function(){if(CommonSettings.FREEmptySwayEnabled&&i.StoryController.isStoryEmpty(!0)&&r.isUserEnglishLocale())(n.UserState.getInstance().isUserOnFlight(FlightList.EmptySwayPreviewFRE1)||n.UserState.getInstance().isUserOnFlight(FlightList.EmptySwayPreviewFRE2))&&t.FirstRunTriggers.previewEnteredEmptySway(n.UserState.getInstance().isUserOnFlight(FlightList.EmptySwayPreviewFRE1));else if(o.NavigationHelper.hasContentOverflow())switch(StoryAppEdit.Model.StoryModel.traversalModel.getWorldId()){case"VerticalWorld":t.FirstRunTriggers.previewEnteredFromVertical(StoryEditPageMain.ModelHelper.getNumberOfStoryElements());break;case"PanoramaWorld":t.FirstRunTriggers.previewEnteredFromPanorama(StoryEditPageMain.ModelHelper.getNumberOfStoryElements());break;case"ExpoWorld":t.FirstRunTriggers.previewEnteredFromExpo(StoryEditPageMain.ModelHelper.getNumberOfStoryElements())}else StoryEditPageMain.FREHelper.hasContentThreshold()?t.FirstRunTriggers.previewEnteredNoOverflow(StoryEditPageMain.ModelHelper.getNumberOfStoryElements()):t.FirstRunTriggers.previewEnteredNonEmptySway(StoryEditPageMain.ModelHelper.getNumberOfStoryElements())},r.isUserEnglishLocale=function(){return"en-us"===CommonSettings.UserLocaleString},r}(t.StoryFirstRunHelper);t.StoryEditFirstRunHelper=r}(t.FRE||(t.FRE={}))}(t.Common||(t.Common={}))}(e.View||(e.View={}))}(StoryApp||(StoryApp={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Server.Decomposition.WP,o=function(){function e(){}return e.getTweetInfo=function(e){var t={},n=this.getRegExp(),o=n.exec(e);return o?(o.index===n.lastIndex&&n.lastIndex++,t.bodyText=this.parseBodyText(o[1]),t.userName=o[4],t.author=o[2],t.sourceId=o[5],t):{}},e.parseBodyText=function(e){var t=document.implementation.createHTMLDocument("").createElement("div");t.innerHTML=e;var n=t.firstChild;return n?n.textContent:""},e.generateResponse=function(e){var t=new n.DecompositionResponse,o=new n.DecompositionResults,i=this.getTweetInfo(e);if(i.sourceId){var r=new n.ClipPartGroup;r.Type="StatusUpdate",r.ForeignKey=i.sourceId,r.TextParts=this.generateTextParts(i),r.Parts=[],o.PartGroups=[r],o.SharedParts=[],t.Decomposition=o,t.Status=n.DecompositionStatus[n.DecompositionStatus.Success]}else t.Decomposition=o,t.Status=n.DecompositionStatus[n.DecompositionStatus.UnknownFailure];return t},e.generateTextParts=function(e){return[{TextCategory:n.TextCategory.Body,Text:e.bodyText,TextRuns:[]},{TextCategory:n.TextCategory.Author,Text:e.author,TextRuns:[]},{TextCategory:n.TextCategory.UserName,Text:"",TextRuns:[]}]},e.getRegExp=function(){return this.regex||(this.regex=new RegExp(StoryPageEditSettings.ValidEmbedSrcToConvert.TWITTER)),this.regex},e}();t.TwitterConverter=o}(t.Common||(t.Common={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(t,n){void 0===n&&(n=""),this.id=t||e.defaultLanguageId,this.name=e.getLanguageName(t),this.fontSetId=n}return e.prototype.getId=function(){return this.id},e.prototype.getName=function(){return this.name},e.prototype.getFontSetId=function(){return this.fontSetId},e.prototype.isRtl=function(){return!!this.id&&ArrayExtensions.contains(e.rtlLanguages,this.id.toLowerCase())},e.getLanguageName=function(t){if(t){var n=t.toLowerCase().replace(new RegExp("-","g"),"_")||"en_us";return Resources[e.defaultLanguageNamePrefix+n]}},e.defaultLanguageId="en-US",e.defaultLanguageNamePrefix="Language_",e.rtlLanguages=["ar-sa","fa-ir","he-il"],e}();e.Language=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=e.View.ViewElements,r=function(){function e(e){this.pageId=e}return e.prototype.validate=function(e){if(!(e instanceof i.MediaCardVE))return!1;var t=e.getViewModel().getModel(),n=o.currentStoryController().get(this.pageId).findParent(t);if(!o.StoryController.isModelObjectValid(t)||!o.StoryController.isModelObjectValid(n))return!1;var r=e.getTextEditorElement(),a=r?r.textContent:"";return o.MediaController.isMediaEmpty(t.getMedia())&&this.isValidGroupingConfiguration(n)&&!!o.currentEmbedController().get(this.pageId).resembleIframeCode(a)},e.prototype.isValidGroupingConfiguration=function(e){return(e instanceof n.Set||e instanceof n.SpecifiedGroup)&&e.getVisualization()===n.Visualization.Auto},e}();t.MediaCardToEmbedCardConversionValidator=r}(t.Common||(t.Common={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(n){var o=e.Model.AuthoringModel,i=function(){function n(){}return n.prototype.convert=function(t,n){if(StoryPageEditSettings.MediaCardToEmbedCardConversionEnabled){var i,r,a=t.getTextEditorElement().textContent.trim();return e.Model.currentUndoManager().get(n).captureUserUpdate(function(){var e=o.currentEmbedController().get(n).createEmbedCard();return e&&e.model&&t&&t.cardsContainer?(t.cardsContainer.addCardObjects([e]),t.remove("Deleting media card due to embed card conversion"),i=t.cardsContainer.getCardForModelId(e.model.id),(r=i.getViewModel())&&r.setEmbedCode(a),{activeModelObjectIds:[e.model.id]}):{activeModelObjectIds:void 0}},"Converting a media card to an embed card"),this.logConversion(t,a,n),{embedCardVm:r,embedCardVe:i}}},n.prototype.logConversion=function(e,n,i){var r=t.ViewElements.CardType[e.cardType],a=o.currentEmbedController().get(i).getIframeHost(n).replace(/^WWW\./,"");StoryLog.StructuredTraceTag(596464462,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,'Media Card to Embed Card Conversion: Convert media card to embed card of the host "'+a+'"',{OriginalCardType:r,IFrameHost:a}),ActionLogger.RecordClientAction(new ClientAction.StorylineActionData(ClientAction.ActionType.Storyline_Media_ConvertedToEmbed,"Media card converted to embed card",[e.getModelObjectId()],[r]))},n}();n.MediaCardToEmbedCardConverter=i}(t.Common||(t.Common={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(n){function o(t,o){var i=n.call(this,t,{features:TDB.ControlSetFeatures.VerticalList})||this;return i.parent=t,i._parent=t,i.buttons=[],i.addButton(e.PasswordManagementDialogTabOrder.PasswordScopeEverybody,StoryApp.Common.PasswordHelper.getTextForPasswordScope(StoryApp.Common.StoryPasswordScope.Everybody),function(e){return i.setPasswordScope(StoryApp.Common.StoryPasswordScope.Everybody),i.hide(),i.parent.audienceButton.setFocus(),TDB.EventPropagation.Bypass}),i.addButton(e.PasswordManagementDialogTabOrder.PasswordScopeEditors,StoryApp.Common.PasswordHelper.getTextForPasswordScope(StoryApp.Common.StoryPasswordScope.Editors),function(e){return i.setPasswordScope(StoryApp.Common.StoryPasswordScope.Editors),i.hide(),i.parent.audienceButton.setFocus(),TDB.EventPropagation.Bypass}),i}return __extends(o,n),o.prototype.setPasswordScope=function(e){this._parent.setPasswordScope(e)},o.prototype.addButton=function(e,t,n){var o={tabIndex:e,context:this._parent,buttonId:ClientAction.ButtonId.PasswordAudienceFlyout,text:{value:t},cssClass:{value:"PasswordAudienceFlyoutButton"},click:n};this.buttons.push(o)},o.prototype.wrapperSlideVisibleInitArgs=function(){return!1},o.prototype.wrapperSlideVisibleArgs=function(e){return{visible:e.watchValue(this.visible)}},o.prototype.buttonsArgs=function(){return this.buttons.map(function(e){return new TDB.ChildArgs(t.TextButtonVE,e)})},o}(StoryApp.View.ViewElements.PopupBaseVE);e.PasswordAudienceFlyoutVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(n){function o(e,t){var o=n.call(this,e,t)||this;return o.audienceFlyoutVisible=TDB.watchable(o,!1),o.passwordScope=TDB.watchable(o,StoryApp.Common.StoryPasswordScope.Everybody),o}return __extends(o,n),o.prototype.audienceTypeButtonArgs=function(){var n=this,o={tabIndex:e.PasswordManagementDialogTabOrder.PasswordScopeButton,buttonId:ClientAction.ButtonId.PasswordManagementDialogAudience,context:this,cssClass:{value:"PasswordAudienceButton"},textClass:"PasswordAudienceButtonText",description:{compute:new TDB.ComputedOptionArgs(this,this.getPasswordScopeText)},fontIconName:{value:FontIcons.DropdownChevronIcon},fontIconSizeClass:FontIcons.DropdownChevronIconSize,text:{compute:new TDB.ComputedOptionArgs(this,this.getPasswordScopeText)},click:function(e){return n.audienceTypeFlyout.toggle(),TDB.EventPropagation.Bypass},textPlacementLeft:!0};return new TDB.ChildArgs(t.GlyphButtonVE,o)},o.prototype.getPasswordScopeText=function(e){return StoryApp.Common.PasswordHelper.getTextForPasswordScope(this.passwordScope.getWatchedValue(e))},o.prototype.audienceTypeFlyoutArgs=function(){var t={visible:this.audienceFlyoutVisible};return new TDB.ChildArgs(e.PasswordAudienceFlyoutVE,t)},o.prototype.setPasswordScope=function(e){var t=this;TDB.applyUpdate(function(){t.passwordScope.setValue(e)})},o.prototype.getPasswordScope=function(){return this.passwordScope.getValue()},o.prototype.passwordTextBoxArgs=function(){var n={context:this,description:Resources.PasswordManagementTextboxDescription,placeholder:{value:Resources.SharingPasswordManagementDialogPlaceholder},cssClass:"PasswordInput",inputType:"password",autocomplete:!1,selectTextOnFocus:!0,textWatchable:this.passwordTextBoxText,tabIndex:e.PasswordManagementDialogTabOrder.EntryTextbox,handleKeyDown:this.handleTextBoxEnter,maxLength:StoryApp.Common.PasswordHelper.MaxPasswordLength};return new TDB.ChildArgs(t.TextBoxVE,n)},o.prototype.errorMessageTextArgs=function(e){return Resources.SharingPasswordManagementDialogRequirements},o.prototype.narratorMessageTextArgs=function(e){return this.errorMessageVisible.getWatchedValue(e)?Resources.SharingPasswordManagementDialogRequirements:""},o}(t.CommonPasswordDialogContentVEBase);e.PasswordManagementDialogContentVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(t){this.mediaStream=t.stream,this.resourceFactory=t.resourceFactory,e.audioContext||(e.audioContext=new AudioContext);var n=e.audioContext.createMediaStreamSource(t.stream);this.tryLoadingRecorder().then(function(){window.Recorder(n,{workerPath:CommonSettings.NoCdnContentBaseUrl+"recorderworker.js"})})}return e.prototype.dispose=function(){var e=this;this.tryLoadingRecorder().then(function(){e.stopRecording(),e.clearRecording()})},e.prototype.startRecording=function(){return this.tryLoadingRecorder().then(function(){window.record()})},e.prototype.pauseRecording=function(){return this.tryLoadingRecorder().then(function(){window.stop()})},e.prototype.stopRecording=function(){var e=this;return this.tryLoadingRecorder().then(function(){window.stop(),e.mediaStream.getAudioTracks()[0].stop(),window.node.disconnect()})},e.prototype.exportWAV=function(t){return this.tryLoadingRecorder().then(function(){window.exportWAV(t,e.exportType)})},e.prototype.clearRecording=function(){return this.tryLoadingRecorder().then(function(){window.clear()})},e.prototype.tryLoadingRecorder=function(){var e=$.Deferred();return this.resourceFactory.loadResource(18).then(function(t){0===t.state&&e.resolve()}),e.promise()},e.exportType="audio/wav",e}();e.Recorder=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){function n(){return StoryLog.TraceTag(20775329,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Recording cancelation prompt triggered"),Resources.RecordingDialogDismissPrompt}var o,i=StoryApp.View.ViewElements,r=StoryApp.Model.RM;!function(e){e[e.Preparing=0]="Preparing",e[e.Recording=1]="Recording",e[e.Finished=2]="Finished"}(o=t.RecordingDialogState||(t.RecordingDialogState={})),t.RecordingErrors={DevicesNotFoundError:{errorString:Resources.RecordingMicrophoneNotPresentError,logString:"Recording error: Microphone not present"},NotFoundError:{errorString:Resources.RecordingMicrophoneNotPresentError,logString:"Recording error: Microphone not present"},NotAllowedError:{errorString:Resources.RecordingMicrophoneNotAllowedError,logString:"Recording error: Microphone blocked"},SecurityError:{errorString:Resources.RecordingMicrophoneNotAllowedError,logString:"Recording error: Microphone blocked"},PermissionDeniedError:{errorString:Resources.RecordingMicrophoneNotAllowedError,logString:"Recording error: Microphone blocked"}},t.unloadEventHandler=n;var a=function(t){function a(e,n){var i=t.call(this,e,TDB.ControlSetFeatures.Isolated|TDB.ControlSetFeatures.AutoEnter|TDB.ControlSetFeatures.PreserveFocusContext)||this;return i.authoringModel=n.authoringModel,i.isCountdown=TDB.watchableTag(596473502,i,!1),i.dialogState=TDB.watchableTag(596473503,i,o.Preparing),i.countdown=TDB.watchableTag(596473504,i,a.countdownStart),i.recording=TDB.watchableTag(596473505,i,!1),i.recordingDuration=TDB.watchableTag(596473506,i,0),i.descriptor=TDB.watchableTag(596473507,i,""),i.recordingCard=n.card,i.recordedBlob=$.Deferred(),i.resourceFactory=n.resourceFactory,i.countdownTimer=new StoryApp.Common.Timer({numberOfTicks:a.countdownStart,tickInterval:a.countdownInterval,tickCallback:i.decrementCountdown,context:i}),i.durationTimer=new StoryApp.Common.Timer({numberOfTicks:0,tickInterval:a.countdownInterval,tickCallback:i.incrementDuration,context:i}),i.waitForCountdown(a.getReadyDuration),i.recorder=n.recorder,i.addResource(i.recorder),i}return __extends(a,t),a.prototype.waitForCountdown=function(e){var t=this;this.waitForCountDownTimeout=platform.setTimeout(function(){TDB.applyUpdate(function(){t.isCountdown.setValue(!0)}),t.countdownTimer.startTimer()},e)},a.prototype.recordingDialogWrapperStyleArgs=function(e){var t=Math.ceil(2*(a.allPaddingsWidth+this.getWidestString())),n=this.dialogState.getWatchedValue(e)===o.Finished;return{width:n?"auto":t.toString()+"px",display:n?"flex":"inline-block"}},a.prototype.closeButtonArgs=function(e){var t={buttonId:ClientAction.ButtonId.RecordingDialog_Close,click:this.closeButtonClicked,context:this,cssClass:{value:"recordingDialogCloseButton"},description:{value:Resources.ButtonClose},fontIconName:{value:FontIcons.RecordingDialogCloseIcon},fontIconSizeClass:FontIcons.RecordingDialogCloseIconSize};return new TDB.ChildArgs(i.GlyphButtonVE,t)},a.prototype.closeButtonClicked=function(e){return StoryLog.TraceTag(596473536,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Recording dialog close button clicked"),this.countdownTimer.stopTimer(),clearTimeout(this.waitForCountDownTimeout),this.authoringModel.hideRecordingDialog(),e.stopPropagation(),e.preventDefault(),TDB.EventPropagation.Bypass},a.prototype.decrementCountdown=function(){var e=this;TDB.applyUpdate(function(){e.countdown.setValue(e.countdown.getValue()-a.countdownInterval/1e3),0===e.countdown.getValue()&&(e.dialogState.setValue(o.Recording),e.durationTimer.startTimer(),e.recording.setValue(!0),e.recorder.startRecording(),StoryApp.Utilities.addUnloadEventListener(n,!1),StoryApp.Common.Environment.getInstance().addBeforeNavigationHandler(a.displayDismissWarningDialog),a.currentRecordingDialog=e,StoryLog.TraceTag(20525718,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Recording started"))})},a.prototype.countdownTextArgs=function(e){return this.isCountdown.getWatchedValue(e)?this.countdown.getWatchedValue(e).toString():Resources.RecordingDialogPreparationMessage},a.prototype.countdownCssArgs=function(e){var t=this.isCountdown.getWatchedValue(e);return{recordingDialogGetReady:!t,recordingDialogCountdown:t}},a.prototype.recordingDialogArgs=function(e){return this.dialogState.getWatchedValue(e)},a.prototype.outerCircleCssArgs=function(e){return{stopButtonCircleAnimationPaused:!this.recording.getWatchedValue(e)}},a.prototype.innerCircleCssArgs=function(e){return{stopButtonCircleAnimationPaused:!this.recording.getWatchedValue(e)}},a.prototype.stopButtonArgs=function(e){var t={buttonId:ClientAction.ButtonId.RecordingDialog_StopRecording,click:this.stopButtonClicked,context:this,cssClass:{value:"recordingDialogStopButton"},description:{value:Resources.RecordingDialogStopButtonDescription},fontIconName:{value:FontIcons.RecordingDialogStopButtonIcon},fontIconSizeClass:FontIcons.RecordingDialogStopButtonIconSize};return new TDB.ChildArgs(i.GlyphButtonVE,t)},a.prototype.stopButtonClicked=function(e){var t=this;return StoryLog.StructuredTraceTag(20525719,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Recording stop button clicked",{totalDuration:this.recordingDuration.getValue().toString()}),this.recorder.stopRecording(),this.durationTimer.stopTimer(),this.exportToWAV(),TDB.applyUpdate(function(){t.dialogState.setValue(o.Finished)}),TDB.EventPropagation.PreventDefault},a.prototype.recordingDurationTextArgs=function(e){return i.AudioLayoutVEBase.formatTime(this.recordingDuration.getWatchedValue(e),!1,":")+" / "+i.AudioLayoutVEBase.formatTime(a.maximumRecordingDuration,!1,":")},a.prototype.incrementDuration=function(){var e=this;this.recording.getValue()&&TDB.applyUpdate(function(){if(e.recordingDuration.setValue(e.recordingDuration.getValue()+1),e.recordingDuration.getValue()===a.maximumRecordingDuration){var t=i.NotificationBarViewModel.getNotificationBar(i.ViewModel.getViewElement()),n=[{text:ResourceManager.ResolveString(Resources.RecordingTimeLimitExceededError,[a.maximumRecordingDuration/60])}];t.addNotification({messages:n,notificationSource:i.NotificationSource.Recording,notificationType:i.NotificationType.Warning,showInConsumptionView:!1},!1,!0),StoryLog.TraceTag(20570570,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Recording time limit exceeded!"),e.durationTimer.stopTimer(),e.recording.setValue(!1),e.recorder.stopRecording(),e.exportToWAV(),e.dialogState.setValue(o.Finished)}})},a.prototype.pauseButtonArgs=function(e){var t={buttonId:ClientAction.ButtonId.RecordingDialog_PauseRecording,click:this.pauseButtonClicked,context:this,cssClass:{compute:new TDB.ComputedOptionArgs(this,this.pauseButtonCssClassArgs)},description:{compute:new TDB.ComputedOptionArgs(this,this.pauseButtonDescriptionArgs)},fontIconName:{value:FontIcons.RecordingDialogPauseButtonIcon},fontIconSizeClass:FontIcons.RecordingDialogPauseButtonIconSize,text:{compute:new TDB.ComputedOptionArgs(this,this.pauseButtonDescriptionArgs)},textClass:"recordingDialogButtonText"};return new TDB.ChildArgs(i.GlyphButtonVE,t)},a.prototype.pauseButtonClicked=function(e){var t=this;return StoryLog.TraceTag(596473537,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Recording pause button clicked"),this.recording.getValue()?this.recorder.pauseRecording():this.recorder.startRecording(),TDB.applyUpdate(function(){t.recording.setValue(!t.recording.getValue())}),TDB.EventPropagation.PreventDefault},a.prototype.pauseButtonDescriptionArgs=function(e){return this.recording.getWatchedValue(e)?Resources.RecordingDialogPauseButtonDescription:Resources.RecordingDialogResumeButtonDescription},a.prototype.pauseButtonCssClassArgs=function(e){return this.recording.getWatchedValue(e)?"recordingDialogPauseButton":"recordingDialogResumeButton"},a.prototype.addToSwayButtonArgs=function(e){var t={buttonId:ClientAction.ButtonId.RecordingDialog_AddToSway,click:this.addToSwayButtonClicked,context:this,cssClass:{value:"recordingDialogAddButton"},description:{value:Resources.RecordingDialogAddButtonDescription},fontIconName:{value:FontIcons.RecordingDialogAddToSwayButtonIcon},fontIconSizeClass:FontIcons.RecordingDialogAddToSwayButtonIconSize,text:{value:Resources.RecordingDialogAddButtonDescription},textClass:"recordingDialogButtonText"};return new TDB.ChildArgs(i.GlyphButtonVE,t)},a.prototype.addToSwayButtonClicked=function(e){var t=this;return StoryLog.StructuredTraceTag(20715677,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Recording dialog add to Sway button clicked",{storyId:StoryPageSettings.StoryId}),this.recordingCard&&this.recordingCard.getPlaceholderCard()&&this.authoringModel.cardDeckVE.setActivePlaceholder(this.recordingCard.getPlaceholderCard()),this.recordedBlob.then(function(e){t.uploadRecording(e)}),this.authoringModel.hideRecordingDialog(),TDB.EventPropagation.PreventDefault},a.prototype.uploadRecording=function(t){var n=this;t?e.Model.currentUndoManager().get(this.pageId).captureUserUpdate(function(){var e=(new Date).toLocaleString(CommonSettings.UserLocaleString,{day:"numeric",month:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}),o=FileObject.createFromBlob(t,ResourceManager.ResolveString(Resources.RecordingFileName,[e,a.fileExtension]));n.authoringModel.fileUploader.uploadFiles([o])},"Add recording to Sway"):StoryLog.TraceTag(596473538,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.warning,"Recorder attempted upload of undefined blob!"),this.recorder.clearRecording()},a.prototype.recordingDialogPlayerArgs=function(e){var t={parent:this,id:this.id,descriptor:this.getAudioPlayerDescriptor(e),playButtonClickCallback:void 0,hideVolumeControl:!1,preload:!0,resourceFactory:this.resourceFactory};return new TDB.ChildArgs(i.AudioControlsVE,t)},a.prototype.getAudioPlayerDescriptor=function(e){return this.descriptor.getWatchedValue(e)},a.prototype.getAudioPlayerType=function(){return r.AudioPlayerType.Browser},a.prototype.reRecordButtonArgs=function(e){var t={buttonId:ClientAction.ButtonId.RecordingDialog_ReRecord,click:this.reRecordButtonClicked,context:this,cssClass:{value:"recordingDialogReRecordButton"},description:{value:Resources.RecordingDialogReRecordButtonDescription},fontIconName:{value:FontIcons.RecordingDialogReRecordButtonIcon},fontIconSizeClass:FontIcons.RecordingDialogReRecordButtonIconSize,text:{value:Resources.RecordingDialogReRecordButtonDescription},textClass:"recordingDialogButtonText"};return new TDB.ChildArgs(i.GlyphButtonVE,t)},a.prototype.reRecordButtonClicked=function(e){var t=this;StoryLog.TraceTag(20570571,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Re-record button clicked");var n={title:Resources.RecordingDialogReRecordTitle,description:Resources.RecordingDialogReRecordTitle,noFocus:!1,dialogType:StoryApp.View.ViewElements.DialogType.Question,lightDismiss:!0,messages:[Resources.RecordingDialogReRecordPrompt],buttonsArgs:[{caption:{value:Resources.RecordingDialogConfirm},isDefault:!0,onAction:function(){t.resetRecording()},id:"yes"},{caption:{value:Resources.RecordingDialogDecline},isDefault:!1,onAction:function(){},id:"no"}]};return StoryApp.View.Common.DialogManager.createAndShow(n),TDB.EventPropagation.PreventDefault},a.prototype.resetRecording=function(){this.authoringModel.hideRecordingDialog(),this.authoringModel.showRecordingDialog(this.recordingCard)},a.prototype.deleteButtonArgs=function(e){var t={buttonId:ClientAction.ButtonId.RecordingDialog_Delete,click:this.deleteButtonClicked,context:this,cssClass:{value:"recordingDialogDeleteButton"},description:{value:Resources.RecordingDialogDeleteButtonDescription},fontIconName:{value:FontIcons.RecordingDialogDeleteButtonIcon},fontIconSizeClass:FontIcons.RecordingDialogDeleteButtonIconSize};return new TDB.ChildArgs(i.GlyphButtonVE,t)},a.prototype.deleteButtonClicked=function(e){var t=this;StoryLog.TraceTag(20715679,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Recording dialog delete button clicked");var n={title:Resources.RecordingDialogDeleteTitle,description:Resources.RecordingDialogDeleteTitle,noFocus:!1,dialogType:StoryApp.View.ViewElements.DialogType.Question,lightDismiss:!0,messages:[Resources.RecordingDialogDeletePrompt],buttonsArgs:[{caption:{value:Resources.RecordingDialogConfirm},isDefault:!0,onAction:function(){t.recorder.clearRecording(),t.authoringModel.hideRecordingDialog()},id:"yes"},{caption:{value:Resources.RecordingDialogDecline},isDefault:!1,onAction:function(){},id:"no"}]};return StoryApp.View.Common.DialogManager.createAndShow(n),TDB.EventPropagation.PreventDefault},a.prototype.exportToWAV=function(){var e=this;this.recordedBlob=$.Deferred(),StoryLog.TraceTag(596473539,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Recording export started"),this.exportStartTime=Date.now(),this.recorder.exportWAV(function(t){TDB.applyUpdate(function(){e.descriptor.setValue(window.URL.createObjectURL(t))}),StoryLog.StructuredTraceTag(20715681,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Recording export finished",{exportDuration:(Date.now()-e.exportStartTime).toString()}),e.recordedBlob.resolve(t)})},a.prototype.getWidestString=function(){var e=UX.getTextWidth(Resources.RecordingDialogResumeButtonDescription,a.textFont)+a.iconAndMarginWidth,t=UX.getTextWidth(Resources.RecordingDialogPauseButtonDescription,a.textFont)+a.iconAndMarginWidth,n=UX.getTextWidth(a.durationFormat,a.textFont);return Math.max(n,Math.max(t,e))},a.prototype.dismissRecordingDialog=function(){this.exit(),t.prototype.dismiss.call(this),StoryApp.Utilities.removeUnloadEventListener(n),a.currentRecordingDialog=void 0},a.isCurrentlyRecording=function(){return!!a.currentRecordingDialog},a.displayDismissWarningDialog=function(e,t){if(a.isCurrentlyRecording()){var n={title:Resources.RecordingDialogDismissPromptTitle,description:Resources.RecordingDialogDismissPromptTitle,noFocus:!1,dialogType:StoryApp.View.ViewElements.DialogType.Question,lightDismiss:!0,messages:[Resources.RecordingDialogDismissPrompt],buttonsArgs:[{caption:{value:Resources.RecordingDialogDismissStay},isDefault:!0,onAction:function(e,t){},id:"stay"},{caption:{value:Resources.RecordingDialogDismissLeave},isDefault:!1,onAction:function(n,o){a.currentRecordingDialog.dismissRecordingDialog(),t.call(e)},id:"leave"}]};return!!StoryApp.View.Common.DialogManager.createAndShow(n)}return!1},a.currentRecordingDialog=void 0,a.getReadyDuration=2e3,a.countdownStart=3,a.countdownInterval=1e3,a.maximumRecordingDuration=300,a.textFont="13px Segoe UI",a.iconAndMarginWidth=28,a.allPaddingsWidth=74,a.durationFormat="00:00 / 00:00",a.fileExtension=".wav",a}(i.RegionPopupVE);t.RecordingDialogVEBase=a}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t;!function(e){e[e.View=0]="View",e[e.Edit=1]="Edit"}(t=e.InvitationType||(e.InvitationType={}));var n=function(){function e(e){this.enabled=e.enabled,this.sharingManager=e.sharingManager,this.authorsManager=e.authorsManager,this.selectedInvitationType=TDB.watchableTag(596132109,this,t.View),this.showLinkTypeSelector=e.showLinkTypeSelector}return e.prototype.getEnabledWatchable=function(){return this.enabled},e.prototype.getSharingManager=function(){return this.sharingManager},e.prototype.getAuthorsManager=function(){return this.authorsManager},e.prototype.getSelectedInvitationType=function(e){return this.selectedInvitationType.getWatchedValue(e)},e.prototype.getSelectedInvitationTypeWatchable=function(){return this.selectedInvitationType},e.prototype.setSelectedInvitationType=function(e){var t=this;TDB.applyUpdate(function(){t.selectedInvitationType.setValue(e)})},e}();e.InvitePeopleViewModel=n}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(e){this.enabled=e.enabled,this.sharingManager=e.sharingManager}return e.prototype.getEnabledWatchable=function(){return this.enabled},e.prototype.getSharingManager=function(){return this.sharingManager},e.prototype.canBlockSharing=function(e){return CommonSettings.IsPaidUser&&StoryPageEditSettings.BlockShareButtonFeatureEnabled},e.prototype.canManagePassword=function(e){return CommonSettings.IsPaidUser&&CommonSettings.PasswordProtectedSwaysEnabled&&StoryPageSettings.IsOwner},e}();e.ShareMoreOptionsViewModel=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=StoryApp.Common,o=function(){function e(e){this.enabled=e.enabled,this.sharingManager=e.sharingManager,this.selectedInvitationType=e.selectedInvitationType,this.titleWatcher=e.titleWatcher,this.showEmbedButton=e.showEmbedButton}return e.prototype.getEnabledWatchable=function(){return this.enabled},e.prototype.getSharingManager=function(){return this.sharingManager},e.prototype.getSelectedInvitationType=function(e){return this.selectedInvitationType.getWatchedValue(e)},e.prototype.getVisualLinkViewModel=function(){return new StoryApp.View.ViewModel.VisualLinkViewModel({lookupId:StoryPageSettings.LookupId,urlHelper:n.UrlHelper.getInstance(),sharingManager:this.sharingManager,useCDN:StoryPageSettings.UseCDN,urlParameterButtonLocation:n.SharingButtonLocations.Edit})},e.prototype.shareToFacebook=function(){var e=StoryPageSettings.LookupId;t.StoryShareAction.shareToFacebook(e,n.SharingButtonLocations.Edit,ClientAction.ButtonId.ShareDropdown_SocialFacebook,this.sharingManager)},e.prototype.shareToTwitter=function(){var e=StoryPageSettings.LookupId;t.StoryShareAction.shareToTwitter(e,!0,n.SharingButtonLocations.Edit,ClientAction.ButtonId.ShareDropdown_SocialTwitter,this.sharingManager,this.titleWatcher.getValue())},e.prototype.shareToLinkedIn=function(){t.StoryShareAction.shareToLinkedIn(StoryPageSettings.LookupId,n.SharingButtonLocations.Edit,ClientAction.ButtonId.ShareDropdown_SocialLinkedIn,this.sharingManager,this.titleWatcher.getValue())},e.prototype.shareEmbed=function(){t.StoryShareAction.embed(StoryPageSettings.LookupId,StoryPageSettings.EmbedCode)},e}();e.ShareButtonsViewModel=o}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){e[e.Edit=0]="Edit",e[e.Consumption=1]="Consumption"}(e.ShareDropdownContext||(e.ShareDropdownContext={}));var t=function(){function t(e){var t=this;this.args=e,this.sharingManager=e.sharingManager,this.authorsManager=e.authorsManager,this.narratorMessage=TDB.watchableTag(596132104,this,""),this.initializeViewModels(),this.authorsManager&&platform.setImmediate(function(){return t.authorsManager.refreshStoryUsers()})}return t.prototype.initializeViewModels=function(){this.invitePeopleViewModel=new e.InvitePeopleViewModel({enabled:this.args.shareEnabled,sharingManager:this.sharingManager,authorsManager:this.authorsManager,showLinkTypeSelector:this.args.showLinkTypeSelector}),this.shareButtonsViewModel=new e.ShareButtonsViewModel({enabled:this.args.shareEnabled,sharingManager:this.sharingManager,selectedInvitationType:this.invitePeopleViewModel.getSelectedInvitationTypeWatchable(),titleWatcher:this.args.titleWatcher,showEmbedButton:this.args.showEmbedButton}),this.shareMoreOptionsViewModel=new e.ShareMoreOptionsViewModel({enabled:this.args.shareEnabled,sharingManager:this.sharingManager})},t.prototype.getContext=function(){return this.args.context},t.prototype.getSharingManager=function(){return this.sharingManager},t.prototype.getAuthorsManager=function(){return this.authorsManager},t.prototype.getInvitePeopleViewModel=function(){return this.invitePeopleViewModel},t.prototype.getShareButtonsViewModel=function(){return this.shareButtonsViewModel},t.prototype.getShareMoreOptionsViewModel=function(){return this.shareMoreOptionsViewModel},t.prototype.isEnabled=function(e){return this.args.shareEnabled.getWatchedValue(e)},t.prototype.getNarratorMessage=function(e){return this.narratorMessage.getWatchedValue(e)},t.prototype.setNarratorMessage=function(e){var t=this;TDB.applyUpdate(function(){t.narratorMessage.setValue(e)})},t.prototype.shouldShowSpinnerForLists=function(e){return this.args.authorsManager.isRequestInProgress(e)&&!this.args.authorsManager.getCurrentSwspUserRequest(e)},t}();e.ShareDropdownViewModel=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=StoryApp.Common,o=function(e){function o(t){var n=e.call(this,t,{features:TDB.ControlSetFeatures.TabInto||TDB.ControlSetFeatures.TabDisabled})||this;return n.copyButtonClicked=TDB.watchableTag(596132067,n,!1),n}return __extends(o,e),o.prototype.messsageTextArgs=function(e){return Resources.SharedSwayDialogContentMessage},o.prototype.linkTextArgs=function(e){return n.UrlHelper.getInstance().trackedShareLinkUrl(StoryPageSettings.LookupId,"",n.SharingButtonLocations.Swsp)},o.prototype.copyLinkArgs=function(){var e=this;if(n.TextCopyHelper.isCopySupported()){var o={buttonId:ClientAction.ButtonId.ShareDropdown_CopyShareLinkDialogButton,click:this.onCopyLinkClick,context:this,cssClass:{value:"sharedSwayContentDialogCopyLink"},text:{compute:new TDB.ComputedOptionArgs(this,function(t){return e.copyButtonClickText(t)})},id:"sharedSwayContentDialogCopyLink"};return new TDB.ChildArgs(t.TextButtonVE,o)}},o.prototype.copyButtonClickText=function(e){return this.copyButtonClicked.getWatchedValue(e)?Resources.SharedSwayDialogContentCopiedButton:Resources.SharedSwayDialogContentCopyButton},o.prototype.onCopyLinkClick=function(e){var t=this;return this.copyButtonClicked.getValue()||(TDB.applyUpdate(function(){return t.copyButtonClicked.setValue(!0)}),n.TextCopyHelper.copyHTMLText($("#sharedSwayContentDialogLink")[0],$("#sharedSwayContentDialogCopyLink")[0])),TDB.EventPropagation.Bypass},o.prototype.mouseClicked=function(e){return TDB.EventPropagation.PreventDefault},o.prototype.accessibilityMessageTextArgs=function(e){return this.copyButtonClicked.getWatchedValue(e)?Resources.ContextMenuCopyLinkButtonCalloutReader:void 0},o}(TDB.ControlSet);e.SharedSwayDialogContentVEBase=o}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t,n=StoryApp.View.ViewElements;!function(e){e[e.Click=0]="Click",e[e.Hover=1]="Hover"}(t=e.StoryUserPopupOpenType||(e.StoryUserPopupOpenType={}));var o=function(){function e(e,t){this.popup=e,this.openType=t}return e}();e.StoryUserCurrentOpenedPopup=o;var i=function(o){function i(e,t){var n=o.call(this,e,{features:TDB.ControlSetFeatures.Isolated,getControllingElement:t.getControllingElement})||this;return n.leftOffset=TDB.watchableTag(596132066,n,0),n.args=t,n}return __extends(i,o),i.prototype.wrapperAttrArgs=function(){var e={};return e[Aria.Attributes.Role]=Aria.Roles.Group,e[Aria.Attributes.Id]=this.args.domId,e},i.prototype.wrapperStyleArgs=function(e){return{marginLeft:StoryApp.Utilities.toPxStr(this.leftOffset.getWatchedValue(e))}},i.prototype.wrapperSlideVisibleInitArgs=function(){return!1},i.prototype.wrapperSlideVisibleArgs=function(e){return{visible:this.isVisible(e),done:this.onPopupVisible}},i.prototype.hideOnDeactivate=function(){this.setEntered(!1),this.setVisible(!1)},i.prototype.storyUserNameTextArgs=function(e){return this.args.storyUserModel.getFullName()},i.prototype.storyUserEmailTextArgs=function(e){return this.args.storyUserModel.getEmail()},i.prototype.ifEditingNowArgs=function(){return this.args.storyUserModel.getOnlineStatus()},i.prototype.ifUserIsSgMember=function(){return this.args.storyUserModel.getSgMembershipStatus()},i.prototype.editingNowTextArgs=function(e){return Resources.AuthorEditingNow},i.prototype.convertUserButtonArgs=function(){var t=this.args.userType===e.StoryUserType.Author?Resources.StoryUserChangeToViewer:Resources.StoryUserChangeToEditor,o={buttonId:(this.args.userType,e.StoryUserType.Author,ClientAction.ButtonId.Swsp_ConvertToViewer),click:this.convertUserButtonClick,context:this,cssClass:{value:"StoryUserPopupButton"},text:{value:t}};return new TDB.ChildArgs(n.TextButtonVE,o)},i.prototype.convertUserButtonClick=function(t,n){var o=this;return this.args.userType===e.StoryUserType.Author?this.args.authorsManager.convertEditorToViewer(this.args.storyUserModel).then(function(){return o.userOperationOnSuccess(n,ResourceManager.ResolveString(Resources.SharingUserBecameAViewer,[o.args.storyUserModel.getDisplayName()]))},function(){return i.userOperationOnError(n)}):this.args.userType===e.StoryUserType.Viewer?this.args.authorsManager.convertViewerToEditor(this.args.storyUserModel).then(function(){return o.userOperationOnSuccess(n,ResourceManager.ResolveString(Resources.SharingUserBecameAnAuthor,[o.args.storyUserModel.getDisplayName()]))},function(){return i.userOperationOnError(n)}):TDB.raiseRecoverableError("Unsupported story user type "+this.args.userType),this.deactivate(),this.findParent(e.ShareDropdownContentVE).findParent(TDB.ControlSet).activate(),TDB.EventPropagation.Bypass},i.prototype.removeUserButtonArgs=function(){var t={buttonId:this.args.userType===e.StoryUserType.Author?ClientAction.ButtonId.Swsp_RemoveEditor:ClientAction.ButtonId.Swsp_RemoveViewer,click:this.removeUserButtonClick,context:this,cssClass:{value:"StoryUserPopupButton"},text:{value:Resources.StoryUserRemove}};return new TDB.ChildArgs(n.TextButtonVE,t)},i.prototype.removeUserButtonClick=function(t,n){var o=this;return this.args.userType===e.StoryUserType.Author?this.args.authorsManager.removeEditor(this.args.storyUserModel).then(function(){return o.userOperationOnSuccess(n,ResourceManager.ResolveString(Resources.SharingUserRemoved,[o.args.storyUserModel.getDisplayName()]))},function(){return i.userOperationOnError(n)}):this.args.userType===e.StoryUserType.Viewer?this.args.authorsManager.removeViewer(this.args.storyUserModel).then(function(){return o.userOperationOnSuccess(n,ResourceManager.ResolveString(Resources.SharingUserRemoved,[o.args.storyUserModel.getDisplayName()]))},function(){return i.userOperationOnError(n)}):TDB.raiseRecoverableError("Unsupported story user type "+this.args.userType),this.deactivate(),this.findParent(e.ShareDropdownContentVE).findParent(TDB.ControlSet).activate(),TDB.EventPropagation.Bypass},i.prototype.userOperationOnSuccess=function(t,n){t&&t(!0),n&&this.findParent(e.ShareDropdownContentVE).narrateText(n)},i.userOperationOnError=function(e){e&&e(!1)},i.prototype.shouldShowSwspButtonsArgs=function(e){return StoryPageSettings.IsOwner&&this.args.sharingManager.getCurrentSharingLevel(e)===StoryAudience.Owner&&this.isOpenedWithClick(e)&&!this.ifUserIsSgMember()},i.prototype.isOpenedWithClick=function(e){var n=this.parent.currentOpenPopupWatcher.getWatchedValue(e);return n&&n.openType===t.Click},i.prototype.show=function(){var e=this,t=this.parent.getControlPosition(),n=$("#shareDropdown"),r=n.offset(),a=Math.min(0,r.left+n.width()-(t.left+i.rightLimit));TDB.applyUpdate(function(){e.leftOffset.setValue(a)}),o.prototype.show.call(this)},i.rightLimit=250,i}(n.PopupBaseVE);e.StoryUserPopupVEBase=i}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n,o=StoryApp.View.ViewElements,i=e.View.ViewModel;!function(e){e[e.Thumbnail=0]="Thumbnail",e[e.Initials=1]="Initials",e[e.DoughBoy=2]="DoughBoy"}(n=t.StoryUserThumbnailType||(t.StoryUserThumbnailType={}));var r=function(e){function t(t,n){var o=e.call(this,t)||this;return o.storyUserModel=n.storyUserModel,o.thumbnailState=TDB.watchableTag(596132064,o,o.getInitialStoryUserThumbnailType()),o.cssName=n.cssName,o.initialsFontSize=n.initialsFontSize,o.iconSize=n.iconSize,o.storyUserModel.getThumbnail()&&o.initializeThumbnailLoading(),o}return __extends(t,e),t.prototype.getInitialStoryUserThumbnailType=function(){return this.storyUserModel.getGivenName()&&this.storyUserModel.getGivenName().length>0||this.storyUserModel.getSurname()&&this.storyUserModel.getSurname().length>0?n.Initials:n.DoughBoy},t.prototype.storyUserThumbnailWrapperClassNameArgs=function(e){return this.cssName},t.prototype.storyUserInitialsStyleArgs=function(e){var t={};return t["font-size"]=this.initialsFontSize,t},t.prototype.initializeThumbnailLoading=function(){var e=new i.ResourceLoadingTracker(this.onResourceLoaded,this);e.addImageResource(this.storyUserModel.getThumbnail()),e.startLoading()},t.prototype.onResourceLoaded=function(e){var o=this;if(e.loadedSuccessfully){var i=e.resultElements[this.storyUserModel.getThumbnail()].element;if(!t.imageExists(i))return;TDB.applyUpdate(function(){o.thumbnailState.setValue(n.Thumbnail)})}},t.imageExists=function(e){return e&&e.height>0&&e.width>0},t.prototype.currentStoryUserThumbnailTypeArgs=function(e){return this.thumbnailState.getWatchedValue(e)},t.prototype.thumbnailStyleArgs=function(e){return{backgroundImage:"url('"+this.storyUserModel.getThumbnail()+"')"}},t.prototype.fontIconArgs=function(){var e={fontIconName:{value:FontIcons.DoughboyIcon},fontIconSizeClass:this.iconSize,fontIconWrapperClass:{value:"StoryUserProfile"}};return new TDB.ChildArgs(o.FontIconVE,e)},t.prototype.storyUserInitialsTextArgs=function(){var e=this.storyUserModel.getInitials();return""===e&&TDB.raiseRecoverableError("Initials should not be empty, in that case we should use doughboy",TDB.LogLevel.error),e},t}(TDB.ViewElement);t.StoryUserThumbnailVEBase=r}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements;!function(e){e[e.Author=0]="Author",e[e.AuthorSG=1]="AuthorSG",e[e.Viewer=2]="Viewer"}(e.StoryUserType||(e.StoryUserType={}));var n=function(t){function n(e,n){var o=t.call(this,e,{buttonId:ClientAction.ButtonId.ShareDropdown_CoauthorImage,role:Aria.Roles.Option,labeledby:""+(n.storyUserModel?n.storyUserModel.getEmail():""),cssClass:{value:"StoryUserWrapperButton"},enabled:n.enabled,description:{value:n.storyUserModel?n.storyUserModel.getEmail():""}})||this;return o.args=n,o.storyUserModel=n.storyUserModel,o.currentOpenPopupWatcher=n.currentOpenPopupWatcher,o.userType=n.userType,o.authorsManager=n.authorsManager,o.sharingManager=n.sharingManager,o}return __extends(n,t),n.prototype.onAction=function(e){var t=this,n=this.updatePopupOnClick(this.currentOpenPopupWatcher.getValue());return TDB.applyUpdate(function(){t.currentOpenPopupWatcher.setValue(n)}),TDB.EventPropagation.Bypass},n.prototype.updatePopupOnClick=function(t){return t?t.openType===e.StoryUserPopupOpenType.Click?this.handlePopupOpenedWithClick(t):t.openType===e.StoryUserPopupOpenType.Hover?this.handlePopupOpenedOnHover():(TDB.raiseRecoverableError("Unrecognized StoryUserPopupOpenType "+t.openType),null):this.handleNoOpenedPopup()},n.prototype.handleNoOpenedPopup=function(){return this.storyUserPopup.toggle(),new e.StoryUserCurrentOpenedPopup(this.storyUserPopup,e.StoryUserPopupOpenType.Click)},n.prototype.handlePopupOpenedWithClick=function(t){return this.storyUserPopup.toggle(),new e.StoryUserCurrentOpenedPopup(this.storyUserPopup,e.StoryUserPopupOpenType.Click)},n.prototype.handlePopupOpenedOnHover=function(){return this.activate(),this.storyUserPopup.show(),new e.StoryUserCurrentOpenedPopup(this.storyUserPopup,e.StoryUserPopupOpenType.Click)},n.prototype.wrapperEventsInitArgs=function(){return{mouseover:this.onHoverEnter,mouseout:this.onHoverEnd}},n.prototype.onHoverEnter=function(t){var n=this;return!!this.isEnabled()&&(!this.isThereAnOpenedPopupWithClick()&&(TDB.applyUpdate(function(){var t=new e.StoryUserCurrentOpenedPopup(n.storyUserPopup,e.StoryUserPopupOpenType.Hover);n.currentOpenPopupWatcher.setValue(t)}),this.storyUserPopup.show(),!1))},n.prototype.onHoverEnd=function(e){var t=this;return!!this.isEnabled()&&(!this.isThereAnOpenedPopupWithClick()&&(this.storyUserPopup.hideIfNotHidden(),TDB.applyUpdate(function(){t.currentOpenPopupWatcher.setValue(null)}),!1))},n.prototype.isThereAnOpenedPopupWithClick=function(){var t=this.currentOpenPopupWatcher.getValue();return t&&t.popup&&t.openType===e.StoryUserPopupOpenType.Click},n.prototype.deactivate=function(){return this.storyUserPopup.isVisible()&&this.storyUserPopup.hideOnDeactivate(),t.prototype.deactivate.call(this)},n.prototype.wrapperAttrArgs=function(){return this.getButtonAttributes()},n.prototype.wrapperClassNameArgs=function(e){var t=this.getButtonClass(e);return this.isEnabled(e)||(t+=" StoryUserWrapperDisabled"),t},n.prototype.wrapperPropsArgs=function(e){return{disabled:!this.isEnabled(e)}},n.prototype.storyUserPopupArgs=function(){var t=this;return new TDB.ChildArgs(e.StoryUserPopupVE,{storyUserModel:this.storyUserModel,domId:""+(this.storyUserModel?this.storyUserModel.getEmail():""),userType:this.userType,authorsManager:this.authorsManager,sharingManager:this.sharingManager,getControllingElement:function(){return t}})},n.prototype.storyUserThumbnailArgs=function(){var t={storyUserModel:this.storyUserModel,cssName:"StoryUserThumbnailWrapper",iconSize:FontIcons.DoughboyIconMediumSize,initialsFontSize:"18px"};return new TDB.ChildArgs(e.StoryUserThumbnailVE,t)},n.prototype.storyUserWrapperClassNameArgs=function(e){var t="StoryUserWrapper";return this.storyUserModel.getOnlineStatus()&&(t+=" StoryUserWrapperEditingNow"),t},n.prototype.ifShowSpinnerArgs=function(e){var t=this.authorsManager.getCurrentSwspUserRequest(e);return!this.isEnabled(e)&&t&&t.getModel()===this.storyUserModel.getModel()},n.prototype.storyUserSpinnerAttrArgs=function(){var e={};return e.src=CommonSettings.ContentBaseUrl+"LoadingBlackSpinner.gif",e},n}(t.ButtonVE);e.StoryUserVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(t){function n(e,n){var o=t.call(this,e,{features:TDB.ControlSetFeatures.TabDisabled|TDB.ControlSetFeatures.TabInto|TDB.ControlSetFeatures.HorizontalList|TDB.ControlSetFeatures.PreserveFocusContext})||this;return o.args=n,o.currentOpenedPopup=TDB.watchableTag(596132063,o,void 0),o}return __extends(n,t),n.prototype.itemsArgs=function(){var t=this;return this.args.storyUserModels.map(function(e){return{storyUserModel:e,currentOpenPopupWatcher:t.currentOpenedPopup,userType:t.args.userType,authorsManager:t.args.authorsManager,sharingManager:t.args.sharingManager,enabled:t.args.enabled}}).map(function(t){return new TDB.ChildArgs(e.StoryUserVE,t)})},n.prototype.closeOpenedPopup=function(){var e=this,t=this.currentOpenedPopup.getValue();t&&t.popup&&(t.popup.deactivate(),TDB.applyUpdate(function(){e.currentOpenedPopup.setValue(null)}))},n}(TDB.ControlSet);e.StoryUsersWrapperVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){e[e.InviteLink=0]="InviteLink",e[e.PeoplePicker=1]="PeoplePicker"}(e.InvitePeopleMode||(e.InvitePeopleMode={}))}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n,o=e.View.ViewModel,i=StoryApp.View.ViewElements,r=StoryApp.Common,a=e.Server.AuthorsManager;!function(e){e[e.Zero=0]="Zero",e[e.One=1]="One"}(n||(n={}));var s=function(e){function s(n,o){var i=e.call(this,n)||this;return i.groupExpandingInProgress=TDB.watchableTag(596132110,i,0),i.model=o.model,i.peoplePickerRequestHandler=new t.PeoplePickerRequestHandler(i,i.model.getSharingManager()),i}return __extends(s,e),s.prototype.getModel=function(){return this.model},s.prototype.invitePeopleTitleTextArgs=function(){return Resources.InvitePeopleTitle},s.prototype.invitePeopleTitleAttrArgs=function(){var e={};return e.id=s.titleId,e},s.prototype.linkTypeRadioGroupArgs=function(){var e={radioGroupName:"shareInvitation",titleId:s.titleId,radioButtons:this.createRadioButtons(),wrapperClass:"horizontalRadioGroup"};return new TDB.ChildArgs(i.RadioGroupVE,e)},s.prototype.createRadioButtons=function(){return StoryPageSettings.IsOwner?this.createRadioButtonsForOwner():this.createRadioButtonsForCoauthor()},s.prototype.createRadioButtonsForOwner=function(){return[this.createRadioButton(this.createViewButtonArgs()),this.createRadioButton(this.createEditButtonArgs())]},s.prototype.createRadioButtonsForCoauthor=function(){return[this.createRadioButton(this.createViewButtonArgs())]},s.prototype.createViewButtonArgs=function(){return{invitationType:o.InvitationType.View,text:Resources.InvitePeopleViewTitle}},s.prototype.createEditButtonArgs=function(){return{invitationType:o.InvitationType.Edit,text:Resources.InvitePeopleEditTitle}},s.prototype.islinkTypeSelectorVisibleArgs=function(){return this.model.showLinkTypeSelector},s.prototype.createRadioButton=function(e){var t=this;return{context:this,wrapperClass:"shareAADAudienceRadioButtonWrapper invitePeopleRadioButtonWrapper",inputClass:"shareAudienceRadioButton",labelClass:"shareAudienceRadioButtonLabel",textClass:"shareAADAudienceRadioButtonText",explanationTextClass:"shareAudienceRadioButtonExplanation",id:"type"+o.InvitationType[e.invitationType],radioGroupName:"shareInvitation",text:e.text,explanationText:e.explanation,enabled:{watchable:this.model.getEnabledWatchable()},getSelectedRadioButton:function(e){return t.model.getSelectedInvitationType(e)},click:this.onChangeInvitationType,value:e.invitationType}},s.prototype.onChangeInvitationType=function(e){return this.model.getSelectedInvitationType()===e||(this.model.setSelectedInvitationType(e),!0)},s.prototype.inputTextBoxArgs=function(e){var t=this.getTextValue(e),n={domId:"linkTextBox",description:Resources.ShareByLinkTextBoxDescription,enabled:{watchable:this.model.getEnabledWatchable()},readOnly:!0,selectTextOnFocus:!0,text:t,cssClass:StoryApp.Utilities.supportsClipboard()||StoryApp.Utilities.supportsClipboard_Experimental()?"NewShareDropdownCopyTextBoxWithButton":"NewShareDropdownCopyTextBox",tooltip:Resources.ShareByLinkTextBoxTooltip};return new TDB.ChildArgs(i.TextBoxVE,n)},s.prototype.getTextValue=function(e){var n=this.model.getSelectedInvitationType(e);return n===o.InvitationType.View||this.invitePeopleMode(e)==t.InvitePeopleMode.PeoplePicker?r.UrlHelper.getInstance().trackedShareLinkUrl(StoryPageSettings.LookupId,r.SharingReferrers.Link,r.SharingButtonLocations.Edit):n===o.InvitationType.Edit?r.UrlHelper.getInstance().shareLinkUrl(StoryPageEditSettings.EditId):(TDB.raiseRecoverableError("Unrecognized invitation type: "+n,TDB.LogLevel.error),"")},s.prototype.copyTextButtonArgs=function(){if(StoryApp.Common.TextCopyHelper.isCopySupported()){var e={buttonArgs:{value:{telemetryId:"copyTextButtonId",buttonId:ClientAction.ButtonId.ShareDropdown_CopyShareLinkButton,click:this.onCopyTextButtonClick,context:this,enabled:{watchable:this.model.getEnabledWatchable()},tooltip:{value:Resources.ContextMenuCopyLinkButtonV2},description:{value:Resources.ContextMenuCopyLinkButtonV2},cssClass:{value:"newShareCopyLinkButton"},fontIconName:{value:FontIcons.CopyLinkIcon},fontIconSizeClass:FontIcons.CopyLinkIconSize,fontIconWrapperClass:{value:"copyLinkButtonFontIconWrapper"}}},calloutArgs:{value:{calloutWrapperClassName:"CopyLinkButtonCalloutWrapper",calloutTapClassName:"CopyLinkButton-tap-callout",calloutBoxClassName:"CopyLinkButton-callout",headerText:{value:Resources.Copied},readerText:Resources.ContextMenuCopyLinkButtonCalloutReader,beakPosition:i.BeakPosition.TopRight,delay:0,inAnimation:"none",hideCloseButton:!0,visibilityTimeout:3e3}}};return new TDB.ChildArgs(i.TransientCalloutGlyphButtonVE,e)}},s.prototype.invitePeopleMode=function(e){switch(this.model.getSharingManager().getCurrentSharingLevel(e)){case StoryAudience.Owner:return t.InvitePeopleMode.PeoplePicker;default:return t.InvitePeopleMode.InviteLink}},s.prototype.isPickerVisibleArgs=function(e){return this.invitePeopleMode(e)==t.InvitePeopleMode.PeoplePicker},s.prototype.peoplePickerArgs=function(e){var n=this;TDB.applyUpdate(function(){n.peoplePickerRequestHandler.onQueryChanged("")},TDB.Justification.Initialization);var o={createSelectedEntity:function(e){return new TDB.ChildArgs(t.SelectedPersonVE,e)},createSuggestedEntity:function(e){return new TDB.ChildArgs(t.SuggestedPersonVE,e)},model:this.peoplePickerRequestHandler.response,onInput:function(){return n.peoplePickerRequestHandler.onQueryChanged(n.peoplePicker.getSelectedList().getInputValue()),!1},cssName:"peoplePickerWrapper"};return new TDB.ChildArgs(i.EntityPickerVE,o)},s.prototype.inviteTextButtonArgs=function(){var e={buttonId:ClientAction.ButtonId.ShareDropdown_InviteButton,click:this.onInviteTextButtonClick,context:this,cssClass:{value:"newShareInviteButton"},text:{value:Resources.PeoplePickerInviteButton},enabled:{watchable:TDB.watcherTag(596132111,this,this,this.calculateInviteButtonEnabled)}};return new TDB.ChildArgs(i.TextButtonVE,e)},s.prototype.calculateInviteButtonEnabled=function(e){var t=this.peoplePicker&&this.peoplePicker.getSelectedList()&&this.peoplePicker.getSelectedList().getSelectedEntityItems(e).length>0&&0==this.peoplePicker.getSelectedList().getInputValue(e).length&&0===this.groupExpandingInProgress.getWatchedValue(e);return t||this.peoplePicker.getSelectedList().activate(),t},s.prototype.onCopyTextButtonClick=function(e){return r.TextCopyHelper.copyHTMLText($("#linkTextBox")[0],$("#copyTextButtonId")[0],!1),TDB.EventPropagation.Bypass},s.prototype.onInviteTextButtonClick=function(e,t){var n=this;if(this.peoplePicker.getSelectedList().getSelectedEntityItems().length>0){switch(this.model.getSelectedInvitationType()){case o.InvitationType.Edit:this.model.getAuthorsManager().addEditors(this.peoplePicker.getSelectedList().getSelectedEntityItems().map(function(e){return e.user})).then(function(e){n.inviteDone(e,o.InvitationType.Edit,t)},function(){n.inviteError(o.InvitationType.Edit,t)});break;case o.InvitationType.View:this.model.getAuthorsManager().addViewers(this.peoplePicker.getSelectedList().getSelectedEntityItems().map(function(e){return e.user})).then(function(e){n.inviteDone(e,o.InvitationType.View,t)},function(){n.inviteError(o.InvitationType.View,t)});break;default:t(!1)}this.peoplePicker.getSelectedList().clearSelection(),StoryApp.View.ViewElements.ProgressDialog.createAndShow(Resources.PeoplePickerProgressDialogText,!0)}else t(!1);return TDB.EventPropagation.Bypass},s.prototype.inviteDone=function(e,n,o){if(StoryApp.View.Common.DialogManager.closeCurrentDialog(),e.statusCode===a.ChangeAudienceResponseStatusCode.TableLimitExceeded)StoryLog.StructuredTraceTag(596132112,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.info,"Failed to share sway for "+n+" - table limit exceeded",{}),ErrorDialog.ShowErrorDialog(Resources.SwspListedUsersLimitErrorMessageHeading,Resources.SwspListedUsersLimitErrorMessageBody);else{var i=this.model.getAuthorsManager(),r={invitationType:n,userEditorsCount:i.getSwspUserEditorsCount(),userViewersCount:i.getSwspUserViewersCount(),groupEditorsCount:i.getSwspGroupEditorsCount(),groupViewersCount:i.getSwspGroupViewersCount()},s=t.InvitePeopleVE.GenerateShareDialogTitle(r),l={title:s,description:s,accessibilityMessage:{value:s},buttonsArgs:[{buttonId:ClientAction.ButtonId.ShareDropdown_CloseGrantedAccessDialog,caption:{value:Resources.PeoplePickerAccessGrantedOkButton},onAction:function(){StoryApp.View.Common.DialogManager.closeCurrentDialog()}}],disableDismissOnClickOutside:!0,disableEscDismiss:!0,contentArgs:new TDB.ChildArgsNoModel(t.SharedSwayDialogContentVE)};StoryApp.View.Common.DialogManager.createAndShow(l)}o&&o(!0)},s.GenerateShareDialogTitle=function(e){var t=e.invitationType==o.InvitationType.Edit?e.userEditorsCount:e.userViewersCount,i=e.invitationType==o.InvitationType.Edit?e.groupEditorsCount:e.groupViewersCount;return CommonSettings.ShareWithSecurityGroupEnabled&&i!=n.Zero?i==n.One?s.GenerateShareDialogTitlePersonsAndOneGroup(t):s.GenerateShareDialogTitlePersonsAndTwoOrMoreGroups(t,i):s.GenerateShareDialogTitlePersons(t)},s.GenerateShareDialogTitlePersons=function(e){return e>n.One?ResourceManager.ResolveString(Resources.PeoplePickerAccessGrantedHeading,[e]):ResourceManager.ResolveString(Resources.PeoplePickerAccessGrantedHeadingSingular,[e])},s.GenerateShareDialogTitlePersonsAndOneGroup=function(e){var t="";switch(e){case n.Zero:t=ResourceManager.ResolveString(Resources.PeoplePickerAccessGrantedGroupOnlyHeadingSingular,[n.One]);break;case n.One:t=ResourceManager.ResolveString(Resources.PeoplePickerAccessGrantedPeopleSingularGroupSingularHeading,[e,n.One]);break;default:t=ResourceManager.ResolveString(Resources.PeoplePickerAccessGrantedPeoplePluralGroupSingularHeading,[e,n.One])}return t},s.GenerateShareDialogTitlePersonsAndTwoOrMoreGroups=function(e,t){var o="";switch(e){case n.Zero:o=ResourceManager.ResolveString(Resources.PeoplePickerAccessGrantedGroupOnlyHeadingPlural,[t]);break;case n.One:o=ResourceManager.ResolveString(Resources.PeoplePickerAccessGrantedPeopleSingularGroupPluralHeading,[e,t]);break;default:o=ResourceManager.ResolveString(Resources.PeoplePickerAccessGrantedPeoplePluralGroupPluralHeading,[e,t])}return o},s.prototype.inviteError=function(e,t){StoryLog.StructuredTraceTag(596132113,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.warning,"Failed to share sway for "+e,{}),StoryApp.View.Common.DialogManager.closeCurrentDialog(),ErrorDialog.ShowErrorDialog(Resources.PeoplePickerErrorDialogHeading,Resources.PeoplePickerErrorDialogText),t&&t(!1)},s.prototype.groupExpandingStarted=function(){var e=this.groupExpandingInProgress.getValue()+1;this.updateGroupExpandingCounter(e)},s.prototype.groupExpandingFinished=function(){var e=this.groupExpandingInProgress.getValue()-1;this.updateGroupExpandingCounter(e)},s.prototype.updateGroupExpandingCounter=function(e){var t=this;TDB.applyUpdate(function(){t.groupExpandingInProgress.setValue(e)},TDB.Justification.SynchronousBrowserEvent)},s.titleId="InvitePeopleVETitleId",s}(TDB.FocusableViewElement);t.InvitePeopleVEBase=s}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(t){function n(e,n){var o=t.call(this,e)||this;return o.args=n,o}return __extends(n,t),n.prototype.suggestedPersonImageStyleArgs=function(e){var t=this.args.user.getThumbnailSmall();return t?{backgroundImage:"url("+t+")"}:void 0},n.prototype.suggestedPersonImageArgs=function(){var t={storyUserModel:this.args.user,cssName:"suggestedPersonImage",initialsFontSize:"14px",iconSize:FontIcons.DoughboyIconSuggestedPerson};return new TDB.ChildArgs(e.StoryUserThumbnailVE,t)},n.prototype.suggestedPersonNameTextArgs=function(e){return this.args.user.getFullName()},n.prototype.suggestedPersonEmailTextArgs=function(e){return this.args.user.getEmail()},n.prototype.mouseClicked=function(e){return ActionLogger.RecordClientAction(new ClientAction.ButtonClickAction(ClientAction.ButtonId.ShareDropdown_AddSuggestedPerson,Diag.ULSCat.msoulscat_Story_Site)),this.args.peoplePicker.getSelectedList().addEntityAndClearText(this.args),TDB.EventPropagation.Bypass},n.prototype.keyDown=function(e){return e.keyCode===KeyCodeType.EnterKey?(this.args.peoplePicker.getSelectedList().addEntityAndClearText(this.args),TDB.EventPropagation.Bypass):t.prototype.keyDown.call(this,e)},n}(TDB.Control);e.SuggestedPersonVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.Server.AuthorsManager,i=StoryApp.Common,r=function(e){function r(t,n){var o=e.call(this,t)||this;return o.args=n,o.isSpinnerVisible=TDB.watchableTag(596132107,o,!1),o}return __extends(r,e),r.prototype.selectedPersonNameTextArgs=function(e){return this.args.user.getFullName()||this.args.user.getEmail()},r.prototype.selectedPersonImageArgs=function(){var e={storyUserModel:this.args.user,cssName:"selectedPersonImage",initialsFontSize:"13px",iconSize:FontIcons.DoughboyIconSelectedPerson};return new TDB.ChildArgs(t.StoryUserThumbnailVE,e)},r.prototype.removePersonButtonArgs=function(){var e={buttonId:ClientAction.ButtonId.ShareDropdown_RemoveSelectedPerson,click:this.removeButtonClick,context:this,cssClass:{value:"selectedPersonRemoveButton"},description:{value:this.args.user.removeSharingSubjectDescription()},tooltip:{value:this.args.user.removeSharingSubjectDescription()},fontIconName:{value:FontIcons.AddContentCloseLegalIcon},fontIconSizeClass:FontIcons.RemovePersonSize,domFocusable:{value:!1}};return new TDB.ChildArgs(n.GlyphButtonVE,e)},r.prototype.selectedPersonWrapperEventsInitArgs=function(){var e={};return e.keydown=this.keyDownHandler,e},r.prototype.removeButtonClick=function(e){return this.removeSelectedPersonFromPicker(),TDB.EventPropagation.Bypass},r.prototype.removeSelectedPersonFromPicker=function(){this.args.peoplePicker.getSelectedList().removeEntity(this.args)},r.prototype.mouseClicked=function(e){return TDB.EventPropagation.Bypass},r.prototype.keyDownHandler=function(e){switch(e.keyCode){case KeyCodeType.BackspaceKey:return this.handleBackspaceKey(),!1;case KeyCodeType.DeleteKey:return this.handleDeleteKey(),!1;default:return!0}},r.prototype.handleBackspaceKey=function(){this.removeSelectedPersonFromPicker()},r.prototype.handleDeleteKey=function(){this.removeSelectedPersonFromPicker()},r.prototype.getGroupMembersButtonArgs=function(){if(this.shouldShowGetGroupMembersButton()){var e=ResourceManager.ResolveString(Resources.PeoplePickerExpandSelectedGroupDescriptionWithGroupName,[this.args.user.getFullName()]),t={buttonId:ClientAction.ButtonId.ShareDropdown_GetGroupMembersButton,click:this.getGroupMembers,context:this,cssClass:{value:"getGroupMembersButton"},fontIconName:{value:FontIcons.JackDiamondIcon},fontIconSizeClass:FontIcons.JackDiamondIconSize,tooltip:{value:Resources.PeoplePickerExpandSelectedGroupTooltip},description:{value:e}};return new TDB.ChildArgs(n.GlyphButtonVE,t)}},r.prototype.shouldShowGetGroupMembersButton=function(){return this.args.user instanceof o.SecurityGroupModel},r.prototype.getGroupMembers=function(e){return this.updateSpinnerVisibility(!0),this.args.getGroupMembers.call(this.args.context,this.args,this.gettingGroupMembersFinished,this),TDB.EventPropagation.PreventDefault},r.prototype.updateSpinnerVisibility=function(e){var t=this;TDB.applyUpdate(function(){t.isSpinnerVisible.setValue(e)},TDB.Justification.SynchronousBrowserEvent)},r.prototype.getFocusableChildren=function(){if(this.groupMembersButton){var e=[];return e.push(this.groupMembersButton),e}},r.prototype.gettingGroupMembersFinished=function(){this.updateSpinnerVisibility(!1)},r.prototype.ifSpinnerArgs=function(e){return this.isSpinnerVisible.getWatchedValue(e)},r.prototype.waitingSpinnerAttrArgs=function(){return{src:i.UrlHelper.getInstance().getLoadingSpinnerUrl()}},r}(TDB.Control);t.SelectedPersonVEBase=r}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.View.ViewModel,i=function(e){var t=e;if(StoryPageSettings.Mode===StoryViewMode.Preview){var n=e.indexOf("?");if(-1!=n){var o=e.substring(n),i=new StoryApp.Utilities.UrlDict("?",function(){return o});t=t.substring(0,n+1)+i.add(StoryApp.Common.UrlHelper.URLParamAuthoringPlayMode)}}window.location.href=t},r=function(e){function n(t,n){var o=e.call(this,t,{features:TDB.ControlSetFeatures.Isolated,getControllingElement:n.getControllingElement,visible:n.visible})||this;return o.model=n.model,o}return __extends(n,e),n.prototype.wrapperAttrArgs=function(){var e={};return e[Aria.Attributes.Role]=Aria.Roles.Group,e[Aria.Attributes.Label]=Resources.Share,e},n.prototype.wrapperClassNameArgs=function(e){return"newShareDropdownWrapper "+(this.model.getContext()===o.ShareDropdownContext.Consumption?"newShareDropdownConsumption":"newShareDropdownEdit")},n.prototype.wrapperSlideVisibleInitArgs=function(){return!1},n.prototype.wrapperSlideVisibleArgs=function(e){return{visible:this.isVisible(e),done:this.onSlideDone}},n.prototype.contentArgs=function(){var e=this,n={closeMenu:function(){return e.hide()},onShowDialog:function(){return e.hide()},onRevokeLinkSuccess:i,model:this.model};return new TDB.ChildArgs(t.ShareDropdownContentVE,n)},n.prototype.onSlideDone=function(){e.prototype.onPopupVisible.call(this),this.visible.getValue()||StoryApp.View.Common.FRE.FirstRunTriggers.shareExperienceOffered()},n.prototype.keyDown=function(t){return t.keyCode===KeyCodeType.LeftArrowKey||t.keyCode===KeyCodeType.RightArrowKey?TDB.EventPropagation.Bypass:e.prototype.keyDown.call(this,t)},n}(n.PopupBaseVE);t.ShareDropdownVEBase=r}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(t){function n(e,n){var o=t.call(this,e)||this;return o.model=n.model,o.args=n,o}return __extends(n,t),n.prototype.ifDisableOverlayArgs=function(e){return!this.model.isEnabled(e)},n.prototype.disableOverlayClassNameArgs=function(e){return CommonSettings.IsTenantUser?"shareDropdownDisableOverlayAAD":"shareDropdownDisableOverlayMSA"},n.prototype.accessibilityMessageTextArgs=function(e){return this.model.getNarratorMessage(e)},n.prototype.narrateText=function(e){this.model.setNarratorMessage(e)},n.prototype.sharingLevelsArgs=function(){if(StoryPageEditSettings.SiteSharingAudienceSelectionEnabled){var t={sharingManager:this.model.getSharingManager(),authorsManager:this.model.getAuthorsManager()};return new TDB.ChildArgs(e.ShareLevelSelectorVE,t)}},n.prototype.invitePeopleArgs=function(){if(StoryPageSettings.IsOwner){var t={model:this.model.getInvitePeopleViewModel()};return new TDB.ChildArgs(e.InvitePeopleVE,t)}},n.prototype.shareButtonsArgs=function(t){var n={closeMenu:this.args.closeMenu,model:this.model.getShareButtonsViewModel()};return new TDB.ChildArgs(e.ShareButtonsVE,n)},n.prototype.moreOptionsArgs=function(){if(StoryPageSettings.IsOwner){var t={onShowDialog:this.args.onShowDialog,onRevokeLinkSuccess:this.args.onRevokeLinkSuccess,model:this.model.getShareMoreOptionsViewModel()};return new TDB.ChildArgs(e.ShareMoreOptionsVE,t)}},n.prototype.ifCoAuthWrapperArgs=function(e){return CommonSettings.CoAuthoringEnabled&&this.model.getAuthorsManager().hasCoAuthors(e)},n.prototype.titleAuthorsTextArgs=function(e){return Resources.AuthorsListTitle},n.prototype.storyUsersWrapperArgs=function(t){var n=this.model.getAuthorsManager().getAuthors(t);if(n){var o={storyUserModels:n.map(function(e){return e.ConvertToStoryUser()}),userType:e.StoryUserType.Author,authorsManager:this.model.getAuthorsManager(),sharingManager:this.model.getSharingManager(),enabled:{value:!0}};return new TDB.ChildArgs(e.StoryUsersWrapperVE,o)}},n.prototype.mouseClicked=function(e){return this.storyUsersWrapper&&this.storyUsersWrapper.closeOpenedPopup(),this.swspEditorsList&&this.swspEditorsList.closeOpenedPopup(),this.swspViewersList&&this.swspViewersList.closeOpenedPopup(),t.prototype.mouseClicked.call(this,e)},n.prototype.shouldShowEditorsAndViewersListsArgs=function(){return CommonSettings.CoAuthoringEnabled},n.prototype.shouldShowSwspEditorsErrorArgs=function(e){return this.shouldShowError(e)},n.prototype.shouldShowSwspViewersErrorArgs=function(e){return this.shouldShowError(e)},n.prototype.shouldShowError=function(e){return this.model.getAuthorsManager().hasSwspListError(e)},n.prototype.swspEditorsErrorMessageTextArgs=function(e){return Resources.SwspEditorsErrorMessage},n.prototype.swspViewersErrorMessageTextArgs=function(e){return Resources.SwspViewersErrorMessage},n.prototype.shouldShowEditorsListArgs=function(e){var t=this.model.getAuthorsManager();return t&&(t.hasSwspEditors(e)||this.shouldShowSpinnerOrError(e))&&(t.getSwspUserEditorsCount(e)>0||t.getSwspGroupEditorsCount(e)>0)},n.prototype.shouldShowViewersListArgs=function(e){var t=this.model.getAuthorsManager();return t&&this.model.getSharingManager().getCurrentSharingLevel(e)===StoryAudience.Owner&&(t.hasSwspViewers(e)||this.shouldShowSpinnerOrError(e))&&(t.getSwspUserViewersCount(e)>0||t.getSwspGroupViewersCount(e)>0)},n.prototype.shouldShowSpinnerOrError=function(e){return this.model.getAuthorsManager().hasSwspListError(e)||this.model.getAuthorsManager().isRequestInProgress(e)},n.prototype.swspEditorsTextArgs=function(e){return Resources.SwspEditors},n.prototype.swspViewersTextArgs=function(e){return Resources.SwspViewers},n.prototype.swspEditorsListArgs=function(t){var n=this,o=this.model.getAuthorsManager().getSwspEditors(t);if(o&&0!==o.length){var i={storyUserModels:o,userType:e.StoryUserType.Author,authorsManager:this.model.getAuthorsManager(),sharingManager:this.model.getSharingManager(),enabled:{compute:new TDB.ComputedOptionArgs(this,function(e){return!n.model.getAuthorsManager().isRequestInProgress(e)})}};return new TDB.ChildArgs(e.StoryUsersWrapperVE,i)}},n.prototype.swspViewersListArgs=function(t){var n=this,o=this.model.getAuthorsManager().getSwspViewers(t);if(o&&0!==o.length){var i={storyUserModels:o,userType:e.StoryUserType.Viewer,authorsManager:this.model.getAuthorsManager(),sharingManager:this.model.getSharingManager(),enabled:{compute:new TDB.ComputedOptionArgs(this,function(e){return!n.model.getAuthorsManager().isRequestInProgress(e)})}};return new TDB.ChildArgs(e.StoryUsersWrapperVE,i)}},n.prototype.ifSwspEditorsSpinnerArgs=function(e){return this.model.shouldShowSpinnerForLists(e)},n.prototype.ifSwspViewersSpinnerArgs=function(e){return this.model.shouldShowSpinnerForLists(e)},n.prototype.swspEditorsSpinnerAttrArgs=function(){return this.getSpinnerArgs()},n.prototype.swspViewersSpinnerAttrArgs=function(){return this.getSpinnerArgs()},n.prototype.getSpinnerArgs=function(){var e={};return e.src=CommonSettings.ContentBaseUrl+"LoadingBlackSpinner.gif",e},n}(TDB.FocusableViewElement);e.ShareDropdownContentVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(t){function n(e,n){var o=t.call(this,e,{features:TDB.ControlSetFeatures.Isolated})||this;return o.args=n,o}return __extends(n,t),n.prototype.getPosition=function(){return this.wrapperPositionBinding.getPosition()},n.prototype.watchContentChanges=function(e){if(!this.content)throw StoryApp.RethrowLogger.createError("Cannot watch for content share UI changes before the VE is mounted");this.content.ifCoAuthWrapperArgs(e),this.content.shouldShowSwspViewersErrorArgs(e),this.content.shouldShowEditorsListArgs(e),this.content.shouldShowViewersListArgs(e),this.content.swspViewersListArgs(e),this.content.swspEditorsListArgs(e),this.content.moreOptions&&(this.content.moreOptions.ifShowMoreOptionsArgs(e),this.content.moreOptions.ifShowPasswordManagementArgs(e),this.content.moreOptions.blockShareButtonCheckboxArgs(e)),this.content.invitePeople&&this.content.invitePeople.peoplePickerRequestHandler.response.getWatchedValue(e)},n.prototype.contentArgs=function(){return new TDB.ChildArgs(e.ShareDropdownContentVE,this.args.contentArgs)},n.prototype.keyDown=function(e){return e.keyCode===KeyCodeType.EscapeKey?(this.args.contentArgs.closeMenu(),this.escape(),TDB.EventPropagation.PreventDefault):t.prototype.keyDown.call(this,e)},n}(TDB.ControlSet);e.ShareFrameVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(e){function n(t,n){var o=e.call(this,t)||this;return o.sharingManager=n.sharingManager,o.spinnerVisible=TDB.watchableTag(596132108,o,!1),o}return __extends(n,e),n.prototype.passwordScopeLabelTextArgs=function(e){var t=this.sharingManager.getPasswordScope(e);return StoryApp.Common.PasswordHelper.getTextForPasswordScope(t)},n.prototype.removePasswordButtonArgs=function(){var e={cssClass:{value:"shareMoreOptionsTextButtonWrapper"},buttonId:ClientAction.ButtonId.ShareDropdown_MoreOptionsRemovePassword,click:this.removePasswordCheckboxClicked,context:this,hasPopup:!1,text:{value:Resources.SharingRemovePassword}};return new TDB.ChildArgs(t.TextButtonVE,e)},n.prototype.removePasswordCheckboxClicked=function(e){var t=this;return TDB.applyUpdate(function(){t.spinnerVisible.setValue(!0)}),this.sharingManager.removePassword(StoryPageSettings.LookupId,function(){return t.passwordRemovalCompleted()},function(){return t.passwordRemovalCompleted()}),TDB.EventPropagation.Bypass},n.prototype.passwordRemovalCompleted=function(){var e=this;TDB.applyUpdate(function(){e.spinnerVisible.setValue(!1)})},n.prototype.loadingSpinnerAttrArgs=function(){var e={};return e.src=CommonSettings.ContentBaseUrl+"LoadingBlackSpinner.gif",e[Aria.Attributes.Valuetext]=Resources.SignInDialogLooking,e},n.prototype.spinnerVisibleArgs=function(e){return e.watchValue(this.spinnerVisible)},n}(TDB.FocusableViewElement);e.RemovePasswordVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel,o=StoryApp.View.ViewElements,i=function(e){function t(t,n){var o=e.call(this,t)||this;return o.currentCastViewUrl=TDB.watchableTag(596132105,o,StoryPageEditSettings.CastViewUrl),o.currentCastId=TDB.watchableTag(596132106,o,StoryPageEditSettings.CastId),o.model=n.model,o.closeMenu=n.closeMenu,o}return __extends(t,e),t.prototype.shareButtonsArgs=function(e){return this.createShareButtons(e).map(function(e){return new TDB.ChildArgs(o.GlyphButtonVE,e)})},t.prototype.isDocsDotComPublishButtonEnabled=function(){return!!CommonSettings.SitePublishToCastFeatureEnabled&&(CommonSettings.IsAADUser?StoryPageSettings.IsOwner&&""!==CommonSettings.CastPublishAADUrl&&CommonSettings.SitePublishAADToCastFeatureUIEnabled:StoryPageEditSettings.SitePublishToCastFeatureUIEnabled)},t.prototype.createShareButtons=function(e){var t=[];return this.model.getSelectedInvitationType(e)===n.InvitationType.Edit?t:(this.model.getSharingManager().visualLinkSharingEnabled(StoryPageSettings.VisualLinkMode,e)&&t.push(this.createVisualLinkButton()),CommonSettings.IsTenantUser&&this.model.getSharingManager().getCurrentSharingLevel(e)==StoryAudience.Owner?t:(this.model.getSharingManager().isPublicSharingAllowed(e)&&(t.push(this.createFacebookButton()),t.push(this.createTwitterButton()),CommonSettings.SiteLinkedInSharingEnabled&&t.push(this.createLinkedInButton())),this.isDocsDotComPublishButtonEnabled()&&t.push(this.createDocsDotComButton()),this.model.showEmbedButton&&t.push(this.createEmbedButton()),t))},t.prototype.createDocsDotComButton=function(){return{buttonId:ClientAction.ButtonId.ShareDropdown_SocialDocsDotCom,click:this.docsDotComButtonClicked,context:this,cssClass:{value:"newShareDropdownButton"},enabled:{watchable:this.model.getEnabledWatchable()},description:{value:Resources.SharingCastPublishButtonDescription},tooltip:{value:Resources.SharingCastPublishButtonDescription},fontIconName:{value:FontIcons.CastIcon},fontIconSizeClass:FontIcons.CastIconSize,fontIconWrapperClass:{value:"newShareFontIconWrapperDocsDotCom"},textClass:"shareButtonText",textPlacementRight:!0,text:{value:Resources.CastName}}},t.prototype.docsDotComButtonClicked=function(){var e=StoryPageSettings.LookupId;return CommonSettings.IsAADUser?o.StoryShareAction.shareAADStoryToDocsDotCom(e,ClientAction.ButtonId.ShareDropdown_SocialDocsDotCom,this.model.getSharingManager()):this.shouldShowPublish()?this.showPublishToCastDialog():this.showAlreadyPublishedDialog(),this.closeMenu(),TDB.EventPropagation.Bypass},t.prototype.shouldShowPublish=function(){return!this.currentCastViewUrl.getValue()},t.prototype.showPublishToCastDialog=function(){var e=this,t={sharingManager:this.model.getSharingManager(),callback:function(t,n){return e.castCallback(t,n)}};o.PublishCastDialog.createAndShowPublish(StoryPageSettings.LookupId,t)},t.prototype.showAlreadyPublishedDialog=function(){var e=this,t={sharingManager:this.model.getSharingManager(),callback:function(t,n){return e.castCallback(t,n)},castViewUrl:this.currentCastViewUrl};o.PublishCastDialog.createAndShowAlreadyPublished(StoryPageSettings.LookupId,t)},t.prototype.castCallback=function(e,t){var n=this;TDB.applyUpdate(function(){n.currentCastId.setValue(e),n.currentCastViewUrl.setValue(t),StoryPageEditSettings.CastId=e,StoryPageEditSettings.CastViewUrl=t})},t.prototype.createVisualLinkButton=function(){return{buttonId:ClientAction.ButtonId.ShareDropdown_SocialVisualLink,click:this.visualLinkButtonClicked,context:this,cssClass:{value:"newShareVisualLinkButton"},description:{value:Resources.VisualLinkButtonDescription},tooltip:{value:Resources.VisualLinkButtonDescription},enabled:{watchable:this.model.getEnabledWatchable()},fontIconName:{value:FontIcons.LinkIcon},fontIconSizeClass:FontIcons.LinkIconSize,fontIconWrapperClass:{value:"shareFontIconWrapperVisualLinkNew"},textClass:"shareButtonText",textPlacementRight:!0,text:{value:Resources.VisualLinkButtonTitle}}},t.prototype.visualLinkButtonClicked=function(){return this.closeMenu(),this.showVisualLinkDialog(),TDB.EventPropagation.Bypass},t.prototype.showVisualLinkDialog=function(){StoryApp.View.Common.VisualLinkDialog.show({visualLinkViewModel:this.model.getVisualLinkViewModel(),copyButtonId:ClientAction.ButtonId.ShareDropdown_VisualLinkAuthoringDialogCopyButton})},t.prototype.createFacebookButton=function(){return{buttonId:ClientAction.ButtonId.ShareDropdown_SocialFacebook,click:this.facebookButtonClicked,context:this,cssClass:{value:"newShareDropdownButton"},enabled:{watchable:this.model.getEnabledWatchable()},description:{value:Resources.ShareToFacebookButtonDescription},tooltip:{value:Resources.ShareToFacebookButtonDescription},fontIconName:{value:FontIcons.SocialFacebookIcon},fontIconSizeClass:FontIcons.FacebookIconSize,fontIconWrapperClass:{value:"newShareFontIconWrapperFacebook"},textPlacementRight:!0}},t.prototype.facebookButtonClicked=function(){return this.model.shareToFacebook(),this.closeMenu(),TDB.EventPropagation.Bypass},t.prototype.createTwitterButton=function(){return{buttonId:ClientAction.ButtonId.ShareDropdown_SocialTwitter,click:this.twitterButtonClicked,context:this,cssClass:{value:"newShareDropdownButton"},enabled:{watchable:this.model.getEnabledWatchable()},description:{value:Resources.ShareToTwitterButtonDescription},tooltip:{value:Resources.ShareToTwitterButtonDescription},fontIconName:{value:FontIcons.SocialTwitterIcon},fontIconSizeClass:FontIcons.TwitterIconSize,fontIconWrapperClass:{value:"newShareFontIconWrapperTwitter"},textPlacementRight:!0}},t.prototype.twitterButtonClicked=function(){return this.model.shareToTwitter(),this.closeMenu(),TDB.EventPropagation.Bypass},t.prototype.createLinkedInButton=function(){return{buttonId:ClientAction.ButtonId.ShareDropdown_SocialLinkedIn,click:this.linkedInButtonClicked,context:this,cssClass:{value:"newShareDropdownButton"},enabled:{watchable:this.model.getEnabledWatchable()},description:{value:Resources.ShareToLinkedinButtonDescription},tooltip:{value:Resources.ShareToLinkedinButtonDescription},fontIconName:{value:FontIcons.SocialLinkedInIcon},fontIconSizeClass:FontIcons.LinkedInIconSize,fontIconWrapperClass:{value:"shareFontIconWrapperLinkedIn"},textPlacementRight:!0}},t.prototype.linkedInButtonClicked=function(){return this.model.shareToLinkedIn(),this.closeMenu(),TDB.EventPropagation.Bypass},t.prototype.createEmbedButton=function(){return{buttonId:ClientAction.ButtonId.ShareDropdown_EmbedCodeButton,click:this.embedButtonClicked,context:this,cssClass:{value:"newShareEmbedButton"},description:{value:Resources.EmbedSway},tooltip:{value:Resources.EmbedSway},enabled:{watchable:this.model.getEnabledWatchable()},fontIconName:{value:FontIcons.PreviewEmbedIcon},fontIconSizeClass:FontIcons.PreviewEmbedIconSize24,fontIconWrapperClass:{value:"newShareFontIconWrapperEmbed"},textClass:"shareButtonText",textPlacementRight:!0,text:{value:Resources.SocialFlyoutEmbedButton}}},t.prototype.embedButtonClicked=function(){return this.model.shareEmbed(),this.closeMenu(),TDB.EventPropagation.Bypass},t}(TDB.FocusableViewElement);t.ShareButtonsVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(n){function o(e,t){var o=n.call(this,e)||this;return o.sharingManager=t.sharingManager,o.authorsManager=t.authorsManager,o}return __extends(o,n),o.prototype.titleTextArgs=function(){return this.isTenantOwner()?Resources.ShareLevelSelectorHeader:Resources.Share},o.prototype.titleAttrArgs=function(){var e={};return e.id=o.titleId,e},o.prototype.sharingLevelsArgs=function(){var e={radioGroupName:"shareLevelSelection",titleId:o.titleId,radioButtons:this.createRadioButtons()};return new TDB.ChildArgs(t.RadioGroupVE,e)},o.prototype.createRadioButtons=function(){return StoryPageSettings.IsOwner?this.createRadioButtonsForOwner():[]},o.prototype.createRadioButtonsForOwner=function(){return CommonSettings.IsTenantUser?this.createRadioButtonsForAadUser():this.createRadioButtonsForMsaUser()},o.prototype.ifTenantOwnerArgs=function(){return this.isTenantOwner()},o.prototype.sharingLevelMessageTextArgs=function(e){var t=this.sharingManager.getCurrentSharingLevel(e);return o.getAudienceText(t)},o.prototype.sharingLevelIconArgs=function(n){var o=this.sharingManager.getCurrentSharingLevel(n),i={fontIconName:{value:e.ShareLevelSelectorVE.getAudienceIcon(o)},fontIconSizeClass:FontIcons.SharingLevelIconSize,fontIconWrapperClass:{value:"SharingLevelIcon"}};return new TDB.ChildArgs(t.FontIconVE,i)},o.prototype.isTenantOwner=function(){return StoryPageSettings.IsOwner&&CommonSettings.IsTenantUser},o.getRadioButtonText=function(e){var t=CommonSettings.ShareWithSecurityGroupEnabled?Resources.SharingShareWithSpecificPeopleOrGroups:Resources.SharingShareWithSpecificPeople;switch(e){case StoryAudience.AnyoneWithLink:case StoryAudience.Public:case StoryAudience.Published:return Resources.SharingLevelAnyoneWithLink;case StoryAudience.TenantWithLink:return Resources.SharingLevelOrgOnly;case StoryAudience.Owner:return t;default:return TDB.raiseRecoverableError("No string exists for the specified audience "+e),""}},o.getAudienceIcon=function(e){switch(e){case StoryAudience.AnyoneWithLink:case StoryAudience.Public:case StoryAudience.Published:case StoryAudience.Unknown:return FontIcons.GlobeIcon;case StoryAudience.TenantWithLink:return FontIcons.LuggageIcon;case StoryAudience.Owner:return StoryPageSettings.IsOwner?FontIcons.AddAssignmentStageIcon:FontIcons.PeopleWithExistingAccessPermissionsIcon;default:return TDB.raiseRecoverableError("No icon exists for the specified audience "+e),""}},o.getAudienceText=function(e){switch(e){case StoryAudience.AnyoneWithLink:case StoryAudience.Public:case StoryAudience.Published:case StoryAudience.Unknown:return Resources.SocialFlyoutSharingLevelAnyoneWithLink;case StoryAudience.TenantWithLink:return Resources.SocialFlyoutSharingLevelOrgOnly;case StoryAudience.Owner:return StoryPageSettings.IsOwner?Resources.SocialFlyoutShareWithSpecificPeopleOrGroupsAuthor:Resources.SocialFlyoutShareWithSpecificPeopleOrGroupsCoauthorViewer;default:return TDB.raiseRecoverableError("No string exists for the specified audience "+e),""}},o.prototype.createRadioButtonsForAadUser=function(){var e=this,t=[],n={audience:StoryAudience.Owner,text:o.getRadioButtonText(StoryAudience.Owner),enabled:!0};t.push(n);var i={audience:StoryAudience.TenantWithLink,text:o.getRadioButtonText(StoryAudience.TenantWithLink),enabled:!0};t.push(i);var r={audience:StoryAudience.AnyoneWithLink,text:o.getRadioButtonText(StoryAudience.AnyoneWithLink),enabled:!0};return StoryPageEditSettings.PublicSharingEnabledInTenant&&t.push(r),t.map(function(t){return e.createRadioButton(t)})},o.prototype.createRadioButtonsForMsaUser=function(){var e={audience:StoryAudience.Owner,text:o.getRadioButtonText(StoryAudience.Owner),enabled:!1},t={audience:StoryAudience.AnyoneWithLink,text:o.getRadioButtonText(StoryAudience.AnyoneWithLink),enabled:!0};return[this.createRadioButton(e),this.createRadioButton(t)]},o.prototype.createRadioButton=function(e){var t=this;return{context:this,wrapperClass:"shareAADAudienceRadioButtonWrapper",inputClass:"shareAudienceRadioButton",labelClass:"shareAudienceRadioButtonLabel",textClass:"shareAADAudienceRadioButtonText",explanationTextClass:"shareAudienceRadioButtonExplanation",id:"audience"+StoryAudience[e.audience],radioGroupName:"shareLevelSelection",text:e.text,enabled:{value:e.enabled},getSelectedRadioButton:function(e){return t.sharingManager.getCurrentSharingLevel(e)},click:this.onChangeSharingLevel,value:e.audience}},o.prototype.onChangeSharingLevel=function(e){var t=this;if(!StoryPageSettings.IsOwner)return!0;var n=this.sharingManager.getCurrentSharingLevel();return ActionLogger.RecordClientAction(new ClientAction.ChangeStoryAudienceData(e,n)),this.errorNotification&&this.dismissErrorNotification(),n===e?StoryLog.StructuredTraceTag(596132098,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.info,"User clicked a sharing level radio button which was already selected",{sharingLevel:e.toString()}):(this.authorsManager.initiateLoadingWithoutRequest(),this.sharingManager.changeSharingLevel(e,StoryPageSettings.LookupId,function(){return t.onSharingLevelChangeSuccess(e)},function(o,i,r){return t.onSharingLevelChangeError(e,n,i,r)})),!0},o.prototype.onSharingLevelChangeError=function(e,n,o,i){StoryLog.StructuredTraceTag(596132099,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.info,"Changing sharing level failed",{newSharingLevel:StoryAudience[e],oldSharingLevel:StoryAudience[n],textStatus:o,errorThrown:i}),this.authorsManager.refreshStoryUsers();var r=t.NotificationBarViewModel.getNotificationBar(this);r?this.errorNotification=r.addNotification({messages:[{text:Resources.SharingChangeFailed}],notificationSource:t.NotificationSource.ShareAudience,notificationType:t.NotificationType.Info}):StoryLog.TraceTag(596132100,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.error,"Failed to get notification bar to tell user we failed to change sharing")},o.prototype.onSharingLevelChangeSuccess=function(e){StoryLog.StructuredTraceTag(596132101,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.info,"Successfully changed sharing level",{newSharingLevel:e.toString()}),this.authorsManager.refreshStoryUsers()},o.prototype.dismissErrorNotification=function(){var e=t.NotificationBarViewModel.getNotificationBar(this);e?e.getNotification()==this.errorNotification&&(e.getNotification().dismiss(),this.errorNotification=null):StoryLog.TraceTag(596132102,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.error,"Failed to get notification bar")},o.prototype.shareLevelWrapperAttrArgs=function(e){var t={};return t[Aria.Attributes.Label]=Resources.ShareLevelSelectorHeader,t},o.titleId="ShareLevelSelectorVETitleId",o}(TDB.FocusableViewElement);e.ShareLevelSelectorVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=function(){function e(){}return e}();t.AzureMediaUploadResponse=n;var o=function(){function o(){this.MaxFragmentSize=4194304,this.MinFragmentSize=524288,this._fragmentIds=new Array,this._totalUploaded=0}return o.prototype.uploadFragment=function(e,n,i,r){var a=this,s=this.GenerateFragmentId(),l=this.GetUploadUri()+"&comp=block&blockid="+s,c=e.getBlob().slice(i,i+r),d={name:"UploadFragment",description:"Upload the specified fragments of a file",type:o._requestType,headers:{"x-ms-blob-type":"BlockBlob"},data:c,processData:!1,timeout:o._timeout,setInternalHeaders:!1},u=$.ajax(l,d);return Task.fromPromise(u).then(function(){a._totalUploaded+=r,a._fragmentIds.push(s);var e=new t.UploadFragmentResult;return e.ReceivedContentSize=a._totalUploaded,e.UploadInfo=n,e},function(t,n,o){StoryLog.StructuredTraceTag(596473418,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Call to AMS fragment upload failed",{fileName:e.getName(),fileSize:e.getSize().toString(),textStatus:n,errorThrown:o,startIndex:i.toString(),fragmentSize:r.toString()})})},o.prototype.cancelUpload=function(){},o.prototype.getError=function(){var t=new n;return t.Success=!1,t.ErrorMessage=this._asset?this._asset.ErrorMessage:e.Model.SM.UploadCardErrorMessage.Generic,t},o.prototype.GenerateFragmentId=function(){for(var e=this._fragmentIds.length.toString();e.length<5;)e="0"+e;return btoa("block-"+e)},o.prototype.GetUploadUri=function(){var e=this._asset.UploadUri,t=e.indexOf("?");return e.substr(0,t)+"/"+this._uploadFileName+e.substr(t)},o._requestType="PUT",o._timeout=6e4,o}();t.AzureCORSUploadApi=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.Common,n=function(n){function o(){return null!==n&&n.apply(this,arguments)||this}return __extends(o,n),o.prototype.beginUpload=function(t){var n=this;if(!this.validate(t)){StoryLog.TraceTag(596473419,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.error,"Upload of unknown media type");var o=new e.BeginUploadResult;return o.Success=!1,Task.fromResult(o)}this._file=t;var i=this.getStartUploadUri(),r=$.ajax(i,{type:"GET",timeout:e.AzureCORSUploadApi._timeout});return Task.fromPromise(r).then(function(o){n._asset=o;var i=new e.BeginUploadResult;return i.UploadInfo=n._asset.UploadUri,i.Success=o.Success,n._uploadFileName=n._asset.FileName,StoryLog.StructuredTraceTag(21017809,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Call to begin audio AMS upload succeeded",{audioId:n._asset.AudioId,fileName:t.getName(),modelId:n._asset.AudioModelId,assetFileName:o.FileName}),i},function(e,n,o){StoryLog.StructuredTraceTag(596473420,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.warning,"Call to begin audio AMS upload failed",{fileName:t.getName(),textStatus:n,errorThrown:o})})},o.prototype.endUpload=function(t,n){for(var o=this,i=this.GetUploadUri()+"&comp=blocklist",r="<?xml version='1.0' encoding='utf-8'?><BlockList>",a=0;a<this._fragmentIds.length;a++)r+="<Latest>"+this._fragmentIds[a]+"</Latest>";r+="</BlockList>";var s={name:"EndUpload",description:"End the upload session for a file",type:e.AzureCORSUploadApi._requestType,timeout:e.AzureCORSUploadApi._timeout,data:r,setInternalHeaders:!1},l=$.ajax(i,s),c=Task.fromPromise(l).then(function(e){return o.signalUploadDone(o._asset.AudioId,o._file.getModelId())},function(e,t,n){StoryLog.StructuredTraceTag(596473421,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.warning,"Call to AMS audio end upload failed",{assetId:o._asset.AudioId,assetUri:o._asset.UploadUri,textStatus:t,errorThrown:n})});return Task.unwrap(c)},o.prototype.signalUploadDone=function(t,n){if(this.validate(this._file)){var o=this.getUploadDoneUri(t,n),i=$.ajax(o,{type:"POST",data:{audioId:t,audioModelId:n,audioFileLength:this._file.getSize(),fileName:this._file.getOriginalName()},timeout:e.AzureCORSUploadApi._timeout});return Task.fromPromise(i).then(function(t){var n=new e.AzureMediaUploadResponse;return n.Success=t.Success,n.DecompResponse=t.DecompResponse,n.ErrorMessage=t.ErrorMessage,n},function(e,n,o){StoryLog.StructuredTraceTag(596473423,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.warning,"Call to audio signalUploadDone failed",{audioId:t,textStatus:n,errorThrown:o})})}StoryLog.TraceTag(596473422,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.error,"Upload of unknown media type is completed")},o.prototype.validate=function(e){return e.getType().indexOf("audio")>=0},o.prototype.getStartUploadUri=function(){return t.UrlHelper.getInstance().baseStoryUrl(StoryPageSettings.LookupId)+"/audioUploadStart?filename="+encodeURIComponent(t.UrlHelper.getInstance().truncateFileName(this._file.getName()))+"&audioModelId="+this._file.getModelId()},o.prototype.getUploadDoneUri=function(e,n){return t.UrlHelper.getInstance().baseStoryUrl(StoryPageSettings.LookupId)+"/audioUploadDone"},o}(e.AzureCORSUploadApi);e.AzureAudioCORSUploadApi=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.Common,n=function(n){function o(){return null!==n&&n.apply(this,arguments)||this}return __extends(o,n),o.prototype.beginUpload=function(t){var n=this;if(!this.validate(t)){StoryLog.TraceTag(596473413,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.error,"Upload of unknown media type");var o=new e.BeginUploadResult;return o.Success=!1,Task.fromResult(o)}this._file=t;var i=this.getStartUploadUri(),r=$.ajax(i,{type:"GET",timeout:e.AzureCORSUploadApi._timeout});return Task.fromPromise(r).then(function(t){n._asset=t;var o=new e.BeginUploadResult;return o.UploadInfo=n._asset.UploadUri,o.Success=t.Success,n._uploadFileName=n._asset.FileName,o},function(e,n,o){StoryLog.StructuredTraceTag(596473414,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.warning,"Call to begin AMS video upload failed",{fileName:t.getName(),textStatus:n,errorThrown:o})})},o.prototype.endUpload=function(t,n){for(var o=this,i=this.GetUploadUri()+"&comp=blocklist",r="<?xml version='1.0' encoding='utf-8'?><BlockList>",a=0;a<this._fragmentIds.length;a++)r+="<Latest>"+this._fragmentIds[a]+"</Latest>";r+="</BlockList>";var s={name:"EndUpload",description:"End the upload session for a file",type:e.AzureCORSUploadApi._requestType,timeout:e.AzureCORSUploadApi._timeout,data:r,setInternalHeaders:!1},l=$.ajax(i,s),c=Task.fromPromise(l).then(function(e){return o.signalUploadDone(o._asset.VideoId,o._file.getModelId())},function(e,t,n){StoryLog.StructuredTraceTag(596473415,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.warning,"Call to AMS video end upload failed",{assetId:o._asset.VideoId,assetUri:o._asset.UploadUri,textStatus:t,errorThrown:n})});return Task.unwrap(c)},o.prototype.signalUploadDone=function(t,n){if(this.validate(this._file)){var o=this.getUploadDoneUri(t,n),i=$.ajax(o,{type:"POST",data:{videoId:t,videoModelId:n,videoFileLength:this._file.getSize(),fileName:this._file.getOriginalName()},timeout:e.AzureCORSUploadApi._timeout});return Task.fromPromise(i).then(function(t){var n=new e.AzureMediaUploadResponse;return n.Success=t.Success,n.DecompResponse=t.DecompResponse,n.ErrorMessage=t.ErrorMessage,n},function(e,n,o){StoryLog.StructuredTraceTag(596473417,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.warning,"Call to video signalUploadDone failed",{videoId:t,textStatus:n,errorThrown:o})})}StoryLog.TraceTag(596473416,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.error,"Upload of unknown media type is completed")},o.prototype.validate=function(e){return e.getType().indexOf("video")>=0},o.prototype.getStartUploadUri=function(){return t.UrlHelper.getInstance().baseStoryUrl(StoryPageSettings.LookupId)+"/videoUploadStart?filename="+encodeURIComponent(t.UrlHelper.getInstance().truncateFileName(this._file.getName()))+"&videoModelId="+this._file.getModelId()},o.prototype.getUploadDoneUri=function(e,n){return t.UrlHelper.getInstance().baseStoryUrl(StoryPageSettings.LookupId)+"/videoUploadDone"},o}(e.AzureCORSUploadApi);e.AzureVideoCORSUploadApi=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Server.Decomposition.WP,o=StoryApp.Common,i=function(){function e(){this._errorResponse=null,this.MaxFragmentSize=4194304,this.MinFragmentSize=524288}return e.prototype.beginUpload=function(i){var r=this,a=o.UrlHelper.getInstance().beginUploadUrl(i.getName()),s=$.ajax(a,{type:e._requestType,timeout:e._timeout});return Task.fromPromise(s).then(function(e){var o=new t.BeginUploadResult;return null!=e.SessionId&&void 0!=e.SessionId?(o.UploadInfo=e.SessionId,o.Success=!0):(o.Success=!1,r._errorResponse=new n.DecompositionResponse,r._errorResponse.Status="UploadFailed"),o},function(e,t,n){StoryLog.StructuredTraceTag(596473410,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.warning,"Call to begin BITS upload failed",{fileName:i.getName(),fileSize:i.getSize().toString(),textStatus:t,errorThrown:n})})},e.prototype.uploadFragment=function(n,i,r,a){var s=o.UrlHelper.getInstance().uploadFragmentUrl(n.getName(),i,r.toString(),n.getSize().toString()),l=n.getBlob().slice(r,r+a),c=$.ajax(s,{type:e._requestType,data:l,processData:!1,timeout:e._timeout});return Task.fromPromise(c).then(function(e){var n=new t.UploadFragmentResult;return n.ReceivedContentSize=e.ReceivedContentSize,n.UploadInfo=e.SessionId,n},function(e,t,o){StoryLog.StructuredTraceTag(596473411,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Call to BITS fragment upload failed",{fileName:n.getName(),fileSize:n.getSize().toString(),textStatus:t,errorThrown:o,startIndex:r.toString(),fragmentSize:a.toString()})})},e.prototype.endUpload=function(t,n){var i=o.UrlHelper.getInstance().endUploadUrl(t.getName(),n),r=$.ajax(i,{type:e._requestType,timeout:e._timeout});return Task.fromPromise(r).then(function(e){return e},function(e,n,o){StoryLog.StructuredTraceTag(596473412,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.warning,"Call to BITS end upload failed",{fileName:t.getName(),fileSize:t.getSize().toString(),textStatus:n,errorThrown:o})})},e.prototype.cancelUpload=function(){},e.prototype.getError=function(){return this._errorResponse},e._requestType="POST",e._timeout=6e4,e}();t.BitsApi=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(n){var o,i=e.Model.SM,r=e.Model.AuthoringModel,a=e.Model.CSM,s=e.Server.Decomposition.WP,l=DocumentIngestion,c=t.ViewModel;!function(e){e[e.Ok=0]="Ok",e[e.EmptyFileError=1]="EmptyFileError",e[e.FileTooLargeError=2]="FileTooLargeError",e[e.FileTypeError=3]="FileTypeError"}(o=n.FileStatus||(n.FileStatus={}));var d=function(t){function d(e,n){var o=t.call(this,e)||this;return o._args=n,o._thumbnailHandles=[],o._uploadTaskPool=new TaskPool(d._maxConcurrentUploads),o._fileUploader=n.fileUploader,o}return __extends(d,t),d.MaxUploadImageFileCount=function(){return d._maxUploadImageFileCount},d.MaxUploadDocumentCount=function(){return d._maxUploadDocumentCount},d.MaxUploadAudioCount=function(){return d._maxUploadAudioCount},d.MaxUploadVideoCount=function(){return d._maxUploadVideoCount},d.prototype.initThumbnailWorker=function(){var e=window.Worker;!this.webWorker&&e&&Modernizr.webworkers&&(this.webWorker=new e(this._args.commonSettings.NoCdnContentBaseUrl+"UploadWorker_raw.js"))},d.prototype.upload=function(e,t,n,i,r){this.initThumbnailWorker();var a=[],s=[],l=[],c=[],u=0,p=this.getSourceProviderType(i);if(e&&!this.checkUploadLimits(e)){StoryApp.View.Common.DialogManager.getCurrentDialog()||(!this._args.storyPageEditSettings.BlockAuthoring_Audio?ErrorDialog.ShowErrorDialog(Resources.UploadModalDialogErrorCaption,ResourceManager.ResolveString(Resources.UploadModalDialogErrorTooManyFilesAddedMessageWithAudioAndVideo,[d._maxUploadImageFileCount,d._maxUploadVideoCount]),"File Upload Failed: Too many files"):ErrorDialog.ShowErrorDialog(Resources.UploadModalDialogErrorCaption,ResourceManager.ResolveString(Resources.UploadModalDialogErrorTooManyFilesAddedMessage,[d._maxUploadImageFileCount,d._maxUploadVideoCount]),"File Upload Failed: Too many files"));var g=new ClientAction.AddContentUIPaneData(ClientAction.ActionType.Edit_AddContentUI_UploadFileCountExceed,"",p);return g.setContext({FileCount:e&&e.length}),ActionLogger.RecordClientAction(g),c}for(var h=[],C=0;C<e.length;C++){var f=e[C];if(!f||!f.getBlob()||!f.getType()){var m=new ClientAction.InvalidFileUploadData(!!f,!!f.getBlob(),!!f.getType());ActionLogger.RecordClientAction(m)}var y=new ClientAction.AddContentUIPaneData(ClientAction.ActionType.Edit_AddContentUI_UploadFileInfo,"",p);switch(y.setContext({FileSize:f.getSize(),FileType:f.getType(),FileExtension:DocumentIngestion.DocumentIngestionAPI.getFileExtension(f.getName())}),ActionLogger.RecordClientAction(y),c.push(f.getSize()),this.checkFile(f,p)){case o.FileTooLargeError:a.push(f.getName());continue;case o.FileTypeError:s.push(f.getName());continue;case o.EmptyFileError:l.push(f.getName());continue}u+=this.createPlaceholder(f,h,n);var v={file:f,descriptor:t.uploadDescriptor};this.uploadFile(v,n,p,r)}if(0!==h.length){n.addCardObjects(h);var S=[];h.forEach(function(e){return S.push(e.model)}),n.scrollToModelsAndSetFocus(S,!0)}return StoryLog.StructuredTraceTag(596473379,Diag.ULSCat.msoulscat_Story_DocumentImport,Diag.ULSTraceLevel.info,"Number of documents selected for upload",{numberOfDocuments:u.toString()}),void 0!=this._args.context&&void 0!=this._args.onInvalidFile&&(a.length||s.length||l.length)&&this._args.onInvalidFile.call(this._args.context,a,s,l),this.fetchThumbnails(),c},d.prototype.createPlaceholder=function(e,t,o){var a=0,s=new r.CardDefinitionManager(this._args.pageId);if(this._args.storyPageSettings.SupportedMimeTypes.indexOf(e.getType())>=0){var l=void 0,d=void 0,u=void 0,p=void 0,g=void 0,h=void 0;if(e.getType().indexOf("image")>=0){var C={imageContentParts:[],uploadFileName:e.getName()};g=r.currentImageController().get(this._args.pageId).createFromContent({partGroup:null,contentArgs:C}),h=s.getCardDefinition(r.ManualCardType.ImageId),l=(u=(d=new r.Card({model:g,definition:h})).model).getMedia()}else if(e.getType().indexOf("video")>=0){var f={uploadFileName:e.getName()};g=r.currentVideoController().get(this._args.pageId).createFromContent({partGroup:null,contentArgs:f}),h=s.getCardDefinition(r.ManualCardType.VideoId),l=(u=(d=new r.Card({model:g,definition:h})).model).getMedia()}else if(e.getType().indexOf("audio")>=0){var m={uploadFileName:e.getName()};g=r.currentAudioController().get(this._args.pageId).createFromContent({partGroup:null,contentArgs:m}),h=s.getCardDefinition(r.ManualCardType.AudioId),l=(u=(d=new r.Card({model:g,definition:h})).model).getMedia()}else if(e.getType().indexOf("text")>=0){var y=new c.Language,v=o.getActiveCard(),S=v?v.cardParent:void 0;S instanceof n.ClosedCaptionsSocketContainerCardVE&&(y=S.getViewModel().getLanguageForNewChild());var T={uploadFileName:e.getName(),fileName:e.getName(),language:y.getId(),label:void 0};g=r.currentClosedCaptionController().get(this._args.pageId).createFromContent({contentArgs:T}),u=(d=new r.Card({model:g,definition:h})).model}if(l)p=l.id;else{if(!u)return StoryLog.StructuredTraceTag(596473408,Diag.ULSCat.msoulscat_Story_DocumentImport,Diag.ULSTraceLevel.warning,"Unhandled but supported file type during upload.",{type:e.getType()}),a;p=u.id}t.push(d),e.setModelId(p),this._thumbnailHandles.push({file:e})}else{var w=void 0,d=void 0;if(this._args.storyPageEditSettings.BlockAuthoring_DocumentIngestionImportOrEmbedCard){var A={uploadFileName:e.getName()};w=r.currentDocumentContentController().get(this._args.pageId).createFromContent({contentArgs:A}),d=new r.Card({model:w,definition:s.getCardDefinition(r.ManualCardType.DocumentId)})}else{var E={uploadFileName:e.getName(),providerType:i.ContentProvider.MyDevice,extension:DocumentIngestion.DocumentIngestionAPI.getFileExtension(e.getName()),size:e.getSize(),cardState:i.UploadStatus.Uploading};w=r.currentImportingOrEmbeddingDocumentController().get(this._args.pageId).createFromContentWithCardDeck({contentArgs:E},o),d=new r.Card({model:w,definition:s.getCardDefinition(r.ManualCardType.ImportingDocumentId)})}t.push(d),e.setModelId(w.id),a++}return a},d.prototype.checkUploadLimits=function(e){var t=this.countSupportedDocumentFiles(e),n=this.countSupportedFilesOfType("video",e),o=this._args.storyPageEditSettings.BlockAuthoring_Audio?0:this.countSupportedFilesOfType("audio",e);return t<=d._maxUploadDocumentCount&&n<=d._maxUploadVideoCount&&o<=d._maxUploadAudioCount&&e.length<=d._maxUploadImageFileCount+t+n+o},d.prototype.countSupportedDocumentFiles=function(e){for(var t=0,n=0;n<e.length;n++)DocumentIngestion.DocumentIngestionAPI.isFileExtensionSupported(e[n].getName())&&t++;return t},d.prototype.countSupportedFilesOfType=function(e,t){for(var n=0,o=0;o<t.length;o++)t[o].getType().indexOf(e)>-1&&this._args.storyPageSettings.SupportedMimeTypes.indexOf(t[o].getType())>-1&&n++;return n},d.prototype.checkFile=function(e,t){var n=o.Ok,i=DocumentIngestion.DocumentIngestionAPI.isFileExtensionSupported(e.getName())||!this._args.storyPageEditSettings.BlockAuthoring_DocumentIngestionImportOrEmbedCard&&ArrayExtensions.contains(this._args.storyPageEditSettings.DocumentEmbedFormats,DocumentIngestion.DocumentIngestionAPI.getFileExtension(e.getName())),r=e.getType().indexOf("video")>-1,a=e.getType().indexOf("audio")>-1,s=e.getType().indexOf("image")>-1,l=this._args.commonSettings.MaxHttpRequestLength;if(i)l=this._args.commonSettings.DocumentIngestionMaximumDocumentSize,StoryLog.StructuredTraceTag(596473409,Diag.ULSCat.msoulscat_Story_DocumentImport,Diag.ULSTraceLevel.info,"Add document to story",{fileSize:e.getSize().toString(),fileType:e.getType()});else if(s)l=this._args.storyPageEditSettings.SettingService_MaxImageSizeBytes;else if(a){l=this._args.commonSettings.IsAADUser?this._args.storyPageEditSettings.SettingService_MaxLocalUploadAudioSizeAAD:this._args.storyPageEditSettings.SettingService_MaxLocalUploadAudioSizeMSA;var c=new ClientAction.AddContentUIPaneData(ClientAction.ActionType.Edit_AddContentUI_UploadLocalAudio,"",t);ActionLogger.RecordClientAction(c)}else if(r){l=this._args.commonSettings.IsAADUser?this._args.storyPageEditSettings.SettingService_MaxLocalUploadVideoSizeAAD:this._args.storyPageEditSettings.SettingService_MaxLocalUploadVideoSizeMSA;var d=new ClientAction.AddContentUIPaneData(ClientAction.ActionType.Edit_AddContentUI_UploadLocalVideo,"",t,"",this._args.commonSettings.IsAADUser);ActionLogger.RecordClientAction(d)}return e.getSize()>l?n=o.FileTooLargeError:0===e.getSize()&&(n=o.EmptyFileError),-1!=this._args.storyPageSettings.SupportedMimeTypes.indexOf(e.getType())||i||(n=o.FileTypeError),n},d.prototype.fetchThumbnails=function(){var e=this;if(void 0!=window.FileReader&&this.webWorker){if(this._thumbnailHandles.length){var t=this._thumbnailHandles.pop();!function(t,n){t.getType().indexOf("image")>=0?e.webWorker&&(e.webWorker.onmessage=function(t){e.fetchThumbnails()},e.webWorker.postMessage({file:t.getBlob()})):e.fetchThumbnails()}(t.file,t.file.getModelId())}}},d.prototype.safeUploadCallback=function(e){var t=this;return function(n){StoryAppCommon.PageCompartmentManager.getInstance().isCompartmentAvailable(t._args.pageId)&&e(n)}},d.prototype.uploadFile=function(t,n,o,a){var l=this,c=t.file,d=DocumentIngestion.DocumentIngestionAPI.isFileExtensionSupported(c.getName())||!this._args.storyPageEditSettings.BlockAuthoring_DocumentIngestionImportOrEmbedCard&&ArrayExtensions.contains(this._args.storyPageEditSettings.DocumentEmbedFormats,DocumentIngestion.DocumentIngestionAPI.getFileExtension(c.getName())),u=this.safeUploadCallback(function(e){s.DecompositionStatus[e.Status]!==s.DecompositionStatus.Success?(l.logUploadError(c,"upload",o),l._args.context&&l._args.onUploadError&&l._args.onUploadError.call(l._args.context,c.getModelId(),i.UploadCardErrorMessage[e.ErrorMessage])):(l.logUploadSuccess(c,o),l._args.context&&l._args.onDecompUploadComplete&&l._args.onDecompUploadComplete.call(l._args.context,c,e))}),p=this.safeUploadCallback(function(e){e.Success?(l.logUploadSuccess(c,o),l._args.context&&l._args.onDecompUploadComplete&&l._args.onDecompUploadComplete.call(l._args.context,c,e.DecompResponse)):(l.logUploadError(c,"upload",o),l._args.context&&l._args.onUploadError&&l._args.onUploadError.call(l._args.context,c.getModelId(),e.ErrorMessage,a))}),g=this.safeUploadCallback(function(){if(l.logUploadError(c,"upload",o),!l._args.storyPageEditSettings.BlockAuthoring_DocumentIngestionImportOrEmbedCard&&d){var t=r.currentStoryController().get(l._args.pageId).getModel().getModelObject(c.getModelId());r.StoryController.isModelObjectValid(t)&&e.Model.currentUndoManager().get(l._args.pageId).captureIgnorableUpdate(function(){t.setCardState(i.UploadStatus.Error)},t.id)}l._args.context&&l._args.onUploadError&&l._args.onUploadError.call(l._args.context,c.getModelId(),i.UploadCardErrorMessage.Generic,a)});d?this.uploadDocumentHelper(c,n,o,g,a):c.getType().indexOf("video")>=0?this.uploadVideoHelper(c,n,p,u,g,a):c.getType().indexOf("audio")>=0?this.uploadAudioHelper(c,n,p,u,g,a):this._uploadTaskPool.runTask(function(){return l._args.decompService.decomposeUpload(c,t.descriptor)}).then(u,g)},d.prototype.uploadDocumentHelper=function(t,n,o,s,c){var d=this,u=this.safeUploadCallback(function(s){if(d.logUploadSuccess(t,o),!d._args.storyPageEditSettings.BlockAuthoring_DocumentIngestionImportOrEmbedCard){var l=r.currentStoryController().get(d._args.pageId).getModel().getModelObject(t.getModelId());l&&e.Model.currentUndoManager().get(d._args.pageId).captureIgnorableUpdate(function(){l.setCardState(s.uploadStatus===a.ContentState.Ready?i.UploadStatus.Completed:i.UploadStatus.Error)},l.id)}d._args.context&&d._args.onDocumentUploadComplete&&d._args.onDocumentUploadComplete.call(d._args.context,t,s,c);var u=n.getCardForModelId(t.getModelId());!d._args.storyPageEditSettings.BlockAuthoring_DocumentIngestionImportOrEmbedCard&&u&&r.ImportingOrEmbeddingDocumentController.isAutoEmbedExtension(u.getViewModel().getModel().getExtension())&&u.getViewModel().embedDocument()});this._uploadTaskPool.runTask(function(){return d._args.storyPageEditSettings.BlockAuthoring_DocumentIngestionImportOrEmbedCard?l.DocumentIngestionAPI.insertDocumentToStory(t,d._args.storyPageSettings.LookupId):l.DocumentIngestionAPI.insertDocumentToBlob(t,d._args.storyPageSettings.LookupId)}).then(u,s)},d.prototype.uploadVideoHelper=function(e,t,o,r,a,s){if(this._args.commonSettings.IsAADUser)if(this._args.storyPageEditSettings.SettingService_AMSVideoUploadForO365Enabled){var l=this._args.uploaderFactory.createUploader(e,this._uploadTaskPool,new n.AzureVideoCORSUploadApi);l.upload().then(o,a);d=e.getModelId();this._args.uploadManager.addUploadController(d,l)}else void 0!=this._args.context&&void 0!=this._args.onUploadError&&this._args.onUploadError.call(this._args.context,e.getModelId(),i.UploadCardErrorMessage.FeatureDisabled,s);else{var c=this._args.uploaderFactory.createUploader(e,this._uploadTaskPool,new n.BitsApi);c.upload().then(r,a);var d=e.getModelId();this._args.uploadManager.addUploadController(d,c)}},d.prototype.uploadAudioHelper=function(e,t,o,r,a,s){if(this._args.commonSettings.IsAADUser?this._args.storyPageEditSettings.SettingService_AMSAudioUploadForO365Enabled:this._args.storyPageEditSettings.SettingService_AMSAudioUploadForMSAEnabled){var l=this._args.uploaderFactory.createUploader(e,this._uploadTaskPool,new n.AzureAudioCORSUploadApi);l.upload().then(o,a);var c=e.getModelId();this._args.uploadManager.addUploadController(c,l)}else void 0!=this._args.context&&void 0!=this._args.onUploadError&&this._args.onUploadError.call(this._args.context,e,i.UploadCardErrorMessage.FeatureDisabled,s)},d.prototype.logUploadError=function(e,t,n){var o=new ClientAction.AddContentUIPaneData(ClientAction.ActionType.Edit_AddContentUI_UploadFileError,"",n);o.setContext({FileSize:e.getSize(),FileType:e.getType(),Operation:t}),o.setUlsTraceLevel(Diag.ULSTraceLevel.warning),ActionLogger.RecordClientAction(o)},d.prototype.logUploadSuccess=function(e,t){var n=new ClientAction.AddContentUIPaneData(ClientAction.ActionType.Edit_AddContentUI_UploadFileSuccess,"",t);n.setContext({FileSize:e.getSize(),FileType:e.getType()}),ActionLogger.RecordClientAction(n)},d.prototype.getSourceProviderType=function(e){return e||this._fileUploader.getAddContentProviderType()},d._maxConcurrentUploads=5,d._maxUploadImageFileCount=20,d._maxUploadDocumentCount=1,d._maxUploadAudioCount=5,d._maxUploadVideoCount=5,d}(Disposable);n.ContentUploader=d}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function t(){}return t.prototype.createContentUploader=function(t,n){return new e.ContentUploader(t,n)},t}();e.ContentUploaderFactory=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(n){var o=e.Model.SM,i=e.Model.AuthoringModel,r=StoryApp.View.ViewElements,a=e.Model.CSM,s=function(s){function l(o,i){var r=s.call(this,o)||this;r.parent=o,r._cardsContainer=i.cardsContainer;var a={context:r,commonSettings:CommonSettings,decompService:new e.Server.Decomposition.DecompositionAPI,fileUploader:r,onInvalidFile:r.onInvalidFile,onDecompUploadComplete:r.onDecompUploadComplete,onDocumentUploadComplete:r.onDocumentUploadComplete,onUploadError:r.onUploadError,storyPageSettings:StoryPageSettings,storyPageEditSettings:StoryPageEditSettings,uploaderFactory:new n.UploaderFactory,uploadManager:t.ViewModel.UploadManager.getInstance(),pageId:r.parent.getPageId()};return r._contentUploader=i.contentUploaderFactory.createContentUploader(r,a),r}return __extends(l,s),l.prototype.uploadFiles=function(e,t,n){var o=this.getUploadSource();if(o){var i=this._contentUploader.upload(e,o,this._cardsContainer,t,n),r=new ClientAction.FileUploadData(i,o.providerType);ActionLogger.RecordClientAction(r)}else StoryApp.View.ViewElements.NotificationBarViewModel.getNotificationBar(StoryApp.View.ViewElements.ViewModel).addNotification({messages:[{text:Resources.UploadErrorTimeout}],notificationSource:StoryApp.View.ViewElements.NotificationSource.AddContentUpload,notificationType:StoryApp.View.ViewElements.NotificationType.Info},!1)},l.prototype.setAddContentProviderType=function(e){this._currentAddContentProviderType=e},l.prototype.getAddContentProviderType=function(){return this._currentAddContentProviderType},l.prototype.getUploadSource=function(){for(var t,n=e.Server.ContentSourcesManager.currentContentSourcesManager().get(this.parent.getPageId()).getContentSources(),o=0;o<n.length;o++){var i=n[o];if(void 0!=i.uploadDescriptor){t=i;break}}return t},l.prototype.onInvalidFile=function(e,t,o){var i=Resources.UploadModalDialogErrorCaption,a={title:i,description:i,dialogWrapperCssClass:{value:"CenteredDialog"},dialogLogMessage:"File Upload Error",dialogType:r.DialogType.Error,onCancel:function(e,t){},buttonsArgs:[{caption:{value:Resources.ButtonClose},isDefault:!0,id:"ErrorDialogDismiss"}],contentArgs:new TDB.ChildArgs(n.FailedUploadDialogContentVE,{fileTooLargeError:e,fileTypeError:t,emptyFileError:o})};StoryApp.View.Common.DialogManager.createAndShow(a);var s=this.getUploadSource(),l=new ClientAction.AddContentUIPaneData(ClientAction.ActionType.Edit_AddContentUI_UploadInvalidFiles,"",s.providerType);l.setContext({FileTooLargeError:e.length,EmptyFileError:o.length,FileTypeError:t.length}),ActionLogger.RecordClientAction(l)},l.prototype.onDecompUploadComplete=function(e,t){this.handleUploadComplete(e.getModelId(),t)},l.prototype.onDocumentUploadComplete=function(t,n,r){var s,l=this.parent.getPageId(),c=t.getModelId(),d=i.currentStoryController().get(l).getModel().getModelObject(c);if(void 0!=d&&(d instanceof o.DocumentContent||d instanceof o.ImportingOrEmbeddingDocumentContent)&&(o.DocumentContent,s=d),n.uploadStatus==a.ContentState.UploadFailed){e.Model.currentUndoManager().get(l).captureIgnorableUpdate(function(){if(s){var e=s.getUploadInfo();e.setEndAttempt((new Date).toISOString());var t=n.error;e.setErrorMessage(t)}},c),r&&r(!1);var u=StoryApp.View.ViewElements.NotificationBarViewModel.getNotificationBar(StoryApp.View.ViewElements.ViewModel);if(u){if(u.getNotification()&&u.getNotification().getText()==Resources.UploadErrorNotification)return;u.addNotification({messages:[{text:Resources.UploadErrorNotification}],notificationSource:StoryApp.View.ViewElements.NotificationSource.AddContentUpload,notificationType:StoryApp.View.ViewElements.NotificationType.Info})}}else"pdf"===DocumentIngestion.DocumentIngestionAPI.getFileExtension(t.getName())&&s instanceof o.DocumentContent&&DocumentIngestion.DocumentIngestionAPI.showPdfNotification(Resources.DocumentIngestionIntoExistingPdfUserNotification),e.Model.currentUndoManager().get(l).captureIgnorableUpdate(function(){s instanceof o.ImportingOrEmbeddingDocumentContent&&s.setDocumentID(n.documentID)},c),r&&r(!0);this.callStorySync()},l.prototype.handleUploadComplete=function(t,n){var o=this,r=this.parent.getPageId();e.Model.currentUndoManager().get(r).captureIgnorableUpdate(function(){var e=i.ObjectController.getMediaAtom(t,r);if(e&&(!e.getUploadInfo()||""==e.getUploadInfo().getEndAttempt()))for(var a=n.Decomposition.SharedParts,s=n.Decomposition.PartGroups,l=s.length,c=0;c<l;c++){var d=s[c];d.Parts=d.Parts.concat(a),o.populatePlaceholder(e,d)}},t,TDB.Justification.SynchronousBrowserEvent)},l.prototype.populatePlaceholder=function(e,t){var n=this;if(e instanceof o.ImageContent||e instanceof o.VideoContent||e instanceof o.AudioContent||e instanceof o.ClosedCaptionContent){var r=i.currentStoryController().get(this.parent.getPageId()).findParent(e);if(!r)return StoryLog.StructuredTraceTag(596473378,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.warning,"Unable to get parent for decomposed model object",{MediaContentId:e.id}),!1;var a=t.Type,s=new ClientAction.ContentAddedData("MyDevice",a);return ActionLogger.RecordClientAction(s),TDB.applyUpdate(function(){var o=n.getContentSource();i.ObjectController.updateModel(r,t,o?o.providerType:"",n.parent.getPageId()),e.getUploadInfo().setEndAttempt((new Date).toISOString())}),!0}return!1},l.prototype.onUploadError=function(t,n,r){var a=this.parent.getPageId();e.Model.currentUndoManager().get(a).captureIgnorableUpdate(function(){var e=i.ObjectController.getMediaAtom(t,a);if(e){var r=e.getUploadInfo();r.setEndAttempt((new Date).toISOString()),r.setErrorMessage(null!=n?n:o.UploadCardErrorMessage.Generic)}},t),r&&r(!1);var s=StoryApp.View.ViewElements.NotificationBarViewModel.getNotificationBar(StoryApp.View.ViewElements.ViewModel);if(s){if(s.getNotification()&&s.getNotification().getText()==Resources.UploadErrorNotification)return;s.addNotification({messages:[{text:Resources.UploadErrorNotification}],notificationSource:StoryApp.View.ViewElements.NotificationSource.AddContentUpload,notificationType:StoryApp.View.ViewElements.NotificationType.Info})}var l=this.getContentSource(),c=new ClientAction.AddContentUIPaneData(ClientAction.ActionType.Edit_AddContentUI_UploadNotificationOpen,"",l?l.providerType:"");ActionLogger.RecordClientAction(c)},l.prototype.callStorySync=function(){var t=this,n=e.Server.Sync.currentSyncManager().get(this.parent.getPageId());return n.currentlySyncing()?StoryApp.Utilities.waitForTimer(100).then(function(){return t.callStorySync()}):(n.forceSync(),$.Deferred().resolve())},l.prototype.getContentSource=function(){return null},l}(Disposable);n.FileUploader=s}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(){}return e}();e.BeginUploadResult=t;var n=function(){function e(){}return e}();e.UploadFragmentResult=n;var o=function(){function e(e,t,n){this._uploadApi=n;var o=FileObject.getExtension(e.getName());this._file=FileObject.createFromBlob(e.getBlob(),StoryAppCommon.GuidGenerator.generateGuid()+(o?"."+o:""),e.getName()),this._file.setModelId(e.getModelId()),this._completeTrackableActions=0,this._totalTrackableActions=this.calculateTrackableActions(e),this._progress=TDB.watchableTag(596473372,this,0),this._isCancelled=TDB.watchableTag(596473373,this,!1),this._isPaused=TDB.watchableTag(596473374,this,!1),this._isFaulted=TDB.watchableTag(596473375,this,!1),this._isComplete=TDB.watchableTag(596473376,this,!1),this._requestTaskPool=t,this._pauseTaskPool=TaskPool.createTaskMutex()}return e.prototype.upload=function(){var e=this,t=this.executeTrackableAction(function(){return e._uploadApi.beginUpload(e._file)}).then(function(t){return t.Success?e.beginContinuation(t):(e.setIsFaulted(!0),Task.fromResult(e._uploadApi.getError()))},function(){});return Task.unwrap(t)},e.prototype.calculateTrackableActions=function(e){return 2+Math.ceil(e.getSize()/this._uploadApi.MaxFragmentSize)},e.prototype.beginContinuation=function(e){var t=this,n=e.UploadInfo,o=this.uploadFragments(n).then(function(e){return t.fragmentContinuation(n)},function(){});return Task.unwrap(o)},e.prototype.fragmentContinuation=function(e){var t=this;return this.executeTrackableAction(function(){return t._uploadApi.endUpload(t._file,e)})},e.prototype.uploadFragments=function(e){var t=this;return this._currentFragmentSize=this._uploadApi.MaxFragmentSize,Task.unwrap(this.continueUploadFragmentTask(e,0,Math.min(this._file.getSize(),this._currentFragmentSize)).then(function(e){return t.uploadNextFragment(e)},function(){}))},e.prototype.uploadNextFragment=function(e){var t=this,n=this._file.getSize(),o=e.ReceivedContentSize;this.setProgress(100*o/n);var i=Math.ceil((n-o)/this._currentFragmentSize);if(this._totalTrackableActions=this._completeTrackableActions+i+1,o>=n)return Task.fromResult(e);var r=this.calculateNextFragmentSize(o);return Task.unwrap(this.continueUploadFragmentTask(e.UploadInfo,o,r).then(function(e){return t.uploadNextFragment(e)},function(){}))},e.prototype.calculateNextFragmentSize=function(e){var t=this._file.getSize(),n=this._currentFragmentSize;return e+this._currentFragmentSize>t&&(n=t-e),n},e.prototype.continueUploadFragmentTask=function(e,t,n){var o=this,i=new DeferredTask;return this.executeTrackableAction(function(){return o._uploadApi.uploadFragment(o._file,e,t,n)},function(){return o._currentFragmentSize/=2,!(o._currentFragmentSize>=o._uploadApi.MinFragmentSize)&&(StoryLog.StructuredTraceTag(596473377,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.warning,"Fragmented upload failed in all retries",{fileName:o._file.getName(),fileSize:o._file.getSize().toString(),startIndex:t.toString(),fragmentSize:n.toString()}),o._currentFragmentSize=o._uploadApi.MinFragmentSize,!0)}).then(function(e){i.resolve(e)},function(){o.continueUploadFragmentTask(e,t,o.calculateNextFragmentSize(t)).then(function(e){i.resolve(e)},function(){})}),i},e.prototype.incrementTrackableActions=function(){++this._completeTrackableActions===this._totalTrackableActions&&this.setIsComplete(!0)},e.prototype.executeTrackableAction=function(e,t){var n=this,o=new DeferredTask;return this._pauseTaskPool.runTask(function(){return n._requestTaskPool.runTask(e).then(function(e){n._pauseTaskPool.runTask(function(){return n.incrementTrackableActions(),o.resolve(e),Task.fromResult(void 0)})},function(){if(!t||t()){var i=new DeferredTask;i.then(function(i){n.executeTrackableAction(e,t).then(function(e){o.resolve(e)},function(){})},function(){throw StoryApp.RethrowLogger.createError("Faulted task failed")}),n.setIsFaulted(!0),n._retryTask=i}else o.reject()})}),o},e.prototype.setIsPaused=function(e){var t=this;TDB.applyUpdate(function(){t._isPaused.setValue(e)},TDB.Justification.UploadManagement)},e.prototype.isPaused=function(e){return this._isPaused.getWatchedValue(e)},e.prototype.setIsFaulted=function(e){var t=this;TDB.applyUpdate(function(){t._isFaulted.setValue(e)},TDB.Justification.UploadManagement)},e.prototype.isFaulted=function(e){return this._isFaulted.getWatchedValue(e)},e.prototype.setIsComplete=function(e){var t=this;TDB.applyUpdate(function(){t._isComplete.setValue(e)})},e.prototype.isComplete=function(e){return this._isComplete.getWatchedValue(e)},e.prototype.canPauseUpload=function(){return!0},e.prototype.pauseUpload=function(){if(!this._pauseTask){var e=new DeferredTask;this._pauseTaskPool.runTask(function(){return e}),this._pauseTask=e}this.setIsPaused(!0)},e.prototype.resumeUpload=function(){this._pauseTask&&(this._pauseTask.resolve(void 0),this._pauseTask=void 0),this.setIsPaused(!1)},e.prototype.setIsCancelled=function(e){var t=this;TDB.applyUpdate(function(){t._isCancelled.setValue(e)},TDB.Justification.UploadManagement)},e.prototype.cancelUpload=function(){this.pauseUpload(),this._uploadApi.cancelUpload(),this.setIsCancelled(!0)},e.prototype.isCancelled=function(e){return this._isCancelled.getWatchedValue(e)},e.prototype.retryUpload=function(){this._retryTask&&(this._retryTask.resolve(void 0),this._retryTask=void 0),this.setIsFaulted(!1),this.setIsCancelled(!1)},e.prototype.getProgress=function(e){return this._progress.getWatchedValue(e)},e.prototype.setProgress=function(e){var t=this;TDB.applyUpdate(function(){t._progress.setValue(e)})},e}();e.FragmentedUploader=o}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function t(){}return t.prototype.createUploader=function(t,n,o){return new e.FragmentedUploader(t,n,o)},t}();e.UploaderFactory=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(){}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.getUploadControllers=function(t){return this._uploadControllers||(this._uploadControllers=TDB.watchableTag(596473371,e,{})),this._uploadControllers.getWatchedValue(t)},e.prototype.getUploadController=function(e,t){return this.getUploadControllers(t)[e]},e.prototype.addUploadController=function(e,t){this.getUploadControllers()[e]=t,this._uploadControllers.notify()},e.prototype.removeUploadController=function(e){delete this.getUploadControllers()[e]},e}();e.UploadManager=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function t(){}return t.createControllers=function(t){e.currentAgaveController().set(t,new e.AgaveController(t)),e.currentAudioController().set(t,new e.AudioController(t)),e.currentClosedCaptionController().set(t,new e.ClosedCaptionController(t)),e.currentDocumentContentController().set(t,new e.DocumentContentController(t)),e.currentEmbedController().set(t,new e.EmbedController(t)),e.currentGroupController().set(t,new e.GroupController(t)),e.currentHeaderController().set(t,new e.HeaderController(t)),e.currentImageController().set(t,new e.ImageController(StoryApp.Common.UrlHelper.getInstance(),t)),e.currentImportingOrEmbeddingDocumentController().set(t,new e.ImportingOrEmbeddingDocumentController(t)),e.currentSetController().set(t,new e.SetController(t)),e.currentStatusUpdateController().set(t,new e.StatusUpdateController(t)),e.currentTextController().set(t,new e.TextController(t)),e.currentVideoController().set(t,new e.VideoController(StoryApp.Common.UrlHelper.getInstance(),t)),e.currentCodeController().set(t,new e.CodeController(t)),e.currentTableController().set(t,new e.TableController(t))},t}();e.ControllersFactory=t}(e.AuthoringModel||(e.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Server.Decomposition.WP,i=function(){function i(e){this.pageId=e}return i.prototype.create=function(e){throw StoryApp.RethrowLogger.createError("Not implemented by subclass")},i.prototype.createFromContent=function(e){throw StoryApp.RethrowLogger.createError("Not implemented by subclass")},i.prototype.updateFromContent=function(e,t){throw StoryApp.RethrowLogger.createError("Not implemented by subclass")},i.prototype.replaceMediaFromContent=function(e,t){throw StoryApp.RethrowLogger.createError("Not implemented by subclass")},i.createCard=function(e,n,r){var a,s,l=i.getClipType(o.ClipType[e.Type]),c=new t.CardDefinitionManager(r);switch(l){case t.ClipType.StatusUpdate:a=c.getCardDefinition(t.ManualCardType.StatusUpdateId),s=t.currentStatusUpdateController().get(r);break;case t.ClipType.Image:case t.ClipType.WikipediaCard:a=c.getCardDefinition(t.ManualCardType.ImageId),s=t.currentImageController().get(r);break;case t.ClipType.Video:a=c.getCardDefinition(t.ManualCardType.VideoId),s=t.currentVideoController().get(r);break;case t.ClipType.Audio:a=c.getCardDefinition(t.ManualCardType.AudioId),s=t.currentAudioController().get(r);break;case t.ClipType.Document:s=(a=StoryPageEditSettings.BlockAuthoring_DocumentIngestionImportOrEmbedCard?c.getCardDefinition(t.ManualCardType.DocumentId):c.getCardDefinition(t.ManualCardType.ImportingDocumentId)).blueprint.controller;break;case t.ClipType.ClosedCaption:s=t.currentClosedCaptionController().get(r);break;default:throw StoryApp.RethrowLogger.createError("Unknown clip type "+l)}var d=i.createCreationArgs(e,n),u=s.createFromContent(d);return new t.Card({model:u,definition:a})},i.updateModel=function(e,t,n,o){var r=i.getControllerInstanceFromPartGroup(t,o),a=i.createCreationArgs(t,n);r.updateFromContent(e,a)},i.updateMedia=function(e,t,n,o){var r=i.getControllerInstanceFromPartGroup(t,o),a=i.createCreationArgs(t,n);r.replaceMediaFromContent(e,a)},i.getPartFromPartGroup=function(e,t){if(!t||!t.Parts)return[];for(var n=[],i=t.Parts.length,r=o.ClipPartType[e],a=0;a<i;a++){var s=t.Parts[a];s.PartType===r&&n.push(s.Value)}return n},i.createCreationArgs=function(e,r){var a=e.TextParts.firstOrDefault(function(e){return e.TextCategory===o.TextCategory.Title});if(i.getClipType(o.ClipType[e.Type])===t.ClipType.Document){var s=void 0,l=i.getPartFromPartGroup(o.ClipPartType.Extension,e)[0],c=Number(i.getPartFromPartGroup(o.ClipPartType.Size,e)[0]),d=e.TextParts.first(function(e){return e.TextCategory===o.TextCategory.Link});return s={uploadFileName:a.Text+"."+l,downloadLink:d.Text,extension:l,size:c,providerType:n.ContentProvider[r],documentID:JSON.stringify(e.BrowseDescriptor),cardState:n.UploadStatus.Completed},{contentArgs:s}}var u=void 0;u={provider:e.ProviderType,decompProperties:e.Properties,latitude:e.Latitude,longitude:e.Longitude,timestamp:e.Timestamp};var p=e.TextParts.firstOrDefault(function(e){return e.TextCategory===o.TextCategory.Author}),g=e.TextParts.firstOrDefault(function(e){return e.TextCategory===o.TextCategory.Link}),h=e.TextParts.firstOrDefault(function(e){return e.TextCategory===o.TextCategory.Summary}),C=e.TextParts.firstOrDefault(function(e){return e.TextCategory===o.TextCategory.UserName}),f=e.TextParts.firstOrDefault(function(e){return e.TextCategory===o.TextCategory.LicenseName}),m=e.TextParts.firstOrDefault(function(e){return e.TextCategory===o.TextCategory.LicenseLink}),y=e.TextParts.firstOrDefault(function(e){return e.TextCategory===o.TextCategory.AltText});u.author=p?p.Text:void 0,u.attribution=g?g.Text:void 0,u.title=a?a.Text:void 0,u.summary=h?h.Text:void 0,u.authorUserName=C?C.Text:void 0,u.licenseName=f?f.Text:void 0,u.licenseLink=m?m.Text:void 0,u.availability=e.Availability,u.altText=y?y.Text:void 0,u.caption=[];for(var v=0;v<e.TextParts.length;v++){var S=e.TextParts[v];if(S.TextCategory===o.TextCategory.Body){var T=i.getCaptionParagraphFromTextPart(S);T&&u.caption.push(T)}}return{partGroup:e,contentArgs:u}},i.getCaptionParagraphFromTextPart=function(e){if(e&&e.Text){var t={text:e.Text};if(t.textRuns=[],e.TextRuns)for(var n=0;n<e.TextRuns.length;n++){var o={index:e.TextRuns[n].Index,length:e.TextRuns[n].Length,hyperlink:e.TextRuns[n].Url?e.TextRuns[n].Url:void 0,level:e.TextRuns[n].Level,isItalics:void 0!=e.TextRuns[n].IsItalics&&e.TextRuns[n].IsItalics,isQuotation:void 0!=e.TextRuns[n].IsQuotation&&e.TextRuns[n].IsQuotation};t.textRuns.push(o)}return t}return null},i.getClipType=function(e){switch(e){case o.ClipType.Image:return t.ClipType.Image;case o.ClipType.Video:return t.ClipType.Video;case o.ClipType.Audio:return t.ClipType.Audio;case o.ClipType.Text:return t.ClipType.Text;case o.ClipType.StatusUpdate:return t.ClipType.StatusUpdate;case o.ClipType.SuggestedImage:return t.ClipType.Image;case o.ClipType.Map:return t.ClipType.Map;case o.ClipType.Document:return t.ClipType.Document;case o.ClipType.WikipediaCard:return t.ClipType.WikipediaCard;case o.ClipType.ClosedCaption:return t.ClipType.ClosedCaption;default:throw StoryApp.RethrowLogger.createError("Cannot convert "+e+" to organize clip type")}},i.setupMedia=function(e,t,o){if(e.setSourceUrl(void 0!=t.sourceUrl?t.sourceUrl:""),e.setAuthor(void 0!=t.author?t.author:""),e.setTimestamp(void 0!=t.timestamp?t.timestamp:""),e.setTitle(void 0!=t.title?t.title:""),e.setAttribution(void 0!=t.attribution?t.attribution:""),e.setSummary(void 0!=t.summary?t.summary:""),e.setAuthorUserName(void 0!=t.authorUserName?t.authorUserName:""),e.setLicenseName(void 0!=t.licenseName?t.licenseName:""),e.setLicenseLink(void 0!=t.licenseLink?t.licenseLink:""),e.setAvailability(void 0!=t.availability?t.availability:n.ContentAvailability.Free),void 0!=t.longitude&&void 0!=t.latitude){var r=new n.GeoCoordinate;r.setLongitude(t.longitude),r.setLatitude(t.latitude),e.setGeoCoordinate(r)}void 0!=t.uploadFileName&&i.addUploadInfo(e,o,t.uploadFileName);var a=new n.DecompInfo;return e.setDecompInfo(a),a.setDecompProperties(void 0!=t.decompProperties?t.decompProperties:""),a.setProvider(void 0!=t.provider?t.provider:n.ContentProvider.None),a.setVersion(void 0!=t.version?t.version:0),e},i.addUploadInfo=function(t,o,i){var r=new n.UploadInfo;r.setFileName(i||""),r.setStartAttempt((new Date).toISOString());var a=e.Server.Sync.currentSyncManager().get(o);a?r.setClientId(a.getClientId()):StoryLog.TraceTag(596473357,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.error,"ObjectController : addUploadInfo : Sync Manager was not present."),t.setUploadInfo(r)},i.modelIsPlaceholder=function(e){if(!t.StoryController.isModelObjectValid(e))return!1;if(e instanceof n.MediaWithTextComposite){var o=e.getMedia();if(t.MediaController.isMediaEmpty(o))return!o.getUploadInfo()}else if(e instanceof n.StatusUpdateContent)return t.StatusUpdateController.isEmptyStatusUpdate(e);return!1},i.modelIsSwayTitle=function(e,n){return e===t.currentStoryController().get(n).getRootGroup().getHeading()},i.modelIsSectionTitle=function(e,t){return e instanceof n.TitleComposite&&!i.modelIsSwayTitle(e,t)},i.modelIsCaption=function(e,o){var i=t.currentStoryController().get(o).findParent(e);return i instanceof n.MediaWithTextComposite&&i.getText()==e},i.modelIsImage=function(e){return!!t.StoryController.isModelObjectValid(e)&&(e instanceof n.MediaWithTextComposite&&e.getMedia()instanceof n.ImageContent)},i.modelIsVideo=function(e){return!!t.StoryController.isModelObjectValid(e)&&(e instanceof n.MediaWithTextComposite&&e.getMedia()instanceof n.VideoContent)},i.modelIsAudio=function(e){return!!t.StoryController.isModelObjectValid(e)&&(e instanceof n.MediaWithTextComposite&&e.getMedia()instanceof n.AudioContent)},i.modelIsStatusUpdate=function(e){return e instanceof n.StatusUpdateContent},i.modelCanBeBackground=function(e){return i.modelIsImage(e)&&(!t.MediaController.isMediaEmpty(e.getMedia())||null!=e.getMedia().getDecompInfo())},i.getBlueprints=function(e,t,n){var o=[];if(!e||0==e.length)return[];for(var r=e.length,a=0;a<r;a++){var s=i.getBlueprint(e[a],t,n);s&&o.push(s)}return o},i.getBlueprint=function(e,o,r){if(!e)return null;var a=null,s=null;if(e instanceof n.Set){var l=e;a=t.currentSetController().get(o),s={visualization:l.getVisualization(r),modelObject:e}}else if(e instanceof n.TitleComposite)a=t.currentHeaderController().get(o);else if(e instanceof n.SpecifiedGroup)a=t.currentGroupController().get(o);else if(e instanceof n.DocumentContent)a=t.currentDocumentContentController().get(o);else if(e instanceof n.ImportingOrEmbeddingDocumentContent)a=t.currentImportingOrEmbeddingDocumentController().get(o);else if(e instanceof n.StatusUpdateContent)a=t.currentStatusUpdateController().get(o);else if(e instanceof n.EmbeddedContent)a=t.currentEmbedController().get(o);else if(e instanceof n.MediaWithTextComposite)i.modelIsImage(e)?(a=t.currentImageController().get(o),s={modelObject:e}):i.modelIsVideo(e)?a=t.currentVideoController().get(o):i.modelIsAudio(e)&&(a=t.currentAudioController().get(o));else if(e instanceof n.Paragraph||e instanceof n.TextGroup)a=t.currentTextController().get(o);else if(e instanceof n.AgaveContent)a=t.currentAgaveController().get(o);else if(e instanceof n.ClosedCaptionComposite)a=t.currentClosedCaptionController().get(o);else if(e instanceof n.CodeBlock)a=t.currentCodeController().get(o);else{if(!(e instanceof n.Table))return null;a=t.currentTableController().get(o)}return new t.Blueprint({controller:a,modelProperties:s})},i.getCardDefinitionForModelObject=function(e,o){if(!e||!t.StoryController.isModelObjectValid(e))return null;var r=t.currentStoryController().get(o);if(e!==r.getRootGroup()&&!r.findParent(e))return null;var a=new t.CardDefinitionManager(o);if(e instanceof n.Set)switch(e.getVisualization()){case n.Visualization.Stack:return a.getCardDefinition(t.ManualCardType.StackId);case n.Visualization.Comparison:return a.getCardDefinition(t.ManualCardType.ComparisonId);case n.Visualization.UniformGrid:return a.getCardDefinition(t.ManualCardType.UniformGridId);case n.Visualization.Gallery:case n.Visualization.GalleryContinuous:case n.Visualization.GalleryWithThumbs:return a.getCardDefinition(t.ManualCardType.GalleryId);default:return a.getCardDefinition(t.ManualCardType.GroupId)}else{if(e instanceof n.TitleComposite){var s=r.findParent(e),l=s===r.getRootGroup()?t.ManualCardType.TitleId:i.modelIsSection(s,o)?t.ManualCardType.HeaderId:t.ManualCardType.SubHeaderId;return a.getCardDefinition(l)}if(e instanceof n.SpecifiedGroup){l=e===r.getRootGroup()?t.ManualCardType.rootSectionId:i.modelIsSection(e,o)?t.ManualCardType.SectionId:t.ManualCardType.SubSectionId;return a.getCardDefinition(l)}if(e instanceof n.DocumentContent)return a.getCardDefinition(t.ManualCardType.DocumentId);if(e instanceof n.ImportingOrEmbeddingDocumentContent)return a.getCardDefinition(t.ManualCardType.ImportingDocumentId);if(e instanceof n.StatusUpdateContent)return a.getCardDefinition(t.ManualCardType.StatusUpdateId);if(e instanceof n.EmbeddedContent)return a.getCardDefinition(t.ManualCardType.EmbedId);if(e instanceof n.MediaWithTextComposite)return i.modelIsImage(e)?a.getCardDefinition(t.ManualCardType.ImageId):i.modelIsVideo(e)?a.getCardDefinition(t.ManualCardType.VideoId):i.modelIsAudio(e)?a.getCardDefinition(t.ManualCardType.AudioId):null;if(e instanceof n.Paragraph||e instanceof n.TextGroup)return a.getCardDefinition(t.ManualCardType.TextId);if(e instanceof n.AgaveContent)switch(e.getAgaveId()){case t.AgaveController.ChartAgaveId:return a.getCardDefinition(t.ManualCardType.ChartId);default:return null}}return null},i.getControllerInstanceFromPartGroup=function(e,n){var r=i.getClipType(o.ClipType[e.Type]);switch(r){case t.ClipType.StatusUpdate:return t.currentStatusUpdateController().get(n);case t.ClipType.Image:case t.ClipType.WikipediaCard:return t.currentImageController().get(n);case t.ClipType.Video:return t.currentVideoController().get(n);case t.ClipType.Audio:return t.currentAudioController().get(n);case t.ClipType.Document:return StoryPageEditSettings.BlockAuthoring_DocumentIngestionImportOrEmbedCard?t.currentDocumentContentController().get(n):t.currentImportingOrEmbeddingDocumentController().get(n);case t.ClipType.ClosedCaption:return t.currentClosedCaptionController().get(n);default:throw StoryApp.RethrowLogger.createError("Unknown clip type "+r)}},i.calculateActiveEmphasisLevel=function(e,t){for(var o,i=e.length,r=0;r<i;r++){var a=null;if((a=e[r]instanceof n.MediaWithTextComposite?e[r].getMedia().getEmphasis(t):e[r].getEmphasis(t))!=n.EmphasisLevel.Auto&&a!=n.EmphasisLevel.Less||(a=n.EmphasisLevel.None),void 0===o)o=a;else if(o!=a)return null}return o},i.modelSupportsEmphasis=function(e,o,r){if(!t.StoryController.isModelObjectValid(e))return!1;if(this.modelIsAudio(e))return!1;if(e instanceof n.MediaWithTextComposite){var a=t.currentStoryController().get(o).findParent(e);if(a instanceof n.SpecifiedGroup){var s=a.getHeading();return!s||s.getBackground()!=e}}var l=t.currentStoryController().get(o).findParent(e);if(l instanceof n.Set){var c=l.getVisualization(r);if((t.SetController.modelIsImage(e)||t.SetController.modelIsVideo(e))&&null!=c&&c!==n.Visualization.Auto)return!1;if(e instanceof n.TextGroup&&c===n.Visualization.Stack)return!1}return!i.modelIsCaption(e,o)&&(e instanceof n.MediaWithTextComposite||e instanceof n.TextGroup||e instanceof n.StatusUpdateContent||e instanceof n.EmbeddedContent||e instanceof n.Table||e instanceof n.Set&&e.getVisualization(r)!=n.Visualization.Auto||e instanceof n.AgaveContent)},i.modelSupportsEmphasisLevel=function(e,t,o){return!!i.modelSupportsEmphasis(e,o)&&!(e instanceof n.TextGroup&&t===n.EmphasisLevel.Very)},i.modelIsEmpty=function(e,o){return!t.StoryController.isModelObjectValid(e)||(e instanceof n.Paragraph||e instanceof n.TextGroup?t.TextController.isEmpty(e,o):e instanceof n.ImageContent||e instanceof n.VideoContent||e instanceof n.AudioContent?t.MediaController.isMediaEmpty(e,o):e instanceof n.MediaWithTextComposite&&t.MediaController.isMediaEmpty(e.getMedia(o),o))},i.modelIsSection=function(e,n){return!!t.StoryController.isModelObjectValid(e)&&-1!==t.currentStoryController().get(n).getRootGroup().children.getCollection().indexOf(e)},i.getMediaAtom=function(e,o){var i=t.currentStoryController().get(o).getModel().getModelObject(e);if(i)return i instanceof n.ClosedCaptionComposite?i.getContent():i},i}();t.ObjectController=i}(t.AuthoringModel||(t.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=function(o){function i(){return null!==o&&o.apply(this,arguments)||this}return __extends(i,o),i.prototype.canAdd=function(e,n,o){if(!e||0===e.length)return!1;var i=[];return e.forEach(function(e){return i.push(e.model)}),!!t.StoryController.modelObjectsAreValid(i)&&this.canAddBlueprints(e,n,o)},i.prototype.add=function(e,t){throw StoryApp.RethrowLogger.createError("Not implemented by subclass")},i.prototype.canAddBlueprints=function(e,t,n){throw StoryApp.RethrowLogger.createError("Not implemented by subclass")},i.prototype.canTransform=function(e,t){throw StoryApp.RethrowLogger.createError("Not implemented by subclass")},i.prototype.transform=function(e,t){throw StoryApp.RethrowLogger.createError("Not implemented by subclass")},i.prototype.addContent=function(o,i,r){var a=t.currentStoryController().get(this.pageId),s=a.getRootGroup();if(i==s){var l=s.children.getCollection(),c=l.length>0?l[0]:void 0;c&&!c.getHeading()?i=c:(i=a.createGroup(),s.children.add(i,0))}if(a.removeSpecifiedGroupChild(o,void 0,!0),(o instanceof n.TextGroup||o instanceof n.Paragraph)&&i instanceof n.Set){var d=i.getVisualization();(d===n.Visualization.Comparison||d===n.Visualization.Gallery||d===n.Visualization.GalleryContinuous||d===n.Visualization.GalleryWithThumbs||d===n.Visualization.Stack&&!StoryPageEditSettings.TextInStackEnabled)&&TDB.raiseRecoverableError("We're adding a text card to a group that does not support it.")}a.addSpecifiedGroupChild(o,i,r>=0?r:0),o.getContentSource()===e.Model.SM.ContentCreator.DocumentIngestion&&StoryLog.TraceTag(596473370,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Content card created by Document Ingestion has been moved")},i.prototype.removeChildrenToSplit=function(e,o){var i=t.currentStoryController().get(this.pageId).removeSpecifiedGroupChildRange(e,o);if(0==i.length)return i;if(e instanceof n.Set){var r=t.currentSetController().get(this.pageId).copySetAttributes(e);return t.StoryController.addSpecifiedGroupChildRange(i,r),[r]}return i},i}(t.ObjectController);t.ContainerController=o}(t.AuthoringModel||(t.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(n){var o=e.Model.SM,i=function(e){function i(t){return e.call(this,t)||this}return __extends(i,e),i.prototype.add=function(e,t){var r=[];if(e.forEach(function(e){return r.push(e.model)}),this.canAdd(e,t))for(var a=r.length;a--;)if(n.ObjectController.modelIsPlaceholder(t.parent)){if(this.isSupportedModelType(r[a])){var s=r[a],l=t.parent,c=s.getMedia(),d=s.getText(),u=s.getDescription();if(c&&l.setMedia(c),d&&!n.StoryController.containsNullOrEmptyText(d)){var p=t.parent.getText();if(!p||n.StoryController.containsNullOrEmptyText(p))t.parent.setText(d);else{var g="";g=i.modelIsImage(r[a])?n.ManualCardType.ImageId:i.modelIsVideo(r[a])?n.ManualCardType.VideoId:n.ManualCardType.AudioId,ActionLogger.RecordClientAction(new ClientAction.StorylineActionData(ClientAction.ActionType.Storyline_Placeholder_Intent_CaptionThenContent,"User created caption first and then added content",[r[a].id,t.parent.id],[g]))}}u&&l.setDescription(u)}else r[a]instanceof o.TextGroup&&t.parent.setText(r[a]);n.currentStoryController().get(this.pageId).removeSpecifiedGroupChild(r[a])}},i.prototype.isSupportedModelType=function(e){return n.ObjectController.modelIsImage(e)||n.ObjectController.modelIsVideo(e)||n.ObjectController.modelIsAudio(e)},i.prototype.canAdd=function(t,o){var i=[];if(t.forEach(function(e){return i.push(e.model)}),e.prototype.canAdd.call(this,t,o))for(var r=i.length;r--;){var a=i[r];if(!this.isSupportedModelType(a))return!1;var s=a;return!n.ObjectController.modelIsPlaceholder(s)}return!1},i.prototype.canAddBlueprints=function(e,t,n){var o=[];e.forEach(function(e){return o.push(e.definition.blueprint)});for(var i=o.length;i--;)if(!this.canAddBlueprint(o[i],t,n))return!1;return!0},i.prototype.canTransform=function(e,t){return!1},i.isMediaEmpty=function(e,t){var n=0;if(e instanceof o.ImageContent)n=e.imageParts.getCollection(t).length;else if(e instanceof o.VideoContent){var i=e,r=this.calculateVideoPlayerDescriptor(i,t);n=r?r.length:0}else if(e instanceof o.AudioContent){var a=e,s=this.calculateAudioPlayerDescriptor(a,t);n=s?s.length:0}return 0===n},i.getDefaultAltText=function(e,t){if(!e)return"";var i="";if(n.ImageController.calculateSourceUrl(e,t)||e.getSourceUrl()||e instanceof o.AudioContent){var r=e.getTitle(t),a=e.getSummary(t);r&&(i=r),a&&(i&&(i+="\n"),i+=a)}return i},i.getUserDefinedAltText=function(e,t){if(e&&n.StoryController.isModelObjectValid(e)){var o=e.getDescription(t);if(o){var i=o.getContent(t);return i?i.getText(t):void 0}}},i.prototype.calculateSourceUrl=function(e,t){return n.ImageController.calculateSourceUrl(e,t)},i.prototype.getMediaSize=function(e,t){return n.ImageController.getMediaSize(e,t)},i.calculateVideoPlayerDescriptor=function(e,t){return n.StoryController.calculateVideoPlayerDescriptor(e,t)},i.isStoryHostedVideo=function(e,t){var n=e.getDecompInfo(t);if(n){var i=n.getProvider(t);if(null!=i&&(i===o.ContentProvider.Azure||i===o.ContentProvider.OneDrivePro))return!0}return!1},i.calculateAudioPlayerDescriptor=function(e,t){return n.StoryController.calculateAudioPlayerDescriptor(e,t)},i.isStoryHostedAudio=function(e,t){var n=e.getDecompInfo(t);if(n){var i=n.getProvider(t);if(null!=i&&(i===o.ContentProvider.Azure||i===o.ContentProvider.OneDrive||i===o.ContentProvider.OneDrivePro))return!0}return!1},i.prototype.getUploadStatus=function(e,t){return n.StoryController.getUploadStatus(e,t)},i.prototype.isUploadStatusAvailable=function(e){return!0},i.getDecorativeModelProperty=function(e,t){if(n.ObjectController.modelIsImage(e)||n.ObjectController.modelIsVideo(e))return e.getIsDecorative(t);StoryLog.StructuredTraceTag(596473358,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.error,"This method should not be called with a non-image or non-video type",{parentModelObject:e?e.id.toString():"undefined",isValidModelObject:n.StoryController.isModelObjectValid(e).toString()})},i.setDecorativeModelProperty=function(e,o,i){n.ObjectController.modelIsImage(e)||n.ObjectController.modelIsVideo(e)?t.currentUndoManager().get(i).captureUserAction(function(){TDB.applyUpdate(function(){e.setIsDecorative(o)})},"User hit the Decorative button"):StoryLog.StructuredTraceTag(596473359,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.error,"This method should not be called with a non-image type",{parentModelObject:e?e.id.toString():"undefined",isValidModelObject:n.StoryController.isModelObjectValid(e).toString()})},i.getAltTextModel=function(e,t){return e?e.getDescription(t):void 0},i.getAltText=function(e,t){if(!e)return new o.TextBlock;var n=e.getDescription(t);if(n)return n.getContent(t);var r=new o.TextBlock;return r.setText(i.getDefaultAltText(e.getMedia(t))),r},i.setAltText=function(e,t,o){var i=e.getDescription();i?i.setContent(t):(i=n.currentStoryController().get(o).createParagraphsWithText(t.getText()),e.setDescription(i))},i.isUploadingMedia=function(e){if(!(e instanceof o.MediaWithTextComposite))return!1;var t=e;return n.StoryController.getUploadStatus(t.getMedia())!==n.UploadStatus.Completed},i}(n.ContainerController);n.MediaController=i}(t.AuthoringModel||(t.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){function n(){return o||(o=StoryApp.Common.PageCompartmentManager.getInstance().createAccessor("AudioController")),o}var o,i=e.Model.SM,r=e.Server.Decomposition.WP;t.currentAudioController=n;var a=function(e){function n(t){return e.call(this,t)||this}return __extends(n,e),n.prototype.canAddBlueprint=function(e,t,o){return e.controller instanceof n&&!e.modelProperties.placeholder},n.prototype.create=function(e){var n=t.currentStoryController().get(this.pageId).getModel(),o=i.MediaWithTextComposite.Create(n),r=i.AudioContent.Create(n);return o.setMedia(r),o.setText(t.currentStoryController().get(this.pageId).createTextGroup()),o},n.prototype.createFromContent=function(e){if(!e)return null;var o,r,a=t.currentStoryController().get(this.pageId),s=a.getModel();r=i.MediaWithTextComposite.Create(s),o=i.AudioContent.Create(s),this.update(o,e),r.setMedia(o);var l=n.createArgs(e.partGroup,e.contentArgs);return r.setText(a.createTextGroupFromCaptionString(l.caption)),r},n.prototype.updateFromContent=function(e,t){var n=null;if(!e||!t)throw StoryApp.RethrowLogger.createError("Args must not be null");if(e instanceof i.MediaWithTextComposite?n=e.getMedia():e instanceof i.AudioContent&&(n=e),!(n instanceof i.AudioContent))throw StoryApp.RethrowLogger.createError("Audio model media composite does not contain an audio clip");var o=n;this.update(o,t)},n.prototype.update=function(e,o){var r=n.createArgs(o.partGroup,o.contentArgs);if(t.ObjectController.setupMedia(e,r,this.pageId),o.partGroup&&(o.partGroup.ProviderType==i.ContentProvider.OneDrive||o.partGroup.ProviderType==i.ContentProvider.OneDrivePro)){var a=StoryEditPageMain.AzureMediaPlayerDescriptorHandler.generateStoryAudioId(e.id);r.audioPlayerDescriptor=StoryEditPageMain.MediaPlayerDescriptorHandlerFactory.createAudioHandler(o.partGroup.ProviderType).encodeFakeDescriptor(a)}e.setDuration(void 0!=r.duration?r.duration:""),e.setAudioPlayerDescriptor(void 0!=r.audioPlayerDescriptor?r.audioPlayerDescriptor:""),e.setSize(r.size)},n.createArgs=function(e,t){var n=t;if(e){var o=e.TextParts.firstOrDefault(function(e){return e.TextCategory===r.TextCategory.Extension});n.title&&o&&o.Text&&!StoryApp.Utilities.endsWith(n.title,o.Text,!0)&&(n.title=n.title+"."+o.Text);var i=e.Parts.firstOrDefault(function(e){return r.ClipPartType[e.PartType]===r.ClipPartType.AudioPlayerDescriptor}),a=e.TextParts.firstOrDefault(function(e){return e.TextCategory===r.TextCategory.Duration});n.audioPlayerDescriptor=i?i.Value:void 0,n.duration=a?a.Text:void 0;var s=e.TextParts.firstOrDefault(function(e){return e.TextCategory===r.TextCategory.Size});n.size=s?s.Text:void 0}return n},n.AudioSocket=0,n.TextSocket=1,n}(t.MediaController);t.AudioController=a}(t.AuthoringModel||(t.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){function t(){return n||(n=StoryApp.Common.PageCompartmentManager.getInstance().createAccessor("CodeController")),n}var n;e.currentCodeController=t;var o=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.create=function(t){return e.currentStoryController().get(this.pageId).createCodeBlock()},n}(e.ObjectController);e.CodeController=o}(e.AuthoringModel||(e.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){function n(){return o||(o=StoryApp.Common.PageCompartmentManager.getInstance().createAccessor("DocumentContentController")),o}var o,i=DocumentIngestion,r=e.Model.SM;t.currentDocumentContentController=n;var a=function(e){function n(t){return e.call(this,t)||this}return __extends(n,e),n.prototype.createFromContent=function(e){if(!e)return null;var n,o=t.currentStoryController().get(this.pageId).getModel();return n=r.DocumentContent.Create(o),t.ObjectController.setupMedia(n,e.contentArgs,this.pageId),n},n.prototype.createCardFromContent=function(e){if(e){var n=t.currentStoryController().get(this.pageId).getModel(),o=r.DocumentContent.Create(n);return t.ObjectController.setupMedia(o,e.contentArgs,this.pageId),new t.Card({model:o,definition:new t.CardDefinitionManager(this.pageId).getCardDefinition(t.ManualCardType.DocumentId)})}},n.AddLocalDocument=function(e,t,n,o,a){var s=DocumentIngestion.DocumentIngestionAPI.getFileExtension(e),l=function(e){var n;if(e&&1==e.ingested){if(n=new ClientAction.ImportedOrEmbeddedDocumentUI(ClientAction.ActionType.Add_Document_Upload_IngestSuccess,r.ContentProvider[o],s,"The user triggered ingestion of locally uploaded document successfully"),"pdf"==s){var a=VE.NotificationBarViewModel.getNotificationBar(VE.ViewModel.getViewElement());i.DocumentIngestionAPI.showPdfNotification(Resources.DocumentIngestionIntoExistingPdfUserNotification,a)}}else n=new ClientAction.ImportedOrEmbeddedDocumentUI(ClientAction.ActionType.Add_Document_Upload_IngestError,r.ContentProvider[o],s,"Ingesting uploaded document was not successful");n.setContext({DocumentExtension:s,DocumentSize:t}),n.setUlsTraceLevel(Diag.ULSTraceLevel.info),ActionLogger.RecordClientAction(n)},c=function(e,n,i){var a=new ClientAction.ImportedOrEmbeddedDocumentUI(ClientAction.ActionType.Add_Document_Upload_IngestError,r.ContentProvider[o],s,"Ingesting uploaded document was not successful");a.setContext({DocumentExtension:s,DocumentSize:t,ErrorStatus:n,ErrorThrown:i}),a.setUlsTraceLevel(Diag.ULSTraceLevel.info),ActionLogger.RecordClientAction(a)};i.DocumentIngestionAPI.insertDocumentFromBlobToStory(e,StoryPageSettings.LookupId,n,a,t).then(l,c)},n.prototype.addDocument=function(e,t,n,o,r,a){var s=function(n){var o;if(n&&!0===n.ingested){if(o=new ClientAction.AddContentUIPaneData(ClientAction.ActionType.Edit_AddContentUI_IngestFileOneDriveSuccess,"",a),"pdf"===e){var r=VE.NotificationBarViewModel.getNotificationBar(VE.ViewModel.getViewElement());i.DocumentIngestionAPI.showPdfNotification(Resources.DocumentIngestionIntoExistingPdfUserNotification,r)}}else(o=new ClientAction.AddContentUIPaneData(ClientAction.ActionType.Edit_AddContentUI_IngestFileOneDriveError,"",a)).setUlsTraceLevel(Diag.ULSTraceLevel.info);o.setContext({DocumentExtension:e,DocumentSize:t}),ActionLogger.RecordClientAction(o)},l=function(n,o,i){var r=new ClientAction.AddContentUIPaneData(ClientAction.ActionType.Edit_AddContentUI_IngestFileOneDriveError,"",a);r.setContext({DocumentExtension:e,DocumentSize:t,ErrorStatus:o,ErrorThrown:i}),r.setUlsTraceLevel(Diag.ULSTraceLevel.info),ActionLogger.RecordClientAction(r)};i.DocumentIngestionAPI.insertDocumentFromOneDriveToStory(n,StoryPageSettings.LookupId,r,o,e,t).then(s,l)},n}(t.ObjectController);t.DocumentContentController=a}(t.AuthoringModel||(t.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(n){function o(){return i||(i=StoryApp.Common.PageCompartmentManager.getInstance().createAccessor("ImportingOrEmbeddingDocumentController")),i}var i,r=e.Model.SM,a=e.Server.Decomposition.WP;n.currentImportingOrEmbeddingDocumentController=o;var s=function(e){function o(t){return e.call(this,t)||this}return __extends(o,e),o.prototype.createFromContentWithCardDeck=function(e,t){if(!e)return null;var i=n.currentStoryController().get(this.pageId).getModel(),a=r.ImportingOrEmbeddingDocumentContent.Create(i);n.ObjectController.setupMedia(a,e.contentArgs,this.pageId),a.setDownloadLink(e.contentArgs.downloadLink),a.setExtension(e.contentArgs.extension),a.setSize(e.contentArgs.size),a.setProviderType(e.contentArgs.providerType),a.setDocumentID(e.contentArgs.documentID),a.setCardState(void 0!=e.contentArgs.cardState?e.contentArgs.cardState:r.UploadStatus.Completed);var s=a.getDocumentID();return!StoryPageEditSettings.BlockAuthoring_DocumentEmbedding&&a.getCardState()==r.UploadStatus.Completed&&s&&s.length>0&&o.isAutoEmbedExtension(a.getExtension())?this.embedDocument(a,t):a},o.isAutoEmbedExtension=function(e){return!StoryPageEditSettings.BlockAuthoring_DocumentIngestionImportOrEmbedCard&&ArrayExtensions.contains(StoryPageEditSettings.DocumentEmbedFormats,e)&&!ArrayExtensions.contains(CommonSettings.DocumentIngestionFormats,e)&&!ArrayExtensions.contains(CommonSettings.DocumentIngestionExperimentalFormats,e)},o.prototype.embedDocument=function(e,t){t.addCardObjects([new n.Card({model:e,definition:new n.CardDefinitionManager(this.pageId).getCardDefinition(n.ManualCardType.ImportingDocumentId)})]);var o=t.getCardForModelId(e.id);return this.embedDocumentFromCard(o,t)},o.prototype.embedDocumentFromCard=function(e,o){var i,s,l=this,c=e.getViewModel().getModel().getDocumentID(),d=e.getViewModel().getModel().getProviderType(),u=e.getViewModel().getModel().getExtension(),p=e.getViewModel().getModel().getUploadInfo().getFileName(),g=new ClientAction.ImportedOrEmbeddedDocumentUI(ClientAction.ActionType.Add_Document_OneDrive_EmbedButtonClick,r.ContentProvider[d],u,"The user clicked and embedded the document");ActionLogger.RecordClientAction(g);var h=function(e){if(!e||!e.PartGroups||0===e.PartGroups.length)return t.currentUndoManager().get(l.pageId).captureIgnorableUpdate(function(){i.setCardState(r.UploadStatus.Error)},i.id),StoryLog.StructuredTraceTag(596473360,Diag.ULSCat.msoulscat_Story_DocumentImport,Diag.ULSTraceLevel.warning,"Call to create embed document returned invalid response",{}),!1;var s=n.ObjectController.getPartFromPartGroup(a.ClipPartType.Link,e.PartGroups[0])[1];StoryLog.StructuredTraceTag(596473361,Diag.ULSCat.msoulscat_Story_DocumentImport,Diag.ULSTraceLevel.info,"Call to create embed link succeeded",{embedLink:s}),l.updateEmbedCard(i,s,o)},C=function(e,n,o){t.currentUndoManager().get(l.pageId).captureIgnorableUpdate(function(){i.setCardState(r.UploadStatus.Error)},i.id),StoryLog.StructuredTraceTag(596473362,Diag.ULSCat.msoulscat_Story_DocumentImport,Diag.ULSTraceLevel.warning,"Call to create embed document failed",{ErrorStatus:n,ErrorThrown:o})};return t.currentUndoManager().get(this.pageId).captureUserUpdate(function(){e.setFocus();var t={cardState:r.UploadStatus.Uploading,title:p};i=n.currentEmbedController().get(l.pageId).createFromContent({contentArgs:t}),n.ObjectController.addUploadInfo(i,e.getPageId(),p),o.addCardObjects([new n.Card({model:i,definition:new n.CardDefinitionManager(l.pageId).getCardDefinition(n.ManualCardType.EmbedId)})]),(s=o.getCardForModelId(i.id)).setFocus(),e.remove("Embedded document"),d==r.ContentProvider.MyDevice?n.EmbedController.getEmbedLinkFromBlobId(p,c,i.id).then(h,C):n.EmbedController.getEmbedLinkFromOneDrive(c,i.id).then(h,C)},"User is embedding document"),i},o.prototype.updateEmbedCard=function(e,o,i){var a=this;t.currentUndoManager().get(this.pageId).captureIgnorableUpdate(function(){i.getCardForModelId(e.id)?(e.setCardState(r.UploadStatus.Completed),e.getUploadInfo().setEndAttempt((new Date).toISOString()),n.currentEmbedController().get(a.pageId).setEmbedCode(o,e),StoryLog.StructuredTraceTag(596473363,Diag.ULSCat.msoulscat_Story_DocumentImport,Diag.ULSTraceLevel.info,"Embed card updated with the link successfully",{})):StoryLog.StructuredTraceTag(596473364,Diag.ULSCat.msoulscat_Story_DocumentImport,Diag.ULSTraceLevel.info,"Embed card couldn't be updated with the link because it doesn't exist",{})},e.id)},o}(n.ObjectController);n.ImportingOrEmbeddingDocumentController=s}(t.AuthoringModel||(t.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){function n(){return o||(o=StoryApp.Common.PageCompartmentManager.getInstance().createAccessor("AgaveController")),o}var o,i=e.Model.SM;t.currentAgaveController=n;var r=function(e){function n(t){return e.call(this,t)||this}return __extends(n,e),n.prototype.create=function(e){var t={agaveId:n.ChartAgaveId};return this.createFromContent({contentArgs:t})},n.prototype.createFromContent=function(e){if(!e||!e.contentArgs)return null;var n,o=t.currentStoryController().get(this.pageId).getModel();return(n=i.AgaveContent.Create(o)).setAgaveId(e.contentArgs.agaveId),n.setAgaveSettings(""),n.setEmphasis(i.EmphasisLevel.Auto),n},n.ChartAgaveId="0aa5a139-28c0-46ce-ad76-368af51a1b6f",n}(t.ObjectController);t.AgaveController=r}(t.AuthoringModel||(t.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){function n(){return o||(o=StoryApp.Common.PageCompartmentManager.getInstance().createAccessor("TableController")),o}var o,i=e.Model.SM;t.currentTableController=n;var r=function(e){function n(t){return e.call(this,t)||this}return __extends(n,e),n.prototype.create=function(e){return this.createFromContent({contentArgs:{}})},n.prototype.createFromContent=function(e){if(!e||!e.contentArgs)return null;var n=t.currentStoryController().get(this.pageId).getModel();return i.Table.Create(n)},n}(t.ObjectController);t.TableController=r}(t.AuthoringModel||(t.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){function n(){return o||(o=StoryApp.Common.PageCompartmentManager.getInstance().createAccessor("EmbedController")),o}var o,i=e.Model.SM,r=StoryApp.Common;t.currentEmbedController=n;var a=function(n){function o(e){var t=n.call(this,e)||this;return t.cacheAllowedSources(),t}return __extends(o,n),o.prototype.create=function(e,n){void 0===n&&(n=t.ManualCardType.EmbedId);var o={};return this.createFromContent({contentArgs:o},n)},o.prototype.createFromContent=function(e,n){if(void 0===n&&(n=t.ManualCardType.EmbedId),!e||!e.contentArgs)return null;var o,r=t.currentStoryController().get(this.pageId).getModel();return o=i.EmbeddedContent.Create(r),t.ObjectController.setupMedia(o,e.contentArgs,this.pageId),o.setCardState(void 0!=e.contentArgs.cardState?e.contentArgs.cardState:i.UploadStatus.Completed),o.setEmbedCode(n+"://"),o},o.prototype.createEmbedCard=function(){return new t.Card({model:this.createFromContent({contentArgs:{}}),definition:new t.CardDefinitionManager(this.pageId).getCardDefinition(t.ManualCardType.EmbedId)})},o.prototype.isSpecialEmbedCode=function(e){for(var t=0,n=Object.keys(o.specialEmbedSources);t<n.length;t++){var i=n[t];if(o.specialEmbedSources[i].regex.test(e))return!0}return!1},o.prototype.validateIFrame=function(e){if(""==e||this.isSpecialEmbedCode(e))return"";var t,n,i,r;try{var a=this.createIframeNode(e);if(!a)return Resources.EmbedErrorNonIFrameNew;if(t=a.getAttribute("src"),n=a.getAttribute("height"),i=a.getAttribute("width"),null==t)return Resources.EmbedErrorMalformedCode;if(0===t.indexOf("//")&&(t="https:"+t),null!=n&&!o._heightWidthPattern.test(n))return Resources.EmbedErrorMalformedCode;if(null!=i&&!o._heightWidthPattern.test(i))return Resources.EmbedErrorMalformedCode;var s=document.implementation.createHTMLDocument("").createElement("a");s.href=t,r=s.hostname.toUpperCase();var l=s.pathname.toUpperCase();if(null==l)return Resources.EmbedErrorMalformedCode;if(0!=l.indexOf("/")&&(l="/"+l),"WWW.BING.COM"===r&&"http:"===s.protocol&&(t=t.replace(o._httpUrlPattern,"https:")),0!==t.indexOf("https://"))return Resources.EmbedErrorHTTPURL;if(!(CommonSettings.NonWhitelistedEmbedsEnabled&&o._swayIntPattern.test(window.location.href))&&!this.checkIfDomainIsAllowed(r,l))return ActionLogger.RecordClientAction(new ClientAction.EmbedActionData(r,n,i,!1)),Resources.EmbedErrorNonWhitelist}catch(e){return Resources.EmbedErrorMalformedCode}return ActionLogger.RecordClientAction(new ClientAction.EmbedActionData(r,n,i,!0)),""},o.prototype.getNativeContentSource=function(t){if(!t||""==t.trim())return null;var n=this.getIframeHost(t).replace(/^WWW\./,"");if(this.isSpecialEmbedCode(t)){var i=o.specialEmbedSources[n];return{pageType:i.pageType,providerType:i.providerType}}var r=StoryPageEditSettings.HostToProviderMap[n];return r?(r=r.toUpperCase(),e.Server.ContentSourcesManager.currentContentSourcesManager().get(this.pageId).getContentSources().firstOrDefault(function(e){return e.providerType.toUpperCase()===r})):null},o.prototype.getSearchTerm=function(e,t){if(!e||""==e.trim())return null;var n=this.createIframeNode(e);if(!n)return null;var o=n.getAttribute("src");return o?(t.providerType.toUpperCase(),o.trim()):null},o.prototype.checkIfDomainIsAllowed=function(e,t){for(var n in this._embedAllowedSourcePages)if(new RegExp(n,"i").test(e))for(var o=this._embedAllowedSourcePages[n],i=0;i<o.length;i++)if(o[i].test(t))return!0;return!1},o.prototype.cacheAllowedSources=function(){this._embedAllowedSourcePages={};for(var e in StoryPageEditSettings.EmbedAllowedSourcesWithPages){var t=StoryPageEditSettings.EmbedAllowedSourcesWithPages[e],n=this.convertToRegex(e);this._embedAllowedSourcePages[n.source]=new Array;for(var o=0;o<t.length;o++){var i=t[o],r=this.convertToRegex(i);this._embedAllowedSourcePages[n.source].push(r)}}},o.prototype.convertToRegex=function(e){var t=e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1");return t=t.replace(/\\\*/g,".*"),t="^"+t+"$",new RegExp(t,"i")},o.prototype.setEmbedCode=function(e,t){if(t){var n=t.getEmbedCode();TDB.applyUpdate(function(){t.setEmbedCode(e)}),this.updateStrictSizing(e,n,t)}},o.getEmbedLinkFromBlobId=function(e,t,n){var i={};return i.fileName=e,i.documentID=t,i.modelId=n,o.getEmbedLinkRequest(i,r.UrlHelper.getInstance().documentEmbedFromBlobIdUrl(StoryPageSettings.LookupId),"Call to create embed document from blob failed")},o.getEmbedLinkFromOneDrive=function(e,t){var n={};return n.documentID=e,n.modelId=t,o.getEmbedLinkRequest(n,r.UrlHelper.getInstance().documentEmbedFromOneDriveUrl(StoryPageSettings.LookupId),"Call to create embed document from OneDrive failed")},o.getEmbedLinkRequest=function(e,t,n){var o={description:"Method to embed document from Blob to Story.",type:"POST",data:e,dataType:"json",timeout:12e4},i=$.ajax(t,o),r=Task.fromPromise(i);return r.then(function(e){return e},function(e,t,o){StoryLog.StructuredTraceTag(596473369,Diag.ULSCat.msoulscat_Story_DocumentImport,Diag.ULSTraceLevel.warning,n,{ErrorStatus:t,ErrorThrown:o})}),r},o.prototype.updateStrictSizing=function(e,t,n){var o=this.getIframeHost(e);this.getIframeHost(t)===o||n.getStrictSizing()||TDB.applyUpdate(function(){n.setStrictSizing(StoryPageEditSettings.EmbedFixedSizeSources&&ArrayExtensions.contains(StoryPageEditSettings.EmbedFixedSizeSources,o))})},o.prototype.createIframeNode=function(e){var t=document.implementation.createHTMLDocument("").createElement("div");t.innerHTML=e;var n=t.getElementsByTagName("iframe");if(1!=n.length)return null;var o=n[0];return"IFRAME"!=o.nodeName.toUpperCase()?null:o},o.prototype.getIframeHost=function(e){for(var t=0,n=Object.keys(o.specialEmbedSources);t<n.length;t++){var i=n[t];if(o.specialEmbedSources[i].regex.test(e))return i}var r="";try{var a=this.createIframeNode(e);if(a){var s=a.getAttribute("src");if(!s)return"";0===s.indexOf("//")&&(s="https:"+s);var l=document.implementation.createHTMLDocument("").createElement("a");l.href=s,l.href&&(r=l.hostname.toUpperCase())}}catch(e){}return r},o.prototype.resembleIframeCode=function(e){return!!this.isSpecialEmbedCode(e)||!!this.createIframeNode(e)},o._heightWidthPattern=/^[0-9]+(px|%)?$/,o._httpUrlPattern=/^http:/,o._swayIntPattern=/^https:\/\/([A-Za-z0-9\.]+\.)?sway-int\.com(\/[A-Za-z0-9-_]*)?$/,o.specialEmbedSources={"TWITTER.COM":{regex:/^\s*<blockquote class="twitter-tweet".*><\/blockquote>\s*/i,providerType:"Twitter",pageType:PageType.Basic}},o}(t.ObjectController);t.EmbedController=a}(t.AuthoringModel||(t.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){function n(){return o||(o=StoryApp.Common.PageCompartmentManager.getInstance().createAccessor("GroupController")),o}var o,i=e.Model.SM;t.currentGroupController=n;var r=function(o){function r(e){return o.call(this,e)||this}return __extends(r,o),r.prototype.canAddBlueprints=function(e,n,o){if(!e||0===e.length||!n)return!1;if(!(n.parent instanceof i.SpecifiedGroup))return!1;for(var r=t.currentStoryController().get(this.pageId),a=n.parent,s=r.getChildsDepth(a),l=s>0&&void 0!==a.getHeading(o),c=!1,d=0;d<e.length;d++){var u=e[d];if(!u.definition)return!1;var p=u.definition.id;if(StoryPageSettings.BlockService_EmbedDecomp&&p===t.ManualCardType.EmbedId)return!1;if(p===t.ManualCardType.SubSectionId&&s>1)return!1;if(p===t.ManualCardType.SubHeaderId&&!l)return!1;p===t.ManualCardType.SectionId&&(c=!0)}if(r.getRootGroup()===a){if(!c&&0!==n.index&&void 0!==n.index)return!1}else{var g=a.children.getCollection(o).length;if(c&&a.getHeading(o)&&g!==n.index)return!1}return!0},r.prototype.add=function(e,n){if(e&&0!==e.length){if(n){if(n.parent=n.parent||t.currentStoryController().get(this.pageId).getRootGroup(),!(n.parent instanceof i.SpecifiedGroup))throw StoryApp.RethrowLogger.createError("args.parent should be a SpecifiedGroup");n.index=n.index||0}else n={parent:t.currentStoryController().get(this.pageId).getRootGroup(),index:0};StoryPageEditSettings.SubHeadingsEnabled?this.addChildrenCards(e,n):this.addChildren(e,n)}},r.prototype.addChildrenCards=function(e,n){for(var o=t.currentStoryController().get(this.pageId),r=n.parent,a=n.index,s=e.length-1;s>=0;s--)if(t.StoryController.isModelObjectValid(e[s].model)){var l=e[s],c=l.model,d=l.definition.id,u=o.findParent(c);r===u&&-1!==t.StoryController.getPrimaryCollection(u).getCollection().indexOf(c)&&a>t.StoryController.getPrimaryCollection(u).getCollection().indexOf(c)&&!(c instanceof i.TitleComposite)&&a--,!!u&&o.removeSpecifiedGroupChild(c,u,!0),c instanceof i.TitleComposite?this.addHeaderCard(l,r,a):d===t.ManualCardType.SectionId?this.addSection(c,r,a):d===t.ManualCardType.SubSectionId?this.addSubsection(c,r,a):this.addContentCard(c,r,a)}o.pruneEmptyGroups(),o.pruneHeaderlessGroup()},r.prototype.addHeaderCard=function(e,n,o){var i=e.model,r=e.definition.id===t.ManualCardType.HeaderId?t.ManualCardType.SectionId:t.ManualCardType.SubSectionId,a=this.createSectionWithHeader(i);r===t.ManualCardType.SectionId?this.addSection(a,n,o):this.addSubsection(a,n,o)},r.prototype.addSubsection=function(n,o,r){var a=t.currentStoryController().get(this.pageId),s=t.StoryController.getHeaderlessGroup(this.pageId),l=o===a.getRootGroup()&&0===r,c=o===s;if(l||c)if((g=this.createSectionWithHeader()).children.add(n),l)a.addSpecifiedGroupChild(g,a.getRootGroup(),0),s&&((d=s.children.getCollection()).forEach(function(e){return n.children.add(e)}),a.removeSpecifiedGroupChild(s,a.getRootGroup()));else{a.addSpecifiedGroupChild(g,a.getRootGroup(),1);for(var d=s.children.getCollection(),u=r;u<d.length;u++)a.moveSpecifiedGroupChild(d[u],s,n.children.getCollection().length,n,!0)}else if(o===a.getRootGroup()){var p=a.getRootGroup().children.getCollection()[r-1];a.addSpecifiedGroupChild(n,p)}else if(1===a.getChildsDepth(o)){a.addSpecifiedGroupChild(n,o,r);for(var d=o.children.getCollection(),u=r+1;u<d.length&&!(d[u]instanceof i.SpecifiedGroup);u++)a.moveSpecifiedGroupChild(d[u],o,n.children.getCollection().length,n,!0)}else{var g=a.findParent(o),h=g.children.getCollection().indexOf(o),d=o.children.getCollection();a.addSpecifiedGroupChild(n,g,h+1);for(u=r;u<d.length;u++)a.moveSpecifiedGroupChild(d[u],o,n.children.getCollection().length,n,!0)}n.getContentSource()===e.Model.SM.ContentCreator.DocumentIngestion&&StoryLog.StructuredTraceTag(596460873,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Subsection card created by Document Ingestion has been moved",{SubsectionId:n.id.toString()})},r.prototype.addSection=function(n,o,i){var r=t.currentStoryController().get(this.pageId);if(o===r.getRootGroup()){var a=t.StoryController.getHeaderlessGroup(this.pageId);if(r.addSpecifiedGroupChild(n,r.getRootGroup(),i),0===i&&a)for(var s=r.getLastGroup(n)||n,l=a.children.getCollection(),c=0;c<l.length;c++)r.moveSpecifiedGroupChild(l[c],a,s.children.getCollection().length,s,!0)}else if(1===r.getChildsDepth(o)){var l=o.children.getCollection(),d=r.getRootGroup().children.getCollection().indexOf(o);r.addSpecifiedGroupChild(n,r.getRootGroup(),d+1);for(var s=r.getLastGroup(n)||n,c=i;c<l.length;c++)r.moveSpecifiedGroupChild(l[c],o,s.children.getCollection().length,s,!0)}else{var u=o.children.getCollection(),p=r.findParent(o),g=p.children.getCollection(),h=p.children.getCollection().indexOf(o),C=r.getRootGroup().children.getCollection().indexOf(p);r.addSpecifiedGroupChild(n,r.getRootGroup(),C+1);for(c=i;c<u.length;c++){var f=r.getLastGroup(n)||n;r.moveSpecifiedGroupChild(u[c],o,f.children.getCollection().length,f,!0)}for(c=h+1;c<g.length;c++)r.moveSpecifiedGroupChild(g[c],p,n.children.getCollection().length,n,!0)}n.getContentSource()===e.Model.SM.ContentCreator.DocumentIngestion&&StoryLog.StructuredTraceTag(596460874,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Section card created by Document Ingestion has been moved",{SectionId:n.id.toString()})},r.prototype.addContentCard=function(n,o,i){var r=t.currentStoryController().get(this.pageId);if(o===r.getRootGroup())if(0===i){var a=t.StoryController.getHeaderlessGroup(this.pageId);a||(a=r.createGroup(),r.addSpecifiedGroupChild(a,r.getRootGroup(),0)),r.addSpecifiedGroupChild(n,a,0)}else{var s=r.getRootGroup().children.getCollection()[i-1],l=r.getLastGroup(s);l?r.addSpecifiedGroupChild(n,l):r.addSpecifiedGroupChild(n,s)}else if(1===r.getChildsDepth(o))if(0===i)r.addSpecifiedGroupChild(n,o,0);else{var c=r.getLastGroup(o,i);c?r.addSpecifiedGroupChild(n,c):r.addSpecifiedGroupChild(n,o,i)}else r.addSpecifiedGroupChild(n,o,i);n.getContentSource()===e.Model.SM.ContentCreator.DocumentIngestion&&StoryLog.StructuredTraceTag(596460875,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Content card created by Document Ingestion has been moved",{CardId:n.id.toString()}),o.getContentSource()===e.Model.SM.ContentCreator.DocumentIngestion&&StoryLog.StructuredTraceTag(596460876,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Card added to section created by Document Ingestion",{ParentId:o.id.toString()})},r.prototype.addChildren=function(e,n){if(this.canAdd(e,n)){var o=[];e.forEach(function(e){return o.push(e.model)});for(var r=n.index?n.index:0,a=n.parent,s=t.currentStoryController().get(this.pageId),l=0;l<o.length;l++){var c=o[l],d=s.findParent(c);a===d&&-1!==t.StoryController.getPrimaryCollection(d).getCollection().indexOf(c)&&r>t.StoryController.getPrimaryCollection(d).getCollection().indexOf(c)&&!(c instanceof i.TitleComposite)&&r--,c instanceof i.SpecifiedGroup?(this.addGroup(c,a,r),r=(a=c).children.getCollection().length-1):c instanceof i.TitleComposite?(a=this.addHeader(c,a,r),r=-1):this.addContent(c,a,r),r++}s.pruneEmptyGroups()}},r.prototype.addGroup=function(e,o,r){if(StoryPageEditSettings.SubHeadingsEnabled){var a={destinationParent:o,destinationIndex:r,subsumeSourceSiblings:!1};n().get(this.pageId).moveGroup(e,a)}else{var s=o,l=r,c=t.currentStoryController().get(this.pageId),d=c.findParent(s),u=c.getRootGroup();if(c.removeSpecifiedGroupChild(e),o==u){var p=u.children.getCollection();if(p.length>r){var g=p[r];if(g instanceof i.SpecifiedGroup&&null==g.getHeading()){h=this.removeChildrenToSplit(g,0);t.StoryController.addSpecifiedGroupChildRange(h,e,e.children.getCollection().length)}}s=u}else for(;d;){var h=this.removeChildrenToSplit(s,l);t.StoryController.addSpecifiedGroupChildRange(h,e,e.children.getCollection().length),l=t.StoryController.getPrimaryCollection(d).getCollection().indexOf(s)+1,s=d,d=c.findParent(s)}c.addSpecifiedGroupChild(e,s,l)}},r.prototype.addHeader=function(n,o,i){var r=t.currentStoryController().get(this.pageId),a=r.findContainingCollection(o),s=null==a,l=r.findParent(n),c=null,d=0;if(StoryPageEditSettings.SubHeadingsEnabled){var u=t.StoryController.getPrimaryCollection(o);c=this.createNewGroupForHeader(n,u,i);var p={destinationParent:o,destinationIndex:i};this.moveGroup(c,p)}else if(s){var g=r.getRootGroup().children.getCollection()[0];if(g&&!g.getHeading()){if(g.setHeading(n),c=g,l){h=r.removeSpecifiedGroupChildRange(l,i);t.StoryController.addSpecifiedGroupChildRange(h,c),r.removeSpecifiedGroupChild(l)}}else a=r.getRootGroup().children,c=this.createNewGroupForHeader(n,a,0)}else{if(d=a.getCollection().indexOf(o)+1,c=this.createNewGroupForHeader(n,a,d),o){var h=r.removeSpecifiedGroupChildRange(o,i);t.StoryController.addSpecifiedGroupChildRange(h,c)}if(l){var C=a.getCollection().indexOf(l);if(C>0){var f=a.getCollection()[C-1];t.StoryController.addSpecifiedGroupChildRange(l.children.getCollection(),f),r.removeSpecifiedGroupChild(l)}}}return n.getContentSource()===e.Model.SM.ContentCreator.DocumentIngestion&&StoryLog.TraceTag(596473368,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Heading card created by Document Ingestion has been moved"),c},r.prototype.moveGroup=function(e,n){var o=t.currentStoryController().get(this.pageId),i=o.findParent(n.destinationParent),a=i?i.children.getCollection().indexOf(n.destinationParent):-1,s=n.destinationParent===o.getRootGroup(),l=o.findParent(e),c=l?l.children.getCollection().indexOf(e):-1,d=t.StoryController.getPrimaryCollection(n.destinationParent);if(t.StoryController.isModelObjectValid(e)&&n.destinationParent&&!(n.destinationIndex<0)&&!(d&&n.destinationIndex>d.getCollection().length)){o.removeSpecifiedGroupChild(e);var u=o.getRootGroup().children.getCollection()[0];if(s&&0===n.destinationIndex&&u&&!u.getHeading()){var p=o.findPreviousAtomInsertionPosition({parent:e,index:e.children.getCollection().length+1}),g=o.removeSpecifiedGroupChildRange(u,0);t.StoryController.addSpecifiedGroupChildRange(g,p.parent,p.index),o.removeSpecifiedGroupChild(u)}else{var h=r.findNextGroup(n.destinationParent,n.destinationIndex),C=h?n.destinationParent.children.getCollection().indexOf(h)-n.destinationIndex:n.destinationParent.children.getCollection().length-n.destinationIndex,p=o.findPreviousAtomInsertionPosition({parent:e,index:e.children.getCollection().length+1}),g=o.removeSpecifiedGroupChildRange(n.destinationParent,n.destinationIndex,C);if(t.StoryController.addSpecifiedGroupChildRange(g,p.parent,p.index),n.subsumeSourceSiblings&&c>-1){var f=o.removeSpecifiedGroupChildRange(l,c);t.StoryController.addSpecifiedGroupChildRange(f,e)}n.destinationParent.getHeading()||(n.destinationParent=i,n.destinationIndex=a+1)}return o.addSpecifiedGroupChild(e,n.destinationParent,n.destinationIndex),!n.noFlattening&&StoryPageEditSettings.SubHeadingsLimit<=o.getChildsDepth(n.destinationParent)+o.getDescendantMaxDepth(e,!1)&&this.flattenGroup(n.destinationParent,StoryPageEditSettings.SubHeadingsLimit-o.getChildsDepth(n.destinationParent)),e}},r.prototype.flattenGroup=function(e,n){if(void 0===n&&(n=0),!(!t.StoryController.isModelObjectValid(e)||n<0||this.isRootGroup(e)&&n<1))for(var o=1,i=r.findNextGroup(e,0),a=e,s=t.currentStoryController().get(this.pageId),l=s.findParent(a),c=l?r.findNextGroup(l,l.children.getCollection().indexOf(a)+1):void 0,d=500;d>0&&(a!=l||i!=c);d--){var u=s.findParent(a),p=u?u.children.getCollection().indexOf(a):-1;if(i){var g=r.findNextGroup(i,0);if(g)o++,a=i,i=g;else{if(o>n){var h={destinationParent:u,destinationIndex:p+1,subsumeSourceSiblings:!0,noFlattening:!0};this.moveGroup(i,h)}var C=a.children.getCollection().indexOf(i);i=r.findNextGroup(a,C+1)}}else o--,i=r.findNextGroup(u,p+1),a=u}},r.prototype.findSocket=function(e){for(var n=void 0,o=0;o<e.length;o++){var a=t.currentStoryController().get(this.pageId).findParent(e[o]);if(!(a instanceof i.SpecifiedGroup))return;var s=a;if(e[o]==s.getHeading()){if(void 0==n)n=r.headerSocket;else if(n!=r.headerSocket)return}else if(ArrayExtensions.contains(s.children.getCollection(),e[o]))if(void 0==n)n=r.childrenSocket;else if(n!=r.childrenSocket)return}return n},r.findPreviousGroup=function(e,n){if(t.StoryController.isModelObjectValid(e)&&e.children&&!(n<1)){var o=e.children.getCollection();if(o)for(var r=(n=n>o.length?o.length:n)-1;r>=0;r--)if(o[r]instanceof i.SpecifiedGroup)return o[r]}},r.findNextGroup=function(e,n){if(t.StoryController.isModelObjectValid(e)&&e.children){var o=e.children.getCollection();if(o&&!(n>o.length-1))for(var r=n=n<0?0:n;r<o.length;r++)if(o[r]instanceof i.SpecifiedGroup)return o[r]}},r.prototype.isRootGroup=function(e){return 0===t.currentStoryController().get(this.pageId).getChildsDepth(e)},r.prototype.createNewGroupForHeader=function(e,n,o){var i=t.currentStoryController().get(this.pageId),r=i.createGroup(),a=i.findParent(e);return TDB.applyUpdate(function(){n.add(r,o),a&&a.setHeading(null),r.setHeading(e)}),r},r.prototype.createSectionWithHeader=function(e){var n=t.currentStoryController().get(this.pageId);e=e||n.createEmptyTitle();var o=n.createGroup();return o.setHeading(e),o},r.isHeaderlessGroup=function(e){return!!t.StoryController.isModelObjectValid(e)&&(e instanceof i.SpecifiedGroup&&!e.getHeading())},r.headerSocket=0,r.childrenSocket=1,r}(t.ContainerController);t.GroupController=r}(t.AuthoringModel||(t.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(n){function o(){return i||(i=StoryApp.Common.PageCompartmentManager.getInstance().createAccessor("HeaderController")),i}var i,r=e.Model.SM;n.currentHeaderController=o;var a=function(e){function o(t){return e.call(this,t)||this}return __extends(o,e),o.prototype.create=function(e){return n.currentStoryController().get(this.pageId).createEmptyTitle()},o.prototype.canAddBlueprints=function(e,t,i){var a=[];return e.forEach(function(e){return a.push(e.definition.blueprint)}),t.socket==o.BackgroundSocket&&(t.parent instanceof r.TitleComposite&&(!(!a||1!=a.length)&&(a[0].controller instanceof n.ImageController&&!a[0].modelProperties.placeholder)))},o.prototype.add=function(e,t){var o=[];if(e.forEach(function(e){return o.push(e.model)}),this.canAdd(e,t)){var i=t.parent;i.getBackground()!=o[0]&&(n.currentStoryController().get(this.pageId).removeSpecifiedGroupChild(o[0]),i.setBackground(o[0]),ActionLogger.RecordClientAction(new ClientAction.ActionData(ClientAction.ActionType.Storyline_AddHeadingBackground)))}},o.prototype.canTransform=function(e,t){if(!e||1!=e.length&&2!=e.length)return!1;var o=e,i=!1;if(1==e.length&&e[0]instanceof r.Set){var a=e[0].content.getCollection();if(a.length>2)return!1;o=a,i=!0}for(var s=n.currentStoryController().get(this.pageId),l=!1,c=!1,d=o.length,u=0;u<d;u++){if(!i&&s.findParent(o[u])instanceof r.Set)return!1;var p=void 0,g=s.findContainingGroup(o[u]);if(g&&g.storyModel.getModelObject(g.id)&&(p=g.getHeading()),o[u]instanceof r.TextGroup){if(l)return!1;l=!0}else if(o[u]instanceof r.Paragraph){var h=o[u];if(p&&p.getTitle()==o[u])return!1;if(n.currentTextController().get(this.pageId).isParentAList(h))return!1;var C=s.findParent(o[u]);if(C instanceof r.TextGroup&&s.findParent(C)instanceof r.Set)return!1;if(l)return!1;l=!0}else{if(!n.StoryController.groupChildHasImageContent(o[u]))return!1;if(p&&p.getBackground()==o[u])return!1;if(c)return!1;c=!0}}return!0},o.prototype.transform=function(e,t){if(!this.canTransform(e))return null;var o=e,i=null;1==e.length&&e[0]instanceof r.Set&&(o=(i=e[0]).content.getCollection());for(var a=null,s=null,l=!1,c=o.length,d=0;d<c;d++)if(o[d]instanceof r.TextGroup){for(var u=o[d].children.getCollection(),p=0;p<u.length;p++)if(u[p]instanceof r.Paragraph){a=u[p],l=!s;break}}else o[d]instanceof r.Paragraph?(a=o[d],l=!s):n.StoryController.groupChildHasImageContent(o[d])&&(s=o[d],l=null!=a);return this.transformContentToTitle(a,s,l,i)},o.prototype.transformContentToTitle=function(e,t,o,i){var a=null,s=null,l=[],c=0,d=n.currentStoryController().get(this.pageId);if(e){if(!(s=d.findParent(e)))return void StoryLog.StructuredTraceTag(596473365,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.error,"We failed to transform into a title because we couldn't find given paragraph model's parent",{paragraphId:e.id,isParagraphValid:n.StoryController.isModelObjectValid(e).toString()});c=(l=s.children.getCollection()).indexOf(e)}var u=s&&o?s:t,p=null,g=null;i?(p=d.findContainingGroup(i),g=i):(p=d.findParent(u),g=u);var h=d.findParent(p);if(p&&h){for(var C=p.children.getCollection(),f=C.indexOf(g),m=d.createGroup(),y=p;d.getChildsDepth(y)>1;)y=d.findParent(y);var v=d.getRootGroup();if(v.children.add(m,v.children.getCollection().indexOf(y)+1),e&&c<l.length-1){var S=d.createTextGroup(!1);m.children.add(S);for(A=c+1;A<l.length;A++)d.removeSpecifiedGroupChild(l[A],s),S.children.add(l[A])}e?(a=r.TitleComposite.Create(e.storyModel),m.setHeading(a),d.removeSpecifiedGroupChild(e,s),a.setTitle(e),0!=s.children.getCollection().length||i||p.children.remove(s)):(n.StoryController.setTitleForGroup(m,""),a=m.getHeading()),t&&(d.removeSpecifiedGroupChild(t),a.setBackground(t));for(var T=p,w=g;T!==v;){for(var A=f+1;A<C.length;A++){var E=C[A];E!==e&&E!==t&&(d.removeSpecifiedGroupChild(E,T,!0),m.children.add(E))}w=T,f=(C=(T=d.findParent(T)).children.getCollection()).indexOf(w)}return i&&d.removeSpecifiedGroupChild(i,p),d.removeGroupIfEmpty(p,h),a}StoryLog.StructuredTraceTag(596473366,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.warning,"We failed to turn transform into a title since we don't have a parent or grandparent.",{parentId:p?p.id:void 0,grandParentId:h?h.id:void 0,paragraphId:e?e.id:void 0,backgroundId:t?t.id:void 0,wrappingSetId:i?i.id:void 0,firstElementId:u?u.id:void 0,groupChildId:g?g.id:void 0,isWrappingSetValid:n.StoryController.isModelObjectValid(i).toString(),isFirstElementValid:n.StoryController.isModelObjectValid(u).toString()})},o.modelIsTitleBackground=function(e,t){if(!(t instanceof r.SpecifiedGroup))return!1;var n=t.getHeading();return!!n&&(e instanceof r.MediaWithTextComposite&&e.getMedia()instanceof r.ImageContent&&e==n.getBackground())},o.prototype.getHeadingType=function(e){return this.isRootHeading(e)?n.ManualCardType.TitleId:this.isSubheading(e)?n.ManualCardType.SubHeaderId:n.ManualCardType.HeaderId},o.prototype.isRootHeading=function(e){var t=n.currentStoryController().get(this.pageId).findParent(e);return t instanceof r.SpecifiedGroup&&n.currentGroupController().get(this.pageId).isRootGroup(t)},o.prototype.isSubheading=function(e){var t=n.currentStoryController().get(this.pageId),o=t.findParent(e);return 2===t.getChildsDepth(o)},o.prototype.canBePromoted=function(e){return!(!n.StoryController.isModelObjectValid(e)||!StoryPageEditSettings.SubHeadingsEnabled)&&((e instanceof r.SpecifiedGroup||e instanceof r.TitleComposite)&&!(n.currentStoryController().get(this.pageId).getChildsDepth(e)<(e instanceof r.SpecifiedGroup?2:3)))},o.prototype.promoteHeader=function(e){var o=this;if(this.canBePromoted(e)){var i=n.currentStoryController().get(this.pageId),r=i.findContainingGroup(e),a=r?i.findParent(r):null,s=a?i.findParent(a):null,l=a?i.findContainingCollection(a):null,c=l?l.getCollection().indexOf(a):-1;c<0||t.currentUndoManager().get(this.pageId).captureUserUpdate(function(){var e={destinationParent:s,destinationIndex:c+1,subsumeSourceSiblings:!0};n.currentGroupController().get(o.pageId).moveGroup(r,e)},"User pressed promoted a heading")}},o.prototype.canBeDemoted=function(e){if(!n.StoryController.isModelObjectValid(e)||!StoryPageEditSettings.SubHeadingsEnabled)return!1;if(!(e instanceof r.SpecifiedGroup||e instanceof r.TitleComposite))return!1;var t=n.currentStoryController().get(this.pageId),o=e instanceof r.TitleComposite?-1:0;if(StoryPageEditSettings.SubHeadingsLimit<=t.getChildsDepth(e)+t.getDescendantMaxDepth(e,!1)+o)return!1;var i=t.findContainingGroup(e),a=i?t.findParent(i):null,s=a?a.children.getCollection().indexOf(i):-1,l=n.GroupController.findPreviousGroup(a,s);return!(!l||!l.getHeading())},o.prototype.demoteHeader=function(e){var o=this;if(this.canBeDemoted(e)){var i=n.currentStoryController().get(this.pageId),r=i.findContainingGroup(e),a=r?i.findParent(r):null,s=a?a.children.getCollection().indexOf(r):-1,l=n.GroupController.findPreviousGroup(a,s);l&&t.currentUndoManager().get(this.pageId).captureUserUpdate(function(){var e={destinationParent:l,destinationIndex:l.children.getCollection().length};n.currentGroupController().get(o.pageId).moveGroup(r,e)},"User pressed demoted a heading")}},o.BackgroundSocket=0,o}(n.ContainerController);n.HeaderController=a}(t.AuthoringModel||(t.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(n){function o(){return i||(i=StoryApp.Common.PageCompartmentManager.getInstance().createAccessor("ImageController")),i}var i,r=e.Model.SM,a=e.Server.Decomposition.WP;n.currentImageController=o;var s=function(o){function i(e,t){var n=o.call(this,t)||this;return n.urlHelper=e,n}return __extends(i,o),i.prototype.canAddBlueprint=function(e,t,n){return e.controller instanceof i&&!e.modelProperties.placeholder},i.prototype.create=function(e){var t=n.currentStoryController().get(this.pageId),o=t.getModel(),i=r.MediaWithTextComposite.Create(o),a=r.ImageContent.Create(o);return i.setMedia(a),i.setText(t.createTextGroup()),i},i.prototype.createFromContent=function(e){if(!e)return null;var t=n.currentStoryController().get(this.pageId),o=t.getModel(),a=r.MediaWithTextComposite.Create(o),s=r.ImageContent.Create(o,e.imageContentId);this.update(a.id,s,e),a.setMedia(s);var l=i.createArgs(e.partGroup,e.contentArgs);if(a.setText(t.createTextGroupFromCaptionString(l.caption)),e.contentArgs.altText){var c=t.createParagraphsWithText(e.contentArgs.altText);a.setDescription(c)}return a},i.prototype.replaceMediaFromContent=function(e,t){if(!e||!t)throw StoryApp.RethrowLogger.createError("Args cannot be null");var o=n.currentStoryController().get(this.pageId),i=o.findParent(e);if(!(i instanceof r.MediaWithTextComposite))throw StoryApp.RethrowLogger.createError("Image does not have parent that is media with text composite");var a=i,s=r.ImageContent.Create(o.getModel(),t.imageContentId),l=a.getMedia();a.setMedia(s),o.removeSpecifiedGroupChild(l),this.update(e.id,s,t)},i.prototype.updateFromContent=function(e,t){var n=null;if(!e||!t)throw StoryApp.RethrowLogger.createError("Args cannot be null");if(e instanceof r.MediaWithTextComposite?n=e.getMedia():e instanceof r.ImageContent&&(n=e),!(n instanceof r.ImageContent))throw StoryApp.RethrowLogger.createError("Image model media composite does not contain an image");var o=n;this.update(n.id,o,t)},i.prototype.update=function(e,t,o){var r=o.partGroup,a=i.createArgs(r,o.contentArgs);if(n.ObjectController.setupMedia(t,a,this.pageId),a.imageContentParts)for(var s=a.imageContentParts.length,l=0;l<s;l++){var c=a.imageContentParts[l];t.imageParts.add(this.transformImageContentPart(c))}if(r){var d=new ClientAction.CreateImageModelActionData(e,o.source&&o.source.providerType,null!=r.ImageParts&&null!=r.ImageParts[0]?r.ImageParts[0].Height:0,null!=r.ImageParts&&null!=r.ImageParts[0]?r.ImageParts[0].Width:0);ActionLogger.RecordClientAction(d)}},i.prototype.transformImageContentPart=function(e){var t=r.ImageContentPart.Create(n.currentStoryController().get(this.pageId).getModel());return t.setType(e.type),t.setSourceUrl(e.sourceUrl?e.sourceUrl:""),e.width&&t.setWidth(e.width),e.height&&t.setHeight(e.height),t},i.createImageContentPart=function(e,t,n){var o=e.Value,r=0,s=0,l=i.findImageClipPart(t,o);return l&&(r=l.Width,s=l.Height),o.length>=2&&"//"==o.substring(0,2)&&(o="https:"+o),{type:a.ClipPartTypeToImageCategory(n),sourceUrl:o,width:r,height:s}},i.findImageClipPart=function(e,t){if(e)for(var n=e.ImageParts,o=0,i=n.length;o<i;++o){var r=n[o];try{if(decodeURIComponent(r.SourceUrl).toLowerCase()===decodeURIComponent(t).toLowerCase())return r}catch(e){}}},i.createArgs=function(e,t){var n=t;if(e){n.imageContentParts=[];for(var o=0;o<e.Parts.length;o++){var r=e.Parts[o],s=a.ClipPartType[r.PartType];if(a.IsImageClipPartType(s)){var l=i.createImageContentPart(r,e,s);n.imageContentParts.push(l)}}}return n},i.isImageSizeKnown=function(e,t){var n=i.getImageSize(e,t);return n.height>0||n.width>0},i.getImageSize=function(e,t){if(null==e||!(e instanceof r.ImageContent))return new Size(0,0);var o=e;if(o.getOriginalHeight()>0||o.getOriginalWidth()>0)return new Size(o.getOriginalWidth(),o.getOriginalHeight());var i;return(i=this.getSizeFromImagePart(n.StoryController.calculateImageClipPart(o,t)))?i:(i=this.getSizeFromImagePart(n.StoryController.calculateCsmImageClipPart(o,t)))||new Size(0,0)},i.getSizeFromImagePart=function(e,t){if(e){var n=e.getHeight(t),o=e.getWidth(t);return n>0&&o>0?new Size(o,n):void 0}},i.calculateImagePart=function(e,t){if(e instanceof r.ImageContent)return n.StoryController.calculateImageClipPart(e,t);if(e instanceof r.VideoContent)return e.getThumbnail(t);if(e instanceof r.StatusUpdateContent){var o=e.getBodyImage(t),i=e.getProfileImage(t);return o||i}},i.calculateSourceUrl=function(e,t,n){return void 0===n&&(n=StoryPageSettings.ImageResolutions.firstOrDefault(function(e){return e>=200})||0),i.isAtomImageContent(e)?this.getImageUrlFromImageContent(e,n,t):i.isAtomVideoContent(e)?this.getImageUrlFromVideoContent(e,n,t):""},i.getImageUrlFromImageContent=function(e,t,n){var o=[],r=i.getThumbnailAndImageParts(e,n);if(i.getModelObjectsForImageParts(r).forEach(i.addSizeFromObject.bind(this,n,o,t)),o.length>=1)return o[0].url;r.forEach(i.addSizeFromPart.bind(this,n,o));var a=0===o.length?"":i.getClosestQuality(o,t).url;return a&&a.match(/^sway:\/\/resource\/([^\/]+)\/([^\/]+)/i)&&(a=""),a},i.getImageUrlFromVideoContent=function(t,n,o){var r=t.getThumbnail(o);if(void 0===r)return"";var a=e.Model.ContentStorageModel.getModelObject(r.id);return i.isImageContentPart(a)?i.sizeAndUrlFromImageContentPart(a,n,o).url:r.getSourceUrl(o)},i.getClosestQuality=function(e,t){for(var n=e[0],o=1;o<e.length;o++){var i=Math.max(n.height,n.width),r=Math.max(e[o].height,e[o].width);Math.abs(r-t)<Math.abs(i-t)&&(n=e[o])}return n},i.addSizeFromPart=function(e,t,n){t.push({url:n.getSourceUrl(e),height:n.getHeight(e),width:n.getWidth(e)})},i.addSizeFromObject=function(e,t,n,o){if(i.isImageContentPart(o)){var r=i.sizeAndUrlFromImageContentPart(o,n,e);r&&t.push(r)}},i.sizeAndUrlFromImageContentPart=function(e,t,n){var o=e.getExternalDataId(n),i=e.getWidth(n),r=e.getHeight(n);return i>r&&t<i?(r=r*t/i,i=t):r>i&&t<r&&(i=i*t/r,r=t),o?{url:StoryApp.Common.UrlHelper.getInstance().imageUrl(StoryPageSettings.LookupId,Math.max(i,r),o,!1,"",StoryPageSettings.UseCDN,StoryPageSettings.Mode===StoryViewMode.Embedded),height:r,width:i}:{url:"",height:r,width:i}},i.getThumbnailAndImageParts=function(e,t){return e.imageParts.getCollection(t).filter(function(e){var n=e.getType(t);return n===r.ImageCategory.Thumbnail||n===r.ImageCategory.Image})},i.getModelObjectsForImageParts=function(t){return ArrayExtensions.mapAndFilter(t,function(t){return e.Model.ContentStorageModel.getModelObject(t.id)})},i.isAtomImageContent=function(e){return e instanceof r.ImageContent},i.isAtomVideoContent=function(e){return e instanceof r.VideoContent},i.isImageContentPart=function(e){return e instanceof t.CSM.ImageContentPart},i.getMediaSize=function(e,n){var o=i.calculateImagePart(e,n);if(!o)return null;var r,a,s=t.ContentStorageModel.getModelObject(o.id);return s?(r=s.getWidth(n),a=s.getHeight(n)):(r=o.getWidth(n),a=o.getHeight(n)),{width:r,height:a}},i.calculateImageContentPartSourceUrl=function(t,n,o){if(void 0===o&&(o=StoryPageSettings.ImageResolutions.firstOrDefault(function(e){return e>=200})||0),!t)throw StoryApp.RethrowLogger.createError("Argument null or undefined: imageContentPart");var i=e.Model.ContentStorageModel.getModelObject(t.id);i||e.Model.ContentStorageModel.contentRoot.imageContentParts.getCollection(n);var r=i?i.getExternalDataId(n):null,a=null;return i&&(a=i.getSourceUrlOverride(n)),r?StoryApp.Common.UrlHelper.getInstance().imageUrl(StoryPageSettings.LookupId,o,r,!1,"",StoryPageSettings.UseCDN,StoryPageSettings.Mode===StoryViewMode.Embedded):a||StoryApp.Common.UrlHelper.getInstance().getUrlForUnprocessedImage(t.getSourceUrl(n))},i.ImageSocket=0,i.TextSocket=1,i}(n.MediaController);n.ImageController=s}(t.AuthoringModel||(t.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){function n(){return o||(o=StoryApp.Common.PageCompartmentManager.getInstance().createAccessor("SetController")),o}var o,i=e.Model.SM;t.currentSetController=n;var r=function(n){function o(e){return n.call(this,e)||this}return __extends(o,n),o.prototype.create=function(e){var n=t.currentStoryController().get(this.pageId).createSet(),o=e.modelProperties.visualization?e.modelProperties.visualization:i.Visualization.Auto;return n.setVisualization(o),n},o.prototype.canAddBlueprints=function(e,n,r){if(null==e||0==e.length||null==n)return!1;for(var a=[],s=0;s<e.length;s++)e[s].model?a.push(t.ObjectController.getBlueprint(e[s].model,this.pageId,r)):a.push(e[s].definition.blueprint);var l,c=null,d=[];n.parent instanceof i.Set&&(d=(c=n.parent).content.getCollection(r),StoryPageEditSettings.NestedGroupingEnabled&&(l=this.getNestingLevel(c)));for(var u=0,p=a.length,s=0;s<p;s++){if(a[s].controller instanceof t.HeaderController||a[s].controller instanceof o&&!StoryPageEditSettings.NestedGroupingEnabled||a[s].controller instanceof t.DocumentContentController||a[s].controller instanceof t.ImportingOrEmbeddingDocumentController||a[s].controller instanceof t.GroupController||!StoryPageEditSettings.NestedGroupingEnabled&&a[s].controller instanceof t.AgaveController||a[s].controller instanceof t.TableController)return!1;if(c){if(a[s].modelProperties.modelObject&&ArrayExtensions.contains(d,a[s].modelProperties.modelObject)&&u++,!o.doesSetVisualizationSupportBlueprint(c.getVisualization(r),a[s]))return!1;if(StoryPageEditSettings.NestedGroupingEnabled){var g=a[s].controller instanceof o?1:0;if(a[s].modelProperties.modelObject&&(g=this.getMaxDescendantSetLevel(a[s].modelProperties.modelObject)),StoryPageEditSettings.NestedGroupingLimit<l+g)return!1}}if(a[s].controller instanceof t.EmbedController&&StoryPageSettings.BlockService_EmbedDecomp)return!1}if(c){var h=this.maxItemsForVisualization(c.getVisualization(r));if(h){var C=0;if(n.parent instanceof i.Set&&(C=n.parent.content.getCollection(r).length),C+a.length-u>h)return!1}}return!0},o.prototype.add=function(e,t){if(!(t.parent instanceof i.Set))throw StoryApp.RethrowLogger.createError("args.parent should be a Set");this.addChildren(e,t)},o.prototype.addChildren=function(e,n){if(this.canAdd(e,n)){var o=[];e.forEach(function(e){return o.push(e.model)});for(var r=n.index?n.index:0,a=n.parent,s=t.currentStoryController().get(this.pageId),l=0;l<o.length;l++){var c=o[l],d=s.findParent(c),u=a;c instanceof i.Set&&StoryLog.StructuredTraceTag(596473356,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Set is added in another set.",{setType:i.Visualization[c.getVisualization()]}),u===d&&-1!==t.StoryController.getPrimaryCollection(d).getCollection().indexOf(c)&&r>t.StoryController.getPrimaryCollection(d).getCollection().indexOf(c)&&!(c instanceof i.TitleComposite)&&r--,this.addContent(c,a,r),r++}s.pruneEmptyGroups()}},o.prototype.canTransform=function(e,n){if(!t.StoryController.modelObjectsAreValid(e)||!n||!n.modelProperties)return!1;if(1==e.length){if(e[0]instanceof i.Set){var o=e[0],r=n.modelProperties.visualization?n.modelProperties.visualization:i.Visualization.Auto;return o.getVisualization()!=r&&this.individualItemsSupported(o.content.getCollection(),!0,n)}return!1}return this.individualItemsSupported(e,!1,n)},o.prototype.individualItemsSupported=function(e,n,o){if(!o||!o.modelProperties)return!1;var r=o.modelProperties.visualization,a=this.maxItemsForVisualization(r);if(a&&e.length>a)return!1;for(var s,l=e.length,c=o.destinationChild?o.destinationChild:e[e.length-1],d=t.currentStoryController().get(this.pageId).findParent(c),u=this.getNestingLevel(d),p=0,g=[],h=0;h<e.length;h++)g.push(new t.Card({model:e[h],definition:t.ObjectController.getCardDefinitionForModelObject(e[h],this.pageId)}));for(h=0;h<l;h++){if(!this.canAdd(g,{}))return!1;if(!this.doesSetVisualizationSupportItem(r,e[h]))return!1;if(e[h]instanceof i.Paragraph)return!1;if(e[h]instanceof i.SpecifiedGroup)return!1;var C=t.currentStoryController().get(this.pageId).findParent(e[h]);if(StoryPageEditSettings.NestedGroupingEnabled){if(!n&&d&&d instanceof i.Set&&d.getVisualization()!=i.Visualization.Auto)return!1;if(!n&&!o.canCrossSetBoundaries&&C!=d)return!1;(s=this.getMaxDescendantSetLevel(e[h]))>p&&(p=s);var f=n?0:1;if(StoryPageEditSettings.NestedGroupingLimit<u+f+p)return!1}else if(!n&&C instanceof i.Set)return!1;if(t.HeaderController.modelIsTitleBackground(e[h],C))return!1}return!0},o.prototype.getNestingLevel=function(e){if(!e)return 0;if(e instanceof i.SpecifiedGroup)return 0;var n,o=0;do{o++,e=n=t.currentStoryController().get(this.pageId).findParent(e)}while(n instanceof i.Set);return o},o.prototype.getMaxDescendantSetLevel=function(e){if(!(e instanceof i.Set))return 0;for(var t,n=e.content.getCollection(),o=1,r=0;n&&r<n.length;r++){var a=n[r];a instanceof i.Set&&(t=1+this.getMaxDescendantSetLevel(a)),t>o&&(o=t)}return o},o.prototype.maxItemsForVisualization=function(e){switch(e){case i.Visualization.Comparison:return 2;default:return 0}},o.prototype.transform=function(e,t){return e&&e.length>0&&(t.destinationChild=t.destinationChild?t.destinationChild:e[0]),this.canTransform(e,t)?this.coalesceToSet(e,t):null},o.prototype.coalesceToSet=function(n,o){if(!n||0==n.length)return null;var r=null,a=o.modelProperties.visualization?o.modelProperties.visualization:i.Visualization.Auto,s=o.destinationChild?o.destinationChild:n[0];if(1==n.length&&s instanceof i.Set)r=s,n[0].getContentSource()===e.Model.SM.ContentCreator.DocumentIngestion&&StoryLog.StructuredTraceTag(596444514,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Set created with Document Ingestion changed type",{Id:r.id,"Old visualization":e.Model.SM.Visualization[r.getVisualization()],"New visualization":e.Model.SM.Visualization[a]}),TDB.applyUpdate(function(){r.setVisualization(a)});else{var l=t.currentStoryController().get(this.pageId),c=l.findContainingGroup(s),d=c.children.getCollection().indexOf(s),u=l.findParent(s);u instanceof i.Set&&(c=u,d=u.content.getCollection().indexOf(s)),r=l.createSet(),TDB.applyUpdate(function(){r.setVisualization(a),l.addSpecifiedGroupChild(r,c,d);for(var t=n.length,o=0,i=0;i<t;i++)l.removeSpecifiedGroupChild(n[i]),l.addSpecifiedGroupChild(n[i],r),n[i].getContentSource()===e.Model.SM.ContentCreator.DocumentIngestion&&o++;o>0&&StoryLog.StructuredTraceTag(596460872,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Card created by Document Ingestion grouped",{DocIngestionItemCount:o.toString(),TotalItemsCount:t.toString()})})}return r},o.getLabel=function(e,n){if(!(t.StoryController.isModelObjectValid(e)&&e instanceof i.Set))return"";switch(e.getVisualization(n)){case i.Visualization.Auto:return Resources.TransformGroup;case i.Visualization.Stack:return Resources.TransformStack;case i.Visualization.Comparison:return Resources.TransformComparison;case i.Visualization.UniformGrid:return Resources.TransformUniformGrid;case i.Visualization.Gallery:case i.Visualization.GalleryContinuous:case i.Visualization.GalleryWithThumbs:return Resources.TransformGallery}return""},o.doesSetOnlyAllowImages=function(e,n){if(!(t.StoryController.isModelObjectValid(e)&&e instanceof i.Set))return!1;var r=e.getVisualization(n);return o.doesSetVisualizationOnlyAllowImages(r)},o.doesSetVisualizationOnlyAllowImages=function(e){switch(e){case i.Visualization.Stack:return!StoryPageEditSettings.TextInStackEnabled;case i.Visualization.Comparison:case i.Visualization.Gallery:case i.Visualization.GalleryContinuous:case i.Visualization.GalleryWithThumbs:return!0;default:return!1}},o.doesSetVisualizationSupportBlueprint=function(e,n){if(e==i.Visualization.Auto)return!0;var r=n.controller;return e==i.Visualization.UniformGrid&&(r instanceof t.ImageController||r instanceof t.VideoController||r instanceof t.TextController)||(!(!StoryPageEditSettings.TextInStackEnabled||e!==i.Visualization.Stack||!(r instanceof t.ImageController||r instanceof t.TextController))||!!(o.doesSetVisualizationOnlyAllowImages(e)&&n.controller instanceof t.ImageController))},o.prototype.doesSetVisualizationSupportItem=function(e,n){if(e==i.Visualization.Auto)return!0;var r=t.ObjectController.getBlueprint(n,this.pageId);return o.doesSetVisualizationSupportBlueprint(e,r)},o.prototype.copySetAttributes=function(e){var n=t.currentStoryController().get(this.pageId).createSet();return n.setContentSource(e.getContentSource()),n.setVisualization(e.getVisualization()),n},o}(t.ContainerController);t.SetController=r}(t.AuthoringModel||(t.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){function n(){return o||(o=StoryApp.Common.PageCompartmentManager.getInstance().createAccessor("StatusUpdateController")),o}var o,i=e.Model.SM,r=e.Server.Decomposition.WP;t.currentStatusUpdateController=n;var a=function(e){function n(t){return e.call(this,t)||this}return __extends(n,e),n.prototype.add=function(e,t){if(this.canAdd(e,t)){var n=[];e.forEach(function(e){return n.push(e.model)});for(var o=n.length;o--;)if(n[o]instanceof i.StatusUpdateContent){t&&this.copyStatusUpdateContent(t.parent,n[o]);break}}},n.prototype.update=function(e,n){var o=n,i=e;this.copyStatusUpdateContent(o,i),t.currentStoryController().get(this.pageId).removeSpecifiedGroupChild(e)},n.prototype.canAddBlueprints=function(e,t,n){var o=[];e.forEach(function(e){return o.push(e.definition.blueprint)});for(var i=o.length;i--;)if(!this.canAddBlueprint(o[i],t))return!1;return!0},n.prototype.canAddBlueprint=function(e,t){return e.controller instanceof n&&!e.modelProperties.placeholder},n.prototype.create=function(e){var n=t.currentStoryController().get(this.pageId).getModel();return i.StatusUpdateContent.Create(n)},n.prototype.createFromContent=function(e){var o,r=t.currentStoryController().get(this.pageId).getModel(),a=n.createArgs(e.partGroup,e.contentArgs);o=i.StatusUpdateContent.Create(r),t.ObjectController.setupMedia(o,e,this.pageId);var s=(a.author?a.author:"")+" "+(a.userName?a.userName:"");if(o.setAuthor(s),o.setTimestamp(a.timestamp?a.timestamp:""),o.setSourceId(void 0!=a.sourceId?a.sourceId:""),o.setBodyImage(void 0!=a.bodyImage?t.currentImageController().get(this.pageId).transformImageContentPart(a.bodyImage):null),o.setProfileImage(void 0!=a.profileImage?t.currentImageController().get(this.pageId).transformImageContentPart(a.profileImage):null),void 0!=a.bodyText){var l=new i.TextBlock;l.setText(a.bodyText),o.setBodyText(l)}return o},n.createArgs=function(e,n){var o=n;if(e){var i=e.Parts.firstOrDefault(function(e){return r.ClipPartType[e.PartType]===r.ClipPartType.Image}),a=e.Parts.firstOrDefault(function(e){return r.ClipPartType[e.PartType]===r.ClipPartType.ProfileImage}),s=e.TextParts.firstOrDefault(function(e){return e.TextCategory===r.TextCategory.Body}),l=e.TextParts.firstOrDefault(function(e){return e.TextCategory===r.TextCategory.Author}),c=e.TextParts.firstOrDefault(function(e){return e.TextCategory===r.TextCategory.UserName});o.bodyImage=i?t.ImageController.createImageContentPart(i,e,r.ClipPartType.Image):void 0,o.profileImage=a?t.ImageController.createImageContentPart(a,e,r.ClipPartType.ProfileImage):void 0,o.bodyText=s?s.Text:void 0,o.author=l?l.Text:void 0,o.userName=c?c.Text:void 0,o.sourceId=e.ForeignKey}return o},n.isEmptyStatusUpdate=function(e,t){var n=e.getSourceId(t);return 0==(n?n.length:0)},n.prototype.copyStatusUpdateContent=function(e,t){var n=t.getAttribution();n&&e.setAttribution(n);var o=t.getAuthor();o&&e.setAuthor(o);var i=t.getBodyImage();i&&e.setBodyImage(i);var r=t.getBodyText();r&&e.setBodyText(r);var a=t.getContentSource();null!=a&&e.setContentSource(a);var s=t.getDecompInfo();s&&e.setDecompInfo(s);var l=t.getEmphasis();null!=l&&e.setEmphasis(l);var c=t.getGeoCoordinate();c&&e.setGeoCoordinate(c);var d=t.getProfileImage();d&&e.setProfileImage(d);var u=t.getSourceId();u&&e.setSourceId(u);var p=t.getSourceUrl();p&&e.setSourceUrl(p);var g=t.getSummary();g&&e.setSummary(g);var h=t.getTimestamp();h&&e.setTimestamp(h);var C=t.getTitle();C&&e.setTitle(C);var f=t.getUploadInfo();f&&e.setUploadInfo(f);var m=t.getVisualOverrides();m&&e.setVisualOverrides(m)},n.StatusUpdateSocket=0,n}(t.ContainerController);t.StatusUpdateController=a}(t.AuthoringModel||(t.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){function n(){return o||(o=StoryApp.Common.PageCompartmentManager.getInstance().createAccessor("TextController")),o}var o,i=e.Model.SM;t.currentTextController=n;var r=function(e){function n(t){return e.call(this,t)||this}return __extends(n,e),n.prototype.create=function(e){return t.currentStoryController().get(this.pageId).createTextGroup()},n.prototype.createFromParagraphs=function(e){var n=t.currentStoryController().get(this.pageId).createTextGroup(!1);if(e)for(var o=0;o<e.length;o++)n.children.add(e[o]);return n},n.isFirstTextAList=function(e){if(!e.children)return!1;var t=e.children.getCollection()[0];return t instanceof i.TextGroup?t.getListStyle()!==i.ListStyle.None:t instanceof i.Paragraph&&t.getListStyle()!==i.ListStyle.None},n.prototype.isParentAList=function(e){var n=t.currentStoryController().get(this.pageId).findParent(e);return n instanceof i.TextGroup?n.getListStyle()!==i.ListStyle.None:n instanceof i.Paragraph&&n.getListStyle()!==i.ListStyle.None},n.isEmpty=function(e,t){if(e instanceof i.TextGroup){var n=e.children.getCollection(t);if(n.length>1)return!1;if(n.length<1)return!0;var o=n[0];return o instanceof i.Paragraph&&(!o.getContent()||!o.getContent().getText(t))}return e instanceof i.Paragraph&&!e.getContent().getText(t)},n.supportsMultiline=function(e){return e instanceof i.TextGroup||e instanceof i.MediaWithTextComposite},n.updateLinkInTextBlock=function(e,t,o,i){if(e&&t){var r=e.getText()||"",a=e.runs.getCollection();if(a){var s=t.getIndex(),l=s+t.getLength()-1,c=n.getTextOfRun(e,t);if(o){var d=o.length-c.length;a=a.filter(function(e){return e.getIndex()>=s});for(var u=0;u<a.length;++u){var p=a[u],g=p.getIndex(),h=p.getLength();g<=l?l+d<g?a.removefirst(p):p.setLength(h+d):p.setIndex(g+d)}var C=r.substring(0,s)+o+r.substring(l+1);e.setText(C)}i&&t.setUrl(i)}}},n.getTextOfRun=function(e,t){if(!e||!t)return"";var n=e.getText(),o=t.getIndex(),i=t.getLength();return n.substr(o,i)},n.getTextRecursive=function(e){var t=e,o=e;if(t.getContent)return t.getContent().getText();if(o.children){for(var i="",r=0;r<o.children.getCollection().length;++r)i+=n.getTextRecursive(o.children.getCollection()[r]);return i}return""},n}(t.ObjectController);t.TextController=r}(t.AuthoringModel||(t.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){function n(){return o||(o=StoryApp.Common.PageCompartmentManager.getInstance().createAccessor("VideoController")),o}var o,i=e.Model.SM,r=e.Server.Decomposition.WP;t.currentVideoController=n;var a=function(e){function n(t,n){var o=e.call(this,n)||this;return o.urlHelper=t,o}return __extends(n,e),n.prototype.canAddBlueprint=function(e,t,o){return e.controller instanceof n&&!e.modelProperties.placeholder},n.prototype.create=function(e){var n=t.currentStoryController().get(this.pageId),o=n.getModel(),r=i.MediaWithTextComposite.Create(o),a=i.VideoContent.Create(o);return r.setMedia(a),r.setText(n.createTextGroup()),r},n.prototype.createFromContent=function(e){if(!e)return null;var o,r,a=t.currentStoryController().get(this.pageId),s=a.getModel();r=i.MediaWithTextComposite.Create(s),o=i.VideoContent.Create(s,e.videoContentId),this.update(o,e),r.setMedia(o);var l=n.createArgs(e.partGroup,e.contentArgs);return r.setText(a.createTextGroupFromCaptionString(l.caption)),r},n.prototype.updateFromContent=function(e,t){var n=null;if(!e||!t)throw StoryApp.RethrowLogger.createError("Args must not be null");if(e instanceof i.MediaWithTextComposite?n=e.getMedia():e instanceof i.VideoContent&&(n=e),!(n instanceof i.VideoContent))throw StoryApp.RethrowLogger.createError("Video model media composite does not contain a video");var o=n;this.update(o,t)},n.prototype.update=function(e,o){var r=n.createArgs(o.partGroup,o.contentArgs);if(t.ObjectController.setupMedia(e,r,this.pageId),o.partGroup&&o.partGroup.ProviderType==i.ContentProvider.OneDrivePro){var a=StoryEditPageMain.AzureMediaPlayerDescriptorHandler.generateStoryVideoId(e.id);r.videoPlayerDescriptor=StoryEditPageMain.MediaPlayerDescriptorHandlerFactory.createVideoHandler(i.ContentProvider.OneDrivePro).encodeFakeDescriptor(a)}e.setDuration(void 0!=r.duration?r.duration:""),e.setThumbnail(void 0!=r.thumbnail?t.currentImageController().get(this.pageId).transformImageContentPart(r.thumbnail):null),e.setVideoPlayerDescriptor(void 0!=r.videoPlayerDescriptor?r.videoPlayerDescriptor:""),e.setSize(r.size)},n.createArgs=function(e,n){var o=n;if(e){var i=e.Parts.firstOrDefault(function(e){return r.ClipPartType[e.PartType]===r.ClipPartType.VideoPlayerDescriptor}),a=e.TextParts.firstOrDefault(function(e){return e.TextCategory===r.TextCategory.Duration});o.videoPlayerDescriptor=i?i.Value:void 0,o.duration=a?a.Text:void 0;var s=e.Parts.firstOrDefault(function(e){return r.ClipPartType[e.PartType]===r.ClipPartType.Image});s||(s=e.Parts.firstOrDefault(function(e){return r.ClipPartType[e.PartType]===r.ClipPartType.ThumbnailImage})),o.thumbnail=s?t.ImageController.createImageContentPart(s,e,r.ClipPartType.ThumbnailImage):void 0;var l=e.TextParts.firstOrDefault(function(e){return e.TextCategory===r.TextCategory.Size});o.size=l?l.Text:void 0}return o},n.VideoSocket=0,n.TextSocket=1,n}(t.MediaController);t.VideoController=a}(t.AuthoringModel||(t.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){function n(){return o||(o=StoryApp.Common.PageCompartmentManager.getInstance().createAccessor("ClosedCaptionController")),o}var o,i=e.Model.SM,r=e.Server.Decomposition.WP;t.currentClosedCaptionController=n;var a=function(e){function n(t){return e.call(this,t)||this}return __extends(n,e),n.prototype.canAddBlueprints=function(e,t,o){if(null==e||0==e.length)return!1;var i=[];e.forEach(function(e){return i.push(e.definition.blueprint)});for(var r=i.length,a=0;a<r;a++)if(!(i[a].controller instanceof n))return!1;return!0},n.prototype.create=function(e){var n=t.currentStoryController().get(this.pageId).getModel(),o=i.ClosedCaptionComposite.Create(n),r=i.ClosedCaptionContent.Create(n);return o.setContent(r),o},n.prototype.createFromContent=function(e){if(!e)return null;var n=t.currentStoryController().get(this.pageId).getModel(),o=i.ClosedCaptionComposite.Create(n),r=i.ClosedCaptionContent.Create(n);return o.setContent(r),this.update(o,e),o},n.prototype.updateFromContent=function(e,t){var n=null;if(!e||!t)throw StoryApp.RethrowLogger.createError("Args must not be null");if(!(e instanceof i.ClosedCaptionComposite))throw StoryApp.RethrowLogger.createError("Model is not closed caption");n=e,this.update(n,t)},n.createArgs=function(e,t){var n=t;if(e)for(var o=e.Parts.length,i=0;i<o;i++){var a=e.Parts[i];r.ClipPartType[a.PartType]===r.ClipPartType.Title&&(n.fileName=a.Value)}return n},n.prototype.update=function(e,o){n.createArgs(o.partGroup,o.contentArgs),t.ObjectController.setupMedia(e.getContent(),o.contentArgs,this.pageId),void 0!==o.contentArgs.fileName&&e.setFileName(o.contentArgs.fileName),void 0!==o.contentArgs.language&&e.setLanguage(o.contentArgs.language),void 0!==o.contentArgs.label&&e.setLabel(o.contentArgs.label)},n.prototype.getUploadStatus=function(e,n){return t.StoryController.getUploadStatus(e,n)},n}(t.ContainerController);t.ClosedCaptionController=a}(t.AuthoringModel||(t.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t={Bing:"BingContentButtonDescription",Facebook:"FacebookContentButtonDescription",Flickr:"FlickrContentButtonDescription",Generic:"GenericSouceContentButtonDescription",MyDevice:"UploadContentButtonDescription",None:"AddSourceContentButtonDescription",OneDrivePro:"OneDriveContentButtonDescription",OneNote:"OneNoteContentButtonDescription",PicHit:"PicHitContentButtonDescription",Giphy:"GiphyContentButtonDescription",OneDrive:"OneDriveContentButtonDescription",SkyDrive:"OneDriveContentButtonDescription",SuggestedContent:"SuggestedContentButtonDescription",Twitter:"TwitterContentButtonDescription",YouTube:"YoutubeContentButtonDescription"},n={SuggestedContent:1,SkyDrive:2,OneDrive:2,OneDrivePro:3,OneNote:4,Facebook:5,Flickr:6,Bing:7,PicHit:8,Shutterstock:9,Giphy:10,YouTube:11,Twitter:12,None:13,MyDevice:14},o=function(o){function i(e,i,r){var a=this,s=i.providerType?i.providerType:"Generic";return r.tabIndex=n[s],r.tooltip={value:Resources[t[s]]},a=o.call(this,e,r)||this,a.source=i,a}return __extends(i,o),i.prototype.getSource=function(){return this.source},i.prototype.wrapperAttrArgs=function(e){var t=this.getButtonAttributes(e);return t[Aria.Attributes.Checked]=String(this.parent.parent.parent.selectedSource.getWatchedValue(e)===this.source),t[Aria.Attributes.Role]=Aria.Roles.Menuitemradio,t},i.prototype.isFiltered=function(t){var n=this.parent.parent.sourceCardType.getWatchedValue(t);return void 0===n||!e.AddContentVE.sourceFilteringEnabled(StoryPageEditSettings)||ArrayExtensions.contains(StoryPageEditSettings.PrefferedContentSources[e.CardType[n].toString()],this.source.displayName)},i.prototype.isSelected=function(t){return e.AddContentVE.sourceFilteringEnabled(StoryPageEditSettings)&&t.watchValue(this.parent.parent.parent.selectedSource)===this.source},i.prototype.ifSourceOptionArgs=function(e){return this.isFiltered(e)},i.getSourceDescription=function(e){var n=e.providerType?e.providerType:"Generic";return Resources[t[n]]},i}(StoryApp.View.ViewElements.ButtonVE);e.SourceOption=o}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n,o=e.Model.AuthoringModel,i=e.View.ViewElements;!function(e){e[e.Remove=0]="Remove",e[e.Explode=1]="Explode",e[e.DesignHints=2]="DesignHints",e[e.GalleryStyle=3]="GalleryStyle",e[e.Focus=4]="Focus",e[e.Decorative=5]="Decorative",e[e.Record=6]="Record"}(n=t.CardAction||(t.CardAction={}));var r;!function(e){e[e.Teaser=0]="Teaser",e[e.Collapsed=1]="Collapsed",e[e.Expanded=2]="Expanded"}(r=t.CardMode||(t.CardMode={}));var a=function(a){function s(e,t,n){var i=a.call(this,e)||this;i._args=n,i.card=new o.Card({model:t,definition:n.cardDefinition}),i.isSelectionCheckmarkVisible=TDB.watcherTag(596473742,i,i,i.isCheckMarkVisible),i._isSelectionCheckmarkChecked=TDB.watcherTag(596473743,i,i,i.selectionCheckmarkChecked),i._areDragHandlesVisible=TDB.watcherTag(596473744,i,i,i.dragHandlesVisible),i._focusedAuthors=TDB.watcherTag(596473745,i,i,i.getFocusedAuthors),i._isActiveItem=TDB.watchableTag(596473746,i,!1),i._dragging=TDB.watchableTag(596473747,i,!1),i.socket=n.socket,i.pageId=n.authoringModel.getPageId(),n.interactiveWatchable?i._interactive=n.interactiveWatchable:i._interactive=TDB.watchableTag(596473748,i,!0),n.parentSuggestedCardModeWatchable&&(i._parentSuggestedCardModeWatchable=n.parentSuggestedCardModeWatchable);var s=void 0!==n.cardMode?n.cardMode:r.Collapsed;return i._cardMode=TDB.watchableTag(596473749,i,s),i._cardModeWatcher=TDB.watcherTag(596473750,i,i,i.calculateCardMode),i.sockets=TDB.watcherTag(596473751,i,i,i.initSockets),i}return __extends(s,a),s.prototype.getAuthoringModel=function(){return this._args.authoringModel},s.prototype.initSockets=function(e){var t,n=[];if(this.card.definition){t=this.card.definition.getSocketDefinitions();for(var i=0;i<t.length;i++){var r=new o.Socket({definition:t[i],parentModelObject:this.card.model,parentCardType:this.getCardDefinition().id,pageId:this.pageId});r.isSocketSupported(e)&&n.push(r)}}return n},s.prototype.getSocket=function(){return this.socket},s.prototype.getSockets=function(){return this.sockets.getValue()},s.prototype.getModel=function(){return this.card.model},s.prototype.getModelId=function(){return this.card.model?this.card.model.id:void 0},s.prototype.getCardDefinition=function(){return this.card.definition},s.prototype.hasValidModel=function(){return o.StoryController.isModelObjectValid(this.card.model)},s.prototype.setCardVE=function(e){this._cardVE=e},s.prototype.inTeaserMode=function(e){return this._cardModeWatcher.getWatchedValue(e)===r.Teaser},s.prototype.isCollapsed=function(e){return this._cardModeWatcher.getWatchedValue(e)===r.Collapsed},s.prototype.isExpanded=function(e){return this._cardModeWatcher.getWatchedValue(e)===r.Expanded},s.prototype.setCardMode=function(e){var t=this;TDB.applyUpdate(function(){t._cardMode.setValue(e),t._cardVE.updateCardHeight()})},s.prototype.getCardMode=function(e){return this._cardModeWatcher.getWatchedValue(e)},s.prototype.getFocusedModel=function(){return this.card.model},s.prototype.getParentModel=function(e){return e.findParent(this.card.model)},s.prototype.setEmphasis=function(e){throw StoryApp.RethrowLogger.createError("Method should be overriden by subclass")},s.prototype.getEmphasis=function(e){throw StoryApp.RethrowLogger.createError("Method should be overriden by subclass")},s.prototype.getDecorative=function(e){throw StoryApp.RethrowLogger.createError("Method should be overriden by subclass")},s.prototype.setDecorative=function(e){throw StoryApp.RethrowLogger.createError("Method should be overriden by subclass")},s.prototype.getStorylineDescription=function(e){return this._cardVE.labelText(e)},s.prototype.getStorylineDescriptionWithError=function(e,t){void 0===t&&(t=!1);var n=this.getStorylineDescription(e);return t?ResourceManager.ResolveString(Resources.CardWithErrorStorylineDescription,[n]):n},s.prototype.canTakeAction=function(e,t){return e===n.Remove?!this._cardVE.cardParent.isPopup&&!this.socketShowsWhenCollapsed():e===n.DesignHints&&(i.SetEmphasisAction.isAvailable([this.card.model],this.pageId,t)||i.SetGalleryStyleAction.isAvailable([this.card.model]))},s.prototype.getSocketDefinition=function(){return this.inSocket()?this.getSocket().getDefinition():void 0},s.prototype.getCardForModelId=function(e){if(this.getModelId()===e)return this._cardVE;if(this.calculateCardMode()===r.Expanded)for(var t=this._cardVE.getCardExpandedView().getChildCards(),n=0;n<t.length;n++){var o=t[n].getViewModel().getCardForModelId(e);if(o)return o}},s.prototype.isMenuVisible=function(e){return this._isMenuVisible||(this._isMenuVisible=TDB.watcherTag(596473752,this,this,this.menuVisible)),this._isMenuVisible.getWatchedValue(e)},s.prototype.menuVisible=function(e){if(this._cardVE.cardParent.isPopup)return!0;if(this._cardVE.cardParent.isCollapsed(e))return!1;var t=this._args.cardsContainer.getActiveCard(e),n=this._cardVE.isActiveItem(e),o=this._args.cardSelectionManager.getSelection(e),i=this._args.cardSelectionManager.isLastSelected(this._cardVE);if(n||i){var r=this._args.authoringModel.isCardDeckVisible(e),a=ArrayExtensions.contains(o,t),s=!this._args.cardSelectionManager.isInMultiselectMode(e),l=this._dragging.getWatchedValue(e),c=this._cardVE.aboutToClone.getWatchedValue(e);return(n?s||a:!a)&&!(l||c)&&r}return!1},s.prototype.createSelectionBar=function(){return new TDB.ChildArgs(i.CardSelectionBarVE,{checkmarkVisible:this.isSelectionCheckmarkVisible,checkmarkChecked:this._isSelectionCheckmarkChecked,cardSelectionManager:this._args.cardSelectionManager,authoringModel:this._args.authoringModel})},s.prototype.calculateCardMode=function(e){var t=this._cardMode.getWatchedValue(e),n=this._parentSuggestedCardModeWatchable?this._parentSuggestedCardModeWatchable.getWatchedValue(e):void 0;return void 0!=n?n===r.Teaser?r.Teaser:t===r.Teaser?r.Collapsed:t:t},s.prototype.isCheckMarkVisible=function(e){return this._cardVE.isActiveItem(e)||this._args.cardSelectionManager.getSelection(e).length>0},s.prototype.selectionCheckmarkChecked=function(e){return this._args.cardSelectionManager.isSelected(this._cardVE,e)},s.prototype.dragHandlesVisible=function(e){return this._cardVE.isActiveItem(e)||this._args.cardSelectionManager.isSelected(this._cardVE,e)||!StoryApp.Utilities.ios&&this._cardVE.isMouseOver.getWatchedValue(e)},s.prototype.getSideBar=function(e){if(!this.inTeaserMode(e)&&this._areDragHandlesVisible.getWatchedValue(e))return new TDB.ChildArgs(i.CardSidebarVE,{grabHandlesVisible:this._areDragHandlesVisible})},s.prototype.setActive=function(e){var t=this;TDB.applyUpdate(function(){return t._isActiveItem.setValue(e)})},s.prototype.isActiveItem=function(e){return this._isActiveItem.getWatchedValue(e)},s.prototype.remove=function(e){this._removing=!0;var n=this.getSocket();if(n){var o=this._cardVE.cardParent,i=o.getChildCards().indexOf(this._cardVE);t.DeleteAction.execute([this.card.model],this.pageId,e,n);var r=o.getChildCards()[i];r.activateItem(),r.setFocusWhenInDom()}else this._cardVE.moveFocusForRemove(),t.DeleteAction.execute([this.card.model],this.pageId,e)},s.prototype.isRemoving=function(){return this._removing},s.prototype.isInteractive=function(e){return this._interactive.getWatchedValue(e)},s.prototype.getFocusedAuthors=function(t){if(!this.card.model)return[];var n=e.Server.AuthorsManager.currentAuthorsManager().get(this.pageId);return n?n.getAuthorsForModel(this.getModelId(),t):[]},s.prototype.createAuthorsList=function(e){if(!this.inTeaserMode(e)&&this._cardVE.cardParent.areDescendantsVisible(e)){var t=this._focusedAuthors.getWatchedValue(e);if(t&&0!==t.length)return new TDB.ChildArgs(i.CardAuthorsListVE,this._focusedAuthors)}},s.prototype.isJackAvailable=function(e){return this.isActiveItem(e)&&0===this._args.cardSelectionManager.getSelection(e).length&&!this._cardVE.aboutToClone.getWatchedValue(e)&&!this.inTeaserMode(e)&&!this._cardVE.hideJack(e)},s.prototype.areShowingControls=function(e){var t=!1,n=this._cardVE.getCardMenuVE();return this.isMenuVisible(e)&&n&&(t=n.hasVisibleContentControls(e)),t},s.prototype.canBeSelected=function(e){return!this._cardVE.cardParent.isAncestorSelected()&&!this.isDescendantSelected()},s.prototype.isAncestorSelected=function(){return!!this._args.cardSelectionManager.isSelected(this._cardVE)||this._cardVE.cardParent.isAncestorSelected()},s.prototype.isDescendantSelected=function(){return!1},s.prototype.acceptDraggable=function(e){return!(!this._args.authoringModel.isCardDeckVisible()||ArrayExtensions.contains(e,this._cardVE)||ArrayExtensions.contains(e,this._cardVE.parent))},s.prototype.isDragging=function(e){return this._dragging.getWatchedValue(e)},s.prototype.setDragging=function(e){var t=this;TDB.applyUpdate(function(){t._dragging.setValue(e)})},s.prototype.doCardAction=function(e){var t=this.card.model?this.card.model.id:"PlaceholderCard";return ActionLogger.RecordClientAction(new ClientAction.StorylineActionData(ClientAction.ActionType.Storyline_CardClicked,"User clicked card",[t],[i.CardType[this._cardVE.cardType]])),this.onCardAction(e)},s.prototype.onCardAction=function(e){return TDB.EventPropagation.Bypass},s.prototype.shouldHandleMouseEvents=function(){return!(!this.isInteractive()||this.inTeaserMode())},s.prototype.createJackArgs=function(){if(!this.inSocket()){var e={context:this._cardVE,paneStateManager:this._args.paneStateManager,cardDefinitionManager:this._args.cardDefinitionManager,cardDeckAnimationsComplete:this._args.authoringModel.cardDeckAnimationsComplete,cardsContainer:this._args.cardsContainer,visible:{compute:new TDB.ComputedOptionArgs(this,this.isJackAvailable)},cardSelectionManager:this._args.cardSelectionManager,cardType:this._cardVE.cardType,showJackIcon:this.shouldShowJackIcon()};return new TDB.ChildArgs(i.JackVE,e)}},s.prototype.isSelected=function(e){return this._args.cardSelectionManager.isSelected(this._cardVE,e)},s.prototype.isMultiselected=function(e){var t=this._args.cardSelectionManager.isInMultiselectMode(e),n=this._args.cardSelectionManager.isSelected(this._cardVE,e);return t&&n},s.prototype.isSelectionMode=function(e){return this._args.cardSelectionManager.isInMultiselectMode(e)},s.prototype.selectCard=function(){if(this._cardVE.getSelectionBarVE())if(ActionLogger.RecordClientAction(new ClientAction.StorylineActionData(ClientAction.ActionType.Storyline_SelectionToggled,"User toggled selection",[this.getModelId()],[i.CardType[this._cardVE.cardType]])),this._args.cardSelectionManager.toggleSelection(this._cardVE)){var e=this._cardVE.getCardSelectionStatusVE();e&&e.setFocus()}else this._cardVE.setFocus();return!1},s.prototype.createMenuChildArgs=function(e,t){var n={host:e,cardDeckMenu:t,authoringModel:this._args.authoringModel,cardDeckAnimationsComplete:this._args.authoringModel.cardDeckAnimationsComplete,paneStateManager:this._args.paneStateManager,resourceFactory:this._args.resourceFactory,transformManager:this._args.transformManager,cardsContainer:this._args.cardsContainer,cardSelectionManager:this._args.cardSelectionManager,card:this._cardVE};return new TDB.ChildArgs(i.CardMenuVE,n)},s.prototype.clearSelection=function(){this._args.cardSelectionManager.isInMultiselectMode()&&this._args.cardSelectionManager.clearSelection()},s.prototype.getSelectionState=function(e){return this._args.cardSelectionManager.isSelected(this._cardVE,e)},s.prototype.getCardSelectionStateDescription=function(e){return this.getSelectionState(e)?Resources.SelectedStateDescription:""},s.prototype.getCardCollapsedStateDescription=function(e){return""},s.prototype.getStorylineDescriptionWithState=function(e,t){void 0===t&&(t=!1);var n=this.getStorylineDescriptionWithError(e,t),o=this.getCardSelectionStateDescription(e),i=this.getCardCollapsedStateDescription(e);return ResourceManager.ResolveString(Resources.CardWithStateStorylineDescription,[n,o,i])},s.prototype.getStorylineDescriptionWithStateInMultipleSelection=function(e,t){void 0===t&&(t=!1);var n=this.getStorylineDescriptionWithState(e,t);if(!this.getSelectionState(e))return n;var o=this._args.cardSelectionManager.getSelection(e),i=o.length>0?ResourceManager.ResolveString(Resources.CardSelectionCountLabelPlural,[o.length]):"";return i?ResourceManager.ResolveString(Resources.MultipleSelectedCardWithStateStorylineDescription,[n,i]):n},s.prototype.moveCard=function(e){if(!this.inSocket()){var t=this._args.cardSelectionManager.isInMultiselectMode()?this._args.cardSelectionManager.getSelection(null,!0):[this._cardVE],n=this._args.cardsContainer.getVisualCardList(),o=e?t.last():t.first(),i=e?n.indexOfLast(function(e){return e.card===o}):ArrayExtensions.indexOfFirst(n,function(e){return e.card===o});if(i<0)StoryLog.RaiseRecoverableError("Card to be moved is not found on the visual list. That should not be possible.");else{var r;if(e)for(r=i+1;r<n.length&&!this.tryMoveCardsToAfterCardVisualIndex(n,t,r);r++);else for(r=i-2;r>=0&&!this.tryMoveCardsToAfterCardVisualIndex(n,t,r);r--);}}},s.prototype.tryMoveCardsToAfterCardVisualIndex=function(e,n,r){var a=e[r];if(ArrayExtensions.contains(n,a.card))return StoryLog.RaiseRecoverableError("Can't move a card after itself. This should never happen"),!1;var s=a.card.isContainerCard()&&!a.containerEnd,l=e[r+1]&&e[r+1].containerEnd,c=o.currentStoryController().get(this.pageId).findOrCreateGroupInsertionPoint(a.card.getViewModel().getModel(),l,s),d={parent:c.parent,index:c.index};if(!i.AddAction.isAvailable(i.AuthoringHelperMethods.convertViewElementsToCards(n,this.pageId),d,this.pageId))return!1;for(var u=!1,p=0,g=n;p<g.length;p++){var h=g[p],C=o.currentStoryController().get(this.pageId).findContainingGroup(h.getViewModel().getModel()),f=C.children.getCollection().indexOf(h.getViewModel().getModel());c.parent===C&&c.index===f+1&&(u=!0)}if(u)return!1;if(a.card.getViewModel().tryMoveAfter(n,c,"Card moved to new location via keyboard.")){var m=e.map(function(e){return e.card.getViewModel().getCardDefinition().id}),y={};return this.card.model&&this.card.model&&t.TextCardViewModel.isPullQuote(this.card.model)&&(y.isPullQuote=!0),ActionLogger.RecordClientAction(new ClientAction.CardDeckMoveCardKeyboardAction(m,this.card.definition.id,y)),!0}return!1},s.prototype.tryMoveAfter=function(t,n,o){var r=this;return!ArrayExtensions.contains(t,this._cardVE)&&(e.Model.currentUndoManager().get(this.pageId).captureUserAction(function(){var e;TDB.applyUpdate(function(){e=i.AuthoringHelperMethods.moveElementsToLocation(t,n.parent,n.index,r.pageId,o)}),r._args.cardsContainer.computeCardDeckElements(),r._args.cardsContainer.scrollToModelsAndSetFocus(e,!0)},"User reordered cards."),!0)},s.prototype.hasSockets=function(){return this.card.definition&&this.card.definition.hasSockets()},s.prototype.requiredSocketNotEmpty=function(e){var t=this.sockets.getValue(),n=t.length;if(0===n)return!1;for(var o=0;o<n;o++)if(t[o].getDefinition().isSocketRequired())if(this.isSocketBackingEditor(e,t[o])){if(this._cardVE.isTextAreaEmpty(e))return!1}else if(t[o].isSocketContentEmpty(e))return!1;return!0},s.prototype.isSocketBackingEditor=function(e,t){var n=this._cardVE.getPrimaryInputElement();return!!n&&n.getViewModel().getModel()===t.getModelObject(e)},s.prototype.getView=function(){return this._cardVE},s.prototype.getExpandedViewModelCreationArgs=function(){return{cardFactory:this._args.cardFactory,cardModel:this.card.model,card:this._cardVE,cardViewModel:this}},s.prototype.areCollapsedOrTeaserMode=function(e){return this.isCollapsed(e)||this.inTeaserMode(e)},s.prototype.inSocket=function(){return void 0!=this.getSocket()},s.prototype.getSocketLabel=function(){return this.inSocket()?this.getSocket().getDefinition().getTitle():""},s.prototype.supportsAltText=function(e){return!1},s.prototype.socketShowsWhenCollapsed=function(){if(this.inSocket()){var e=this.getSocket().getDefinition();return e&&e.shouldShowWhenCollapsed()}return!1},s.prototype.getAuthoringCapabilities=function(){if(this.inSocket())return this.getSocket().getDefinition().getAuthoringCapabilities();var e=o.Socket.createSocketForModel(this.card.model,this.pageId);return e?e.getDefinition().getAuthoringCapabilities():void 0},s.prototype.extraPastedModels=function(e){for(var t=[],n=0;n<e.length;n++)this.canAddPastedModel(e[n].model)||t.push(e[n]);return t},s.prototype.canAddPastedModel=function(e){return!1},s.prototype.addModelObjectsAndSetFocus=function(e,t){for(var n=t.length,o=0;o<n;o++){if(!this.canAddModelObject(t[o]))return!1;this.addModelAndSetFocus(e,t[o])}return!0},s.prototype.canAddModelObject=function(e){return!1},s.prototype.addModelAndSetFocus=function(e,t){},s.prototype.getVisualization=function(e){},s.prototype.shouldShowJackIcon=function(){return!0},s.prototype.canAddAnyContent=function(e){return!1},s}(Disposable);t.CardViewModel=a}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewElements,o=e.Model.AuthoringModel,i=function(i){function r(e,t,n){var o=i.call(this,e,t,n)||this;return o.tweenerActive=TDB.watchableTag(596460103,o,!1),o._args=n,o}return __extends(r,i),r.prototype.createGroup=function(t){var i=this,r=[];if(r.push(this.card.model),this.isDraggableNewCard(t)){var a,s=o.currentStoryController().get(this.pageId),l=s.findParent(this.card.model);if(!l)return;var c=s.findContainingCollection(this.card.model,l);if(!c)return;var d=c.getCollection().indexOf(this.card.model)+1;TDB.applyUpdate(function(){a=n.AuthoringHelperMethods.moveElementsToLocation(t,l,d,i.pageId,"Added a group").firstOrDefault()}),r.push(a)}else for(var u=0;u<t.length;u++){var p=t[u]instanceof n.CardVE?t[u]:void 0;if(!p)throw StoryApp.RethrowLogger.createError("We only allow dropping Card elements or CardOption element on ContentCards.");r.push(p.getViewModel().getModel())}ActionLogger.RecordClientAction(new ClientAction.StorylineActionData(ClientAction.ActionType.Storyline_DragAndDrop_CreatedGroup,"User created a group by dragging and dropping cards",[],o.currentStoryController().get(this.pageId).getLoggableContentTypes(r,this._args.cardDefinitionManager))),e.Model.currentUndoManager().get(this.pageId).captureUserUpdate(function(){n.GroupAction.execute({modelObjects:r,cardsContainer:i._args.cardsContainer,transformManager:i._args.transformManager,paneStateManager:i._args.paneStateManager},i.pageId)},"User dragged a card onto a card, auto-grouping the cards currently selected")},r.prototype.isDraggableNewCard=function(e){return 1==e.length&&e[0]instanceof n.CardOptionVE},r.prototype.getModelsTransform=function(e){for(var t=[],o=0;o<e.length;o++){var i=e[o]instanceof n.CardVE?e[o]:void 0;if(void 0==i)return null;t.push(i.getViewModel().getModel())}return t.push(this.card.model),this._args.transformManager.getDefaultTransforms(t)},r.prototype.canTakeAction=function(e,n){return!(e===t.CardAction.Remove&&!t.DeleteAction.isAvailable([this.card.model],this.pageId))&&i.prototype.canTakeAction.call(this,e,n)},r.prototype.getTransformOptionForDraggable=function(e){var t;if(this.isDraggableNewCard(e)){var n=e[0];t=this._args.transformManager.getModelBlueprintDefaultTransform(this.card.model,n.card)}else t=this.getModelsTransform(e);return t},r.prototype.createTweenerArgs=function(){return{model:this.card.model,authoringModel:this._args.authoringModel,fileUploader:this._args.fileUploader,cardsContainer:this._args.cardsContainer,cardSelectionManager:this._args.cardSelectionManager,cardDragHandler:this._args.cardDragHandler,clickable:!this.inSocket(),visible:{compute:new TDB.ComputedOptionArgs(this,this.tweenerVisible)},activeDropTarget:this.tweenerActive}},r.prototype.isSelectionOverlayVisible=function(e){return this._args.cardSelectionManager.isInMultiselectMode(e)},r.prototype.tweenerVisible=function(e){return this._cardVE.isVisible(e)&&!this.inTeaserMode(e)},r.prototype.generateTextAbilities=function(){if(this.inSocket()&&this.getSocket().getDefinition().getAuthoringCapabilities()){var e=this.getSocket().getDefinition().getAuthoringCapabilities();return{header:e.textHeading,emphasis:e.textEmphasis,special:e.textAccent,link:e.textLink,bullets:e.textBullets,numbers:e.textBullets,direction:e.textDirection}}},r}(t.CardViewModel);t.ContentCardViewModel=i}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=function(e){function t(t,o,i){var r=e.call(this,t,o,i)||this;return r.card=new n.MediaContentCard({model:o,definition:i.cardDefinition}),r}return __extends(t,e),t.prototype.embedDocumentImage=function(){var e=this.getResourceType();return"Default"==e?CommonSettings.ContentBaseUrl+"Embed_Icon_Default_24x24x32.png":CommonSettings.ContentBaseUrl+"Embed_Icon_"+e+"_48x48x32.png"},t.prototype.embedDocumentClassName=function(e){return"EmbedDocument_"+this.getResourceType(e)},t.prototype.embedDocumentFontIconName=function(){return{Word:FontIcons.CardWordIcon,PowerPoint:FontIcons.CardPowerPointIcon,Excel:FontIcons.CardExcelIcon,PDF:FontIcons.AddContentPDFIcon,Default:FontIcons.AddContentDefaultDocumentIcon}[this.getResourceType()]},t.prototype.hasUploadInfo=function(e){return void 0!=this.card.model.getUploadInfo(e)},t.prototype.getExtension=function(e){return this.hasUploadInfo(e)?DocumentIngestion.DocumentIngestionAPI.getFileExtension(this.card.model.getUploadInfo(e).getFileName(e)):void 0},t.prototype.isErrorPlaceholderVisible=function(e){return this.compareUploadStatus(e,n.UploadStatus.Error)},t.prototype.isUploadingPlaceholderVisible=function(e){return this.compareUploadStatus(e,n.UploadStatus.Uploading)},t.prototype.compareUploadStatus=function(e,t){return n.StoryController.getUploadStatus(this.card.model,e)==t},t.prototype.getResourceType=function(e){var t,n=this.getExtension(e);return"doc"===n||"docx"===n?t="Word":"ppt"===n||"pptx"===n?t="PowerPoint":"pdf"===n?t="PDF":"xls"==n||"xlsx"==n?t="Excel":(t="Default",void 0==n||this.isErrorPlaceholderVisible(e)||StoryLog.StructuredTraceTag(596473676,Diag.ULSCat.msoulscat_Story_DocumentImport,Diag.ULSTraceLevel.error,"Unknown document extension",{"extension:":n})),t},t}(t.ContentCardViewModel);t.MediaContentCardViewModel=o}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n,o=e.Model.AuthoringModel,i=e.View.ViewElements,r=e.Model.SM,a=e.Model.CSM;!function(e){e[e.Generic=0]="Generic",e[e.TimeOut=1]="TimeOut",e[e.CorruptedFile=2]="CorruptedFile",e[e.InternalProcessingError=3]="InternalProcessingError",e[e.MaximumSwaySizeExceeded=4]="MaximumSwaySizeExceeded",e[e.IngestionDisabled=5]="IngestionDisabled",e[e.FormatDisabled=6]="FormatDisabled",e[e.FeatureDisabled=7]="FeatureDisabled",e[e.UnsupportedFormat=8]="UnsupportedFormat"}(n=t.MediaCardErrorMessage||(t.MediaCardErrorMessage={}));var s=function(s){function l(e,t,n){var i=s.call(this,e,t,n)||this;return i.card=new o.MediaCard({model:t,definition:n.cardDefinition}),i.uploadController=TDB.watcherTag(596473677,i,i,i.calcUploadController),i._uploadComplete=TDB.watchableTag(596473678,i,!1),i.captionTelemetryId=null!=n.captionTelemetryId?n.captionTelemetryId:ClientAction.ButtonId.Media_TextField,i.thumbnailFailedToLoad=TDB.watchableTag(596473679,i,!1),i}return __extends(l,s),l.prototype.getModel=function(){return this.card.model},l.prototype.getMedia=function(e){return o.StoryController.isModelObjectValid(this.card.model)?this.card.model.getMedia(e):void 0},l.prototype.getErrorText=function(e){var t=this.getMedia(e);if(t){var i=t.getUploadInfo(e),r=this.getUploadStatus(e),a=this.getErrorMessage(e);if(i&&i.getFileName(e),r==o.UploadStatus.Error)return null!=a?this.uploadErrorMessage(a):this.uploadErrorMessage(n.Generic);if(r==o.UploadStatus.PreprocessingError)return null!=a?this.preprocessingErrorMessage(a):this.preprocessingErrorMessage(n.Generic)}return""},l.prototype.getStatusText=function(e){var t=this.getMedia(e);if(t){var n=t.getUploadInfo(e),i=this.getUploadStatus(e);if(this.getErrorMessage(e),n&&n.getFileName(e),i===o.UploadStatus.Uploading)return this.uploadingMessage();if(i===o.UploadStatus.Transferring)return StoryPageEditSettings.MediaTransferProgressEnabled?this.transferringMessage():this.uploadingMessage();if(i===o.UploadStatus.WaitingPreprocessing)return this.waitingPreprocessingMessage();if(i===o.UploadStatus.Preprocessing)return this.preprocessingMessage()}return""},l.prototype.getUploadStatus=function(e){var n=this,i=this.getMedia(e),r=this.uploadController.getWatchedValue(e);if(r){if(r.isFaulted(e))return o.UploadStatus.Error;if(!r.isComplete(e))return o.UploadStatus.Uploading;r.isComplete(e)&&(t.UploadManager.getInstance().removeUploadController(i?i.id:null),TDB.applyUpdate(function(){return n._uploadComplete.setValue(!0)},TDB.Justification.UploadManagement))}return this._controller.isUploadStatusAvailable(e)?this._controller.getUploadStatus(i,e):o.UploadStatus.Uploading},l.prototype.isAugmentationFinished=function(t){var n=this.getMedia(t),o=n?e.Model.ContentStorageModel.getModelObject(n.id):void 0;if(o){var i=o.getContentState(t);return null!=i&&(i===a.ContentState.Ready||i===a.ContentState.Failed)}return e.Model.ContentStorageModel.contentRoot.contentNodes.getCollection(t),!1},l.prototype.isWaitingForAugmentation=function(e){return!this.isAugmentationFinished(e)&&this.thumbnailFailedToLoad.getWatchedValue(e)},l.prototype.getEmphasis=function(e){return this.getMedia(e).getEmphasis(e)},l.prototype.setEmphasis=function(e){var t=this;TDB.applyUpdate(function(){t.getMedia().setEmphasis(e)})},l.prototype.getPlaceholderCardViewModel=function(){return this.placeholderCardViewModel||(this.placeholderCardViewModel=this._args.cardFactory.createPlaceholderCardVM(this,{context:this,acceptBlueprints:this.mediaPlaceholderAcceptBlueprints,addModelObjects:this.mediaPlaceholderAddModelObjects,cardParent:this._cardVE})),this.placeholderCardViewModel},l.prototype.calcUploadController=function(e){if(!this._uploadComplete.getWatchedValue(e)){var n=this.card.model.getMedia(e),o=n?n.id:"";return t.UploadManager.getInstance().getUploadController(o,e)}},l.prototype.getMediaSize=function(e){return this._controller.getMediaSize(this.getMedia(e),e)},l.prototype.getImageSource=function(e){var t=this._controller.calculateSourceUrl(this.getMedia(e),e);return t&&t.match(/^sway:\/\/resource\/([^\/]+)\/([^\/]+)/i)&&(t=Icons.AddContentCameraIcon),t},l.prototype.getImageMaxHeight=function(e){var t=l.MinimumCardHeight,n=l.StorylineImageQuality,o=this.getMediaSize(e);if(!o)return t;var i=o.width,r=o.height;if(!i||!r)return t;var a=i/r,s=Math.min(n/a,r);return s<=t?t:s>=n?n:s},l.prototype.isErrorPlaceholderVisble=function(e){var t=this.getUploadStatus(e);return t===o.UploadStatus.Error||t===o.UploadStatus.PreprocessingError},l.prototype.isUploadingPlaceholderVisble=function(e){if(this.isWaitingForAugmentation(e))return!0;var t=this.uploadController.getWatchedValue(e);if(t&&t.isPaused(e))return!1;var n=this.getUploadStatus(e);return this.showUploadPlaceholderForStatus(n)},l.prototype.showUploadPlaceholderForStatus=function(e){return e===o.UploadStatus.Uploading||e===o.UploadStatus.WaitingPreprocessing||e===o.UploadStatus.Preprocessing||e==o.UploadStatus.Transferring},l.prototype.isImageVisble=function(e){var t=this.getUploadStatus(e);return t!=o.UploadStatus.Error&&t!=o.UploadStatus.PreprocessingError},l.prototype.mediaPlaceholderAddModelObjects=function(t){var n=this,r=[];t.forEach(function(e){return r.push(e.model)});var a=r.slice(0),s=this.card,l=this._cardVE.cardParent;e.Model.currentUndoManager().get(this.pageId).captureUserUpdate(function(){for(var e=a.length,r=0;r<e;r++){var c=a[r];if(c.id!==n.card.model.id){var d=!1;switch(n._cardVE.cardType){case i.CardType.Image:d=o.ObjectController.modelIsImage(c);break;case i.CardType.Video:d=o.ObjectController.modelIsVideo(c);break;case i.CardType.Audio:d=o.ObjectController.modelIsAudio(c)}if(d&&n._controller.canAdd([t[r]],{parent:n.card.model,socket:n.getSocketIndex()})){n._controller.add([t[r]],{parent:n.card.model,socket:n.getSocketIndex()}),a.splice(r,1),l instanceof i.ComplexHeadingCardVE?t.splice(r,1):t.splice(r,1,s);break}}}n._cardVE.setFocus(),t&&t.length>0&&n._args.cardsContainer.addModelObjectsToAncestor(t),n._args.cardsContainer.scrollToCardsAndSetFocus([n._cardVE],!1)},"User added content to the placeholder of a media composite card"),i.AddAction.logAdd(t,this.pageId,"Added to a media placeholder",this.getModel())},l.prototype.mediaPlaceholderAcceptBlueprints=function(e){return this._controller.canAddBlueprints(e,{parent:this.card.model,socket:this.getSocketIndex()})},l.prototype.getSocketIndex=function(){switch(this._cardVE.cardType){case i.CardType.Image:return o.ImageController.ImageSocket;case i.CardType.Video:return o.VideoController.VideoSocket;case i.CardType.Audio:return o.AudioController.AudioSocket;default:return-1}},l.prototype.isStatusMessageVisible=function(e){if(this.card.model&&this.getMedia(e)){var t=this.getUploadStatus(e);return t!==o.UploadStatus.Completed&&t!==o.UploadStatus.PreprocessingError&&t!==o.UploadStatus.Error}return!1},l.prototype.isPlaceholderVisible=function(e){if(!this.card.model||!this.card.model.getMedia(e))return!0;var t=this.card.model.getMedia(e);return!(!o.MediaController.isMediaEmpty(t,e)||t.getUploadInfo(e))},l.prototype.calcTextSocket=function(e){if(this.card.model){var n=this.generateTextAbilities(),o=new t.CommonTextViewModel({card:this,pageId:this.pageId,textModel:this.card.model.getText(e),cardSelectionManager:this._args.cardSelectionManager,textAggregator:this._cardVE.getTextAggregator(),fileUploader:this._args.fileUploader,cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,onCanvas:this._cardVE.cardParent.isPopup});n?o.abilities=n:(o.abilities.header=!1,o.abilities.bullets=!0,o.abilities.numbers=!0);var r={viewModel:o,focusedAuthors:this._focusedAuthors,placeholder:Resources.CardDeckMediaCardCaptionPlaceholder,resourceFactory:this._args.resourceFactory,telemetryId:this.captionTelemetryId};return new TDB.ChildArgs(i.TextGroupVE,r)}},l.prototype.getFilename=function(e){var t="";if(this.card.model){var n=this.getMedia(e);if(n){var o=n.getUploadInfo(e);t=o&&o.getFileName(e)}}return t},l.prototype.canTakeAction=function(e,n){return(e!=t.CardAction.DesignHints||!this._cardVE.getViewModel().inTeaserMode(n))&&(!!s.prototype.canTakeAction.call(this,e,n)||!(e!=t.CardAction.Remove||!t.DeleteAction.isAvailable([this.card.model],this.pageId)))},l.prototype.mediaCardImageOverlaySupported=function(){return!1},l.prototype.getOverlayIcon=function(e){},l.prototype.createAltText=function(e){var t=this.getMedia(e);return o.MediaController.getDefaultAltText(t,e)},l.prototype.isBackground=function(){return o.HeaderController.modelIsTitleBackground(this.card.model,o.currentStoryController().get(this.pageId).findContainingGroup(this.card.model))},l.prototype.isRootBackground=function(){var e=o.currentStoryController().get(this.pageId);return this.isBackground()&&e.findParent(this.card.model)===e.getRootGroup()},l.prototype.isThumbnailOverlayVisible=function(e){var t=this.getMedia();return this.getUploadStatus(e)!=o.UploadStatus.Completed||(!!this.isWaitingForAugmentation(e)||!o.MediaController.isMediaEmpty(t,e)&&(t instanceof r.VideoContent||t instanceof r.AudioContent||!(!this.isBackground()||this.isRootBackground())))},l.prototype.isErrorMessageVisible=function(e){if(o.StoryController.isModelObjectValid(this.card.model)&&this.getMedia(e)){var t=this.getUploadStatus(e);return t==o.UploadStatus.Error||t==o.UploadStatus.PreprocessingError}return!1},l.prototype.preprocessingErrorMessage=function(e){throw StoryApp.RethrowLogger.createError("Not implemented by inherited class")},l.prototype.uploadingMessage=function(){return Resources.DocumentIngestionIngestToExistingMessage},l.prototype.transferringMessage=function(){throw StoryApp.RethrowLogger.createError("Not implemented by inherited class")},l.prototype.waitingPreprocessingMessage=function(){throw StoryApp.RethrowLogger.createError("Not implemented by inherited class")},l.prototype.preprocessingMessage=function(){return Resources.DocumentIngestionIngestToExistingMessage},l.prototype.getErrorMessage=function(t){var o=this.getMedia(t),i=e.Model.ContentStorageModel.getModelObject(o.id);if(i){var r=i.getMetadata();if(r)return this.convertFromSCMError(r.getProcessingError())}var a=o.getUploadInfo(t);return a?this.convertFromSMError(a.getErrorMessage(t)):n.Generic},l.prototype.convertFromSCMError=function(t){switch(t){case e.Model.CSM.ProcessingErrorMessage.TimeOut:return n.TimeOut;case e.Model.CSM.ProcessingErrorMessage.InternalProcessingError:return n.InternalProcessingError;case e.Model.CSM.ProcessingErrorMessage.FeatureDisabled:return n.FeatureDisabled;case e.Model.CSM.ProcessingErrorMessage.CorruptedFile:return n.CorruptedFile;case e.Model.CSM.ProcessingErrorMessage.UnsupportedFormat:return n.UnsupportedFormat;default:return n.Generic}},l.prototype.convertFromSMError=function(e){return e},l.prototype.hintText=function(e){var t=this.card.model.getText(e);if(t){var n=t.getAuthoringHint(e);if(n)return n.getContent().getText()}return""},l.prototype.clearHint=function(){var t=this;this.card.model.getText().getAuthoringHint()&&e.Model.currentUndoManager().get(this.pageId).captureUserUpdate(function(){t.card.model.getText().setAuthoringHint(null)},"User dissmised a hint")},l.prototype.getHint=function(e){var t=this.card.model.getText(e);return t?t.getAuthoringHint(e):void 0},l.prototype.canAddPastedModel=function(e){var t=this.getModel(),n=o.MediaController.isMediaEmpty(t.getMedia()),i=e instanceof r.MediaWithTextComposite;if(n&&i){var a=e.getMedia();if(!o.MediaController.isMediaEmpty(a))return t.setMedia(a),!0}return!1},l.prototype.areCollapsedOrTeaserMode=function(e){return this.isCollapsed(e)||this.inTeaserMode(e)},l.MinimumCardHeight=148,l.StorylineImageQuality=320,l}(t.ContentCardViewModel);t.MediaCardViewModel=s}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=e.Model.SM,i=function(e){function i(t,o,i){var r=e.call(this,t,o,i)||this;return r._controller=n.currentAudioController().get(r.pageId),r}return __extends(i,e),i.prototype.getTitle=function(e){var t="";if(n.StoryController.isModelObjectValid(this.card.model)){var o=this.card.model.getMedia(e);o&&(t=o.getTitle(e))}return t},i.prototype.mediaCardImageOverlaySupported=function(){return!0},i.prototype.uploadErrorMessage=function(e){switch(e){case t.MediaCardErrorMessage.TimeOut:return Resources.UploadErrorTimeout;case t.MediaCardErrorMessage.CorruptedFile:return Resources.AudioUploadFileCorruptedError;case t.MediaCardErrorMessage.MaximumSwaySizeExceeded:return Resources.AudioUploadExceedsSwayLengthMessage;case t.MediaCardErrorMessage.FormatDisabled:case t.MediaCardErrorMessage.UnsupportedFormat:return Resources.AudioUploadFormatDisabled;case t.MediaCardErrorMessage.FeatureDisabled:return Resources.AudioUploadDisabled;case t.MediaCardErrorMessage.Generic:case t.MediaCardErrorMessage.InternalProcessingError:default:return Resources.AudioUploadFileCorruptedError}},i.prototype.preprocessingErrorMessage=function(e){switch(e){case t.MediaCardErrorMessage.TimeOut:return Resources.UploadErrorTimeout;case t.MediaCardErrorMessage.CorruptedFile:return Resources.AudioUploadFileCorruptedError;case t.MediaCardErrorMessage.MaximumSwaySizeExceeded:return Resources.AudioUploadExceedsSwayLengthMessage;case t.MediaCardErrorMessage.FormatDisabled:case t.MediaCardErrorMessage.UnsupportedFormat:return Resources.AudioUploadFormatDisabled;case t.MediaCardErrorMessage.FeatureDisabled:return Resources.AudioUploadDisabled;case t.MediaCardErrorMessage.Generic:case t.MediaCardErrorMessage.InternalProcessingError:default:return Resources.AudioUploadAmsInternalErrorMessage}},i.prototype.getOverlayIcon=function(e){var t={fontIconName:{value:FontIcons.AudioIcon},fontIconSizeClass:FontIcons.AudioIconSize,fontIconWrapperClass:{value:"OverlayIconText"},fontIconBackgroundColorClass:"ThumbnailFontIconBackgroundColor"};return new TDB.ChildArgs(VE.FontIconVE,t)},i.prototype.createAltText=function(e){return""},i.prototype.uploadingMessage=function(){var t=e.prototype.getModel.call(this).getMedia().getDecompInfo(),n=t?t.getProvider():void 0;return n===o.ContentProvider.OneDrive||n===o.ContentProvider.OneDrivePro?this.waitingPreprocessingMessage():StoryPageEditSettings.MediaProcessProgressEnabled?Resources.UploadingMediaMessage:Resources.UploadingVideoMessage},i.prototype.transferringMessage=function(){return Resources.TransferringAudioMessage},i.prototype.waitingPreprocessingMessage=function(){return StoryPageEditSettings.MediaProcessProgressEnabled?Resources.AudioWaitingForProcessingMessage:Resources.WaitingForProcessingAudioMessage},i.prototype.preprocessingMessage=function(){var t=e.prototype.getModel.call(this).getMedia();if(!(t instanceof o.AudioContent))throw StoryApp.RethrowLogger.createError("Media should be instance of IAudioContent");var n=t;return n&&n.getCopyInfo()?Resources.CopyingAudioMessage:StoryPageEditSettings.MediaProcessProgressEnabled?Resources.ProcessingAudioMessage:Resources.PreparingAudioMessage},i.prototype.canTakeAction=function(o,i){if(o===t.CardAction.Record){if(!n.StoryController.isModelObjectValid(this.card.model)||!this.card.model.getMedia(i))return!1;var r=this.card.model.getMedia(i);return!StoryPageEditSettings.BlockAuthoring_Recording&&n.MediaController.isMediaEmpty(r)&&!r.getUploadInfo(i)}return e.prototype.canTakeAction.call(this,o,i)},i.prototype.areCollapsedOrTeaserMode=function(t){return e.prototype.areCollapsedOrTeaserMode.call(this,t)||!StoryPageEditSettings.SocketifiedAudioCardEnabled},i}(t.MediaCardViewModel);t.AudioCardViewModel=i}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=e.View.ViewElements,r=function(e){function r(t,n){var o=e.call(this,t)||this;return o._args=n,o}return __extends(r,e),r.prototype.createGroupCardArgs=function(e){return{viewModel:e.viewModel,cardParent:e.cardParent,authoringModel:this._args.authoringModel,cardsContainer:this._args.cardsContainer,cardDeckMenuHost:this._args.cardDeckMenuHost,cardSelectionManager:this._args.cardSelectionManager,cardDragHandler:this._args.cardDragHandler,cardFactory:this,resourceFactory:this._args.resourceFactory,showSocketLabel:e.showSocketLabel,paneStateManager:this._args.paneStateManager}},r.prototype.createGroupCardVM=function(e,n){var i=this._args.authoringModel.getPageId(),r=o.currentStoryController().get(i),a=n.model,s=a===r.getRootGroup()?o.ManualCardType.rootSectionId:o.ObjectController.modelIsSection(a,i)?o.ManualCardType.SectionId:o.ManualCardType.SubSectionId;return new t.GroupCardViewModel(e,n.model,{cardDefinitionManager:this._args.cardDefinitionManager,cardFactory:this,authoringModel:this._args.authoringModel,firstRunManager:this._args.authoringModel.firstRunManager,cardSelectionManager:this._args.cardSelectionManager,fileUploader:this._args.fileUploader,cardsContainer:this._args.cardsContainer,cardDragHandler:this._args.cardDragHandler,cardMode:n.cardMode,parentSuggestedCardModeWatchable:n.parentSuggestedCardModeWatchable,interactiveWatchable:n.interactiveWatchable,paneStateManager:this._args.paneStateManager,transformManager:this._args.transformManager,resourceFactory:this._args.resourceFactory,socket:n.socket,cardDefinition:this._args.cardDefinitionManager.getCardDefinition(s)})},r.prototype.createSetCardArgs=function(e){return{viewModel:e.viewModel,cardParent:e.cardParent,authoringModel:this._args.authoringModel,cardsContainer:this._args.cardsContainer,cardSelectionManager:this._args.cardSelectionManager,cardDeckMenuHost:this._args.cardDeckMenuHost,cardDragHandler:this._args.cardDragHandler,cardFactory:this,hasHeaderIcon:!0,resourceFactory:this._args.resourceFactory,showSocketLabel:e.showSocketLabel,paneStateManager:this._args.paneStateManager}},r.prototype.createSetCardVM=function(e,n){return new t.SetCardViewModel(e,n.model,{cardDefinitionManager:this._args.cardDefinitionManager,cardFactory:this,authoringModel:this._args.authoringModel,cardSelectionManager:this._args.cardSelectionManager,fileUploader:this._args.fileUploader,cardsContainer:this._args.cardsContainer,cardDragHandler:this._args.cardDragHandler,cardMode:n.cardMode,parentSuggestedCardModeWatchable:n.parentSuggestedCardModeWatchable,parentCollapsed:n.parentCollapsed,interactiveWatchable:n.interactiveWatchable,paneStateManager:this._args.paneStateManager,resourceFactory:this._args.resourceFactory,transformManager:this._args.transformManager,socket:n.socket,cardDefinition:this._args.cardDefinitionManager.getCardDefinition(o.ManualCardType.GroupId)})},r.prototype.createTextCardArgs=function(e){return{viewModel:e.viewModel,cardParent:e.cardParent,authoringModel:this._args.authoringModel,cardsContainer:this._args.cardsContainer,cardDeckMenuHost:this._args.cardDeckMenuHost,cardDragHandler:this._args.cardDragHandler,resourceFactory:this._args.resourceFactory,showSocketLabel:e.showSocketLabel}},r.prototype.createTextCardVM=function(e,n){return new t.TextCardViewModel(e,n.model,{cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,transformManager:this._args.transformManager,paneStateManager:this._args.paneStateManager,fileUploader:this._args.fileUploader,cardSelectionManager:this._args.cardSelectionManager,authoringModel:this._args.authoringModel,cardDragHandler:this._args.cardDragHandler,cardMode:n.cardMode,parentSuggestedCardModeWatchable:n.parentSuggestedCardModeWatchable,interactiveWatchable:n.interactiveWatchable,cardFactory:this,resourceFactory:this._args.resourceFactory,socket:n.socket,cardDefinition:this._args.cardDefinitionManager.getCardDefinition(o.ManualCardType.TextId)})},r.prototype.createEmbedCardArgs=function(e){return{viewModel:e.viewModel,cardParent:e.cardParent,authoringModel:this._args.authoringModel,cardsContainer:this._args.cardsContainer,cardDeckMenuHost:this._args.cardDeckMenuHost,cardDragHandler:this._args.cardDragHandler,resourceFactory:this._args.resourceFactory,showSocketLabel:e.showSocketLabel}},r.prototype.createEmbedCardVM=function(e,n){return new t.EmbedCardViewModel(e,n.model,{cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,transformManager:this._args.transformManager,paneStateManager:this._args.paneStateManager,authoringModel:this._args.authoringModel,cardDragHandler:this._args.cardDragHandler,fileUploader:this._args.fileUploader,cardSelectionManager:this._args.cardSelectionManager,cardMode:n.cardMode,parentSuggestedCardModeWatchable:n.parentSuggestedCardModeWatchable,interactiveWatchable:n.interactiveWatchable,cardFactory:this,resourceFactory:this._args.resourceFactory,socket:n.socket,cardDefinition:this._args.cardDefinitionManager.getCardDefinition(o.ManualCardType.EmbedId)})},r.prototype.createCodeCardArgs=function(e){return{viewModel:e.viewModel,cardParent:e.cardParent,authoringModel:this._args.authoringModel,cardsContainer:this._args.cardsContainer,cardDeckMenuHost:this._args.cardDeckMenuHost,cardDragHandler:this._args.cardDragHandler,paneStateManager:this._args.paneStateManager,resourceFactory:this._args.resourceFactory,showSocketLabel:e.showSocketLabel}},r.prototype.createCodeCardVM=function(e,n){return new t.CodeCardViewModel(e,n.model,{cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,transformManager:this._args.transformManager,paneStateManager:this._args.paneStateManager,fileUploader:this._args.fileUploader,cardSelectionManager:this._args.cardSelectionManager,authoringModel:this._args.authoringModel,cardDragHandler:this._args.cardDragHandler,cardMode:n.cardMode,parentSuggestedCardModeWatchable:n.parentSuggestedCardModeWatchable,interactiveWatchable:n.interactiveWatchable,cardFactory:this,socket:n.socket,resourceFactory:this._args.resourceFactory,cardDefinition:this._args.cardDefinitionManager.getCardDefinition(o.ManualCardType.CodeId)})},r.prototype.createStatusUpdateCardArgs=function(e){return{viewModel:e.viewModel,cardParent:e.cardParent,authoringModel:this._args.authoringModel,cardsContainer:this._args.cardsContainer,cardDeckMenuHost:this._args.cardDeckMenuHost,cardDragHandler:this._args.cardDragHandler,paneStateManager:this._args.paneStateManager,cardFactory:this,placeholderFontIconName:FontIcons.TweetPlaceholderIcon,placeholderFontIconSizeClass:FontIcons.PlaceholderIconSize,placeholderText:Resources.CardDeckStatusPlaceholderText,placeholderDescription:Resources.CardDeckStatusPlaceholderText,placeholderDragText:Resources.CardDeckStatusPlaceholderDragText,resourceFactory:this._args.resourceFactory,showSocketLabel:e.showSocketLabel}},r.prototype.createStatusUpdateCardVM=function(e,n){return new t.StatusUpdateCardViewModel(e,n.model,{cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,transformManager:this._args.transformManager,paneStateManager:this._args.paneStateManager,cardFactory:this,authoringModel:this._args.authoringModel,fileUploader:this._args.fileUploader,cardDragHandler:this._args.cardDragHandler,cardSelectionManager:this._args.cardSelectionManager,placeholderFontIconName:FontIcons.TweetPlaceholderIcon,placeholderFontIconSizeClass:FontIcons.PlaceholderIconSize,placeholderText:Resources.CardDeckStatusPlaceholderText,placeholderDescription:Resources.CardDeckStatusPlaceholderText,placeholderDragText:Resources.CardDeckStatusPlaceholderDragText,cardMode:n.cardMode,parentSuggestedCardModeWatchable:n.parentSuggestedCardModeWatchable,interactiveWatchable:n.interactiveWatchable,resourceFactory:this._args.resourceFactory,socket:n.socket,cardDefinition:this._args.cardDefinitionManager.getCardDefinition(o.ManualCardType.StatusUpdateId)})},r.prototype.createDocumentCardArgs=function(e){return{viewModel:e.viewModel,cardParent:e.cardParent,authoringModel:this._args.authoringModel,cardsContainer:this._args.cardsContainer,cardDeckMenuHost:this._args.cardDeckMenuHost,cardDragHandler:this._args.cardDragHandler,resourceFactory:this._args.resourceFactory,showSocketLabel:e.showSocketLabel}},r.prototype.createDocumentCardVM=function(e,n){return new t.DocumentCardViewModel(e,n.model,{cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,transformManager:this._args.transformManager,paneStateManager:this._args.paneStateManager,authoringModel:this._args.authoringModel,fileUploader:this._args.fileUploader,cardDragHandler:this._args.cardDragHandler,cardSelectionManager:this._args.cardSelectionManager,cardMode:n.cardMode,parentSuggestedCardModeWatchable:n.parentSuggestedCardModeWatchable,interactiveWatchable:n.interactiveWatchable,cardFactory:this,resourceFactory:this._args.resourceFactory,socket:n.socket,cardDefinition:this._args.cardDefinitionManager.getCardDefinition(o.ManualCardType.DocumentId)})},r.prototype.createImportingOrEmbeddingDocumentCardArgs=function(e){return{viewModel:e.viewModel,cardParent:e.cardParent,authoringModel:this._args.authoringModel,cardsContainer:this._args.cardsContainer,cardDeckMenuHost:this._args.cardDeckMenuHost,cardDragHandler:this._args.cardDragHandler,resourceFactory:this._args.resourceFactory,showSocketLabel:e.showSocketLabel}},r.prototype.createImportingOrEmbeddingDocumentCardVM=function(e,n){return new t.ImportingOrEmbeddingDocumentCardViewModel(e,n.model,{cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,transformManager:this._args.transformManager,paneStateManager:this._args.paneStateManager,cardSelectionManager:this._args.cardSelectionManager,authoringModel:this._args.authoringModel,fileUploader:this._args.fileUploader,cardDragHandler:this._args.cardDragHandler,cardMode:n.cardMode,parentSuggestedCardModeWatchable:n.parentSuggestedCardModeWatchable,interactiveWatchable:n.interactiveWatchable,cardFactory:this,resourceFactory:this._args.resourceFactory,socket:n.socket,cardDefinition:this._args.cardDefinitionManager.getCardDefinition(o.ManualCardType.ImportingDocumentId)})},r.prototype.createImageCardArgs=function(e){return{viewModel:e.viewModel,cardParent:e.cardParent,authoringModel:this._args.authoringModel,cardsContainer:this._args.cardsContainer,cardDeckMenuHost:this._args.cardDeckMenuHost,cardDragHandler:this._args.cardDragHandler,paneStateManager:this._args.paneStateManager,cardFactory:this,fileUploader:this._args.fileUploader,placeholderFontIconName:FontIcons.ImagePlaceholderIcon,placeholderFontIconSizeClass:FontIcons.PlaceholderIconSize,placeholderText:Resources.CardDeckImagePlaceholderText,placeholderDescription:Resources.CardDeckImagePlaceholderText,placeholderDragText:Resources.CardDeckImagePlaceholderDragText,resourceFactory:this._args.resourceFactory,showSocketLabel:e.showSocketLabel}},r.prototype.createImageCardVM=function(e,n){return new t.ImageCardViewModel(e,n.model,{cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,transformManager:this._args.transformManager,paneStateManager:this._args.paneStateManager,fileUploader:this._args.fileUploader,cardSelectionManager:this._args.cardSelectionManager,authoringModel:this._args.authoringModel,cardDragHandler:this._args.cardDragHandler,cardMode:n.cardMode,parentSuggestedCardModeWatchable:n.parentSuggestedCardModeWatchable,interactiveWatchable:n.interactiveWatchable,cardFactory:this,socket:n.socket,cardDefinition:this._args.cardDefinitionManager.getCardDefinition(o.ManualCardType.ImageId),captionTelemetryId:ClientAction.ButtonId.Image_TextField,resourceFactory:this._args.resourceFactory})},r.prototype.createVideoCardArgs=function(e){return{viewModel:e.viewModel,cardParent:e.cardParent,authoringModel:this._args.authoringModel,cardsContainer:this._args.cardsContainer,cardDeckMenuHost:this._args.cardDeckMenuHost,cardDragHandler:this._args.cardDragHandler,paneStateManager:this._args.paneStateManager,cardFactory:this,fileUploader:this._args.fileUploader,placeholderFontIconName:FontIcons.VideoPlaceholderIcon,placeholderFontIconSizeClass:FontIcons.PlaceholderIconSize,placeholderText:Resources.CardDeckVideoPlaceholderText,placeholderDescription:Resources.CardDeckVideoPlaceholderText,placeholderDragText:Resources.CardDeckVideoPlaceholderDragText,resourceFactory:this._args.resourceFactory,showSocketLabel:e.showSocketLabel}},r.prototype.createVideoCardVM=function(e,n){return new t.VideoCardViewModel(e,n.model,{cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,transformManager:this._args.transformManager,paneStateManager:this._args.paneStateManager,fileUploader:this._args.fileUploader,cardSelectionManager:this._args.cardSelectionManager,authoringModel:this._args.authoringModel,cardDragHandler:this._args.cardDragHandler,cardMode:n.cardMode,parentSuggestedCardModeWatchable:n.parentSuggestedCardModeWatchable,interactiveWatchable:n.interactiveWatchable,cardFactory:this,socket:n.socket,cardDefinition:this._args.cardDefinitionManager.getCardDefinition(o.ManualCardType.VideoId),captionTelemetryId:ClientAction.ButtonId.Video_TextField,resourceFactory:this._args.resourceFactory})},r.prototype.createAudioCardArgs=function(e){return{viewModel:e.viewModel,cardParent:e.cardParent,authoringModel:this._args.authoringModel,cardsContainer:this._args.cardsContainer,cardDeckMenuHost:this._args.cardDeckMenuHost,cardDragHandler:this._args.cardDragHandler,paneStateManager:this._args.paneStateManager,cardFactory:this,fileUploader:this._args.fileUploader,placeholderFontIconName:FontIcons.AudioPlaceholderIcon,placeholderFontIconSizeClass:FontIcons.PlaceholderIconSize,placeholderText:Resources.CardDeckAudioPlaceholderText,placeholderDescription:Resources.CardDeckAudioPlaceholderText,placeholderDragText:Resources.CardDeckAudioPlaceholderDragText,resourceFactory:this._args.resourceFactory,showSocketLabel:e.showSocketLabel}},r.prototype.createAudioCardVM=function(e,n){return new t.AudioCardViewModel(e,n.model,{cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,transformManager:this._args.transformManager,paneStateManager:this._args.paneStateManager,fileUploader:this._args.fileUploader,cardSelectionManager:this._args.cardSelectionManager,authoringModel:this._args.authoringModel,cardDragHandler:this._args.cardDragHandler,cardMode:n.cardMode,parentSuggestedCardModeWatchable:n.parentSuggestedCardModeWatchable,interactiveWatchable:n.interactiveWatchable,cardFactory:this,socket:n.socket,cardDefinition:this._args.cardDefinitionManager.getCardDefinition(o.ManualCardType.AudioId),captionTelemetryId:ClientAction.ButtonId.Audio_TextField,resourceFactory:this._args.resourceFactory})},r.prototype.createAgaveCardArgs=function(e){return{viewModel:e.viewModel,cardParent:e.cardParent,authoringModel:this._args.authoringModel,cardsContainer:this._args.cardsContainer,cardDeckMenuHost:this._args.cardDeckMenuHost,cardDragHandler:this._args.cardDragHandler,resourceFactory:this._args.resourceFactory,showSocketLabel:e.showSocketLabel}},r.prototype.createAgaveCardVM=function(e,n){return new t.AgaveCardViewModel(e,n.model,{authoringModel:this._args.authoringModel,cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,transformManager:this._args.transformManager,paneStateManager:this._args.paneStateManager,previewVE:this._args.authoringModel.preview,cardDragHandler:this._args.cardDragHandler,fileUploader:this._args.fileUploader,cardSelectionManager:this._args.cardSelectionManager,cardMode:n.cardMode,parentSuggestedCardModeWatchable:n.parentSuggestedCardModeWatchable,interactiveWatchable:n.interactiveWatchable,cardFactory:this,resourceFactory:this._args.resourceFactory,socket:n.socket,cardDefinition:this._args.cardDefinitionManager.getCardDefinition(o.ManualCardType.ChartId)})},r.prototype.createTableCardArgs=function(e){return{viewModel:e.viewModel,cardParent:e.cardParent,authoringModel:this._args.authoringModel,cardsContainer:this._args.cardsContainer,cardDeckMenuHost:this._args.cardDeckMenuHost,cardDragHandler:this._args.cardDragHandler,resourceFactory:this._args.resourceFactory,showSocketLabel:e.showSocketLabel,paneStateManager:this._args.paneStateManager,cardFactory:this}},r.prototype.createTableCardVM=function(e,n){return new t.TableCardViewModel(e,n.model,{authoringModel:this._args.authoringModel,cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,transformManager:this._args.transformManager,paneStateManager:this._args.paneStateManager,previewVE:this._args.authoringModel.preview,cardDragHandler:this._args.cardDragHandler,fileUploader:this._args.fileUploader,cardSelectionManager:this._args.cardSelectionManager,cardMode:n.cardMode,parentSuggestedCardModeWatchable:n.parentSuggestedCardModeWatchable,interactiveWatchable:n.interactiveWatchable,cardFactory:this,resourceFactory:this._args.resourceFactory,socket:n.socket,cardDefinition:this._args.cardDefinitionManager.getCardDefinition(o.ManualCardType.TableId)})},r.prototype.createImageSocketArgs=function(e){return{viewModel:e.viewModel,cardParent:e.cardParent,authoringModel:this._args.authoringModel,cardsContainer:this._args.cardsContainer,cardSelectionManager:this._args.cardSelectionManager,cardDeckMenuHost:this._args.cardDeckMenuHost,cardDragHandler:this._args.cardDragHandler,cardFactory:this,resourceFactory:this._args.resourceFactory,paneStateManager:this._args.paneStateManager}},r.prototype.createImageSocketVM=function(e,n){return new t.ImageSocketViewModel(e,n.model,{socket:n.socket,authoringModel:this._args.authoringModel,cardDefinitionManager:this._args.cardDefinitionManager,cardSelectionManager:this._args.cardSelectionManager,paneStateManager:this._args.paneStateManager,resourceFactory:this._args.resourceFactory,transformManager:this._args.transformManager,cardsContainer:this._args.cardsContainer,cardFactory:this})},r.prototype.createVideoImageSocketArgs=function(e){return{viewModel:e.viewModel,cardParent:e.cardParent,authoringModel:this._args.authoringModel,cardsContainer:this._args.cardsContainer,cardSelectionManager:this._args.cardSelectionManager,cardDeckMenuHost:this._args.cardDeckMenuHost,cardDragHandler:this._args.cardDragHandler,cardFactory:this,resourceFactory:this._args.resourceFactory,paneStateManager:this._args.paneStateManager}},r.prototype.createVideoImageSocketVM=function(e,n){return new t.VideoImageSocketViewModel(e,n.model,{socket:n.socket,authoringModel:this._args.authoringModel,cardDefinitionManager:this._args.cardDefinitionManager,cardSelectionManager:this._args.cardSelectionManager,paneStateManager:this._args.paneStateManager,resourceFactory:this._args.resourceFactory,transformManager:this._args.transformManager,cardsContainer:this._args.cardsContainer,cardFactory:this})},r.prototype.createClosedCaptionSocketArgs=function(e){return{viewModel:e.viewModel,cardParent:e.cardParent,authoringModel:this._args.authoringModel,cardsContainer:this._args.cardsContainer,cardSelectionManager:this._args.cardSelectionManager,cardDeckMenuHost:this._args.cardDeckMenuHost,cardDragHandler:this._args.cardDragHandler,cardFactory:this,resourceFactory:this._args.resourceFactory,paneStateManager:this._args.paneStateManager}},r.prototype.createClosedCaptionSocketVM=function(e,n){return new t.ClosedCaptionSocketViewModel(e,n.model,{socket:n.socket,authoringModel:this._args.authoringModel,cardDefinitionManager:this._args.cardDefinitionManager,cardSelectionManager:this._args.cardSelectionManager,paneStateManager:this._args.paneStateManager,resourceFactory:this._args.resourceFactory,transformManager:this._args.transformManager,cardsContainer:this._args.cardsContainer,cardFactory:this})},r.prototype.createClosedCaptionsSocketContainerCardArgs=function(e){return{viewModel:e.viewModel,cardParent:e.cardParent,authoringModel:this._args.authoringModel,cardsContainer:this._args.cardsContainer,cardDeckMenuHost:this._args.cardDeckMenuHost,cardSelectionManager:this._args.cardSelectionManager,cardDragHandler:this._args.cardDragHandler,cardFactory:this,resourceFactory:this._args.resourceFactory,showSocketLabel:e.showSocketLabel,paneStateManager:this._args.paneStateManager}},r.prototype.createAudioThumbnailSocketArgs=function(e){return{viewModel:e.viewModel,cardParent:e.cardParent,authoringModel:this._args.authoringModel,cardsContainer:this._args.cardsContainer,cardSelectionManager:this._args.cardSelectionManager,cardDeckMenuHost:this._args.cardDeckMenuHost,cardDragHandler:this._args.cardDragHandler,cardFactory:this,resourceFactory:this._args.resourceFactory,paneStateManager:this._args.paneStateManager}},r.prototype.createAudioThumbnailSocketVM=function(e,n){return new t.AudioThumbnailSocketViewModel(e,n.model,{socket:n.socket,authoringModel:this._args.authoringModel,cardDefinitionManager:this._args.cardDefinitionManager,cardSelectionManager:this._args.cardSelectionManager,paneStateManager:this._args.paneStateManager,resourceFactory:this._args.resourceFactory,transformManager:this._args.transformManager,cardsContainer:this._args.cardsContainer,cardFactory:this})},r.prototype.createArgs=function(e){if(e.viewModel instanceof t.GroupCardViewModel)return new TDB.ChildArgs(i.GroupCardVE,this.createGroupCardArgs(e));if(e.viewModel instanceof t.SetCardViewModel)return new TDB.ChildArgs(i.SetCardVE,this.createSetCardArgs(e));if(e.viewModel instanceof t.TextCardViewModel)return new TDB.ChildArgs(i.TextCardVE,this.createTextCardArgs(e));if(e.viewModel instanceof t.CodeCardViewModel)return new TDB.ChildArgs(i.CodeCardVE,this.createCodeCardArgs(e));if(e.viewModel instanceof t.EmbedCardViewModel)return new TDB.ChildArgs(i.EmbedCardVE,this.createEmbedCardArgs(e));if(e.viewModel instanceof t.StatusUpdateCardViewModel)return new TDB.ChildArgs(i.StatusUpdateCardVE,this.createStatusUpdateCardArgs(e));if(e.viewModel instanceof t.DocumentCardViewModel)return new TDB.ChildArgs(i.DocumentCardVE,this.createDocumentCardArgs(e));if(e.viewModel instanceof t.ImportingOrEmbeddingDocumentCardViewModel)return new TDB.ChildArgs(i.ImportingOrEmbeddingDocumentCardVE,this.createImportingOrEmbeddingDocumentCardArgs(e));if(e.viewModel instanceof t.ImageCardViewModel)return new TDB.ChildArgs(i.ImageCardVE,this.createImageCardArgs(e));if(e.viewModel instanceof t.VideoCardViewModel)return new TDB.ChildArgs(i.VideoCardVE,this.createVideoCardArgs(e));if(e.viewModel instanceof t.AudioCardViewModel)return new TDB.ChildArgs(i.AudioCardVE,this.createAudioCardArgs(e));if(e.viewModel instanceof t.AgaveCardViewModel)return new TDB.ChildArgs(i.AgaveCardVE,this.createAgaveCardArgs(e));if(e.viewModel instanceof t.ImageSocketViewModel)return new TDB.ChildArgs(i.ImageSocketVE,this.createImageSocketArgs(e));if(e.viewModel instanceof t.VideoImageSocketViewModel)return new TDB.ChildArgs(i.ImageSocketVE,this.createVideoImageSocketArgs(e));if(e.viewModel instanceof t.EmptySocketViewModel)return new TDB.ChildArgs(i.EmptySocketVE,this.createEmptySocketCardArgs(e));if(e.viewModel instanceof t.ClosedCaptionSocketViewModel)return new TDB.ChildArgs(i.ClosedCaptionSocketVE,this.createClosedCaptionSocketArgs(e));if(e.viewModel instanceof t.ClosedCaptionsSocketContainerCardViewModel)return new TDB.ChildArgs(i.ClosedCaptionsSocketContainerCardVE,this.createClosedCaptionsSocketContainerCardArgs(e));if(e.viewModel instanceof t.AudioThumbnailSocketViewModel)return new TDB.ChildArgs(i.AudioThumbnailSocketVE,this.createAudioThumbnailSocketArgs(e));if(e.viewModel instanceof t.TableCardViewModel)return new TDB.ChildArgs(i.TableCardVE,this.createTableCardArgs(e));throw StoryApp.RethrowLogger.createError("Unknown card type.")},r.prototype.createViewModel=function(e,t){var i=t.model;if(i instanceof n.TitleComposite)return this.createComplexHeadingCardVM(e,t);if(i instanceof n.SpecifiedGroup)return this.createGroupCardVM(e,t);if(i instanceof n.Set)return this.createSetCardVM(e,t);if(i instanceof n.TextGroup||i instanceof n.Paragraph)return this.createTextCardVM(e,t);if(i instanceof n.EmbeddedContent)return this.createEmbedCardVM(e,t);if(i instanceof n.StatusUpdateContent)return this.createStatusUpdateCardVM(e,t);if(i instanceof n.DocumentContent)return this.createDocumentCardVM(e,t);if(i instanceof n.ImportingOrEmbeddingDocumentContent)return this.createImportingOrEmbeddingDocumentCardVM(e,t);if(i instanceof n.MediaWithTextComposite){if(o.ObjectController.modelIsImage(i))return this.createImageCardVM(e,t);if(o.ObjectController.modelIsVideo(i))return this.createVideoCardVM(e,t);if(o.ObjectController.modelIsAudio(i))return this.createAudioCardVM(e,t)}if(i instanceof n.AgaveContent)return this.createAgaveCardVM(e,t);if(i instanceof n.ImageContent)return this.createImageSocketVM(e,t);if(i instanceof n.VideoContent)return this.createVideoImageSocketVM(e,t);if(i instanceof n.ClosedCaptionComposite)return this.createClosedCaptionSocketVM(e,t);if(i instanceof n.AudioContent)return this.createAudioThumbnailSocketVM(e,t);if(i instanceof n.CodeBlock)return this.createCodeCardVM(e,t);if(i instanceof n.Table)return this.createTableCardVM(e,t);throw StoryApp.RethrowLogger.createError("Unknown view model type.")},r.prototype.createPlaceholderCardArgs=function(e){return{viewModel:e.viewModel,cardParent:e.cardParent,authoringModel:this._args.authoringModel,cardsContainer:this._args.cardsContainer,cardDeckMenuHost:this._args.cardDeckMenuHost,cardDragHandler:this._args.cardDragHandler,attributes:e.attributes,paneStateManager:this._args.paneStateManager,resourceFactory:this._args.resourceFactory}},r.prototype.createPlaceholderCardVM=function(e,n){return new t.PlaceholderCardViewModel(e,void 0,{parent:n.cardParent,cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,cardSelectionManager:this._args.cardSelectionManager,authoringModel:this._args.authoringModel,paneStateManager:this._args.paneStateManager,resourceFactory:this._args.resourceFactory,transformManager:this._args.transformManager,context:n.context,acceptBlueprints:n.acceptBlueprints,addModelObjects:n.addModelObjects,cardFactory:this})},r.prototype.createComplexHeadingCard=function(e,t){var n={viewModel:t.viewModel,cardParent:t.cardParent,authoringModel:this._args.authoringModel,cardsContainer:this._args.cardsContainer,cardDeckMenuHost:this._args.cardDeckMenuHost,cardDragHandler:this._args.cardDragHandler,paneStateManager:this._args.paneStateManager,cardFactory:this,resourceFactory:this._args.resourceFactory,showSocketLabel:t.showSocketLabel,cardLabelText:t.viewModel.getCardLabelText()};return new i.ComplexHeadingCardVE(e,n)},r.prototype.createComplexHeadingCardVM=function(e,n){var i=o.currentHeaderController().get(this._args.authoringModel.getPageId()).getHeadingType(n.model);return new t.ComplexHeadingCardViewModel(e,n.model,{cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,cardFactory:this,cardSelectionManager:this._args.cardSelectionManager,fileUploader:this._args.fileUploader,cardMode:n.cardMode,parentSuggestedCardModeWatchable:n.parentSuggestedCardModeWatchable,interactiveWatchable:n.interactiveWatchable,authoringModel:this._args.authoringModel,paneStateManager:this._args.paneStateManager,resourceFactory:this._args.resourceFactory,transformManager:this._args.transformManager,socket:n.socket,cardDefinition:this._args.cardDefinitionManager.getCardDefinition(i)})},r.prototype.createTextCard=function(e,t){return new i.TextCardVE(e,this.createTextCardArgs(t))},r.prototype.createEmptySocketCardArgs=function(e){return{authoringModel:this._args.authoringModel,cardDeckMenuHost:this._args.cardDeckMenuHost,cardDragHandler:this._args.cardDragHandler,cardParent:e.cardParent,cardsContainer:this._args.cardsContainer,viewModel:e.viewModel,resourceFactory:this._args.resourceFactory,showSocketLabel:e.showSocketLabel}},r.prototype.createEmptySocketCardVM=function(e,n){return new t.EmptySocketViewModel(e,{cardDefinitionManager:this._args.cardDefinitionManager,authoringModel:this._args.authoringModel,cardSelectionManager:this._args.cardSelectionManager,resourceFactory:this._args.resourceFactory,transformManager:this._args.transformManager,paneStateManager:this._args.paneStateManager,cardsContainer:this._args.cardsContainer,cardFactory:this,socket:n})},r.prototype.createTextCardVMWithNoModel=function(e,n){return new t.TextCardViewModel(e,void 0,{cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,transformManager:this._args.transformManager,paneStateManager:this._args.paneStateManager,fileUploader:this._args.fileUploader,cardSelectionManager:this._args.cardSelectionManager,authoringModel:this._args.authoringModel,cardDragHandler:this._args.cardDragHandler,cardFactory:this,resourceFactory:this._args.resourceFactory,socket:n,cardDefinition:this._args.cardDefinitionManager.getCardDefinition(o.ManualCardType.TextId)})},r.prototype.createClosedCaptionSocketContainerCardVMWithoutModel=function(e,n){return new t.ClosedCaptionsSocketContainerCardViewModel(e,void 0,{cardDefinitionManager:this._args.cardDefinitionManager,cardFactory:this,authoringModel:this._args.authoringModel,cardSelectionManager:this._args.cardSelectionManager,fileUploader:this._args.fileUploader,cardsContainer:this._args.cardsContainer,cardDragHandler:this._args.cardDragHandler,cardMode:t.CardMode.Expanded,paneStateManager:this._args.paneStateManager,resourceFactory:this._args.resourceFactory,transformManager:this._args.transformManager,socket:n,cardDefinition:this._args.cardDefinitionManager.getCardDefinition(o.ManualCardType.GroupId)})},r.prototype.createViewModelWithoutModel=function(e,t){var n=t.getDefinition().getDefaultDataType();if(n===o.CompositeType.Paragraph||n===o.CompositeType.TextGroup)return this.createTextCardVMWithNoModel(e,t);if(n===o.CompositeType.ClosedCaption)return this.createClosedCaptionSocketContainerCardVMWithoutModel(e,t);throw StoryApp.RethrowLogger.createError("Unknown card data type.")},r}(Disposable);t.CardFactory=r}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=e.View.ViewElements,i=function(e){function i(n,o,i){var r=this;return i.cardMode=t.CardMode.Expanded,r=e.call(this,n,o,i)||this,r._childCardModeWatcher=TDB.watcherTag(596473732,r,r,r.calculateChildCardMode),r._uncollapsedCount=TDB.watcherTag(596473733,r,r,r.calculateUncollapsedCount),r.bottomTweenerActive=TDB.watchableTag(596460104,r,!1),r.createViewModelChildren(),r}return __extends(i,e),i.prototype.createViewModelChildren=function(){this.viewModelChildren=TDB.mappedWatcherOwnerTag(596473734,this,this,this.getChildrenForViewModels,this.viewModelConstructor)},i.prototype.getChildrenForViewModels=function(e){return this.getChildren(e)},i.prototype.viewModelConstructor=function(e){return this._args.cardFactory.createViewModel(null,{model:e,parentSuggestedCardModeWatchable:this._childCardModeWatcher,parentCollapsed:{compute:new TDB.ComputedOptionArgs(this,this.isCollapsed)}})},i.prototype.calculateChildCardMode=function(e){switch(this.calculateCardMode(e)){case t.CardMode.Collapsed:case t.CardMode.Teaser:return t.CardMode.Teaser;default:return t.CardMode.Collapsed}},i.prototype.calculateUncollapsedCount=function(e){var t=this.getContentCards(e),n=0;if(this.isCollapsed(e))return 0;for(var i=0;i<t.length;i++){var r=t[i];if(r instanceof o.ContainerCardVE){var a=r.getViewModel().getUncollapsedCount(e);a>n&&(n=a)}}return++n},i.prototype.getUncollapsedCount=function(e){return this._uncollapsedCount.getWatchedValue(e)},i.prototype.isContainerEmpty=function(e){return 0===this.getContentCards(e).length},i.prototype.canTakeAction=function(n,o){return!(n!=t.CardAction.Remove||!t.DeleteAction.isAvailable([this.card.model],this.pageId))||e.prototype.canTakeAction.call(this,n,o)},i.prototype.overlayAcceptDraggable=function(e){return!!this.isCollapsed()&&o.AddAction.isAvailable(o.AuthoringHelperMethods.convertViewElementsToCards(e,this.pageId),{parent:this.card.model},this.pageId)},i.prototype.addViewElements=function(e){var t=o.AuthoringHelperMethods.moveElementsToLocation(e,this.card.model,this.getContentCards().length,this.pageId,"Added to a container card");this._args.cardsContainer.scrollToModelsAndSetFocus(t,!0)},i.prototype.getCardForModelId=function(e){var t;if(n.StoryController.isModelObjectValid(this.card.model)&&this.card.model.id===e)return this._cardVE;for(var o=this.getContentCards(),i=0;i<o.length;i++)if(t=o[i].getViewModel().getCardForModelId(e))return t;return null},i.prototype.getFocusedAuthors=function(t){var n=e.prototype.getFocusedAuthors.call(this,t);if(this.isCollapsed(t))for(var o=this._cardVE.getChildCards(t),i=0;i<o.length;i++)n=n.concat(o[i].getViewModel().getFocusedAuthors(t));return n},i.prototype.isDescendantSelected=function(){for(var e=this.getContentCards(),t=e.length,n=0;n<t;n++){var o=e[n];if(this._cardVE.cardSelectionManager.isSelected(o)||o.getViewModel().isDescendantSelected())return!0}return!1},i.prototype.isSelectionOverlayVisible=function(e){return this._args.cardSelectionManager.isInMultiselectMode(e)&&this.isCollapsed(e)},i.prototype.getBottomTweenerArgs=function(e){return{model:this.card.model,context:this,authoringModel:this._args.authoringModel,fileUploader:this._args.fileUploader,cardsContainer:this._args.cardsContainer,cardSelectionManager:this._args.cardSelectionManager,cardDragHandler:this._args.cardDragHandler,cssClass:e,visible:{compute:new TDB.ComputedOptionArgs(this,this.calculateBottomTweenerVisibility)},activeDropTarget:this.bottomTweenerActive}},i.prototype.getContentCards=function(e){return this._cardVE.getContentCards(e)},i.prototype.calculateBottomTweenerVisibility=function(e){return!0},i.prototype.canAddAnyContent=function(e){return!0},i.BackgroundOpacityLevel=.08,i}(t.CardViewModel);t.ContainerCardViewModel=i}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=function(e){function o(t,o,i){var r=e.call(this,t,o,i)||this;return r._controller=n.currentImageController().get(r.pageId),r}return __extends(o,e),o.prototype.uploadErrorMessage=function(e){switch(e){case t.MediaCardErrorMessage.TimeOut:return Resources.UploadErrorTimeout;case t.MediaCardErrorMessage.CorruptedFile:return Resources.ImageUploadFileCorruptedOrProtectedError;case t.MediaCardErrorMessage.MaximumSwaySizeExceeded:return Resources.ImageUploadExceedsSwayLengthMessage;case t.MediaCardErrorMessage.FormatDisabled:return Resources.ImageUploadFormatDisabled;case t.MediaCardErrorMessage.UnsupportedFormat:return Resources.ImageUploadFileTypeError;case t.MediaCardErrorMessage.Generic:case t.MediaCardErrorMessage.InternalProcessingError:case t.MediaCardErrorMessage.FeatureDisabled:default:return Resources.ImageUploadFriendlyGenericError}},o.prototype.isTextVisible=function(e){return!(!this.card.model||!this.getMedia())&&this.getUploadStatus(e)!=n.UploadStatus.Uploading},o.prototype.canTakeAction=function(o,i){if(o==t.CardAction.Focus){if(!this.isCollapsed(i)||!this.card.model||!n.ImageController.isImageSizeKnown(this.getMedia(),i))return!1;if(this.card.model){var r=this.getMedia(i);return null!=r&&!n.MediaController.isMediaEmpty(r,i)}return!1}return e.prototype.canTakeAction.call(this,o,i)},o.prototype.getOverlayIcon=function(e){if(this._cardVE.cardParent.isHeading&&!this._cardVE.cardParent.isRootHeading()){var t={fontIconName:{value:FontIcons.CardHeaderIcon},fontIconSizeClass:FontIcons.CardHeaderIconSize,fontIconWrapperClass:{value:"HeadingCardHeaderIcon"},fontIconBackgroundColorClass:"ThumbnailFontIconBackgroundColor"};return new TDB.ChildArgs(VE.FontIconVE,t)}},o.prototype.getLabelText=function(e){var t=this.getFilename(e);if(t&&0!=t.length)return ResourceManager.ResolveString(Resources.CardLabelSpacing,[Resources.PictureCardStorylineDescription,t]);if(n.StoryController.isModelObjectValid(this.card.model)){var o=this.card.model.getMedia(e);if(o){var i=o.getTitle(e);if(i&&0!=i.length)return ResourceManager.ResolveString(Resources.CardLabelSpacing,[Resources.PictureCardStorylineDescription,i])}}return Resources.PictureCardStorylineDescription},o.prototype.isErrorMessageVisible=function(t){return!!e.prototype.isErrorMessageVisible.call(this,t)||!!this.inSocket()&&this.socket.hasUnsupportedSockets(t)},o.prototype.getErrorText=function(t){var n=e.prototype.getErrorText.call(this,t);return 0!==n.length?n:this.inSocket()?this.socket.unsupportedSocketMessage():""},o.prototype.supportsCaption=function(){return!this.getSocketDefinition()||this.getSocketDefinition().isCaptionSupported()},o.prototype.supportsAltText=function(e){if(this.card.model){var t=this.getMedia(e);return t&&!n.MediaController.isMediaEmpty(t,e)}return!1},o.prototype.showingSocketError=function(e){return this.isErrorMessageVisible(e)&&this.inSocket()&&this.getErrorText(e)===this.socket.unsupportedSocketMessage()},o.prototype.getSocketDefinition=function(){return this.socket?this.socket.getDefinition():void 0},o}(t.MediaCardViewModel);t.ImageCardViewModel=o}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=e.View.ViewElements,i=function(e){function t(t,n,o){var i=e.call(this,t,n,o)||this;return i._args=o,i}return __extends(t,e),t.prototype.getFocusedModel=function(){return this._args.parent.getViewModel().getModel()},t.prototype.getParentModel=function(e){return this._args.parent.getViewModel().getModel()},t.prototype.canBeSelected=function(e){return!1},t.prototype.onCardAction=function(e){return this.isInteractive()?this._cardVE.onAction(e):TDB.EventPropagation.Bubble},t.prototype.selectCard=function(){return this._cardVE.cardParent.getViewModel().selectCard()},t.prototype.acceptDraggable=function(t){if(!e.prototype.acceptDraggable.call(this,t))return!1;var n=o.AuthoringHelperMethods.convertViewElementsToCards(t,this.pageId);return this.acceptBlueprints(n)},t.prototype.addModelObjects=function(e){return this.acceptBlueprints(e)&&this.attemptAddModelObjects(e)},t.prototype.addObjectsFromViewElements=function(e){var t=o.AuthoringHelperMethods.convertViewElementsToCards(e,this.pageId,!0);this.attemptAddModelObjects(t)},t.prototype.acceptBlueprints=function(e){return!(!this._args.context||!this._args.acceptBlueprints)&&this._args.acceptBlueprints.call(this._args.context,e)},t.prototype.attemptAddModelObjects=function(e){var t=[];if(e.forEach(function(e){t.push(e.model)}),this._args.context&&this._args.addModelObjects){this._args.addModelObjects.call(this._args.context,e);for(var i=n.currentStoryController().get(this.pageId).getLoggableContentTypes(t,this._args.cardDefinitionManager),r=this._cardVE.parent instanceof o.CardVE?o.CardType[this._cardVE.parent.cardType]:"something that's not a card",a=0;a<i.length;a++)ActionLogger.RecordClientAction(new ClientAction.StorylinePlaceholderFilled("User filled a placeholder",i[a],r));return!0}return!1},t.prototype.shouldShowJackIcon=function(){return!1},t}(t.CardViewModel);t.PlaceholderCardViewModel=i}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=e.View.ViewElements,r=function(e){function r(n,i,r){var a=this;return r.cardMode=t.CardMode.Collapsed,a=e.call(this,n,i,r)||this,a.card=new o.SetCard({model:i,definition:r.cardDefinition}),a._childrenInteractive=TDB.watcherTag(596473675,a,a,a.calcChildrenInteractive),a.isInsertingAtTop=!1,a}return __extends(r,e),r.prototype.setInsertingAtTop=function(e){this.isInsertingAtTop=e},r.prototype.getInsertingAtTop=function(){return this.isInsertingAtTop},r.prototype.getModel=function(){return this.card.model},r.prototype.getChildren=function(e){return o.StoryController.isModelObjectValid(this.card.model)?this.card.model.content.getCollection(e):[]},r.prototype.isParentCollapsed=function(e){return TDB.getOptionValue(this._args.parentCollapsed,e)},r.prototype.getChildrenForViewModels=function(e){return this.isParentCollapsed(e)?[]:this.getChildren(e)},r.prototype.getEmphasis=function(e){return this.card.model.getEmphasis(e)},r.prototype.setEmphasis=function(e){var t=this;TDB.applyUpdate(function(){t.card.model.setEmphasis(e)})},r.prototype.getStorylineDescription=function(e){var t=o.SetController.getLabel(this.card.model,e);return t?(t=this.applyCardDeckSetLabelEffect(t),ResourceManager.ResolveString(Resources.CardDeckContainerTemplateLabel,[t,this.getChildren().length])):t},r.prototype.createCardArgs=function(e){for(var t=this.viewModelChildren.getWatchedValue(e),n=[],o=t.length,i=0;i<o;i++){var r=this._args.cardFactory.createArgs({cardParent:this._cardVE,viewModel:t[i]});n.push(r)}return n},r.prototype.getVisualization=function(e){return this.getModel().getVisualization(e)},r.prototype.isPlaceholderVisible=function(e){if(this.card.model.getVisualization(e)==n.Visualization.Comparison){var t=this.getContentCards(e).length;return!(t>=2)&&(this.isExpanded(e)||0===t)}return this.isContainerEmpty(e)},r.prototype.isSecondPlaceholderVisible=function(e){return this.card.model.getVisualization(e)==n.Visualization.Comparison&&(!(this.getContentCards(e).length>=1)&&this.isExpanded(e))},r.prototype.getPlaceholder1CardViewModel=function(){return this.placeholder1ViewModel||(this.placeholder1ViewModel=this._args.cardFactory.createPlaceholderCardVM(this,{context:this,acceptBlueprints:this.canInsertBlueprints,addModelObjects:this.addModelObjects,cardParent:this._cardVE})),this.placeholder1ViewModel},r.prototype.getPlaceholder2CardViewModel=function(){return this.placeholder2ViewModel||(this.placeholder2ViewModel=this._args.cardFactory.createPlaceholderCardVM(this,{context:this,acceptBlueprints:this.canInsertBlueprints,addModelObjects:this.addModelObjects,cardParent:this._cardVE})),this.placeholder2ViewModel},r.prototype.addModelObjects=function(e){i.AddAction.execute(e,{parent:this.card.model,index:this.card.model.content.getCollection().length},this.pageId,"Added to a set card")},r.prototype.getLabel=function(e){var t=o.SetController.getLabel(this.card.model,e);if(t&&!this.inTeaserMode(e)&&(t=this.applyCardDeckSetLabelEffect(t)),this.isCollapsed(e)||this.inTeaserMode(e)){var n=this.card.model.content.getCollection(e).length;t=ResourceManager.ResolveString(Resources.CardDeckSetHeaderLabel,[t,n])}return t},r.prototype.applyCardDeckSetLabelEffect=function(e){return e==Resources.TransformGroup?ResourceManager.ResolveString(Resources.CardDeckSetLabel,[Resources.TransformAuto]):ResourceManager.ResolveString(Resources.CardDeckSetLabel,[e])},r.prototype.getFontIcon=function(e){this.card.model.getVisualization(e);var t=o.ObjectController.getCardDefinitionForModelObject(this.card.model,this.pageId);return t?t.fontIconName:""},r.prototype.onlySupportsImages=function(e){return o.SetController.doesSetOnlyAllowImages(this.card.model,e)},r.prototype.canInsertBlueprints=function(e){return i.AddAction.isAvailable(e,{parent:this.card.model},this.pageId)},r.prototype.canTakeAction=function(n,o){switch(n){case t.CardAction.Explode:case t.CardAction.Remove:return!0;default:return e.prototype.canTakeAction.call(this,n,o)}},r.prototype.getTopTweenerArgs=function(){return{parentModel:this.card.model,grandparent:this._cardVE,clickable:!1,visible:{compute:new TDB.ComputedOptionArgs(this,this.topTweenerVisible)},authoringModel:this._args.authoringModel,fileUploader:this._args.fileUploader,cardsContainer:this._args.cardsContainer,cardSelectionManager:this._args.cardSelectionManager,cardDragHandler:this._args.cardDragHandler,context:this,beforeFileDrop:this.beforeTopTweenerFileDrop}},r.prototype.beforeTopTweenerFileDrop=function(){this.setInsertingAtTop(!0)},r.prototype.childAcceptDraggables=function(e){return i.AddAction.isAvailable(i.AuthoringHelperMethods.convertViewElementsToCards(e,this.pageId),{parent:this.card.model},this.pageId)},r.prototype.dragHandlesVisible=function(t){var n=e.prototype.dragHandlesVisible.call(this,t),o=this.isCollapsed(t),i=this._cardVE.cardSelectionManager.isSelected(this._cardVE,t);return n&&(o||i)},r.prototype.isCheckMarkVisible=function(t){var n=e.prototype.isCheckMarkVisible.call(this,t),o=this._uncollapsedCount.getWatchedValue(t);return n&&o<=2},r.prototype.isSidebarVisible=function(e){var t=this.isCollapsed(e),n=this._args.cardSelectionManager.isSelected(this._cardVE,e);return t||n},r.prototype.calculateBottomTweenerVisibility=function(e){return!(this.getUncollapsedCount(e)>1&&this._cardVE.parent instanceof i.SetCardVE)},r.prototype.topTweenerVisible=function(e){return!this.isCollapsed(e)},r.prototype.calcChildrenInteractive=function(e){return!this.isCollapsed(e)&&this.isInteractive(e)},r.prototype.canAddAnyContent=function(e){return!(this.getVisualization(e)===n.Visualization.Comparison&&this.getContentCards(e).length>=2)},r}(t.ContainerCardViewModel);t.SetCardViewModel=r}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=function(t){function i(e,n,i){var r=t.call(this,e,n,i)||this;return r.card=new o.StatusUpdateCard({model:n,definition:i.cardDefinition}),r}return __extends(i,t),i.prototype.getModel=function(){return this.card.model},i.prototype.addModelObject=function(e){e instanceof n.StatusUpdateContent&&(this.card.model?this.card.model!=e&&o.currentStatusUpdateController().get(this.pageId).update(e,this.card.model):this.card.model=e)},i.prototype.getEmphasis=function(e){return this.card.model.getEmphasis(e)},i.prototype.setEmphasis=function(e){var t=this;TDB.applyUpdate(function(){t.card.model.setEmphasis(e)})},i.prototype.measureTweetIfFirstTime=function(){0===this.card.model.getSizes().getLength()&&this.measureTweet()},i.prototype.isAuthorImageVisible=function(e){return!o.StatusUpdateController.isEmptyStatusUpdate(this.card.model,e)},i.prototype.isIgnorableMessage=function(e,t,n){return-1===e||isNaN(t)||0===t||-1!==ArrayExtensions.indexOfFirst(n,function(t){return t.width===i.widths[e]})},i.prototype.measureTweet=function(){var e=this,t=this.card.model.getSourceId();if(t){var n=[],o=platform.now();StoryLog.TraceTag(596473673,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Measuring tweet "+t);var r,a=$("<div></div>").attr("aria-hidden","true").addClass("offscreen").css({width:1e3,height:0}).appendTo($("body")),s=function(l){var c=l.source,d=parseInt(l.data),u=ArrayExtensions.indexOfFirst(r,function(e){return e.contentWindow===c});e.isIgnorableMessage(u,d,n)||(n.push(new Size(i.widths[u],d)),n.length===i.widths.length&&e.cleanUpMeasurement(t,a,o,s,n))};addEventListener("message",s,!1);var l=CommonSettings.NoCdnContentBaseUrl+"TwitterFrame.html#"+t;r=i.widths.map(function(e){return $("<iframe />").attr({frameborder:"0",scrolling:"no",src:l}).css("width",e).appendTo(a)[0]})}},i.prototype.cleanUpMeasurement=function(t,n,o,i,r){var a=this;StoryLog.StructuredTraceTag(596473674,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Measured tweet "+t,{timeToMeasureMs:(platform.now()-o).toFixed(0).toString()}),n.remove(),removeEventListener("message",i,!1),e.Model.currentUndoManager().get(this.pageId).captureIgnorableUpdate(function(){a.hasSizesInStorageModel()||(t===a.card.model.getSourceId()?a.addSizesOverMinHeightToStorageModel(r):a.measureTweet())},this.card.model.id)},i.prototype.hasSizesInStorageModel=function(){return this.card.model.getSizes().getLength()>0},i.prototype.addSizesOverMinHeightToStorageModel=function(e){for(var t=0,n=e.length;t<n;++t){var o=e[t];o.height>=i.minHeight&&this.addSizeToStorageModel(o)}},i.prototype.addSizeToStorageModel=function(e){var t=new n.Size;t.setWidth(e.width),t.setHeight(e.height),this.card.model.getSizes().add(t)},i.prototype.getAuthorText=function(e){var t=this.card.model.getAuthor(e);return t||""},i.prototype.getBodyText=function(e){var t=this.card.model.getBodyText(e);return t?t.getText(e):""},i.prototype.getImageUrl=function(e){var t=this.card.model.getBodyImage(e);return t?t.getSourceUrl(e):""},i.prototype.getOverlayIcon=function(e){var t={fontIconName:{value:FontIcons.TwitterIcon},fontIconSizeClass:FontIcons.TwitterIconSize,fontIconWrapperClass:{value:"OverlayIconText"},fontIconBackgroundColorClass:"ThumbnailFontIconBackgroundColor"};return new TDB.ChildArgs(VE.FontIconVE,t)},i.prototype.isExistingBodyImage=function(e,t){var n=e.getBodyImage();return 0!==(n?o.ImageController.calculateImageContentPartSourceUrl(n):"").length},i.widths=[228,308,408,508],i.minHeight=50,i}(t.ContentCardViewModel);t.StatusUpdateCardViewModel=i}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=e.View.ViewElements,r=function(r){function a(e,t,n){var i=r.call(this,e,t,n)||this;return i.card=new o.TextCard({model:t,definition:n.cardDefinition}),i.isIntersectionObserverLoaded=TDB.watchableTag(595985043,i,!1),i}return __extends(a,r),a.prototype.intersectionObserverLoaded=function(){var e=this;TDB.applyUpdate(function(){e.isIntersectionObserverLoaded.setValue(!0)},TDB.Justification.SyncResponse)},a.prototype.shouldTrackPosition=function(e){return this._args.authoringModel.getStorylineMode(e)===i.StorylineMode.Full&&this.isPullQuote(e)&&this.isIntersectionObserverLoaded.getWatchedValue(e)},a.isPullQuote=function(e,t){if(e&&e instanceof n.TextGroup&&e.children){var o=e.children.getCollection(t);if(o)for(var i=0,r=o;i<r.length;i++){var a=r[i];if(a instanceof n.Paragraph&&a.getProviderType()===n.ContentProvider.PullQuoteEnhancement)return!0}}return!1},a.prototype.isPullQuote=function(e){return a.isPullQuote(this.card.model,e)},a.prototype.createTextControl=function(e,t){var o,i=this.inSocket()?this._args.socket.getDefinition().getTextPlaceholderText():Resources.CardDeckTextCardPlaceholder;return this.card.model instanceof n.TextGroup?o=this.createCommonTextVEWithTextGroup(e,t,i):this.card.model instanceof n.Paragraph?o=this.createCommonTextVEWithTextUnitEditor(i):!this.card.model&&this.inSocket()&&this.socket.getDefinition().getHasDefaultContent()&&(o=this.createCommonTextVEWithoutModel(i)),o},a.prototype.createCommonTextVEWithTextGroup=function(e,n,r){var a={dragHandler:this._cardVE.cardDragHandler,context:this._cardVE,acceptDraggables:this._cardVE.acceptDraggables,activeCss:e,fileUploader:this._args.fileUploader,cardsContainer:this._args.cardsContainer},s=this.generateTextAbilities(),l=new t.CommonTextViewModel({card:this,pageId:this.pageId,textModel:this.card.model,cardSelectionManager:this._args.cardSelectionManager,textAggregator:this._cardVE.getTextAggregator(),fileUploader:this._args.fileUploader,cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,onCanvas:this._cardVE.cardParent.isPopup,abilities:s});s||(l.abilities.header=o.currentHeaderController().get(this.pageId).canTransform([this.card.model]));var c=this.inSocket()?this.socket.getDefinition().getTelemetryId():ClientAction.ButtonId.Text_TextField,d=this.inSocket()?this.socket.getParentCardType():"",u={viewModel:l,focusedAuthors:this._focusedAuthors,css:n,placeholder:r,dropManagerArgs:a,telemetryId:c,socketParentCardType:d,resourceFactory:this._args.resourceFactory};return new TDB.ChildArgs(i.TextGroupVE,u)},a.prototype.createCommonTextVEWithTextUnitEditor=function(e){var r="textMedium",a=o.currentStoryController().get(this.pageId).findParent(this.card.model);if(a instanceof n.SpecifiedGroup&&!this.inSocket()){var s=a.getHeading();s&&s.getTitle()===this.card.model&&(o.ObjectController.modelIsSwayTitle(s,this.pageId)?r="RootHeadingTitleCard":o.ObjectController.modelIsSectionTitle(s,this.pageId)&&(r="GroupHeadingTitleCard"))}else if(this.inSocket())switch(this._args.socket.getDefinition().getTextStyle()){case o.TextStyle.Heading:r="GroupHeadingTitleCard";break;case o.TextStyle.Title:r="RootHeadingTitleCard"}var l=this.inSocket()?this.socket.getDefinition().getTelemetryId():this.card.definition.textButtonId,c=this.inSocket()?this.socket.getParentCardType():"",d={viewModel:new t.TextUnitEditorViewModel({card:this,pageId:this.pageId,textModel:this.card.model,cardSelectionManager:this._args.cardSelectionManager,textAggregator:this._cardVE.getTextAggregator(),fileUploader:this._args.fileUploader,cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,onCanvas:this._cardVE.cardParent.isPopup,getTextFieldDisabled:this.getTextFieldDisabled,textHandlerContext:this,abilities:this.generateTextAbilities()}),placeholder:e,css:"calibriRegular TextGroupVE "+r,telemetryId:l,socketParentCardType:c,resourceFactory:this._args.resourceFactory};return new TDB.ChildArgs(i.TextUnitEditorVE,d)},a.prototype.createCommonTextVEWithoutModel=function(e){var n,r="textMedium";if(this.inSocket())switch(this._args.socket.getDefinition().getTextStyle()){case o.TextStyle.Heading:r="GroupHeadingTitleCard";break;case o.TextStyle.Title:r="RootHeadingTitleCard"}n=this.inSocket()?this.socket.getDefinition().getTelemetryId():this.card.definition.textButtonId;var a=this.inSocket()?this.socket.getParentCardType():"",s={viewModel:new t.TextUnitEditorViewModel({card:this,pageId:this.pageId,textModel:void 0,cardSelectionManager:this._args.cardSelectionManager,textAggregator:this._cardVE.getTextAggregator(),fileUploader:this._args.fileUploader,cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,onCanvas:this._cardVE.cardParent.isPopup,getTextModel:this.getAltTextModel,getTextContent:this.getAltText,getTextFieldDisabled:this.getTextFieldDisabled,setTextContent:this.setAltText,textHandlerContext:this,abilities:this.generateTextAbilities()}),placeholder:e,css:"calibriRegular TextGroupVE "+r,telemetryId:n,socketParentCardType:a,resourceFactory:this._args.resourceFactory};return new TDB.ChildArgs(i.TextUnitEditorVE,s)},a.prototype.getAltTextModel=function(e){var t=this.getModel();return o.MediaController.getAltTextModel(t,e)},a.prototype.getAltText=function(e){var t=this.socket.getParentModelObject();return o.MediaController.getAltText(t,e)},a.prototype.setAltText=function(e){var t=this.getModel();t?o.MediaController.setAltText(t,e,this.pageId):this.socket.createDefaultModel(e.getText())},a.prototype.canTakeAction=function(e,n){return e==t.CardAction.Decorative&&StoryPageEditSettings.SocketifiedVideoCardEnabled?!!this.inSocket()&&this.socket.getDefinition().getAuthoringCapabilities().mediaDecorative:(e!=t.CardAction.Remove||!this.inSocket()||!this.socket.getDefinition().getHasDefaultContent())&&!!r.prototype.canTakeAction.call(this,e,n)},a.prototype.getDecorative=function(e){if(this.inSocket()){var t=this.socket.getParentModelObject();return!(!o.ObjectController.modelIsImage(t)&&!o.ObjectController.modelIsVideo(t))&&o.MediaController.getDecorativeModelProperty(t,e)}return!1},a.prototype.setDecorative=function(e){if(this.inSocket()){var t=this.socket.getParentModelObject();o.MediaController.setDecorativeModelProperty(t,e,this.pageId)}},a.prototype.getTextFieldDisabled=function(e){return!this.getDecorative(e)},a.prototype.getEmphasis=function(e){return this.card.model.getEmphasis(e)},a.prototype.setEmphasis=function(e){var t=this;TDB.applyUpdate(function(){t.card.model.setEmphasis(e)})},a.prototype.inPlaceholderMode=function(e){return this.card.model instanceof n.TextGroup&&o.TextController.isEmpty(this.card.model)},a.prototype.dragHandlesVisible=function(e){return!0},a.prototype.hintText=function(e){var t=this.getHint(e);return t?t.getContent().getText():""},a.prototype.clearHint=function(){var t=this;this.card.model.getAuthoringHint()&&e.Model.currentUndoManager().get(this.pageId).captureUserUpdate(function(){t.card.model.setAuthoringHint(null)},"User dismissed a hint")},a.prototype.getHint=function(e){if(this.card.model)return this.card.model.getAuthoringHint(e)},a.prototype.isFirst=function(){if(!this.card.model)return!1;var e=this.card.model.storyModel.traversalModel.getSpecifiedGrouping().getRootGroup().children.getCollection();if(e&&e.length>0){var t=e.first().children.getCollection();if(t&&t.length>0){var n=t.first();return this.card.model.id===n.id}}return!1},a}(t.ContentCardViewModel);t.TextCardViewModel=r}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=function(e){function i(t,n,i){var r=e.call(this,t,n,i)||this;return r._controller=o.currentVideoController().get(r.pageId),r}return __extends(i,e),i.prototype.mediaCardImageOverlaySupported=function(){return!0},i.prototype.uploadErrorMessage=function(e){switch(e){case t.MediaCardErrorMessage.TimeOut:return Resources.UploadErrorTimeout;case t.MediaCardErrorMessage.CorruptedFile:return Resources.VideoUploadFileCorruptedError;case t.MediaCardErrorMessage.MaximumSwaySizeExceeded:return Resources.VideoUploadExceedsSwayLengthMessage;case t.MediaCardErrorMessage.FormatDisabled:return Resources.VideoUploadFormatDisabled;case t.MediaCardErrorMessage.UnsupportedFormat:return Resources.VideoUploadUnsupportedCodecErrorMessage;case t.MediaCardErrorMessage.FeatureDisabled:return Resources.VideoUploadDisabled;case t.MediaCardErrorMessage.Generic:case t.MediaCardErrorMessage.InternalProcessingError:default:return Resources.VideoUploadGenericErrorMessage}},i.prototype.preprocessingErrorMessage=function(e){switch(e){case t.MediaCardErrorMessage.TimeOut:return Resources.UploadErrorTimeout;case t.MediaCardErrorMessage.CorruptedFile:return Resources.VideoUploadFileCorruptedError;case t.MediaCardErrorMessage.MaximumSwaySizeExceeded:return Resources.VideoUploadExceedsSwayLengthMessage;case t.MediaCardErrorMessage.FormatDisabled:return Resources.VideoUploadFormatDisabled;case t.MediaCardErrorMessage.UnsupportedFormat:return Resources.VideoUploadUnsupportedCodecErrorMessage;case t.MediaCardErrorMessage.FeatureDisabled:return Resources.VideoUploadDisabled;case t.MediaCardErrorMessage.Generic:case t.MediaCardErrorMessage.InternalProcessingError:default:return Resources.VideoUploadGenericErrorMessage}},i.prototype.uploadingMessage=function(){var t=e.prototype.getModel.call(this).getMedia().getDecompInfo();return null!==t&&t.getProvider()===n.ContentProvider.OneDrivePro?this.waitingPreprocessingMessage():StoryPageEditSettings.MediaProcessProgressEnabled?Resources.UploadingMediaMessage:Resources.UploadingVideoMessage},i.prototype.transferringMessage=function(){return Resources.TransferringVideoMessage},i.prototype.waitingPreprocessingMessage=function(){return StoryPageEditSettings.MediaProcessProgressEnabled?Resources.VideoWaitingForProcessingMessage:Resources.WaitingForProcessingVideoMessage},i.prototype.preprocessingMessage=function(){var t=e.prototype.getModel.call(this).getMedia();if(!(t instanceof n.VideoContent))throw StoryApp.RethrowLogger.createError("Media should be instance of IVideoContent");var o=t.getThumbnail();return o&&o.getCopyInfo()?Resources.CopyingVideoMessage:StoryPageEditSettings.MediaProcessProgressEnabled?Resources.ProcessingVideoMessage:Resources.PreparingVideoMessage},i.prototype.getOverlayIcon=function(e){var t={fontIconName:{value:FontIcons.VideoIcon},fontIconSizeClass:FontIcons.VideoIconSize,fontIconWrapperClass:{value:"OverlayIconText"},fontIconBackgroundColorClass:"ThumbnailFontIconBackgroundColor"};return new TDB.ChildArgs(VE.FontIconVE,t)},i.prototype.supportsAltText=function(e){if(this.card.model){var t=this.getMedia(e);return t&&!o.MediaController.isMediaEmpty(t,e)}return!1},i.prototype.areCollapsedOrTeaserMode=function(t){return e.prototype.areCollapsedOrTeaserMode.call(this,t)||!StoryPageEditSettings.SocketifiedVideoCardEnabled},i}(t.MediaCardViewModel);t.VideoCardViewModel=i}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=StoryApp.View.ViewElements,i=e.View.ViewElements,r=function(e){function t(t,o,i){var r=e.call(this,t,o,i)||this;return r._args=i,r.card=new n.AgaveCard({model:o,definition:i.cardDefinition}),r._previewVE=i.previewVE,r}return __extends(t,e),t.prototype.navigateToContent=function(e){var t=this._previewVE._root.getValue();return o.NavigationHelper.navigateToContentId(t,this.card.model.id,{snapScene:!0,callerMessage:e,refreshNodes:!0}),this._args.authoringModel.setStorylineMode(i.StorylineMode.Collapsed),!1},t.prototype.getEmphasis=function(e){return this.card.model.getEmphasis(e)},t}(t.ContentCardViewModel);t.AgaveCardViewModel=r}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=function(e){function o(t,o,i){var r=e.call(this,t,o,i)||this;return r._args=i,r.card=new n.TableCard({model:o,definition:i.cardDefinition}),r._previewVE=i.previewVE,r.imageRepresentationViewModel=TDB.watcherOwnerTag(595904001,r,r,r.calcImageRepresentationViewModel),r}return __extends(o,e),o.prototype.getEmphasis=function(e){return this.getMedia(e).getEmphasis(e)},o.prototype.setEmphasis=function(e){var t=this;TDB.applyUpdate(function(){t.card.model.setEmphasis(e),t.getMedia().setEmphasis(e)})},o.prototype.getMedia=function(e){return this.card.model.getImageRepresentation(e).getMedia(e)},o.prototype.getImageRepresentationViewModel=function(e){return this.imageRepresentationViewModel.getWatchedValue(e)},o.prototype.calcImageRepresentationViewModel=function(e){var n=this.card.model.getImageRepresentation(e);return this._args.cardFactory.createViewModel(null,{model:n,cardMode:t.CardMode.Teaser})},o.prototype.getArgs=function(){return this._args},o}(t.ContentCardViewModel);t.TableCardViewModel=o}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t,n,o){var i=e.call(this,t,n,o)||this;return i.model=n,i}return __extends(t,e),t.prototype.inPlaceholderMode=function(e){var t=this.model.getCode(e);return!t||""===t},t.prototype.getCodeModel=function(){return this.model},t}(e.ContentCardViewModel);e.CodeCardViewModel=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=e.View.ViewElements,r=function(r){function a(e,t,n){var i=r.call(this,e,t,n)||this;return i.card=new o.ComplexHeadingCard({model:t,definition:n.cardDefinition}),i._isRootHeading=o.currentHeaderController().get(i.pageId).isRootHeading(t),i.backgroundViewModel=TDB.watcherOwnerTag(596473738,i,i,i.calcBackgroundViewModel),i}return __extends(a,r),a.prototype.getModel=function(){return this.card.model},a.prototype.getBackgroundViewModel=function(e){return this.backgroundViewModel.getWatchedValue(e)},a.prototype.calcBackgroundViewModel=function(e){var n=this.card.model.getBackground(e);if(n)return this._args.cardFactory.createViewModel(null,{model:n,cardMode:t.CardMode.Teaser})},a.prototype.getPlaceholderCardViewModel=function(){return this.placeholderViewModel||(this.placeholderViewModel=this._args.cardFactory.createPlaceholderCardVM(this,{cardParent:this._cardVE,context:this,acceptBlueprints:this.backgroundPlaceholderAcceptBlueprints,addModelObjects:this.backgroundPlaceholderAddModelObjects})),this.placeholderViewModel},a.prototype.backgroundPlaceholderAddModelObjects=function(t){var n=this,r=t.slice(0);e.Model.currentUndoManager().get(this.pageId).captureUserUpdate(function(){for(var e=0,i=t.length;e<i;e++)if(o.ObjectController.modelCanBeBackground(t[e].model)){var r=n.card.model.getBackground();if(r!=t[e].model&&(o.currentHeaderController().get(n.pageId).add([t[e]],{parent:n.card.model,socket:o.HeaderController.BackgroundSocket}),r)){var a=new o.Card({definition:o.ObjectController.getCardDefinitionForModelObject(r,n.pageId),model:r});t.splice(e+1,0,a)}t.splice(e,1);break}var s=[];t.forEach(function(e){s.push(e.model)});for(var l=o.currentStoryController().get(n.pageId),c=l.findParent(n.card.model),e=0,d=s.length;e<d;e++){if(c==l.getRootGroup()){var u=l.getRootGroup().children.getCollection();(c=u.length>0?u[0]:void 0)&&!c.getHeading()||(c=l.createGroup(),l.getRootGroup().children.add(c,0))}c!==l.findParent(s[e])&&(l.removeSpecifiedGroupChild(s[e]),c.children.add(s[e],e))}l.pruneEmptyGroups(),n._cardVE.setFocus()},"User added content to the background placeholder of a heading card"),i.AddAction.logAdd(r,this.pageId,"Added to a background",this.getModel())},a.prototype.createTextCardUnderHeading=function(){var e=o.currentStoryController().get(this.pageId),t=e.findParent(this.card.model);if(t==e.getRootGroup()){var n=t.children.getCollection();if(n.length>0&&null==n[0].getHeading())t=n[0];else{var i=e.createGroup();t.children.add(i,0),t=i}}var r=e.createTextGroup();return t.children.add(r,0),this._args.cardsContainer.startHidingPopularityMetric(),this._args.cardsContainer.getCardForModelId(r.id)},a.prototype.backgroundPlaceholderAcceptBlueprints=function(e){for(var t=e.length,n=o.currentHeaderController().get(this.pageId),i=0;i<t;i++)if(n.canAddBlueprints([e[i]],{parent:this.card.model,socket:o.HeaderController.BackgroundSocket}))return!0;return!1},a.prototype.hasText=function(e){return""!=this.card.model.getTitle(e).getContent(e).getText(e)},a.prototype.getStorylineDescription=function(e){return this._isRootHeading?Resources.TitleCardStorylineDescription:this.isSubheading()?Resources.SubheaderCardStorylineDescription:Resources.HeaderCardStorylineDescription},a.prototype.remove=function(n){var i=this,r=o.currentStoryController().get(this.pageId),a=r.findParent(this.card.model),s=r.findContainingCollection(a);if(s){var l,c=s.getCollection().indexOf(a),d=a.children.getCollection();this._removing=!0,d.length>0?(l=d[0].id,this._args.cardsContainer.getCardForModelId(l).activateItem()):this._cardVE.moveFocusForRemove(),e.Model.currentUndoManager().get(this.pageId).captureUserAction(function(){t.DeleteAction.execute([i.card.model],i.pageId,n)},"User removed heading card"),TDB.applyUpdate(function(){c<=0&&i._cardVE.cardParent.setCollapsed(!1)}),l&&platform.setImmediate(function(){var e=i._args.cardsContainer.getCardForModelId(l);e?e.setFocus():StoryLog.TraceTag(596473739,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.warning,"No card to set focus on after heading card removal. Card id: "+l)}),this.card.model.getContentSource()===e.Model.SM.ContentCreator.DocumentIngestion&&ActionLogger.RecordClientAction(new ClientAction.DeleteIngestedHeadingCard(this.card.model.id))}},a.prototype.canTakeAction=function(e,n){if(e==t.CardAction.Remove)return t.DeleteAction.isAvailable([this.card.model],this.pageId)&&!this._cardVE.cardParent.isCollapsed(n);if(e==t.CardAction.Focus){var o=this.card.model.getBackground(n);return!!this.isCollapsed(n)&&null!=o}return r.prototype.canTakeAction.call(this,e,n)},a.prototype.getCardForModelId=function(e){var t=this._cardVE.backgroundCard;return t&&t.getViewModel().getModelId()===e&&this.isCollapsed()?t:r.prototype.getCardForModelId.call(this,e)},a.prototype.isPlaceholder=function(e){return!this.isRootHeading()&&!(this.hasBackground(e)||StoryPageEditSettings.SubHeadingsEnabled&&this.getHeaderDepth(e)>1)},a.prototype.hasBackground=function(e){return void 0!=this.card.model.getBackground(e)},a.prototype.getBackgroundImageAttrArgs=function(e){var t=this.card.model.getBackground(e),n=t?t.getMedia(e):null;return n?{src:o.ImageController.calculateSourceUrl(n,e),alt:o.MediaController.getDefaultAltText(n,e)}:{}},a.prototype.createTextEditor=function(){var e=this.card.model.getTitle(),n={viewModel:new t.TextUnitEditorViewModel({card:this,pageId:this.pageId,textModel:e,cardSelectionManager:this._args.cardSelectionManager,textAggregator:this._cardVE.getTextAggregator(),fileUploader:this._args.fileUploader,cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,onCanvas:!1,context:this._cardVE,placeholder:""}),css:"calibriRegular",resourceFactory:this._args.resourceFactory,telemetryId:this.card.definition.textButtonId};return this._isRootHeading?(n.placeholder=StoryApp.Common.Branding.getStringCardDeckTitlePlaceholder(),n.css="RootHeadingTitleCard"):(n.placeholder=this.isSubheading()?Resources.CardDeckSubheadingTextPlaceholder:Resources.CardDeckChapterTitlePlaceholder,n.css="GroupHeadingTitleCard"),new i.TextUnitEditorVE(this._cardVE,n)},a.prototype.getTextEditorCreationArgs=function(e){var n=this.card.model.getTitle(e),o={viewModel:new t.TextUnitEditorViewModel({card:this,pageId:this.pageId,textModel:n,cardSelectionManager:this._args.cardSelectionManager,textAggregator:this._cardVE.getTextAggregator(),fileUploader:this._args.fileUploader,cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,onCanvas:!1,placeholder:""}),css:"calibriRegular",resourceFactory:this._args.resourceFactory,telemetryId:this.card.definition.textButtonId};return this._isRootHeading?(o.placeholder=StoryApp.Common.Branding.getStringCardDeckTitlePlaceholder(),o.css="RootHeadingTitleCard"):(o.placeholder=this.isSubheading()?Resources.CardDeckSubheadingTextPlaceholder:Resources.CardDeckChapterTitlePlaceholder,o.css="GroupHeadingTitleCard"),o},a.prototype.isRootHeading=function(){return this._isRootHeading},a.prototype.isSubheading=function(){return this.card.definition.id===o.ManualCardType.SubHeaderId},a.prototype.getCardLabelText=function(){return this._isRootHeading?Resources.TitleCardStorylineDescription:this.isSubheading()?Resources.SubheaderCardStorylineDescription:Resources.HeaderCardStorylineDescription},a.prototype.dragHandlesVisible=function(e){return!this.isRootHeading()&&r.prototype.dragHandlesVisible.call(this,e)},a.prototype.getFocusedAuthors=function(e){var t=r.prototype.getFocusedAuthors.call(this,e);this._cardVE.backgroundCardArgs(e);var n=this._cardVE.backgroundCard;return n&&(t=t.concat(n.getViewModel().getFocusedAuthors(e))),t},a.prototype.getLabelText=function(){return this._cardVE.cardLabelDefaultText},a.prototype.getThumbnailText=function(e){var t=this.card.model.getTitle(e),n=t?t.getContent(e):void 0,o=n?n.getText(e):"";return o||Resources.CardDeckGroupLabel},a.prototype.getHeaderDepth=function(e){return o.currentStoryController().get(this.pageId).getChildsDepth(this.card.model)-1},a.prototype.canBeSelected=function(e){return!this.isRootHeading()&&r.prototype.canBeSelected.call(this,e)},a.prototype.isSelectionOverlayVisible=function(e){return this._args.cardSelectionManager.isInMultiselectMode(e)&&this.canBeSelected(this._cardVE)},a.prototype.moveCard=function(e){},a.prototype.hintsAvailable=function(e){var t=this.card.model.storyModel.traversalModel.getSpecifiedGrouping().getRootGroup(e);return this.hasHints(t,e)},a.prototype.hasHints=function(e,t){if(e.getAuthoringHint(t))return!0;if(e instanceof n.MediaWithTextComposite&&e.getText()&&e.getText().getAuthoringHint(t))return!0;var i=o.StoryController.getGroupChildren(e);if(!i)return!1;for(var r=i.getCollection(t),a=0;a<r.length;a++)if(this.hasHints(r[a],t))return!0;return!1},a.prototype.clearAllHints=function(){var e=this.card.model.storyModel.traversalModel.getSpecifiedGrouping().getRootGroup();this.clearHints(e)},a.prototype.clearHints=function(e){e.getAuthoringHint()&&e.setAuthoringHint(void 0),e instanceof n.MediaWithTextComposite&&e.getText()&&e.getText().getAuthoringHint()&&e.getText().setAuthoringHint(void 0);var t=o.StoryController.getGroupChildren(e);if(t)for(var i=t.getCollection(),r=0;r<i.length;r++)this.clearHints(i[r])},a.prototype.canAddPastedModel=function(e){var t=this.getModel();return!(void 0!==t.getBackground()||!o.ImageController.modelCanBeBackground(e))&&(t.setBackground(e),!0)},a}(t.CardViewModel);t.ComplexHeadingCardViewModel=r}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=function(e){function t(t,o,i){var r=e.call(this,t,o,i)||this;return r.card=new n.DocumentCard({model:o,definition:i.cardDefinition}),r}return __extends(t,e),t.prototype.getModel=function(){return this.card.model},t.prototype.getErrorText=function(e){var t=this.card.model.getUploadInfo(e),o=n.StoryController.getUploadStatus(this.card.model,e),i=t?t.getErrorMessage(e):void 0;return o==n.UploadStatus.Error?null!=i?DocumentIngestion.DocumentIngestionAPI.uploadErrorMessage(i):Resources.DocumentIngestionGenericError:""},t.prototype.getStatusText=function(e){this.card.model.getUploadInfo(e);var t=n.StoryController.getUploadStatus(this.card.model,e);return t==n.UploadStatus.Uploading?Resources.DocumentIngestionIngestToExistingMessage:t==n.UploadStatus.Completed?Resources.UploadCompleted:""},t.prototype.getFilename=function(e){var t=this.card.model.getUploadInfo(e);return t&&t.getFileName()},t}(t.MediaContentCardViewModel);t.DocumentCardViewModel=o}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(n){var o,i=e.Model.SM,r=e.Model.AuthoringModel,a=e.Server.Decomposition.WP,s=e.Server.Decomposition.DecompositionAPI,l=e.View.Common.EmbedCardNativeConverter,c=StoryApp.Common;!function(e){e[e.Ready=0]="Ready",e[e.Converting=1]="Converting",e[e.Failure=2]="Failure",e[e.FailureSilent=3]="FailureSilent",e[e.FailureAcknowledged=4]="FailureAcknowledged"}(o=n.ConvertToNativeCardStatus||(n.ConvertToNativeCardStatus={}));var d;!function(e){e[e.Default=0]="Default",e[e.ImportCard=1]="ImportCard",e[e.ReadyToConvert=2]="ReadyToConvert",e[e.ConvertingCard=3]="ConvertingCard"}(d=n.MessageInfoContext||(n.MessageInfoContext={}));var u=function(n){function u(e,i,a){var d=n.call(this,e,i,a)||this;return d.card=new r.EmbedCard({model:i,definition:a.cardDefinition}),d.controller=r.currentEmbedController().get(d.pageId),d.cardsContainer=a.cardsContainer,d.convertToNativeCardStatus=TDB.watchableTag(596473697,d,o.Ready),d.messageWatcher=TDB.watcherTag(596473698,d,d,d.calcMessageInfo),d.embedCardNativeConverter=new l(new s,d.controller,new t.Common.EmbedCodeFormatValidator),d.embedCardType=c.UserState.getInstance().isEligibleForFirstClassEmbedCardExperiment()?u.extraEmbedCardTypeFromEmbedCode(d.card.model.getEmbedCode(null)):r.ManualCardType.EmbedId,d}return __extends(u,n),u.prototype.getEmbedCardType=function(){return this.embedCardType},u.prototype.getModel=function(){return this.card.model},u.prototype.getEmphasis=function(e){return this.card.model.getEmphasis(e)},u.prototype.setEmphasis=function(e){var t=this;TDB.applyUpdate(function(){t.card.model.setEmphasis(e)})},u.prototype.isUploading=function(e){var t=this.card.model.getCardState(e);return this.card.model.getUploadInfo(e)||(t=i.UploadStatus.Completed),t==i.UploadStatus.Uploading},u.prototype.isConvertingToNativeCard=function(e){return this.convertToNativeCardStatus.getWatchedValue(e)===o.Converting},u.prototype.isConversionFailureVisible=function(e){return this.convertToNativeCardStatus.getWatchedValue(e)===o.Failure},u.prototype.isConversionFailure=function(e){var t=this.convertToNativeCardStatus.getWatchedValue(e);return t===o.Failure||t===o.FailureSilent||t===o.FailureAcknowledged},u.prototype.selectStyleForStatus=function(e,t,n,o){var r=this.card.model.getCardState(e);switch(this.card.model.getUploadInfo()||(r=i.UploadStatus.Completed),r){case i.UploadStatus.Uploading:return t;case i.UploadStatus.Completed:return n;case i.UploadStatus.Error:return o;default:return}},u.prototype.isEmbedCodeVisible=function(e){return this.card.model.getCardState(e)===i.UploadStatus.Completed&&null!=this.card.model.getUploadInfo()},u.prototype.isInvalidMessageVisible=function(e){return this.messageWatcher.getWatchedValue(e).errorMessage.length>0},u.prototype.isInfoMessageLinkVisible=function(e){return c.Environment.getInstance().isClientOnline(e)&&!!this.messageWatcher.getWatchedValue(e).primaryMessageLinkArgs&&0!==this.messageWatcher.getWatchedValue(e).primaryMessageLinkArgs.length},u.prototype.getEmbedMessageInfoArray=function(e){var t=this.getEmbedInfoMessageText(e),n=this.getEmbedInfoLinkArgs(e);return u.resolveEmbedCardText(t,n)},u.prototype.getEmbedInfoMessageText=function(e){return this.messageWatcher.getWatchedValue(e).primaryMessage},u.prototype.getEmbedInfoLinkArgs=function(e){return this.messageWatcher.getWatchedValue(e).primaryMessageLinkArgs},u.prototype.invalidMessageTextArgs=function(e){return this.messageWatcher.getWatchedValue(e).errorMessage},u.prototype.acknowledgeConversionFailure=function(){var e=this;this.convertToNativeCardStatus.getValue()===o.Failure&&TDB.applyUpdate(function(){e.convertToNativeCardStatus.setValue(o.FailureAcknowledged)})},u.prototype.setEmbedCode=function(n){var i=this;if(r.StoryController.isModelObjectValid(this.card.model)){n=n.trim();var a=this.getEmbedCodeWithoutPrefix(null).trim();if(n!==a){var s=StoryPageEditSettings.AutoConvertEmbeds&&!a.length&&n.length>0;if(TDB.applyUpdate(function(){i.convertToNativeCardStatus.setValue(o.Ready),e.Model.currentUndoManager().get(i.pageId).captureUserUpdate(function(){i.controller.setEmbedCode(i.embedCardType+"://"+n,i.card.model)},"Setting the html code for an embed object")}),s){var l=this.messageWatcher.getValue();l&&l.context===d.ReadyToConvert&&(ActionLogger.RecordClientAction(new ClientAction.StorylineActionData(ClientAction.ActionType.Storyline_Embed_AutoConvertedToNative,"Auto converting embed card",[this.getModelId()],[t.ViewElements.CardType[this._cardVE.cardType]],!1)),this.convertToNativeCard(!0))}}}},u.prototype.getEmbedCodeWithoutPrefix=function(e){if(!r.StoryController.isModelObjectValid(this.card.model))return"";var t=this.card.model.getEmbedCode(e)||"",n=u.extraEmbedCardTypeFromEmbedCode(t)+"://";return 0===t.indexOf(n)?t.replace(n,""):t},u.prototype.logEmbedCodeClick=function(){var e=new ClientAction.EmbedCardUI(ClientAction.ActionType.ViewEmbedCode,this.getEmbedCodeWithoutPrefix(null),"The user clicked on view embed code");ActionLogger.RecordClientAction(e)},u.prototype.getFilename=function(e){return this.hasUploadInfo()?this.card.model.getUploadInfo().getFileName(e):""},u.prototype.embedDocumentFontIconName=function(){if(c.UserState.getInstance().isEligibleForFirstClassEmbedCardExperiment())switch(this.embedCardType){case r.ManualCardType.SwayId:return FontIcons.SwayWatermarkIcon;case r.ManualCardType.TwitterId:return FontIcons.CardTweetIcon}return n.prototype.embedDocumentFontIconName.call(this)},u.prototype.calcMessageInfo=function(e){if(this.card.model.getUploadInfo(e)){var t=this.card.model.getCardState(e);return this.getMessageInfoForUpload(e,t)}var n=null,i=this.convertToNativeCardStatus.getWatchedValue(e);switch(i){case o.Failure:n=Resources.EmbedConversionFailure;break;case o.Converting:return{context:d.ConvertingCard,primaryMessage:Resources.EmbedConvertingMessage,primaryMessageLinkArgs:null,errorMessage:""}}var a=this.getEmbedCodeWithoutPrefix(e),s=this.controller.validateIFrame(a),l=this.getEmbedMessageInfoForNativeConverting(a);if(s.length>0||i===o.FailureSilent||!l){if(l={context:d.Default,primaryMessage:u.getPrimaryMessage(),primaryMessageLinkArgs:u.getPrimaryMessageLinkArgs(),errorMessage:s},c.UserState.getInstance().isEligibleForFirstClassEmbedCardExperiment()&&this.embedCardType!==r.ManualCardType.EmbedId){var p=u.getButtonPayload(this.embedCardType,!0);l.primaryMessage="",l.primaryMessageLinkArgs=[{url:p.url,cssClass:{value:"EmbedMessageLink"},text:{value:p.text},tooltip:{value:p.tooltip},buttonId:p.buttonId,context:self,target:"_blank",nativeKeyboardHandling:!0}]}}else n&&(l.errorMessage=n);return l},u.prototype.getMessageInfoForUpload=function(e,t){var n,o="";switch(t){case i.UploadStatus.Processing:case i.UploadStatus.Uploading:n=Resources.EmbedCreatingLinkMessage;break;case i.UploadStatus.Error:o=Resources.EmbedErrorGenericMessage;default:n=Resources.EmbedOneDriveInfoMessage}return{context:d.ImportCard,primaryMessage:n,primaryMessageLinkArgs:null,errorMessage:o}},u.prototype.getEmbedMessageInfoForNativeConverting=function(e){var t=this,n=function(){return t.convertToNativeCard(!1),TDB.EventPropagation.Bypass};return this.embedCardNativeConverter.getEmbedMessageInfo(e,n)},u.prototype.convertToNativeCard=function(e){var t=this,n=function(n,o){t.onDecompositionComplete(n,o,e)};TDB.applyUpdate(function(){return t.convertToNativeCardStatus.setValue(o.Converting)}),this.embedCardNativeConverter.convertToNativeCard(this._cardVE,this.getEmbedCodeWithoutPrefix(null),e,n,function(){return t.onDecompositionError()})},u.prototype.onDecompositionComplete=function(n,r,s){var l=this;if(!n||a.DecompositionStatus[n.Status]!=a.DecompositionStatus.Success)return StoryLog.TraceTag(596473699,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.warning,'Embed Conversion: Error returned by decomposition service of for provider "'+r.providerType+'", status: "'+n.Status+'", error "'+n.ErrorMessage+'".'),void this.onDecompositionError();if(!n.Decomposition.PartGroups||0===n.Decomposition.PartGroups.length)return StoryLog.TraceTag(596473728,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,'Embed Conversion: No results were returned for the provider "'+r.providerType+'"'),void(s?TDB.applyUpdate(function(){return l.convertToNativeCardStatus.setValue(o.FailureSilent)}):this.onDecompositionError());e.Model.currentUndoManager().get(this.pageId).captureUserUpdate(function(){var e=l.convertEmbedCard(n,r);if(e){var t=[e];l._cardVE.getJack().addModelObjects(t),l._cardVE.remove("Converted Embed")}},"Converting embed card"),StoryLog.StructuredTraceTag(596473729,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,'Embed Conversion: Convert embed card to a native card of the provider "'+r.providerType+'"',{OriginalType:"Embed",ConvertedType:'"'+r.providerType+'"'});var c=ClientAction.ActionType.Storyline_Embed_ConvertedToNativeOther;switch(r.providerType){case i.ContentProvider[i.ContentProvider.YouTube]:c=ClientAction.ActionType.Storyline_Embed_ConvertedToNativeYouTube;break;case i.ContentProvider[i.ContentProvider.Twitter]:c=ClientAction.ActionType.Storyline_Embed_ConvertedToNativeTweet;break;case i.ContentProvider[i.ContentProvider.Giphy]:c=ClientAction.ActionType.Storyline_Embed_ConvertedToNativeGiphy}ActionLogger.RecordClientAction(new ClientAction.StorylineActionData(c,"Embed card converted to native media card",[this.getModelId()],[t.ViewElements.CardType[this._cardVE.cardType]],!0))},u.prototype.convertEmbedCard=function(e,t){var n=e.Decomposition.PartGroups[0];n.Parts=n.Parts.concat(e.Decomposition.SharedParts);var o=r.ObjectController.createCard(n,t.providerType,this.pageId);if(o.model)return this.updateEmphasis(o.model,this.getEmphasis(),t.providerType),o;this.onDecompositionError()},u.prototype.updateEmphasis=function(e,t,n){e instanceof i.StatusUpdateContent?e.setEmphasis(t):e instanceof i.MediaWithTextComposite?e.getMedia().setEmphasis(t):TDB.raiseRecoverableError(n+" embed was converted without capturing emphasis level from original card.",TDB.LogLevel.warning)},u.prototype.onDecompositionError=function(e){var t=this;TDB.applyUpdate(function(){return t.convertToNativeCardStatus.setValue(o.Failure)})},u.prototype.getLabelText=function(e){var t=this.getFilename(e);if(t&&0!=t.length)return ResourceManager.ResolveString(Resources.CardLabelSpacing,[Resources.EmbedCardStorylineDescription,t]);if(r.StoryController.isModelObjectValid(this.card.model)){var n=this.card.model.getTitle(e);if(n&&0!=n.length)return ResourceManager.ResolveString(Resources.CardLabelSpacing,[Resources.EmbedCardStorylineDescription,n])}return this.embedCardType===r.ManualCardType.EmbedId?Resources.EmbedCardStorylineDescription:this._args.cardDefinitionManager.getCardDefinition(this.embedCardType).storylineDescription},u.getPrimaryMessage=function(){switch(CommonSettings.CurrentUserType){case UserType.AAD_EDU:return Resources.EmbedInfoMessageEDU;case UserType.MSA:return Resources.EmbedInfoMessageMSA;default:return Resources.EmbedInfoMessageBUS}},u.getPrimaryMessageLinkArgs=function(){var e;switch(CommonSettings.CurrentUserType){case UserType.AAD_EDU:e=StoryPageEditSettings.EmbedCardMessageEDUSources;break;case UserType.MSA:e=StoryPageEditSettings.EmbedCardMessageMSASources;break;default:e=StoryPageEditSettings.EmbedCardMessageBUSSources}return e.map(function(e){var t=u.getButtonPayload(e);if(t)return{url:t.url,cssClass:{value:"EmbedMessageLink"},text:{value:t.text},tooltip:{value:t.tooltip},buttonId:t.buttonId,context:self,target:"_blank",nativeKeyboardHandling:!0}})},u.getButtonPayload=function(e,t){void 0===t&&(t=!1);var n=StoryPageEditSettings.EmbedCardMessageAllSources[e];if(n)try{var o=JSON.parse(n);switch(e){case"PowerBi":return{buttonId:ClientAction.ButtonId.Embed_PowerBi,text:t?Resources.EmbedInfoMessagePowerBiDescription:Resources.EmbedInfoMessagePowerBiButtonTitle,url:o.url,tooltip:u.getButtonTooltip(Resources.EmbedInfoMessagePowerBiButtonTitle)};case"Vimeo":return{buttonId:ClientAction.ButtonId.Embed_Vimeo,text:t?Resources.EmbedInfoMessageVimeoDescription:Resources.SuggestSourceVimeo,url:o.url,tooltip:u.getButtonTooltip(Resources.SuggestSourceVimeo)};case"Sway":return{buttonId:ClientAction.ButtonId.Embed_Sway,text:t?Resources.EmbedInfoMessageSwayDescription:Resources.ProductNameShort,url:o.url,tooltip:u.getButtonTooltip(Resources.ProductNameShort)};case"Sketchfab":return{buttonId:ClientAction.ButtonId.Embed_Sketchfab,text:t?Resources.EmbedInfoMessageSketchfabDescription:Resources.EmbedInfoMessageSketchfabButtonTitle,url:o.url,tooltip:u.getButtonTooltip(Resources.EmbedInfoMessageSketchfabButtonTitle)};case"Twitter":return{buttonId:ClientAction.ButtonId.Embed_Twitter,text:t?Resources.EmbedInfoMessageTwitterDescription:Resources.FollowTwitter,url:o.url,tooltip:u.getButtonTooltip(Resources.FollowTwitter)};case"SharePoint":return{buttonId:ClientAction.ButtonId.Embed_SharePoint,text:t?Resources.EmbedInfoMessageSharePointDescription:Resources.EmbedInfoMessageSharePointButtonTitle,url:o.url,tooltip:u.getButtonTooltip(Resources.EmbedInfoMessageSharePointButtonTitle)};case"SoundCloud":return{buttonId:ClientAction.ButtonId.Embed_SoundCloud,text:Resources.EmbedInfoMessageSoundCloudButtonTitle,url:o.url,tooltip:u.getButtonTooltip(Resources.EmbedInfoMessageSoundCloudButtonTitle)};case"MicrosoftForms":return{buttonId:ClientAction.ButtonId.Embed_MicrosoftForms,text:Resources.EmbedInfoMessageMicrosoftFormsButtonTitle,url:o.url,tooltip:u.getButtonTooltip(Resources.EmbedInfoMessageMicrosoftFormsButtonTitle)};case"More":return{buttonId:ClientAction.ButtonId.Embed_LearnMore,text:Resources.EmbedInfoMessageMoreButtonTitle,url:o.url,tooltip:u.getButtonTooltip()};default:return}}catch(t){return void StoryLog.StructuredTraceTag(596465567,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.error,"There is a badly-formatted JSON string in StoryEmbedCardMessageAllSources BRS.",{Error:""+t,EmbedCardType:e,StringifiedLinkButtonInfo:n})}},u.getButtonTooltip=function(e){return e?ResourceManager.ResolveString(Resources.EmbedInfoMessageSourceButtonTooltip,[e]):Resources.EmbedInfoMessageMoreButtonTooltip},u.resolveEmbedCardText=function(e,t){if(!e)return t&&0!==t.length?t:[];var n=/\{(\d+)\}/g,o=[];return e.split(/\{\d+\}/).forEach(function(i){var r=n.exec(e),a=r?r[0]:void 0,s=r?parseInt(r[1]):void 0;i.length>0&&o.push({message:i}),a&&t[s]&&o.push(t[s])}),o},u.extraEmbedCardTypeFromEmbedCode=function(e){var t=/^[a-zA-Z]*\:\/\//.exec(e),n=Object.keys(StoryPageEditSettings.EmbedCardMessageAllSources);if(n.push("Embed"),t&&t[0]){var o=t[0].replace("://","");return-1!==n.indexOf(o)?o:r.ManualCardType.EmbedId}return r.ManualCardType.EmbedId},u}(n.MediaContentCardViewModel);n.EmbedCardViewModel=u}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(n){var o=e.Model.SM,i=e.Model.AuthoringModel,r=e.View.ViewElements,a=function(e){function a(t,n,o){var r=e.call(this,t,n,o)||this;return r.card=new i.GroupCard({model:n,definition:o.cardDefinition}),r._firstRunElementInit=!1,r._isRootGroup=i.currentGroupController().get(r.pageId).isRootGroup(n),r._headingPosition=TDB.watcherTag(596473685,r,r,r.calcCurrentHeadingPosition),r}return __extends(a,e),a.prototype.doRootGroupSetup=function(){this.isRootGroup()&&this._cardVE.headingCard.getValue().setFocus()},a.prototype.getModel=function(){return this.card.model},a.prototype.isRootGroup=function(){return this._isRootGroup},a.prototype.getHeading=function(e){return this.card.model.getHeading(e)},a.prototype.getStorylineDescription=function(e){var t=this.getLabel(e,!0),n=ResourceManager.ResolveString(Resources.CardDeckGroupStorylineDescription,[t!==Resources.CardDeckGroupLabel?t:""]);return ResourceManager.ResolveString(Resources.CardDeckContainerTemplateLabel,[n,this.getChildren().length])},a.prototype.getParent=function(e){var t=this._cardVE?this._cardVE.cardParent:void 0,n=t?t.getViewModel():void 0;return n instanceof a?n:void 0},a.prototype.hasThumbnailImage=function(e){var t=this.getHeadingCardViewModel(e);return!!t&&t.hasBackground(e)},a.prototype.hasContent=function(e){if(this.getContentCards(e).length>0)return!0;var t=this.getHeadingCardViewModel(e);return!!t&&(t.hasBackground(e)||t.hasText(e))},a.prototype.getImageAttributes=function(e){var t=this.getHeadingCardViewModel(e);return t?t.getBackgroundImageAttrArgs(e):{}},a.prototype.getThumbnailLabel=function(e,t){var n=this.getHeadingCardViewModel(e);return n?n.getThumbnailText(e):""},a.prototype.getLabel=function(e,t){var n=Resources.CardDeckGroupLabel,o=t?!t:this.isCollapsed(e),i=0;o&&(i=this.getContentCards(e).length,e.watchValue(this._cardVE.headingCard)&&i++,n=ResourceManager.ResolveString(Resources.CardDeckGroupLabelWithCount,[i]));var r=this.card.model.getHeading(e),s=r?r.getTitle(e):void 0,l=s?s.getContent(e):void 0,c=l?l.getText(e):"";return c&&0!==c.length&&(c.length>a.MaxTitleLength&&(c=ResourceManager.ResolveString(Resources.CardDeckGroupNewLabelWithEllipsis,[c.slice(0,a.MaxTitleLength)])),n=o?ResourceManager.ResolveString(Resources.CardDeckGroupNewLabelWithCount,[c,i]):c),StoryPageEditSettings.SubHeadingsEnabled&&(n=ResourceManager.ResolveString(Resources.CardDeckGroupLabelWithPosition,[this.getHeadingPositionPrefix(e),n])),n},a.prototype.getHeadingPositionPrefix=function(e){if(this.isRootGroup())return"";var t=this.getParent(e),n=t?t.getHeadingPositionPrefix(e):"",o=this._headingPosition.getWatchedValue(e);return n?ResourceManager.ResolveString(Resources.CardDeckGroupPositionOrder,[n,Resources.CardDeckGroupPositionSeperator,o]):o},a.prototype.calcCurrentHeadingPosition=function(e){if(!this.card.model)return"";if(this.isRootGroup())return"";var t=i.currentStoryController().get(this.pageId).findContainingCollection(this.card.model);if(!t)return"";for(var n=t.getCollection(e),r=0,a=1;r<n.length&&n[r]!=this.card.model;){var s=n[r];s instanceof o.SpecifiedGroup&&s.getHeading()&&a++,r++}return a.toString()},a.prototype.getChildren=function(e){return i.StoryController.isModelObjectValid(this.card.model)?this.card.model.children.getCollection(e):[]},a.prototype.getChildrenForViewModels=function(e){return this.inTeaserMode(e)&&StoryPageEditSettings.SubHeadingsEnabled?[]:this.getChildren(e)},a.prototype.addModelObjects=function(e){r.AddAction.execute(e,{parent:this.card.model,index:this.getContentCards().length},this.pageId,"Added to a group card")},a.prototype.canInsertBlueprints=function(e){return r.AddAction.isAvailable(e,{parent:this.card.model},this.pageId)},a.prototype.createCardArgs=function(e){for(var t=this.viewModelChildren.getWatchedValue(e),n=[],o=t.length,i=0;i<o;i++){var r=this._args.cardFactory.createArgs({cardParent:this._cardVE,model:t[i].getModel(),parentSuggestedCardModeWatchable:this._childCardModeWatcher,viewModel:t[i]});n.push(r)}return n},a.prototype.canTakeAction=function(t,n){return!this.isRootGroup()&&(void 0!=this._cardVE.headingCard.getWatchedValue(n)&&e.prototype.canTakeAction.call(this,t,n))},a.prototype.getTopTweenerArgs=function(){var e={parentModel:this.card.model,authoringModel:this._args.authoringModel,fileUploader:this._args.fileUploader,cardsContainer:this._args.cardsContainer,cardSelectionManager:this._args.cardSelectionManager,cardDragHandler:this._args.cardDragHandler,visible:{compute:new TDB.ComputedOptionArgs(this,this.topTweenerVisible)},grandparent:this._cardVE,isGroupTopTweener:!0};return this.isRootGroup()&&(e.context=this,e.calculateDropRect=this.calculateHeadingCardTweenerDropRect),e},a.prototype.getFirstRunJackHint=function(e){if(this.isRootGroup()&&this._args.firstRunManager.firstRunUIVisible.getWatchedValue(e)){var n={firstRunManager:this._args.firstRunManager,delay:t.Common.FirstRunManager.firstElementDelay,wrapperClass:"JackFirstRun",iconImage:Icons.JackArrowIcon,iconClass:"JackFirstRunArrow",hintText:Resources.FirstRunJackButtonHeader,hintClass:"JackFirstRunHeaderText",detailsClass:"JackFirstRunDetailsText",detailsText:Resources.FirstRunJackButtonDetails,visible:this.firstRunJackHintVisible,visibleContext:this};return new TDB.ChildArgs(r.FirstRunElementVE,n)}},a.prototype.headerVisible=function(e){return!this.isRootGroup()&&void 0!=this._cardVE.headingCard.getWatchedValue(e)},a.prototype.getCardForModelId=function(t){var n,o=this._cardVE.headingCard.getValue();return o&&(n=o.getViewModel().getCardForModelId(t))?n:e.prototype.getCardForModelId.call(this,t)},a.prototype.getHeadingCard=function(e){return this._cardVE.headingCard.getWatchedValue(e)},a.prototype.getHeadingCardViewModel=function(e){var t=this.getHeadingCard(e);return t?t.getViewModel():void 0},a.prototype.getPlaceholderCardViewModel=function(){return this.placeholderCardViewModel||(this.placeholderCardViewModel=this._args.cardFactory.createPlaceholderCardVM(this,{context:this,acceptBlueprints:this.canInsertBlueprints,addModelObjects:this.addModelObjects,cardParent:this._cardVE})),this.placeholderCardViewModel},a.prototype.firstRunJackHintVisible=function(e){return this._cardVE.headingCard.getValue().getJack(e).isMenuShown(e),!(!e.watchValue(this._args.firstRunManager.firstRunUIVisible)||this._firstRunElementInit)&&(this._firstRunElementInit=!0,!0)},a.prototype.calculateHeadingCardTweenerDropRect=function(e){return this.isRootGroup()&&0==this.getContentCards().length?(e.height=Number.MAX_VALUE-e.top,e):e},a.prototype.topTweenerVisible=function(e){return!this.isCollapsed(e)},a.prototype.calculateHeadingCard=function(e){var t=this;if(this.card.model.storyModel.getModelObject(this.card.model.id)){var o=this.card.model.getHeading(e);if(o)return this.headingCardViewModel=this._args.cardFactory.createComplexHeadingCardVM(this,{model:o,parentSuggestedCardModeWatchable:this._childCardModeWatcher}),this._args.cardFactory.createComplexHeadingCard(this._cardVE,{cardParent:this._cardVE,viewModel:this.headingCardViewModel});TDB.applyUpdate(function(){t.setCardMode(n.CardMode.Expanded)},TDB.Justification.InitialConversion)}},a.prototype.isDescendantSelected=function(){var t=this._cardVE.headingCard.getValue();return!(!t||!this._cardVE.cardSelectionManager.isSelected(t)&&!t.getViewModel().isDescendantSelected())||e.prototype.isDescendantSelected.call(this)},a.prototype.calculateBottomTweenerVisibility=function(t){return!!StoryPageEditSettings.SubHeadingsEnabled||e.prototype.calculateBottomTweenerVisibility.call(this,t)},a.MaxTitleLength=40,a}(n.ContainerCardViewModel);n.GroupCardViewModel=a}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=function(t){function i(e,n,i){var r=t.call(this,e,n,i)||this;return r.card=new o.ImportingOrEmbeddingDocumentCard({model:n,definition:i.cardDefinition}),r}return __extends(i,t),i.prototype.getModel=function(){return this.card.model},i.prototype.getCardState=function(e){return this.card.model.getCardState(e)},i.prototype.isMessageVisible=function(e){return this.getCardState(e)!==n.UploadStatus.Error},i.prototype.isErrorVisible=function(e){return this.getCardState(e)===n.UploadStatus.Error},i.prototype.isButtonVisible=function(e){return this.getCardState(e)===n.UploadStatus.Completed||this.getModel().getProviderType()!==n.ContentProvider.MyDevice},i.prototype.importDocument=function(){var t=this;if(StoryPageEditSettings.BlockService_DocumentIngestion)return ErrorDialog.ShowErrorDialog(Resources.DocumentIngestionDisabled,"","Doc Ingestion is disabled"),TDB.EventPropagation.Bypass;var i=this.card.model.getDownloadLink(),r=this.card.model.getSize(),a=this.card.model.getExtension(),s=this.card.model.getProviderType(),l=this.card.model.getDocumentID(),c=this.card.model.getUploadInfo().getFileName(),d=new ClientAction.ImportedOrEmbeddedDocumentUI(ClientAction.ActionType.Add_Document_OneDrive_ImportButtonClick,n.ContentProvider[s],a,"The user clicked and imported the document");ActionLogger.RecordClientAction(d);var u,p={contentArgs:{uploadFileName:c}};return e.Model.currentUndoManager().get(this.pageId).captureUserUpdate(function(){t._cardVE.setFocus();var e=o.currentDocumentContentController().get(t.pageId).createCardFromContent(p);u=e.model,t._args.cardsContainer.addCardObjects([e]),t._cardVE.remove("Imported document"),TDB.applyUpdate(function(){t._args.cardSelectionManager.setSelection(t._cardVE,!1)})},"User imported document"),s==n.ContentProvider.MyDevice?o.DocumentContentController.AddLocalDocument(c,r,u.id,s,l):o.currentDocumentContentController().get(this.pageId).addDocument(a,r.toString(),i,c,u.id,n.ContentProvider[s]),TDB.EventPropagation.Bypass},i.prototype.isValidState=function(e){return this.getCardState(e)!=n.UploadStatus.Error},i.prototype.isUploading=function(e){return this.getCardState(e)==n.UploadStatus.Uploading&&this.card.model.getProviderType(e)==n.ContentProvider.MyDevice},i.prototype.embedDocument=function(){return StoryPageEditSettings.BlockAuthoring_DocumentEmbedding?(ErrorDialog.ShowErrorDialog(Resources.DocumentEmbeddingNotAvailable,"","Doc Embed Not Available"),TDB.EventPropagation.Bypass):(o.currentImportingOrEmbeddingDocumentController().get(this.pageId).embedDocumentFromCard(this._cardVE,this._args.cardsContainer),TDB.EventPropagation.Bypass)},i.prototype.canBeImported=function(e){var t=this.card.model.getExtension(e);return ArrayExtensions.contains(CommonSettings.DocumentIngestionFormats,t)||ArrayExtensions.contains(CommonSettings.DocumentIngestionExperimentalFormats,t)},i.prototype.getFilename=function(e){var t=this.card.model.getUploadInfo(e);return t&&t.getFileName()},i}(t.MediaContentCardViewModel);t.ImportingOrEmbeddingDocumentCardViewModel=i}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.View.ViewElements,i=CommonBindings.View.Bindings.DynamicMenu,r=function(){function e(){this.menuItems={},this.overflowMenuVisible=TDB.watchableTag(596473668,this,!1),this._numOverflowElementsVisible=0}return e.prototype.overflowMenuArgs=function(){var e=this;return new TDB.ChildArgs(o.CardMenuOverflowVE,{visible:this.overflowMenuVisible,getControllingElement:function(){return e._overflowButton},chunk:this})},e.prototype.hideOverflowMenu=function(){var e=this;TDB.applyUpdate(function(){e.overflowMenuVisible.setValue(!1)})},e.prototype.createMenuItem=function(t,o,i,r){i.glyphOnlyCssClass="CardMenuTextButtonNoText";var a,s=(new StoryApp.Common.GlyphIconSupportVerifier).localeSupportsGlyphIconText(CommonSettings.UserLocaleString);a=i.useGlyphIconText&&!s?new n.HideableMenuItem({primaryType:o,primaryArgs:i,viewElementVisible:{compute:new TDB.ComputedOptionArgs(this,r)}}):new n.CollapsibleMenuItem({primaryType:o,primaryArgs:i,viewElementVisible:{compute:new TDB.ComputedOptionArgs(this,r)}});var l=StoryApp.Utilities.shallowClone(i);l.cssClass={value:e.OverflowButtonClass},l.textClass=e.OverflowButtonTextClass,l.visible=a.getOverflowVisibility(),this.menuItems[t]={menuItem:a,overflowArgs:new TDB.ChildArgs(o,l)}},e.prototype.overflowButtonArgs=function(){var e=this,t={buttonId:this.getOverflowButtonId(),calculateChecked:this.overflowActive,click:this.overflowButtonClicked,cssClass:{compute:new TDB.ComputedOptionArgs(this,this.overflowButtonCssClass)},context:this,description:{value:Resources.OverFlowButtonDescription},fontIconArgs:{value:{fontIconName:{value:FontIcons.CardMenuOverflowIcon},fontIconSizeClass:FontIcons.CardMenuOverflowIconSize}},hasPopup:!0};return new TDB.ChildArgs(n.ToggleButtonVE,t,function(t){e._overflowButton=t})},e.prototype.overflowButtonClicked=function(e){var t=this;return TDB.applyUpdate(function(){t.overflowMenuVisible.setValue(!t.overflowMenuVisible.getValue())}),TDB.EventPropagation.Bypass},e.prototype.getMenuItems=function(e){return this.ensureMenuItems(e),this.orderMenuItemsByPriority(e).map(function(e){return e.menuItem})},e.prototype.getOverflowItemArgs=function(e){return this.ensureMenuItems(e),this.orderMenuItemsByDom(e).map(function(e){return e.overflowArgs})},e.prototype.getMenuChildrenArgs=function(e){return this.ensureMenuItems(e),this.orderMenuItemsByDom(e).map(function(e){return e.menuItem.getPrimaryArgs()})},e.prototype.getOverflowButtonWidth=function(){if(void 0===this._overflowButtonWidth){if(!this._overflowButton)return 0;this._overflowButtonWidth=$(this._overflowButton.findFirstNode()).outerWidth(!0)}return this._overflowButtonWidth},e.prototype.getOverflowButtonVisible=function(){return this.calculateOverflowButtonVisible()},e.prototype.predictOverflowButtonVisible=function(e){return this._numOverflowElementsVisible+e>0},e.prototype.calculateOverflowButtonVisible=function(e){var t=!1;this._numOverflowElementsVisible=0,this.ensureMenuItems(e);for(var n in this.menuItems){var o=this.menuItems[n].menuItem;o.getViewElementVisible(e)&&o.state.getWatchedValue(e)==i.MenuItemState.Overflow&&(this._numOverflowElementsVisible++,t=!0)}return t},e.prototype.overflowActive=function(e){return this.overflowMenuVisible.getWatchedValue(e)},e.prototype.addMenuItemIfValid=function(e,t){void 0!==this.menuItems[e]&&t.push(this.menuItems[e])},e.OverflowButtonClass="CardMenuOverflowButton",e.OverflowButtonTextClass="CardMenuContentButtonTextOverflow",e}();t.CardMenuChunk=r}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t,n){var o=e.call(this,t)||this;return o.model=n,o}return __extends(t,e),t.prototype.menuItemsArgs=function(e){return this.model.getMenuChildrenArgs(e)},t.prototype.overflowButtonArgs=function(){return this.model.overflowButtonArgs()},t.prototype.overflowMenuArgs=function(){return this.model.overflowMenuArgs()},t.prototype.ifOverflowWrapperArgs=function(e){return this.model.calculateOverflowButtonVisible(e)},t}(TDB.FocusableViewElement);e.CardContentControlsVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n,o=e.Model.SM,i=e.Model.AuthoringModel,r=e.View.ViewElements;!function(e){e[e.Header=0]="Header",e[e.Emphasis=1]="Emphasis",e[e.Special=2]="Special",e[e.Bullets=3]="Bullets",e[e.Numbers=4]="Numbers",e[e.Link=5]="Link",e[e.LeftToRight=6]="LeftToRight",e[e.RightToLeft=7]="RightToLeft"}(n=t.CardContentMenuItemId||(t.CardContentMenuItemId={}));var a=function(a){function s(e){var t=a.call(this)||this;return t.args=e,t}return __extends(s,a),s.prototype.singleLineOnly=function(){var e=this.args.card.getViewModel().getModel();return!i.TextController.supportsMultiline(e)},s.prototype.getOverflowButtonId=function(){return ClientAction.ButtonId.CardToolbar_Overflow},s.prototype.overflowButtonCssClass=function(e){return"ms-rte-ui CardMenuContentButton CardMenuTextButtonNoText "},s.prototype.ensureMenuItems=function(e){this.ensureHeaderButton(),this.ensureEmphasisButton(),this.ensureSpecialButton(),this.ensureBulletsButton(),this.ensureNumbersButton(),this.ensureLinkButton(),this.args.textDirectionButtonsVisible.getWatchedValue(e)&&(this.ensureDirectionButton(!1),this.ensureDirectionButton(!0))},s.prototype.shouldShowControls=function(e){var t=this.args.card.menuVisible(e),n=this.args.card.getViewModel().hasSockets()&&this.args.card.isExpanded(e),o=this.args.card.getViewModel().inTeaserMode(e);return t&&!n&&!o},s.prototype.orderMenuItemsByDom=function(e){if(!this.shouldShowControls(e))return[];var t=[];return this.addMenuItemIfValid(n.Header,t),this.addMenuItemIfValid(n.Emphasis,t),this.addMenuItemIfValid(n.Special,t),this.addMenuItemIfValid(n.Bullets,t),this.addMenuItemIfValid(n.Numbers,t),this.addMenuItemIfValid(n.Link,t),this.args.textDirectionButtonsVisible.getWatchedValue(e)&&(this.addMenuItemIfValid(n.LeftToRight,t),this.addMenuItemIfValid(n.RightToLeft,t)),t},s.prototype.orderMenuItemsByPriority=function(e){return this.orderMenuItemsByDom(e)},s.prototype.ensureHeaderButton=function(){if(void 0===this.menuItems[n.Header]){var e={buttonId:ClientAction.ButtonId.CardToolbar_Heading,click:this.headerButtonClicked,context:this,cssClass:{value:this.getButtonClass()},description:{value:Resources.CardDeckMenuHeaderLabel},tooltip:{value:Resources.CardDeckMenuHeaderDescription},fontIconName:{value:FontIcons.CardDeckMenuHeaderIcon},fontIconSizeClass:FontIcons.CardDeckMenuHeaderIconSize,shortcutIdentifiers:["Ctrl+Alt+OneKey"],text:{value:Resources.CardDeckMenuHeaderLabel},textClass:this.getButtonTextClass()};this.createMenuItem(n.Header,VE.GlyphButtonVE,e,this.headerButtonVisible)}},s.prototype.ensureLinkButton=function(){if(void 0===this.menuItems[n.Link]&&StoryPageEditSettings.AuthoringNewFeaturesEnabled){var e={buttonId:ClientAction.ButtonId.CardToolbar_Link,calculateChecked:this.isLinkButtonSelected,click:this.linkButtonClicked,context:this,cssClass:{value:this.getButtonClass()},description:{value:Resources.CardDeckMenuLinkLabel},tooltip:{value:Resources.CardDeckMenuLinkDescription},fontIconArgs:{value:{fontIconName:{value:FontIcons.CardDeckMenuLinkIcon},fontIconSizeClass:FontIcons.CardDeckMenuLinkIconSize,fontIconWrapperClass:{value:"CardMenuFontIcon"}}},shortcutIdentifiers:["Ctrl+KKey","Meta+KKey"],textElementText:{value:Resources.CardDeckMenuLinkLabel},textClass:this.getButtonTextClass()};this.createMenuItem(n.Link,VE.ToggleButtonVE,e,this.linkButtonVisible)}},s.prototype.ensureEmphasisButton=function(){if(void 0===this.menuItems[n.Emphasis]){var e={buttonId:ClientAction.ButtonId.CardToolbar_Emphasis,calculateChecked:this.isEmphasisButtonSelected,click:this.emphasisButtonClicked,context:this,cssClass:{value:this.getButtonClass()},description:{value:Resources.CardDeckMenuEmphasizeTextLabel},tooltip:{value:Resources.CardDeckMenuEmphasizeTextDescription},glyphIconTextClass:"CardDeckMenuEmphasize",shortcutIdentifiers:["Ctrl+BKey","Meta+BKey"],textElementText:{value:Resources.CardDeckMenuEmphasisLabel},textClass:this.getButtonTextClass(),useGlyphIconText:!0};this.createMenuItem(n.Emphasis,VE.ToggleButtonVE,e,this.emphasisButtonVisible)}},s.prototype.ensureSpecialButton=function(){if(void 0===this.menuItems[n.Special]&&StoryPageEditSettings.SpecialTextEnabled){var e={buttonId:ClientAction.ButtonId.CardToolbar_Special,calculateChecked:this.isSpecialButtonSelected,click:this.specialButtonClicked,context:this,cssClass:{value:this.getButtonClass()},description:{value:Resources.CardDeckMenuAccentLabel},tooltip:{value:Resources.CardDeckMenuAccentDescription},glyphIconTextClass:"CardDeckMenuSpecial",shortcutIdentifiers:["Ctrl+IKey","Meta+IKey"],textElementText:{value:Resources.CardDeckMenuSpecialLabel},textClass:this.getButtonTextClass(),useGlyphIconText:!0};this.createMenuItem(n.Special,VE.ToggleButtonVE,e,this.specialButtonVisible)}},s.prototype.ensureBulletsButton=function(){if(void 0===this.menuItems[n.Bullets]){var e={attributes:{value:{unselectable:"on"}},buttonId:ClientAction.ButtonId.CardToolbar_Bullets,calculateChecked:this.isBulletsButtonSelected,click:this.bulletsButtonClicked,context:this,cssClass:{value:this.getButtonClass()},description:{value:Resources.CardDeckMenuBulletsLabel},tooltip:{value:Resources.CardDeckMenuBulletsDescription},fontIconArgs:{value:{fontIconName:{value:CommonSettings.SiteUiRtl?FontIcons.CardDeckMenuBulletsRtlIcon:FontIcons.CardDeckMenuBulletsIcon},fontIconSizeClass:FontIcons.CardDeckMenuBulletsIconSize,fontIconWrapperClass:{value:"CardMenuFontIcon"}}},shortcutIdentifiers:["Ctrl+PeriodKey","Meta+PeriodKey"],textElementText:{value:Resources.CardDeckMenuBulletsLabel},textClass:this.getButtonTextClass()};this.createMenuItem(n.Bullets,VE.ToggleButtonVE,e,this.bulletsButtonVisible)}},s.prototype.ensureNumbersButton=function(){if(void 0===this.menuItems[n.Numbers]){var e={attributes:{value:{unselectable:"on"}},buttonId:ClientAction.ButtonId.CardToolbar_Numbers,calculateChecked:this.isNumbersButtonSelected,click:this.numbersButtonClicked,context:this,cssClass:{value:this.getButtonClass()},description:{value:Resources.CardDeckMenuNumbersLabel},tooltip:{value:Resources.CardDeckMenuNumbersDescription},fontIconArgs:{value:{fontIconName:{value:CommonSettings.SiteUiRtl?FontIcons.CardDeckMenuNumbersRtlIcon:FontIcons.CardDeckMenuNumbersIcon},fontIconSizeClass:FontIcons.CardDeckMenuNumbersIconSize,fontIconWrapperClass:{value:"CardMenuFontIcon"}}},shortcutIdentifiers:["Ctrl+SlashKey","Meta+SlashKey"],textElementText:{value:Resources.CardDeckMenuNumbersLabel},textClass:this.getButtonTextClass()};this.createMenuItem(n.Numbers,VE.ToggleButtonVE,e,this.numbersButtonVisible)}},s.prototype.ensureDirectionButton=function(e){var t=this,i=e?o.TextDirection.RightToLeft:o.TextDirection.LeftToRight;if(void 0===this.menuItems[e?n.RightToLeft:n.LeftToRight]){var r={buttonId:e?ClientAction.ButtonId.CardToolbar_RightToLeft:ClientAction.ButtonId.CardToolbar_LeftToRight,calculateChecked:function(e){return t.isDirectionButtonSelected(i,e)},click:function(n){return t.directionButtonClicked(e,n)},context:this,cssClass:{value:this.getButtonClass()},shortcutIdentifiers:["Ctrl+Shift+"+(e?"Right":"Left")+"+ShiftKey"],description:{value:e?Resources.CardDeckMenuRightToLeftLabel:Resources.CardDeckMenuLeftToRightLabel},fontIconArgs:{value:{fontIconName:{value:e?FontIcons.CardDeckMenuRightToLeftIcon:FontIcons.CardDeckMenuLeftToRightIcon},fontIconSizeClass:e?FontIcons.CardDeckMenuRightToLeftIconSize:FontIcons.CardDeckMenuLeftToRightIconSize,fontIconWrapperClass:{value:"CardMenuFontIcon"}}},textClass:this.getButtonTextClass()};this.createMenuItem(e?n.RightToLeft:n.LeftToRight,VE.ToggleButtonVE,r,this.directionButtonsVisible)}},s.prototype.headerButtonVisible=function(e){return!this.args.card.cardParent.isPopup&&this.getCurrentTextAbilities(e).header},s.prototype.linkButtonVisible=function(e){return this.getCurrentTextAbilities(e).link},s.prototype.emphasisButtonVisible=function(e){return this.getCurrentTextAbilities(e).emphasis},s.prototype.specialButtonVisible=function(e){return this.getCurrentTextAbilities(e).special},s.prototype.bulletsButtonVisible=function(e){return this.getCurrentTextAbilities(e).bullets},s.prototype.numbersButtonVisible=function(e){return this.getCurrentTextAbilities(e).numbers},s.prototype.directionButtonsVisible=function(e){return this.getCurrentTextAbilities(e).direction},s.prototype.hasVisibleElements=function(e){for(var t=0,n=this.getMenuItems(e);t<n.length;t++)if(n[t].getViewElementVisible(e))return!0;return!1},s.prototype.headerButtonClicked=function(n){var r=this,a=this.args.card.getViewModel().getModel();ActionLogger.RecordClientAction(new ClientAction.ConvertTextToHeadingActionData(ClientAction.ActionType.Storyline_ConvertTextToHeading,"User is trying to convert a text card into a heading card",i.currentStoryController().get(this.args.pageId).getChildsDepth(a)));var s=TDB.ViewElement.dataFor(this.args.card.getTextEditorElement());this.hideOverflowMenu(),TextEditor.Cursor.cursorRangeIsNowOutdated();var l=TextEditor.Cursor.get_Range();if(!this.rangeIsValid(l)&&(s.setFocusToEnd(),l=TextEditor.Cursor.get_Range(),!this.rangeIsValid(l)))return TDB.EventPropagation.Bypass;var c;return e.Model.currentUndoManager().get(this.args.pageId).captureUserAction(function(){TDB.applyUpdate(function(){r.removeList(l),s.commit();var e=i.currentHeaderController().get(r.args.pageId),n=t.TextHelperMethods.splitParagraphs(l.get_startMarker(),l.get_endMarker(),r.args.pageId);null==n?c=e.transform([a]):n.forEach(function(t,n,i){t instanceof o.Paragraph&&0!==t.getContent().getText().length&&(c=e.transform([t]))})})},"User created a header card"),TextEditor.Cursor.updateRangeToCurrentSelection(),c&&this.args.cardsContainer.getCardForModelId(c.id).setFocusToText(!0),TDB.EventPropagation.PreventDefault},s.prototype.linkButtonClicked=function(e){var t=this;return this.args.card.linkButtonClicked()?TDB.EventPropagation.PreventDefault:(this.args.resourceFactory.loadResource(19).then(function(){t.hideOverflowMenu(),t.ensureCursorValid(),r.TextLinkDialog.createAndShow(t.args.card.cardParent.isPopup,t.args.pageId)}),TDB.EventPropagation.PreventDefault)},s.prototype.emphasisButtonClicked=function(e){var n=this;return this.args.resourceFactory.loadResource(19).then(function(){n.hideOverflowMenu(),n.ensureCursorValid(),t.TextHelperMethods.updateTextStyle(t.TextFormatType.Emphasis,n.args.card.cardParent.isPopup,n.singleLineOnly(),n.args.pageId)}),TDB.EventPropagation.PreventDefault},s.prototype.specialButtonClicked=function(e){var n=this;return this.args.resourceFactory.loadResource(19).then(function(){n.hideOverflowMenu(),n.ensureCursorValid(),t.TextHelperMethods.updateTextStyle(t.TextFormatType.Special,n.args.card.cardParent.isPopup,n.singleLineOnly(),n.args.pageId)}),TDB.EventPropagation.PreventDefault},s.prototype.addBulletedList=function(){var n=this;return this.hideOverflowMenu(),e.Model.currentUndoManager().get(this.args.pageId).captureUserUpdate(function(){return{activeModelObjectIds:[r.CommonTextVE.commit()]}},"commit text before user update text format operation",!0),e.Model.currentUndoManager().get(this.args.pageId).captureUserUpdate(function(){TextEditor.Cursor.updateRangeToCurrentSelection(),TextEditor.Cursor.update();var e=TextEditor.Cursor.get_Range();return n.rangeIsValid(e)&&(t.TextHelperMethods.logTextAction(ClientAction.ActionType.Storyline_Text_Bullets,"User added bullets",n.args.card.cardParent.isPopup),TextEditor.Cursor.bulletedList(),t.TextFormatter.formatElement(t.TextHelperMethods.currentEditableRegion(),{isSingleLine:n.singleLineOnly()},!1),t.TextHelperMethods.moveCursorForListCreation(e),e.clear()),{activeModelObjectIds:[r.CommonTextVE.commit()]}},"User pressed bullets button"),TDB.EventPropagation.PreventDefault},s.prototype.bulletsButtonClicked=function(e){return this.hideOverflowMenu(),this.ensureCursorValid(),TextEditor.Cursor.isInBulletedList()?this.removeListItems():this.addBulletedList()},s.prototype.addNumberedList=function(){var n=this;return this.hideOverflowMenu(),e.Model.currentUndoManager().get(this.args.pageId).captureUserUpdate(function(){return{activeModelObjectIds:[r.CommonTextVE.commit()]}},"commit text before user update text format operation",!0),e.Model.currentUndoManager().get(this.args.pageId).captureUserUpdate(function(){TextEditor.Cursor.updateRangeToCurrentSelection(),TextEditor.Cursor.update();var e=TextEditor.Cursor.get_Range();return n.rangeIsValid(e)&&(t.TextHelperMethods.logTextAction(ClientAction.ActionType.Storyline_Text_Numbers,"User added numbered list",n.args.card.cardParent.isPopup),TextEditor.Cursor.numberedList(),t.TextFormatter.formatElement(t.TextHelperMethods.currentEditableRegion(),{isSingleLine:n.singleLineOnly()},!1),t.TextHelperMethods.moveCursorForListCreation(e),e.clear()),{activeModelObjectIds:[r.CommonTextVE.commit()]}},"User pressed numbered list button"),TDB.EventPropagation.PreventDefault},s.prototype.numbersButtonClicked=function(e){return this.hideOverflowMenu(),this.ensureCursorValid(),TextEditor.Cursor.isInNumberList()?this.removeListItems():this.addNumberedList()},s.prototype.directionButtonClicked=function(e,n){return this.hideOverflowMenu(),this.ensureCursorValid(),t.TextHelperMethods.updateParagraphDirection(!e,this.singleLineOnly(),this.args.pageId),TDB.EventPropagation.PreventDefault},s.prototype.removeListItems=function(){var n=this;return e.Model.currentUndoManager().get(this.args.pageId).captureUserUpdate(function(){TextEditor.Cursor.updateRangeToCurrentSelection(),TextEditor.Cursor.update();var e=TextEditor.Cursor.get_Range();return t.TextHelperMethods.logTextAction(ClientAction.ActionType.Storyline_Text_RemoveListItems,"User removed list items",n.args.card.cardParent.isPopup,e),n.removeList(e),{activeModelObjectIds:[r.CommonTextVE.commit()]}},"user removed list items"),TDB.EventPropagation.PreventDefault},s.prototype.getCurrentTextAbilities=function(e){if(this.showCardContentControls(e)){var t=this.args.card.getPrimaryTextViewModel(e);if(t)return t.abilities}return{header:!1,emphasis:!1,special:!1,link:!1,bullets:!1,numbers:!1,direction:!1}},s.prototype.showCardContentControls=function(e){return!this.args.cardSelectionManager.isInMultiselectMode(e)},s.prototype.isLinkButtonSelected=function(e){var n=this.getSelectionNotifier();if(n){e.watch(n);var o=window.getSelection().anchorNode;if(o)return this.args.card.getPrimaryInputElement().domElement===TextEditor.Canvas.currentEditableRegion()&&t.TextHelperMethods.elementInLink(o)}return!1},s.prototype.isEmphasisButtonSelected=function(e){var n=this.getSelectionNotifier();if(n){e.watch(n);var o=window.getSelection().anchorNode;if(o)return this.args.card.getPrimaryInputElement().domElement===TextEditor.Canvas.currentEditableRegion()&&t.TextHelperMethods.elementInTag(o,TextEditor.HtmlTagNameUppercase.STRONG)}return!1},s.prototype.isSpecialButtonSelected=function(e){var n=this.getSelectionNotifier();if(n){e.watch(n);var o=window.getSelection().anchorNode;if(o)return this.args.card.getPrimaryInputElement().domElement===TextEditor.Canvas.currentEditableRegion()&&t.TextHelperMethods.elementInTag(o,TextEditor.HtmlTagNameUppercase.EM)}return!1},s.prototype.isNumbersButtonSelected=function(e){var n=this.getSelectionNotifier();if(n){e.watch(n);var o=window.getSelection().anchorNode;if(o)return this.args.card.getPrimaryInputElement().domElement===TextEditor.Canvas.currentEditableRegion()&&t.TextHelperMethods.elementInTag(o,TextEditor.HtmlTagNameUppercase.OL)}return!1},s.prototype.isBulletsButtonSelected=function(e){var n=this.getSelectionNotifier();if(n){e.watch(n);var o=window.getSelection().anchorNode;if(o)return this.args.card.getPrimaryInputElement().domElement===TextEditor.Canvas.currentEditableRegion()&&t.TextHelperMethods.elementInTag(o,TextEditor.HtmlTagNameUppercase.UL)}return!1},s.prototype.isDirectionButtonSelected=function(t,n){var o=this.getSelectionNotifier();return!!o&&(n.watch(o),TextEditor.Cursor.queryDirection(e.Model.StoryModel.traversalModel.getRTL(n))===t)},s.prototype.getSelectionNotifier=function(){return this.args.card.getSelectionNotifier()},s.prototype.getButtonClass=function(){return"ms-rte-ui CardMenuContentButton"},s.prototype.getButtonTextClass=function(){return"CardMenuContentButtonText"},s.prototype.ensureCursorValid=function(){var e=this.args.card.getTextEditorElement();if(e){var t=TextEditor.Cursor.get_Range();if(this.rangeIsValid(t))return;e.focus()}},s.prototype.rangeIsValid=function(e){return!(!e||!e.isValid())&&this.args.card.hasRTECursor()},s.prototype.removeList=function(e){if(e&&e.isValid()){for(var n=0;n<i.StoryController.getMaxListDepth();n++)TextEditor.Cursor.decreaseIndent();t.TextFormatter.formatElement(this.args.card.getTextEditorElement())}},s.prototype.getButton=function(e){var t=this.menuItems[e];return t&&t.menuItem.getViewElement()},s}(t.CardMenuChunk);t.CardContentControlsViewModel=a}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t,n){var o=e.call(this,t)||this;return o.model=n,o}return __extends(t,e),t.prototype.menuItemsArgs=function(e){return this.model.getMenuChildrenArgs(e)},t.prototype.deleteButtonArgs=function(e){return this.model.deleteButtonArgs(e)},t.prototype.overflowButtonArgs=function(){return this.model.overflowButtonArgs()},t.prototype.overflowMenuArgs=function(){return this.model.overflowMenuArgs()},t.prototype.ifOverflowWrapperArgs=function(e){return this.model.calculateOverflowButtonVisible(e)},t}(TDB.FocusableViewElement);e.CardControlsVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n,o=e.Model.SM,i=e.Model.AuthoringModel,r=StoryApp.View.ViewElements,a=e.View.ViewElements;!function(e){e[e.Group=0]="Group",e[e.GroupType=1]="GroupType",e[e.Ungroup=2]="Ungroup",e[e.Focus=3]="Focus",e[e.Delete=4]="Delete",e[e.Emphasis=5]="Emphasis",e[e.Decorative=6]="Decorative",e[e.Record=7]="Record"}(n=t.CardMenuItemId||(t.CardMenuItemId={}));var s=function(s){function l(e){var t=s.call(this)||this;return t.args=e,t}return __extends(l,s),l.prototype.ensureMenuItems=function(e){this.ensureGroupButton(e),this.ensureGroupTypeButton(e),this.ensureUngroupButton(e),this.ensureFocusButton(e),this.ensureDecorativeButton(e),this.ensureDeleteButton(e),this.ensureRecordButton(e),this.ensureEmphasisButtons(e)},l.prototype.orderMenuItemsByDom=function(e){var t=[];return this.addMenuItemIfValid(n.Group,t),this.addMenuItemIfValid(n.GroupType,t),this.addMenuItemIfValid(n.Ungroup,t),this.addMenuItemIfValid(n.Focus,t),this.addMenuItemIfValid(n.Emphasis,t),this.addMenuItemIfValid(n.Decorative,t),this.addMenuItemIfValid(n.Record,t),t},l.prototype.deleteButtonArgs=function(e){return this.ensureDeleteButton(e),this.args.card.getViewModel().inTeaserMode(e)?this.getDeleteTeaserButton(e):void 0!==this.menuItems[n.Delete]?this.menuItems[n.Delete].menuItem.getPrimaryArgs():null},l.prototype.orderMenuItemsByPriority=function(e){var t=[];return this.addMenuItemIfValid(n.Group,t),this.addMenuItemIfValid(n.Emphasis,t),this.addMenuItemIfValid(n.Focus,t),this.addMenuItemIfValid(n.GroupType,t),this.addMenuItemIfValid(n.Ungroup,t),this.addMenuItemIfValid(n.Delete,t),this.addMenuItemIfValid(n.Decorative,t),this.addMenuItemIfValid(n.Record,t),t},l.prototype.ensureDeleteButton=function(e){var t=this.deleteVisible(e);if(!this.args.card.getViewModel().inTeaserMode(e)&&void 0===this.menuItems[n.Delete]&&t){var o=this.args.card.getViewModel().getStorylineDescription(e),i=ResourceManager.ResolveString(Resources.CardDeckContextMenuDeleteLabel,[o]),a={buttonId:ClientAction.ButtonId.CardAction_Delete,click:this.deleteClicked,context:this,cssClass:{compute:new TDB.ComputedOptionArgs(this,this.deleteButtonCssClass)},description:{value:i},tooltip:{value:Resources.CardDeckContextMenuDeleteDescription},fontIconName:{value:FontIcons.CardMenuDeleteIcon},fontIconWrapperClass:{value:"DeleteButtonFontIconWrapper"},fontIconSizeClass:FontIcons.CardMenuDeleteIconSize,shortcutIdentifiers:["DeleteKey"]};this.menuItems[n.Delete]={menuItem:new r.HideableMenuItem({stateMap:r.MenuItem.createStaticElementStateMap(),primaryType:r.GlyphButtonVE,primaryArgs:a,viewElementVisible:{compute:new TDB.ComputedOptionArgs(this,this.deleteVisible)}})}}},l.prototype.getDeleteTeaserButton=function(e){var t,n=this.deleteVisible(e);if(this.args.card.getViewModel().inTeaserMode(e)&&n)return t={buttonId:ClientAction.ButtonId.CardAction_Delete,click:this.deleteClicked,context:this,cssClass:{value:"DeleteTeaserImageButton"},description:{value:Resources.CardDeckContextMenuDeleteBackgroundImageLabel},fontIconName:{value:FontIcons.CardMenuDeleteIcon},fontIconSizeClass:FontIcons.CardMenuDeleteIconSize,fontIconWrapperClass:{value:"DeleteTeaserImageButtonFontIconWrapper"},shortcutIdentifiers:["DeleteKey","BackspaceKey"],visible:{compute:new TDB.ComputedOptionArgs(this,this.deleteVisible)}},new TDB.ChildArgs(r.GlyphButtonVE,t)},l.prototype.ensureGroupButton=function(e){if(void 0===this.menuItems[n.Group]){var t={attributes:{value:{unselectable:"on"}},buttonId:ClientAction.ButtonId.CardAction_Group,click:this.groupClicked,context:this,description:{value:Resources.CardDeckContextMenuGroupLabel},fontIconName:{value:FontIcons.CardMenuGroupIcon},fontIconSizeClass:FontIcons.CardMenuGroupIconSize,shortcutIdentifiers:["Ctrl+GKey","Meta+GKey"],text:{value:Resources.CardDeckContextMenuGroupLabel},textClass:this.getButtonTextClass()};this.createMenuItem(n.Group,r.GlyphButtonVE,t,this.groupVisible)}},l.prototype.ensureGroupTypeButton=function(e){if(void 0===this.menuItems[n.GroupType]){var t={attributes:{value:{unselectable:"on"}},buttonId:ClientAction.ButtonId.CardAction_GroupType,click:this.groupTypeClicked,context:this,description:{value:Resources.CardDeckContextMenuGroupTypeLabel},tooltip:{value:Resources.CardDeckContextMenuGroupTypeDescription},fontIconName:{value:FontIcons.CardMenuGroupTypeIcon},fontIconSizeClass:FontIcons.CardMenuGroupTypeIconSize,text:{value:Resources.CardDeckContextMenuGroupTypeLabel},textClass:this.getButtonTextClass()};this.createMenuItem(n.GroupType,r.GlyphButtonVE,t,this.groupTypeVisible)}},l.prototype.ensureUngroupButton=function(e){if(void 0===this.menuItems[n.Ungroup]){var t={attributes:{value:{unselectable:"on"}},buttonId:ClientAction.ButtonId.CardAction_UnGroup,click:this.ungroupClicked,context:this,description:{value:Resources.TransformExplode},fontIconName:{value:FontIcons.CardMenuUngroupIcon},fontIconSizeClass:FontIcons.CardMenuUngroupIconSize,shortcutIdentifiers:["Ctrl+Shift+GKey","Meta+Shift+GKey"],text:{value:Resources.TransformExplode},textClass:this.getButtonTextClass()};this.createMenuItem(n.Ungroup,r.GlyphButtonVE,t,this.ungroupVisible)}},l.prototype.ensureEmphasisButtons=function(e){var t=this.args.card.menuVisible(e);void 0===this.menuItems[n.Emphasis]&&!this.args.card.isHostedInPopup()&&t&&(this.menuItems[n.Emphasis]={menuItem:new r.CollapsibleMenuItem({stateMap:r.MenuItem.createAlwaysVisibleButtonStateMap(),viewElementVisible:{compute:new TDB.ComputedOptionArgs(this,this.emphasisHintsVisible)},primaryType:a.EmphasisButtonsVE,primaryArgs:{cardSelectionManager:this.args.cardSelectionManager,cardsContainer:this.args.cardsContainer}})})},l.prototype.getButton=function(e){var t=this.menuItems[e];return t&&t.menuItem.getViewElement()},l.prototype.ensureFocusButton=function(e){var t=this.args.card.menuVisible(e);if(void 0===this.menuItems[n.Focus]&&t){var o={attributes:{value:{unselectable:"on"}},buttonId:ClientAction.ButtonId.CardToolbar_Focus,click:this.focusButtonClicked,context:this,description:{value:Resources.CardDeckMenuFocusLabel},tooltip:{value:Resources.CardDeckMenuFocusDescription},fontIconName:{value:FontIcons.CardMenuFocusIcon},fontIconSizeClass:FontIcons.CardMenuFocusIconSize,text:{value:Resources.CardDeckMenuFocusLabel},textClass:this.getButtonTextClass()};this.createMenuItem(n.Focus,r.GlyphButtonVE,o,this.focusButtonVisible)}},l.prototype.ensureDecorativeButton=function(e){var t=this.args.card.menuVisible(e);if(void 0===this.menuItems[n.Decorative]&&t){var o={buttonId:ClientAction.ButtonId.CardAction_Decorative,context:this,cssClass:{value:this.buttonCssClass(e)},calculateChecked:this.isDecorativeChecked,click:this.decorativeButtonClicked,textElementText:{value:Resources.DecorativeSocketButtonText},tooltip:{value:Resources.DecorativeSocketButtonDescription}};this.menuItems[n.Decorative]={menuItem:new r.HideableMenuItem({stateMap:r.MenuItem.createStaticElementStateMap(),primaryType:r.ToggleButtonVE,primaryArgs:o,viewElementVisible:{compute:new TDB.ComputedOptionArgs(this,this.decorativeButtonVisible)}})}}},l.prototype.isDecorativeChecked=function(e){return this.args.card.getViewModel().getDecorative(e)},l.prototype.ensureRecordButton=function(e){var t=this.args.card.menuVisible(e);if(void 0===this.menuItems[n.Record]&&t){var o={attributes:{value:{unselectable:"on"}},buttonId:ClientAction.ButtonId.CardToolbar_AudioRecord,click:this.recordButtonClicked,context:this,description:{value:Resources.CardDeckMenuAudioRecordLabel},fontIconName:{value:FontIcons.CardMenuAudioRecordIcon},fontIconSizeClass:FontIcons.CardMenuAudioRecordIconSize,text:{value:Resources.CardDeckMenuAudioRecordLabel},textClass:this.getButtonTextClass()};this.createMenuItem(n.Record,r.GlyphButtonVE,o,this.recordButtonVisible)}},l.prototype.createMenuItem=function(e,t,n,o){return n.cssClass={compute:new TDB.ComputedOptionArgs(this,this.buttonCssClass)},s.prototype.createMenuItem.call(this,e,t,n,o)},l.prototype.deleteButtonCssClass=function(e){return this.commonButtonCssClass(e,"CardMenuDeleteButtonDynamicLight","CardMenuDeleteButtonDynamicDark","CardMenuDeleteButtonExpandedGroup","CardMenuDeleteButtonCollapsedGroup")},l.prototype.buttonCssClass=function(e){return this.commonButtonCssClass(e,"CardMenuButtonDynamicLight","CardMenuButtonDynamicDark","CardMenuButtonExpandedGroup","CardMenuButtonCollapsedGroup")},l.prototype.commonButtonCssClass=function(e,t,n,o,i){return this.args.cardSelectionManager.isInMultiselectMode(e)&&this.args.card.menuVisible(e)?n:a.CardMenuVE.useExpandedGroupClass(e,this.args.card)?o:a.CardMenuVE.useCollapsedGroupClass(e,this.args.card)?i:t},l.prototype.deleteVisible=function(e){return this.getVisibleBasedOnCardAction(t.CardAction.Remove,e)},l.prototype.focusButtonVisible=function(e){if(!StoryPageEditSettings.SmartFocusUIEnabled)return!1;var n=this.getVisibleBasedOnCardAction(t.CardAction.Focus,e,1)&&this.getCurrentCardControls(e).focus;return n&&!CommonSettings.SkipLoggingNonEssentialHighVolumeClientLogs&&StoryLog.TraceTag(596473670,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Focus button visible"),n},l.prototype.recordButtonVisible=function(e){return!StoryPageEditSettings.BlockAuthoring_Recording&&(this.getVisibleBasedOnCardAction(t.CardAction.Record,e,1)&&this.getCurrentCardControls(e).record)},l.prototype.decorativeButtonVisible=function(e){return this.getVisibleBasedOnCardAction(t.CardAction.Decorative,e)&&this.getCurrentCardControls(e).decorative},l.prototype.decorativeButtonClicked=function(e){var t=this.args.card.getViewModel();return t.setDecorative(!t.getDecorative()),TDB.EventPropagation.Bypass},l.prototype.recordButtonClicked=function(e){return this.args.card.recordButtonClicked()?TDB.EventPropagation.PreventDefault:(this.args.card.setRecordingDialogVisibility(!0),TDB.EventPropagation.Bypass)},l.prototype.getVisibleBasedOnCardAction=function(e,t,n){if(!this.args.card.menuVisible(t))return!1;var o=this.args.card.getViewModel().canTakeAction(e,t),i=this.args.cardSelectionManager.getSelection(t),r=i.length,s=this.args.cardsContainer.getActiveCard(t),l=0===r&&s instanceof a.ComplexHeadingCardVE&&s.backgroundCardArgs(t)&&s.backgroundCard===this.args.card;if(0===r||!o||l)return o;if(r>n)return!1;for(var c=0;c<r;c++)if(!i[c].getViewModel().canTakeAction(e,t))return!1;return!0},l.prototype.groupVisible=function(e){if(!this.args.card.menuVisible(e))return!1;var t=this.args.cardsContainer.getModelForActiveContent(e);return a.GroupAction.isAvailable(t,this.args.pageId)&&this.getCurrentCardControls(e).group},l.prototype.groupTypeVisible=function(e){if(!this.args.card.menuVisible(e))return!1;var t=this.args.cardsContainer.getModelForActiveContent(e);return a.ShowGroupTypePaneAction.isAvailable(t,this.args.transformManager)&&this.getCurrentCardControls(e).groupType},l.prototype.ungroupVisible=function(e){if(!this.args.card.menuVisible(e))return!1;var t=this.args.cardsContainer.getModelForActiveContent(e);return a.SeparateAction.isAvailable(t,this.args.pageId,e)&&this.getCurrentCardControls(e).ungroup},l.prototype.emphasisHintsVisible=function(e){if(!this.args.card.menuVisible(e))return!1;var t=this.args.cardsContainer.getModelForActiveContent(e);return a.SetEmphasisAction.isAvailable(t,this.args.pageId,e)&&this.getCurrentCardControls(e).emphasis},l.prototype.deleteClicked=function(t){var n=this;this.hideOverflowMenu();var o=this.args.cardSelectionManager.getSelection(),i=[];this.logCardActionData(ClientAction.ActionType.Storyline_Delete,"User deleted item(s)"),e.Model.currentUndoManager().get(this.args.pageId).captureUserUpdate(function(){if(o.length>1){i=n.getNegatedActions(o);for(var e=0;e<o.length;e++)n.logDeletedCardDIStatistics(o[e]),o[e].remove("Delete card button clicked")}else n.logDeletedCardDIStatistics(n.args.card),i=n.getNegatedActions([n.args.card]),n.args.card.remove("Delete card button clicked")},"User deleted a card");for(var r=0;r<i.length;r++){var a=new ClientAction.ActionNegatedByDelete(i[r]);ActionLogger.RecordClientAction(a)}return TDB.EventPropagation.PreventDefault},l.prototype.getNegatedActions=function(t){var n=e.Model.currentUndoManager().get(this.args.pageId).getLastUndoContext();if(n&&n.activeModelObjectIds){for(var o=!0,i=0;i<t.length&&"break"!==function(e){if(0===n.activeModelObjectIds.filter(function(n){return n===t[e].getViewModel().getModel().id}).length)return o=!1,"break"}(i);i++);if(o)return e.Model.currentUndoManager().get(this.args.pageId).getLastLoggedActionTypes()}return[]},l.prototype.logDeletedCardDIStatistics=function(t){var n=0,r=0,s=[],l=0,c=0,d=0,u=0,p=0,g=0;if(t instanceof a.TextCardVE)n=this.getNumberOfDIParagraphs(t.getViewModel().getModel());else if(t instanceof a.ImageCardVE&&t.getViewModel().getModel().getContentSource()===e.Model.SM.ContentCreator.DocumentIngestion)s.push(t.getViewModel().getModel().getMedia());else if(t instanceof a.GroupCardVE){for(var h=t,C=h.getViewModel().getChildren(),f=0;f<C.length;f++)C[f]instanceof o.TextGroup?n+=this.getNumberOfDIParagraphs(C[f]):C[f]instanceof o.MediaWithTextComposite&&i.ObjectController.modelIsImage(C[f])&&C[f].getContentSource()===e.Model.SM.ContentCreator.DocumentIngestion&&s.push(C[f].getMedia());void 0!==h.getViewModel().getHeading()&&(r=this.getNumberOfDIHeadings(h.getViewModel().getHeading()))}else t instanceof a.ComplexHeadingCardVE&&(r=this.getNumberOfDIHeadings(t.getViewModel().getModel()));for(f=0;f<s.length;f++)if(s[f]instanceof o.ImageContent)for(var m=s[f].imageParts.getCollection(),y=0;y<m.length;y++)g++,m[y].getSemantic()==o.ImageSemantic.Chart?l++:m[y].getSemantic()==o.ImageSemantic.SmartArt?c++:m[y].getSemantic()==o.ImageSemantic.Table?d++:m[y].getSemantic()==o.ImageSemantic.Other?u++:m[y].getSemantic()==o.ImageSemantic.Unknown&&p++;StoryLog.StructuredTraceTag(596473671,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Card created by Document Ingestion has been deleted",{numberOfParagraphs:n.toString(),numberOfHeadings:r.toString(),numberOfChartImages:l.toString(),numberOfSmartArtImages:c.toString(),numberOfTableImages:d.toString(),numberOfOtherImages:u.toString(),numberOfUnknownImages:p.toString()})},l.prototype.getNumberOfDIParagraphs=function(t){var n=0;if(t instanceof o.TextGroup)for(var i=t.children.getCollection(),r=0;r<i.length;r++)i[r].getContentSource()===e.Model.SM.ContentCreator.DocumentIngestion&&n++;return n},l.prototype.getNumberOfDIHeadings=function(t){if(t.getContentSource()===e.Model.SM.ContentCreator.DocumentIngestion&&t instanceof o.TitleComposite){var n=t;if(void 0!==n.getTitle()&&n.getTitle().getContent().getText().trim().length>0)return 1}return 0},l.prototype.groupClicked=function(t){var n=this;if(this.hideOverflowMenu(),this.args.paneStateManager.getPaneVisible(a.AuthoringPaneType.GroupType))return this.args.paneStateManager.hideAuthoringPane(a.AuthoringPaneType.GroupType),TDB.EventPropagation.Bypass;this.logCardActionData(ClientAction.ActionType.Storyline_Group_Clicked,"User grouped some items");var o=this.args.cardsContainer.getModelForActiveContent(null,!0);return e.Model.currentUndoManager().get(this.args.pageId).captureUserUpdate(function(){a.GroupAction.execute({modelObjects:o,cardsContainer:n.args.cardsContainer,transformManager:n.args.transformManager,paneStateManager:n.args.paneStateManager},n.args.pageId)},"User selected Group, auto-grouping the cards currently selected"),TDB.EventPropagation.PreventDefault},l.prototype.groupTypeClicked=function(e){return this.hideOverflowMenu(),this.args.paneStateManager.getPaneVisible(a.AuthoringPaneType.GroupType)?(this.args.paneStateManager.hideAuthoringPane(a.AuthoringPaneType.GroupType),TDB.EventPropagation.Bypass):(this.logCardActionData(ClientAction.ActionType.Storyline_GroupType_Clicked,"User selected Group Type"),a.ShowGroupTypePaneAction.execute(this.args.cardsContainer.getModelForActiveContent(),this.args.transformManager,this.args.paneStateManager),TDB.EventPropagation.Bypass)},l.prototype.ungroupClicked=function(t){var n=this;return this.hideOverflowMenu(),this.logCardActionData(ClientAction.ActionType.Storyline_Explode,"User ungrouped item(s)"),e.Model.currentUndoManager().get(this.args.pageId).captureUserUpdate(function(){var e=n.args.cardsContainer.getModelForActiveContent();e&&a.SeparateAction.execute(e,n.args.cardsContainer,n.args.cardSelectionManager,n.args.pageId)},"User chose to ungroup"),TDB.EventPropagation.PreventDefault},l.prototype.logCardActionData=function(t,n){var o=this.args.cardSelectionManager.getSelection(),i=[];if(o.length>0)for(s=0;s<o.length;s++)i.push(a.CardType[o[s].cardType]);else i.push(a.CardType[this.args.card.cardType]);if(this.args.card.getViewModel().getModel().getContentSource()===e.Model.SM.ContentCreator.DocumentIngestion){var r=this.args.card.getModelObjectId();n+="in DocumentIngestion card";for(s=0;s<i.length;s++)ActionLogger.RecordClientAction(new ClientAction.StorylineActionDataWithMultipleObjects(t,n,i[s],r))}else for(var s=0;s<i.length;s++)ActionLogger.RecordClientAction(new ClientAction.StorylineActionDataWithMultipleObjects(t,n,i[s]))},l.prototype.focusButtonClicked=function(e){var t=this.args.card,n=t.getViewModel().getModel();t instanceof a.ComplexHeadingCardVE&&(n=t.getViewModel().getModel().getBackground());var o={openedFromCard:!0,model:n};return ActionLogger.RecordClientAction(new ClientAction.StorylineActionData(ClientAction.ActionType.Storyline_Text_Focus_Clicked,"User opened focus pane",[o.model.id],[a.CardType[t.cardType]])),this.args.paneStateManager.showEditImagePane(o),TDB.EventPropagation.Bypass},l.prototype.getOverflowButtonId=function(){return ClientAction.ButtonId.CardAction_Overflow},l.prototype.overflowButtonCssClass=function(e){return this.buttonCssClass(e)+" CardMenuTextButtonNoText"},l.prototype.getButtonTextClass=function(){return"CardMenuButtonTextDynamic segoeUISemilight"},l.prototype.getCurrentCardControls=function(e){var t=this.args.card.getViewModel(),n=t.getSocketDefinition()?t.getSocketDefinition().getCardCapabilities():void 0;return n||t.getCardDefinition().getCardControls()},l}(t.CardMenuChunk);t.CardControlsViewModel=s}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(n){var o=StoryApp.View.ViewElements,i=e.Model.SM,r=t.ViewModel,a=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.overflowMenuVisible=TDB.watchableTag(596460751,o,!1),o._cardsContainer=n.cardsContainer,o._cardSelectionManager=n.cardSelectionManager,o._viewModel=new r.EmphasisButtonsViewModel(o,{cardsContainer:o._cardsContainer,cardSelectionManager:o._cardSelectionManager}),o}return __extends(t,e),t.prototype.overflowMenuArgs=function(){var e=this;return new TDB.ChildArgs(n.EmphasisButtonsFlyoutVE,{cardSelectionManager:this._cardSelectionManager,cardsContainer:this._cardsContainer,viewModel:this._viewModel,getControllingElement:function(){return e.overflowButton},visible:this.overflowMenuVisible})},t.prototype.overflowButtonArgs=function(){var e={attributes:{value:{unselectable:"on"}},buttonId:ClientAction.ButtonId.CardAction_EmphasisOverflow,calculateChecked:this.overflowActive,cssClass:{compute:new TDB.ComputedOptionArgs(this,this.overflowButtonClass)},click:this.overflowButtonClicked,context:this,description:{value:Resources.CardDeckMenuEmphasisRadioGroupLabel},fontIconArgs:{value:{fontIconName:{compute:new TDB.ComputedOptionArgs(this,this.overflowButtonFontIcon)},fontIconSizeClass:FontIcons.EmphasisIconSize}},tooltip:{value:Resources.CardDeckMenuEmphasisRadioGroupToolTip},hasPopup:!0};return new TDB.ChildArgs(o.ToggleButtonVE,e)},t.prototype.getButtonTextClass=function(){return"CardMenuButtonTextDynamic segoeUISemilight"},t.prototype.strictSizingButtonArgs=function(e){if(this._viewModel.isStrictSizingAvailable(e)){var t={buttonId:ClientAction.ButtonId.CardAction_StrictSizing,click:this._viewModel.strictSizingButtonClicked,context:this._viewModel,cssClass:{compute:new TDB.ComputedOptionArgs(this,this.strictSizingButtonClass)},description:{value:Resources.CardDeckMenuStrictSizingLabel},tooltip:{value:Resources.StrictSizingCheckboxCaption},fontIconArgs:{value:{fontIconName:{value:FontIcons.OriginalSizeIcon},fontIconSizeClass:FontIcons.EmphasisIconSize,fontIconWrapperClass:{value:"StrictSizingFontIconWrapper"}}},textElementText:{value:Resources.CardDeckMenuStrictSizingLabel},textClass:this.getButtonTextClass(),calculateChecked:this._viewModel.isStrictSizingSelected,role:Aria.Roles.Radio};return new TDB.ChildArgs(o.ToggleButtonVE,t)}},t.prototype.emphasisButtonsArgs=function(e){var t=this,n=[],r={buttonId:ClientAction.ButtonId.CardAction_EmphasisNone,cssClass:{compute:new TDB.ComputedOptionArgs(this,this.buttonClass)},fontIconArgs:{value:{fontIconName:{value:FontIcons.EmphasisNoneIcon},fontIconWrapperClass:{value:"EmphasisButtonFontIconWrapper"},fontIconSizeClass:FontIcons.EmphasisIconSize}},description:{value:Resources.CardDeckMenuSubtleEmphasisLabel},tooltip:{value:Resources.CardDeckMenuSubtleEmphasisDescription},click:this._viewModel.emphasisNoneClicked,context:this._viewModel,calculateChecked:function(e){return t._viewModel.getActiveEmphasisLevel(e)===i.EmphasisLevel.None},role:Aria.Roles.Radio};n.push(new TDB.ChildArgs(o.ToggleButtonVE,r));var a={buttonId:ClientAction.ButtonId.CardAction_EmphasisMore,fontIconArgs:{value:{fontIconName:{value:FontIcons.EmphasisMoreIcon},fontIconWrapperClass:{value:"EmphasisButtonFontIconWrapper"},fontIconSizeClass:FontIcons.EmphasisIconSize}},cssClass:{compute:new TDB.ComputedOptionArgs(this,this.buttonClass)},description:{value:Resources.CardDeckMenuModerateEmphasisLabel},tooltip:{value:Resources.CardDeckMenuModerateEmphasisDescription},click:this._viewModel.emphasisMoreClicked,context:this._viewModel,calculateChecked:function(e){return t._viewModel.getActiveEmphasisLevel(e)===i.EmphasisLevel.More},role:Aria.Roles.Radio};if(n.push(new TDB.ChildArgs(o.ToggleButtonVE,a)),!this._viewModel.isText(e)){var s={buttonId:ClientAction.ButtonId.CardAction_EmphasisVery,fontIconArgs:{value:{fontIconName:{value:FontIcons.EmphasisVeryIcon},fontIconWrapperClass:{value:"EmphasisButtonFontIconWrapper"},fontIconSizeClass:FontIcons.EmphasisIconSize}},cssClass:{compute:new TDB.ComputedOptionArgs(this,this.buttonClass)},description:{value:Resources.CardDeckMenuIntenseEmphasisLabel},tooltip:{value:Resources.CardDeckMenuIntenseEmphasisDescription},click:this._viewModel.emphasisVeryClicked,context:this._viewModel,calculateChecked:function(e){return t._viewModel.getActiveEmphasisLevel(e)===i.EmphasisLevel.Very},role:Aria.Roles.Radio};n.push(new TDB.ChildArgs(o.ToggleButtonVE,s))}return n},t.prototype.overflowButtonFontIcon=function(e){if(this._viewModel.isStrictSizingSelected(e))return FontIcons.OriginalSizeIcon;var t=this._viewModel.getActiveEmphasisLevel(e);return t===i.EmphasisLevel.Very?FontIcons.EmphasisVeryIcon:t===i.EmphasisLevel.More?FontIcons.EmphasisMoreIcon:FontIcons.EmphasisNoneIcon},t.prototype.overflowButtonClicked=function(e){var t=this;return TDB.applyUpdate(function(){t.overflowMenuVisible.setValue(!t.overflowMenuVisible.getValue())}),TDB.EventPropagation.Bypass},t.prototype.overflowActive=function(e){return this.overflowMenuVisible.getWatchedValue(e)},t.prototype.buttonClass=function(e){return this.parent.model.buttonCssClass(e)+" CardMenuTextButtonNoText CardMenuEmphasisButton ButtonVE"},t.prototype.overflowButtonClass=function(e){return this.parent.model.buttonCssClass(e)},t.prototype.strictSizingButtonClass=function(e){return this.parent.model.buttonCssClass(e)},t.prototype.hideOverflow=function(){var e=this;TDB.applyUpdate(function(){e.overflowMenuVisible.setValue(!1)})},t.prototype.ifEmphasisButtonsArgs=function(e){return this.getVisible(e)},t.prototype.emphasisButtonsRadioGroupAttrArgs=function(e){var t={};return t[Aria.Attributes.Role]=Aria.Roles.Radiogroup,t[Aria.Attributes.Label]=Resources.CardDeckMenuEmphasisRadioGroupLabel,t},t.prototype.isEmphasisButtonsOverflowArgs=function(e){return this.getCollapsed(e)},t}(o.CustomMenuControl);n.EmphasisButtonsVEBase=a}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(n){var o=e.Model.SM,i=StoryApp.View.ViewElements,r=t.ViewModel,a=function(e){function t(t,n){var o=e.call(this,t,{features:TDB.ControlSetFeatures.VerticalList,getControllingElement:n.getControllingElement,visible:n.visible})||this;return o._cardsContainer=n.cardsContainer,o._cardSelectionManager=n.cardSelectionManager,o._emphasisButtons={},o._viewModel=n.viewModel,o}return __extends(t,e),t.prototype.menuItemWrapperSlideVisibleInitArgs=function(){return!1},t.prototype.menuItemWrapperSlideVisibleArgs=function(e){return{visible:this.visible.getWatchedValue(e),done:this.onPopupVisible}},t.prototype.menuItemWrapperAttrArgs=function(e){var t={};return t[Aria.Attributes.Role]=Aria.Roles.Radiogroup,t[Aria.Attributes.Label]=Resources.CardDeckMenuEmphasisRadioGroupLabel,t},t.prototype.menuItemsArgs=function(e){var t=this,n=[],a={attributes:{value:{unselectable:"on"}},buttonId:ClientAction.ButtonId.CardAction_EmphasisNone,calculateChecked:function(e){return t._viewModel.getActiveEmphasisLevel(e)==o.EmphasisLevel.None},click:this._viewModel.emphasisNoneClicked,context:this._viewModel,description:{value:Resources.StyleHintsEmphasis1},fontIconArgs:{value:{fontIconName:{value:FontIcons.EmphasisNoneIcon},fontIconSizeClass:FontIcons.EmphasisIconSize,fontIconWrapperClass:{value:"CardMenuFontIcon"}}},textElementText:{value:Resources.StyleHintsEmphasis1},textClass:r.CardMenuChunk.OverflowButtonTextClass,cssClass:{value:r.CardMenuChunk.OverflowButtonClass},role:Aria.Roles.Radio};n.push(new TDB.ChildArgs(i.ToggleButtonVE,a,function(e){t._emphasisButtons[o.EmphasisLevel.None]=e}));var s={attributes:{value:{unselectable:"on"}},buttonId:ClientAction.ButtonId.CardAction_EmphasisMore,calculateChecked:function(e){return t._viewModel.getActiveEmphasisLevel(e)==o.EmphasisLevel.More},click:this._viewModel.emphasisMoreClicked,context:this._viewModel,description:{value:Resources.StyleHintsEmphasis2},fontIconArgs:{value:{fontIconName:{value:FontIcons.EmphasisMoreIcon},fontIconSizeClass:FontIcons.EmphasisIconSize,fontIconWrapperClass:{value:"CardMenuFontIcon"}}},textElementText:{value:Resources.StyleHintsEmphasis2},textClass:r.CardMenuChunk.OverflowButtonTextClass,cssClass:{value:r.CardMenuChunk.OverflowButtonClass},role:Aria.Roles.Radio};if(n.push(new TDB.ChildArgs(i.ToggleButtonVE,s,function(e){t._emphasisButtons[o.EmphasisLevel.More]=e})),!this._viewModel.isText(e)){var l={attributes:{value:{unselectable:"on"}},buttonId:ClientAction.ButtonId.CardAction_EmphasisVery,calculateChecked:function(e){return t._viewModel.getActiveEmphasisLevel(e)==o.EmphasisLevel.Very},click:this._viewModel.emphasisVeryClicked,context:this._viewModel,description:{value:Resources.StyleHintsEmphasis3},fontIconArgs:{value:{fontIconName:{value:FontIcons.EmphasisVeryIcon},fontIconSizeClass:FontIcons.EmphasisIconSize,fontIconWrapperClass:{value:"CardMenuFontIcon"}}},textElementText:{value:Resources.StyleHintsEmphasis3},textClass:r.CardMenuChunk.OverflowButtonTextClass,cssClass:{value:r.CardMenuChunk.OverflowButtonClass},role:Aria.Roles.Radio};n.push(new TDB.ChildArgs(i.ToggleButtonVE,l,function(e){t._emphasisButtons[o.EmphasisLevel.Very]=e}))}if(this._viewModel.isStrictSizingAvailable(e)){var c={attributes:{value:{unselectable:"on"}},buttonId:ClientAction.ButtonId.CardAction_StrictSizing,calculateChecked:function(e){return t._viewModel.isStrictSizingSelected(e)},click:this._viewModel.strictSizingButtonClicked,context:this._viewModel,description:{value:Resources.StrictSizingCheckboxCaption},fontIconArgs:{value:{fontIconName:{value:FontIcons.OriginalSizeIcon},fontIconSizeClass:FontIcons.EmphasisIconSize,fontIconWrapperClass:{value:"CardMenuFontIcon"}}},textElementText:{value:Resources.CardDeckMenuStrictSizingLabel},textClass:r.CardMenuChunk.OverflowButtonTextClass,cssClass:{value:r.CardMenuChunk.OverflowButtonClass},role:Aria.Roles.Radio};n.push(new TDB.ChildArgs(i.ToggleButtonVE,c))}return n},t.prototype.getInitialActiveChild=function(){return this._emphasisButtons[this._viewModel.getActiveEmphasisLevel()]},t}(i.PopupBaseVE);n.EmphasisButtonsFlyoutVEBase=a}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(n){var o=e.Model.SM,i=e.Model.AuthoringModel,r=t.ViewElements,a=function(){function t(e,t){this._cardsContainer=t.cardsContainer,this._cardSelectionManager=t.cardSelectionManager,this._viewElement=e,this._activeLevel=TDB.watcherTag(596473633,this,this._viewElement,this.calculateActiveLevel),this._strictSizingActive=TDB.watcherTag(596473634,this,this._viewElement,this.calculateStrictSizing)}return t.prototype.getActiveEmphasisLevel=function(e){return this._activeLevel.getWatchedValue(e)},t.prototype.isStrictSizingSelected=function(e){return this._strictSizingActive.getWatchedValue(e)},t.prototype.strictSizingButtonClicked=function(t){var n=!this.isStrictSizingSelected();this.logStrictSizingChange(n),this._viewElement.hideOverflow();var i=this._cardsContainer.getModelForActiveContent(null);return e.Model.currentUndoManager().get(this._viewElement.getPageId()).captureUserUpdate(function(){for(var e=0;e<i.length;e++)i[e]instanceof o.EmbeddedContent&&i[e].setStrictSizing(n)},"Applying strict sizing"),TDB.EventPropagation.Bypass},t.prototype.emphasisNoneClicked=function(e){return this.emphasisClicked(o.EmphasisLevel.None)},t.prototype.emphasisMoreClicked=function(e){return this.emphasisClicked(o.EmphasisLevel.More)},t.prototype.emphasisVeryClicked=function(e){return this.emphasisClicked(o.EmphasisLevel.Very)},t.prototype.isStrictSizingAvailable=function(e){var t=this._cardsContainer.getModelForActiveContent(e);return r.SetStrictSizingAction.isAvailable(t)},t.prototype.isText=function(e){var t=this._cardsContainer.getModelForActiveContent(e);return i.StoryController.modelObjectsAreValid(t)&&t.every(function(e){return e instanceof o.TextGroup})},t.prototype.emphasisClicked=function(t){var n=this;return this.logEmphasisChange(t),this._viewElement.hideOverflow(),e.Model.currentUndoManager().get(this._viewElement.getPageId()).captureUserUpdate(function(){var e=n._cardsContainer.getModelForActiveContent();r.SetEmphasisAction.execute(e,{emphasisLevel:t},n._viewElement.getPageId()),r.SetStrictSizingAction.isAvailable(e)&&r.SetStrictSizingAction.execute(e,{strictSizing:!1});var o=null;return length&&e[0]&&(o=e[0].id),{activeModelObjectIds:[o]}},"User changed the emphasis level to Very"),TDB.EventPropagation.Bypass},t.prototype.logEmphasisChange=function(e){for(var t=[],n=[],i=this._cardSelectionManager.getSelection(),r=i.length,a=0;a<r;a++){var s=i[a];t.push(o.EmphasisLevel[s.getViewModel().getEmphasis()]),n.push(s.getViewModel().getModelId())}ActionLogger.RecordClientAction(new ClientAction.EmphasisLevelData(Diag.ULSCat.msoulscat_Story_Storyline,ClientAction.ActionType.Storyline_ChangeEmphAction,"User changed the emphasis level",t,o.EmphasisLevel[e],n))},t.prototype.logStrictSizingChange=function(e){for(var t=[],n=e.toString(),i=[],r=this._cardsContainer.getModelForActiveContent(null),a=r.length,s=0;s<a;s++){var l=r[s];if(l instanceof o.EmbeddedContent){var c=l;t.push(c.getStrictSizing().toString())}i.push(l.id)}ActionLogger.RecordClientAction(new ClientAction.StrictSizingData(Diag.ULSCat.msoulscat_Story_Storyline,ClientAction.ActionType.Storyline_StrictSizingAction,"User changed the strict sizing value",t,n,i))},t.prototype.calculateActiveLevel=function(e){if(this.calculateStrictSizing(e))return null;var t=this._cardsContainer.getModelForActiveContent(e);return i.ObjectController.calculateActiveEmphasisLevel(t,e)},t.prototype.calculateStrictSizing=function(e){for(var t=this._cardsContainer.getModelForActiveContent(e),n=void 0,i=t.length,r=0;r<i;r++){var a=null;if(t[r]instanceof o.EmbeddedContent&&(a=t[r].getStrictSizing(e)),void 0===n)n=a;else if(n!==a)return null}return n},t}();n.EmphasisButtonsViewModel=a}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(t){function n(e,n){var o=t.call(this,e,{features:TDB.ControlSetFeatures.HorizontalList})||this;return o._viewModel=n.viewModel,o._viewModel.setView(o),o}return __extends(n,t),n.prototype.cardOptionsArgs=function(){return this._viewModel.createMenuButtons().map(function(t){return new TDB.ChildArgs(e.JackCardOptionVE,t)})},n.prototype.escape=function(){this.parent.closeMenu()},n}(StoryApp.View.ViewElements.PopupBaseVE);e.SocketMenuVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t,n){var o=e.call(this,t)||this;return o._cardDefinitionManager=n.cardDefinitionManager,o._candidateCardIds=n.cardTypes,o}return __extends(t,e),t.prototype.setView=function(e){this._view=e},t.prototype.createMenuButtons=function(){for(var e=[],t=0,n=this._candidateCardIds;t<n.length;t++){var o=n[t],i=this._cardDefinitionManager.getCardDefinition(o);e.push({id:i.id,buttonId:i.buttonId,title:i.title,fontIcon:i.fontIconName,context:this,clickCallback:this.menuItemInvoked,description:i.description})}return e},t.prototype.menuItemInvoked=function(e){return this._view.parent.getViewModel().addDefaultModelAndSetFocus(e),!1},t}(Disposable);e.SocketMenuViewModel=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(e){function n(t,n){var o=e.call(this,t)||this;return o.storyPage=n.storyPage,o}return __extends(n,e),n.prototype.getCardsContainer=function(){var e=this.getAuthoringPage();return e?e.cardDeckVE:void 0},n.prototype.getPreviewRoot=function(){if(this.storyPage)return this.storyPage.previewVE?this.storyPage.previewVE.getRootVE():void 0},n.prototype.getStoryPage=function(){return this.storyPage},n.prototype.getStoryPageEdit=function(){if(this.storyPage)return this.storyPage.isStoryPageEdit()?this.storyPage:void 0},n.prototype.getAuthoringPage=function(){var e=this.getStoryPageEdit();if(e)return e.getAuthoringModel()},n.prototype.getActiveCardModelId=function(e){if(this.getAuthoringPage())return this.getCardsContainer().getActiveNavigatableCardModelId(e)},n.prototype.navigationSyncPreview=function(e){var n=this.getActiveCardModelId(e);if(n){var o=this.getPreviewRoot();if(o){var i=o.getRootKeyframeProperties();i&&platform.setImmediate(function(){if(i.scrollability===StoryApp.Model.RM.LayoutScrollability.None){var e=t.NavigationHelper.getFsmNodeIdFromContentId(o.getInteractionModel(),n);if(!e)return;t.NavigationManager.navigateTo(o,e,{snapScene:!0,callerMessage:"NavigationSyncManager:scrollSyncToPreviewTarget",refreshNodes:!1,supressFading:!0,resetDescendants:!0})}else t.NavigationHelper.scrollTo(o,{contentId:n})})}}},n}(Disposable);e.NavigationSyncManager=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(){if(e._cache)throw StoryApp.RethrowLogger.createError("Error: Do not use constructor. Use ColorSuggestionsCache.getInstance() instead.");this.cachedColorPaletteData={}}return e.getInstance=function(){return e._cache||(e._cache=new e),e._cache},e.prototype.getColorSuggestion=function(e){return this.cachedColorPaletteData[e]},e.prototype.addColorSuggestion=function(e,t){this.cachedColorPaletteData[e]=t},e.prototype.removeObsoleteEntries=function(e){for(var t={},n=0,o=e;n<o.length;n++){var i=o[n];this.cachedColorPaletteData[i]&&(t[i]=this.cachedColorPaletteData[i])}this.cachedColorPaletteData=t},e}();e.ColorSuggestionsCache=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(n){function o(e,t){var o=n.call(this,e)||this;return o.args=t,o._moreOptionsVisible=TDB.watchable(o,!1),o.model=t.model,o}return __extends(o,n),o.prototype.moreOptionsToggleArgs=function(){var e={buttonId:ClientAction.ButtonId.ShareDropdown_MoreOptionsButton,click:this.moreOptionsToggleClicked,context:this,cssClass:{value:"shareMoreOptionsToggleButton"},description:{value:Resources.SharingMoreOptions},enabled:{watchable:this.model.getEnabledWatchable()},fontIconName:{compute:new TDB.ComputedOptionArgs(this,this.moreOptionsToggleFontIcon)},fontIconSizeClass:FontIcons.ExpandOpenRestIconSize,fontIconWrapperClass:{value:"shareMoreOptionsToggleCollapseFontIconWrapper"},textClass:"shareMoreOptionsToggleHeaderLabel segoeUISemilight",textPlacementRight:!0,text:{value:Resources.SharingMoreOptions},attributes:{compute:new TDB.ComputedOptionArgs(this,this.moreOptionsToggleAttrs)}};return new TDB.ChildArgs(t.GlyphButtonVE,e)},o.prototype.moreOptionsToggleAttrs=function(e){var t={};return t[Aria.Attributes.Controls]="showMoreOptionsWrapper",t[Aria.Attributes.Expanded]=this._moreOptionsVisible.getWatchedValue(e)?Aria.BooleanState.True:Aria.BooleanState.False,t},o.prototype.moreOptionsWrapperAttrArgs=function(e){var t={};return t[Aria.Attributes.Role]=Aria.Roles.Group,t[Aria.Attributes.Label]=Resources.SharingMoreOptions,t[Aria.Attributes.Hidden]=this._moreOptionsVisible.getWatchedValue(e)?Aria.BooleanState.False:Aria.BooleanState.True,t},o.prototype.moreOptionsToggleClicked=function(e){var t=this;return TDB.applyUpdate(function(){t._moreOptionsVisible.setValue(!t._moreOptionsVisible.getValue())}),TDB.EventPropagation.Bypass},o.prototype.ifShowMoreOptionsArgs=function(e){return this._moreOptionsVisible.getWatchedValue(e)},o.prototype.moreOptionsToggleFontIcon=function(e){return this._moreOptionsVisible.getWatchedValue(e)?FontIcons.ExpandOpenRestIcon:FontIcons.ExpandClosedRestIcon},o.prototype.blockShareButtonCheckboxArgs=function(e){if(this.model.canBlockSharing(e)){var n=new TDB.ChildArgs(t.SpanMessageVE,{message:Resources.SharingBlockShareButtonCheckboxText,messageCss:"shareMoreOptionsCheckboxText"}),o={buttonId:ClientAction.ButtonId.ShareDropdown_MoreOptionsCheckbox_BlockShareButton,context:this,checked:!StoryPageSettings.ShareButtonBlocked,click:this.blockShareButtonCheckboxClicked,cssClass:{value:"shareMoreOptionsCheckboxWrapper"},enabled:{watchable:this.model.getEnabledWatchable()},richTextElementsUnchecked:[n],richTextElementsChecked:[n],role:Aria.Roles.Checkbox,fontIconName:{value:FontIcons.CheckboxFontIcon},fontIconSize:FontIcons.CheckboxFontIconSize,checkedIconWrapperClass:{value:"shareMoreOptionsCheckboxChecked"},uncheckedIconWrapperClass:{value:"shareMoreOptionsCheckboxUnchecked"}};return new TDB.ChildArgs(t.RichCheckboxVE,o)}},o.prototype.blockShareButtonCheckboxClicked=function(e){var t=this,n=this.blockShareButtonCheckbox.getChecked(),o=!n;return this.model.getSharingManager().changeBlockShareButton(!n,StoryPageSettings.LookupId,function(e,o,i){StoryPageSettings.ShareButtonBlocked=!n,t.onCheckboxOperationSuccess(e,o,i)},$.proxy(this.onCheckboxOperationError(o,this.blockShareButtonCheckbox),this)),TDB.EventPropagation.Bypass},o.prototype.onCheckboxOperationSuccess=function(e,t,n){StoryLog.TraceTag(596132096,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.info,"ShareDropdown : ShareMoreOptions : Toggled check box in share more options successfully")},o.prototype.onCheckboxOperationError=function(e,t){return function(n,o,i){StoryLog.TraceTag(596132097,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.info,"ShareDropdown : ShareMoreOptions : Failed to toggle check box in share more options : {0}",[o]),TDB.applyUpdate(function(){t.setChecked(e)})}},o.prototype.showRevokeLinkArgs=function(){return StoryPageSettings.IsOwner},o.prototype.revokeLinkArgs=function(){var e={buttonId:ClientAction.ButtonId.ShareDropdown_MoreOptionsRevokeLink,click:this.revokeLinkClicked,context:this,cssClass:{value:"shareCastGreyButton revokeLinkButton"},enabled:{watchable:this.model.getEnabledWatchable()},textClass:"shareCastGreyButtonText",text:{value:Resources.SharingRevokeLinksDialogTitleNew}};return new TDB.ChildArgs(t.TextButtonVE,e)},o.prototype.revokeLinkClicked=function(e){return StoryPageSettings.IsOwner&&(t.RevokeSharingDialog.createAndShow(StoryPageSettings.LookupId,this.model.getSharingManager(),!!StoryPageEditSettings.CastId,this.args.onRevokeLinkSuccess),this.args.onShowDialog()),TDB.EventPropagation.Bypass},o.prototype.setPasswordButtonArgs=function(){var e={cssClass:{value:"shareMoreOptionsTextButtonWrapper"},buttonId:ClientAction.ButtonId.ShareDropdown_MoreOptionsSetPassword,click:this.setPasswordButtonClicked,context:this,hasPopup:!1,text:{value:Resources.SharingRequirePasswordText},description:{value:Resources.SharingRequirePasswordText},tooltip:{value:Resources.SharingRequirePasswordText},enabled:{watchable:this.model.getEnabledWatchable()}};return new TDB.ChildArgs(t.TextButtonVE,e)},o.prototype.setPasswordButtonClicked=function(t){var n={sharingManager:this.model.getSharingManager()};return this.passwordManagementDialog=e.PasswordManagementDialog.createAndShow(n),this.args.onShowDialog(),TDB.EventPropagation.Bypass},o.prototype.ifShowPasswordManagementArgs=function(e){return this.model.canManagePassword(e)},o.prototype.removePasswordArgs=function(){var t={sharingManager:this.model.getSharingManager()};return new TDB.ChildArgs(e.RemovePasswordVE,t)},o.prototype.hasPasswordArgs=function(e){return this.model.getSharingManager().hasPassword(e)},o}(TDB.FocusableViewElement);e.ShareMoreOptionsVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t,n){var o=e.call(this,t)||this;return o.args=n,o}return __extends(t,e),t.prototype.dispose=function(t){this.stopScrolling(),this.args=void 0,e.prototype.dispose.call(this,t)},t.prototype.updateScrolling=function(e){if(this.args.dragHandler.dragging.getWatchedValue(e)){var t=this.args.dragHandler.dragPosition.getWatchedValue(e);if(t){var n=document.getElementById(this.args.elementId).getBoundingClientRect(),o=this.args.regionMargin;o<1&&(o*=n.height),t.top<n.top+o?this.startScrolling(!0):t.top>n.bottom-o?this.startScrolling(!1):this.stopScrolling()}}else this.stopScrolling()},t.prototype.startScrolling=function(e){var n=this;this.scrollTimer&&this.scrollUp===e||(this.scrollUp=e,this.stopScrolling(),this.scrollTimer=platform.setInterval(function(){if(n.args.dragHandler.dragging.getValue()){var e=document.getElementById(n.args.elementId),o=n.scrollUp?-t.scrollAmount:t.scrollAmount;e.scrollTop=e.scrollTop+o}},t.scrollIntervalMs))},t.prototype.stopScrolling=function(){this.scrollTimer&&(clearInterval(this.scrollTimer),this.scrollTimer=void 0)},t.scrollAmount=20,t.scrollIntervalMs=30,t}(TDB.ViewElement);e.AutoScrollerVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t,n){var o=e.call(this,t,{features:TDB.ControlSetFeatures.VerticalList,getControllingElement:n.getControllingElement,visible:n.visible})||this;return o.chunk=n.chunk,o}return __extends(t,e),t.prototype.menuItemWrapperSlideVisibleInitArgs=function(){return!1},t.prototype.menuItemWrapperSlideVisibleArgs=function(e){return{visible:this.visible.getWatchedValue(e),done:this.onPopupVisible}},t.prototype.menuItemsArgs=function(e){return ArrayExtensions.notNullOrUndefined(this.chunk.getOverflowItemArgs(e))},t}(StoryApp.View.ViewElements.PopupBaseVE);e.CardMenuOverflowVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=function(e){function i(t,n,o){var i=e.call(this,t)||this;return i.parent=n,i.menuArgs=o,i.menu=o?TDB.watcherTag(596456081,i,i,i.buildMenu):void 0,i}return __extends(i,e),i.prototype.prepInsertion=function(e){return void 0===e&&(e=!1),this.getInsertionPointCore(e,!0)},i.prototype.getNewMenu=function(e){return this.menu?this.menu.getWatchedValue(e):void 0},i.prototype.getInsertionPoint=function(e){return e?{parent:this.parent.getViewModel().getModel(),index:0}:this.getInsertionPointCore(!1,!1)},i.prototype.areNewMenuTabsVisible=function(e){var t=this.getNewMenu(e);return t&&t.areTabsVisible()},i.prototype.buildMenu=function(e){return new t.JackMenuViewModel(this,this.menuArgs,e)},i.prototype.getInsertionPointCore=function(e,t){var i,r=o.currentStoryController().get(this.parent.getPageId()),a=r.getRootGroup(),s=this.parent.getViewModel(),l=s.getFocusedModel(),c=s.getParentModel(r);if(r.isPartOfHeading(l)&&c==a&&(l=c,c=r.findParent(l)),l){var d=l instanceof n.SpecifiedGroup,u=d&&l===a;if(d&&StoryPageEditSettings.SubHeadingsEnabled)u?(c=a,i=0):(c=p=l,i=p.children.getCollection().length);else if(d)if(l!==a){var p=l;c=p,i=p.children.getCollection().length}else{var g=a.children.getCollection(),h=g.length>0?g[0]:void 0;h&&!h.getHeading()?(c=h,i=0):t?(e?(c=r.createGroup(),a.children.add(c,0)):c=a,i=0):(c=a,i=0)}else if(c instanceof n.TextGroup){var C=c,f=C.children.getCollection(),m=l,y=f.indexOf(m)+1,v=r.findParent(c),S=o.StoryController.getPrimaryCollection(v);if(c=v,i=S.getCollection().indexOf(C)+1,t&&y<f.length){var T=r.createTextGroup(!1);S.add(T,i);for(var w=y;w<f.length;w++)r.removeSpecifiedGroupChild(f[w],C),T.children.add(f[w])}}else{var A=o.StoryController.getPrimaryCollection(c);A&&(i=A.getCollection().indexOf(l)+1)}return c||void 0!=i||0!=a.children.getCollection().length||(c=a,i=0),{parent:c,index:i}}},i}(Disposable);t.JackViewModel=i}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=e.View.ViewElements,r=function(){function e(){}return e}(),a=function(){function e(){}return e}();t.StoryClipboardData=a;var s=function(a){function s(e){var t=a.call(this)||this;return t._cardsContainer=e.cardsContainer,t._cardDefinitionManager=e.cardDefinitionManager,t._cardSelectionManager=e.cardSelectionManager,t.pageId=e.pageId,t}return __extends(s,a),s.prototype.getPasteEventName=function(){return"CardDeck.Paste"},s.prototype.handleEvent=function(e){var n=TDB.EventPropagation.Bubble;return e.which&&t.CopyPasteImplementationBase.isInterestingKeyEvent(e,["c","C","x","X","v","V"])&&(n=this.handleKeyboardCopyPaste(e)),n},s.prototype.getCopyDiv=function(){return this.getContainer()},s.prototype.getPasteDiv=function(){return this.getContainer()},s.prototype.getContainer=function(){var e=$("#sway_authoring_copypaste_container");return e&&0!==e.length||(e=$("<div/>").appendTo("body"),$(e).attr("id","sway_authoring_copypaste_container"),$(e).attr("class","CardDeckHiddenInput"),$(e).attr("contentEditable","true")),e},s.prototype.clearState=function(){this.clearSelectedRanges()},s.prototype.restoreState=function(){var e=this;this._savedState&&TDB.applyUpdate(function(){var t=e._savedState.focusedElement;e._cardSelectionManager.setState(e._savedState.selectedCards),t&&t.focus()})},s.prototype.saveState=function(){this._savedState||(this._savedState=new r);var e=StoryApp.Utilities.getDocumentActiveElement();this._savedState.focusedElement=e instanceof HTMLElement?e:void 0,this._savedState.selectedCards=this._cardSelectionManager.getState()},s.prototype.saveFocusedPlaceholder=function(){var e=TDB.FocusableViewElement.getFocusedElement();e instanceof i.PlaceholderCardVE&&(this.focusedPlaceholder=e)},s.prototype.forgetFocusedPlaceholder=function(){this.focusedPlaceholder=void 0},s.prototype.clearSelectedRanges=function(){var e=window.getSelection();e.rangeCount&&e.removeAllRanges()},s.prototype.removeSelectedCards=function(){var n=this,i=[];this.getCopyPasteModelForSelection().forEach(function(e){return i.push(e.model)});var r=this._cardSelectionManager.getSelection(),a=function(e){for(var t=e.length;t--;)n._cardsContainer.removeDisposedCard(e[t])},s=new ClientAction.CardDeckCutAction(o.currentStoryController().get(this.pageId).getLoggableContentTypes(i,this._cardDefinitionManager));ActionLogger.RecordClientAction(s),e.Model.currentUndoManager().get(this.pageId).captureUserUpdate(function(){t.DeleteAction.execute(i,n.pageId,"Cut cards"),a(r)},"User cut cards from the storyline")},s.prototype.copyCards=function(e){var n=null,i=this.getCopyPasteModelForSelection(!0),r=[];i.forEach(function(e){return r.push(e.model)});var a=this.getAdditionalData(r);if(t.SerializeAction.isAvailable(i)){for(var s={swayID:StoryPageSettings.LookupId,externalDataIds:a.externalDataIdMap,videoPlaceholderIds:a.videoPlaceholderIds,storyHostedVideoIds:a.storyHostedVideoIds,audioPlaceholderIds:a.audioPlaceholderIds,storyHostedAudioIds:a.storyHostedAudioIds,modelData:t.SerializeAction.execute({cardObjects:i,cardDefinitionManager:e},this.pageId)},l=r.length,c=0;c<l;c++)this._cardsContainer.getCardForModelId(r[c].id).triggerCopiedOverlay();var d=new ClientAction.CardDeckCopyAction(o.currentStoryController().get(this.pageId).getLoggableContentTypes(r,e));ActionLogger.RecordClientAction(d),n=JSON.stringify(s)}return n},s.prototype.getCopyPasteModelForSelection=function(e){void 0===e&&(e=!1);var t=this._cardsContainer.getCardsForActiveContent(null,e);if(!t)return[];for(var i=[],r=!1,a=!1,s=t.length,l=0;l<s;l++)if(t[l].getViewModel().inSocket())a=!0;else{var c=t[l].getViewModel().getModel();c instanceof n.ImportingOrEmbeddingDocumentContent||c instanceof n.DocumentContent?r=!0:o.MediaController.isUploadingMedia(c)||i.push(new o.Card({definition:t[l].getViewModel().getCardDefinition(),model:c}))}return r&&StoryLog.TraceTag(596473564,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"CardDeckCopyPasteHandler: User wanted to copy-paste ImportingOrEmbeddingDocumentContent."),a&&StoryLog.TraceTag(596473565,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"CardDeckCopyPasteHandler: User wanted to copy-paste a socketed card."),i},s.prototype.paste=function(t){var n,o=this,r=[],a=[];try{var l=(n=JSON.parse(t)).modelData,c=[];l.forEach(function(e){return c.push(e.serializedModel)});var d=this._cardsContainer;e.Model.currentUndoManager().get(this.pageId).captureUserUpdate(function(){var e=new ClientAction.CardDeckPasteAction(n.swayID===StoryPageSettings.LookupId,s.getPropertyValues("objType",c));ActionLogger.RecordClientAction(e);var t={};if((r=i.DeserializeAction.execute({modelData:l,cardsContainer:d,objIds:t,videoPlaceholderIds:n.videoPlaceholderIds,storyHostedVideoIds:n.storyHostedVideoIds,audioPlaceholderIds:n.audioPlaceholderIds,storyHostedAudioIds:n.storyHostedAudioIds,addModelsToGraph:!1,replaceSelectedCards:!0},o.pageId)).forEach(function(e){return a.push(e.model)}),o.focusedPlaceholder)for(var u=r.length;u>0;u--)if(o.focusedPlaceholder.getViewModel().addModelObjects(r.slice(0,u))){r=r.slice(u);break}d.addCardObjects(r),s.updateCopyInfo(a,n.externalDataIds,t,n.swayID);var p=[];for(var g in t)p.push(t[g]);return d.closeActiveJackMenu(),{activeModelObjectIds:p}},"User pasted some cards into the storyline"),this._cardsContainer.scrollToModelsAndSetFocus(a,!0)}catch(e){e instanceof SyntaxError?StoryLog.StructuredTraceTag(596473566,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.spam,"JSON parser error on paste.",{Error:e.message,data:n+""}):StoryLog.StructuredTraceTag(596473567,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.warning,"Paste error",{Error:e,data:n+""})}return a},s.prototype.logCopyPressedAction=function(e){var t=this._cardDefinitionManager,n=[];if(this.getCopyPasteModelForSelection(!0).forEach(function(e){return n.push(e.model)}),e){var i=new ClientAction.CardDeckCutPressedAction(o.currentStoryController().get(this.pageId).getLoggableContentTypes(n,t));ActionLogger.RecordClientAction(i)}else{var r=new ClientAction.CardDeckCopyPressedAction(o.currentStoryController().get(this.pageId).getLoggableContentTypes(n,t));ActionLogger.RecordClientAction(r)}},s.prototype.handleKeyboardCopyPaste=function(e){var t=this,n=TDB.EventPropagation.Bubble;if(this.shouldHandleCopyEvent(e)?this.logCopyPressedAction():this.shouldHandleCutEvent(e)&&this.logCopyPressedAction(!0),this.shouldHandleCopyEvent(e))this.prepareForCopy(this.copyCards(this._cardDefinitionManager),!0);else if(this.shouldHandleCutEvent(e)){var o=this.copyCards(this._cardDefinitionManager);o&&(this.prepareForCopy(o,!1),platform.setTimeout(function(){t.removeSelectedCards()},0))}else this.shouldHandlePasteEvent(e)&&this.prepareForPaste();return n},s.prototype.shouldHandleCopyEvent=function(e){var n=this.isInTextAreaOrRTE();return t.CopyPasteImplementationBase.isInterestingKeyEvent(e,["c","C"])&&!n},s.prototype.shouldHandleCutEvent=function(e){var n=this.isInTextAreaOrRTE();return t.CopyPasteImplementationBase.isInterestingKeyEvent(e,["x","X"])&&!n},s.prototype.shouldHandlePasteEvent=function(e){var n=this.isInTextAreaOrRTE()&&s.isFocusInRTE();return t.CopyPasteImplementationBase.isInterestingKeyEvent(e,["v","V"])&&!n},s.prototype.useCustomPasteAction=function(e){return!(s.isFocusInRTE()&&this._cardSelectionManager.getSelection().length>0)&&i.DeserializeAction.isSerializedData(e)},s.prototype.pastedElementWillFlow=function(e){var t=o.currentStoryController().get(this.pageId),i=ArrayExtensions.lastOrDefault(this._cardsContainer.getModelForActiveContent()),r=t.findParent(i);if(e instanceof n.TitleComposite&&r instanceof n.SpecifiedGroup)return!1;var a=t.getRootGroup().children.getCollection()[0],s=r===a&&!a.getHeading(),l=r===t.getRootGroup();return!s&&!l&&r!==t.findParent(e)},s.prototype.indexOfFlow=function(e){for(var t=0;t<e.length;t++)if(this.pastedElementWillFlow(e[t]))return t;return e.length},s.prototype.getImageExternalDataId=function(t){var n=e.Model.ContentStorageModel.getModelObject(t.id),o=n?n.getExternalDataId():null;if(!o){var i=t.getSourceUrl();if(i){var r=/\/s\/[\W\w|\d]+\/images\/([\W\w|\d]+)/.exec(i);r&&r.length>1&&(o=r[1])}}return o},s.prototype.getAdditionalData=function(e){for(var t={},i=[],r={},a=[],s={},l=e.length;l--;){if(o.ObjectController.modelIsImage(e[l]))for(var c=(g=e[l]).getMedia().imageParts.getCollection(),d=c.length;d--;)t[c[d].id]=this.getImageExternalDataId(c[d]);else if(o.ObjectController.modelIsVideo(e[l])){var u=(g=e[l]).getMedia(),p=!!u.getThumbnail();if(o.MediaController.isStoryHostedVideo(u))if(o.StoryController.getUploadStatus(u)!=o.UploadStatus.Completed)i.push(g.id),p=!1;else{C=o.MediaController.calculateVideoPlayerDescriptor(u);r[g.id]=C}p&&(t[u.getThumbnail().id]=this.getImageExternalDataId(u.getThumbnail()))}else if(o.ObjectController.modelIsAudio(e[l])){var g=e[l],h=g.getMedia();if(o.MediaController.isStoryHostedAudio(h))if(o.StoryController.getUploadStatus(h)!=o.UploadStatus.Completed)a.push(g.id);else{var C=o.MediaController.calculateAudioPlayerDescriptor(h);s[g.id]=C}}if(e[l]instanceof n.SpecifiedGroup||e[l]instanceof n.Set){var f=o.StoryController.getGroupChildren(e[l]).getCollection();if(StoryApp.Utilities.arrayContainsAtLeastOneNonNullValue(f)){var m=this.getAdditionalData(f);t=StoryApp.Utilities.mergeDictionaries(t,m.externalDataIdMap),i=i.concat(m.videoPlaceholderIds),r=StoryApp.Utilities.mergeDictionaries(r,m.storyHostedVideoIds),a=a.concat(m.audioPlaceholderIds),s=StoryApp.Utilities.mergeDictionaries(s,m.storyHostedAudioIds)}}}return{externalDataIdMap:t,videoPlaceholderIds:i,storyHostedVideoIds:r,audioPlaceholderIds:a,storyHostedAudioIds:s}},s.prototype.isInTextAreaOrRTE=function(){return!(!(s.isFocusInRTE()||this.isInTextArea()||this.isTextSelected())||0!==this._cardSelectionManager.getSelection().length)},s.prototype.isTextSelected=function(){return this.getSelectedText().length>0},s.prototype.getSelectedText=function(){var e="";return window.getSelection?e=window.getSelection().toString():document.getSelection()&&(e=document.getSelection().toString()),e},s.prototype.isInTextArea=function(){var e=["input","textarea"],t=StoryApp.Utilities.getDocumentActiveElement();return!!t&&ArrayExtensions.contains(e,t.tagName.toLowerCase())},s.updateCopyInfo=function(e,t,i,r){if(e)for(var a=e.length;a--;){var l=e[a];if(o.StoryController.isModelObjectValid(l))if(o.ObjectController.modelIsImage(l)){var c=l.getMedia();s.updateImageParts(c.imageParts.getCollection(),t,!1,i,r)}else if(o.ObjectController.modelIsVideo(l)){var d=l.getMedia(),u=o.MediaController.isStoryHostedVideo(d);s.updateImageParts(new Array(d.getThumbnail()),t,u,i,r)}else if(o.ObjectController.modelIsAudio(l)){var p=l.getMedia();o.MediaController.isStoryHostedAudio(p)&&s.updateAudioCopyInfo(p,i,r)}else if(l instanceof n.Set||l instanceof n.SpecifiedGroup){var g=o.StoryController.getGroupChildren(l).getCollection();StoryApp.Utilities.arrayContainsAtLeastOneNonNullValue(g)&&s.updateCopyInfo(g,t,i,r)}}},s.updateImageParts=function(e,t,o,i,r){for(var a=e.length;a--;){var s=e[a];if(s){var l=StoryApp.Utilities.findKeyForValue(i,s.id);if(l){var c=t[l];if(c||o){var d=new n.CopyInfo;d.setLookupId(r),d.setOriginId(c||""),s.setCopyInfo(d)}}else StoryLog.StructuredTraceTag(596473568,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.warning,"updateImageParts: Couldn't find new image part id in the objIds map",{NewImagePartId:s.id})}}},s.updateAudioCopyInfo=function(e,t,o){if(StoryApp.Utilities.findKeyForValue(t,e.id)){var i=StoryEditPageMain.MediaPlayerDescriptorHandlerFactory.createAudioHandler(e.getDecompInfo().getProvider()).GetOriginalDescriptor(e.getAudioPlayerDescriptor()),r=new n.CopyInfo;r.setLookupId(o),r.setOriginId(i),e.setCopyInfo(r)}else StoryLog.StructuredTraceTag(596473569,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.warning,"updateAudioCopyInfo: Couldn't find new audio id in the objIds map",{NewAudioId:e.id})},s.isFocusInRTE=function(){var e=StoryApp.Utilities.getDocumentActiveElement();if(e){var t=e.getAttribute("class");if(t)return-1!==t.search("ms-rtestate-write")}return!1},s.getPropertyValues=function(e,t){for(var n=[],o=0,i=t;o<i.length;o++){var r=i[o];r.hasOwnProperty(e)&&n.push(r[e])}return n},s}(t.CopyPasteImplementationBase);t.CardDeckCopyPasteHandler=s}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=StoryApp.Common,i=StoryApp.View.Common.FRE,r=e.Server.AuthorsManager,a=e.View.ViewModel,s=function(e){function s(t,n){var o=e.call(this,t,n)||this;return o.model=n,o.shareEnabled=TDB.watcher(o,o,o.calculateShareEnabled),o}return __extends(s,e),s.prototype.getShareDropdown=function(){return this.shareDropdown},s.prototype.shareButtonArgs=function(){var e=this,t={buttonId:ClientAction.ButtonId.TopMenu_Share,click:this.shareClick,context:this,cssClass:{value:"AppBarFarSideButton"},tooltip:{value:Resources.SharingToggleSwitchLabel},description:{value:Resources.SharingToggleSwitchLabel},domId:StoryApp.Common.TelemetryConstants.appBarShareButtonId,calculateChecked:this.isFlyoutOpen,enabled:o.Environment.getInstance().getClientOnline(),fontIconArgs:{value:{fontIconName:{value:FontIcons.CoAuthorHeaderButtonIcon},fontIconSizeClass:FontIcons.CoAuthorHeaderButtonIconSize,fontIconWrapperClass:{value:"headerBarFontIconWrapper"}}},shortcutIdentifiers:["Alt+Shift+SKey"],shortcutProcessor:n.DomEventRegister.getInstance().getRootPanelElement(),textClass:"headerFarButtonText headerFarButtonTextDynamic",collapsed:{compute:new TDB.ComputedOptionArgs(this,this.getCollapsed)},textElementText:{value:Resources.Share},telemetryId:StoryApp.Common.TelemetryConstants.appBarShareButtonId,hasPopup:!0,calloutArgs:{compute:new TDB.ComputedOptionArgs(this,function(e){return i.getFirstRunManager().isPublishEntryPoint?i.CalloutArgsCreator.createArgsForDigitalPrintShare():i.CalloutArgsCreator.createArgsForShareButton(e)})},visible:{compute:new TDB.ComputedOptionArgs(this,this.getVisible)},superScriptText:{compute:new TDB.ComputedOptionArgs(this,function(t){var n=r.currentAuthorsManager().get(e.pageId);if(n.hasSwspEditors(t)){var o=n.getSwspEditors(t).filter(function(e){return!0===e.getOnlineStatus()}).length;return o>0?o.toString():null}return null})},superScriptClassName:{value:"authorsFontIconSuperScript"}};return new TDB.ChildArgs(n.ToggleButtonVE,t)},s.prototype.shareDropdownArgs=function(){var e=this,n=new a.ShareDropdownViewModel({shareEnabled:this.shareEnabled,titleWatcher:this.model.args.titleWatcher,sharingManager:this.model.args.sharingManager,authorsManager:r.currentAuthorsManager().get(this.pageId),getStoryTitle:this.model.args.getStoryTitle,context:a.ShareDropdownContext.Edit,showLinkTypeSelector:!0,showEmbedButton:!0});return new TDB.ChildArgs(t.ShareDropdownVE,{getControllingElement:function(){return e.shareButton},visible:this.model.dropdownVisible,model:n})},s.prototype.calculateShareEnabled=function(e){return this.model.args.sharingManager.getCurrentSharingLevel(e)!==StoryAudience.Owner||CommonSettings.IsTenantUser},s.prototype.isFlyoutOpen=function(e){return this.model.dropdownVisible.getWatchedValue(e)},s.prototype.shareClick=function(e){return this.model.shareClick(e)},s}(n.CustomMenuControl);t.ShareHeaderVEBase=s}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=StoryApp.View.Common.FRE,o=function(){function o(n){this.args=n,this.dropdownVisible=TDB.watchableTag(596132103,this,!1),this.menuItem=new t.CollapsibleMenuItem({primaryArgs:this,primaryType:e.ShareHeaderVE,stateMap:t.MenuItem.createStaggeredGlyphButtonStateMap()})}return o.prototype.getOverflowArgs=function(){var e={context:this,click:this.shareClick,text:{value:Resources.Share},buttonId:ClientAction.ButtonId.TopMenu_Share,telemetryId:StoryApp.Common.TelemetryConstants.appBarShareOverflowButtonId};return{type:t.OverflowMenuChildType.GlyphButton,label:t.OverflowButtonLabel.Share,args:e,visible:this.menuItem.getOverflowVisibility(),category:t.OverflowMenuCategory.Overflow}},o.prototype.shareClick=function(e){var t=this;if(n.getCalloutManager().getCurrentCalloutID()===n.CalloutID.DigitalPrintShare){var o=n.getCalloutManager().getCallout(n.CalloutID.DigitalPrintShare);o.dismissCallback=function(){n.FirstRunTriggers.digitalPrintShareCalloutDismissed=!0},o.dismissCallout(!0)}else this.dropdownVisible.getValue()||n.FirstRunTriggers.shareButtonClicked();return this.args.isEditMode.getValue()?(TDB.applyUpdate(function(){t.dropdownVisible.setValue(!t.dropdownVisible.getValue())}),TDB.EventPropagation.PreventDefault):TDB.EventPropagation.Bubble},o}();e.ShareHeaderViewModel=o}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(){}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.setInstance=function(t){e.instance=t},e.prototype.isAvailable=function(){return!1},e.prototype.execute=function(e){},e}();e.CameraAction=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t,n){var o=e.call(this,t)||this;return o.isVisible=n.isVisible,o}return __extends(t,e),t.prototype.wrapperFadeVisibleInitArgs=function(){return{transitionIn:"opacity .25s ease",transitionOut:"opacity .25s ease",visibleInit:!1}},t.prototype.wrapperFadeVisibleArgs=function(e){return{visible:this.isVisible.getWatchedValue(e)}},t.prototype.descriptionTextArgs=function(e){return Resources.OfflineVellumDescription},t}(TDB.ViewElement);e.OfflineVellumVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=function(){function e(){}return e.isAvailable=function(e,t,o,i){if(!t||!t.parent)return!1;if(!n.StoryController.isModelObjectValid(t.parent))return!1;var r=n.ObjectController.getBlueprint(t.parent,o,i);return(r.controller instanceof n.GroupController||r.controller instanceof n.SetController)&&r.controller.canAddBlueprints(e,t,i)},e.execute=function(t,o,i,r,a){var s=n.ObjectController.getBlueprint(o.parent,i,a);s.controller instanceof n.ContainerController&&s.controller.add(t,o),e.logAdd(t,i,r,o.parent)},e.logAdd=function(e,t,o,i){for(var r=[],a=e.length,s=0;s<a;s++)r.push(e[s].model);for(var l=new n.CardDefinitionManager(t),c=n.currentStoryController().get(t).getLoggableContentTypes(r,l),d=i?i.id:void 0,u=i?n.currentStoryController().get(t).getLoggableContentTypes([i],l)[0]:void 0,s=0;s<a;s++)ActionLogger.RecordClientAction(new ClientAction.AddActionData(o,c[s],d,u))},e}();t.AddAction=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=StoryApp.Model.RM,i=e.Model.AuthoringModel,r=function(){function e(){}return e.isAvailable=function(e,t,n){if(void 0===n&&(n=void 0),!i.StoryController.modelObjectsAreValid(e))return!1;for(var r=e.length,a=0;a<r;a++){var s=e[a];if(!s.storyModel.getModelObject(s.id))return!1;if(i.ObjectController.modelIsSwayTitle(s,t)||null!=n&&n===o.ContentType.Title)return!1}return!0},e.execute=function(o,r,a,s){if(e.isAvailable(o,r)){for(var l=[],c=o.length,d=0;d<c;d++)l.push(o[d].id);var u=new i.CardDefinitionManager(r),p=i.currentStoryController().get(r).getLoggableContentTypes(o,u),g={};if(o&&o.length>0&&o[0]&&t.TextCardViewModel.isPullQuote(o[0])&&(g.isPullQuote=!0),ActionLogger.RecordClientAction(new ClientAction.StorylineActionData(ClientAction.ActionType.DeleteContent,a,l,p,!0,g)),s)s.removeContent(o);else for(d=0;d<o.length;d++)i.ObjectController.modelIsCaption(o[d],r)?t.DeleteCaptionAction.execute([o[d]],r):i.ObjectController.modelIsSectionTitle(o[d],r)?t.DeleteHeaderAction.execute(o[d],r):i.ObjectController.modelIsSwayTitle(o[d],r)||(o[d]instanceof n.Paragraph?t.DeleteParagraphAction.execute([o[d]],r):i.currentStoryController().get(r).removeSpecifiedGroupChild(o[d]))}},e}();t.DeleteAction=r}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=function(){function e(){}return e.isAvailable=function(e,t){return!(!o.StoryController.modelObjectsAreValid(e)||1!=e.length)&&o.ObjectController.modelIsCaption(e[0],t)},e.execute=function(t,i){if(e.isAvailable(t,i)){var r=o.currentStoryController().get(i),a=r.findParent(t[0]);if(a instanceof n.MediaWithTextComposite){var s=a;r.clearCaption(s)}}},e}();t.DeleteCaptionAction=i}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=e.View.ViewElements,r=function(){function e(){}return e.isAvailable=function(e,t){return e instanceof n.TitleComposite&&o.StoryController.isModelObjectValid(e)&&!o.ObjectController.modelIsSwayTitle(e,t)},e.execute=function(t,r){if(e.isAvailable(t,r)){var a=o.currentStoryController().get(r),s=o.currentGroupController().get(r),l=a.findContainingGroup(t),c=[],d=[];l.children.getCollection().forEach(function(e){e instanceof n.SpecifiedGroup?c.push(e):d.push(e)});var u,p;if(0!==d.length&&(u=i.AuthoringHelperMethods.convertModelsToCards(d,r),p=e.getInsertionPointForContent(l,a),s.add(u,p)),0!==c.length)if(u=i.AuthoringHelperMethods.convertModelsToCards(c,r),(p=e.getInsertionPointForSubgroup(l,a)).parent===a.getRootGroup())for(var g=c.length-1;g>=0;g--)a.addSpecifiedGroupChild(c[g],p.parent,p.index);else s.add(u,p);a.removeSpecifiedGroupChild(l)}},e.getInsertionPointForContent=function(e,t){var o=t.findParent(e);if(o!==t.getRootGroup()){var i=o.children.getCollection(),r=i.indexOf(e);return 0!==r&&i[r-1]instanceof n.SpecifiedGroup?{parent:i[r-1],index:i[r-1].children.getCollection().length}:{parent:o,index:r}}var a=o.children.getCollection(),s=a.indexOf(e);if(0!==s){var l=a[s-1];if(l.getHeading()){var c=t.getLastGroup(l)||l;return{parent:c,index:c.children.getCollection().length}}return{parent:l,index:l.children.getCollection().length}}var d=t.createGroup();return t.addSpecifiedGroupChild(d,o,0),{parent:d,index:0}},e.getInsertionPointForSubgroup=function(e,t){var n=t.getRootGroup(),o=n.children.getCollection(),i=o.indexOf(e);if(0!==i){var r=o[i-1];return r.getHeading()?{parent:r,index:r.children.getCollection().length}:{parent:n,index:1}}return{parent:n,index:0}},e}();t.DeleteHeaderAction=r}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=function(){function e(){}return e.isAvailable=function(e){return!(!o.StoryController.modelObjectsAreValid(e)||1!=e.length)&&e[0]instanceof n.TitleComposite},e.execute=function(t){e.isAvailable(t)&&t[0].getTitle().getContent().setText("")},e}();t.DeleteHeaderTextAction=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=function(){function e(){}return e.isAvailable=function(e){return!(!o.StoryController.modelObjectsAreValid(e)||1!=e.length)&&e[0]instanceof n.Paragraph},e.execute=function(t,i){if(e.isAvailable(t)){var r=o.currentStoryController().get(i),a=r.findParent(t[0]);r.removeSpecifiedGroupChild(t[0]),a instanceof n.TextGroup&&0!=a.children.getCollection().length&&r.removeSpecifiedGroupChild(a)}},e}();t.DeleteParagraphAction=i}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=function(){function e(){}return e.isAvailable=function(e){if(!o.StoryController.modelObjectsAreValid(e)||1!=e.length)return!1;var t=e[0];return!!t.storyModel.getModelObject(t.id)&&(t instanceof n.Paragraph||t instanceof n.TextGroup)},e.execute=function(t,n){e.isAvailable(t)&&n.shortTextUX.open(t[0],n.selectedParagraph)},e}();t.EditAction=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=function(){function e(){}return e.isAvailable=function(e){if(!n.StoryController.modelObjectsAreValid(e)||1!=e.length)return!1;var t=e[0];return!!t.storyModel.getModelObject(t.id)&&!!n.ObjectController.modelIsImage(t)},e.execute=function(t,n){if(e.isAvailable(t)){var o={model:t[0]};n.showEditImagePane(o)}},e}();t.EditImageAction=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=function(){function e(){}return e.isAvailable=function(e,t,n){if(!o.StoryController.modelObjectsAreValid(e))return!1;if(void 0===e[0])return!1;for(var i=e.length,r=0;r<i;r++){var a=e[r];if(!a.storyModel.getModelObject(a.id))return!1;var s=o.ObjectController.getBlueprint(a,t,n);if(!(s&&s.controller instanceof o.SetController))return!1;if(a.content.getCollection(n).length<=0)return!1}return!0},e.execute=function(t,i,r,a){if(e.isAvailable(t,a)){for(var s=o.currentStoryController().get(a),l=[],c=null,d=t.length;d--;)if(t[d]instanceof n.Set){var u=t[d];c||(c=u.content.getCollection()[0]),l=l.concat(o.StoryController.getGroupChildren(t[d]).getCollection()),s.moveChildrenToParent(u),s.removeSpecifiedGroupChild(u)}for(r.clearSelection(),d=l.length;d--;){var p=i.getCardForModelId(l[d].id);l[d]===c&&(p.activateItem(),p.setFocusWhenInDom()),r.setSelection(p,!0)}return c}},e}();t.SeparateAction=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=function(){function e(){}return e.isAvailable=function(e,t,i){if(!o.StoryController.modelObjectsAreValid(e))return!1;if(e.some(function(e){return e instanceof n.TextGroup})&&!e.every(function(e){return e instanceof n.TextGroup}))return!1;for(var r=e.length,a=0;a<r;a++){var s=e[a];if(void 0===s)return!1;if(!s.storyModel.getModelObject(s.id))return!1;if(!o.ObjectController.modelSupportsEmphasis(s,t,i))return!1}return!0},e.execute=function(t,o,i){if(e.isAvailable(t,i)&&o&&null!=o.emphasisLevel&&o.emphasisLevel!==n.EmphasisLevel.Auto)for(var r=t.length,a=0;a<r;a++){var s=t[a];if(s instanceof n.MediaWithTextComposite){var l=s;(u=l.getMedia().getEmphasis())==n.EmphasisLevel.Auto&&(u=n.EmphasisLevel.None),u!=o.emphasisLevel&&l.getMedia().setEmphasis(o.emphasisLevel)}else if(s instanceof n.Table){var c=s,d=s;(u=c.getImageRepresentation().getMedia().getEmphasis())==n.EmphasisLevel.Auto&&(u=n.EmphasisLevel.None),u!=o.emphasisLevel&&(d.setEmphasis(o.emphasisLevel),c.getImageRepresentation().getMedia().setEmphasis(o.emphasisLevel))}else{var u=(d=s).getEmphasis();u==n.EmphasisLevel.Auto&&(u=n.EmphasisLevel.None),u!=o.emphasisLevel&&d.setEmphasis(o.emphasisLevel)}}},e}();t.SetEmphasisAction=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=function(){function e(){}return e.isAvailable=function(t,i){if(!o.StoryController.modelObjectsAreValid(t))return!1;for(var r=t.length,a=0;a<r;a++){var s=t[a];if(!(s instanceof n.Set))return!1;if(!s.storyModel.getModelObject(s.id))return!1;try{if(!e.isGallery(s.getVisualization(i)))return!1}catch(e){return!1}}return!0},e.execute=function(t,o){if(e.isAvailable(t)&&o&&null!=o.visualization&&o.visualization!==n.Visualization.Auto)for(var i=t.length,r=0;r<i;r++){var a=t[r];if(a instanceof n.Set){var s=a,l=s.getVisualization();e.isGallery(l)&&l!=o.visualization&&s.setVisualization(o.visualization)}}},e.isGallery=function(e){return e===n.Visualization.Gallery||e===n.Visualization.GalleryWithThumbs||e===n.Visualization.GalleryContinuous},e}();t.SetGalleryStyleAction=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.Common,n=function(){function n(){}return n.isAvailable=function(e){return!0},n.execute=function(n,o){t.Environment.getInstance().isClientOnline()?o&&o.paneStateManager&&o.paneStateManager.showAddContentPane(o.sourceCardType):e.UploadMediaAction.getInstance().isAvailable()&&e.UploadMediaAction.getInstance().execute(null,{uploadElement:$("#fileToUpload"),cardsContainer:o.cardsContainer})},n}();e.ShowAddContentAction=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(){}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.setInstance=function(t){e.instance=t},e.prototype.isAvailable=function(e){return StoryPageEditSettings.LocalUploadEnabled},e.prototype.execute=function(e,t){if(t&&t.uploadElement)try{StoryApp.RethrowLogger.logIfError(function(){t.uploadElement.click()})}catch(e){StoryLog.TraceTag(596120342,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.warning,"Error executing upload media action")}},e}();e.UploadMediaAction=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=e.View.ViewModel,r=function(){function e(){}return e.isSerializedData=function(t){if(!t)return!1;try{var n=JSON.parse(t);return e.isAvailable(n.modelData)}catch(e){return!1}},e.isAvailable=function(e){if(!e||0===e.length)return!1;for(var t=e.length;t--;){var n=e[t].serializedModel;if(!n||!n.objType)return!1}return!0},e.execute=function(t,n){if(t&&t.objIds&&e.isAvailable(t.modelData)){for(var o=t.modelData,i=[],r=[],a=o.length,s=0;s<a;s++){var l=o[s].serializedModel;if(!l.objType)return;if(i.push(l.objType),!e.deserialize(o[s],r,t.objIds,t.videoPlaceholderIds,t.storyHostedVideoIds,t.audioPlaceholderIds,t.storyHostedAudioIds,n))return}t.addModelsToGraph&&StoryApp.Utilities.arrayContainsAtLeastOneNonNullValue(r)&&e.addDeserializedModels(r,t.cardsContainer,n,t.replaceSelectedCards);var c=new ClientAction.CardDeckDeserializeAction(i);return ActionLogger.RecordClientAction(c),r}},e.addDeserializedModels=function(e,n,o,r){TDB.applyUpdate(function(){var a=n.activeCard.getValue();if(a&&!r){if(0===(e=a.getViewModel().extraPastedModels(e)).length)return;if(a.shouldSplitOnPaste()){var s=a.getPrimaryInputElement();if(s&&t.CommonTextVE.getFocusedTextVE()===s){var l=s.getViewModel().getModel(),c=s.getModelIdForTextSelection();i.TextHelperMethods.splitTextGroup(l,c,!0,o)}}}n.addCardObjects(e),n.computeCardDeckElements()})},e.tryDeserializeData=function(t,i,r,a,s,l,c,d){if(!function(e,t){return!!e&&!!(t&&t instanceof Array)}(t,i))return!1;try{var u=new o.CardDefinitionManager(d),p=o.currentStoryController().get(d).getModel().deserialize(t.serializedModel,r);if((p=e.updateMedia(p,a,s,l,c,r,d))instanceof n.Paragraph){var g=n.TextGroup.Create(o.currentStoryController().get(d).getModel());g.children.add(p),p=g}return i.push(new o.Card({definition:u.getCardDefinition(t.cardType),model:p})),!0}catch(e){return StoryLog.StructuredTraceTag(596474011,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.warning,"Deserialization error",{Error:e}),!1}},e.updateMedia=function(t,i,r,a,s,l,c){if(t instanceof n.SpecifiedGroup||t instanceof n.Set){var d=o.StoryController.getGroupChildren(t).getCollection(),u=[];if(StoryApp.Utilities.arrayContainsAtLeastOneNonNullValue(d)){for(var p=0;p<d.length;p++){C=e.updateMedia(d[p],i,r,a,s,l,c);u.push(C)}t instanceof n.SpecifiedGroup?t.children.set(u):t.content.set(u)}return t}if(o.ObjectController.modelIsVideo(t)){if(!(h=StoryApp.Utilities.findKeyForValue(l,t.id)))throw StoryApp.RethrowLogger.createError("Video does not have serialized object id!");if(i&&ArrayExtensions.contains(i,h)){C=o.currentVideoController().get(c).create(null);return t.dispose(),l[h]=C.id,C}if(r&&r[h]){var g=t.getMedia();if(!o.MediaController.isStoryHostedVideo(g))throw StoryApp.RethrowLogger.createError("Video's Id was in the storyHostedVideoIds map, but it's not really a Story-hosted video!");m=g.getUploadInfo()&&g.getUploadInfo().getFileName();o.ObjectController.addUploadInfo(g,c,m);y=r[h];if(!(v=g.getDecompInfo()))throw StoryApp.RethrowLogger.createError("SM.VideoContent doesn't have DecompInfo!");y=(S=StoryEditPageMain.MediaPlayerDescriptorHandlerFactory.createVideoHandler(v.getProvider())).encodeFakeDescriptor(S.createCopyDescriptor(y)),g.setVideoPlayerDescriptor(y),g.getUploadInfo().setEndAttempt((new Date).toISOString())}}else if(o.ObjectController.modelIsAudio(t)){var h=StoryApp.Utilities.findKeyForValue(l,t.id);if(!h)throw StoryApp.RethrowLogger.createError("Audio does not have serialized object id!");if(a&&ArrayExtensions.contains(a,h)){var C=o.currentAudioController().get(c).create(null);return t.dispose(),l[h]=C.id,C}if(s&&s[h]){var f=t.getMedia();if(!o.MediaController.isStoryHostedAudio(f))throw StoryApp.RethrowLogger.createError("Audio's Id was in the storyHostedAudioIds map, but it's not really a Story-hosted audio!");var m=f.getUploadInfo()&&f.getUploadInfo().getFileName();o.ObjectController.addUploadInfo(f,c,m);var y=s[h],v=f.getDecompInfo();if(!v)throw StoryApp.RethrowLogger.createError("SM.AudioContent doesn't have DecompInfo!");var S=StoryEditPageMain.MediaPlayerDescriptorHandlerFactory.createAudioHandler(v.getProvider());y=S.encodeFakeDescriptor(S.createCopyDescriptor(y)),f.setAudioPlayerDescriptor(y),f.getUploadInfo().setEndAttempt((new Date).toISOString())}}return t},e.deserialize=function(t,n,o,i,r,a,s,l){return e.tryDeserializeData(t,n,o,i,r,a,s,l)},e}();t.DeserializeAction=r}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=function(){function e(){}return e.isAvailable=function(e,t){return!!o.StoryController.modelObjectsAreValid(e)&&(!(1==e.length&&e[0]instanceof n.Set)&&o.currentSetController().get(t).canTransform(e,{modelProperties:{visualization:n.Visualization.Auto}}))},e.execute=function(e,i){if(e&&e.modelObjects&&!(e.modelObjects.length<1)){var r={modelProperties:{visualization:n.Visualization.Auto},canCrossSetBoundaries:!0,destinationChild:e.modelObjects[0]},a=o.currentSetController().get(i).transform(e.modelObjects,r);if(a){var s=e.cardsContainer.getCardForModelId(a.id);platform.setTimeout(function(){s.activateItem(),t.ShowGroupTypePaneAction.execute(e.cardsContainer.getModelForActiveContent(),e.transformManager,e.paneStateManager)},100)}else StoryLog.StructuredTraceTag(596474010,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.warning,"Call to execute a group action failed to return a valid group",{SourceChildPath:e.modelObjects[1]?o.currentStoryController().get(i).getLoggableModelPath(e.modelObjects[1]):"",DestinationChildPath:o.currentStoryController().get(i).getLoggableModelPath(r.destinationChild),NestedSubGroupsEnabled:StoryPageEditSettings.NestedGroupingEnabled.toString(),NestedSubGroupsLimit:StoryPageEditSettings.NestedGroupingLimit.toString()})}},e}();t.GroupAction=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=function(){function e(){}return e.isAvailable=function(t){if(!o.StoryController.modelObjectsAreValid(t))return!1;for(var n=t.length,i=0;i<n;i++){var r=t[i];if(void 0===r)return!1;if(!r.storyModel.getModelObject(r.id))return!1;if(!e.modelTypeSupportsStrictSizing(r))return!1}return!0},e.modelTypeSupportsStrictSizing=function(e){return!!StoryPageEditSettings.StrictSizingAuthoringEnabled&&e instanceof n.EmbeddedContent},e.execute=function(t,o){if(e.isAvailable(t)&&o&&"boolean"==typeof o.strictSizing)for(var i=t.length,r=0;r<i;r++){var a=t[r];a instanceof n.EmbeddedContent&&a.setStrictSizing(o.strictSizing)}},e}();t.SetStrictSizingAction=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=function(){function e(){}return e.isAvailable=function(e){if(!e||0===e.length)return!1;for(var t=0;t<e.length;t++)if(!n.StoryController.isModelObjectValid(e[t].model))return!1;return!0},e.execute=function(t,o){var i=[];if(t.cardObjects.forEach(function(e){return i.push(e.model)}),t&&e.isAvailable(t.cardObjects)){return function(e){for(var r=[],a=e.length,s=0;s<a;s++)r.push(e[s].serialize());var l=new ClientAction.CardDeckSerializeAction(n.currentStoryController().get(o).getLoggableContentTypes(i,t.cardDefinitionManager));return ActionLogger.RecordClientAction(l),r}(t.cardObjects)}return null},e}();t.SerializeAction=o}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=function(){function e(){}return e.isAvailable=function(e,t){if(!o.StoryController.modelObjectsAreValid(e))return!1;for(var i=0;i<e.length;i++){var r=e[i];if(!r)return!1;if(!r.storyModel.getModelObject(r.id))return!1;if(!(r instanceof n.Set))return!1}return t.getAvailableTransforms(e).length>0},e.execute=function(n,o,i){e.isAvailable(n,o)&&i.showAuthoringPane(t.AuthoringPaneType.GroupType,!1)},e}();t.ShowGroupTypePaneAction=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=StoryApp.Common,i=StoryApp.View.Common.FRE,r=function(r){function a(n,a){var s=r.call(this,n,a)||this;s.model=e.Model.StoryModel,s._previewTriggered=!1,s._previousAuthoringState=null,s.whatsNewHelper=o.WhatsNewHelper.showWhatsNewDialogWithDelay(o.WhatsNewPage.Authoring,o.WhatsNewPlatform.Web),s.toggleStateTimeout=0;var l=i.getFirstRunManager().isPublishEntryPoint?t.StorylineMode.Collapsed:t.StorylineMode.Full;return s.storylineVisible=TDB.watchable(s,l===t.StorylineMode.Full),s}return __extends(a,r),a.prototype.constructNavigationSyncManager=function(){var e={storyPage:this};this.navigationSyncManager=new t.NavigationSyncManager(this,e)},a.prototype.getAuthoringModel=function(){return this._authoringModel},a.prototype.shouldNavigateToPreviewTarget=function(){return this._authoringModel.isCardDeckVisible()},a.prototype.getLastEditedContentId=function(){var t=e.Model.currentUndoManager().get(this.getPageId());if(!t)return null;var n=t.getLastUndoContext();return n&&n.activeModelObjectIds?ArrayExtensions.lastOrDefault(n.activeModelObjectIds):null},a.prototype.getActiveCardModelId=function(e){if(this._authoringModel&&this._authoringModel.cardDeckVE)return e?this._authoringModel.cardDeckVE.getActiveNavigatableCardModelId():this._authoringModel.cardDeckVE.getActiveCardModelId()},a.prototype.setup=function(e,o,i,a){var s=this;StoryPerformance.PerformanceManager.getInstance().measurePerformance("setupStoryPageEditVE",function(){r.prototype.setup.call(s,e,o,i,a),s.storyPageState={isEditMode:s.isEditMode},s._authoringModel=new t.AuthoringPageVE(s,s.args.authoringPageArgs),s.createEditAppBar(s.args.userState,s.args.currentStory),s.createAuthoringPlayAppBar(n.StoryPageVE.appBarButtonsToCreate(),n.StoryPageVE.overflowMenuButtonsToCreate()),s._authoringModel.setup(e,s.args.textAggregator,s.storylineVisible),s.surfaceAuthoring=new t.SurfaceAuthoringVE(s,{textAggregator:s.args.textAggregator,loggingSupport:s._authoringModel,viewModel:s,fileuploader:s._authoringModel.fileUploader,cardsContainer:s._authoringModel.cardDeckVE,cardDefinitionManager:s._authoringModel.cardDefinitionManager,paneStateManager:s._authoringModel.getPaneStateManager(),cardSelectionManager:s._authoringModel.cardDeckVE.getSelectionManager(),cardFactory:s._authoringModel.cardDeckVE.cardFactory,sharingManager:s.args.sharingManager,authoringModel:s._authoringModel,storyPage:s,viewMode:e}),StoryApp.Utilities.query.fetch(StoryApp.Common.UrlHelper.URLParamDone)&&s.showFirstRunNewUserDialog()})},a.prototype.paneHolderClassNameArgs=function(e){return"pane-holder"},a.prototype.addAppBarButtonIfIncluded=function(e,t){ArrayExtensions.contains(this.args.appBarButtonsToCreate,e)&&t.push({type:n.AppBarChildType.BuiltIn,label:e})},a.prototype.createEditAppBar=function(e,t){var o=this;StoryPerformance.PerformanceManager.getInstance().measurePerformance("createEditAppBar",function(){var i=[];o.addAppBarButtonIfIncluded(n.AppBarButtonLabel.Home,i),o.addAppBarButtonIfIncluded(n.AppBarButtonLabel.DeveloperCdn,i),o.addAppBarButtonIfIncluded(n.AppBarButtonLabel.InternalFeatures,i),ArrayExtensions.contains(o.args.appBarButtonsToCreate,n.AppBarButtonLabel.Play)&&i.push(o.createPlayButton()),ArrayExtensions.contains(o.args.appBarButtonsToCreate,n.AppBarButtonLabel.Cast)&&(StoryApp.Common.UrlHelper.getInstance().getCastRedirectLink()||CommonSettings.Branding==StoryBrandingMode.DocsJournal||CommonSettings.Branding==StoryBrandingMode.DocsAbout)?i.push(o.createCastDoneHeader()):ArrayExtensions.contains(o.args.appBarButtonsToCreate,n.AppBarButtonLabel.Share)&&StoryApp.Common.Branding.shareButtonVisible()&&i.push(o.createShareHeader(o.titleWatcher));var r=ArrayExtensions.contains(o.args.appBarButtonsToCreate,n.AppBarButtonLabel.Overflow),a=[];r&&o.createOverflowButtons(a),o.editAppBar=new n.AppBarVE(o,{buttons:i,overflowButtons:a,isEditMode:!0,userState:e,currentStory:t,resourceFactory:o.args.resourceFactory,alwaysShowOverflowButton:r}),o.addResource(o.editAppBar)})},a.prototype.createAuthoringPlayAppBar=function(e,n){if(this.appBar&&(this.removeResource(this.appBar),this.appBar.dispose()),StoryApp.Common.Environment.getInstance().shouldDisplayConsumptionAppBar(StoryPageSettings.IsNativeClient)){var o={isEmbedMode:this.isEmbeddedMode,inEmbedHostMode:this.inEmbedHostMode,userState:this.args.userState,currentStory:this.args.currentStory,autoPlayDriver:this.getAutoPlayDriver(),resourceFactory:this.args.resourceFactory,sharingManager:this.getSharingManager(),isAnimationsDisabled:this.parent.animationDisabled,overflowButtons:this.getOverflowButtons(n),buttons:r.prototype.getAppBarGroups.call(this,e),verticalPadding:{compute:new TDB.ComputedOptionArgs(this,this.getTopPosition)},titleWatcher:this.titleWatcher};this.appBar=new t.AuthoringPlayAppBarVE(this,o),this.addResource(this.appBar)}},a.prototype.createOverflowButtons=function(e){if(this.addOverflowMenuButtonIfIncluded(n.OverflowButtonLabel.InternalFeatures,e,this.args.overflowMenuButtonsToCreate,n.OverflowMenuCategory.Settings),this.addOverflowMenuButtonIfIncluded(n.OverflowButtonLabel.PremiumFeatures,e,this.args.overflowMenuButtonsToCreate,n.OverflowMenuCategory.Settings),this.createSwayManagementButtons(e),StoryPageEditSettings.SwaySettingsPaneEnabled&&ArrayExtensions.contains(this.args.overflowMenuButtonsToCreate,n.OverflowButtonLabel.SwaySettingsPane)&&e.push({type:n.OverflowMenuChildType.BuiltIn,label:n.OverflowButtonLabel.SwaySettingsPane,context:this,click:this.openSwaySettingsPane,category:n.OverflowMenuCategory.Settings}),this.addOverflowMenuButtonIfIncluded(n.OverflowButtonLabel.TutorialVideos,e,this.args.overflowMenuButtonsToCreate,n.OverflowMenuCategory.Navigation),this.addOverflowMenuButtonIfIncluded(n.OverflowButtonLabel.Help,e,this.args.overflowMenuButtonsToCreate,n.OverflowMenuCategory.Global),this.addOverflowMenuButtonIfIncluded(n.OverflowButtonLabel.User,e,this.args.overflowMenuButtonsToCreate,n.OverflowMenuCategory.Global),StoryPageSettings.AccessibilityCheckerEnabled&&ArrayExtensions.contains(this.args.overflowMenuButtonsToCreate,n.OverflowButtonLabel.AccessibilityChecker)&&e.push({type:n.OverflowMenuChildType.BuiltIn,label:n.OverflowButtonLabel.AccessibilityChecker,context:this,click:this.openAccessibilityChecker,category:n.OverflowMenuCategory.Settings}),ArrayExtensions.contains(this.args.overflowMenuButtonsToCreate,n.OverflowButtonLabel.AccessibilityView)){var t=StoryApp.Common.Environment.getInstance().canOpenNewTab();e.push({type:n.OverflowMenuChildType.BuiltIn,label:n.OverflowButtonLabel.AccessibilityView,useNewTab:t,category:n.OverflowMenuCategory.Settings})}this.addOverflowMenuButtonIfIncluded(n.OverflowButtonLabel.SignOut,e,this.args.overflowMenuButtonsToCreate,n.OverflowMenuCategory.Global)},a.prototype.createSwayManagementButtons=function(e){StoryApp.Common.Branding.swayManagementVisible()&&(this.addOverflowMenuButtonIfIncluded(n.OverflowButtonLabel.MyStories,e,this.args.overflowMenuButtonsToCreate,n.OverflowMenuCategory.Navigation),this.addOverflowMenuButtonIfIncluded(n.OverflowButtonLabel.CreateNew,e,this.args.overflowMenuButtonsToCreate,n.OverflowMenuCategory.File),ArrayExtensions.contains(this.args.overflowMenuButtonsToCreate,n.OverflowButtonLabel.DuplicateStory)&&a.shouldCreateDuplicateButton()&&e.push({type:n.OverflowMenuChildType.BuiltIn,label:n.OverflowButtonLabel.DuplicateStory,context:this,getStoryTitle:ModelHelper.getStoryTitleText,category:n.OverflowMenuCategory.File}),ArrayExtensions.contains(this.args.overflowMenuButtonsToCreate,n.OverflowButtonLabel.SaveAsTemplate)&&a.shouldCreateSaveAsTemplateButton()&&e.push({type:n.OverflowMenuChildType.BuiltIn,label:n.OverflowButtonLabel.SaveAsTemplate,context:this,getStoryTitle:ModelHelper.getStoryTitleText,category:n.OverflowMenuCategory.File}),a.shouldCreatePrintButton()&&this.addOverflowMenuButtonIfIncluded(n.OverflowButtonLabel.PrintStory,e,this.args.overflowMenuButtonsToCreate,n.OverflowMenuCategory.File),a.shouldCreateExportButton()&&this.addOverflowMenuButtonIfIncluded(n.OverflowButtonLabel.ExportStory,e,this.args.overflowMenuButtonsToCreate,n.OverflowMenuCategory.File),CommonSettings.EnableStoryDownload&&this.addOverflowMenuButtonIfIncluded(n.OverflowButtonLabel.Download,e,this.args.overflowMenuButtonsToCreate,n.OverflowMenuCategory.File))},a.shouldCreateDuplicateButton=function(){return!CommonSettings.BlockDuplicationFeature&&(!StoryPageSettings.AuthorBlockDuplication||StoryPageSettings.IsOwner)},a.shouldCreateSaveAsTemplateButton=function(){return a.shouldCreateDuplicateButton()&&CommonSettings.IsPaidUser},a.shouldCreatePrintButton=function(){return CommonSettings.IsExportStoryEnabled},a.shouldCreateExportButton=function(){return CommonSettings.IsExportStoryEnabled},a.prototype.openAccessibilityChecker=function(e){return this._authoringModel.getPaneStateManager().showAccessibilityCheckerPane(),TDB.EventPropagation.Bypass},a.prototype.openSwaySettingsPane=function(e){return this._authoringModel.getPaneStateManager().showSwaySettingsPane(),TDB.EventPropagation.Bypass},a.prototype.createPlayButton=function(){var e={context:this,click:this.toggleEditMode,fontIconName:{value:FontIcons.PlayHeaderButtonIcon},fontIconSizeClass:FontIcons.PlayHeaderButtonIconSize,buttonId:ClientAction.ButtonId.AppBar_Preview,description:{value:Resources.Play},tooltip:{value:Resources.AppBarPlayButtonDescription},calloutArgs:{value:i.getFirstRunManager().isPublishEntryPoint?i.CalloutArgsCreator.createArgsForDigitalPrintPlay():i.CalloutArgsCreator.createArgsForPlayButton()},telemetryId:"",cssClass:{value:"headerFarButtonDynamic PlayHeaderButtonFontIcon"},hasPopup:void 0,text:{value:Resources.Play},textClass:"headerFarButtonText headerFarButtonTextDynamic",fontIconWrapperClass:void 0,wrapperClassName:"PlayHeaderButtonWrapper",shortcutIdentifiers:["Alt+Shift+PKey"]};return{type:n.AppBarChildType.CalloutGlyphButton,label:n.AppBarButtonLabel.Preview,overflowLabel:n.OverflowButtonLabel.Preview,args:e,isFar:!0,stateMap:n.MenuItem.createStaggeredGlyphButtonStateMap(),category:n.OverflowMenuCategory.Navigation}},a.prototype.createShareHeader=function(e){var o={titleWatcher:e,getRestoreUrl:this.getRestoreUrl,isEditMode:this.isEditMode,sharingManager:this.args.sharingManager,getStoryTitle:function(){return ModelHelper.getStoryTitleText()}},i=new t.ShareHeaderViewModel(o);return{type:n.AppBarChildType.UnknownElement,label:n.AppBarButtonLabel.Share,menuItem:i.menuItem,overflowArgs:i.getOverflowArgs(),isFar:!0}},a.prototype.createPanelsHeader=function(){return new t.PanelsHeaderViewModel({paneStateManager:this._authoringModel.getPaneStateManager(),pageId:this.pageId})},a.prototype.createUndoHeader=function(){return new t.UndoHeaderViewModel({pageId:this.pageId})},a.prototype.createCastDoneHeader=function(){var e=new n.StaticMenuItem({primaryType:t.CastDoneHeaderVE,primaryArgs:{syncManager:this.args.syncManager}});return{type:n.AppBarChildType.UnknownElement,label:n.AppBarButtonLabel.Cast,menuItem:e,isFar:!0}},a.prototype.nlDesignStory=function(t,n){var o=this;return this.blockingUpdate.getValue()||(this._authoringModel.isCardDeckVisible()&&this._authoringModel.setStorylineMode(),e.Model.currentUndoManager().get(this.getPageId()).captureUserAction(function(){TDB.applyUpdate(function(){o._authoringModel.styleManager.changeStyles(n)})},"User used nldesign")),TDB.EventPropagation.Bypass},a.prototype.getAppBarGroups=function(){var e=[];return this.createInternalFeaturesGroup(e),this.createEditAppBarGroup(e),e.concat(r.prototype.getAppBarGroups.call(this,n.StoryPageVE.appBarButtonsToCreate()))},a.prototype.getPreviewWidth=function(e){var t=o.Environment.getInstance().getWindowSize(e).w,n=this._authoringModel.getPaneStateManager().getCurrentPaneWidthInPreview(e);return Math.max(t-n,UX.minChromelessTopBarWidth)},a.prototype.getPreviewHeight=function(e){var n=r.prototype.getPreviewHeight.call(this,e);return this.isEditMode.getWatchedValue(e)&&(n-=UX.topBarHeight,n-=t.SwayBarVE.SwayBarHeight),Math.max(n,UX.minPreviewHeight)},a.prototype.isStorylineModeActive=function(){return!!this._authoringModel&&this._authoringModel.getStorylineMode()===t.StorylineMode.Full},a.prototype.createEditAppBarGroup=function(e){var t={buttonId:ClientAction.ButtonId.AppBar_Edit,click:this.toggleEditMode,text:{value:Resources.Edit},textPlacementRight:!0,textClass:"headerFarButtonText headerFarButtonTextDynamic",context:this,description:{value:Resources.ConsumptionEditSwaySettingsButtonDescription},tooltip:{value:Resources.ConsumptionEditSwaySettingsButtonDescription},fontIconName:{value:FontIcons.PreviewEditIcon},fontIconSizeClass:FontIcons.PreviewEditIconSize,cssClass:{value:n.StoryAppBarButtonGroupVEBase.getConsumptionTextButtonClass()}};e.push({label:n.AppBarButtonLabel.Edit,type:n.GlyphButtonVE,args:t})},a.prototype.toggleEditMode=function(e){i.getCalloutManager().getCurrentCalloutID()===i.CalloutID.DigitalPrintPlay&&i.getCalloutManager().clearCallouts();var t=this.getViewContext(!1),r=this.getViewContext(!0);this.isEditMode.getValue()&&(this._previousAuthoringState=t),o.NavigationContext.IsAuthoringPlay=this.isEditMode.getValue();var a=this.toggleState(),s=n.ViewModel.previewVE._root.getValue().getHistorian();return StoryPageSettings.EnableEditModeTraversalHistory&&s&&s.traverse({startState:t,endState:r,contextName:this.className(),toggleState:"toggleState",historicallyRelevant:!0,animation:!1}),a},a.prototype.toggleState=function(){var e=this,t=this.isEditMode.getValue();if(t){if(n.NavigationHelper.hasContentOverflow()?i.StoryEditFirstRunHelper.triggerPlayEntered():i.FirstRunTriggers.playEnteredNoOverflow(),i.CommonFirstRunHelper.playEntered||(i.CommonFirstRunHelper.playEntered=!0),StoryPageEditSettings.PlayForcesFullNavigate)return StoryApp.Utilities.assignWindowLocation(StoryApp.Common.UrlHelper.getInstance().playUrl(StoryPageSettings.LookupId)),TDB.EventPropagation.Bypass}else i.FirstRunTriggers.returnToAuthoringClicked();return this.toggleStateTimeout=platform.setTimeout(function(){e._authoringModel.toggleEditControls(),e.previewVE&&e.previewVE._root.getValue()._interactionEngine.handleClientSignal({signal:n.ClientSignal.EditMode,editMode:!t}),TDB.applyUpdate(function(){e.editAppBar.notifyMenuRefresh.notify()}),e.toggleStateTimeout=0},100),TDB.EventPropagation.Bypass},a.prototype.getViewContext=function(e){return e?this._authoringModel.getNextToggleState():this._authoringModel.getViewContext()},a.prototype.appBarArgs=function(e){return this.getAppBar(e)},a.prototype.getAppBar=function(e){return this.isEditMode.getWatchedValue(e)?this.editAppBar:this.appBar},a.prototype.getTopPosition=function(e){return this.isEditMode.getWatchedValue(e)?n.StoryPageVEBase._highTopPx:r.prototype.getTopPosition.call(this,e)},a.prototype.authoringPageArgs=function(){return this._authoringModel.getFocusableViewElement()},a.prototype.surfaceAuthoringArgs=function(){return this.surfaceAuthoring},a.prototype.offlineVellumArgs=function(){var e=this,n={isVisible:TDB.watcher(this,this,function(t){return!e.isRenderRootEnabled.getWatchedValue(t)})};return new t.OfflineVellumVE(this,n)},a.prototype.triggerPreviewCallout=function(e){if(!this._previewTriggered){StoryApp.Model.RenderModel.getWatchedValue(e).getEditVersion(e);var t=StoryEditPageMain.FREHelper.hasContentThreshold(e);!this._previewTriggered&&t&&(this._previewTriggered=i.FirstRunTriggers.thresholdContentAdded(!1))}return!1},a.prototype.isStoryPageEdit=function(){return!0},a.prototype.isCardDeckFullScreen=function(e){return this._authoringModel.isCardDeckFullScreen(e)},a.prototype.handleMouseClick=function(e,t){return this.surfaceAuthoring.handleMouseClick(e,t)},a.prototype.deselectElements=function(){return this.surfaceAuthoring.deselectElements()},a.prototype.keyDown=function(e){switch(e.keyCode){case KeyCodeType.EscapeKey:if(this.isPreviewMode.getValue())return this.toggleEditMode(e)}return TDB.EventPropagation.Bubble},a.prototype.initDomFocus=function(){this._authoringModel.cardDeckVE.initDomFocus()},a.prototype.getPreviousAuthoringState=function(){return this._previousAuthoringState},a.prototype.getWhatsNewDialog=function(){return this.whatsNewHelper?this.whatsNewHelper.getCurrentDialog():null},a.prototype.computeIsAuthoringPaneOpen=function(e){return this._authoringModel.isCardDeckVisible(e)},a.prototype.computeIsRenderRootEnabled=function(e){return this.storyViewMode.getWatchedValue(e)!==StoryViewMode.Edit||o.Environment.getInstance().isClientOnline(e)},a.prototype.dispose=function(){this.toggleStateTimeout>0&&(clearTimeout(this.toggleStateTimeout),this.toggleStateTimeout=0),r.prototype.dispose.call(this)},a}(n.StoryPageVE);t.StoryPageEditVE=r}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Server.AuthorsManager,o=StoryApp.View.ViewElements,i=e.View.ViewModel,r=function(e){function r(t,n){var o=e.call(this,t,n)||this;return o.parent=t,o}return __extends(r,e),r.prototype.getShareMenu=function(){return this.shareDropdown},r.prototype.shareDropdownArgs=function(){var e=this,r=new i.ShareDropdownViewModel({shareEnabled:this.shareEnabled,titleWatcher:this.args.titleWatcher,sharingManager:this.args.sharingManager,authorsManager:n.currentAuthorsManager().get(this.pageId),context:i.ShareDropdownContext.Consumption,showLinkTypeSelector:!0,showEmbedButton:!0});return new TDB.ChildArgs(t.ShareDropdownVE,{getControllingElement:function(){return e.getButton(o.AppBarButtonLabel.Share)},visible:this.shareMenuVisible,model:r})},r.prototype.setShareDropdownVisibleState=function(e){this.shareMenuVisible.getValue()!==e&&(e?(this.setChildrenFocusability(!0),this.shareDropdown.show()):this.shareDropdown.hide())},r}(o.StoryAppBarVEBase);t.AuthoringPlayAppBarVEBase=r}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var EditVE=StoryAppEdit.View.ViewElements,StoryAppCommon=StoryApp.Common,FRE=StoryApp.View.Common.FRE,ModelHelper=StoryEditPageMain.ModelHelper,StoryAppEdit;!function(e){!function(t){!function(t){var n=function(){function t(e){this.authoringModel=e.authoringModel,this.storyPage=e.storyPage,this.authoringPanes={},this.authoringPanesChanged=TDB.notifierTag(596473544,this),this.storedPane=EditVE.AuthoringPaneType.None}return t.prototype.addPane=function(e,t){this.authoringPanes[e]=t},t.prototype.getAuthoringPane=function(e){var t=this.authoringPanes[e];return t||TDB.raiseRecoverableError("We should not have requested a pane that does not exist in our collection. Requested pane: "+EditVE.AuthoringPaneType[e]),t},t.prototype.hasAuthoringPane=function(e){return void 0!==this.authoringPanes[e]},t.prototype.getPaneVisible=function(e,t){return this.storyPage.isEditMode.getWatchedValue(t)&&this.authoringPanes&&this.hasAuthoringPane(e)?this.authoringPanes[e].visible.getWatchedValue(t):(t&&t.watch(this.authoringPanesChanged),!1)},t.prototype.hideAuthoringPane=function(t,n){var o=this;TDB.applyUpdate(function(){var n=o.getAuthoringPane(t);(n.isVisible()||n.isEntered())&&(n.setVisible(!1),n.exit(),o.authoringModel.notifyTabChange(EditVE.AuthoringPaneType.None),o.authoringModel.activateAppropriateRegion(),n.getTriggersSync()&&!o.authoringModel.isCardDeckVisible()&&e.Server.Sync.currentSyncManager().get(o.authoringModel.getPageId()).forceSync())})},t.prototype.hideAllAuthoringPanes=function(e){this.showAuthoringPane(EditVE.AuthoringPaneType.None,!1,e,!0)},t.prototype.storylineModeChanged=function(){var e=this.storedPane,t=this.getCurrentAuthoringPane();this.storedPane=t===EditVE.AuthoringPaneType.GroupType||t===EditVE.AuthoringPaneType.EditImage?EditVE.AuthoringPaneType.None:t,this.hideAllAuthoringPanes(),this.showAuthoringPane(e,!1,!1,!1,!0)},t.prototype.showAuthoringPane=function(t,n,o,i,r){var a,s=this;this.hasAuthoringPane(t)&&(a=this.getAuthoringPane(t)).visible.getValue()?TDB.applyUpdate(function(){s.authoringModel.notifyTabChange(t)}):(t===EditVE.AuthoringPaneType.Content&&a.getAddContent().filterByContentType(),t===EditVE.AuthoringPaneType.Design&&(this.getAuthoringPane(EditVE.AuthoringPaneType.Design).getContent().showMoodPane(),StoryLog.StructuredActivityTag(596460036,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.info,"StylesEntered","ModeSwitch: The user has entered styles.",StoryPageSettings.StoryId,{SwayLength:ModelHelper.getNumberOfStoryElements()})),TDB.applyUpdate(function(){if(!n)for(var l in s.authoringPanes)if(s.authoringPanes.hasOwnProperty(l)){var c=s.authoringPanes[l];c!==a&&(c.setVisible(!1),c.exit())}var d=s.authoringModel.getStorylineMode();if(a){var u=void 0;if(a.isCardDeckSupported())if(d===EditVE.StorylineMode.Full)u=d;else{var p=EditVE.StorylineMode.Full;u=n?d:p}else u=EditVE.StorylineMode.Collapsed;s.authoringModel.setStorylineMode(u,i),a.setVisible(!0),r||!a.getTriggersSync()||s.authoringModel.isCardDeckVisible()||e.Server.Sync.currentSyncManager().get(s.authoringModel.getPageId()).forceSync()}else o||s.authoringModel.activateAppropriateRegion();s.authoringModel.notifyTabChange(t)}),a&&a.activate())},t.prototype.toggleAuthoringPane=function(e){e!==EditVE.AuthoringPaneType.None?this.getAuthoringPane(e).visible.getValue()?this.hideAuthoringPane(e,!0):this.showAuthoringPane(e,!1):this.hideAllAuthoringPanes()},t.prototype.standardPaneVisible=function(e){return this.getPaneVisible(EditVE.AuthoringPaneType.GroupType,e)},t.prototype.showEditImagePane=function(e){var t=this,n=this.getAuthoringPane(EditVE.AuthoringPaneType.EditImage).getContent();TDB.applyUpdate(function(){t.hideAllAuthoringPanes(),t.showAuthoringPane(EditVE.AuthoringPaneType.EditImage,!1)}),n.setImage(e),n&&n.activate()},t.prototype.showAccessibilityCheckerPane=function(){this.hideAllAuthoringPanes(!0);var e=this.getAuthoringPane(EditVE.AuthoringPaneType.AccessibilityChecker).paneContentArgs();e&&e.showAccessibilityCheckerResultSummary(),this.showAuthoringPane(EditVE.AuthoringPaneType.AccessibilityChecker,!1)},t.prototype.showSwaySettingsPane=function(){this.showAuthoringPane(EditVE.AuthoringPaneType.SwaySettings,!0,!0);var e=this.getAuthoringPane(EditVE.AuthoringPaneType.SwaySettings).paneContentArgs();e&&e.showSettingsPane()},t.prototype.showAddContentPane=function(e){var t=this;this.hasAuthoringPane(EditVE.AuthoringPaneType.Content)&&(this.getCurrentAuthoringPane()===EditVE.AuthoringPaneType.Content&&FRE.StoryFirstRunHelper.reopeningContentPane(),TDB.applyUpdate(function(){t.hideAllAuthoringPanes(!0),t.getAuthoringPane(EditVE.AuthoringPaneType.Content).setSourceCardType(e),t.showAuthoringPane(EditVE.AuthoringPaneType.Content,!1)}))},t.prototype.activateAddContentPane=function(){this.hasAuthoringPane(EditVE.AuthoringPaneType.Content)&&this.getAuthoringPane(EditVE.AuthoringPaneType.Content).activate()},t.prototype.getCurrentAuthoringPane=function(e){for(var t in EditVE.AuthoringPaneType)if(!isNaN(+t)&&this.getPaneVisible(+t,e))return+t;return EditVE.AuthoringPaneType.None},t.prototype.hideStorylinePanes=function(){for(var e in this.authoringPanes)this.authoringPanes.hasOwnProperty(e)&&this.authoringPanes[+e].isCardDeckSupported()&&this.hideAuthoringPane(+e)},t.prototype.getAllAuthoringPanes=function(){return Obj.values(this.authoringPanes)},t.prototype.getCurrentPaneWidthInPreview=function(e){if(!this.storyPage.isEditMode.getWatchedValue(e))return 0;var n=StoryAppCommon.Environment.getInstance().getWindowSize(e).w;return this.getPaneVisible(EditVE.AuthoringPaneType.Design,e)||this.storedPane===EditVE.AuthoringPaneType.Design?n>=t.LargeWindowSize?t.SidePaneFourColWidth:n>t.MediumWindowSize?t.SidePaneThreeColWidth:t.SidePaneTwoColWidth:this.getPaneVisible(EditVE.AuthoringPaneType.EditImage,e)||this.storedPane===EditVE.AuthoringPaneType.EditImage?Math.ceil(n*t.AddContentPaneWidth):0},t.LargeWindowSize=1366,t.MediumWindowSize=1024,t.SmallWindowSize=768,t.SidePaneFiveColWidth=674,t.SidePaneFourColWidth=566,t.SidePaneThreeColWidth=428,t.SidePaneTwoColWidth=308,t.AddContentPaneWidth=.36,t}();t.PaneStateManager=n}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var VE=StoryApp.View.ViewElements,StoryAppEdit;!function(e){!function(t){!function(t){var n,o=e.Model.SM,i=e.Model.AuthoringModel,r=StoryApp.View.ViewElements,a=StoryApp.View.ViewElements.AuthoringState,s=StoryApp.View.ViewElements.DomEventRegister,l=StoryApp.View.Common.FRE,c=StoryApp.Common,d=e.View.ViewModel,u=e.Server.ContentSourcesManager,p=StoryEditPageMain.ModelHelper;!function(e){e[e.Collapsed=0]="Collapsed",e[e.Full=1]="Full"}(n=t.StorylineMode||(t.StorylineMode={}));var g=function(g){function h(o,r){var a=g.call(this,o)||this;a.navContainerSelector="div[id='container_sXZwem6PV3B']",a.authoringPageArgs=r,a.model=e.Model.StoryModel,a.controller=new i.StoryController(a.model,a.pageId),i.currentStoryController().set(a.pageId,a.controller),a.addContentPaneResize=TDB.notifierTag(596473570,a),a.styleManager=new e.View.Common.StyleManager(a),a.firstRunManager=new e.View.Common.FirstRunManager(a),a.addContentSourceDropdownFirstRun=TDB.watchableTag(596473571,a,!1),a.cardDefinitionManager=new i.CardDefinitionManager(a.pageId),a.cardDeckAnimationsComplete=TDB.notifierTag(596473600,a),a._lastOpenedAuthoringPane=t.AuthoringPaneType.None,a.preview=o.previewVE,a.storyPageState=o.storyPageState,a.textDirectionButtonsVisible=TDB.watchableTag(596473601,a,StoryPageEditSettings.TextDirectionControlEnabled),a.languages=TDB.watchableTag(596473602,a,[]),a.recordingDialogVisible=TDB.watchableTag(596473603,a,!1),a.cardDeckClassNameWatcher=TDB.watcherTag(596473604,a,a,a.calculateCardDeckClassName),c.Environment.getInstance().subscribeToIsClientOnline(a,a,a.handleIsClientOnlineChanged),a.addResource(e.Model.currentUndoManager().get(a.pageId).registerStatefulComponent(a,"authoringPage"));var s=l.getFirstRunManager().isPublishEntryPoint?n.Collapsed:n.Full;return a.storylineMode=TDB.watchable(a,s),a.paneStateManager=new d.PaneStateManager({authoringModel:a,storyPage:a.parent}),a}return __extends(h,g),h.prototype.setup=function(e,n,o){var i=this;StoryPerformance.PerformanceManager.getInstance().measurePerformance("setupAuthoringPageVE",function(){ActionLogger.RecordClientAction(new ClientAction.SimpleClientActionData(ClientAction.ActionType.OpenStoryline,Diag.ULSCat.msoulscat_Story_Storyline)),i._textAggregator=n,i.storylineVisible=o,i.cardDeckVE=new t.CardDeckVE(i,{authoringModel:i,paneStateManager:i.paneStateManager,model:i.model,activatable:TDB.watcherTag(596473607,i,i,i.isCardDeckVisible),resourceFactory:i.authoringPageArgs.resourceFactory}),i.fileUploader=new t.FileUploader(i,{cardsContainer:i.cardDeckVE,contentUploaderFactory:i.authoringPageArgs.contentUploaderFactory});var e=TDB.notifierTag(596473608,i);i.transformManager=new d.TransformManager({cardManager:i.cardDefinitionManager,loggingSupport:i,groupTypeChangeNotifier:e,cardsContainer:i.cardDeckVE,pageId:i.pageId}),i.cardDeckVE.setup(i.fileUploader);t.AuthoringPaneType.Navigation,i.paneStateManager,i.storyPageState;var r={content:void 0,paneType:t.AuthoringPaneType.Design,css:"SidePane",paneStateManager:i.paneStateManager,visibleCss:"SidePaneVisible",visibleCssModeSwitch:"SidePaneVisibleModeSwitch",lightDismiss:!1,storyPageState:i.storyPageState,triggersSync:!0},l={styleManager:i.styleManager,paneStateManager:i.paneStateManager,storyPageEdit:i.parent,authoringModel:i},c=new t.AuthoringPaneVE(i,r);c.setContent(new t.StylePaneVE(c,l)),i.paneStateManager.addPane(t.AuthoringPaneType.Design,c);var u={content:void 0,paneType:t.AuthoringPaneType.EditImage,css:"AddContentPane",paneStateManager:i.paneStateManager,visibleCss:"DesignPaneVisible",visibleCssModeSwitch:"DesignPaneVisibleModeSwitch",lightDismiss:!0,storyPageState:i.storyPageState,triggersSync:!0},p=new t.AuthoringPaneVE(i,u),g=new t.EditImagePaneVE(p,{paneStateManager:i.paneStateManager,authoringModel:i});p.setContent(g),i.paneStateManager.addPane(t.AuthoringPaneType.EditImage,p);var h={content:void 0,paneType:t.AuthoringPaneType.GroupType,css:"StandardPane",paneStateManager:i.paneStateManager,visibleCss:"StandardPaneVisible",visibleCssModeSwitch:"StandardPaneVisibleModeSwitch",lightDismiss:!0,storyPageState:i.storyPageState},C=new t.AuthoringPaneVE(i,h);C.setContent(new t.TransformChooserVE(C,{transformManager:i.transformManager,paneStateManager:i.paneStateManager,loggingSupport:i,cardDefinitionManager:i.cardDefinitionManager,cardsContainer:i.cardDeckVE})),i.paneStateManager.addPane(t.AuthoringPaneType.GroupType,C);var f={authoringPage:i};if(i.accessibilityChecker=new d.AccessibilityChecker(i,f),StoryPageSettings.AccessibilityCheckerEnabled){var m={content:void 0,paneType:t.AuthoringPaneType.AccessibilityChecker,css:"AddContentPane",paneStateManager:i.paneStateManager,visibleCss:"AddContentPaneVisible",visibleCssModeSwitch:"AddContentPaneVisibleModeSwitch",lightDismiss:!1,storyPageState:i.storyPageState},y=new t.AuthoringPaneVE(i,m);y.setContent(new t.AccessibilityCheckerPaneVE(y,{accessibilityChecker:i.accessibilityChecker,paneStateManager:i.paneStateManager,resourceFactory:i.authoringPageArgs.resourceFactory})),i.paneStateManager.addPane(t.AuthoringPaneType.AccessibilityChecker,y)}i.setupSwaySettingsPane(),i.checkContainMedia()||TDB.applyUpdate(function(){i.addContentSourceDropdownFirstRun.setValue(!0)}),s.getInstance().setTouchForAuthoringState(a.StoryLine,!1),i._cardDeckCopyPasteHandler=new d.CardDeckCopyPasteHandler({cardsContainer:i.cardDeckVE,cardDefinitionManager:i.cardDefinitionManager,cardSelectionManager:i.cardDeckVE.getSelectionManager(),pageId:i.pageId}),i.scrollingDistance=0,i.absoluteNavigatingDistance=0,i.percentageNavigatingDistance=0}),StoryLog.StructuredActivityTag(596460037,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.info,"AuthoringEntered","ModeSwitch: The user has entered authoring.",StoryPageSettings.StoryId,{screenWidth:c.Environment.getInstance().getWindowSize().w})},h.prototype.setupSwaySettingsPane=function(){if(StoryPageEditSettings.SwaySettingsPaneEnabled){var e={content:void 0,paneType:t.AuthoringPaneType.SwaySettings,css:"SwaySettingsPane",paneStateManager:this.paneStateManager,visibleCss:"SwaySettingsPaneVisible",lightDismiss:!1,storyPageState:this.storyPageState},n=new t.AuthoringPaneVE(this,e);n.setContent(new t.SwaySettingsPaneVE(n,{paneStateManager:this.paneStateManager,textDirectionButtonsVisible:this.textDirectionButtonsVisible,sharingManager:this.authoringPageArgs.sharingManager,languages:this.languages})),this.paneStateManager.addPane(t.AuthoringPaneType.SwaySettings,n)}},h.shouldContentPaneBeDisabled=function(e,t){var n=u.currentContentSourcesManager().get(e);return!n||!n.areContentSourcesLoaded(t)},h.prototype.getPaneStateManager=function(){return this.paneStateManager},h.prototype.getCardDeckCopyPasteHandler=function(){return this._cardDeckCopyPasteHandler},h.prototype.setStorylineMode=function(e,t){var o=this,i=this.getViewContext(),a=this.storylineMode.getValue();if(a!==e){if(void 0===e)switch(a){case n.Collapsed:e=n.Full;break;case n.Full:e=n.Collapsed;break;default:return void StoryLog.StructuredTraceTag(596473609,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.error,"The storyline is in an unexpected mode.",{StorylineMode:a.toString()})}if(void 0===t&&(t=!0),e===n.Full?l.FirstRunTriggers.storylineVisible():this.cardDeckVE.getSelectionManager().clearSelection(),TDB.applyUpdate(function(){o.storylineMode.setValue(e),o.storylineVisible.setValue(e===n.Full),o.paneStateManager.storylineModeChanged()}),StoryPageSettings.EnableAuthoringTraversalHistory&&t){var s=r.ViewModel.previewVE._root.getValue().getHistorian(),c=this.getViewContext();s&&s.traverse({startState:i,endState:c,contextName:this.className(),toggleState:"toggleStoryline",historicallyRelevant:!0,animation:!1})}var d;switch(e){case n.Full:d=ClientAction.ActionType.MaximizeStoryline;break;case n.Collapsed:d=ClientAction.ActionType.CloseStoryline;break;default:StoryLog.StructuredTraceTag(596473610,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.error,"We tried to set the storyline to an unexpected mode.",{StorylineMode:a.toString()})}ActionLogger.RecordClientAction(new ClientAction.SimpleClientActionData(d,Diag.ULSCat.msoulscat_Story_Storyline)),e===n.Collapsed&&StoryLog.StructuredActivityTag(596460038,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.info,"DesignEntered","ModeSwitch: The user has entered design.",StoryPageSettings.StoryId,{SwayLength:p.getNumberOfStoryElements()})}},h.prototype.isCardDeckVisible=function(e){return this.storylineMode.getWatchedValue(e)===n.Full},h.prototype.isCardDeckFullScreen=function(e){return this.storylineMode.getWatchedValue(e)===n.Full},h.prototype.getStorylineMode=function(e){return this.storylineMode.getWatchedValue(e)},h.prototype.toggleUpdateStatus=function(){var e=this,t=this.parent.showUpdateStatus.getValue();TDB.applyUpdate(function(){e.parent.showUpdateStatus.setValue(!t)})},h.prototype.toggleEditControls=function(){var t=this;if(!this.parent.isEmbeddedMode.getValue()){var o;this.parent.isEditMode.getValue()?o=StoryViewMode.Preview:(o=StoryViewMode.Edit,r.ViewModel.resetViewOptions()),TDB.applyUpdate(function(){t.parent.storyViewMode.setValue(o),e.Server.Sync.currentSyncManager().get(t.pageId).forceSync(),r.OverflowMenuVE.printShortcutAdded||(r.OverflowMenuVE.printShortcutAdded=$.Deferred()),r.OverflowMenuVE.printShortcutAdded.then(function(){r.DomEventRegister.getInstance().getRootPanelElement().reorderShortcuts()})});var i;if(o===StoryViewMode.Preview)i=ClientAction.ActionType.PlayModeEntered;else switch(this.getStorylineMode()){case n.Collapsed:i=ClientAction.ActionType.CloseStoryline;break;case n.Full:i=ClientAction.ActionType.MaximizeStoryline}ActionLogger.RecordClientAction(new ClientAction.SimpleClientActionData(i,Diag.ULSCat.msoulscat_Story_Storyline)),this.parent.getClientSignalListeners().forEach(function(e){return e.viewModeChanged(o)}),this.activateAppropriateRegion()}},h.prototype.getViewContext=function(){return this.parent.isEditMode.getValue()?this.isCardDeckVisible()?"Storyline":"Canvas":"Preview"},h.prototype.getNextToggleState=function(){return this.parent.isEditMode.getValue()?"Preview":this.isCardDeckVisible()?"Storyline":"Canvas"},h.prototype.authoringPanesArgs=function(e){var n=this;if(!this.paneStateManager.hasAuthoringPane(t.AuthoringPaneType.Content)&&!t.AuthoringPageVE.shouldContentPaneBeDisabled(this.pageId,e)){var o=new t.ContentPaneVE(this,{paneStateManager:this.paneStateManager,cardsContainer:this.cardDeckVE,storyPageState:this.storyPageState,fileUploader:this.fileUploader,resourceFactory:this.authoringPageArgs.resourceFactory,contentSourcesManager:u.currentContentSourcesManager().get(this.pageId)});if(this.addContentVE=o.getAddContent(),this.paneStateManager.addPane(t.AuthoringPaneType.Content,o),!t.AuthoringPageVE.shouldContentPaneBeDisabled(this.pageId,e)){var i=u.currentContentSourcesManager().get(this.pageId);this.addContentVE.selectSource(i.getContentSources()[0])}var r=this.cardDeckVE.getDragHandler();r.registerOnDropped(this.addContentVE),r.setAddContentSelectionManager(this.addContentVE.selectionManager),TDB.applyUpdate(function(){return n.paneStateManager.authoringPanesChanged.notify()},TDB.Justification.SyncResponse)}return this.paneStateManager.getAllAuthoringPanes()},h.prototype.cardDeckArgs=function(){return this.cardDeckVE},h.prototype.cardDeckVisibleArgs=function(e){return this.updateTouch(),e.watchValue(this.parent.isEditMode)},h.prototype.cardDeckFadeVisibleInitArgs=function(){return{disabled:!1,visibleInit:!0}},h.prototype.cardDeckFadeVisibleArgs=function(e){return{visible:this.isCardDeckVisible(e),transitionIn:"opacity 0.3s ease",transitionOut:"opacity 0.3s ease"}},h.prototype.cardDeckEventsInitArgs=function(){var e=this;return{transitionend:function(t){return TDB.applyUpdate(function(){e.cardDeckAnimationsComplete.notify()},TDB.Justification.SynchronousBrowserEvent),!0}}},h.prototype.cardDeckStyleArgs=function(e){return{height:"calc(100% - "+UX.swayBarHeight+"px)"}},h.prototype.calculateCardDeckClassName=function(e){var n=this.isCardDeckVisible(e),o=t.AuthoringPageVE.cardDeckPaneCss;return this.updateTouch(),n?(this.isCardDeckFullScreen(e)&&(o+=" "+t.AuthoringPageVE.cardDeckPaneFullScreenCss),o+=" "+t.AuthoringPageVE.cardDeckPaneVisibleCss):o+=" "+t.AuthoringPageVE.cardDeckPaneHiddenCss+" CardDeckPaneHiddenModeSwitch",o},h.prototype.cardDeckClassNameArgs=function(e){return this.calculateCardDeckClassName(e)},h.prototype.autoScrollerArgs=function(e){var n=this.cardDeckVE.getDragHandler();if(n.dragging.getWatchedValue(e))return new TDB.ChildArgs(t.AutoScrollerVE,{elementId:"CardsWrapper",dragHandler:n,regionMargin:60})},h.prototype.updateTouch=function(){var e=this.parent.isEditMode.getValue(),n=this.isCardDeckVisible();(this.paneStateManager.getCurrentAuthoringPane()!==t.AuthoringPaneType.None||n)&&e?r.DomEventRegister.getInstance().setAuthoringState(a.StoryLine):r.DomEventRegister.getInstance().setAuthoringState(a.Canvas)},h.prototype.expandStoryline=function(){this.storylineMode.getValue()===n.Collapsed&&this.toggleStoryline()},h.prototype.shrinkStoryline=function(){var e=this;this.storylineMode.getValue()===n.Full&&TDB.applyUpdate(function(){var t=n.Collapsed;e.setStorylineMode(t),e.cardDeckVE.activate()})},h.prototype.getRootTraveler=function(){var e=r.ViewModel.previewVE._root.getValue();if(e&&e.getTraveler())return e.getTraveler()},h.prototype.getScrollingDistance=function(){var e=this.getRootTraveler();return e?e.getScrollingDistance():0},h.prototype.getPercentageNavigatingDistance=function(){var e=this.getRootTraveler();return e?e.getPercentageNavigatingDistance():0},h.prototype.getAbsoluteNavigatingDistance=function(){var e=this.getRootTraveler();return e?e.getAbsoluteNavigatingDistance():0},h.prototype.toggleStoryline=function(){var e=this,n=(this.storylineMode.getValue(),this.isCardDeckVisible());TDB.applyUpdate(function(){e.setStorylineMode(),n=!n;var o=r.ViewModel.previewVE._root.getValue();if(n){e.cardDeckVE.activate(),e._lastOpenedAuthoringPane!==t.AuthoringPaneType.None&&e.paneStateManager.getAuthoringPane(e._lastOpenedAuthoringPane).isCardDeckSupported()&&(e.paneStateManager.showAuthoringPane(e._lastOpenedAuthoringPane,!1),e._lastOpenedAuthoringPane=t.AuthoringPaneType.None),r.ViewModel.viewinputlogger&&r.ViewModel.viewinputlogger.setEnabled(!1);var i=e.scrollingDistance,a=e.percentageNavigatingDistance,s=e.absoluteNavigatingDistance;e.scrollingDistance=e.getScrollingDistance(),e.absoluteNavigatingDistance=e.getAbsoluteNavigatingDistance(),e.percentageNavigatingDistance=e.getPercentageNavigatingDistance();var l={pixel:Math.abs(e.scrollingDistance-i),frame:Math.abs(e.absoluteNavigatingDistance-s),percentage:Math.abs(e.percentageNavigatingDistance-a)};StoryLog.StructuredActivityTag(596473611,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.info,"StorylinePreviewSyncOpenStoryline","StorylinePreviewSync: Preview: User navigated distance.",StoryPageSettings.StoryId,l)}else o&&o.canActivate()?o.activate():e.onFocusedElementRemoval(e),r.ViewModel.viewinputlogger&&r.ViewModel.viewinputlogger.setEnabled(!0)});var o=n?ClientAction.ButtonId.StorylinePeek:ClientAction.ButtonId.CanvasPeek;return ActionLogger.RecordClientAction(new ClientAction.ButtonClickAction(o,Diag.ULSCat.msoulscat_Story_Storyline)),TDB.EventPropagation.Bypass},h.prototype.checkContainMedia=function(){for(var t,n=e.Model.StoryModel.traversalModel.getSpecifiedGrouping().getRootGroup().children.getCollection(),r=0;r<n.length;r++){t=i.StoryController.getPrimaryCollection(n[r]).getCollection();for(var a=0;a<t.length;a++)if(t[a]instanceof o.MediaWithTextComposite||t[a]instanceof o.StatusUpdateContent||t[a]instanceof o.EmbeddedContent)return!0}return!1},h.prototype.getFocusableViewElement=function(){return this},h.prototype.getTextAggregator=function(){return this._textAggregator},h.prototype.activateAppropriateRegion=function(){if(this.parent.storyViewMode.getValue()===StoryViewMode.Edit){if(this.isCardDeckVisible())return void(this.cardDeckVE.isFocusUnder()||this.cardDeckVE.activate());if(this.isFocusUnder()&&this.paneStateManager.getCurrentAuthoringPane()===t.AuthoringPaneType.None){var e=this.findParent(r.PageRootVE);e&&e.enter()}}},h.prototype.handleIsClientOnlineChanged=function(e){e||(this.paneStateManager.getPaneVisible(t.AuthoringPaneType.Content)||this.paneStateManager.getPaneVisible(t.AuthoringPaneType.Design)||this.paneStateManager.getPaneVisible(t.AuthoringPaneType.Navigation))&&this.paneStateManager.hideAllAuthoringPanes()},h.prototype.keyDown=function(e){TDB.EventPropagation.Bubble;return this._cardDeckCopyPasteHandler.handleEvent(e)},h.prototype.updateNavigationHint=function(e){StoryApp.View.Common.LayoutUtilities.getCurrentWorldId(StoryApp.Model.RenderModel.getValue(),e);var t=this.isCardDeckVisible(e),n=l.getCalloutManager().getCurrentCalloutID();t||n===l.CalloutID.UndoButton||l.StoryEditFirstRunHelper.triggerPreviewEntered()},h.prototype.updateLanguagesList=function(e){var t=this;if(0===this.languages.getValue().length){var n=this.model.traversalModel,o=n.getStyleOverrides(e),i=n.getStyleId(e),r=o?o.getFontSetId(e):"";$.get(StoryApp.Common.UrlHelper.getInstance().getEnabledLanguagesList(i,r)).done(function(e){var n=[];for(var o in e.languageFonts)e.languageFonts.hasOwnProperty(o)&&n.push(new d.Language(o,e.languageFonts[o]));TDB.applyUpdate(function(){return t.languages.setValue(n)})}).fail(function(e,t,n){StoryLog.StructuredTraceTag(596473612,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.warning,"Timeout or terminated request getting enabled languages",{ErrorStatus:t,ErrorThrown:n,Status:e?e.status.toString():null})})}},h.prototype.notifyTabChange=function(e){this.updatePreviewState()},h.prototype.updatePreviewState=function(){var e=this.paneStateManager.getCurrentAuthoringPane()!==t.AuthoringPaneType.None;this.parent.isObscured.setValue(e)},h.prototype.getState=function(){var e={};return e[t.AuthoringPaneType.EditImage]=this.paneStateManager.getAuthoringPane(t.AuthoringPaneType.EditImage).isVisible(),e},h.prototype.setState=function(e){!e[t.AuthoringPaneType.EditImage]&&this.paneStateManager.getPaneVisible(t.AuthoringPaneType.EditImage)&&this.paneStateManager.getAuthoringPane(t.AuthoringPaneType.EditImage).setVisible(!1)},h.prototype.recordingDialogArgs=function(e){return this.recordingDialogVisible.getWatchedValue(e)?this.createRecordingDialog():null},h.prototype.createRecordingDialog=function(){var e={authoringModel:this,recorder:this.recorder,resourceFactory:this.authoringPageArgs.resourceFactory,card:this.recordingCard};return new TDB.ChildArgs(t.RecordingDialogVE,e)},h.prototype.showRecordingDialog=function(e){var n=this;if(this.recordingDialogVisible.getValue())t.RecordingDialogVEBase.displayDismissWarningDialog(this,function(){n.recordingDialog.resetRecording()});else if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)navigator.mediaDevices.getUserMedia({audio:!0}).then(function(o){n.recorder=new t.Recorder({context:n,stream:o,resourceFactory:n.authoringPageArgs.resourceFactory}),n.recordingCard=e,TDB.applyUpdate(function(){n.recordingDialogVisible.setValue(!0)})}).catch(function(e){if(!t.RecordingErrors[e.name])throw StoryApp.RethrowLogger.createError("Unhandled exception during initialization of recording: "+e.toString());ErrorDialog.ShowErrorDialog(Resources.RecordingDialogErrorTitle,t.RecordingErrors[e.name].errorString,t.RecordingErrors[e.name].logString)});else{var o=new TDB.ChildArgs(r.ClickableLinkVE,{url:"https://go.microsoft.com/fwlink/?linkid=839279",message:Resources.EmbedInfoMessageLink,tabIndex:0}),i={title:Resources.RecordingDialogErrorTitle,description:StoryApp.Utilities.browser.isiOS?Resources.RecordingDeviceNotSupportedError:Resources.RecordingBrowserNotSupportedError,dialogWrapperCssClass:{value:"CenteredDialog"},noFocus:!1,dialogType:StoryApp.View.ViewElements.DialogType.Error,messages:[StoryApp.Utilities.browser.isiOS?Resources.RecordingDeviceNotSupportedError:Resources.RecordingBrowserNotSupportedError],dialogLogMessage:"Recording error: Unsupported browser",buttonsArgs:[{caption:{value:Resources.ButtonOK},isDefault:!0,dismissOnAction:!0,id:"iddlButtonOK"}],contentArgs:o};StoryApp.View.Common.DialogManager.createAndShow(i)}},h.prototype.hideRecordingDialog=function(){var e=this;this.recordingDialog.dismissRecordingDialog(),TDB.applyUpdate(function(){e.recordingDialogVisible.setValue(!1)})},h.prototype.closedCaptionUploaderArgs=function(){var e={viewModel:new d.ClosedCaptionUploaderViewModel({authoringModel:this})};return new TDB.ChildArgs(t.ClosedCaptionUploaderVE,e)},h.prototype.swayBarArgs=function(e){if(this.parent.isEditMode.getWatchedValue(e))return new TDB.ChildArgs(t.SwayBarVE,{authoringModel:this,paneStateManager:this.paneStateManager,onMaximizeSearch:this.cardDeckVE.maximizeSearch,searchContext:this.cardDeckVE})},h.cardDeckPaneCss="CardDeckPane",h.cardDeckPaneFullScreenCss="CardDeckPaneFullScreen",h.cardDeckPaneVisibleCss="CardDeckPaneVisible",h.cardDeckPaneWithSidePanelCss="CardDeckPaneWithSidePanel",h.cardDeckPaneWithSidePanelFullScreenCss="CardDeckPaneWithSidePanelFullScreen",h.cardDeckPaneWithNavigationPanelCss="CardDeckPaneWithNavigationPanel",h.cardDeckPaneWithDesignPanelCss="CardDeckPaneWithDesignPanel",h.cardDeckPaneWithFocusPanelCss="CardDeckPaneWithFocusPanel",h.cardDeckPaneHiddenCss="CardDeckPaneHidden",h.cardDeckPaneWithEditImageFullScreen="CardDeckPaneWithEditImageFullScreen",h.standardPaneWidth=225,h.addContentWidth=.36,h}(TDB.FocusableViewElement);t.AuthoringPageVEBase=g}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n,o=e.Model.AuthoringModel,i=StoryApp.Model.RM,r=StoryApp.Common,a=e.View.ViewModel;!function(e){e[e.None=0]="None",e[e.Delete=1]="Delete",e[e.Edit=2]="Edit",e[e.Emphasis=3]="Emphasis",e[e.Transform=4]="Transform",e[e.CopyLink=5]="CopyLink",e[e.EditImage=6]="EditImage"}(n=t.CommandType||(t.CommandType={}));var s=function(e){function s(o,i){var r=e.call(this,o,{features:TDB.ControlSetFeatures.Isolated|TDB.ControlSetFeatures.ExitOnEscape})||this;return r.sharingManager=i.sharingManager,r._contextualAuthoring=i.contextualAuthoring,r._paneStateManager=i.paneStateManager,r.authoringModel=i.authoringModel,r.storyPage=i.storyPage,r.xPosition=TDB.watchableTag(596473547,r,0),r.yPosition=TDB.watchableTag(596473548,r,0),r.visible=TDB.watchableTag(596473549,r,!1),r.element=TDB.watchableTag(596473550,r,null),r.executedCommand=n.None,r._noFlyZone=25,r._flyoutBuffer=150,r._flyoutOnLeft=TDB.watchableTag(596473551,r,!1),r.layout=new t.HorizontalLayoutContextMenu,r}return __extends(s,e),s.prototype.setup=function(e,n){this.selectionManager=e;var o={contextMenu:this,pageId:this.pageId,selectionManager:e,shortTextEditor:n,sharingManager:this.sharingManager,paneStateManager:this._paneStateManager};this._heroCommands=[new a.EditCommandViewModel(o),new a.EditImageCommandViewModel(o),new a.EmphasisCommandViewModel(o),new a.CopyLinkCommandViewModel(o),new a.DeleteCommandViewModel(o)],this.visibleFlyoutType=TDB.watchableTag(596473552,this,t.ContextMenuFlyoutType.None),this.numHeroesWatcher=TDB.watcherTag(596473553,this,this,this.calculateNumHeroes),this.widthWatcher=TDB.watcherTag(596473554,this,this,this.calculateWidth),this.flyoutVisibleWatcher=TDB.watcherTag(596473555,this,this,this.calculateFlyoutVisible)},s.prototype.toggleEmphasisFlyout=function(){var e=this,n=t.ContextMenuFlyoutType.None;this.visibleFlyoutType.getValue()!==t.ContextMenuFlyoutType.Emphasis&&(n=t.ContextMenuFlyoutType.Emphasis),TDB.applyUpdate(function(){e.visibleFlyoutType.setValue(n)})},s.prototype.setVisible=function(e){var t=this;TDB.applyUpdate(function(){return t.visible.setValue(e)})},s.prototype.isVisible=function(e){return this.visible.getWatchedValue(e)},s.prototype.getViewElement=function(){return this},s.prototype.calculateNumHeroes=function(e){for(var t=0,n=0;n<this._heroCommands.length;n++)this._heroCommands[n].calculateVisible(e)&&t++;return t},s.prototype.calculateWidth=function(e){var t=e.watchValue(this.numHeroesWatcher);return this.layout.getWidth(t)},s.prototype.heroCommandsArgs=function(){return this._heroCommands.map(function(e){return new TDB.ChildArgs(t.HeroCommandButtonVE,e)})},s.prototype.getHeroCommands=function(){return this._heroCommands},s.prototype.contextMenuFlyoutArgs=function(){return new TDB.ChildArgs(t.ContextMenuFlyoutVE,{contextMenu:this,selectionManager:this.selectionManager,activeFlyout:this.visibleFlyoutType})},s.prototype.contextMenuCommandsStyleArgs=function(e){var t={};return this.flyoutVisibleWatcher.getWatchedValue(e)&&(t={borderBottom:"1px solid #D2D2D2"}),t},s.prototype.show=function(e,t,o){var i=this;return FRE.getCalloutManager().getCurrentCalloutID()===FRE.CalloutID.DigitalPrintAuthoring&&(FRE.getCalloutManager().getCallout(FRE.CalloutID.DigitalPrintAuthoring).dismissCallback=void 0,FRE.getCalloutManager().clearCallouts()),FRE.FirstRunTriggers.lightWeightAuthoring(),!(!o||!this.hasValidGroupChild(o))&&(TDB.applyUpdate(function(){i.element.setValue(o)}),StoryLog.StructuredTraceTag(596473556,Diag.ULSCat.msoulscat_Story_ContextualUI,Diag.ULSTraceLevel.info,"Context Menu Shown",{VisibleButtons:this._heroCommands.filter(function(e){return e.calculateVisible(null)}).map(function(e){return n[e.commandType]}).toString()}),TDB.applyUpdate(function(){i.xPosition.setValue(i.calculateAdjustedX(e)),i.yPosition.setValue(i.calculateAdjustedY(t))}),this.enter(),!0)},s.prototype.onEntering=function(){var e=this;this.closeFlyout(),this._invokeTime=platform.now(),this.executedCommand=n.None,TDB.applyUpdate(function(){e.visible.setValue(!0)})},s.prototype.mouseClicked=function(e){return this.activate(),TDB.EventPropagation.Bypass},s.prototype.contextMenuHeroCommandsClassNameArgs=function(e){return this.layout.getHeroCommandsClassNameArgs()},s.prototype.contextMenuRootStyleArgs=function(e){var t=e.watchValue(this.xPosition),n=e.watchValue(this.yPosition),o=e.watchValue(this.widthWatcher),i={position:"absolute",zIndex:"100",top:n+"px",left:t+"px"},r=this.layout.getMenuRootStyle(o);for(var a in r)i[a]=r[a];return i},s.prototype.contextMenuRootVisibleArgs=function(e){return this.isVisible(e)},s.prototype.contextMenuCommandsWrapperStyleArgs=function(e){var t=e.watchValue(this.widthWatcher),n=e.watchValue(this.flyoutVisibleWatcher);return this.layout.getMenuCommandsStyle(t,n)},s.prototype.contextMenuFlyoutWrapperVisibleArgs=function(e){return e.watchValue(this.flyoutVisibleWatcher)},s.prototype.calculateFlyoutVisible=function(e){return this.visibleFlyoutType.getWatchedValue(e)!==t.ContextMenuFlyoutType.None},s.prototype.getFlyoutType=function(e){return this.visibleFlyoutType.getWatchedValue(e)},s.prototype.onExiting=function(){var e=this;this._contextualAuthoring.deselectElements(),this.closeFlyout(),this.logMenuLifetimeData(),TDB.applyUpdate(function(){e.visible.setValue(!1)}),this.onFocusedElementRemoval(this),FRE.FirstRunTriggers.authoringCalloutDismissed()},s.prototype.closeFlyout=function(){var e=this;TDB.applyUpdate(function(){e.visibleFlyoutType.setValue(t.ContextMenuFlyoutType.None)})},s.prototype.hasValidGroupChild=function(e){if(!e)return!1;var t=o.currentStoryController().get(this.pageId),n=t.getRootGroup();return!(!o.StoryController.isModelObjectValid(e.groupChild)||n!==e.groupChild&&null==t.findParent(e.groupChild))},s.prototype.logMenuLifetimeData=function(){var e=platform.now()-this._invokeTime;StoryLog.StructuredTraceTag(596473557,Diag.ULSCat.msoulscat_Story_ContextualUI,Diag.ULSTraceLevel.info,"Context Menu Dismissed",{ContentType:this.convertContentTypeToString(this.element.getValue().contentType),"Duration (ms)":e.toString(),Command:this.convertCommandTypeToString(this.executedCommand),AddContent:this.convertVisibleToString(this._paneStateManager.getPaneVisible(t.AuthoringPaneType.Content))})},s.prototype.convertVisibleToString=function(e){return e?"visible":"hidden"},s.prototype.convertContentTypeToString=function(e){var t=i.ContentType[e];return void 0==t&&(t="Unrecognized ContentType; This is a BUG."),t},s.prototype.convertCommandTypeToString=function(e){var t=n[e];return void 0==t&&(t="Unrecognized ContentType; This is a BUG."),t},s.prototype.calculateAdjustedX=function(e){var t=this,n=e,o=this.storyPage.getPreviewWidth()-this._noFlyZone;return n>o-$("#contextMenuRoot").width()&&(n=o-$("#contextMenuRoot").width()),TDB.applyUpdate(function(){t._flyoutOnLeft.setValue(n>o-$("#contextMenuRoot").width()-t._flyoutBuffer)}),n},s.prototype.calculateAdjustedY=function(e){var n=e-UX.topBarHeight-t.SwayBarVE.SwayBarHeight,o=r.Environment.getInstance().getWindowSize().h-this._noFlyZone,i=$("#contextMenuRoot").height()+t.ContextMenuVE.emphasisCommandHeight;return n>o-i&&(n=o-i),n},s.heroCommandWidth=70,s.emphasisCommandHeight=48,s}(TDB.ControlSet);t.ContextMenuVEBase=s}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){function t(t){for(var n in e.HTMLEntities){var o=new RegExp(e.HTMLEntities[n],"g");t=t.replace(o,"&"+n+";")}return t}function n(t){for(var n in e.InvalidHTMLEntities){o=new RegExp("&"+n+";","g");t=t.replace(o,e.InvalidHTMLEntities[n])}for(var n in e.HTMLEntities){var o=new RegExp("&"+n+";","g");t=t.replace(o,e.HTMLEntities[n])}return t}e.HTMLEntities={amp:"&",gt:">",lt:"<"},e.InvalidHTMLEntities={nbsp:" "},e.SymbolsToHTMLEntities=t,e.HTMLEntitiesToSymbols=n}(e.HTMLEntities||(e.HTMLEntities={}))}(e.Common||(e.Common={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(e){function n(t,n){var o=e.call(this,t)||this;return o.showImage=TDB.watchableOption(o,n.showImage,!0),o.desiredImageSrc=TDB.watchableOption(o,n.imageSource,""),o.altText=TDB.watchableOption(o,n.altText,""),o.shownImageSrc=TDB.watchableTag(596473545,o,void 0),o.args=n,o}return __extends(n,e),n.prototype.previewImageArgs=function(e){if(this.showImage.getWatchedValue(e)){var n=this.args.imageClass;this.args.fillContainer&&(n="FitImageInContainerUsingObjectFit"+(this.args.imageContentClass?"":" "+this.args.imageContentClass));var o={src:this.desiredImageSrc.getWatchedValue(e),role:Aria.Roles.Presentation,alt:this.altText.getWatchedValue(e),className:n,loadHandler:this.hideLoadingMessage,context:this};return new TDB.ChildArgs(t.BasicImageVE,o)}},n.prototype.loadingMessageArgs=function(){var e={message:{value:Resources.LoadingMessage},visible:{compute:new TDB.ComputedOptionArgs(this,this.isLoadingMessageVisible)},containerClassName:this.args.loadingMessageContainerClassName||"LoadingMessageCommon"};return new TDB.ChildArgs(t.LoadingMessageVE,e)},n.prototype.imageContentClassNameArgs=function(){return this.args.imageContentClass},n.prototype.ifUseImgArgs=function(){return!this.args.fillContainer||this.supportsObjectFit()},n.prototype.supportsObjectFit=function(){return"objectFit"in document.body.style},n.prototype.previewDivAttrArgs=function(e){var t={};return t[Aria.Attributes.Label]=this.altText.getWatchedValue(e),t[Aria.Attributes.Role]=Aria.Roles.Presentation,t},n.prototype.previewDivClassNameArgs=function(){var e=this.args.imageContentClass;return this.args.fillContainer&&(e="FitDivImageInContainer"+(e?"":" "+e)),e},n.prototype.previewDivStyleArgs=function(e){var t=this;if(!this.showImage.getWatchedValue(e))return{};var n=new Image;n.src=this.desiredImageSrc.getWatchedValue(e),n.onload=function(e){t.hideLoadingMessage(e)};var o={};return o["background-image"]="url("+this.desiredImageSrc.getWatchedValue(e)+")",o},n.prototype.hideLoadingMessage=function(e){var t=this;return TDB.applyUpdate(function(){t.shownImageSrc.setValue(t.desiredImageSrc.getValue())}),!1},n.prototype.isLoadingMessageVisible=function(e){return this.shownImageSrc.getWatchedValue(e)!==this.desiredImageSrc.getWatchedValue(e)},n}(TDB.FocusableViewElement);e.ImageVisualizatorVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel,o=function(e){function o(o,i){var r=e.call(this,o)||this,a={contextualAuthoring:r,paneStateManager:i.paneStateManager,sharingManager:i.sharingManager,authoringModel:i.authoringModel,storyPage:i.storyPage};r.contextMenuVE=new t.ContextMenuVE(r,a),r.addResource(r.contextMenuVE);var s={textAggregator:i.textAggregator,fileUploader:i.fileuploader,cardDefinitionManager:i.cardDefinitionManager,cardsContainer:i.cardsContainer,cardSelectionManager:i.cardSelectionManager,cardFactory:i.cardFactory},l=new t.OnSurfaceTextEditorVE(r,s);r.addResource(l),r.shortTextEditorVE=l,r.selectionUX=new t.SelectionUX("surfaceSelection","rootve");var c={viewModel:i.viewModel,contextMenu:r.contextMenuVE,shortTextEditor:r.shortTextEditorVE,selectionUX:r.selectionUX,loggingSupport:i.loggingSupport,viewMode:i.viewMode};return r.selectionManager=new n.SelectionManager(c,r),r}return __extends(o,e),o.prototype.SelectionVellumFadeVisibleInitArgs=function(){return{transitionIn:"opacity .25s ease",transitionOut:"opacity .25s ease",visibleInit:!1}},o.prototype.SurfaceSelectionFadeVisibleInitArgs=function(){return{transitionIn:"none",transitionOut:"opacity .3s ease .15s",visibleInit:!1}},o.prototype.SelectionVellumFadeVisibleArgs=function(e){return{visible:e.watchValue(this.selectionManager.elementSelection)||this.shortTextEditorVE&&e.watchValue(this.shortTextEditorVE.isVisible),transitionOut:e.watchValue(this.selectionUX.animateSelection)?"opacity .3s ease .15s":"none"}},o.prototype.SurfaceSelectionFadeVisibleArgs=function(e){var t=e.watchValue(this.selectionManager.elementSelection),n=e.watchValue(this.selectionUX.animateSelection);return{visible:t,transitionIn:n?"opacity .25s ease":"none",transitionOut:n?"opacity .3s ease .15s":"none"}},o.prototype.SurfaceSelectionClassNameArgs=function(e){return StoryApp.Model.RenderModel.getWatchedValue(e).getRTL(e)?"RTL":"LTR"},o.prototype.contextMenuArgs=function(){return this.contextMenuVE},o.prototype.shortTextEditorArgs=function(){return this.shortTextEditorVE.getViewElement()},o.prototype.handleMouseClick=function(e,t){return this.selectionManager.handleMouseClick(e,t)},o.prototype.deselectElements=function(){this.selectionManager.deselectElements()},o}(TDB.FocusableViewElement);t.SurfaceAuthoringVEBase=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=StoryApp.View.Common.FRE,i=e.View.ViewModel,r=function(e){function r(t,n){var o=e.call(this,t,TDB.ControlSetFeatures.Isolated|TDB.ControlSetFeatures.PreserveFocusContext)||this;return o.args=n,o.viewModel=new i.SwayBarViewModel({authoringModel:n.authoringModel,paneStateManager:n.paneStateManager}),o}return __extends(r,e),r.prototype.swayBarWrapperCssArgs=function(e){return{SwayBarWrapper:!0,SwayBarWrapperDesign:!this.args.authoringModel.isCardDeckVisible(e)}},r.prototype.storylineButtonArgs=function(e){var t={buttonId:ClientAction.ButtonId.SwayBar_Storyline,calculateChecked:this.viewModel.isStorylineButtonActive,click:this.viewModel.storylineButtonClicked,cssClass:{value:"SwayBarTab SwayBarTabLeft"},textClass:"SwayBarTabText",context:this,description:{value:Resources.StorylinePanelLabelNew},text:{value:Resources.StorylinePanelLabelNew},tooltip:{value:Resources.StorylineNavigationTooltip},controls:"cardDeck"};return new TDB.ChildArgs(n.TabButtonVE,t)},r.prototype.previewButtonArgs=function(e){var t={buttonId:ClientAction.ButtonId.SwayBar_Preview,calculateChecked:this.viewModel.isPreviewButtonActive,click:this.viewModel.previewButtonClicked,cssClass:{value:"SwayBarTab"},textClass:"SwayBarTabText",context:this,description:{value:Resources.AuthoringPanelDesign},text:{value:Resources.AuthoringPanelDesign},tooltip:{value:Resources.DesignNavigationTooltip},controls:"preview"};return new TDB.ChildArgs(n.TabButtonVE,t)},r.prototype.digitalPrintStorylineCalloutArgs=function(e){var t=o.CalloutID.DigitalPrintStoryline;if(o.getCalloutManager().isActiveCallout(e,t))return new TDB.ChildArgs(n.FRECalloutVE,o.CalloutArgsCreator.createArgsForDigitalPrintStoryline())},r.prototype.designButtonCalloutArgs=function(e){var t=o.CalloutID.DesignButton;if(o.getCalloutManager().isActiveCallout(e,t))return new TDB.ChildArgs(n.FRECalloutVE,o.CalloutArgsCreator.createArgsForDesignButton())},r.prototype.insertButtonArgs=function(e){if(this.args.authoringModel.getStorylineMode(e)===t.StorylineMode.Full){var o={buttonId:ClientAction.ButtonId.AddContent_Open,calculateChecked:this.viewModel.isInsertButtonActive,click:this.viewModel.insertButtonClicked,cssClass:{value:"SwayBarButton"},context:this,description:{value:Resources.PlusJackCardButtonDescription},tooltip:{value:Resources.AppBarInsertContentButtonDescription},fontIconArgs:{value:{fontIconName:{value:FontIcons.CardImageIcon},fontIconSizeClass:FontIcons.SwayBarIconSize,fontIconWrapperClass:{value:"CardMenuFontIcon"}}},textElementText:{value:Resources.AuthoringPanelContent},textClass:"SwayBarPaneButtonText",enabled:{compute:new TDB.ComputedOptionArgs(this,this.calculateEnabled)},shortcutIdentifiers:["Alt+Shift+IKey"],shortcutProcessor:n.DomEventRegister.getInstance().getRootPanelElement()};return new TDB.ChildArgs(n.ToggleButtonVE,o)}},r.prototype.designButtonArgs=function(e){if(this.args.authoringModel.getStorylineMode(e)===t.StorylineMode.Collapsed){var o={buttonId:ClientAction.ButtonId.DesignPane_Open,calculateChecked:this.viewModel.designButtonActive,click:this.viewModel.designButtonClicked,cssClass:{value:"SwayBarButton"},context:this,description:{value:Resources.StylePaneTitle},tooltip:{value:Resources.AppBarDesignButtonDescription},fontIconArgs:{value:{fontIconName:{value:FontIcons.SwayBarDesignIcon},fontIconSizeClass:FontIcons.SwayBarIconSize,fontIconWrapperClass:{value:"CardMenuFontIcon"}}},textElementText:{value:Resources.StylePaneTitle},textClass:"SwayBarPaneButtonText",shortcutIdentifiers:["Alt+Shift+GKey"],shortcutProcessor:n.DomEventRegister.getInstance().getRootPanelElement()};return new TDB.ChildArgs(n.ToggleButtonVE,o)}},r.prototype.stylesButtonCalloutArgs=function(e){var t=o.CalloutID.StylesButton;if(o.getCalloutManager().isActiveCallout(e,t))return new TDB.ChildArgs(n.FRECalloutVE,o.CalloutArgsCreator.createArgsForStylesButton())},r.prototype.undoButtonArgs=function(e){var t={calloutBoxClassName:"UndoButton-calloutModeSwitch",calloutTapClassName:"TapCalloutCommon",headerText:{value:Resources.FirstRunUndoButtonV2},readerText:Resources.FirstRunUndoButtonReader,beakPosition:n.BeakPosition.TopRight,calloutID:o.CalloutID.UndoButton,delay:o.getDelayForCallout(o.CalloutID.UndoButton,o.FirstRunType.Default)},i={buttonId:ClientAction.ButtonId.AppBar_Undo,click:this.viewModel.undoButtonClicked,context:this,cssClass:{value:"contentSearchMaximizeButton contentSearchFocusable"},description:{value:Resources.UndoButton},tooltip:{value:Resources.AppBarUndoButtonDescription},enabled:{compute:new TDB.ComputedOptionArgs(this,this.viewModel.computeUndoEnabled)},fontIconName:{value:FontIcons.UndoButtonIcon},fontIconSizeClass:FontIcons.SwayBarIconSize,calloutArgs:{value:t},wrapperClassName:"SwayBarUndoButton"};return new TDB.ChildArgs(n.CalloutGlyphButtonVE,i)},r.prototype.redoButtonArgs=function(e){var t={buttonId:ClientAction.ButtonId.AppBar_Redo,click:this.viewModel.redoButtonClicked,context:this,cssClass:{value:"contentSearchMaximizeButton contentSearchFocusable SwayBarButton"},description:{value:Resources.RedoButton},tooltip:{value:Resources.AppBarRedoButtonDescription},enabled:{compute:new TDB.ComputedOptionArgs(this,this.viewModel.computeRedoEnabled)},fontIconName:{value:FontIcons.RedoButtonIcon},fontIconSizeClass:FontIcons.SwayBarIconSize};return new TDB.ChildArgs(n.GlyphButtonVE,t)},r.prototype.maximizeSearchButtonArgs=function(e){if(StoryPageSettings.SearchEnabled&&this.args.authoringModel.getStorylineMode(e)===t.StorylineMode.Full){var o={buttonId:ClientAction.ButtonId.ContentSearch_Open,click:this.args.onMaximizeSearch,context:this.args.searchContext,cssClass:{value:"contentSearchMaximizeButton contentSearchFocusable SwayBarButton"},description:{value:Resources.ContentSearchOpen},tooltip:{value:Resources.ContentSearchOpen},fontIconName:{value:FontIcons.SearchIcon},fontIconSizeClass:FontIcons.SwayBarIconSize,shortcutIdentifiers:["Ctrl+FKey"],shortcutProcessor:n.DomEventRegister.getInstance().getRootPanelElement()};return new TDB.ChildArgs(n.GlyphButtonVE,o)}},r.prototype.calculateEnabled=function(e){return StoryAppCommon.Environment.getInstance().getClientOnlineWatcher().getWatchedValue(e)&&!t.AuthoringPageVE.shouldContentPaneBeDisabled(this.pageId,e)},r.prototype.remixHeaderArgs=function(e){if(this.args.authoringModel.getStorylineMode(e)!==t.StorylineMode.Full&&StoryAppCommon.UserState.getInstance().isUserOnFlight(FlightList.TopLevelRemixButton1)){var n=this.args.authoringModel.parent,o={viewModel:n,nlDesignStory:n.nlDesignStory},i={viewModel:n,authoringModel:this.args.authoringModel,dropdownArgs:o,pageId:this.pageId},r=new t.RemixHeaderViewModel(i);return new TDB.ChildArgs(EditVE.RemixHeaderVE,r)}},r.SwayBarHeight=UX.swayBarHeight,r}(n.RegionViewElement);t.SwayBarVEBase=r}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewElements,o=function(){function t(e){this.args=e}return t.prototype.onModeSwitch=function(e){return this.args.authoringModel.setStorylineMode(e),!0},t.prototype.isStorylineButtonActive=function(e){return this.args.authoringModel.getStorylineMode(e)===n.StorylineMode.Full},t.prototype.storylineButtonClicked=function(e){return FRE.getCalloutManager().getCurrentCalloutID()===FRE.CalloutID.DigitalPrintStoryline&&FRE.getCalloutManager().clearCallouts(),this.args.authoringModel.setStorylineMode(n.StorylineMode.Full),TDB.EventPropagation.Bypass},t.prototype.isPreviewButtonActive=function(e){return this.args.authoringModel.getStorylineMode(e)===n.StorylineMode.Collapsed},t.prototype.previewButtonClicked=function(e){return this.args.authoringModel.setStorylineMode(n.StorylineMode.Collapsed),FRE.FirstRunTriggers.designOpened(),TDB.EventPropagation.Bypass},t.prototype.isInsertButtonActive=function(e){return this.args.paneStateManager.getPaneVisible(n.AuthoringPaneType.Content,e)},t.prototype.insertButtonClicked=function(e){return this.args.paneStateManager.getAuthoringPane(n.AuthoringPaneType.Content).setSourceCardType(void 0),this.args.paneStateManager.toggleAuthoringPane(n.AuthoringPaneType.Content),TDB.EventPropagation.PreventDefault},t.prototype.designButtonActive=function(e){return this.args.paneStateManager.getPaneVisible(n.AuthoringPaneType.Design,e)},t.prototype.designButtonClicked=function(e){return this.args.paneStateManager.toggleAuthoringPane(n.AuthoringPaneType.Design),FRE.FirstRunTriggers.stylesButtonPressed(),TDB.EventPropagation.PreventDefault},t.prototype.undoButtonClicked=function(t){return e.Model.currentUndoManager().get(this.args.authoringModel.getPageId()).undo(),FRE.FirstRunTriggers.undoClicked(),TDB.EventPropagation.Bypass},t.prototype.redoButtonClicked=function(t){return e.Model.currentUndoManager().get(this.args.authoringModel.getPageId()).redo(),TDB.EventPropagation.Bypass},t.prototype.computeUndoEnabled=function(t){return e.Model.currentUndoManager().get(this.args.authoringModel.getPageId()).hasUndo(t)},t.prototype.computeRedoEnabled=function(t){return e.Model.currentUndoManager().get(this.args.authoringModel.getPageId()).hasRedo(t)},t.prototype.toggleEditMode=function(e){return this.args.authoringModel.parent.toggleEditMode(e)},t}();t.SwayBarViewModel=o}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.View.ViewElements,i=e.Model.AuthoringModel,r=function(e){function t(t){var n=e.call(this,t)||this;return n.parent=t,n.firstRunUIVisible=TDB.watcher(n,n,n.shouldShowFirstRun),n.firstRunReady=TDB.watchable(n,!1),TDB.FocusableViewElement.addFocusListener(n,n.focusChanged),n}return __extends(t,e),t.prototype.setup=function(){var e=this,t=i.currentStoryController().get(this.parent.getPageId());0==i.StoryController.getGroupChildren(t.getRootGroup()).getCollection().length&&TDB.applyUpdate(function(){e.firstRunReady.setValue(!0)})},t.prototype.disable=function(){var e=this;this.firstRunReady.getValue()&&TDB.applyUpdate(function(){e.firstRunReady.setValue(!1)})},t.prototype.shouldShowFirstRun=function(e){if(0==StoryPageEditSettings.FirstRunEnabled)return!1;if(0==e.watchValue(this.firstRunReady))return!1;var t=i.currentStoryController().get(this.parent.getPageId());return 0==i.StoryController.getGroupChildren(t.getRootGroup()).getCollection(e).length},t.prototype.focusChanged=function(e){var t=this;e instanceof o.ComplexHeadingCardVE||e instanceof n.PageRootVE||(this.disable(),platform.setTimeout(function(){TDB.FocusableViewElement.removeFocusListener(t)},0))},t.firstElementDelay=.5,t.secondElementDelay=1.5,t.thirdElementDelay=2.5,t.fourthElementDelay=3.5,t.fifthElementDelay=4,t}(Disposable);t.FirstRunManager=r}(t.Common||(t.Common={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t,n){var o=e.call(this,t)||this;return o.parent=t,o._args=n,o}return __extends(t,e),t.prototype.isVisible=function(e){return e.watchValue(this._args.firstRunManager.firstRunUIVisible)},t.prototype.firstRunWrapperFadeVisibleInitArgs=function(){return{transitionIn:"opacity 2s ease "+this._args.delay+"s",transitionOut:"opacity 0.01s ease"}},t.prototype.firstRunWrapperFadeVisibleArgs=function(e){return{visible:this._args.visible?this._args.visible.call(this._args.visibleContext,e):this.isVisible(e)}},t.prototype.firstRunWrapperAttrArgs=function(e){var t={};return t.class=this._args.wrapperClass,t},t.prototype.firstRunTextClassNameArgs=function(e){return this._args.hintClass},t.prototype.firstRunTextTextArgs=function(e){return this._args.hintText},t.prototype.firstRunDetailsTextClassNameArgs=function(e){return this._args.detailsClass?this._args.detailsClass:""},t.prototype.firstRunDetailsTextTextArgs=function(e){return this._args.detailsText?this._args.detailsText:""},t.prototype.ifFirstRunDetailsTextArgs=function(){return!!this._args.detailsText&&!!this._args.detailsClass},t.prototype.firstRunArrowAttrArgs=function(e){var t={};return t.class=this._args.iconClass,t.src=this._args.iconImage,t},t.prototype.mouseClicked=function(e){return TDB.EventPropagation.Bypass},t}(TDB.ViewElement);e.FirstRunElementVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t,n){var o=e.call(this,t)||this;return o.model=n,o}return __extends(t,e),t.prototype.breadcrumbsArgs=function(e){return this.model.breadcrumbsArgs(e)},t.prototype.breadcrumbClicked=function(e){this.model.breadcrumbClicked(e)},t}(TDB.FocusableViewElement);e.BreadcrumbPathVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function t(e){this.args=e,this.breadcrumbs=TDB.watchableTag(596455937,this,[])}return t.prototype.breadcrumbsArgs=function(t){return this.breadcrumbs.getWatchedValue(t).map(function(t){return new TDB.ChildArgs(e.BreadcrumbVE,t)})},t.prototype.getCurrentKey=function(e){var t=this.breadcrumbs.getWatchedValue(e);return 0==t.length?null:t[t.length-1].key},t.prototype.getCurrentBrowseDescriptor=function(e){var t=this.breadcrumbs.getWatchedValue(e);return 0==t.length?null:t[t.length-1].browseDescriptor},t.prototype.breadcrumbClicked=function(e){var t=this.breadcrumbs.getValue(),n=t.indexOf(e._args);if(n<0)throw StoryApp.RethrowLogger.createError("Selected unknown tab.");this.navigateBack(t.length-1-n);var o=this.args.addContent.selectedSource.getValue(),i={BreadcrumbLength:n+1,Navigate:"Backward"},r=new ClientAction.AddContentUIPaneData(ClientAction.ActionType.Edit_AddContentUI_NavBack,"",o.providerType);r.setContext(i),ActionLogger.RecordClientAction(r)},t.prototype.navigateBack=function(e){var t=this;void 0===e&&(e=1);var n=this.breadcrumbs.getValue();0===n.length||e<=0||(e>n.length&&(e=n.length),TDB.applyUpdate(function(){n.splice(n.length-e);t.breadcrumbs.notify();var o=t.args.parent;void 0!=o.breadcrumbChanged&&o.breadcrumbChanged()}))},t.prototype.breadcrumbCount=function(e){return this.breadcrumbs.getWatchedValue(e).length},t.prototype.addBreadcrumb=function(e){var t=this,n=this.breadcrumbs.getValue();e.firstBreadcrumb=0===n.length,TDB.applyUpdate(function(){n.push(e),t.breadcrumbs.notify()});var o=this.args.addContent.selectedSource.getValue();if(o){var i={BreadcrumbLength:this.breadcrumbCount(),Navigate:"Forward"},r=new ClientAction.AddContentUIPaneData(ClientAction.ActionType.Edit_AddContentUI_NavBack,"",o.providerType);r.setContext(i),ActionLogger.RecordClientAction(r)}},t.prototype.clearBreadcrumbs=function(){this.navigateBack(this.breadcrumbs.getValue().length)},t}();e.BreadcrumbPathViewModel=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(e){function n(t,n){var o=e.call(this,t)||this;return o.key=n.key,o.browseDescriptor=n.browseDescriptor,o._wrapperClass=void 0!=n.wrapperClass?n.wrapperClass:"",o._args=n,o}return __extends(n,e),n.prototype.wrapperClassNameArgs=function(e){return this._wrapperClass},n.prototype.textButtonVEArgs=function(){var e={buttonId:ClientAction.ButtonId.Breadcrumb,click:this.tabClicked,context:this,cssClass:{value:this._args.buttonClass},text:{value:this._args.text},description:{value:this._args.description}};return new TDB.ChildArgs(t.TextButtonVE,e)},n.prototype.tabClicked=function(e){return this.parent.breadcrumbClicked(this),TDB.EventPropagation.Bypass},n.prototype.dispose=function(){e.prototype.dispose.call(this)},n}(TDB.FocusableViewElement);e.BreadcrumbVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t;!function(e){e[e.None=0]="None",e[e.Emphasis=1]="Emphasis"}(t=e.ContextMenuFlyoutType||(e.ContextMenuFlyoutType={}));var n=function(n){function o(e,t){var o=n.call(this,e)||this;return o.args=t,o}return __extends(o,n),o.prototype.getEmphasisFlyout=function(){return this._emphasisFlyout},o.prototype.emphasisFlyoutArgs=function(){return new TDB.ChildArgs(e.EmphasisFlyoutVE,this.args)},o.prototype.ifEmphasisFlyoutArgs=function(e){return this.args.activeFlyout.getWatchedValue(e)===t.Emphasis},o}(TDB.FocusableViewElement);e.ContextMenuFlyoutVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=StoryApp.View.ViewElements,i=e.View.ViewModel,r=function(e){function r(t,n){var o=e.call(this,t,{features:TDB.ControlSetFeatures.AutoEnter|TDB.ControlSetFeatures.Isolated})||this;return o.args=n,o.baseContextMenu=n.contextMenu,o}return __extends(r,e),r.prototype.emphasisCommandsArgs=function(e){return this.getEmphasisCommands(e).map(function(e){return new TDB.ChildArgs(t.HeroCommandButtonVE,e)})},r.prototype.getInitialActiveChild=function(){var n=this.getFocusableChildren().firstOrDefault(function(e){return e instanceof t.HeroCommandButtonVE&&e.commandButton instanceof o.ToggleButtonVE&&e.commandButton.isChecked.getValue()});return n?n.commandButton:e.prototype.getInitialActiveChild.call(this)},r.prototype.getEmphasisCommands=function(e){var t=this.baseContextMenu.element.getWatchedValue(e),o=this.pageId,r=this.args;return[n.EmphasisLevel.None,n.EmphasisLevel.More,n.EmphasisLevel.Very].filter(function(e){return i.EmphasisFlyoutViewModel.isButtonAvailable(t,e,o)}).map(function(e){return new i.EmphasisLevelCommandViewModel({contextMenu:r.contextMenu,emphasisLevel:e,selectionManager:r.selectionManager,pageId:o})})},r.prototype.onExiting=function(){e.prototype.onExiting.call(this),this.baseContextMenu.closeFlyout()},r}(o.PopupBaseVE);t.EmphasisFlyoutVEBase=r}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.isButtonAvailable=function(e,t,o){return n.ObjectController.modelSupportsEmphasisLevel(e.groupChild,t,o)},t}(Disposable);t.EmphasisFlyoutViewModel=o}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t,n){var o=e.call(this,t)||this;return o.model=n,o}return __extends(t,e),t.prototype.heroButtonArgs=function(){return this.model.heroButtonArgs()},t.prototype.ifHeroButtonArgs=function(e){return this.model.calculateVisible(e)},t}(TDB.FocusableViewElement);e.HeroCommandButtonVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=function(){function e(e){this.args=e}return e.prototype.calculateVisible=function(e){var t=this.args.contextMenu.element.getWatchedValue(e);return null!=t&&this.isSupported(t,e)},e.prototype.getLabel=function(){return this.buttonArgs.text},e.prototype.calculateCssClass=function(e){return(this.buttonArgs.useGlyphIconText?"ContextHeroCommandButtonWithTextGlyph":"ContextHeroCommandButton")+(this.args.contextMenu.flyoutVisibleWatcher.getWatchedValue(e)?" ContextHeroCommandButtonFlyoutOpen":"")},e.prototype.buttonClick=function(e){var t=this.args,o=t.contextMenu.element.getValue();if(n.StoryController.isModelObjectValid(o.groupChild)||t.selectionManager.deselectElements(),!t.contextMenu.hasValidGroupChild(o))return TDB.EventPropagation.Bypass;var i=this.clickAction(e,o);return t.contextMenu.executedCommand=this.commandType,i},e}();t.HeroCommandButtonViewModel=o}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.heroButtonArgs=function(){var e=this.buttonArgs,n=e.useGlyphIconText,o={buttonId:e.buttonId,click:this.buttonClick,context:this,cssClass:{compute:new TDB.ComputedOptionArgs(this,this.calculateCssClass)},description:{value:e.text},fontIconName:{value:e.fontIconName},fontIconSizeClass:e.fontIconSizeClass,glyphIconTextClass:n?"ContextHeroCommandButtonGlyphIconText":void 0,text:{value:e.text},textClass:n?"ContextHeroCommandButtonTextWithTextGlyph":"ContextHeroCommandButtonText",useGlyphIconText:n};return new TDB.ChildArgs(t.GlyphButtonVE,o)},n}(e.HeroCommandButtonViewModel);e.GlyphCommandButtonViewModel=n}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.heroButtonArgs=function(){var e=this.buttonArgs,n=e.useGlyphIconText,o={buttonId:e.buttonId,click:this.buttonClick,calculateChecked:e.isActive,context:this,cssClass:{compute:new TDB.ComputedOptionArgs(this,this.calculateCssClass)},description:{value:e.text},fontIconArgs:{value:{fontIconName:{value:e.fontIconName},fontIconSizeClass:e.fontIconSizeClass}},glyphIconTextClass:n?"ContextHeroCommandButtonGlyphIconText":void 0,textElementText:{value:e.text},textClass:n?"ContextHeroCommandButtonTextWithTextGlyph":"ContextHeroCommandButtonText",useGlyphIconText:n};return new TDB.ChildArgs(t.ToggleButtonVE,o)},n}(e.HeroCommandButtonViewModel);e.ToggleCommandButtonViewModel=n}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function t(){}return t.prototype.getWidth=function(t){return t*e.ContextMenuVE.heroCommandWidth},t.prototype.getHeroCommandsClassNameArgs=function(){return"ContextMenuHeroCommands ContextMenuHeroCommandsHorizontal"},t.prototype.getBasicCommandsClassNameArgs=function(){return"ContextMenuBasicCommands"},t.prototype.getMenuRootStyle=function(e){return{}},t.prototype.getMenuCommandsStyle=function(e,n){return n?{height:t.commandHeight+1+"px"}:{height:t.commandHeight+"px"}},t.prototype.getEmphasisFlyoutWidth=function(t){return t*e.ContextMenuVE.heroCommandWidth},t.commandHeight=64,t}();e.HorizontalLayoutContextMenu=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel,o=function(e){function t(t,o){var i=e.call(this,t)||this;return i._args=o,i.isVisible=TDB.watchableTag(596473482,i,!1),i.cardNestingLevel=0,i.isPopup=!0,i.isHeading=!1,i._textCard=TDB.watchableTag(596473483,i,void 0),i._viewModel=new n.OnSurfaceTextEditorViewModel(i,{cardFactory:o.cardFactory,cardDefinitionManager:o.cardDefinitionManager}),i}return __extends(t,e),t.prototype.getViewElement=function(){return this},t.prototype.ifOnSurfaceTextEditorArgs=function(e){return this.isVisible.getWatchedValue(e)},t.prototype.open=function(e,t){this._viewModel.open(e,t)},t.prototype.isOpening=function(){return this._viewModel.inOpen()},t.prototype.mouseClicked=function(e){return 1!=e.which?TDB.EventPropagation.Bubble:TDB.EventPropagation.Bypass},t.prototype.textEditorArgs=function(){return this._textCard},t.prototype.dismiss=function(){this._viewModel.dismiss()},t.prototype.isActiveItem=function(e){return!0},t.prototype.isAncestorSelected=function(){return!1},t.prototype.getChildCards=function(e){return[]},t.prototype.childAcceptDraggables=function(e,t){return!1},t.prototype.areDescendantsVisible=function(e){return!0},t.prototype.isCollapsed=function(e){return!1},t.prototype.setTextCard=function(e){var t=this;TDB.applyUpdate(function(){t._textCard.setValue(e)})},t.prototype.getTextCard=function(){return this._textCard.getValue()},t.prototype.isRootHeading=function(){return!1},t.prototype.isExpandedSocketifiedCard=function(){return!1},t.prototype.keyDown=function(t){return t.keyCode===KeyCodeType.EscapeKey?(this.dismiss(),TDB.EventPropagation.PreventDefault):e.prototype.keyDown.call(this,t)},t.prototype.getText=function(){return this._viewModel.getText()},t}(TDB.FocusableViewElement);t.OnSurfaceTextEditorVEBase=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=function(e){function o(t,n){var o=e.call(this,t)||this;return o._args=n,o._textEditor=t,o}return __extends(o,e),o.prototype.inOpen=function(){return this._inOpen},o.prototype.open=function(e,o){var i,r=this;if(this._inOpen=!0,this._model=e,TDB.applyUpdate(function(){r._textEditor.isVisible.setValue(!0);var o=n.Socket.createSocketForModel(e,r._textEditor.getPageId());r.textCardViewModel=r._args.cardFactory.createTextCardVM(r,{model:r._model,socket:o,cardMode:t.CardMode.Collapsed}),i=r._args.cardFactory.createTextCard(r._textEditor,{cardParent:r._textEditor,viewModel:r.textCardViewModel}),r._textEditor.setTextCard(i)}),i){var a=i.getTextControl();if(o){var s=t.TextHelperMethods.generateElementId(o.id);a.setFocusToParagraph(s)}else a.setFocus()}this._inOpen=!1},o.prototype.dismiss=function(){var e=this;!this.inOpen()&&this._textEditor.isVisible.getValue()&&(StoryApp.View.Common.DialogManager.getCurrentDialog()||(this._model=void 0,TDB.applyUpdate(function(){var t=e._textEditor.getTextCard();t&&t.commit(),e._textEditor.setTextCard(null),e._textEditor.isVisible.setValue(!1)})))},o.prototype.getText=function(){return n.TextController.getTextRecursive(this._model)},o}(Disposable);t.OnSurfaceTextEditorViewModel=o}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(e){function n(t,n){var o=e.call(this,t)||this;return o.model=n,o.messageVisible=n.messageVisible,o.checkMessageVisible=n.checkMessageVisible,o.wrapperCss=n.wrapperCss||"overlaidContentAttribution",o.notificationTextCss=n.notificationTextCss||"contentAttributionText",o.linkMessageArgs=TDB.watchableOption(o,n.linkMessageArgs),o}return __extends(n,e),n.prototype.isVisible=function(e){return this.checkMessageVisible?this.checkMessageVisible.call(this.parent,e):this.messageVisible.getWatchedValue(e)},n.prototype.ifDismissableMessageArgs=function(e){return this.isVisible(e)},n.prototype.dismissableMessageCloseArgs=function(){return this.model.closeMessage},n.prototype.messagePartsArgs=function(e){for(var n=this.linkMessageArgs.getWatchedValue(e),o=[],i=0;i<n.length;i++){if(n[i].span){var r=n[i].span,a=new TDB.ChildArgs(t.SpanMessageVE,r);o.push(a)}if(n[i].link&&n[i].link.message&&n[i].link.message.length>0){var s=n[i].link,l=new TDB.ChildArgs(t.ClickableLinkVE,s);o.push(l)}}return o},n.prototype.dismissableMessageContainerClassNameArgs=function(e){return this.wrapperCss},n.prototype.dismissableMessageTextClassNameArgs=function(e){return this.notificationTextCss},n}(TDB.FocusableViewElement);e.DismissableNotificationVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=StoryApp.View.Common.FRE,o=function(o){function i(e,t){var n=o.call(this,e,t)||this;return n.args=t,n.totalResults=TDB.watchableTag(596473475,n,void 0),n.description=TDB.watchableOption(n,n.args.description),n.currentText="",n.onFocusText="",n.isFocused=TDB.watchableTag(596473476,n,!1),n.isTextBoxEmpty=TDB.watchableTag(596473477,n,!0),n.suggestionsListEscaped=TDB.watchableTag(596473478,n,!1),n.searchedTextChanged=TDB.watchableTag(596473479,n,!1),n.screenReaderText=TDB.watchableTag(596453150,n,Resources.SearchBoxDescription),n}return __extends(i,o),i.prototype.getText=function(){return this.searchBox?this.searchBox.getText():""},i.prototype.ifSearchBoxArgs=function(e){return!this.args.show||this.args.show.call(this.args.context,e)},i.prototype.searchFormEventsInitArgs=function(){var e=this;return{submit:function(t){return e.onSubmit(t)===TDB.EventPropagation.Bubble}}},i.prototype.loadingSpinnerAttrArgs=function(e){return{src:CommonSettings.ContentBaseUrl+"loadingpinkspinner.16x16x8.gif"}},i.prototype.searchResultsClassNameArgs=function(e){return"SearchTotalResults"},i.prototype.searchBoxCalloutArgs=function(e){var o=n.CalloutID.AddContentSearchBox;if(n.getCalloutManager().isActiveCallout(e,o)){var i={calloutBoxClassName:"AddContentSearchBox-callout",delay:n.getDelayForCallout(n.CalloutID.AddContentSearchBox,n.FirstRunType.Default),headerText:{value:Resources.FirstRunAddContentSearchBoxHeader},readerText:Resources.FirstRunAddContentSearchBoxReader,calloutID:o,beakPosition:t.BeakPosition.TopLeft};return new TDB.ChildArgs(t.FRECalloutVE,i)}},i.prototype.ifSearchResultsArgs=function(e){return void 0!==e.watchValue(this.totalResults)},i.prototype.searchResultsTextArgs=function(e){return e.watchValue(this.totalResults)+Resources.Results},i.prototype.searchBoxArgs=function(n){var o=this,i={description:this.description.getWatchedValue(n),placeholder:{watchable:this.args.placeholder},cssClass:"SearchBox",maxLength:256,role:Aria.Roles.Search,tabIndex:e.AddContentTabIndex.SearchBox,enabled:this.args.enabled,selectTextOnFocus:!0,context:this,focusChanged:this.onTextBoxFocusChanged,text:this.currentText,onInput:function(e){return o.onInput(e)}};return new TDB.ChildArgs(t.TextBoxVE,i)},i.prototype.onTextBoxFocusChanged=function(e){var t=this;this.lastSearchboxText=this.getText(),e&&""===this.lastSearchboxText?(TDB.applyUpdate(function(){t.suggestionsListEscaped.setValue(!1),t.isFocused.setValue(!0)}),this.setText(this.onFocusText)):e||""===this.lastSearchboxText||this.lastSearchboxText!=this.onFocusText||this.setText("")},i.prototype.searchButtonArgs=function(n){if(this.shouldDisplaySearchButton(n)){var o={buttonId:ClientAction.ButtonId.AddContent_Search,click:this.onSubmit,context:this,cssClass:{value:"SearchBoxSearchButton"},description:{value:Resources.SearchContentButtonDescription},tooltip:{value:Resources.SearchContentButtonDescription},enabled:this.args.enabled,fontIconName:{value:FontIcons.SearchIcon},fontIconSizeClass:FontIcons.SearchIconSize,tabIndex:e.AddContentTabIndex.SearchButton};return new TDB.ChildArgs(t.GlyphButtonVE,o)}},i.prototype.clearButtonArgs=function(e){if(!this.shouldDisplaySearchButton(e)){var n={buttonId:ClientAction.ButtonId.AddContent_ClearSearch,click:this.onClearButton,context:this,cssClass:{value:"SearchBoxClearButton"},enabled:this.args.enabled,fontIconName:{value:FontIcons.AddContentCloseIcon},fontIconSizeClass:FontIcons.ClearSearchIconSize,description:{value:Resources.ClearSearchButtonDescription},tooltip:{value:Resources.ClearSearchButtonTooltip}};return new TDB.ChildArgs(t.GlyphButtonVE,n)}},i.prototype.shouldDisplaySearchButton=function(e){var t=this.args.context.suggestionsClusterCollection.showVisualClusters(e),n=this.searchedTextChanged.getWatchedValue(e);return t||n},i.prototype.onClearButton=function(e){return this.clearSearch(),this.updateDropdownVisibility(!0),TDB.EventPropagation.PreventDefault},i.prototype.onInput=function(e){var t=this;return TDB.applyUpdate(function(){var e=""==t.searchBox.getText();t.isTextBoxEmpty.setValue(e),t.suggestionsListEscaped.setValue(!e),t.searchedTextChanged.setValue(!0)}),!1},i.prototype.onSubmit=function(e){return this.executeSearch(),e.stopPropagation(),e.preventDefault(),TDB.EventPropagation.PreventDefault},i.prototype.executeSearch=function(){var e=this.isFocused?this.getText():this.lastSearchboxText;this.setText(e);var t=this.parent.selectedSource.getValue(),n=new ClientAction.AddContentUIPaneData(ClientAction.ActionType.Edit_AddContentUI_Search,"",t.providerType);ActionLogger.RecordClientAction(n),this.searchBox&&this.searchBox.isEnabled()&&this.args.onSearch&&this.args.context&&this.args.onSearch.call(this.args.context,e)},i.prototype.mouseDown=function(e){return TDB.EventPropagation.Bypass},i.prototype.mouseUp=function(e){return TDB.EventPropagation.Bypass},i.prototype.mouseClicked=function(e){return n.FirstRunTriggers.contentPaneUserInteractedWithSearchBox(),TDB.EventPropagation.Bypass},i.prototype.keyDown=function(e){switch(n.FirstRunTriggers.contentPaneUserInteractedWithSearchBox(),e.keyCode){case KeyCodeType.DownArrowKey:this.handleDownArrowKey();break;case KeyCodeType.EscapeKey:return this.handleEscapeKey()}return TDB.EventPropagation.Bubble},i.prototype.handleEscapeKey=function(){var e=this;return this.searchBox.getText()&&this.clearSearch(),TDB.applyUpdate(function(){return e.suggestionsListEscaped.setValue(!0)}),this.updateDropdownVisibility(!1),TDB.EventPropagation.PreventDefault},i.prototype.handleDownArrowKey=function(){var e=this;TDB.applyUpdate(function(){return e.suggestionsListEscaped.setValue(!1)}),this.updateDropdownVisibility(!1),this.activateSuggestionsList()},i.prototype.clearSearch=function(){this.setText(""),this.lastSearchboxText="",this.currentText=""},i.prototype.setText=function(e){var t=this,n=""===e;TDB.applyUpdate(function(){t.isTextBoxEmpty.setValue(n),t.suggestionsListEscaped.setValue(!n),t.searchedTextChanged.setValue(n)}),this.searchBox&&(this.currentText=e,this.searchBox.setText(e))},i.prototype.setOnFocusText=function(e){this.onFocusText=e},i.prototype.searchSuggestionsListArgs=function(){var t=this.parent.suggestionsClusterCollection;if(t.supportedLanguage())return new TDB.ChildArgs(e.SearchSuggestionsListVE,{suggestionsClusters:t.suggestionsClusters,dropdownTriggerControl:this.searchBox})},i.prototype.searchSuggestionsListWrapperVisibleArgs=function(e){var t=this.parent.suggestionsClusterCollection.showVisualClusters(e),n=!this.isActivated(e)||!this.parent.isActivated(e),o=!this.isTextBoxEmpty.getWatchedValue(e),i=this.suggestionsListEscaped.getWatchedValue(e);return!(t||n||o||i)},i.prototype.updateDropdownVisibility=function(e){if(this.searchSuggestionsList){var t=this.searchSuggestionsListWrapperVisibleArgs(void 0);this.searchSuggestionsList.setDropdownVisibility(t,e)}},i.prototype.activateSuggestionsList=function(){this.searchSuggestionsList&&this.searchSuggestionsList.activateDropdown()},i.prototype.firstChanceMouseEvent=function(e,t,n){var i=n;if(t===TDB.ViewElementMouseEventType.MouseDownEvent){for(;n&&n!==this;)n=n.parent;n||this.deactivate()}return o.prototype.firstChanceMouseEvent.call(this,e,t,i)},i.prototype.searchBoxReaderTextArgs=function(e){return this.screenReaderText.getWatchedValue(e)},i.prototype.setScreenReaderText=function(e){var t=this;TDB.applyUpdate(function(){t.screenReaderText.setValue(e)})},i}(TDB.ControlSet);e.SearchBoxVEBase=o}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Server.Decomposition.WP,o=function(e){function o(t,n){var o=e.call(this,t)||this;return o.args=n,o}return __extends(o,e),o.prototype.dropdownListArgs=function(e){var n=this,o={wrapperClassName:{value:"SearchSuggestionsListWrapper"},dropdownButtonArgs:void 0,dropdownTriggerControl:this.args.dropdownTriggerControl,listItemType:t.SearchSuggestionVE,listItemsArgs:{compute:new TDB.ComputedOptionArgs(this,function(e){return n.getSuggestions(e)})},dropdownTelemetryId:ClientAction.ButtonId.AddContent_SearchDropdown,ulsCategory:Diag.ULSCat.msoulscat_Story_AddContent};return new TDB.ChildArgs(VE.DropdownListVE,o)},o.prototype.setDropdownVisibility=function(e,t){this.dropdownList.setDropdownVisibility(e,t)},o.prototype.activateDropdown=function(){this.dropdownList.canActivate()&&this.dropdownList.activate()},o.prototype.getSuggestions=function(e){return this.args.suggestionsClusters.getWatchedValue(e).map(this.createSearchSuggestionArgs,this)},o.prototype.createSearchSuggestionArgs=function(e,t){var n=this;return{suggestionsCluster:e,onActivated:function(){return e.setClusterActivity(!0)},isSelected:{compute:new TDB.ComputedOptionArgs(this,function(t){return n.isSuggestionSelected(t,e)})},buttonId:ClientAction.ButtonId.AddContent_SelectSearch,description:{value:ResourceManager.ResolveString(Resources.SuggestionsClusterScreenReaderValue,[e.cluster.Name])}}},o.prototype.isSuggestionSelected=function(e,t){return t.selection.getWatchedValue(e)===n.SuggestionsClusterSelection.Active},o}(TDB.FocusableViewElement);t.SearchSuggestionsListVEBase=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Server.Decomposition.WP,o=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.args=n,o}return __extends(t,e),t.prototype.ifSearchSuggestionImageArgs=function(){return!StoryPageEditSettings.HideVisualClusterBackgroundImage},t.prototype.searchSuggestionImageStyleArgs=function(e){return{backgroundImage:null!=this.args.suggestionsCluster.cluster.ClusterVisualRepresentation?"url("+this.args.suggestionsCluster.getVisualRepresentation(e)+")":"",height:"40px",width:"40px",backgroundPosition:"center",backgroundSize:"cover",display:"table-cell"}},t.prototype.wrapperStyleArgs=function(e){return{backgroundColor:this.args.suggestionsCluster.selection.getWatchedValue(e)===n.SuggestionsClusterSelection.Active?"#d2d2d2":void 0}},t.prototype.searchSuggestionNameTextArgs=function(e){return this.args.suggestionsCluster.cluster.Name},t.prototype.onAction=function(t){return e.prototype.onAction.call(this,t),this.args.onActivated(),TDB.EventPropagation.Bypass},t.prototype.getDescription=function(e){return ResourceManager.ResolveString(Resources.SuggestionsClusterScreenReaderValue,[this.args.suggestionsCluster.cluster.Name])},t}(VE.DropdownListItemVE);t.SearchSuggestionVEBase=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(e){function n(t,n){var o=e.call(this,t)||this;return o.model=n,o}return __extends(n,e),n.prototype.licenseCheckboxArgs=function(){return this.model.licenseCheckboxArgs()},n.prototype.messageTextArgs=function(e){return this.model.messageTextArgs(e)},n.prototype.ifMessageArgs=function(e){return""!=this.messageTextArgs(e)},n.prototype.messageClassNameArgs=function(e){return this.model.messageClassNameArgs(e)},n.prototype.loadingMessageArgs=function(){return this.model.loadingMessageArgs()},n.prototype.resultsPanelArgs=function(){return this.model.resultsPanelArgs()},n.prototype.tabHeaderArgs=function(){return new TDB.ChildArgs(t.TabHeaderVE,this.model.tabHeader)},n.prototype.ifTabHeaderArgs=function(e){return this.model.ifTabHeaderArgs(e)},n.prototype.breadcrumbPathArgs=function(e){return this.model.breadcrumbPathArgs(e)},n.prototype.connectButtonArgs=function(e){return this.model.connectButtonArgs(e)},n.prototype.refreshButtonArgs=function(e){return this.model.refreshButtonArgs(e)},n.prototype.creativeCommonsVisibleArgs=function(e){return this.model.creativeCommonsVisibleArgs(e)},n.prototype.attributionNotificationArgs=function(){return this.model.attributionNotificationArgs()},n.prototype.creativeCommonsLegalNotificationArgs=function(){return this.model.creativeCommonsLegalNotificationArgs()},n}(TDB.FocusableViewElement);e.BasicContentPageVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n,o=e.Server.Decomposition.WP,i=e.Model.SM,r=StoryApp.View.ViewElements,a=e.Server.Decomposition;!function(e){e[e.SearchIntro=0]="SearchIntro",e[e.ShowingContent=1]="ShowingContent",e[e.NoSearchContent=2]="NoSearchContent",e[e.NoTabContent=3]="NoTabContent",e[e.ConnectionError=4]="ConnectionError",e[e.UnauthenticatedUserFailure=5]="UnauthenticatedUserFailure",e[e.ComingSoon=6]="ComingSoon",e[e.GenericBrokerFailure=7]="GenericBrokerFailure",e[e.PasswordAuthFailure=8]="PasswordAuthFailure",e[e.DisabledProviderFailure=9]="DisabledProviderFailure",e[e.UnauthenticatedContentOnly=10]="UnauthenticatedContentOnly"}(n=t.BasicContentPageState||(t.BasicContentPageState={}));var s=function(e){function s(t,n){var o=e.call(this,n)||this;o.parent=t,o.pageSelected=TDB.notifierTag(596444306,o),o.source=n.source;var i=void 0!=o.source.tabs&&o.source.tabs.length>0;return o.pageState=TDB.watchableTag(596444307,o,o.pageStateInit(i)),o.executingRequest=TDB.watchableTag(596444308,o,!1),o.searchQuery="",o.pendingSearchQuery="",o.connectAttempted=TDB.watchableTag(596444309,o,!1),o.licenseCheckboxVisible=TDB.watchableTag(596444310,o,!1),o.createLoadingMessage(),o.createSearchContentCollection(n),i&&o.createTabsAndContentCollections(),o.createAttributionVisibilityVariable(),o.createCreativeCommonsVisibilityVariable(),o}return __extends(s,e),s.prototype.getViewArgs=function(){return new TDB.ChildArgs(t.BasicContentPageVE,this)},s.prototype.createLoadingMessage=function(){this.loadingMessage=TDB.watchableTag(596444311,this,Resources.LoadingMessage),this.forceLoadingMessage=TDB.watchableTag(596444312,this,!1)},s.prototype.createSearchContentCollection=function(e){this.contentCollectionArgs={addContent:this.parent,cardDefinitionManager:e.cardDefinitionManager,cardsContainer:e.cardsContainer,context:this,resourceFactory:this.resourceFactory,decompService:new a.DecompositionAPI,onFolderNavigated:this.onFolderNavigated},this.searchContentCollection=this.contentCollectionFactory.createContentCollection(this.contentCollectionArgs)},s.prototype.createTabsAndContentCollections=function(){this.tabs=[];for(var e=0;e<this.source.tabs.length;e++){var n={contentTab:this.source.tabs[e],breadcrumbPath:new t.BreadcrumbPathViewModel({parent:this,addContent:this.parent}),tabState:this.pageStateInit(!0)},o=this.contentCollectionFactory.createContentCollection(this.contentCollectionArgs),i=this.createBreadcrumbArgs(n.contentTab.displayName,o,n.contentTab.browseDescriptor,!0,void 0!=n.contentTab.breadcrumbSkipUsername&&n.contentTab.breadcrumbSkipUsername);n.breadcrumbPath.addBreadcrumb(i),e===this.getContentSource().searchTabIndex&&(this.searchContentCollection=o),this.tabs.push(n)}var a={context:this,tabKeys:this.tabs,tabConstructor:this.tabConstructor,tabSelected:this.tabSelected};this.tabHeader=new r.TabHeaderViewModel(a)},s.prototype.createAttributionVisibilityVariable=function(){var e=this.source&&s.isProvider(this.source.providerType,[i.ContentProvider.Bing,i.ContentProvider.YouTube,i.ContentProvider.Facebook,i.ContentProvider.Twitter,i.ContentProvider.PicHit,i.ContentProvider.Flickr,i.ContentProvider.Shutterstock]);this.attributionVisible=TDB.watchableTag(596444313,this,e)},s.prototype.createCreativeCommonsVisibilityVariable=function(){var e=this;this.creativeCommonsVisible=TDB.watchableTag(596444314,this,!1),this.contentPageHasLicense=this.source&&null!=this.storyPageEditSettings.TabsWithLicense.firstOrDefault(function(t){return t===e.source.providerType})},s.prototype.getLicenseCheckboxClass=function(){return"LegalNotificationStandalone"},s.isProvider=function(e,t){return null!==ArrayExtensions.firstOrDefault(t,function(t){return e==i.ContentProvider[t]})},s.prototype.getContentSource=function(){return this.source},s.prototype.getResultsPanel=function(){return this.resultsPanel},s.prototype.tabSelected=function(e){var t=this,o=this.tabs[e],i=o.contentTab.searchboxPlaceholderOverride;TDB.applyUpdate(function(){return t.parent.searchPlaceholder.setValue(i||Resources.SearchBoxPlaceholder)});var r=o.contentTab.defaultSearchBoxFocusText;this.parent.updateSearchBoxFocusText(r||"");var a=this.pageState.getValue();-1!==this.tabHeader.getPreviouslySelectedTabIndex()&&(this.tabs[this.tabHeader.getPreviouslySelectedTabIndex()].tabState=a),TDB.applyUpdate(function(){t.pageState.setValue(o.tabState)}),(a=o.tabState)!=n.UnauthenticatedUserFailure&&(this.resetLicenseNotification(),this.changeBreadcrumbOnTabSelected(e))},s.prototype.selectDefaultTabAndBrowse=function(){var e=this;if(0!==this.tabs.length){this.tabHeader.changeStateOfTabIndex(0);var t=this.tabs[0],o=t.breadcrumbPath,i=o.breadcrumbCount(),r=this.pageState.getValue();if(-1!==this.tabHeader.getPreviouslySelectedTabIndex()&&(this.tabs[this.tabHeader.getPreviouslySelectedTabIndex()].tabState=r),TDB.applyUpdate(function(){e.pageState.setValue(t.tabState)}),(r=t.tabState)!=n.UnauthenticatedUserFailure&&(this.resetLicenseNotification(),1==i)){var a=o.getCurrentKey();void 0!=t.contentTab.browseDescriptor&&this.browseTab(t,a)}}},s.prototype.navigateBack=function(){var e=this.getBreadcrumbPath();null!=e&&e.navigateBack()},s.prototype.breadcrumbChanged=function(){var e=this;TDB.applyUpdate(function(){e.resetScrollPosition.notify(),e.parent.selectionManager.clearSelection(),e.pageState.getValue()!=n.UnauthenticatedContentOnly&&e.pageState.setValue(n.ShowingContent)})},s.prototype.getCurrentContentCollection=function(e){if(void 0!=this.tabHeader){var t=this.tabHeader.getSelectedTabIndex(e);if(t>-1){var n=this.tabs[t].breadcrumbPath.getCurrentKey(e);if(null!=n)return n}}return this.searchContentCollection},s.prototype.IsCurrentContentAuthenticated=function(e){var t=this.pageState.getWatchedValue(e);switch(this.source.providerType){case i.ContentProvider[i.ContentProvider.Facebook]:case i.ContentProvider[i.ContentProvider.OneDrivePro]:case i.ContentProvider[i.ContentProvider.PicHit]:case i.ContentProvider[i.ContentProvider.SkyDrive]:case i.ContentProvider[i.ContentProvider.OneDrive]:return t==n.ShowingContent;case i.ContentProvider[i.ContentProvider.Flickr]:return"Search"!=this.tabs[this.tabHeader.getSelectedTabIndex()].contentTab.Id&&t==n.ShowingContent;default:return!1}},s.prototype.IsCurrentContentFromSearch=function(e){var t=this.pageState.getWatchedValue(e);return!!this.canSearch(e)&&(this.IsBrowsable()?"Search"==this.tabs[this.tabHeader.getSelectedTabIndex(e)].contentTab.Id:t==n.ShowingContent)},s.prototype.IsBrowsable=function(){return null!=this.tabs&&null!==ArrayExtensions.firstOrDefault(this.tabs,function(e){return void 0!=e.contentTab.browseDescriptor})},s.prototype.onNavigateTo=function(){var e=this;TDB.applyUpdate(function(){e.parent.searchPlaceholder.setValue(Resources.SearchBoxPlaceholder),e.tabHeader&&(-1===e.tabHeader.getSelectedTabIndex()?""!=e.parent.getSearchText()&&void 0!=e.source.searchTabIndex&&-1!=e.source.searchTabIndex?e.tabHeader.selectTabIndex(e.source.searchTabIndex):e.hasLandingPage()?e.resetPageState():e.tabHeader.selectTabIndex(0):e.tabHeader.selectTabIndex(e.tabHeader.getSelectedTabIndex())),e.resetLicenseNotification(),e.pageSelected.notify()})},s.prototype.loadingMessageVisible=function(e){return this.getCurrentContentCollection(e).requestLoading.getWatchedValue(e)||this.forceLoadingMessage.getWatchedValue(e)},s.prototype.canSearch=function(e){return void 0!=this.getSearchDescriptor(e)},s.prototype.search=function(e,t){var n=this;void 0===t&&(t=void 0);var i=this.getSearchDescriptor();if(!i)throw StoryApp.RethrowLogger.createError("Source cannot be searched");TDB.applyUpdate(function(){return n.parent.searchPlaceholder.setValue(Resources.SearchBoxPlaceholder)});var r=this.source.searchTabIndex;void 0!=r&&-1!=r&&this.tabHeader.selectTabIndex(r),this.executingRequest.getValue()||this.getCurrentContentCollection().requestLoading.getValue()?this.pendingSearchQuery=e:(this.searchQuery=e,TDB.applyUpdate(function(){null==t&&(t=o.RequestLicenseTypeExtensions.getDefaultLicenseType(),n.checkLicenseCheckbox()),n.resetScrollPosition.notify(),n.resetLicenseNotification(),n.loadingMessage.setValue(Resources.Searching),n.executingRequest.setValue(!0),n.getCurrentContentCollection().clearContentPieces(),n.handleDecompTaskCompletion(n.getCurrentContentCollection().decomposeSearch(e,i,t))}))},s.prototype.searchClusters=function(e,t){void 0===t&&(t=void 0),this.search(e.first().Name,t)},s.prototype.clearSearch=function(){var e=this;if(this.searchQuery="",!this.getSearchDescriptor())throw StoryLog.StructuredTraceTag(595945684,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.info,"Source search complaint info",{hasTabHeader:!!this.tabHeader,searchDescriptor:this.source&&this.source.searchDescriptor,searchQuery:this.searchQuery,searchTabIndex:this.source&&this.source.searchTabIndex}),StoryApp.RethrowLogger.createError("Source cannot be searched");TDB.applyUpdate(function(){e.getCurrentContentCollection().clearContentPieces(),e.pageState.setValue(n.SearchIntro),e.licenseCheckboxVisible.setValue(!1),e.resetPageState()})},s.prototype.onFolderNavigated=function(e){var t=this,n=this.tabHeader.getSelectedTabIndex(),o=this.tabs[n].breadcrumbPath,i=e.isFocused(),r=this.contentCollectionFactory.createContentCollection(this.contentCollectionArgs),a=this.createBreadcrumbArgs(e.title,r,e.partGroup.BrowseDescriptor);this.resetLicenseNotification(),TDB.applyUpdate(function(){t.resetScrollPosition.notify()}),o.addBreadcrumb(a),TDB.applyUpdate(function(){i&&t.parent.updateActiveChild(TDB.OffsetOrigin.Current,-1),t.handleDecompTaskCompletion(r.decomposeBrowse(e.partGroup.BrowseDescriptor)),t.loadingMessage.setValue(Resources.Loading)});var s=this.parent.selectedSource.getValue(),l=new ClientAction.AddContentUIPaneData(ClientAction.ActionType.Edit_AddContentUI_OpenFolder,"",s.providerType);ActionLogger.RecordClientAction(l)},s.prototype.isConnectButtonVisible=function(e){if(void 0==this.source.connectUrl)return!1;var t=this.pageState.getWatchedValue(e);return t==n.UnauthenticatedUserFailure||t==n.PasswordAuthFailure},s.prototype.refreshVisible=function(e){return this.storyPageEditSettings.RefreshAddContentAccountEnabled&&this.isConnectButtonVisible(e)&&this.connectAttempted.getWatchedValue(e)},s.prototype.attributionCloseButtonClicked=function(e){var t=this;TDB.applyUpdate(function(){t.attributionVisible.setValue(!1),t.resultsPanel.updateActiveChild(TDB.OffsetOrigin.Current,0)});var n=this.parent.selectedSource.getValue(),o=new ClientAction.AddContentUIPaneData(ClientAction.ActionType.Edit_AddContentUI_AttributionClose,"",n.providerType);return ActionLogger.RecordClientAction(o),TDB.EventPropagation.Bypass},s.prototype.creativeCommonsCloseButtonClicked=function(e){var t=this;TDB.applyUpdate(function(){t.creativeCommonsVisible.setValue(!1),t.resultsPanel.updateActiveChild(TDB.OffsetOrigin.Current,0)});var n=this.parent.selectedSource.getValue(),o=new ClientAction.AddContentUIPaneData(ClientAction.ActionType.Edit_AddContentUI_CreativeCommonsNotificationClose,"",n.providerType);return ActionLogger.RecordClientAction(o),TDB.EventPropagation.Bypass},s.prototype.licenseCheckboxClicked=function(e){var t={};t.Description="Add Content Show All Results Clicked",t.AddContentPane=null!=this.source?this.source.providerType:"Unknown";var n=new ClientAction.ButtonClickAction(ClientAction.ButtonId.ShowAllResults,Diag.ULSCat.msoulscat_Story_AddContent,t);return ActionLogger.RecordClientAction(n),this.search(this.searchQuery,this.getLicenseCheckboxChecked()?o.RequestLicenseType.Share:o.RequestLicenseType.All),TDB.EventPropagation.Bypass},s.prototype.resetLicenseNotification=function(){var e=this;TDB.applyUpdate(function(){e.licenseCheckboxVisible.setValue(e.contentPageHasLicense&&(!e.hasLandingPage()||!e.showingLandingPage())&&(e.pageState.getValue()==n.ShowingContent||e.pageState.getValue()==n.NoSearchContent)),e.creativeCommonsVisible.setValue(e.checkCreativeCommonsMessageVisible())})},s.prototype.getMessage=function(){return this.basicContentPageMessage},s.prototype.onTransitionEndEvent=function(e){var t=this;TDB.applyUpdate(function(){t.parent.parent.addContentPaneResize.notify()},TDB.Justification.SynchronousBrowserEvent)},s.prototype.browseTab=function(e,t,n){var o=this;this.searchQuery="",TDB.applyUpdate(function(){o.resetScrollPosition.notify(),o.handleDecompTaskCompletion(t.decomposeBrowse(n||e.contentTab.browseDescriptor)),o.loadingMessage.setValue(Resources.Loading)})},s.prototype.resetPageState=function(){var e=this;if(this.storyPageEditSettings.LandingPageEnabled){TDB.applyUpdate(function(){return e.parent.preventVisualClusters.setValue(!0)});var t=this.getContentSource();this.hasLandingPage()?(TDB.applyUpdate(function(){return e.pageState.setValue(n.ShowingContent)}),this.tabHeader.selectTabIndex(t.landingPageTabIndex)):TDB.applyUpdate(function(){return e.parent.searchPlaceholder.setValue(Resources.SearchBoxPlaceholder)})}},s.prototype.showingLandingPage=function(){return!!this.storyPageEditSettings.LandingPageEnabled&&(this.hasLandingPage()&&this.tabHeader.getSelectedTabIndex()==this.getContentSource().landingPageTabIndex)},s.prototype.hasLandingPage=function(){return!!this.storyPageEditSettings.LandingPageEnabled&&(this.tabHeader&&-1!=this.getContentSource().landingPageTabIndex)},s.prototype.getSelectedContentTab=function(){var e=null;if(this.tabHeader){var t=this.tabHeader.getSelectedTabIndex();e=this.tabs[t].contentTab}return e},s.prototype.connect=function(e){var t=this,o=this.tabHeader.getSelectedTabIndex(),i=new ClientAction.AddContentConnectButtonClicked(this.source.providerType,o>-1?this.tabs[o].contentTab.Id:"");return ActionLogger.RecordClientAction(i),Cookie.setODCSMForceRefresh(StoryPageSettings.RefreshODCSMCookie),this.pageState.getValue()==n.PasswordAuthFailure?this.source.connectUrl=this.source.connectUrl.replace("authz=False","authz=True"):this.source.connectUrl=this.source.connectUrl.replace("authz=True","authz=False"),window.location.href=this.source.connectUrl,TDB.applyUpdate(function(){t.connectAttempted.setValue(!0)}),TDB.EventPropagation.Bypass},s.prototype.refresh=function(e){var t=this,n=this.tabs[this.tabHeader.getSelectedTabIndex()];return void 0!=n.contentTab.browseDescriptor&&(n.contentTab.browseDescriptor.RefreshConnectedServices=!0,TDB.applyUpdate(function(){t.pageState.setValue(t.pageStateInit(!0)),t.browseTab(n,n.breadcrumbPath.getCurrentKey())})),TDB.EventPropagation.Bypass},s.prototype.onDecompSuccess=function(e){var t=this;if(!this.shouldIgnoreDecompositionResponse()){var o=this.getCurrentContentCollection(),i=o.getContentPieces().length,r=e;if(i>0&&TDB.applyUpdate(function(){void 0==r.IsAuthenticated||r.IsAuthenticated?t.pageState.setValue(n.ShowingContent):t.pageState.setValue(n.UnauthenticatedContentOnly)}),this.resultsPanel.checkHeightRef&&!this.resultsPanel.checkHeightRef.checkHeight()){var a=o.decomposeNext();if(a)return void this.handleDecompTaskCompletion(a)}0===i&&TDB.applyUpdate(function(){o==t.searchContentCollection?t.pageState.setValue(n.NoSearchContent):t.pageState.setValue(n.NoTabContent)}),TDB.applyUpdate(function(){t.executingRequest.setValue(!1)}),this.resetLicenseNotification(),this.executePendingSearchIfNeeded()}},s.prototype.onDecompError=function(){var e=this;this.shouldIgnoreDecompositionResponse()||(0==this.getCurrentContentCollection().getContentPieces().length&&TDB.applyUpdate(function(){e.pageState.setValue(n.ConnectionError)}),TDB.applyUpdate(function(){e.executingRequest.setValue(!1)}),this.executePendingSearchIfNeeded())},s.prototype.onDecompFailure=function(e){var t=this;if(!this.shouldIgnoreDecompositionResponse()){var i=this.getCurrentContentCollection().getContentPieces().length;TDB.applyUpdate(function(){var r=o.DecompositionStatus.fromString(e.Status);r===o.DecompositionStatus.UnauthenticatedUserFailure?(t.getCurrentContentCollection().clearContentPieces(),t.pageState.setValue(n.UnauthenticatedUserFailure)):r===o.DecompositionStatus.PasswordAuthFailure?(e.ErrorMessage&&(t.decompErrorMessage=e.ErrorMessage),t.getCurrentContentCollection().clearContentPieces(),t.pageState.setValue(n.PasswordAuthFailure)):r===o.DecompositionStatus.DisabledProviderFailure?(t.turnOnMaintenance(),e.ErrorMessage&&(t.decompErrorMessage=e.ErrorMessage)):0===i&&t.pageState.setValue(n.ConnectionError)}),TDB.applyUpdate(function(){t.executingRequest.setValue(!1)}),this.executePendingSearchIfNeeded()}},s.prototype.messageTextArgs=function(e){if(this.basicContentPageMessage="",this.loadingMessageVisible(e)||this.executingRequest.getWatchedValue(e))return this.setAndReturnMessage("");switch(this.pageState.getWatchedValue(e)){case n.SearchIntro:return this.setAndReturnMessage(StoryApp.Common.Branding.getStringBasicContentPageSearchIntro());case n.NoSearchContent:return this.setAndReturnMessage(Resources.BasicContentPageNoSearchContent);case n.NoTabContent:return this.setAndReturnMessage(Resources.BasicContentPageNoTabContent);case n.ConnectionError:return this.setAndReturnMessage(Resources.BasicContentpageConnectionError);case n.UnauthenticatedUserFailure:return this.source.providerType==i.ContentProvider[i.ContentProvider.Flickr]?this.setAndReturnMessage(Resources.BasicContentPageUnauthenticatedFlickrUser):this.setAndReturnMessage(Resources.BasicContentPageUnauthenticatedUser);case n.ComingSoon:return this.setAndReturnMessage(Resources.BasicContentPageComingSoon);case n.PasswordAuthFailure:return null!=this.decompErrorMessage&&""!=this.decompErrorMessage?this.setAndReturnMessage(this.decompErrorMessage):this.setAndReturnMessage(Resources.BasicContentpageConnectionError);case n.DisabledProviderFailure:return null!=this.decompErrorMessage&&""!=this.decompErrorMessage?this.setAndReturnMessage(this.decompErrorMessage):this.setAndReturnMessage(Resources.ContentSourceUnderMaintenance)}return this.setAndReturnMessage("")},s.prototype.setAndReturnMessage=function(e){return this.basicContentPageMessage=e,e},s.prototype.messageClassNameArgs=function(e){var t=this.pageState.getWatchedValue(e);return t==n.ConnectionError||t==n.UnauthenticatedUserFailure||t==n.PasswordAuthFailure?"BasicContentPageErrorMessage":"BasicContentPageMessage"},s.prototype.loadingMessageArgs=function(){var e={message:{watchable:this.loadingMessage},visible:{compute:new TDB.ComputedOptionArgs(this,this.loadingMessageVisible)}};return new TDB.ChildArgs(r.LoadingMessageVE,e)},s.prototype.resultsPanelArgs=function(){var e=this;return new TDB.ChildArgs(t.BasicContentPageResultsPanelVE,this,function(t){e.resultsPanel=t})},s.prototype.ifTabHeaderArgs=function(e){return this.tabs&&this.tabs.length>0&&this.hasVisibleTabs()&&(this.source&&this.source.providerType!=i.ContentProvider[i.ContentProvider.OneDrivePro]||!this.storyPageEditSettings.BlockAuthoring_OneDriveBusinessRecentTab)&&(this.source&&this.source.providerType!=i.ContentProvider[i.ContentProvider.SkyDrive]||!this.storyPageEditSettings.BlockAuthoring_OneDriveSearch)&&(this.source&&this.source.providerType!=i.ContentProvider[i.ContentProvider.OneDrive]||!this.storyPageEditSettings.BlockAuthoring_OneDriveSearch)},s.prototype.breadcrumbPathArgs=function(e){var n=this.getBreadcrumbPath(e);return n?new TDB.ChildArgs(t.BreadcrumbPathVE,n):void 0},s.prototype.getBreadcrumbPath=function(e){if(void 0!=this.tabHeader){var t=this.tabHeader.getSelectedTabIndex(e);if(t>-1){var n=this.tabs[t].breadcrumbPath;if(n.breadcrumbCount(e)>1)return n}}},s.prototype.connectButtonArgs=function(e){if(!this.isConnectButtonVisible(e))return null;var t={buttonId:ClientAction.ButtonId.AddContent_ConnectAccount,click:this.connect,context:this,cssClass:{compute:new TDB.ComputedOptionArgs(this,this.connectCssClass)},text:{compute:new TDB.ComputedOptionArgs(this,this.connectText)}};return new TDB.ChildArgs(r.TextButtonVE,t)},s.prototype.refreshButtonArgs=function(e){if(!this.refreshVisible(e))return null;var t={buttonId:ClientAction.ButtonId.AddContent_RefreshAccount,click:this.refresh,context:this,cssClass:{value:"BasicContentPageRefreshButton"},text:{value:ResourceManager.ResolveString(Resources.BasicContentPageRefresh,[this.source.displayName])}};return new TDB.ChildArgs(r.TextButtonVE,t)},s.prototype.creativeCommonsVisibleArgs=function(e){return this.checkCreativeCommonsMessageVisible(e)&&this.creativeCommonsVisible.getWatchedValue(e)},s.prototype.getAttributionNotificationMessage=function(){var e={url:Resources.AttributionLinkUrl,message:Resources.AttributionLink,title:Resources.AttributionLinkTooltip},t=[];if(s.isProvider(this.source.providerType,[i.ContentProvider.PicHit])){var n=Resources.AttributionPicHitLink,o=Resources.AttributionPicHitLinkUrl,r=Resources.AttributionMessagePicHitTerms,a=Resources.AttributionPicHitLinkUrlTerms,l={url:o,message:n,title:ResourceManager.ResolveString(Resources.AttributionMessagePicHit,[n])},c={url:a,message:Resources.AttributionPicHitLinkTerms,title:ResourceManager.ResolveString(r,[Resources.AttributionPicHitLinkTerms])};t=t.concat(ResourceManager.resolveWithViewElementArgs(Resources.AttributionMessagePicHit,[l]),{span:{message:" "}},ResourceManager.resolveWithViewElementArgs(r,[c]),ResourceManager.resolveWithViewElementArgs(Resources.AttributionMessage,[e]))}else if(s.isProvider(this.source.providerType,[i.ContentProvider.Shutterstock])){var d={url:Resources.AttributionShutterstockLinkUrl,message:Resources.AttributionShutterstockLink,title:ResourceManager.ResolveString(Resources.AttributionMessageShutterstock,[Resources.AttributionShutterstockLink])};t=ResourceManager.resolveWithViewElementArgs(Resources.AttributionMessageShutterstock,[d])}else t=ResourceManager.resolveWithViewElementArgs(Resources.AttributionMessage,[e]);return t},s.prototype.attributionNotificationArgs=function(){var e=this,n={closeMessage:new TDB.ChildArgs(r.GlyphButtonVE,{buttonId:ClientAction.ButtonId.AddContent_AttributionClose,click:this.attributionCloseButtonClicked,context:this,cssClass:{value:"BasicContentAttributionCloseButton"},tooltip:{value:Resources.LicenseNotificationCloseButtonDescription},description:{value:Resources.LicenseNotificationCloseButtonDescription},fontIconName:{value:FontIcons.AddContentCloseLegalIcon},fontIconSizeClass:FontIcons.AddContentCloseLegalIconSize,fontIconWrapperClass:{value:"CloseButtonLegalFontIcon"}},function(t){e.attributionCloseButton=t}),linkMessageArgs:{value:this.getAttributionNotificationMessage()},messageVisible:this.attributionVisible};return new TDB.ChildArgs(t.DismissableNotificationVE,n)},s.prototype.creativeCommonsLegalNotificationArgs=function(){var e={url:Resources.LicensenLinkUrl,message:Resources.CreativeCommonLink,title:Resources.CreativeCommonLinkTooltip},n=ResourceManager.resolveWithViewElementArgs(Resources.CreativeCommonLicenseNotifictionMessagePart1,[e]),o={closeMessage:new TDB.ChildArgs(r.GlyphButtonVE,{buttonId:ClientAction.ButtonId.AddContent_CreativeCommonsClose,click:this.creativeCommonsCloseButtonClicked,context:this,cssClass:{value:"BasicContentAttributionCloseButton"},tooltip:{value:Resources.LicenseNotificationCloseButtonDescription},description:{value:Resources.CloseCreativeCommonDescription},fontIconName:{value:FontIcons.AddContentCloseLegalIcon},fontIconSizeClass:FontIcons.AddContentCloseLegalIconSize,fontIconWrapperClass:{value:"CloseButtonLegalFontIcon"}}),linkMessageArgs:{value:n},messageVisible:this.creativeCommonsVisible,wrapperCss:"overlaidContentAttribution",notificationTextCss:"creativeCommonsLicenseText"};return new TDB.ChildArgs(t.DismissableNotificationVE,o)},s.prototype.pageStateInit=function(e){return e?n.ShowingContent:s.isProvider(this.source.providerType,[i.ContentProvider.StockPhotos])?n.ComingSoon:n.SearchIntro},s.prototype.tabConstructor=function(e,t){var n={text:t.contentTab.displayName,cssClass:"ContentNavRadioButton",selectedClass:"BasicContentPageTabSelected",index:e};return new TDB.ChildArgs(r.TextTabVE,n)},s.prototype.getSearchDescriptor=function(e){if(!this.tabHeader)return this.source.searchDescriptor;this.tabHeader.getSelectedTabIndex(e);var t=this.getContentSource().searchTabIndex,n=this.tabs[t]?this.tabs[t].contentTab:null;return n&&void 0!=n.searchDescriptor?n.searchDescriptor:this.source.searchDescriptor},s.prototype.createBreadcrumbArgs=function(e,t,n,o,i){void 0===n&&(n=""),void 0===o&&(o=!1),void 0===i&&(i=!1);var r=e;return o?i||(r=ResourceManager.ResolveString(Resources.BasicContentPageFirstBreadcrumb,[CommonSettings.DisplayName,e])):r=ResourceManager.ResolveString(Resources.BasicContentPageBreadcrumb,[e]),{key:t,text:r,browseDescriptor:n,description:e,wrapperClass:"BasicContentPageBreadcrumbWrapper",buttonClass:"BasicContentPageBreadcrumb"}},s.prototype.checkCreativeCommonsMessageVisible=function(e){return(s.isProvider(this.source.providerType,[i.ContentProvider.Flickr])||this.showingLandingPage()&&s.isProvider(this.source.providerType,[i.ContentProvider.Bing]))&&(this.pageState.getValue()==n.ShowingContent||this.pageState.getValue()==n.NoTabContent)&&(this.tabHeader&&this.tabHeader.getSelectedTabIndex(e)==this.source.searchTabIndex||this.showingLandingPage()||!this.tabHeader)},s.prototype.executePendingSearchIfNeeded=function(){""!=this.pendingSearchQuery&&(this.search(this.pendingSearchQuery),this.pendingSearchQuery="")},s.prototype.turnOnMaintenance=function(){var e=this;TDB.applyUpdate(function(){e.searchContentCollection.clearContentPieces(),e.licenseCheckboxVisible.setValue(!1),e.attributionVisible.setValue(!1),e.creativeCommonsVisible.setValue(!1)},TDB.Justification.InitialConversion),this.pageState.setValue(n.DisabledProviderFailure)},s.prototype.changeBreadcrumbOnTabSelected=function(e){var t=this,n=this.tabs[e],o=n.breadcrumbPath,i=o.breadcrumbCount();if(n.contentTab.browseDescriptor&&i>=1){var r=o.getCurrentKey();if(!r.primaryCallLoaded){var a=o.getCurrentBrowseDescriptor();a||(StoryLog.StructuredTraceTag(596444315,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.error,"BasicContentPageVE.tabSelected: Selected a content tab with a browse descriptor but no valid descriptor was found on breadcrumb.",{provider:this.source.providerType,tab:n.contentTab.Id,depth:i.toString()}),o.navigateBack(i-1),i=o.breadcrumbCount(),a=n.contentTab.browseDescriptor);var s=this.parent.selectedSource.getValue(),l=n.contentTab,c=new ClientAction.AddContentUIChangeSourceTab("",s.providerType,l);ActionLogger.RecordClientAction(c),this.browseTab(n,r,a)}}else if(n.contentTab.searchDescriptor&&1==i){o.getCurrentKey();var d=this.getCurrentContentCollection();if(this.searchQuery==d.getCurrentSearchQuery())return;TDB.applyUpdate(function(){t.resetScrollPosition.notify(),t.searchQuery?(t.handleDecompTaskCompletion(d.decomposeSearch(t.searchQuery,n.contentTab.searchDescriptor)),t.loadingMessage.setValue(Resources.Searching)):d.clearContentPieces()})}},s.prototype.connectCssClass=function(e){return this.refreshVisible(e)?"BasicContentPageConnectSmallButton":"BasicContentPageConnectLargeButton"},s.prototype.connectText=function(e){var t=Resources.BasicContentPageConnect;return this.storyPageEditSettings.RefreshAddContentAccountEnabled&&(t=this.refreshVisible(e)?Resources.BasicContentPageConnectSmall:Resources.BasicContentPageConnectLarge),ResourceManager.ResolveString(t,[this.source.displayName])},s.prototype.hasVisibleTabs=function(){if(void 0!=this.source.tabs&&this.source.tabs.length>0)for(var e=this.source.tabs.length,t=0;t<e;t++)if(this.source.tabs[t].displayName)return!0;return!1},s.basicContentPageCollectionName="basic",s}(t.AddContentPageViewModel);t.BasicContentPageViewModel=s}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=function(e){function o(t,n){var o=e.call(this,t)||this;return o.model=n,o}return __extends(o,e),o.prototype.contentWrapperScrollPositionArgs=function(e){return e.watch(this.model.resetScrollPosition),{top:0}},o.prototype.contentWrapperClassNameArgs=function(e){return"BasicContentPageContentWrapper native-scroller BasicContentPageContentWrapperWithFilters"},o.prototype.contentWrapperLiquidLayoutInitArgs=function(){return t.BasicContentPageViewModel.isProvider(this.model.source.providerType,[n.ContentProvider.YouTube])?o.youtubeRowHeight:o.defaultRowHeight},o.prototype.contentWrapperLiquidLayoutElementsArgs=function(e){var n=this.model.getCurrentContentCollection(e).getContentPieces(e);if(e.watch(this.model.pageSelected),0===n.length)return[];var o=n[0],i=o&&o.getType();return i===t.ImageContentPieceVE||i===t.FolderContentPieceVE||i===t.DocumentContentPieceVE||i===t.VideoContentPieceVE?(e.watch(this.model.parent.parent.addContentPaneResize),n):[]},o.prototype.contentWrapperInfinitelyScrollableAreaInitArgs=function(){return this.checkHeightRef={},{bottomReached:this.bottomReached,checkHeightReference:this.checkHeightRef}},o.prototype.contentWrapperAttrArgs=function(e){var t={};return t[Aria.Attributes.Role]=Aria.Roles.Listbox,t[Aria.Attributes.Label]=Resources.ResultsPanelLabel,t[Aria.Attributes.Multiselectable]=Aria.BooleanState.True,t},o.prototype.contentPiecesArgs=function(e){return this.model.getCurrentContentCollection(e).getContentPieces(e)},o.prototype.bottomReached=function(){this.model.decomposeNext()},o.prototype.handleNavigationKey=function(t){return this.model.loadingMessageVisible()?TDB.EventPropagation.PreventDefault:e.prototype.handleNavigationKey.call(this,t)},o.prototype.getActivatableChildren=function(){return this.filterActivatable(e.prototype.getActivatableChildren.call(this))},o.defaultRowHeight=151,o.youtubeRowHeight=212,o}(StoryApp.View.ViewElements.GridViewPanelVE);t.BasicContentPageResultsPanelVEBase=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(e){function n(t,n){var o=e.call(this,t)||this;return o.model=n,o}return __extends(n,e),n.prototype.unavailableErrorMessageArgs=function(){var e=this.model.getContentSource(),o=e.errorRedirectUrl;o||(StoryLog.StructuredTraceTag(596129488,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.error,"Expected UnavailableForClient content source to have errorRedirectUrl",{sourceName:e.displayName,clientApp:AppType[CommonSettings.ClientApp]}),o=CommonSettings.SiteRootUrl);var i={url:o,message:n.upperCaseFirstHostname(CommonSettings.SiteRootUrl),class:"NeutralHyperlinks",target:"_blank"},r=ResourceManager.ResolveString(Resources.AddContentSourceUnavailableForClientError,[e.displayName]);return new TDB.ChildArgs(t.DynamicMessageVE,ResourceManager.resolveWithViewElementArgs(r,[void 0,i]))},n.upperCaseFirstHostname=function(e){var t=StoryApp.Utilities.extractHostnameFromUrl(CommonSettings.SiteRootUrl);return t.charAt(0).toUpperCase()+t.slice(1)},n}(TDB.FocusableViewElement);e.ContentUnavailableForClientPageVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function t(e,t){this.parent=e,this.args=t,StoryLog.StructuredTraceTag(596129487,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.info,"Opened the Add Content pane to a source unavailable for client.",{sourceName:this.args.source.displayName,clientApp:AppType[CommonSettings.ClientApp]})}return t.prototype.onNavigateTo=function(){},t.prototype.canSearch=function(e){return!1},t.prototype.clearSearch=function(){},t.prototype.getCurrentContentCollection=function(e){},t.prototype.search=function(e){},t.prototype.searchClusters=function(e){},t.prototype.getContentSource=function(){return this.args.source},t.prototype.getResultsPanel=function(){},t.prototype.resetPageState=function(){},t.prototype.getAttributionNotificationMessage=function(){return[]},t.prototype.getViewArgs=function(){return new TDB.ChildArgs(e.ContentUnavailableForClientPageVE,this)},t.prototype.onTransitionEndEvent=function(e){},t.prototype.dispose=function(){},t}();e.ContentUnavailableForClientPageViewModel=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=function(t){function n(e,n){var o=t.call(this,e)||this;return o._addContentVE=e,o.selectedContent=[],o._cardsContainer=n.cardsContainer,o.selectionChanged=TDB.notifierTag(596473991,o),o}return __extends(n,t),n.prototype.onSelectionChanging=function(){},n.prototype.onSelectionChanged=function(){},n.prototype.getContentPieces=function(){var e=this._addContentVE.getSelectedContentPage().getResultsPanel();return e?e.contentPieces:[]},n.prototype.toggleSelection=function(e,t,n){var o=this;return void 0===t&&(t=!1),void 0===n&&(n=!1),TDB.applyUpdate(function(){if(o.onSelectionChanging(),o._addContentVE.selectedSource.getValue().isMultiselectionDisabled&&!e.selected.getValue()&&o.clearSelection(),t){if(!e.selected.getValue())if(o.selectedContent.length<1){e.selected.setValue(!0),o.selectedContent.push(e);var i=o._addContentVE.selectedSource.getValue(),r=new ClientAction.AddContentUISelection(ClientAction.ActionType.Edit_AddContentUI_SelectContent,"",i.providerType,null,!1);ActionLogger.RecordClientAction(r)}else for(var a=o.getContentPieces(),s=a.indexOf(e),l=a.indexOf(o.selectedContent[o.selectedContent.length-1]),c=s>l?1:-1,d=l;d!=s+c;d+=c)if(!a[d].selected.getValue()){a[d].selected.setValue(!0),o.selectedContent.push(a[d]);var i=o._addContentVE.selectedSource.getValue(),u=new ClientAction.AddContentUISelection(ClientAction.ActionType.Edit_AddContentUI_SelectContent,"",i.providerType,null,!0);ActionLogger.RecordClientAction(u)}}else if(e.selected.getValue()){e.selected.setValue(!1);var p=o.selectedContent.indexOf(e);if(-1!=p){o.selectedContent.splice(p,1);var i=o._addContentVE.selectedSource.getValue(),g=new ClientAction.AddContentUISelection(ClientAction.ActionType.Edit_AddContentUI_DeselectContent,"",i.providerType);ActionLogger.RecordClientAction(g)}}else if(e.selected.setValue(!0),o.selectedContent.push(e),!n){var i=o._addContentVE.selectedSource.getValue(),u=new ClientAction.AddContentUISelection(ClientAction.ActionType.Edit_AddContentUI_SelectContent,"",i.providerType,null,!1);ActionLogger.RecordClientAction(u)}o.onSelectionChanged(),o.selectionChanged.notify()}),!0},n.prototype.clearSelection=function(e){var t=this;return void 0===e&&(e=!0),TDB.applyUpdate(function(){t.onSelectionChanging();for(var n=t.getContentPieces(),o=0;o<t.selectedContent.length;o++)!e&&ArrayExtensions.contains(n,t.selectedContent[o])||t.selectedContent[o].selected.setValue(!1);for(o=t.selectedContent.length-1;o>=0;o--)t.selectedContent[o].selected.getValue()||t.selectedContent.splice(o,1);t.onSelectionChanged(),t.selectionChanged.notify()}),!0},n.prototype.addContentPieces=function(t,n,o){var i=this,r=[],a=[];e.Model.currentUndoManager().get(this._addContentVE.getPageId()).captureUserUpdate(function(){for(var e=0;e<t.length;e++){var s=t[e].createCard();s&&s.model&&(i.triggerOverlay(t[e],o),r.push(s.model),a.push(s))}i._cardsContainer.addCardObjects(a),n&&i.clearSelection()},"User added content from the Add Content Pane");for(var s=0;s<a.length;s++)r[s].id!==a[s].model.id&&(r[s]=a[s].model);return this._cardsContainer.scrollToModelsAndSetFocus(r,!1),TDB.applyUpdate(function(){i._addContentVE.parent.addContentSourceDropdownFirstRun.setValue(!1)}),r},n.prototype.triggerOverlay=function(e,t){t?e.triggerPurchasedOverlay():e.triggerAddedOverlay()},n.prototype.addSingleContentPiece=function(e,t){var n=this.addContentPieces([e],!1,t);return 0==n.length?null:n[0]},n.prototype.addSelection=function(e){return this.selectedContent.sort(function(e,t){return e.getIndex()-t.getIndex()}),this.addContentPieces(this.selectedContent,!0,e)},n.prototype.totalSelectedItemCount=function(){return this.selectedContent.length},n}(Disposable);t.AddContentSelectionManager=n}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Server.Decomposition.WP,o=e.Model.SM,i=StoryApp.View.ViewElements,r=StoryApp.Common,a=e.View.ViewModel,s=StoryApp.View.Common.FRE;t.AddContentTabIndex={SourceSelector:1,SearchBox:2,SearchButton:3,ClearSearchButton:4,ClearSelection:5,AddButton:6,CloseAddContent:7,AttributionLink:8,AttributionOwner:9,AttributionLicense:10,ReportButton:11};var l=function(e){function l(n,o){var i=e.call(this,n,TDB.ControlSetFeatures.Isolated)||this;i.resourceFactory=o.resourceFactory,i.commonSettings=o.commonSettings,i.storyPageEditSettings=o.storyPageEditSettings,i.pageFactory=o.pageFactory,i.paneStateManager=o.paneStateManager,i.selectedSource=TDB.watchableTag(596473984,i,void 0),i.selectedSourceViewModel=TDB.watcherOwnerTag(596473985,i,i,i.buildSourceViewModel),i.fileUploader=o.fileUploader,i.selectionManager=new a.AddContentSelectionManager(i,{cardsContainer:i.parent.cardDeckVE}),i.searchPlaceholder=TDB.watchable(i,Resources.SearchBoxPlaceholder),i.attribution=new t.Attribution,i.preventVisualClusters=TDB.watchableTag(596473987,i,!1);var r={context:i,click:i.onActiveClustersChanged,preventVisualClusters:i.preventVisualClusters,selectedSource:i.selectedSource};i.suggestionsClusterCollection=new t.SuggestionsClusterCollection(r),i.licenseNotificationVisible=TDB.watchableTag(596473988,i,!1);var s={url:Resources.AttributionLinkUrl,message:Resources.AttributionLink,title:ResourceManager.ResolveString(Resources.AttributionMessage,[Resources.AttributionLink])},l=ResourceManager.resolveWithViewElementArgs(Resources.AttributionMessage,[s]);return i.licenseNotificationMessage=TDB.watchableTag(596460623,i,l),i.cardsContainer=o.cardsContainer,i.contentPieceSelectedForTabLoop=void 0,i.contentSourcesManager=o.contentSourcesManager,i}return __extends(l,e),l.prototype.getInitialActiveChild=function(){return this.searchBox?this.searchBox.searchBox:void 0},l.prototype.getSearchText=function(){var e=this.searchBox;return e?e.getText():""},l.prototype.clearSearch=function(){var e=this.searchBox;e&&e.clearSearch()},l.prototype.setSearchBoxText=function(e){this.searchBox.setText(e)},l.prototype.updateSearchBoxFocusText=function(e){this.searchBox&&this.searchBox.setOnFocusText(e)},l.prototype.canActivate=function(){return this.paneStateManager.getPaneVisible(t.AuthoringPaneType.Content)},l.prototype.checkMessageVisible=function(e){return!!this.searchClustersEnabled(e)&&(this.getChildAttributionVisible(e).getWatchedValue(e)&&this.suggestionsClusterCollection.showVisualClusters(e)&&this.suggestionsClusterCollection.suggestionsClusters.getWatchedValue(e).length>0&&this.storyPageEditSettings.VisualClustersEnabled)},l.prototype.licenseNotificationCloseButtonClicked=function(e){var t=this;return TDB.applyUpdate(function(){t.licenseNotificationVisible.setValue(!1),t.getChildAttributionVisible().setValue(!1)}),TDB.EventPropagation.Bypass},l.prototype.getChildAttributionVisible=function(e){var t=this.getSelectedContentPage(e);return t?t.attributionVisible:null},l.prototype.getLicenseNotificationVisible=function(){var e=this.getSelectedContentPage();return e?e.licenseCheckboxVisible:null},l.prototype.licenseNotificationArgs=function(){var e={closeMessage:new TDB.ChildArgs(i.GlyphButtonVE,{buttonId:ClientAction.ButtonId.AddContent_CloseLicense,click:this.licenseNotificationCloseButtonClicked,context:this,cssClass:{value:"contentAttributionCloseButton"},tooltip:{value:Resources.ButtonClose},description:{value:Resources.LicenseNotificationCloseButtonDescription},fontIconName:{value:FontIcons.AddContentCloseLegalIcon},fontIconSizeClass:FontIcons.AddContentCloseLegalIconSize,fontIconWrapperClass:{value:"CloseButtonLegalFontIcon"}}),linkMessageArgs:{watchable:this.licenseNotificationMessage},messageVisible:this.licenseNotificationVisible,checkMessageVisible:this.checkMessageVisible};return new TDB.ChildArgs(t.DismissableNotificationVE,e)},l.prototype.getContentSource=function(){return this.selectedSource.getValue()||this.selectSource(this.contentSourcesManager.getContentSources()[0]),this.selectedSource.getValue()},l.prototype.searchBoxVisible=function(e){e.watch(this.selectionManager.selectionChanged);var n=this.selectedSource.getValue(),i=t.BasicContentPageViewModel.isProvider(n?n.providerType:"",[o.ContentProvider.Shutterstock])||this.selectionManager.selectedContent.length<=0,a=this.getSelectedContentPage(e),s=r.UserState.getInstance();return s.isUserOnFlight(FlightList.Searchbox1)?i:s.isUserOnFlight(FlightList.Searchbox2)?a.canSearch(e)&&i:s.isUserOnFlight(FlightList.Searchbox3)?a.canSearch(e)&&i:i},l.prototype.sourceSelectorArgs=function(){return new TDB.ChildArgs(t.SourceSelectorVE,{sources:this.contentSourcesManager.getContentSources(),authoringModel:this.parent,fileUploader:this.fileUploader})},l.prototype.searchBoxArgs=function(){var e=this.getSelectedContentPage();if(e instanceof t.BasicContentPageViewModel&&e.tabHeader){var n=e.getSelectedContentTab();n&&n.defaultSearchBoxFocusText?n.defaultSearchBoxFocusText:""}var o={placeholder:this.searchPlaceholder,context:this,onSearch:this.onSearch,show:this.searchBoxVisible,enabled:{compute:new TDB.ComputedOptionArgs(this,this.searchBoxEnabled)},description:{compute:new TDB.ComputedOptionArgs(this,this.searchBoxDescription)},tabIndex:t.AddContentTabIndex.SearchBox,features:TDB.ControlSetFeatures.TabInto};return new TDB.ChildArgs(t.SearchBoxVE,o)},l.prototype.closeButtonArgs=function(){var e={buttonId:ClientAction.ButtonId.AddContent_Close,click:this.closeButtonClicked,context:this,cssClass:{value:"AddContentClosePaneButton"},description:{value:Resources.InsertPaneCloseButtonDescription},fontIconName:{value:FontIcons.AddContentCloseIcon},fontIconSizeClass:FontIcons.AddContentCloseIconSize,tabIndex:t.AddContentTabIndex.CloseAddContent};return new TDB.ChildArgs(i.GlyphButtonVE,e)},l.prototype.selectedSourceArgs=function(e){var t=this.selectedSourceViewModel.getWatchedValue(e);return t&&t.getViewArgs()},l.prototype.buildSourceViewModel=function(e){return this.pageFactory.createAddContentPage(this,{authoringModel:this.parent,cardDefinitionManager:this.parent.cardDefinitionManager,cardsContainer:this.parent.cardDeckVE,contentCollectionFactory:new t.ContentCollectionFactory,resourceFactory:this.resourceFactory,source:this.selectedSource.getWatchedValue(e),storyPageEditSettings:this.storyPageEditSettings,paneStateManager:this.paneStateManager})},l.prototype.addContentMenuArgs=function(){return new TDB.ChildArgs(t.AddContentMenuVE,{cardsContainer:this.parent.cardDeckVE})},l.prototype.loadingSpinnerStyleArgs=function(e){return{backgroundImage:"url('"+Icons.LoadingSpinner+"')"}},l.prototype.loadingSpinnerVisibleArgs=function(e){return t.AuthoringPageVE.shouldContentPaneBeDisabled(this.pageId,e)},l.prototype.clusterStripeArgs=function(){var e={click:this.onActiveClustersChanged,contentSourcesManager:this.contentSourcesManager,preventVisualClusters:this.preventVisualClusters,cardsContainer:this.cardsContainer,selectedSource:this.selectedSource,paneStateManager:this.paneStateManager,suggestionsClusterCollection:this.suggestionsClusterCollection};return new TDB.ChildArgs(t.ClusterStripeVE,e)},l.prototype.onSearch=function(e){var t=this,n=this.getSelectedContentPage();if(TDB.applyUpdate(function(){t.preventVisualClusters.setValue(!0)},TDB.Justification.SynchronousBrowserEvent),this.suggestionsClusterCollection.deselectAll(),e&&0!=e.length){var o=new ClientAction.UserTypeQuerySearchData(this.selectedSource.getValue().providerType,!1);ActionLogger.RecordClientAction(o),this.setSearchBoxText(e),this.searchBox&&this.searchBox.setScreenReaderText(Resources.ContentSearchBoxDescriptionOnSearch),n.search(e)}else this.searchBox&&this.searchBox.setScreenReaderText(Resources.ContentSearchBoxDescriptionOnSearchCleared),n.clearSearch(),TDB.applyUpdate(function(){t.preventVisualClusters.setValue(!1)},TDB.Justification.SynchronousBrowserEvent)},l.prototype.searchBoxEnabled=function(e){return!t.AuthoringPageVE.shouldContentPaneBeDisabled(this.pageId,e)&&this.getSelectedContentPage(e).canSearch(e)},l.prototype.searchBoxDescription=function(e){if(r.Environment.getInstance().areInternalFeaturesEnabled()){var t=this.selectedSource.getWatchedValue(e);return t.pageType===PageType.SuggestedContent?Resources.SuggestedContentSearchBoxPlaceholder:ResourceManager.ResolveString(Resources.BasicContentPageSearchBoxDescription,[t.displayName])}return Resources.SuggestedContentSearchBoxPlaceholder},l.prototype.getSelectedContentPage=function(e){return this.selectedSourceViewModel.getWatchedValue(e)},l.prototype.openFilePicker=function(){t.UploadMediaAction.getInstance().execute(null,{uploadElement:$("#fileToUpload"),cardsContainer:this.parent.cardDeckVE})},l.prototype.selectSource=function(e,o){var i=this;if(!e.excludeFromSourceSelector&&e.pageType!=PageType.MyDevice){var r=this.selectedSource.getValue();if(r!=e){if(r){var a=new ClientAction.ButtonClickAction(ClientAction.ButtonId.AddContent_SourceSelector,Diag.ULSCat.msoulscat_Story_AddContent,{Description:"The user selected a new add content source"});ActionLogger.RecordClientAction(a);var l=new ClientAction.AddContentUISwitchContentSource(e.providerType,r);ActionLogger.RecordClientAction(l);var c=this.getSelectedContentPage();c&&c.canSearch()&&c.clearSearch()}this.fileUploader.setAddContentProviderType(e.providerType),e.searchDescriptor||s.FirstRunTriggers.sourceWithoutSearchSelected(),TDB.applyUpdate(function(){var o=i.selectedSource.getValue(),r=o&&ArrayExtensions.contains(i.storyPageEditSettings.ClusterStripeEnabledPanes,o.providerType);i.selectedSource.setValue(e);var a=i.selectedSourceViewModel.getValue();if(a&&a.onNavigateTo(),i.paneStateManager.getPaneVisible(t.AuthoringPaneType.Content)){if(i.searchClustersEnabled())ArrayExtensions.contains(i.storyPageEditSettings.ClusterStripeEnabledPanes,e.providerType)&&!r&&i.clusterStripe.requestSuggestedClusters(n.SuggestionsRequestType.FocusChanged),void 0!=i.suggestionsClusterCollection&&i.suggestionsClusterCollection.hasActiveOrAutoSelectedClusters()&&i.getSelectedContentPage().searchClusters(i.suggestionsClusterCollection.getActiveClusters()),void 0!=i.suggestionsClusterCollection&&i.suggestionsClusterCollection.hasActiveOrAutoSelectedClusters()||i.validateAndSearch(e);else{var s=!0;if(a instanceof t.BasicContentPageViewModel){var l=a;l.canSearch()&&l.IsBrowsable()&&0==i.getSearchText().length&&l.IsCurrentContentFromSearch()&&(l.selectDefaultTabAndBrowse(),s=!1)}s&&i.validateAndSearch(e)}i.licenseNotificationMessage.setValue(i.getChildLicenseMessage())}""==i.getSearchText()&&i.preventVisualClusters.setValue(!1),i.selectionManager.clearSelection()},TDB.Justification.InitialConversion)}}},l.prototype.getChildLicenseMessage=function(){var e=this.getSelectedContentPage();return e?e.getAttributionNotificationMessage():null},l.prototype.closeButtonClicked=function(e){var t=this;return TDB.applyUpdate(function(){t.paneStateManager.hideAllAuthoringPanes()},TDB.Justification.SynchronousBrowserEvent),TDB.EventPropagation.Bypass},l.prototype.licenseNotificationWrapperVisibleArgs=function(e){return this.preventVisualClusters.getWatchedValue(e)},l.prototype.ifAttributionReportPaneArgs=function(e){return this.ifAttributionLinkArgs(e)||this.ifReportButtonArgs(e)},l.prototype.ifAttributionLinkArgs=function(e){var n,o=this,i=this.selectionManager.totalSelectedItemCount(),r=t.Attribution.createEmptyAttributionInfo();return e.watch(this.selectionManager.selectionChanged),i>0&&(n=this.selectionManager.selectedContent[i-1],r=n.getAttributionInfo()),platform.setImmediate(function(){o.attribution.setAttributionInfo(r)}),!!r.attributionLinkURL},l.prototype.addContentAttributionLinkTextPartsArgs=function(e){var t=this;return this.attribution.getAttributionLinkTextParts(e,this,function(){return t.attributionLinkClicked()},function(){return t.attributionOwnerLinkClicked()},function(){return t.attributionLicenseLinkClicked()})},l.prototype.ifReportButtonArgs=function(e){e&&e.watch(this.selectionManager.selectionChanged);var t=this.selectionManager.totalSelectedItemCount();return t>0&&this.selectionManager.selectedContent[t-1].supportsReporting()},l.prototype.reportButtonArgs=function(){var e={buttonId:ClientAction.ButtonId.AddContent_Report,click:this.reportButtonClicked,context:this,cssClass:{value:"AddContentReportButton"},description:{value:Resources.ReportButtonTooltip},fontIconName:{value:FontIcons.AddContentReportButton},fontIconSizeClass:FontIcons.AddContentReportButtonSize,tabIndex:t.AddContentTabIndex.ReportButton,text:{value:Resources.ReportButton},textClass:"AddContentReportButtonText"};return new TDB.ChildArgs(i.GlyphButtonVE,e)},l.prototype.reportButtonClicked=function(){var e=this.selectionManager.totalSelectedItemCount();if(e>0){var n=this.selectionManager.selectedContent[e-1];if(n.supportsReporting())return t.ReportContentPieceDialog.createAndShow(n.getReportInfo()),TDB.EventPropagation.Bypass}return TDB.EventPropagation.Bubble},l.prototype.attributionLinkClicked=function(){return this.logAttributionLinkClick(ClientAction.ButtonId.AddContent_AttributionLink),TDB.EventPropagation.Bubble},l.prototype.attributionOwnerLinkClicked=function(){return this.logAttributionLinkClick(ClientAction.ButtonId.AddContent_AttributionOwnerLink),TDB.EventPropagation.Bubble},l.prototype.attributionLicenseLinkClicked=function(){return this.logAttributionLinkClick(ClientAction.ButtonId.AddContent_AttributionLicenseLink),TDB.EventPropagation.Bubble},l.prototype.logAttributionLinkClick=function(e){var n=this.selectedSource.getValue(),i=n?n.providerType.toString():"",r=n?this.contentSourcesManager.getContentSources().indexOf(n).toString():"",a=-1,s="",l=!0,c=this.getSelectedContentPage();if(c){var d=c.tabHeader;d&&(a=d.getSelectedTabIndex(),s=c.source.tabs[a].Id),l=t.BasicContentPageViewModel.isProvider(c.source.providerType,[o.ContentProvider.Bing,o.ContentProvider.Twitter,o.ContentProvider.YouTube])}if(""===s&&l){var u=this.suggestionsClusterCollection.hasActiveOrAutoSelectedClusters();a=u?1:0,s=u?"ClusterSearch":"UserSearch"}var p=new ClientAction.ButtonClickAction(e,Diag.ULSCat.msoulscat_Story_AddContent,{Description:"The user clicked on one of attribution links",SelectedSource:i,SelectedSourceIndex:r,SelectedTabIndex:s});ActionLogger.RecordClientAction(p)},l.prototype.logVisibilityEvent=function(e){var t=this.selectedSource.getValue(),n=t?t.providerType.toString():"",o=t?this.contentSourcesManager.getContentSources().indexOf(t):-1,i=new ClientAction.ActionData(e?ClientAction.ActionType.OpenAddContent:ClientAction.ActionType.CloseAddContent);i.setUlsData(Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"AddContentVE Clicked"),i.setTelemetryData({SelectedSource:n,SelectedSourceIndex:o}),ActionLogger.RecordClientAction(i)},l.prototype.searchClustersEnabled=function(e){var t=this.selectedSource.getWatchedValue(e);return t&&ArrayExtensions.contains(this.storyPageEditSettings.ClusterStripeEnabledPanes,t.providerType)},l.sourceFilteringEnabled=function(e){return!!(1==e.SourceFilteringEnabled||0==e.SourceFilteringEnabled&&r.Environment.getInstance().areInternalFeaturesEnabled())},l.prototype.supportedLanguage=function(){var e=this.commonSettings.UserLocaleString;if(!e||e.length<2)return!1;var t=e.substr(0,2);return!(!this.storyPageEditSettings.SuggestedContentSupportedLanguages||0==this.storyPageEditSettings.SuggestedContentSupportedLanguages.length)&&ArrayExtensions.contains(this.storyPageEditSettings.SuggestedContentSupportedLanguages,t)},l.prototype.setLicenseNotificationInvisibleUnsupportedLang=function(){var e=this;this.supportedLanguage()||TDB.applyUpdate(function(){e.getLicenseNotificationVisible().setValue(!1)})},l.prototype.onActiveClustersChanged=function(){var e=this;if(this.suggestionsClusterCollection.wereClustersPreviouslyVisual&&this.suggestionsClusterCollection.sortClusters(),TDB.applyUpdate(function(){e.clusterStripe.resetClusterScrollPosition.notify()}),this.suggestionsClusterCollection.hasActiveOrAutoSelectedClusters()){this.getSelectedContentPage().clearSearch(),this.clearSearch(),TDB.applyUpdate(function(){e.preventVisualClusters.setValue(!1)});var t=this.getSelectedContentPage();t&&t.resetLicenseNotification();var n=this.suggestionsClusterCollection.getActiveClusters();this.searchBox.setText(n[0].Name),this.getSelectedContentPage().searchClusters(n)}else this.selectionManager.clearSelection(!1),this.getSelectedContentPage().getCurrentContentCollection().clearContentPieces(),this.getSelectedContentPage().resetPageState(),this.setLicenseNotificationInvisibleUnsupportedLang(),this.searchBox.clearSearch();return TDB.EventPropagation.Bypass},l.prototype.validateAndSearch=function(e){var t=this.getSelectedContentPage();if(t.canSearch()){var n=this.getSearchText();if(""!=n){var o=new ClientAction.UserTypeQuerySearchData(this.selectedSource.getValue().providerType,!0);ActionLogger.RecordClientAction(o),this.preventVisualClusters.setValue(!0),t.search(n)}}},l.prototype.onTransitionEndEvent=function(e){var t=this.getSelectedContentPage();t&&t.onTransitionEndEvent(e)},l.prototype.keyDown=function(n){var i=TDB.EventPropagation.Bubble;if(n.keyCode===KeyCodeType.EscapeKey){if(!((this.selectionManager.selectedContent?this.selectionManager.selectedContent.length:0)>0))return this.paneStateManager.hideAllAuthoringPanes(),TDB.EventPropagation.PreventDefault;var r=this.selectedSource.getValue();r&&t.BasicContentPageViewModel.isProvider(r.providerType,[o.ContentProvider.Shutterstock])?(this.selectionManager.clearSelection(),i=TDB.EventPropagation.PreventDefault):i=this.handleShortcutKey(n)}else if(n.keyCode===KeyCodeType.TabKey){var a=TDB.FocusableViewElement.getFocusedElement();if(a instanceof t.ContentPieceVE&&a.selected.getWatchedValue())this.contentPieceSelectedForTabLoop=a,this.activeChild=a;else if(void 0!==this.contentPieceSelectedForTabLoop&&a instanceof t.ContentPieceVE&&!a.selected.getWatchedValue()){this.contentPieceSelectedForTabLoop=void 0;var s=this.getSelectedContentPage().getResultsPanel();this.activeChild=s}else void 0===this.contentPieceSelectedForTabLoop||ArrayExtensions.contains(this.getActivatableChildren(),a)||(this.contentPieceSelectedForTabLoop=void 0,this.activeChild=a)}return i===TDB.EventPropagation.Bubble?e.prototype.keyDown.call(this,n):i},l.prototype.getActivatableChildren=function(){return this.contentPieceSelectedForTabLoop?this.contentPieceSelectedActivatableChildren():e.prototype.getActivatableChildren.call(this)},l.prototype.contentPieceSelectedActivatableChildren=function(){var e=this,t=[],n=this.contentPieceSelectedForTabLoop.traverseFocusable(function(e){return e instanceof TDB.Control&&e.isFocusable()&&e.canActivate()?e:null}),o=this.addContentMenuVE.traverseFocusable(function(e){return e instanceof TDB.Control&&e.isFocusable()&&e.canActivate()?e:null});t=t.concat(n).concat(o);var i=this.addContentAttributionLinkTextParts;return i&&(t=t.concat(i.filter(function(e){return e instanceof TDB.Control&&e.isFocusable()&&e.canActivate()}))),this.ifReportButtonArgs()&&this.reportButton&&t.push(this.reportButton),t.sort(function(t,n){return t.compareTabbingOrderTo(n,e.commonSettings.SiteUiRtl?TDB.ContentFlowDirection.RightToLeft:TDB.ContentFlowDirection.LeftToRight)})},l.prototype.handleShortcutKey=function(e){var t=TDB.EventPropagation.Bubble,n=this.getShortcutElements(TDB.ShortcutIdentifier.createShortcutIdentifierFromEvent(e));return n.length>0?this.executeShortcutElements(n,e):t},l.prototype.onDropped=function(e){var n=this;if(e[0]instanceof t.ContentPieceVE){var o=this.selectedSource.getValue();if(o){var i=e.length,r=new ClientAction.AddContentUISelection(ClientAction.ActionType.Edit_AddContentUI_Drag,"",o.providerType,i);ActionLogger.RecordClientAction(r)}TDB.applyUpdate(function(){return n.selectionManager.clearSelection()})}},l.prototype.getTitleElementId=function(){},l.prototype.getTitleText=function(){return Resources.AuthoringPanelContent},l.prototype.isCardDeckSupported=function(){return!0},l.prototype.showingLandingPage=function(e){var n=this.getSelectedContentPage();if(n instanceof t.BasicContentPageViewModel){var o=n.tabHeader;return o&&e&&o.getSelectedTabIndex(e),n.showingLandingPage()}return!1},l.prototype.getViewElement=function(){return this},l.prototype.filterByContentType=function(){var e=this.getSelectedContentPage();e instanceof t.SuggestedContentTabViewModel&&e.updateContentFilter()},l.prototype.overrideSelectedSource=function(e){this.selectedSourceViewModel=TDB.watchableTag(596460624,this,e)},l}(i.RegionViewElement);t.AddContentVEBase=l}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=StoryApp.View.ViewElements,i=function(e){function i(t,n){var o=e.call(this,t)||this;return o._cardsContainer=n.cardsContainer,o}return __extends(i,e),i.prototype.clearSelectionButtonText=function(e){e.watch(this.parent.selectionManager.selectionChanged);var t=this.parent.selectionManager.selectedContent.length;return ResourceManager.ResolveString(Resources.AddContentMenuClearSelectionButton,[t])},i.prototype.clearSelectionButtonVEArgs=function(e){if(e.watch(this.parent.selectionManager.selectionChanged),this.parent.selectionManager.selectedContent.length<1)return null;var n={buttonId:ClientAction.ButtonId.AddContent_ClearSelection,click:this.clearSelection,context:this,cssClass:{value:"AddContentMenuClearSelectionButton"},shortcutIdentifiers:["EscapeKey","MinusKey","MinusFFKey","Shift+MinusKey","Shift+MinusFFKey"],textClass:"AddContentMenuClearSelectionButtonText",text:{compute:new TDB.ComputedOptionArgs(this,this.clearSelectionButtonText)},tabIndex:t.AddContentTabIndex.ClearSelection};return new TDB.ChildArgs(o.TextButtonVE,n)},i.prototype.ifPaneMenuArgs=function(e){return!t.AuthoringPageVE.shouldContentPaneBeDisabled(this.pageId,e)&&(e.watch(this.parent.selectionManager.selectionChanged),this.isVisible())},i.prototype.isVisible=function(){return!t.BasicContentPageViewModel.isProvider(this.parent.getContentSource().providerType,[n.ContentProvider.Shutterstock])&&this.parent.selectionManager.selectedContent.length>0},i.prototype.clearSelection=function(e){var t=this.parent.selectedSource.getValue(),n=this.parent.selectionManager.selectedContent.length,o=new ClientAction.AddContentUISelection(ClientAction.ActionType.Edit_AddContentUI_ClearSelection,"",t.providerType,n);return ActionLogger.RecordClientAction(o),StoryLog.TraceTag(596473993,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"User clicked clear selection",null),this.parent.selectionManager.clearSelection(),TDB.EventPropagation.PreventDefault},i.prototype.addSelection=function(e){var t=this.parent.selectedSource.getValue(),n=this.parent.selectionManager.selectedContent.length;if(0==n)return TDB.EventPropagation.Bypass;var o=new ClientAction.AddContentUISelection(ClientAction.ActionType.Edit_AddContentUI_AddButtonClick,"",t.providerType,n);ActionLogger.RecordClientAction(o),StoryLog.TraceTag(596473994,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"User clicked add selection",null);try{this.parent.selectionManager.addSelection()}catch(e){StoryLog.StructuredTraceTag(595935324,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.warning,"Exception while adding content",{message:e.message},e.stack)}return this.parent.selectionManager.clearSelection(),TDB.EventPropagation.PreventDefault},i.prototype.getCurrentlyFocusedButton=function(){var e=TDB.FocusableViewElement.getFocusedElement();return e instanceof o.ButtonVE?e:void 0},i.prototype.addButtonArgs=function(){var e={buttonId:ClientAction.ButtonId.AddContent_Add,click:this.addSelection,context:this,cssClass:{value:"AddContentMenuAddButton"},shortcutIdentifiers:["AddKey","EqualFFKey","EqualKey","Shift+EqualKey","Shift+EqualFFKey"],textClass:"AddContentMenuAddButtonText",text:{value:Resources.AddContentMenuAddButton},tabIndex:t.AddContentTabIndex.AddButton};return new TDB.ChildArgs(o.TextButtonVE,e)},i}(TDB.FocusableViewElement);t.AddContentMenuVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.args=n,o}return __extends(t,e),t.prototype.textTextArgs=function(e){return this.args.name},t.prototype.contentAttrArgs=function(e){var t=this.getButtonAttributes(e);return t[Aria.Attributes.Role]=Aria.Roles.Option,t[Aria.Attributes.Label]=this.args.screenReaderValue,t},t.prototype.contentStyleArgs=function(e){return{background:this.args.backgroundColor}},t.prototype.fontIconPresentArgs=function(){return!!this.args.iconStyle},t.prototype.userContentIconCssArgs=function(e){var t={};return t.ClusterIcon=!0,t[this.args.iconStyle]=!0,t},t.prototype.userContentImageAttrArgs=function(e){return{src:this.args.imageSource,role:Aria.Roles.Presentation,alt:""}},t.prototype.onAction=function(e){return this.args.onClick(e)},t}(StoryApp.View.ViewElements.ButtonVE);e.UserContentClusterVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.Server.Decomposition.WP,i=e.Model.SM,r=e.Model.AuthoringModel,a=e.Server.Decomposition,s=function(s){function l(n,i){var r=s.call(this,n)||this;if(r.maxNumberOfSuccessiveTries=3,r.minWaitTimeForCallRetry=3e4,r.parent=n,r.gettingSuggestionClusters=!1,r.suggestionsClusterCollection=i.suggestionsClusterCollection,r.resetClusterScrollPosition=TDB.notifierTag(596473952,r),r.args=i,r.decompService=new a.DecompositionAPI,r.numberOfErrorRetries=0,r.firstGetClustersFailTimestamp=0,r.paneStateManager=i.paneStateManager,r.focusedChanged=TDB.watcherTag(596473953,r,r,r.calculateContext),r._subscribeToWatchable(r.focusedChanged,TDB.UpdatePhase.WriteOnly),StoryPageSettings.ServiceBusEnabledNewSessions){var l=e.Server.NotificationBus.currentNotificationManager().get(r.pageId);r.notificationListener=l.createListener(e.Server.NotificationBus.NotificationType.SuggestedContent);var c=function(e){var n=r.paneStateManager.getPaneVisible(t.AuthoringPaneType.Content),i=r.parent.searchClustersEnabled();n&&i&&r.requestSuggestedClusters(o.SuggestionsRequestType.LongPolling),r.notificationListener&&r.notificationListener.listen().then(c)};r.notificationListener.listen().then(c)}return StoryApp.Utilities.onResize(function(){r.suggestionsClusterCollection.sortClusters()}),r}return __extends(l,s),l.prototype.ifClusterStripeArgs=function(e){var t=!(this.suggestionsClusterCollection.showVisualClusters(e)&&StoryPageEditSettings.VisualClustersEnabled)&&this.suggestionsClusterCollection.supportedLanguage(),n=e.watchValue(this.suggestionsClusterCollection.suggestionsClusters).length>0;return this.parent.searchClustersEnabled(e)&&n&&!t},l.prototype.suggestionsClustersDrawerWrapperStyleArgs=function(e){var t;return this.suggestionsClusterCollection.showVisualClusters(e)&&StoryPageEditSettings.VisualClustersEnabled?t={height:"100%","flex-shrink":"1","overflow-y":"auto","padding-top":"8px","padding-right":"16px"}:(t={height:"auto","flex-shrink":"0","overflow-y":"hidden","padding-top":"0px"})[CommonSettings.SiteUiRtl?"padding-left":"padding-right"]=this.parent.showingLandingPage(e)?"38px":"0px",t},l.prototype.suggestionsClustersDrawerWrapperScrollPositionArgs=function(e){return e.watch(this.resetClusterScrollPosition),{top:0}},l.prototype.suggestionsClustersDrawerWrapperCssArgs=function(e){return{FlexDisplay:!(this.suggestionsClusterCollection.showVisualClusters(e)&&StoryPageEditSettings.VisualClustersEnabled)}},l.prototype.resultsPanelArgs=function(){return new TDB.ChildArgs(t.ClusterStripeResultsPanelVE,this.suggestionsClusterCollection)},l.prototype.drawerButtonArgs=function(e){var o=this.parent.showingLandingPage(e);if(!((StoryPageEditSettings.VisualClustersEnabled||!o)&&this.suggestionsClusterCollection.suggestionsClusters.getValue().length>0&&!this.suggestionsClusterCollection.showVisualClusters(e)&&this.parent.searchClustersEnabled(e)&&!o))return null;var i,r=this.parent.getSelectedContentPage();i=r instanceof t.BasicContentPageViewModel&&r.hasLandingPage()?Resources.LandingPageSuggestedContentDrawerButtonText:Resources.SuggestedContentDrawerButtonText;var a={buttonId:ClientAction.ButtonId.SuggestedClustersDrawer,click:this.drawerButtonClicked,context:this,cssClass:{value:"DrawerButton"},tooltip:{value:i},description:{value:i},text:{value:Resources.ClusterStripeDrawerButtonText}};return new TDB.ChildArgs(n.TextButtonVE,a)},l.prototype.drawerButtonClicked=function(){var e=this;this.parent.getSelectedContentPage().resetPageState();var t=this.parent.getSelectedContentPage().getCurrentContentCollection().getContentPieces().length,n=this.suggestionsClusterCollection.getAllClusters().length,o=this.suggestionsClusterCollection.getAllClusters().indexOf(this.suggestionsClusterCollection.getActiveClusters().firstOrDefault());return TDB.applyUpdate(function(){e.parent.preventVisualClusters.setValue(!1)}),this.suggestionsClusterCollection.deselectAll(),this.parent.enter(),ActionLogger.RecordClientAction(new ClientAction.SuggestedContentDrawerButtonClicked(o,n,t,"Unknown",this.parent.selectedSource.getValue().providerType)),TDB.EventPropagation.Bypass},l.prototype.onClustersDecompSuccess=function(e){var t=this;if(this.resetRetryCounter(),this.gettingSuggestionClusters=!1,void 0!=e&&this.parent.searchClustersEnabled()){var n=e.SuggestionsClusters;this.suggestionsClusterCollection.updateClusters(n);var i=this.lastClustersRequestType,r=null!=this.lastClustersRequestType&&this.lastClustersRequestType==o.SuggestionsRequestType.ClustersChanged;TDB.applyUpdate(function(){t.resetClusterScrollPosition.notify(),t.suggestionsClusterCollection.activeClustersChanged.setValue(!1),t.lastClustersRequestType=null}),r&&this.parent&&this.args.click?this.args.click.call(this.parent):null!=i&&this.requestSuggestedClusters(i)}void 0!=this.omArgs&&this.omArgs.onDecompSuccess()},l.prototype.onDecompError=function(){this.gettingSuggestionClusters=!1,0==this.numberOfErrorRetries&&(this.firstGetClustersFailTimestamp=Date.now()),this.numberOfErrorRetries++,void 0!=this.omArgs&&this.numberOfErrorRetries>=this.maxNumberOfSuccessiveTries&&this.omArgs.onDecompError()},l.prototype.onUpdate=function(e){e===TDB.UpdatePhase.WriteOnly&&this.focusedChanged.resolve()},l.getModelForTextInputPosition=function(e){if(!e)return null;var n=t.CommonTextVE.getFocusedTextVE(),o=n?n.getModelIdForTextSelection():null,i=null;return o&&e.getViewModel().getFocusedModel()&&(i=e.getViewModel().getFocusedModel().storyModel.getModelObject(o)),i||e.getViewModel().getModel()},l.prototype.calculateContext=function(e){var n=this;TDB.applyUpdate(function(){n.handleCardDeckFocusChanged(null)},TDB.Justification.InitialConversion);var o=this.args.cardsContainer.getActiveCard(e);return e.watch(t.CommonTextVE.textSelectionModelId),l.getModelForTextInputPosition(o)},l.prototype.getFocusedElementId=function(){var e=this.args.cardsContainer.getActiveCard(),t=l.getModelForTextInputPosition(e);return t?t.id:""},l.prototype.userContentPanelArgs=function(e){if(this.suggestionsClusterCollection.showVisualClusters(e)&&StoryPageEditSettings.VisualClustersEnabled){var n={addContent:this.parent,suggestionsClusterCollection:this.suggestionsClusterCollection,contentSourcesManager:this.args.contentSourcesManager};return new TDB.ChildArgs(t.UserContentClustersPanelVE,n)}},l.prototype.handleCardDeckFocusChanged=function(e){var n=this.getFocusedElementId();if(n.length>0){var i=this.args.cardsContainer.getActiveCardModel().storyModel.getModelObject(n),a=this.args.cardsContainer.getActiveCard();if(a&&a.cardType==t.CardType.Image){var s=a.getViewModel().getModel();if(""==r.StoryController.findCaption(s))return}if(n!=this.focusedElementId){var l=this.paneStateManager.getPaneVisible(t.AuthoringPaneType.Content),c=this.parent.searchClustersEnabled(),d=this.hasText(i);l&&c&&d&&this.requestSuggestedClusters(o.SuggestionsRequestType.FocusChanged)}}},l.prototype.requestSuggestedClusters=function(e){var t=this;if(void 0===e&&(e=o.SuggestionsRequestType.Unknown),r.StoryController.isStoryEmpty(!0)&&!StoryPageEditSettings.LandingPageEnabled){var n=this.suggestionsClusterCollection.hasActiveOrAutoSelectedClusters();TDB.applyUpdate(function(){t.suggestionsClusterCollection.clearSuggestionsClusters()}),n&&this.parent.getSelectedContentPage().clearSearch()}else if(this.parent.searchClustersEnabled())if(this.gettingSuggestionClusters)this.lastClustersRequestType=e;else{var i=!0;if(this.numberOfErrorRetries>=this.maxNumberOfSuccessiveTries?Date.now()-this.firstGetClustersFailTimestamp>this.minWaitTimeForCallRetry&&(i=!1,this.resetRetryCounter()):i=!1,!i){this.gettingSuggestionClusters=!0;var a=this.getFocusedElementId();a.length>0&&(this.previousFocusedElementId=this.focusedElementId,this.focusedElementId=a);var s=new o.SuggestionClustersDecompositionRequest(this.previousFocusedElementId,this.focusedElementId,this.suggestionsClusterCollection.getAllClusters(),this.parent.selectedSource.getValue().providerType,e,{},IdGenerator.generateId(36));StoryLog.StructuredTraceTag(596473954,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.verbose,"Created decomposition request",{selectedElementId:this.focusedElementId,requestType:o.SuggestionsRequestType[e].toString()});var l=function(e){t.onClustersDecompSuccess(e)},c=function(){t.onDecompError()};StoryLog.TraceTag(7872865,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Add Content : Begin decompose suggestions. RequestId:"+s.RequestId,null),this.decompService.decomposeClusters(s).then(l,c)}}},l.prototype.resetRetryCounter=function(){this.numberOfErrorRetries=0,this.firstGetClustersFailTimestamp=0},l.prototype.hasText=function(e){if(!e||!e.storyModel.getModelObject(e.id))return!1;var t,n="";if(e instanceof i.MediaWithTextComposite&&null!=e.getText()){var o=e.getText().children.getCollection();for(t=0;t<o.length;t++)if(o[t]instanceof i.Paragraph&&o[t].getContent()&&""!==o[t].getContent().getText())return!0}if(e instanceof i.TitleComposite&&(e=e.getTitle()),null!=e&&e instanceof i.Paragraph){var r=e;null!=r.getContent()&&(n=r.getContent().getText())}if(null!=e&&e instanceof i.TextGroup){var a=e.children.getCollection();for(t=0;t<a.length;t++)if(this.hasText(a[t]))return!0}return""!==n},l.prototype.dispose=function(){s.prototype.dispose.call(this);var t=this.notificationListener;t&&(this.notificationListener=null,e.Server.NotificationBus.currentNotificationManager().get(this.pageId).removeListener(t))},l}(TDB.FocusableViewElement);t.ClusterStripeVEBase=s}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(t){function n(e,n){var o=t.call(this,e)||this;return o.suggestionsClusterCollection=n,o}return __extends(n,t),n.prototype.suggestionsClustersWrapperCssArgs=function(e){return{FlexDisplay:!this.showVisualClusters(e)}},n.prototype.ifClusterStripeTitleEnabledArgs=function(e){return this.showVisualClusters(e)},n.prototype.ifSuggestedContentSectionPoweredByLabelArgs=function(e){return this.showVisualClusters(e)},n.prototype.showVisualClusters=function(e){return StoryPageEditSettings.VisualClustersEnabled&&this.suggestionsClusterCollection.showVisualClusters(e)},n.prototype.suggestionsClustersWrapperAttrArgs=function(e){var t={};return t[Aria.Attributes.Role]=Aria.Roles.Listbox,t[Aria.Attributes.Label]=Resources.AddContentPaneContentSuggestedSearchesLabel,t[Aria.Attributes.Multiselectable]=Aria.BooleanState.True,this.ifClusterStripeTitleEnabledArgs(e)&&(t[Aria.Attributes.Labelledby]="SuggestedContentSectionTitle"),t},n.prototype.suggestionsClustersArgs=function(t){return this.suggestionsClusterCollection.suggestionsClusters.getWatchedValue(t).map(function(t){return new TDB.ChildArgs(e.SuggestionsClusterVE,t)})},n.prototype.getActivatableChildren=function(){return this.filterActivatable(t.prototype.getActivatableChildren.call(this))},n.prototype.sectionTitleTextArgs=function(e){return Resources.SuggestedSearchesSectionTitle},n.prototype.sectionLabelTextArgs=function(e){return Resources.SuggestedSearchesPoweredByLabel},n.prototype.sectionTitleAttrArgs=function(e){var t={};return t[Aria.Attributes.Label]=Resources.SuggestedSearchesSectionScreenReaderValue,t},n}(StoryApp.View.ViewElements.GridViewPanelVE);e.ClusterStripeResultsPanelVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(t){function n(e,n){var o=t.call(this,e)||this;return o.args=n,o}return __extends(n,t),n.prototype.userContentWrapperCssArgs=function(e){return{FlexDisplay:!(StoryPageEditSettings.VisualClustersEnabled&&this.args.suggestionsClusterCollection.showVisualClusters(e))}},n.prototype.userContentWrapperAttrArgs=function(e){var t={};return t[Aria.Attributes.Role]=Aria.Roles.Listbox,t[Aria.Attributes.Label]=Resources.MyContentSectionScreenReaderValue,t[Aria.Attributes.Labelledby]="UserContentClustersTitle",t},n.prototype.userContentClustersArgs=function(){var e=[this.createUserContentCluster(Resources.MyDeviceClusterName,"MyDevice","IconUploadMediaLayer1",null,"#424242",Resources.MyDeviceClusterScreenReaderValue)],t=this.args.contentSourcesManager.getContentSources();return t.firstOrDefault(function(e){return"OneDrive"==e.providerType})?e.push(this.createUserContentCluster(Resources.OneDriveClusterName,"OneDrive",null,CommonSettings.ContentBaseUrl+"OneDriveIcon.png","#424242",Resources.OneDriveClusterScreenReaderValue)):t.firstOrDefault(function(e){return"OneDrivePro"==e.providerType})&&e.push(this.createUserContentCluster(Resources.OneDriveBusinessClusterName,"OneDrivePro",null,CommonSettings.ContentBaseUrl+"OneDriveIcon.png","#424242",Resources.OneDriveBusinessClusterScreenReaderValue)),e},n.prototype.createUserContentCluster=function(t,n,o,i,r,a){var s=this,l={name:t,onClick:function(e){return s.onUserContentClusterActivated(n)},iconStyle:o,imageSource:i,buttonId:ClientAction.ButtonId.UserContentCluster,backgroundColor:r,screenReaderValue:a};return new TDB.ChildArgs(e.UserContentClusterVE,l)},n.prototype.onUserContentClusterActivated=function(e){if("MyDevice"==e)this.args.addContent.openFilePicker();else{var t=this.args.contentSourcesManager.getContentSources(),n=ArrayExtensions.first(t,function(t){return t.providerType==e});if(!n)throw StoryApp.RethrowLogger.createError("Content source name not found.");this.args.addContent.selectSource(n)}return TDB.EventPropagation.PreventDefault},n.prototype.getActivatableChildren=function(){return this.userContentClusters},n.prototype.sectionTitleTextArgs=function(e){return Resources.MyContentSectionTitle},n.prototype.sectionTitleAttrArgs=function(e){var t={};return t[Aria.Attributes.Label]=Resources.MyContentSectionScreenReaderValue,t},n}(StoryApp.View.ViewElements.GridViewPanelVE);e.UserContentClustersPanelVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){function n(){return"k"+r++}var o=e.Server.Decomposition.WP,i=e.Model.SM,r=0;t.SupportedContentPieceFormats=[o.ClipType.SuggestedImage,o.ClipType.Image,o.ClipType.Video,o.ClipType.Folder,o.ClipType.StatusUpdate,o.ClipType.WikipediaCard,o.ClipType.Document,o.ClipType.Audio];var a=function(){function e(t){this.brokerCallTimeout=null,this.resourceFactory=t.resourceFactory,this.contentPiecesByProvider=TDB.watchableTag(596473942,this,{}),this.contentPiecesToDisplay=TDB.watchableTag(596473943,this,[]),this._requestLoading=TDB.watchableTag(596473944,this,!1),this.requestLoading=this._requestLoading,this._refreshingSuggestions=TDB.watchableTag(596473945,this,!1),this.refreshingSuggestions=this._refreshingSuggestions,this._focusChanged=TDB.watchableTag(596473946,this,!1),this.focusChanged=this._focusChanged,this._args=t,this.searchQuery="",this.hasDisplayedElements=TDB.watchableTag(596473947,this,!1),this.decompService=t.decompService,e.providerPreferredHeights[i.ContentProvider.Flickr]=150,e.providerPreferredHeights[i.ContentProvider.Bing]=150,e.providerPreferredHeights[i.ContentProvider.YouTube]=200,e.providerPreferredHeights[i.ContentProvider.Twitter]=150,e.providerPreferredHeights[i.ContentProvider.Wikipedia]=150,e.providerPreferredHeights[i.ContentProvider.SkyDrive]=150,e.providerPreferredHeights[i.ContentProvider.OneDrive]=150,this.numberOfProviders=StoryPageEditSettings.SuggestedContentSupportedSources.length}return e.prototype.getCurrentSearchQuery=function(){return this.searchQuery},e.prototype.decomposeBrowse=function(e){var t=this;if(!this._requestLoading.getValue()){this.primaryCallLoaded&&(this._nextDecomposition=void 0,this.clearContentPieces()),this.primaryCallLoaded=!0;var n=function(e){return t.onDecompositionComplete(e),e},o=function(){t.onDecompositionError()};return TDB.applyUpdate(function(){t._requestLoading.setValue(!0)}),StoryLog.TraceTag(596473948,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Add Content : Begin decompose browse",null),this.decompService.decomposeBrowse(e).then(n,o)}},e.prototype.decomposeSearch=function(e,t,n){var i=this;if(void 0===n&&(n=o.RequestLicenseTypeExtensions.getDefaultLicenseType()),!this._requestLoading.getValue()){this.primaryCallLoaded&&(this._nextDecomposition=void 0,this.clearContentPieces()),this.primaryCallLoaded=!0,this.searchQuery=e;var r=function(e){return i.onDecompositionComplete(e),e},a=function(){i.onDecompositionError()};return TDB.applyUpdate(function(){i._requestLoading.setValue(!0)}),StoryLog.TraceTag(596473949,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Add Content : Begin decompose search",null),this.decompService.decomposeSearch(e,t,n).then(r,a)}},e.prototype.nextDecompNotAvailable=function(){return!this._nextDecomposition},e.prototype.decomposeNext=function(e){var t=this;if(null!=e&&(this._nextDecomposition=e),this._requestLoading.getValue())return null;if(!this._nextDecomposition)return null;var n=function(e){return t.onDecompositionComplete(e),e},o=function(){t.onDecompositionError()};return TDB.applyUpdate(function(){t._requestLoading.setValue(!0)}),StoryLog.TraceTag(596473950,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Add Content : Begin decompose next",null),this.decompService.decomposeNext(this._nextDecomposition).then(n,o)},e.prototype.decomposeSuggestions=function(e,t,n,r,a,s,l,c,d){var u=this;void 0===c&&(c=[]),void 0===d&&(d=[]);var p=!0;if(this._requestLoading.getValue())return null;this.primaryCallLoaded||(this.primaryCallLoaded&&(this._nextDecomposition=void 0,this.clearContentPieces()),this.primaryCallLoaded=!0);var g=new o.SuggestionsDecompositionRequest(n,r,a,t,s,l,i.ContentProvider.None,c,d,{},IdGenerator.generateId(36));null!=this.brokerCallTimeout&&(g.BrokerCallTimeout=this.brokerCallTimeout),StoryLog.StructuredTraceTag(596473951,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.verbose,"Created decomposition request",{selectedElementId:r,requestType:o.SuggestionsRequestType[s].toString()}),d.length>0&&(p=!1,this.searchQuery=d[0]);var h=function(e){return u.onDecompositionComplete(e),e},C=function(){u.onDecompositionError()};return TDB.applyUpdate(function(){u._focusChanged.setValue(s===o.SuggestionsRequestType.FocusChanged),u._refreshingSuggestions.setValue(p),u._requestLoading.setValue(!0)}),StoryLog.TraceTag(7739592,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Add Content : Begin decompose suggestions. RequestId:"+g.RequestId,null),this.decompService.decomposeSuggestions(g).then(h,C)},e.prototype.clearContentPieces=function(){var e=this;TDB.applyUpdate(function(){e.contentPiecesToDisplay.setValue([]),e.primaryCallLoaded=!1,e._nextDecomposition=void 0,e.contentPiecesByProvider.setValue({}),e.searchQuery="",e.hasDisplayedElements.setValue(!1)})},e.prototype.onDecompositionComplete=function(e){var t=this,n=this._refreshingSuggestions.getValue(),i=this._focusChanged.getValue();if(TDB.applyUpdate(function(){t._requestLoading.setValue(!1),t._refreshingSuggestions.setValue(!1),t._focusChanged.setValue(!1)},TDB.Justification.SynchronousBrowserEvent),void 0!=e){StoryLog.TraceTag(7739593,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Add Content : Decomposition completed RequestId:"+e.RequestId,null);var r=o.DecompositionStatus.fromString(e.Status);r===o.DecompositionStatus.Success?(e.PerformanceMetrics&&IsPerformanceModeOn&&(PerformanceMetrics=e.PerformanceMetrics),(n||i)&&e.UpdateSuggestions&&(this.clearContentPieces(),this._nextDecomposition=null,this.primaryCallLoaded=!0),(n||i)&&!1===e.UpdateSuggestions||(this._nextDecomposition=e.Decomposition.NextDescriptor,this.createContentPiece(e)),void 0!=this.omArgs&&this.omArgs.onDecompSuccess()):void 0!=this.omArgs&&(r===o.DecompositionStatus.DisabledProviderFailure&&this.omArgs.onDecompDisabled?this.omArgs.onDecompDisabled():this.omArgs.onDecompError&&this.omArgs.onDecompError())}else void 0!=this.omArgs&&this.omArgs.onDecompError&&this.omArgs.onDecompError()},e.getImageLoadingMeasureId=function(e,t,n){return"("+e+")"+(n?" [SuggestedContent]":"")+"["+t+"]"},e.getImageLoadingMeasureIdForSuggestedContent=function(e){return"("+e+")[SuggestedContent]"},e.prototype.createContentPiece=function(t){var n=this;if(t.DecompostionProviderResults){var o=t,r=this.contentPiecesByProvider.getValue();t.RequestId&&ActionLogger.CreateClientMeasure(e.getImageLoadingMeasureIdForSuggestedContent(t.RequestId),{imageLoadingElapsedTime:null});for(var a in o.DecompostionProviderResults){var s=r[a];t.RequestId&&ActionLogger.CreateClientMeasure(e.getImageLoadingMeasureId(t.RequestId,a,!0),{imageLoadingElapsedTime:null}),s||(r[a]=[],s=r[a]),this.createContentPiecesFromDecompResults(o.DecompostionProviderResults[a],s,t.RequestId)}TDB.applyUpdate(function(){n.hasDisplayedElements.setValue(!1),n.contentPiecesByProvider.notify()},TDB.Justification.SynchronousBrowserEvent)}else{if(t.Decomposition.PartGroups.length>0){var l=i.ContentProvider[t.Decomposition.PartGroups[0].ProviderType];t.RequestId&&ActionLogger.CreateClientMeasure(e.getImageLoadingMeasureId(t.RequestId,l,!1),{imageLoadingElapsedTime:null})}this.createContentPiecesFromDecompResults(t.Decomposition,this.contentPiecesToDisplay.getValue(),t.RequestId),TDB.applyUpdate(function(){n.contentPiecesToDisplay.notify()},TDB.Justification.SynchronousBrowserEvent)}StoryLog.TraceTag(17847247,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"All content pieces added to collection. RequestId:"+t.RequestId)},e.prototype.createContentPiecesFromDecompResults=function(e,n,i){for(var r=e.SharedParts,a=e.PartGroups,s=a.length,l=n?n.length:0,c=0;c<s;c++){var d=a[c];d.Parts=d.Parts.concat(r);var u=o.ClipType[d.Type];if(ArrayExtensions.contains(t.SupportedContentPieceFormats,u)){var p=this.createSingleContentPiece(d,u,i,l);p&&(l++,n.push(p))}}},e.prototype.createSingleContentPiece=function(e,t,n,i){switch(t){case o.ClipType.SuggestedImage:return this.createSuggestedImageContentPiece(e,n,i);case o.ClipType.Image:return this.createImageContentPiece(e,n,i);case o.ClipType.Video:return this.createVideoContentPiece(e,n,i);case o.ClipType.Audio:return this.createAudioContentPiece(e,n,i);case o.ClipType.Folder:return this.createAlbumContentPiece(e,n,i);case o.ClipType.StatusUpdate:return this.createStatusUpdateContentPiece(e,n,i);case o.ClipType.Document:return this.createDocumentContentPiece(e,n,i);case o.ClipType.WikipediaCard:return this.createWikipediaContentPiece(e,n,i);default:throw StoryApp.RethrowLogger.createError("Unknown clip type: "+t)}},e.prototype.createSuggestedImageContentPiece=function(e,o,i){var r={initNaturalSize:new Size,clipPartGroup:e,addContent:this._args.addContent,cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,requestId:o,resourceFactory:this.resourceFactory,index:i};if(0!=e.ImageParts.length){e.ImageParts.sort(function(e,t){return t.Height*t.Width-e.Height*e.Width});var a=e.ImageParts.first();null!=a&&(r.initNaturalSize=new Size(a.Width,a.Height))}return new TDB.KeyedChildArgs(t.ImageContentPieceVE,r,n())},e.prototype.createImageContentPiece=function(e,o,i){e.ImageParts.sort(function(e,t){return t.Height*t.Width-e.Height*e.Width});var r={initNaturalSize:new Size(e.ImageParts[0].Width,e.ImageParts[0].Height),clipPartGroup:e,addContent:this._args.addContent,cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,requestId:o,resourceFactory:this.resourceFactory,index:i};return new TDB.KeyedChildArgs(t.ImageContentPieceVE,r,n())},e.prototype.createVideoContentPiece=function(o,i,r){var a={initNaturalSize:e._defaultVideoSize,clipPartGroup:o,addContent:this._args.addContent,cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,requestId:i,resourceFactory:this.resourceFactory,index:r};return new TDB.KeyedChildArgs(t.VideoContentPieceVE,a,n())},e.prototype.createAudioContentPiece=function(o,i,r){var a={initNaturalSize:e._defaultAudioSize,clipPartGroup:o,addContent:this._args.addContent,cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,requestId:i,index:r};return new TDB.KeyedChildArgs(t.AudioContentPieceVE,a,n())},e.prototype.createAlbumContentPiece=function(o,i,r){var a={initNaturalSize:e._defaultAlbumSize,clipPartGroup:o,context:this._args.context,folderClicked:this._args.onFolderNavigated,addContent:this._args.addContent,cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,requestId:i,index:r};return new TDB.KeyedChildArgs(t.FolderContentPieceVE,a,n())},e.prototype.createStatusUpdateContentPiece=function(o,i,r){var a={clipPartGroup:o,initNaturalSize:e._defaultStatusUpdateSize,addContent:this._args.addContent,cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,requestId:i,index:r};return new TDB.KeyedChildArgs(t.StatusUpdateContentPieceVE,a,n())},e.prototype.createWikipediaContentPiece=function(o,i,r){var a={clipPartGroup:o,initNaturalSize:e._defaultWikipediaCardSize,addContent:this._args.addContent,cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,requestId:i,index:r};return new TDB.KeyedChildArgs(t.WikipediaContentPieceVE,a,n())},e.prototype.createDocumentContentPiece=function(o,i,r){var a={initNaturalSize:e._defaultDocumentSize,clipPartGroup:o,addContent:this._args.addContent,cardDefinitionManager:this._args.cardDefinitionManager,cardsContainer:this._args.cardsContainer,requestId:i,index:r};return new TDB.KeyedChildArgs(t.DocumentContentPieceVE,a,n())},e.prototype.onDecompositionError=function(){var e=this;TDB.applyUpdate(function(){e._requestLoading.setValue(!1),e._refreshingSuggestions.setValue(!1),e._focusChanged.setValue(!1)}),void 0!=this.omArgs&&this.omArgs.onDecompError()},e.prototype.getContentPieces=function(e){return this.contentPiecesToDisplay.getWatchedValue(e)},e.prototype.getContentPiecesWatchable=function(){return this.contentPiecesToDisplay},e.prototype.setContentPieces=function(e){var t=this;TDB.applyUpdate(function(){t.contentPiecesToDisplay.setValue(e)})},e.prototype.getContentPiecesByProvider=function(e){return this.contentPiecesByProvider.getWatchedValue(e)},e.prototype.getContentPiecesByProviderWatchable=function(){return this.contentPiecesByProvider},e.prototype.setBrokerCallTimeout=function(e){this.brokerCallTimeout=e},e._defaultVideoSize=new Size(240,212),e._defaultAudioSize=new Size(240,151),e._defaultStatusUpdateSize=new Size(300,151),e._defaultWikipediaCardSize=new Size(300,151),e._defaultAlbumSize=new Size(227,151),e._defaultDocumentSize=new Size(227,151),e.providerPreferredHeights={},e}();t.ContentCollection=a}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=e.Server.Decomposition.WP,r=StoryApp.View.ViewElements,a=StoryApp.Common,s=e.View.ViewModel,l=function(l){function c(t,n){var o=l.call(this,t)||this;return o.index=n.index,o.selected=TDB.watchableTag(596473931,o,!1),o.naturalSize=TDB.watchableTag(596473932,o,n.initNaturalSize),o.added=TDB.watchableTag(596473933,o,!1),o.purchased=TDB.watchableTag(596473934,o,!1),o.isSelfAdjusting=!1,o.addContent=n.addContent,o._cardDefinitionManager=n.cardDefinitionManager,o._cardsContainer=n.cardsContainer,o.requestId=n.requestId,o.resourceLoadingTracker=new s.ResourceLoadingTracker(o.onLoadComplete,o),o.decompService=new e.Server.Decomposition.DecompositionAPI,o}return __extends(c,l),c.prototype.wrapperTouchToMouseArgs=function(e){return{enabled:e.watchValue(this.selected)}},c.prototype.contentAttrArgs=function(e){var t={};t[Aria.Attributes.Role]=Aria.Roles.Option,t[Aria.Attributes.Label]=this.description,t[Aria.Attributes.Title]=this.title;var n=this.selected.getWatchedValue(e);return t[Aria.Attributes.Selected]=n?Aria.BooleanState.True:Aria.BooleanState.False,t},c.prototype.inputCheckedInitArgs=function(){return this.selected},c.prototype.commonSelectionDraggableOptions=function(e){return this.selectionDraggableOptions(e,void 0,void 0,void 0)},c.prototype.selectionDraggableOptions=function(e,t,n,o){e.watch(this.addContent.selectionManager.selectionChanged);var i,r;if(this.addContent.selectionManager.totalSelectedItemCount()>1){var a=void 0===o?50:o;i={left:a,top:a},r=function(){return $("<div></div>").append($("<img/>").attr("src",CommonSettings.ContentBaseUrl+(void 0===n?"DragImageMultiple.png":n)))}}else{var s=void 0===t?this.commonDraggableArgs():t;i=s.cursorAt,r=s.helper}return{cursorAt:i,helper:r}},c.prototype.commonDraggableArgs=function(){var e={};e.opacity=.6,e.scroll=!0,e.appendTo="#pane-holder",e.cancel="";var t=this.getContentNodeDraggableWidth(),n=this.getContentNodeDraggableHeight();return t&&n&&(e.cursorAt={top:n,left:t}),e.helper=function(){var e=$(this).clone();e.css({position:"relative",width:t?t+"px":void 0,height:n?n+"px":void 0,left:0,top:0});var o=$("<div></div>").append(e);return o.width($(this).width()),o.height($(this).height()),o},e},c.prototype.getContentNodeDraggableWidth=function(){},c.prototype.getContentNodeDraggableHeight=function(){},c.prototype.getPart=function(e){return o.ObjectController.getPartFromPartGroup(e,this.partGroup)},c.prototype.getFirstPart=function(e){var t=this.getPart(e);return t.length>0?t[0]:void 0},c.prototype.mouseClicked=function(e){return ActionLogger.RecordClientAction(new ClientAction.ButtonClickAction(ClientAction.ButtonId.AddContent_ContentPieces,Diag.ULSCat.msoulscat_Story_AddContent)),this.onAction(e)},c.prototype.onAction=function(e){return this.addContent.selectionManager.toggleSelection(this,e.shiftKey),this.setFocus(),TDB.EventPropagation.Bypass},c.prototype.keyDown=function(e){switch(e.keyCode){case KeyCodeType.EnterKey:case KeyCodeType.SpaceKey:return this.onAction(e),TDB.EventPropagation.PreventDefault}return l.prototype.keyDown.call(this,e)},c.prototype.addContentPiece=function(){var e=this.createCard();if(e&&e.model)return this._cardsContainer.addCardObjects([e]),e.model},c.prototype.setIndex=function(e){this.index=e},c.prototype.getIndex=function(){return this.index},c.prototype.getFileSize=function(){var e=NaN,t=this.getPart(i.ClipPartType.Size);if(t&&t.length>0){var n=t[0].trim();n.length>0&&(e=parseInt(n))}return e},c.prototype.validate=function(){return!0},c.prototype.createCard=function(){if(!this.validate())return StoryLog.StructuredTraceTag(596473935,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Can't create model for content piece. Validation failed.",{contentPieceType:this.partGroup.Type,contentPieceProviderType:this.partGroup.ProviderType.toString()}),null;this.parent instanceof t.SuggestedContentResultsPanelVE?this.logAddSuggestedContentPieceAction():this.parent instanceof t.BasicContentPageResultsPanelVE&&this.logAddBasicContentPageContentPieceAction();var e=this.createCardObject();return e||StoryLog.StructuredTraceTag(596473936,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.warning,"Failed to create model for a content piece",{contentPieceType:this.partGroup.Type,contentPieceProviderType:this.partGroup.ProviderType.toString()}),e},c.prototype.logAddSuggestedContentPieceAction=function(){var e=this.parent.getModel(),t=e.getCurrentContentCollection().getContentPieces(),o=this.partGroup.Parts.firstOrDefault(function(e){return e.PartType==i.ClipPartType[i.ClipPartType.SCQueryIds].toString()}).Value,r=e.getActiveClusters(),a=!1;if(this.partGroup.ProviderType==n.ContentProvider.Bing&&StoryPageEditSettings.VisualClustersEnabled){var s=this.getPart(i.ClipPartType.Image);if(null!=s&&s.length>0){var l=e.getSuggestionsClusterCollection().getActiveVisualizationImageUrls();ArrayExtensions.contains(l,s[0])&&(a=!0)}}var c=new ClientAction.AddSuggestedContentPiece(t.length,this.index,e.getActiveClusters().length,e.getAllClusters().length,o,r.length,r.map(function(e){return e.ClusterClass}).join(";"),r.map(function(e){return e.ClusterSubType}).join(";"),r.map(function(e){return e.Index.toString()}).join(";"),e.getLicenseCheckboxChecked()?i.RequestLicenseTypeExtensions.getDefaultLicenseType().toString():"All",a,n.ContentProvider[this.partGroup.ProviderType],i.ClipType[this.clipType]);ActionLogger.RecordClientAction(c)},c.prototype.logAddBasicContentPageContentPieceAction=function(){var e=this,o=this.parent.model,r=void 0!=o.tabHeader?o.source.tabs[o.tabHeader.getSelectedTabIndex()]:void 0,a=o.getCurrentContentCollection().getContentPieces(),s=ArrayExtensions.indexOfFirst(a,function(t){return t.wouldBuild(e)}),l=void 0!=r?r.Id:"",c=o.parent.suggestionsClusterCollection,d=-1,u=0;void 0!=c&&(c.hasActiveOrAutoSelectedClusters()&&(d=c.getActiveClusters().first().Index),ArrayExtensions.contains(StoryPageEditSettings.ClusterStripeEnabledPanes,o.source.providerType)&&(u=c.getAllClusters().length)),ActionLogger.RecordClientAction(new ClientAction.AddBasicContentPiece(a.length,s,l,n.ContentProvider[this.partGroup.ProviderType],i.ClipType[this.clipType],u,d));var p=null;t.BasicContentPageViewModel.isProvider(o.source.providerType,[n.ContentProvider.Bing])?p=new ClientAction.AddBingImageData(o.getLicenseCheckboxChecked()?i.RequestLicenseTypeExtensions.getDefaultLicenseType().toString():"All"):t.BasicContentPageViewModel.isProvider(o.source.providerType,[n.ContentProvider.PicHit])&&(p=new ClientAction.AddPicHitImageData(s,l,this.getPart(i.ClipPartType.CategoryInfo).join(","),o.IsCurrentContentAuthenticated())),p&&ActionLogger.RecordClientAction(p)},c.prototype.onLoadComplete=function(e){var o=this.parent.parent instanceof t.SuggestedContentTabVE;e.loadingTime>0&&(ActionLogger.ObserveClientMeasure(t.ContentCollection.getImageLoadingMeasureId(this.requestId,n.ContentProvider[this.partGroup.ProviderType],o),{imageLoadingElapsedTime:e.loadingTime}),o&&ActionLogger.ObserveClientMeasure(t.ContentCollection.getImageLoadingMeasureIdForSuggestedContent(this.requestId),{imageLoadingElapsedTime:e.loadingTime}))},c.prototype.createCardObject=function(){var e,r=this,a=this.partGroup;return this.recordContentAddedAction(a),TDB.applyUpdate(function(){var s=o.ObjectController.getControllerInstanceFromPartGroup(a,r.pageId),l=r.addContent.selectedSource.getValue().providerType;if(!a.BrowseDescriptor||s instanceof o.ImportingOrEmbeddingDocumentController||s instanceof o.DocumentContentController){var c=new o.CardDefinitionManager(r.pageId);if(s instanceof o.ImportingOrEmbeddingDocumentController){var d=o.ImportingOrEmbeddingDocumentController.createCreationArgs(a,r.addContent.selectedSource.getValue().providerType),u=s.createFromContentWithCardDeck(d,r._cardsContainer);e=new o.Card({model:u,definition:c.getCardDefinition(o.ManualCardType.ImportingDocumentId)})}else e=o.ObjectController.createCard(r.partGroup,l,r.pageId)}else{var p=null,g=(e=r.create(l,r.pageId,a)).model;if(g instanceof n.MediaWithTextComposite){var h=a.TextParts.firstOrDefault(function(e){return e.TextCategory==i.TextCategory.Title});p=g.getMedia(),o.ObjectController.addUploadInfo(p,r.pageId,t.BasicContentPageViewModel.isProvider(l,[n.ContentProvider.SkyDrive,n.ContentProvider.OneDrive,n.ContentProvider.OneDrivePro])&&h?h.Text:null),p.setDecompInfo(new n.DecompInfo),p.getDecompInfo().setProvider(a.ProviderType)}r.decompService.decomposeBrowse(a.BrowseDescriptor).then(function(e){e&&e.Decomposition&&e.Decomposition.PartGroups&&0!==e.Decomposition.PartGroups.length?r.onDecomposeSuccess(p||g,e.Decomposition.PartGroups[0]):r.onDecomposeFailure(g)},function(){return r.onDecomposeFailure(g)})}}),e},c.prototype.create=function(e,t,n){var r,a,s=new o.CardDefinitionManager(t),l=o.ObjectController.getClipType(i.ClipType[n.Type]);switch(l){case o.ClipType.StatusUpdate:a=(r=s.getCardDefinition(o.ManualCardType.StatusUpdateId)).blueprint.controller;break;case o.ClipType.Image:case o.ClipType.WikipediaCard:a=(r=s.getCardDefinition(o.ManualCardType.ImageId)).blueprint.controller;break;case o.ClipType.Video:a=(r=s.getCardDefinition(o.ManualCardType.VideoId)).blueprint.controller;break;case o.ClipType.Audio:a=(r=s.getCardDefinition(o.ManualCardType.AudioId)).blueprint.controller;break;case o.ClipType.Document:a=(r=StoryPageEditSettings.BlockAuthoring_DocumentIngestionImportOrEmbedCard?s.getCardDefinition(o.ManualCardType.DocumentId):s.getCardDefinition(o.ManualCardType.ImportingDocumentId)).blueprint.controller;break;case o.ClipType.ClosedCaption:a=o.currentClosedCaptionController().get(t);break;default:throw StoryApp.RethrowLogger.createError("Unknown clip type "+l)}var c;return n&&(c=o.ObjectController.createCreationArgs(n,e)),new o.Card({definition:r,model:a.create(c)})},c.prototype.recordContentAddedAction=function(e){var o=n.ContentProvider[e.ProviderType],i=e.Type,r=-1,a="",s="",l=!1,c=this.parent.parent.parent.suggestionsClusterCollection;if(l=c.hasActiveOrAutoSelectedClusters(),this.parent instanceof t.BasicContentPageResultsPanelVE){var d=this.parent.model,u=d.tabHeader;t.BasicContentPageViewModel.isProvider(d.source.providerType,[n.ContentProvider.Bing,n.ContentProvider.Twitter,n.ContentProvider.YouTube])&&l?(r=l?1:0,s=l?"ClusterSearch":"UserSearch"):u&&(r=u.getSelectedTabIndex(),s=d.source.tabs[r].Id),a=d.getContentSource().providerType}else this.parent instanceof t.SuggestedContentResultsPanelVE&&(a=this.parent.getModel().getContentSource().providerType,r=l?1:0,s=l?"ClusterSearch":"UserSearch");var p="";if(StoryPageEditSettings.LandingPageEnabled&&l)for(var g=0,h=c.getActiveClusters().filter(function(e){return"Predefined"===e.ClusterClass});g<h.length;g++){var C=h[g];p+=StoryPageEditSettings.PredefinedClusterNamesToDefaultLanguage[C.Name]+" "}var f=new ClientAction.ContentAddedData(o,i,a,r,s,p);ActionLogger.RecordClientAction(f)},c.prototype.onDecomposeSuccess=function(t,n){var i=this;e.Model.currentUndoManager().get(this.pageId).captureIgnorableUpdate(function(){o.ObjectController.updateModel(t,n,i.addContent.selectedSource.getValue().providerType,i.pageId)},t.id)},c.prototype.onDecomposeFailure=function(e,t){void 0===t&&(t=null),StoryLog.TraceTag(596473937,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.warning,"Failed to refresh content piece decomposition"),o.StoryController.isModelObjectValid(e)&&e instanceof n.MediaWithTextComposite&&this.setModelError(e.getMedia(),t)},c.prototype.setModelError=function(t,n){void 0===n&&(n=null),e.Model.currentUndoManager().get(this.pageId).captureIgnorableUpdate(function(){var e=t.getUploadInfo();e.setEndAttempt((new Date).toISOString()),null!=n&&e.setErrorMessage(n)},t.id)},c.prototype.getDefinition=function(){var e=this._cardDefinitionManager.clipTypeMap;if(!e[this.clipType])throw StoryApp.RethrowLogger.createError("Cannot convert "+this.clipType+" to a valid card definition.");return e[this.clipType]},c.prototype.getBlueprint=function(){var e=this._cardDefinitionManager.clipTypeMap;if(!e[this.clipType])throw StoryApp.RethrowLogger.createError("Cannot convert "+this.clipType+" to a valid blueprint.");return e[this.clipType].blueprint},c.prototype.ifSelectionAddedArgs=function(e){return e.watchValue(this.added)},c.prototype.selectionAddedStyleArgs=function(e){return{opacity:"1"}},c.prototype.selectionAddedCssArgs=function(e){return{GreenImageOverlay:e.watchValue(this.added)}},c.prototype.selectedAddedIconArgs=function(){var e={buttonId:ClientAction.ButtonId.AddContent_AddedOverlay,clipClass:{value:Glyphs.AddContentCheckmarkWhiteClip},cssClass:{value:"GreenImageOverlayIcon segoeUISemilight"},description:{value:Resources.Added},glyphClass:{value:Glyphs.AddContentCheckmarkWhiteGlyph},textClass:"GreenImageOverlayIconText",text:{value:Resources.Added},domFocusable:{value:!1}};return new TDB.ChildArgs(r.GlyphButtonVE,e)},c.prototype.triggerAddedOverlay=function(){var e=this;TDB.applyUpdate(function(){return e.added.setValue(!0)}),platform.setTimeout(function(){TDB.applyUpdate(function(){e.added.setValue(!1)})},4e3)},c.prototype.selectionPurchasedStyleArgs=function(e){return{opacity:"1"}},c.prototype.selectionPurchasedCssArgs=function(e){return{GreenImageOverlay:e.watchValue(this.purchased)}},c.prototype.selectedPurchasedIconArgs=function(){var e={buttonId:ClientAction.ButtonId.AddContent_PurchasedOverlay,clipClass:{value:Glyphs.AddContentCheckmarkWhiteClip},cssClass:{value:"GreenImageOverlayIcon segoeUISemilight"},description:{value:Resources.Purchased},glyphClass:{value:Glyphs.AddContentCheckmarkWhiteGlyph},textClass:"GreenImageOverlayIconText",text:{value:Resources.Purchased},domFocusable:{value:!1}};return new TDB.ChildArgs(r.GlyphButtonVE,e)},c.prototype.triggerPurchasedOverlay=function(){var e=this;TDB.applyUpdate(function(){return e.purchased.setValue(!0)}),platform.setTimeout(function(){TDB.applyUpdate(function(){e.purchased.setValue(!1)})},4e3)},c.prototype.getMarginWidth=function(){return 4},c.prototype.mouseDoubleClicked=function(e){return a.UserState.getInstance().isUserOnFlight(FlightList.DoubleClickAddContentPaneExperiment1)&&CommonSettings.SiteDoubleClickInsertionAddContentPaneExperimentEnabled?(this.selected.getValue()||this.onAction(e),this.addContent.selectionManager.addSelection(),ActionLogger.RecordClientAction(new ClientAction.SimpleClientActionData(ClientAction.ActionType.DoubleClickInsertionExperiment_AddContentPane,Diag.ULSCat.msoulscat_Story_Site))):ActionLogger.RecordClientAction(new ClientAction.SimpleClientActionData(ClientAction.ActionType.DoubleClickInsertionControl_AddContentPane,Diag.ULSCat.msoulscat_Story_Site)),l.prototype.mouseDoubleClicked.call(this,e)},c.prototype.getAttributionInfo=function(){var e,n,o=t.Attribution.createEmptyAttributionInfo(),r=this.partGroup;return r&&(this.clipType===i.ClipType.Document?(e=r.TextParts.firstOrDefault(function(e){return e.TextCategory===i.TextCategory.Attribution}))&&(o.attributionText=e.Text,o.attributionLinkURL=e.Text):(e=r.TextParts.firstOrDefault(function(e){return e.TextCategory===i.TextCategory.Link}))?(o.attributionText=e.Text,o.attributionLinkURL=e.Text):(n=r.Parts.firstOrDefault(function(e){return"Link"===e.PartType}))&&(o.attributionText=n.Value,o.attributionLinkURL=n.Value)),o},c.prototype.supportsReporting=function(){return!!this.partGroup.ReportDescriptor},c.prototype.getReportInfo=function(){if(!this.supportsReporting())return null;var e=this.getFirstPart(i.ClipPartType.ThumbnailImage);return e||(e=this.getFirstPart(i.ClipPartType.Image)),{descriptor:this.partGroup.ReportDescriptor,imageUrl:e||"",logContentProvider:n.ContentProvider[this.partGroup.ProviderType]}},c.defaultContentPieceSize=150,c}(TDB.Control);t.ContentPieceVE=l}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Server.Decomposition.WP,o=StoryApp.View.ViewElements,i=e.Model.SM,r=function(e){function t(t,o){var i=e.call(this,t,o)||this;i.partGroup=o.clipPartGroup,i.clipType=n.ClipType.Audio;var r=i.getTitle();return i.title=i.getAudioDuration(),i.description=r?ResourceManager.ResolveString(Resources.AudioContentPieceTitle,[r]):void 0,i}return __extends(t,e),t.prototype.titleClassNameArgs=function(e){return"AddContentAudioTitle"},t.prototype.titleTextArgs=function(e){return this.getTitle()},t.prototype.getTitle=function(){var e=this.getPart(n.ClipPartType.Title);return e.length>0?e[0]:""},t.prototype.wrapperTouchToMouseArgs=function(e){return{enabled:e.watchValue(this.selected)}},t.prototype.wrapperDraggableOptionsArgs=function(t){return e.prototype.selectionDraggableOptions.call(this,t,this.wrapperDraggableInitArgs(),void 0,void 0)},t.prototype.wrapperDraggableInitArgs=function(){return this.commonDraggableArgs()},t.prototype.ifDurationArgs=function(){return!!this.getDuration()},t.prototype.durationTextArgs=function(e){return this.getDuration()},t.prototype.getDuration=function(){var e=this.getPart(n.ClipPartType.Duration);if(e.length>0)return e[0]},t.prototype.getAudioDuration=function(){var e=this.getDuration(),t="";if(e){var n=e.split(":");2===n.length&&(t=ResourceManager.ResolveString(Resources.VideoContentPieceLongDescription,[n[0],n[1]]))}return t},t.prototype.durationClassNameArgs=function(e){return"AddContentAudioDuration"},t.prototype.audioIconArgs=function(){var e={fontIconName:{value:FontIcons.AudioIcon},fontIconSizeClass:FontIcons.AudioIconSize,fontIconWrapperClass:{value:"AddContentAudioFontIcon"}};return new TDB.ChildArgs(o.FontIconVE,e)},t.prototype.getSizeLimit=function(){return this.partGroup.ProviderType==i.ContentProvider.OneDrive?StoryPageEditSettings.SettingService_MaxOneDriveAudioSize:this.partGroup.ProviderType==i.ContentProvider.OneDrivePro?StoryPageEditSettings.SettingService_MaxOneDriveBusinessAudioSize:NaN},t.prototype.validate=function(){var e=this.getFileSize(),t=this.getSizeLimit();return StoryLog.StructuredTraceTag(596473939,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Validating audio",{audioSize:e.toString(),sizeLimit:t.toString(),providerType:this.partGroup.ProviderType.toString()}),isNaN(e)||e<=0?(this.displayGenericErrorDialog(),StoryLog.StructuredTraceTag(596473940,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.error,"Audio size is <= 0 or it could not be fetched at all",{audioSize:e.toString(),providerType:this.partGroup.ProviderType.toString()}),!1):!(e>t)||(this.displayErrorDialog(t),StoryLog.StructuredTraceTag(596473941,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Audio is too big",{audioSize:e.toString(),sizeLimit:t.toString(),providerType:this.partGroup.ProviderType.toString()}),!1)},t.prototype.displayErrorDialog=function(e){ErrorDialog.ShowErrorDialog("",ResourceManager.ResolveString(Resources.OneDriveAudioFileTooLargeError,[e/1048576]),"Audio upload: Upload failed, audio is too big")},t.prototype.displayGenericErrorDialog=function(){ErrorDialog.ShowErrorDialog("",Resources.AudioUploadAmsInternalErrorMessage,"Audio upload: Upload failed, ODB audio size is invalid")},t}(t.ContentPieceVE);t.AudioContentPieceVEBase=r}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Server.Decomposition.WP,o=e.Model.AuthoringModel,i=StoryApp.View.ViewElements,r=function(e){function t(t,o){var i=e.call(this,t,o)||this;i.partGroup=o.clipPartGroup,i.clipType=n.ClipType.Document,i.documentTitle=i.getPart(n.ClipPartType.Title)[0],i.downloadLink=i.getPart(n.ClipPartType.Link)[0],i.downloadLink&&0!==i.downloadLink.trim().length||StoryLog.TraceTag(596473929,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"There is created document part without link!"),i.documentSize=i.getPart(n.ClipPartType.Size)[0],i.documentExtension=i.getPart(n.ClipPartType.Extension)[0];var r=i.getPart(n.ClipPartType.SourceName);return i.documentSource=r&&r.length>0&&r[0]||"",i.title=(i.documentExtension?i.documentExtension+" ":"")+Resources.DocumentContentPieceDescription,i.description=ResourceManager.ResolveString(Resources.DocumentContentPieceTitle,[i.documentTitle||""]),i}return __extends(t,e),t.prototype.wrapperTouchToMouseArgs=function(e){return{enabled:e.watchValue(this.selected)}},t.prototype.documentIconArgs=function(){var e={fontIconName:{value:this.documentFontIconName()},fontIconSizeClass:FontIcons.AddContentDocumentIconSize};return new TDB.ChildArgs(i.FontIconVE,e)},t.prototype.documentFontIconName=function(){return{Word:FontIcons.AddContentWordIcon,PowerPoint:FontIcons.AddContentPowerPointIcon,Excel:FontIcons.AddContentExcelIcon,PDF:FontIcons.AddContentPDFIcon,Default:FontIcons.AddContentDefaultDocumentIcon}[this.getResourceType()]},t.prototype.getResourceType=function(){var e,t=this.documentExtension;return"doc"===t||"docx"===t?e="Word":"ppt"===t||"pptx"===t?e="PowerPoint":"pdf"===t?e="PDF":"xls"==t||"xlsx"==t?e="Excel":(e="Default",void 0!=t&&StoryLog.StructuredTraceTag(596473930,Diag.ULSCat.msoulscat_Story_DocumentImport,Diag.ULSTraceLevel.error,"Unknown document extension",{"extension:":this.documentExtension})),e},t.prototype.documentTitleTextArgs=function(){return this.documentTitle},t.prototype.hasSourceArgs=function(){return this.documentSource&&""!==this.documentSource},t.prototype.documentSourceTextArgs=function(){return this.documentSource},t.prototype.wrapperDraggableOptionsArgs=function(e){return this.selectionDraggableOptions(e,this.wrapperDraggableInitArgs(),"DI_Icon_MultipleDocuments_80x80x32.png",40)},t.prototype.wrapperDraggableInitArgs=function(){return this.commonDraggableArgs()},t.prototype.validate=function(){var e=this.documentSize&&this.documentSize.trim().length>0?parseInt(this.documentSize):0;return 0===e?(this.displayFileCorruptedErrorDialog(),!1):!(e>CommonSettings.DocumentIngestionMaximumDocumentSize)||(this.displayFileTooBigErrorDialog(),!1)},t.prototype.displayFileCorruptedErrorDialog=function(){ErrorDialog.ShowErrorDialog("",Resources.DocumentIngestionFileEmptyError,"Doc Ingestion: Upload failed, file is corrupted")},t.prototype.displayFileTooBigErrorDialog=function(){ErrorDialog.ShowErrorDialog("",ResourceManager.ResolveString(Resources.DocumentIngestionFileSizeTooLargeError,[CommonSettings.DocumentIngestionMaximumDocumentSize/1048576]),"Doc Ingestion: Upload failed, file is too big")},t.prototype.createCard=function(){var t=e.prototype.createCard.call(this);return t&&t.model&&StoryPageEditSettings.BlockAuthoring_DocumentIngestionImportOrEmbedCard&&o.currentDocumentContentController().get(this.pageId).addDocument(this.documentExtension,this.documentSize,this.downloadLink,this.documentTitle,t.model.id,this.addContent.selectedSource.getValue().providerType),t},t}(t.ContentPieceVE);t.DocumentContentPieceVEBase=r}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Server.Decomposition.WP,o=function(e){function t(t,o){var i=e.call(this,t,o)||this;i._args=o,i.partGroup=i._args.clipPartGroup,i.title=i.getPart(n.ClipPartType.Title)[0],i.clipType=n.ClipType.Folder,i.description=ResourceManager.ResolveString(Resources.FolderContentPieceLongDescription,[i.title||"",i.getFolderContentCount()]),i.partGroup=i._args.clipPartGroup;var r=i.thumbnailUrl();return r&&(i.resourceLoadingTracker.addImageResource(r),i.resourceLoadingTracker.startLoading()),i}return __extends(t,e),t.prototype.wrapperAttrArgs=function(e){var t={};return t[Aria.Attributes.Role]=Aria.Roles.Option,t[Aria.Attributes.Label]=this.description,t[Aria.Attributes.Title]=this.description,t},t.prototype.folderImageStyleArgs=function(e){var t=this.thumbnailUrl();return t?{backgroundImage:"url('"+t+"')"}:{}},t.prototype.thumbnailUrl=function(){var e=this.getPart(n.ClipPartType.Image);return e.length>0?e[0]:void 0},t.prototype.folderTitleTextArgs=function(e){return this.title},t.prototype.contentAttrArgs=function(e){var t={};return t[Aria.Attributes.Role]=Aria.Roles.Button,t[Aria.Attributes.Label]=this.description,t[Aria.Attributes.Title]=this.description,t},t.prototype.folderTitleClassNameArgs=function(e){return"FolderTitle"},t.prototype.folderContentCountTextArgs=function(e){return this.getFolderContentCount()},t.prototype.getFolderContentCount=function(){var e=this.getPart(n.ClipPartType.AlbumCount);return 0===e.length?"":e[0]},t.prototype.folderContentCountClassNameArgs=function(e){return"FolderContentCount"},t.prototype.onAction=function(e){return this._args.folderClicked&&this._args.folderClicked.call(this._args.context,this),TDB.EventPropagation.Bypass},t.prototype.getMarginWidth=function(){return 4},t}(t.ContentPieceVE);t.FolderContentPieceVEBase=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Server.Decomposition.WP,o=e.Model.SM,i=e.Model.AuthoringModel,r=function(e){function r(o,r){var a=e.call(this,o,r)||this;a.partGroup=r.clipPartGroup,a.resourceFactory=r.resourceFactory,a.imageSrc=TDB.watchableTag(596473887,a,""),a.clipType=n.ClipType.Image,a.imageLoaded=TDB.watchableTag(596473888,a,!1);var s=a.getPart(n.ClipPartType.ThumbnailImage);a._imageSrc=s.length>0?s[0]:a.getPart(n.ClipPartType.Image)[0];var l="";if(StoryPageSettings.ClientVersion>=122){var c=a.getPart(n.ClipPartType.GifThumbnailImage);l=c.length>0?c[0]:a._imageSrc}a.imageName=a.getTitle(),a.width=r.initNaturalSize?r.initNaturalSize.width:0,a.height=r.initNaturalSize?r.initNaturalSize.height:0,a.showLabel=!(o instanceof t.BasicContentPageResultsPanelVE)||ArrayExtensions.contains(StoryPageEditSettings.ProvidersWithImageDescriptions,o.model.source.providerType);var d=i.ImageController.findImageClipPart(a.partGroup,a._imageSrc);if(d&&(r.initNaturalSize=new Size(d.Width,d.Height)),a.setImageSrc(a._imageSrc,l),a.showLabel){var u=ResourceManager.ResolveString(Resources.ImageContentPieceLongDescription,[a.width,a.height]),p=a.getSourceName()?a.getSourceName():void 0,g=a.imageName?a.imageName:p,h=g?ResourceManager.ResolveString(Resources.ImageContentPieceTitle,[g]):void 0;a.description=(h+" "||"")+u}else a.description=Resources.ImageContentPieceTooltip;return a}return __extends(r,e),r.prototype.contentClassNameArgs=function(e){return t.BasicContentPageViewModel.isProvider(this.addContent.selectedSource.getValue().providerType,[o.ContentProvider.Shutterstock])?"ShutterstockImageContentPiece":"ImageContentPiece"},r.prototype.wrapperStyleArgs=function(e){var t=e.watchValue(this.imageSrc),n=e.watchValue(this.imageLoaded);return{backgroundImage:t?"url('"+t.replace("'","%27")+"')":"",opacity:n?"1":"0"}},r.prototype.wrapperDraggableOptionsArgs=function(e){return this.commonSelectionDraggableOptions(e)},r.prototype.wrapperDraggableInitArgs=function(){return this.commonDraggableArgs()},r.prototype.setImageSrc=function(e,t){var n=this;this.resourceLoadingTracker.addImageResource(e),this.resourceLoadingTracker.addCallback(this.handleImageLoad,this),this.resourceLoadingTracker.startLoading(),t&&t.length>0&&(this.onGainingFocus=StoryApp.Utilities.deferredEventHandler(function(){TDB.applyUpdate(function(){n.imageSrc.setValue(t)})}),this.onLosingFocus=StoryApp.Utilities.deferredEventHandler(function(){TDB.applyUpdate(function(){n.imageSrc.setValue(e)})}))},r.prototype.handleImageLoad=function(e){var t=this;if(e.loadedSuccessfully){var n=e.resultElements[this._imageSrc].element,o=n.naturalWidth,r=n.naturalHeight,a=i.ImageController.findImageClipPart(this.partGroup,n.src);a&&(a.Width=o,a.Height=r),TDB.applyUpdate(function(){t.imageSrc.setValue(n.src),t.imageLoaded.setValue(!0),t.naturalSize.setValue(new Size(o,r))},TDB.Justification.SynchronousBrowserEvent)}else TDB.applyUpdate(function(){t.naturalSize.setValue(new Size(0,0))},TDB.Justification.SynchronousBrowserEvent)},r.prototype.onAction=function(t){return this.imageLoaded.getValue()?e.prototype.onAction.call(this,t):TDB.EventPropagation.Bypass},r.prototype.ifDescriptionLabelArgs=function(){return StoryPageEditSettings.ContentImagePropertyLabel&&this.showLabel},r.prototype.descriptionLabelTextArgs=function(e){return ResourceManager.ResolveString(Resources.ImageResultResolution,[this.width,this.height])},r.prototype.getMarginWidth=function(){return 4},r.prototype.livingImageFlagVisibleArgs=function(){return CommonSettings.LivingImageContentEnabled&&r.livingImageRegex.test(this.imageName)},r.prototype.getTitle=function(){var e=this.getPart(n.ClipPartType.Title);return e.length>0?e[0]:""},r.prototype.getSourceName=function(){var e=this.getPart(n.ClipPartType.SourceName);return e.length>0?e[0]:""},r.prototype.LivingImageIconArgs=function(){var e={fontIconName:{value:FontIcons.LivingImageIcon},fontIconSizeClass:FontIcons.LivingImageIconSize,fontIconWrapperClass:{value:"AddContentLivingImageFontIcon"}};return new TDB.ChildArgs(StoryApp.View.ViewElements.FontIconVE,e)},r.prototype.validate=function(){return!StoryPageEditSettings.SettingService_ImageSizeValidationEnabled||this.validateSizeInBytes()&&this.validateSizeInPixels()},r.prototype.validateSizeInBytes=function(){var e=this.partGroup.ProviderType,t=this.getFileSize();return StoryLog.StructuredTraceTag(596473921,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Validating content source image",{imageSizeBytes:t.toString(),provider:o.ContentProvider[e]}),isNaN(t)?(StoryLog.StructuredTraceTag(596473922,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"ImageContentPieceVE.validate: Image size in bytes could not be fetched",{provider:o.ContentProvider[e]}),!0):!(t>StoryPageEditSettings.SettingService_MaxImageSizeBytes)||(this.displayFileSizeErrorDialog(),StoryLog.StructuredTraceTag(596473923,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Content source image is too big",{imageSizeBytes:t.toString(),provider:o.ContentProvider[e]}),!1)},r.prototype.validateSizeInPixels=function(){var e=this.partGroup.ProviderType,t=this.getImageSize();return StoryLog.StructuredTraceTag(596473924,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Validating content source image",{imageSizePixels:t.toString(),provider:o.ContentProvider[e]}),0==t?(StoryLog.StructuredTraceTag(596473925,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"ImageContentPieceVE.validate: Image size in pixels could not be fetched",{provider:o.ContentProvider[e]}),!0):!(t>StoryPageEditSettings.SettingService_MaxImageSizePixels)||(this.displayImageSizeErrorDialog(),StoryLog.StructuredTraceTag(596473926,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Content source image is too big",{imageSizePixels:t.toString(),provider:o.ContentProvider[e]}),!1)},r.prototype.displayFileSizeErrorDialog=function(){ErrorDialog.ShowErrorDialog("",ResourceManager.ResolveString(Resources.ContentSourceImageSizeBytesTooBigError,[StoryPageEditSettings.SettingService_MaxImageSizeBytes/1048576]),"Image upload: Upload failed, content source image is too large.")},r.prototype.displayImageSizeErrorDialog=function(){ErrorDialog.ShowErrorDialog("",ResourceManager.ResolveString(Resources.ContentSourceImageSizePixelsTooBigError,[StoryPageEditSettings.SettingService_MaxImageSizePixels/1e6]),"Image upload: Upload failed, content source image is too large.")},r.prototype.getImageSize=function(){return this.width*this.height},r.livingImageRegex=new RegExp("_LI((.((jpg)|(jpeg)|(jpe)|(jif)|(jfif)|(jfi)))|s|$)"),r}(t.ContentPieceVE);t.ImageContentPieceVEBase=r}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Server.Decomposition.WP,o=StoryApp.View.ViewElements,i=function(e){function i(t,o){var i=e.call(this,t,o)||this;i.partGroup=o.clipPartGroup,i.clipType=n.ClipType.StatusUpdate,i.isSelfAdjusting=!0;var r=i.getProfileImageUrl();r&&i.resourceLoadingTracker.addImageResource(r);var a=i.getImageUrl();a&&i.resourceLoadingTracker.addImageResource(a);var s=i.getStatusUpdateBody();return i.description=s?ResourceManager.ResolveString(Resources.StatusUpdateContentPieceTitle,[s]):void 0,i.resourceLoadingTracker.startLoading(),i}return __extends(i,e),i.prototype.nameTextArgs=function(e){return this.getAuthorName()},i.prototype.getAuthorName=function(){var e=this.getFirstPart(n.ClipPartType.Author);return e||""},i.prototype.userNameTextArgs=function(e){return this.getUserName()},i.prototype.getUserName=function(){var e=this.getFirstPart(n.ClipPartType.UserName);return e||""},i.prototype.bodyTextArgs=function(e){return this.getStatusUpdateBody()},i.prototype.getStatusUpdateBody=function(){var e=this.getFirstPart(n.ClipPartType.Body);return e||""},i.prototype.profileImageStyleArgs=function(e){var t=this.getProfileImageUrl();return t?{backgroundImage:"url('"+t+"')"}:{}},i.prototype.getProfileImageUrl=function(){return this.getFirstPart(n.ClipPartType.ProfileImage)},i.prototype.imagePropsArgs=function(e){var t=this.getImageUrl();return t?{src:t}:{}},i.prototype.ifImageWrapperArgs=function(){return!!this.getImageUrl()},i.prototype.getImageUrl=function(){return this.getFirstPart(n.ClipPartType.Image)},i.prototype.attributionIconArgs=function(){var e={fontIconName:{value:FontIcons.TwitterIconSmall},fontIconSizeClass:FontIcons.TwitterIconSmallSize,fontIconWrapperClass:{value:"Attribution"}};return new TDB.ChildArgs(o.FontIconVE,e)},i.prototype.wrapperDraggableOptionsArgs=function(e){return this.commonSelectionDraggableOptions(e)},i.prototype.wrapperDraggableInitArgs=function(){return this.commonDraggableArgs()},i.prototype.getContentNodeDraggableWidth=function(){return t.StatusUpdateContentPieceVE.draggableWidth},i.prototype.getContentNodeDraggableHeight=function(){},i.draggableWidth=500,i}(t.ContentPieceVE);t.StatusUpdateContentPieceVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Server.Decomposition.WP,o=StoryApp.View.ViewElements,i=e.Model.SM,r=function(e){function t(t,o){var i=e.call(this,t,o)||this;i.resourceFactory=o.resourceFactory,i.partGroup=o.clipPartGroup,i.clipType=n.ClipType.Video;var r=i.getTitle();i.description=r?ResourceManager.ResolveString(Resources.VideoContentPieceTitle,[r]):void 0,i.title=r||i.getVideoDuration();var a=i.getThumbnailUrl();return a&&i.resourceLoadingTracker.addImageResource(a),i.resourceLoadingTracker.startLoading(),i}return __extends(t,e),t.prototype.titleClassNameArgs=function(e){return"AddContentVideoTitle"},t.prototype.titleTextArgs=function(e){return this.getTitle()},t.prototype.titleAttrArgs=function(e){var t={};return t[Aria.Attributes.Id]=this.id,t},t.prototype.getTitle=function(){var e=this.getPart(n.ClipPartType.Title);return e.length>0?e[0]:""},t.prototype.wrapperTouchToMouseArgs=function(e){return{enabled:e.watchValue(this.selected)}},t.prototype.validate=function(){if(this.partGroup.ProviderType==i.ContentProvider.OneDrivePro){var e=this.getFileSize();if(StoryLog.StructuredTraceTag(18430177,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Validating ODB video",{videoSize:e.toString()}),isNaN(e)||e<=0)return this.displayGenericErrorDialog(),StoryLog.StructuredTraceTag(596473886,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.error,"ODB video size is <= 0 or it could not be fetched at all",{videoSize:e.toString()}),!1;if(e>StoryPageEditSettings.SettingService_MaxOneDriveBusinessVideoSize)return this.displaySizeErrorDialog(),StoryLog.StructuredTraceTag(18430178,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"ODB video is too big",{videoSize:e.toString()}),!1}return!0},t.prototype.displaySizeErrorDialog=function(){ErrorDialog.ShowErrorDialog("",ResourceManager.ResolveString(Resources.OneDriveBusinessVideoSizeTooBigError,[StoryPageEditSettings.SettingService_MaxOneDriveBusinessVideoSize/1048576]),"Video upload: Upload failed, ODB video is too big")},t.prototype.displayGenericErrorDialog=function(){ErrorDialog.ShowErrorDialog("",Resources.VideoUploadGenericErrorMessage,"Video upload: Upload failed, ODB video size is invalid")},t.prototype.getVideoDuration=function(){var e=this.getDuration(),t="";if(e){var n=e.split(":");2===n.length&&(t=ResourceManager.ResolveString(Resources.VideoContentPieceLongDescription,[n[0],n[1]]))}return t},t.prototype.wrapperDraggableOptionsArgs=function(t){return e.prototype.selectionDraggableOptions.call(this,t,this.wrapperDraggableInitArgs(),void 0,void 0)},t.prototype.wrapperDraggableInitArgs=function(){return this.commonDraggableArgs()},t.prototype.videoImageStyleArgs=function(e){var t=this.getThumbnailUrl();return t?{backgroundImage:"url('"+t+"')"}:{}},t.prototype.getThumbnailUrl=function(){var e=this.getPart(n.ClipPartType.ThumbnailImage);return e.length>0?e[0]:void 0},t.prototype.ifDurationArgs=function(){return!!this.getDuration()},t.prototype.durationTextArgs=function(e){return this.getDuration()},t.prototype.getDuration=function(){var e=this.getPart(n.ClipPartType.Duration);return e.length>0?e[0]:void 0},t.prototype.durationClassNameArgs=function(e){return"AddContentVideoDuration"},t.prototype.videoIconArgs=function(){var e={fontIconName:{value:FontIcons.VideoIcon},fontIconSizeClass:FontIcons.VideoIconSize,fontIconWrapperClass:{value:"AddContentVideoFontIcon"}};return new TDB.ChildArgs(o.FontIconVE,e)},t}(t.ContentPieceVE);t.VideoContentPieceVEBase=r}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Server.Decomposition.WP,o=StoryApp.View.ViewElements,i=function(e){function i(t,o){var i=e.call(this,t,o)||this;i.partGroup=o.clipPartGroup,i.clipType=n.ClipType.WikipediaCard,i.isSelfAdjusting=!0,i.description=ResourceManager.ResolveString(Resources.WikipediaContentPieceTitle,[i.getCardTitle()]),i.partGroup&&(i.partGroup.Parts.forEach(function(e,t,n){"Attribution"===e.PartType&&(n[t].Value=decodeURI(e.Value))}),i.partGroup.TextParts.forEach(function(e,t,o){e.TextCategory===n.TextCategory.Attribution&&(e.Text=decodeURI(e.Text)),e.TextRuns.forEach(function(e){e.Url&&(e.Url=decodeURI(e.Url))})}));var r=i.getCardImageUrl();return r&&(i.resourceLoadingTracker.addImageResource(r),i.resourceLoadingTracker.startLoading()),i}return __extends(i,e),i.prototype.titleTextArgs=function(e){return this.getCardTitle()},i.prototype.getCardTitle=function(){var e=this.getFirstPart(n.ClipPartType.Title);return e||""},i.prototype.cardImageStyleArgs=function(e){var t=this.getCardImageUrl();return t?{backgroundImage:"url('"+t+"')"}:{}},i.prototype.getCardImageUrl=function(){return this.getFirstPart(n.ClipPartType.ThumbnailImage)},i.prototype.bodyTextArgs=function(e){return this.getWikipediaCardBody()},i.prototype.getWikipediaCardBody=function(){var e=this.partGroup.TextParts.firstOrDefault(function(e){return e.TextCategory===n.TextCategory.Summary});return e?e.Text:""},i.prototype.wrapperDraggableOptionsArgs=function(e){return this.commonSelectionDraggableOptions(e)},i.prototype.wrapperDraggableInitArgs=function(){return this.commonDraggableArgs()},i.prototype.getContentNodeDraggableWidth=function(){return t.WikipediaContentPieceVE.draggableWidth},i.prototype.getContentNodeDraggableHeight=function(){},i.prototype.attributionImageArgs=function(){var e={fontIconName:{value:FontIcons.WikipediaWIcon},fontIconSizeClass:FontIcons.WikipediaWIconSize,fontIconWrapperClass:{value:"WikipediaCardAttributionIcon"}};return new TDB.ChildArgs(o.FontIconVE,e)},i.prototype.attributionLinkArgs=function(){var e=this.partGroup.TextParts.firstOrDefault(function(e){return e.TextCategory===n.TextCategory.Attribution}),t="";if(e&&e.Text){var o=document.createElement("a");o.href=e.Text,t=o.hostname}return{url:e?e.Text:"",message:t}},i.prototype.hiddenCardImageAttrArgs=function(e){return{src:this.getCardImageUrl(),alt:""}},i.prototype.messagePartsArgs=function(){var e={span:{message:Resources.WikipediaAttributionLicenseSeparator}},t={url:Resources.CCBYSALicenseLinkUrl,message:Resources.CCBYSALicenseName},n=ResourceManager.resolveWithViewElementArgs(Resources.WikipediaLicensePrefix,[t]),i=[{link:this.attributionLinkArgs()},e].concat(n);return new TDB.ChildArgs(o.DynamicMessageVE,i)},i.draggableWidth=500,i}(t.ContentPieceVE);t.WikipediaContentPieceVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t,n=StoryApp.View.ViewElements;!function(e){e[e.ICloud=1]="ICloud",e[e.GoogleDrive=2]="GoogleDrive",e[e.DropBox=3]="DropBox",e[e.Pinterest=4]="Pinterest",e[e.Instagram=5]="Instagram",e[e.Vimeo=6]="Vimeo",e[e.Vine=7]="Vine"}(t=e.AddSourceTabIndex||(e.AddSourceTabIndex={}));var o=function(o){function i(t,n){var i={buttonId:ClientAction.ButtonId.SuggestedSource_AddSource,role:Aria.Roles.Button,hasPopup:!0,cssClass:{value:"MyDeviceOptionWrapper"},description:{value:e.SourceOption.getSourceDescription(n)}};return o.call(this,t,n,i)||this}return __extends(i,o),i.prototype.fontIconArgs=function(){var e={fontIconName:{value:this.source.displayFontIcon},fontIconSizeClass:FontIcons.AddSourceOptionIconSize,fontIconWrapperClass:{value:"SourceOptionFontIcon"}};return new TDB.ChildArgs(n.FontIconVE,e)},i.prototype.imgAttrArgs=function(e){return{src:this.source.displayIcon,role:Aria.Roles.Presentation,alt:""}},i.prototype.titleTextArgs=function(e){return this.source.displayName},i.prototype.onAction=function(e){if(e instanceof MouseEvent&&1!==e.which)return TDB.EventPropagation.Bubble;StoryLog.TraceTag(596473865,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"AddContentVE : addSourceClicked : User clicked button to suggest a source in Add Content");var n=[{checkboxOptions:[Resources.SuggestSourceICloud,Resources.SuggestSourceInstagram,Resources.SuggestSourceGoogleDrive,Resources.SuggestSourceVimeo,Resources.SuggestSourceDropbox,Resources.SuggestSourceVine,Resources.SuggestSourcePinterest],tabOrder:[t.ICloud,t.Instagram,t.GoogleDrive,t.Vimeo,t.DropBox,t.Vine,t.Pinterest],hasTextBox:!0,textBoxPlaceholder:Resources.SuggestSourceTextBoxPlaceholder,textBoxLabel:Resources.SuggestSourceTextBoxLabel,textBoxCss:"SurveyQuestionTextBoxSmall",hasTwoColumns:!0,id:"addsource",questionType:StoryApp.View.ViewElements.QuestionType.Checkbox}],o={onSubmit:this.onSubmit,onCancel:this.onCancel,context:this,questions:n,title:Resources.SuggestSourceTitle,messages:[Resources.SuggestSourceText]};return this.parent.hide(),new SurveyDialog(o).show(),TDB.EventPropagation.Bypass},i.prototype.onSubmit=function(e){var t={},n=e.addsource,o=n.checkboxOptions;for(var i in o)t[i]=o[i]?"true":"false";return t["Write In"]=n.textboxValue,StoryLog.StructuredTraceTag(596473866,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Add Content: Add source survey results",t),!0},i.prototype.onCancel=function(){StoryLog.TraceTag(596473867,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Add Content: Add Source: User closed add source dialog")},i}(e.SourceOption);e.AddSourceOptionVEBase=o}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=function(e){function o(n,o){var i=this,r={buttonId:ClientAction.ButtonId.SuggestedSource_Upload,role:Aria.Roles.Button,cssClass:{value:"MyDeviceOptionWrapper"},description:{value:t.SourceOption.getSourceDescription(o.source)}};return i=e.call(this,n,o.source,r)||this,i._cardsContainer=o.cardsContainer,i}return __extends(o,e),o.prototype.fontIconArgs=function(){var e={fontIconName:{value:this.source.displayFontIcon},fontIconSizeClass:FontIcons.MyDeviceOptionIconSize,fontIconWrapperClass:{value:"SourceOptionFontIcon"}};return new TDB.ChildArgs(VE.FontIconVE,e)},o.prototype.imgAttrArgs=function(e){return{src:this.source.displayIcon,role:Aria.Roles.Presentation,alt:""}},o.prototype.titleTextArgs=function(e){return this.source.displayName},o.prototype.onAction=function(e){if("INPUT"===e.target.nodeName.toUpperCase())return TDB.EventPropagation.Bubble;var o=new ClientAction.AddContentUIPaneData(ClientAction.ActionType.Edit_AddContentUI_UploadViaMyDevice,"",n.ContentProvider[n.ContentProvider.MyDevice]);ActionLogger.RecordClientAction(o);var i={uploadElement:$("#fileToUpload"),cardsContainer:this._cardsContainer};return t.UploadMediaAction.getInstance().execute(null,i),this.parent.hide(),TDB.EventPropagation.Bypass},o.prototype.inputFilePickerAutoUploadInitArgs=function(){return{filesReadyForUpload:this.filesReadyForUpload}},o.prototype.getContentFormatsFileFilter=function(){return StoryApp.Utilities.browser.isIE?StoryPageSettings.LocalUploadSupportedMimeTypes.filter(function(e){return-1==e.indexOf("video/")&&-1==e.indexOf("audio/")}).join(","):StoryPageSettings.LocalUploadSupportedMimeTypes.join(",")},o.prototype.inputFilePickerAttrArgs=function(e){return{accept:this.getSupportedUploadExtensions()}},o.prototype.filesReadyForUpload=function(e){this.parent.parent.uploadFiles(e,n.ContentProvider[n.ContentProvider.MyDevice])},o.prototype.inputFilePickerClassNameArgs=function(e){return"MyDeviceOptionFilePicker"},o.prototype.getSupportedUploadExtensions=function(){if(StoryApp.Utilities.browser.isSafari&&StoryApp.Utilities.browser.isMobile)return"*";var e=DocumentIngestion.DocumentIngestionAPI.getSupportedFileFormatFilter(),t=this.getContentFormatsFileFilter()+","+e;if(!StoryPageEditSettings.BlockAuthoring_DocumentIngestionImportOrEmbedCard){var n=e.split(","),o=StoryApp.Utilities.ios||StoryApp.Utilities.isMacOsX?StoryPageEditSettings.DocumentEmbedMimeTypes:StoryPageEditSettings.DocumentEmbedFormats.map(function(e){return"."+e});t+=","+(o=o.filter(function(e){return!ArrayExtensions.contains(n,e)})).join(",")}return t},o}(t.SourceOption);t.MyDeviceOptionVEBase=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(t){function n(o,i){var r={buttonId:n.getButtonIdForSource(i),role:Aria.Roles.Button,cssClass:{value:"SourceOptionWrapper"},description:{value:e.SourceOption.getSourceDescription(i)}};return t.call(this,o,i,r)||this}return __extends(n,t),n.prototype.fontIconPresentArgs=function(){return!!this.source.displayFontIcon},n.prototype.fontIconArgs=function(){var e={fontIconName:{value:this.source.displayFontIcon},fontIconSizeClass:FontIcons.SourceOptionIconSize,fontIconWrapperClass:{value:"SourceOptionFontIcon"}};return new TDB.ChildArgs(VE.FontIconVE,e)},n.prototype.imgAttrArgs=function(e){return{src:this.source.displayIcon,role:Aria.Roles.Presentation,alt:""}},n.prototype.titleTextArgs=function(e){return this.source.displayName},n.prototype.newFeatureFlagAttrArgs=function(e){return{src:this.source.newFeatureIcon}},n.prototype.newFeatureFlagVisibleArgs=function(){return!!this.source.newFeatureIcon},n.getButtonIdForSource=function(e){var t="SuggestedSource_"+e.providerType.replace(/\s+/g,"");return ClientAction.ButtonId[t]},n.prototype.onAction=function(e){return this.parent.parent.sourceClicked(this.source),TDB.EventPropagation.Bypass},n}(e.SourceOption);e.SourceOptionVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=StoryApp.View.Common.FRE,i=function(i){function r(e,t){var n=i.call(this,e)||this;return n.args=t,n.flyoutVisible=TDB.watchableTag(596464346,n,!1),n._authoringModel=t.authoringModel,n._fileUploader=t.fileUploader,n.sourceCardType=TDB.watchableTag(596473864,n,void 0),n}return __extends(r,i),r.prototype.selectorArgs=function(){var e={attributes:{compute:new TDB.ComputedOptionArgs(this,this.selectorAttr)},buttonId:ClientAction.ButtonId.AddContent_SourceSelector,click:this.onSelectorClicked,context:this,cssClass:{value:"SourceSelectorClass"},description:{value:Resources.SourceSelectorButtonDescription},tooltip:{compute:new TDB.ComputedOptionArgs(this,this.sourceSelectorTitle)},fontIconName:{value:FontIcons.SourceSelectorIcon},fontIconSizeClass:FontIcons.SourceSelectorIconSize,fontIconWrapperClass:{value:"SourceSelectorButton"},hasPopup:!0,enabled:{compute:new TDB.ComputedOptionArgs(this,this.selectorEnabled)},textClass:"SourceSelectorButtonText",textPlacementLeft:!0,text:{compute:new TDB.ComputedOptionArgs(this,this.selectorButtonText)},calloutArgs:{compute:new TDB.ComputedOptionArgs(this,function(e){return o.CalloutArgsCreator.createArgsForSourceSelector(e)})},tabIndex:t.AddContentTabIndex.SourceSelector,role:Aria.Roles.Button};return new TDB.ChildArgs(n.CalloutGlyphButtonVE,e)},r.prototype.getSelectorButton=function(){return this.selectorButton},r.prototype.flyoutArgs=function(){var e=this;return new TDB.ChildArgs(t.SourceSelectorFlyoutVE,{sources:this.args.sources,addContent:this.parent,cardsContainer:this._authoringModel.cardDeckVE,getControllingElement:function(){return e.selectorButton},visible:this.flyoutVisible})},r.prototype.selectorEnabled=function(e){return!t.AuthoringPageVE.shouldContentPaneBeDisabled(this.pageId,e)},r.prototype.selectorButtonText=function(e){if(t.AuthoringPageVE.shouldContentPaneBeDisabled(this.pageId,e))return Resources.Loading;var n=e.watchValue(this.parent.selectedSource);return n?n.displayName:""},r.prototype.sourceSelectorTitle=function(e){if(t.AuthoringPageVE.shouldContentPaneBeDisabled(this.pageId,e))return Resources.Loading;var n=e.watchValue(this.parent.selectedSource);return ResourceManager.ResolveString(Resources.SourceSelectorButtonTitle,[n.displayName])},r.prototype.onSelectorClicked=function(e){var t=this;return TDB.applyUpdate(function(){t.flyoutVisible.setValue(!t.flyoutVisible.getValue())}),StoryApp.View.Common.FRE.FirstRunTriggers.contentPaneChooseASourceClicked(),TDB.EventPropagation.Bypass},r.prototype.sourceClicked=function(e,n){var o=this;if(e.pageType==PageType.Camera)t.CameraAction.getInstance().execute(this._authoringModel.cardDeckVE);else{var i=this.parent.selectedSource.getValue(),r=e,a=new ClientAction.AddContentUINavigation(ClientAction.ActionType.Edit_AddContentUI_SwitchSource,"",i.providerType,r.providerType,this._authoringModel.addContentSourceDropdownFirstRun.getValue());ActionLogger.RecordClientAction(a),TDB.applyUpdate(function(){o.sourceCardType.setValue(n),void 0===n&&o.flyoutVisible.setValue(!1)}),this.parent.selectSource(e,n)}},r.prototype.uploadFiles=function(t,n){var o=this,i=FileObject.createFileObjects(t);e.Model.currentUndoManager().get(this.pageId).captureUserUpdate(function(){o.flyoutVisible.setValue(!1),o._fileUploader.uploadFiles(i,n)},"User upload files")},r.prototype.openFlyout=function(){var e=this;TDB.applyUpdate(function(){e.flyoutVisible.setValue(!0)})},r.prototype.selectorAttr=function(e){var t={};return t[Aria.Attributes.Expanded]=String(this.flyoutVisible.getWatchedValue(e)),t},r}(TDB.FocusableViewElement);t.SourceSelectorVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Server.ContentSourcesManager,o=StoryApp.View.ViewElements,i=StoryApp.Utilities,r=function(e){function o(t,n){var o=e.call(this,t,{features:TDB.ControlSetFeatures.VerticalList,description:Resources.SourceSelectorButtonDescription,role:Aria.Roles.Menu,getControllingElement:n.getControllingElement,visible:n.visible})||this;return o.args=n,o}return __extends(o,e),o.prototype.wrapperSlideVisibleInitArgs=function(){return!1},o.prototype.wrapperStyleArgs=function(e){return{maxHeight:i.toPxStr(StoryAppCommon.Environment.getInstance().getWindowSize(e).h-90)}},o.prototype.wrapperSlideVisibleArgs=function(e){return{visible:e.watchValue(this.visible),done:this.onPopupVisible,onBeginHide:this.exit}},o.prototype.wrapperAttrArgs=function(e){return this.getAriaAttributes(e)},o.prototype.getContentSources=function(e){var t=n.currentContentSourcesManager().get(this.pageId);return t?t.getContentSources(e):[]},o.prototype.optionsArgs=function(e){var n=this;return this.getContentSources(e).mapSome(function(e){if(e.excludeFromSourceSelector)return null;if(e.pageType===PageType.MyDevice){var o={source:e,addContent:n.args.addContent,cardsContainer:n.args.cardsContainer};return new TDB.ChildArgs(t.MyDeviceOptionVE,o)}return e.pageType===PageType.AddSource?new TDB.ChildArgs(t.AddSourceOptionVE,e):new TDB.ChildArgs(t.SourceOptionVE,e)})},o.prototype.onRestoreFocus=function(e){var t=this;return TDB.applyUpdate(function(){return t.parent.sourceCardType.setValue(void 0)},TDB.Justification.FocusManagement),!0},o}(o.PopupBaseVE);t.SourceSelectorFlyoutVEBase=r}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(e){function n(t,n){var o=e.call(this,t)||this;return o.model=n,o}return __extends(n,e),n.prototype.licenseCheckboxArgs=function(){return this.model.licenseCheckboxArgs()},n.prototype.resultsPanelArgs=function(){return this.model.resultsPanelArgs()},n.prototype.suggestedContentTabWrapperVisibleArgs=function(e){return this.model.suggestedContentTabWrapperVisibleArgs(e)},n.prototype.loadingMessageArgs=function(){return this.model.loadingMessageArgs()},n.prototype.contentFilterArgs=function(){return new TDB.ChildArgs(t.TabHeaderVE,this.model.contentFilter)},n.prototype.contentFilterGroupAttrArgs=function(){var e={};return e[Aria.Attributes.Title]=Resources.SuggestedContentFilterGroupDescription,e},n.prototype.errorMessageTextArgs=function(e){return this.model.errorMessageTextArgs(e)},n.prototype.ifErrorMessageArgs=function(e){return this.model.ifErrorMessageArgs(e)},n.prototype.attributionNotificationArgs=function(){return this.model.attributionNotificationArgs()},n.prototype.statusMessageArgs=function(){return this.model.statusMessageArgs()},n}(TDB.FocusableViewElement);e.SuggestedContentTabVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Server.Decomposition.WP,i=StoryApp.View.ViewElements,r=TDB.View.Bindings.MagazineLiquidLayout,a=function(a){function s(n,o){var s=a.call(this,o)||this;s.parent=n,s.statusMessage=TDB.watchableTag(596460622,s,void 0),s.source=o.source,s.errorMessage=TDB.watchableTag(596459927,s,""),s.gettingSuggestions=TDB.watchableTag(596459928,s,!1),s.resetClusterScrollPosition=TDB.notifierTag(596459929,s),s.addContentPaneVisible=!1,s.nextDecomps=TDB.watchableTag(596459930,s,{}),s.providerRules=TDB.watchableTag(596459931,s,[]),s.shouldLicenseBeDisplayed=null!=s.storyPageEditSettings.TabsWithLicense.firstOrDefault(function(e){return e==s.source.providerType}),s.searchedClusters=[],s.pendingSearchClusters=[],s.searchQuery="",s.pendingSearchQuery="",s.licenseCheckboxVisible=TDB.watchableTag(596459932,s,!1),s.nextGetSuggestionsRequest=0,s.authoringModel=o.authoringModel,s.paneStateManager=o.paneStateManager,s.attributionVisible=TDB.watchableTag(596459933,s,!0),s.providerNextDecomp=TDB.watchableTag(596459934,s,null),s.selectedContentFilter=TDB.watchableTag(596459935,s,r.FilterType.All);var l={addContent:s.parent,cardDefinitionManager:o.cardDefinitionManager,cardsContainer:o.cardsContainer,context:s,resourceFactory:o.resourceFactory,decompService:new e.Server.Decomposition.DecompositionAPI};s.contentCollection=o.contentCollectionFactory.createContentCollection(l),s.clusterStripeMessageGenerator=new t.ClusterStripeMessageGenerator(s,s.storyPageEditSettings),s.filterTabs=s.createFilterTabKeys();var c={context:s,tabKeys:s.filterTabs,tabConstructor:s.createFilterTabButtons,tabSelected:s.filterTabSelected};return s.contentFilter=new i.TabHeaderViewModel(c),s.selectFilterTab(r.FilterType.All),s}return __extends(s,a),s.prototype.getViewArgs=function(){return new TDB.ChildArgs(t.SuggestedContentTabVE,this)},s.prototype.resultsPanelArgs=function(){var e=this,n={resourceFactory:this.resourceFactory,authoringModel:this.authoringModel,paneStateManager:this.paneStateManager,contentFilter:this.selectedContentFilter,contentCollection:this.contentCollection,model:this};return new TDB.ChildArgs(t.SuggestedContentResultsPanelVE,n,function(t){e.resultsPanel=t})},s.prototype.getLicenseCheckboxClass=function(){return"LegalNotification"},s.prototype.setContentFilter=function(e){var t=this;TDB.applyUpdate(function(){t.selectedContentFilter.setValue(e)})},s.prototype.updateContentFilter=function(){var e=this.paneStateManager.getAuthoringPane(t.AuthoringPaneType.Content).sourceCardType.getValue();e==t.CardType.Image||e==t.CardType.Heading?this.selectFilterTab(r.FilterType.Images):e==t.CardType.Video?this.selectFilterTab(r.FilterType.Videos):this.selectFilterTab(r.FilterType.All)},s.prototype.getContentSource=function(){return this.source},s.prototype.isSuggestedContentTabVisible=function(e){return!(this.storyPageEditSettings.VisualClustersEnabled&&this.parent.suggestionsClusterCollection.showVisualClusters(e))||0===this.parent.suggestionsClusterCollection.getSuggestionsClustersLength(e)},s.prototype.onTransitionEndEvent=function(e){this.redoLayoutOnTransitionEnd()},s.prototype.getCurrentContentCollection=function(e){return this.contentCollection},s.prototype.onNavigateTo=function(){var e=this;this.resetLicenseNotification(),this.parent.updateSearchBoxFocusText(""),TDB.applyUpdate(function(){e.parent.searchPlaceholder.setValue(Resources.SuggestedContentSearchBoxPlaceholder)},TDB.Justification.InitialConversion)},s.prototype.loadingMessageVisible=function(e){return this.gettingSuggestions.getWatchedValue(e)||this.getCurrentContentCollection().requestLoading.getWatchedValue(e)},s.prototype.canSearch=function(e){return void 0!=this.source.searchDescriptor},s.prototype.search=function(e,t){var n=this;if(void 0===t&&(t=void 0),this.gettingSuggestions.getValue()||this.getCurrentContentCollection().requestLoading.getValue())return this.pendingSearchQuery=e,void(this.pendingSearchClusters=[]);this.searchQuery=e,this.searchedClusters=[],TDB.applyUpdate(function(){n.parent.preventVisualClusters.setValue(!0),null==t&&(t=o.RequestLicenseTypeExtensions.getDefaultLicenseType(),n.checkLicenseCheckbox()),n.statusMessage.setValue(void 0),n.resetScrollPosition.notify(),n.errorMessage.setValue(""),n.gettingSuggestions.setValue(!0),n.clearContent(),n.handleDecompTaskCompletion(n.getCurrentContentCollection().decomposeSuggestions(StoryPageSettings.StoryId,n.getSuggestionsClusterCollection().getAllClusters(),"","","",o.SuggestionsRequestType.Search,t,[],[e]))})},s.prototype.searchClusters=function(e,t){var n=this;void 0===t&&(t=void 0);for(var i=0;i<e.length;i++)e[i].Selection=o.SuggestionsClusterSelection[o.SuggestionsClusterSelection.Active].toString();if(this.gettingSuggestions.getValue()||this.getCurrentContentCollection().requestLoading.getValue())return this.pendingSearchClusters=e,void(this.pendingSearchQuery="");this.searchedClusters=e,this.searchQuery="",TDB.applyUpdate(function(){null==t&&(t=o.RequestLicenseTypeExtensions.getDefaultLicenseType(),n.checkLicenseCheckbox()),n.statusMessage.setValue(void 0),n.resetScrollPosition.notify(),n.errorMessage.setValue(""),n.gettingSuggestions.setValue(!0),n.clearContent(),n.handleDecompTaskCompletion(n.getCurrentContentCollection().decomposeSuggestions(StoryPageSettings.StoryId,n.getSuggestionsClusterCollection().getAllClusters(),"","","",o.SuggestionsRequestType.ClustersChanged,t,e))})},s.prototype.isSearchClustersRequired=function(e,t){void 0===t&&(t=void 0);for(var n=e.length==this.searchedClusters.length,o=0;n&&o<e.length;o++)n=e[o].Id==this.searchedClusters[o].Id;return!n||void 0!=t},s.prototype.clearSearch=function(){var e=this;this.searchQuery="",this.clearContent(),TDB.applyUpdate(function(){e.searchedClusters=[],e.parent.selectionManager.clearSelection(),e.licenseCheckboxVisible.setValue(!1)})},s.prototype.attributionCloseButtonClicked=function(e){var t=this,n=new ClientAction.ButtonClickAction(ClientAction.ButtonId.ShowAllResults,Diag.ULSCat.msoulscat_Story_AddContent,{Description:"Suggested Content Attribution Message Dismissed"});return ActionLogger.RecordClientAction(n),TDB.applyUpdate(function(){t.attributionVisible.setValue(!1),t.resultsPanel.updateActiveChild(TDB.OffsetOrigin.Current,0)}),TDB.EventPropagation.Bypass},s.prototype.statusMessageCloseButtonClicked=function(e){var t=this,n=new ClientAction.ButtonClickAction(ClientAction.ButtonId.StatusMessageClose,Diag.ULSCat.msoulscat_Story_AddContent,{Description:"Suggested Content Status Message Dismissed"});return ActionLogger.RecordClientAction(n),TDB.applyUpdate(function(){t.statusMessage.setValue(void 0)}),TDB.EventPropagation.Bypass},s.prototype.licenseCheckboxClicked=function(e){var t=this,n=new ClientAction.ButtonClickAction(ClientAction.ButtonId.Checkbox,Diag.ULSCat.msoulscat_Story_AddContent,{Description:"Suggested Content Checkbox Clicked ",Action:""!=this.searchQuery?"Search":"Request suggestions for cluster"});return ActionLogger.RecordClientAction(n),this.parent.selectionManager.clearSelection(),""!=this.searchQuery?(TDB.applyUpdate(function(){t.parent.preventVisualClusters.setValue(!0)}),this.search(this.searchQuery,this.getSelectedLicense())):this.searchClusters(this.searchedClusters,this.getSelectedLicense()),TDB.EventPropagation.Bypass},s.prototype.resetLicenseNotification=function(){var e=this;TDB.applyUpdate(function(){e.storyPageEditSettings.BingOldApi?e.licenseCheckboxVisible.setValue(!1):e.licenseCheckboxVisible.setValue(e.shouldShowLicenseCheckbox())})},s.prototype.clearContent=function(){var e=this;this.getCurrentContentCollection().clearContentPieces(),TDB.applyUpdate(function(){e.providerRules.setValue([])})},s.prototype.getActiveClusters=function(){return this.getSuggestionsClusterCollection().getActiveClusters()},s.prototype.getAllClusters=function(){return this.getSuggestionsClusterCollection().getAllClusters()},s.prototype.getAllClusterViewModels=function(){return this.getSuggestionsClusterCollection().suggestionsClusters.getValue()},s.prototype.getResultsPanel=function(){return this.resultsPanel},s.prototype.getSuggestionsClusterCollection=function(){return this.parent.suggestionsClusterCollection},s.prototype.getMessage=function(){return this.message},s.prototype.resetPageState=function(){},s.prototype.onDecompSuccess=function(e){var i=this;if(StoryLog.TraceTag(596473860,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"SuggestedContentTabVE : Successfully loaded "+this.getNumberOfContentPieces(e)+" content pieces. Disposed: "+this.disposed),!this.shouldIgnoreDecompositionResponse()){this.parent.selectionManager.clearSelection(!1),this.resetLicenseNotification(),TDB.applyUpdate(function(){null!=e.LayoutRules&&i.nextDecomps.setValue({});for(var t in e.DecompostionProviderResults)i.nextDecomps.getValue()[t]=e.DecompostionProviderResults[t].NextDescriptor});var r=[];if(null!=e.LayoutRules){for(var a=0;a<e.LayoutRules.length;a++){var s=e.LayoutRules[a],l={minNumberOfItems:s.MinNumberOfItems,rowCount:s.RowCount,provider:n.ContentProvider[Number(s.ContentProvider)],preferedSize:t.ContentCollection.providerPreferredHeights[s.ContentProvider]?t.ContentCollection.providerPreferredHeights[s.ContentProvider]:t.ContentPieceVE.defaultContentPieceSize};r.push(l)}StoryLog.StructuredTraceTag(596459936,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"Created the following provider rules from response",{providers:r.map(function(e){return e.provider}).join(" ")})}else r=this.providerRules.getValue();TDB.applyUpdate(function(){if(o.DecompositionStatus.fromString(e.Status)==o.DecompositionStatus.GenericBrokerFailure&&i.statusMessage.setValue([{span:{message:Resources.SomeServiceIsDown}}]),i.errorMessage.setValue(""),i.resetClusterScrollPosition.notify(),i.providerRules.setValue(r),0===i.getCurrentContentCollection().getContentPieces().length)if(i.getActiveClusters().length==i.getAllClusters().length&&1==i.getActiveClusters().length)i.errorMessage.setValue(Resources.NoResultsForOnlyCluster);else if(i.getAllClusters().length>i.getActiveClusters().length)if(i.getActiveClusters().length>1)i.errorMessage.setValue(Resources.SuggestedContentNoResultsPlural);else{var t=!0;for(var n in e.DecompositionProviderStatus)if(e.DecompositionProviderStatus[n]!=o.DecompositionStatus.DisabledProviderFailure){t=!1;break}t?i.errorMessage.setValue(Resources.AllServicesAreOnMaintenance):i.errorMessage.setValue(Resources.AllServicesDidNotReturnResults)}else i.getActiveClusters().length>1?i.errorMessage.setValue(Resources.SuggestedContentNoResultsNoMoreClustersPlural):i.errorMessage.setValue(Resources.SuggestedContentNoResultsNoMoreClusters);i.gettingSuggestions.setValue(!1)}),this.executePendingSearchIfNeeded()}},s.prototype.onDecompError=function(){var e=this;this.shouldIgnoreDecompositionResponse()||(TDB.applyUpdate(function(){0==e.getCurrentContentCollection().getContentPieces().length&&e.errorMessage.setValue(Resources.SuggestedContentNoConnection),e.gettingSuggestions.setValue(!1)}),this.executePendingSearchIfNeeded())},s.prototype.onDecompFailure=function(e){var t=this;this.shouldIgnoreDecompositionResponse()||(TDB.applyUpdate(function(){t.clearContent(),0==t.getCurrentContentCollection().getContentPieces().length&&("BingBrokerFailure"==e.Status?t.errorMessage.setValue(Resources.SuggestedContentBingFailure):"DisabledProviderFailure"==e.Status?t.turnOnMaintenance():t.errorMessage.setValue(Resources.SuggestedContentNoConnection)),t.gettingSuggestions.setValue(!1)}),this.executePendingSearchIfNeeded())},s.prototype.getNumberOfContentPieces=function(e){return e?e.Decomposition.PartGroups.length:0},s.prototype.suggestedContentTabWrapperVisibleArgs=function(e){return this.isSuggestedContentTabVisible(e)&&this.getAllClusters().length>0},s.prototype.loadingMessageArgs=function(){var e={message:{value:Resources.SuggestedContentLoadingMessage},visible:{compute:new TDB.ComputedOptionArgs(this,this.loadingMessageVisible)}};return new TDB.ChildArgs(i.LoadingMessageVE,e)},s.prototype.errorMessageTextArgs=function(e){this.message="",e.watch(this.parent.selectionManager.selectionChanged);var t=e.watchValue(this.errorMessage);return this.parent.searchClustersEnabled()&&""==t?(this.message=this.clusterStripeMessageGenerator.getClusterStripeMessage(e),this.message):(this.message=t,t)},s.prototype.ifErrorMessageArgs=function(e){return""!=e.watchValue(this.errorMessage)||this.parent.searchClustersEnabled()&&""!=this.clusterStripeMessageGenerator.getClusterStripeMessage(e)},s.prototype.getAttributionNotificationMessage=function(){var e={url:Resources.AttributionLinkUrl,message:Resources.AttributionLink,title:Resources.AttributionLinkTooltip};return ResourceManager.resolveWithViewElementArgs(Resources.AttributionMessage,[e])},s.prototype.attributionNotificationArgs=function(){var e={closeMessage:new TDB.ChildArgs(i.GlyphButtonVE,{buttonId:ClientAction.ButtonId.AddContent_CloseLicense,click:this.attributionCloseButtonClicked,context:this,cssClass:{value:"contentAttributionCloseButton"},tooltip:{value:Resources.LicenseNotificationCloseButtonDescription},description:{value:Resources.LicenseNotificationCloseButtonDescription},fontIconName:{value:FontIcons.AddContentCloseLegalIcon},fontIconSizeClass:FontIcons.AddContentCloseLegalIconSize,fontIconWrapperClass:{value:"CloseButtonLegalFontIcon"}}),linkMessageArgs:{value:this.getAttributionNotificationMessage()},messageVisible:this.attributionVisible};return new TDB.ChildArgs(t.DismissableNotificationVE,e)},s.prototype.statusMessageArgs=function(){var e=this,n={buttonId:ClientAction.ButtonId.AddContent_CloseLicense,click:this.statusMessageCloseButtonClicked,context:this,cssClass:{value:"BasicContentAttributionCloseButton"},description:{value:Resources.ButtonClose},fontIconName:{value:FontIcons.ClosePaneIcon},fontIconSizeClass:FontIcons.ClosePaneIconSize},o={closeMessage:new TDB.ChildArgs(i.GlyphButtonVE,n),checkMessageVisible:function(t){return e.isStatusMessageVisible(t)},linkMessageArgs:{watchable:this.statusMessage},wrapperCss:"StatusMessage"};return new TDB.ChildArgs(t.DismissableNotificationVE,o)},s.prototype.isStatusMessageVisible=function(e){return!!this.statusMessage.getWatchedValue(e)},s.prototype.getLastSearchQuery=function(){return this.searchQuery},s.prototype.redoLayoutOnTransitionEnd=function(){var e=this;TDB.applyUpdate(function(){return e.contentCollection.getContentPiecesByProviderWatchable().notify()},TDB.Justification.InitialConversion)},s.prototype.turnOnMaintenance=function(){var e=this;this.clearContent(),TDB.applyUpdate(function(){e.licenseCheckboxVisible.setValue(!1),e.attributionVisible.setValue(!1)}),this.errorMessage.setValue(Resources.ContentSourceUnderMaintenance)},s.prototype.executePendingSearchIfNeeded=function(){this.pendingSearchClusters.length>0?(this.searchClusters(this.pendingSearchClusters),this.pendingSearchClusters=[]):""!=this.pendingSearchQuery&&(this.search(this.pendingSearchQuery),this.pendingSearchQuery="")},s.prototype.getSelectedLicense=function(){return this.getLicenseCheckboxChecked()?o.RequestLicenseType.Share:o.RequestLicenseType.All},s.prototype.shouldShowLicenseCheckbox=function(){return this.shouldLicenseBeDisplayed&&(0!=this.getSuggestionsClusterCollection().numberOfSelectedClusters.getValue()||""!=this.getCurrentContentCollection().getCurrentSearchQuery())},s.prototype.createFilterTabKeys=function(){return[{filterType:r.FilterType.All,label:Resources.SuggestedContentFilterButtonLabelAll,buttonId:ClientAction.ButtonId.AddContent_SuggestedContentFilter_All},{filterType:r.FilterType.Images,label:Resources.SuggestedContentFilterButtonLabelImages,buttonId:ClientAction.ButtonId.AddContent_SuggestedContentFilter_Images},{filterType:r.FilterType.Videos,label:Resources.SuggestedContentFilterButtonLabelVideos,buttonId:ClientAction.ButtonId.AddContent_SuggestedContentFilter_Videos}]},s.prototype.createFilterTabButtons=function(e,t){var n={text:t.label,cssClass:"ContentNavRadioButton",selectedClass:"BasicContentPageTabSelected ContentNavRadioButtonSelected",buttonId:t.buttonId,index:e};return new TDB.ChildArgs(i.TextTabVE,n)},s.prototype.filterTabSelected=function(e){var t=this.filterTabs[e];this.setContentFilter(t.filterType)},s.prototype.selectFilterTab=function(e){var t=this.getTabIndexOfFilterType(e);this.contentFilter.selectTabIndex(t)},s.prototype.getTabIndexOfFilterType=function(e){return ArrayExtensions.indexOfFirst(this.filterTabs,function(t){return t.filterType===e})},s}(t.AddContentPageViewModel);t.SuggestedContentTabViewModel=a}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Server.Decomposition.WP,i=function(){function e(e){this.activeClustersChanged=TDB.watchableTag(596473817,this,!1),this.userFocusChanged=TDB.watchableTag(596473818,this,!1),this._suggestionsClusters=TDB.watchableTag(596473819,this,[]),this.suggestionsClusters=this._suggestionsClusters,this.numberOfSelectedClusters=TDB.watchableTag(596473820,this,0),this.numberOfPreviouslySelectedClusters=0,this._args=e,this.preventVisualClusters=e.preventVisualClusters,this.selectedSource=e.selectedSource}return e.prototype.clearSuggestionsClusters=function(){var e=this;this._suggestionsClusters.setValue([]),TDB.applyUpdate(function(){e.numberOfSelectedClusters.setValue(0)})},e.prototype.updateClusters=function(e){var t=this;if(void 0!=e){var n=!1;!this.hasActiveOrAutoSelectedClusters()&&this.getAllClusters().length>0&&(n=!0);var i=this.getClustersSelection();TDB.applyUpdate(function(){t.clearSuggestionsClusters();for(var r=t._suggestionsClusters.getValue(),a=0,s=e.length;a<s;++a){var l=t.createSuggestionsCluster(e[a],n);r.push(l)}t.updateClustersSelection(i)&&t.activeClustersChanged.setValue(!0);for(var a=0,s=r.length;a<s;++a)r[a].selection.getValue()==o.SuggestionsClusterSelection.Active&&TDB.applyUpdate(function(){t.numberOfSelectedClusters.setValue(t.numberOfSelectedClusters.getValue()+1)});t._suggestionsClusters.notify()},TDB.Justification.SynchronousBrowserEvent),TDB.applyUpdate(function(){for(var e=t._suggestionsClusters.getValue(),n=$(".SuggestionsClustersWrapper > button").first(),o=0,i=e.length;o<i;++o,n=n.next())e[o].naturalWidth.setValue(n.outerWidth(!1))})}},e.prototype.createSuggestionsCluster=function(e,n){var i=o.SuggestionsClusterSelection[e.Selection];switch(i){case o.SuggestionsClusterSelection.Inactive:case o.SuggestionsClusterSelection.Active:case o.SuggestionsClusterSelection.AutoSelected:break;default:i=o.SuggestionsClusterSelection.Inactive}var r=o.SuggestionsClusterSelection[e.PreviousSelection];switch(r){case o.SuggestionsClusterSelection.Inactive:case o.SuggestionsClusterSelection.Active:case o.SuggestionsClusterSelection.AutoSelected:break;default:r=o.SuggestionsClusterSelection.Inactive}return new t.SuggestionsClusterViewModel({buttonId:ClientAction.ButtonId.SuggestedContentCluster,suggestionsCluster:e,context:this._args.context,click:this._args.click,initialSelection:n?o.SuggestionsClusterSelection.Inactive:i,previousSelection:r,numberOfSelectedClusters:this.numberOfSelectedClusters,collection:this,role:Aria.Roles.Button,description:{value:e.Name}})},e.prototype.getAllClusters=function(){for(var e=[],t=this.suggestionsClusters.getValue(),n=t.length,i=0;i<n;++i){var r=t[i].cluster;r.Selection=o.SuggestionsClusterSelection[t[i].selection.getValue()],e.push(r)}return e},e.prototype.getActiveClusters=function(){for(var e=[],t=this.suggestionsClusters.getValue(),n=0,i=t.length;n<i;++n)t[n].selection.getValue()!==o.SuggestionsClusterSelection.Inactive&&e.push(t[n].cluster);return e},e.prototype.getActiveVisualizationImageUrls=function(){for(var e=[],t=this.suggestionsClusters.getValue(),n=0,i=t.length;n<i;++n)if(t[n].selection.getValue()!==o.SuggestionsClusterSelection.Inactive&&null!=t[n].cluster.ClusterVisualRepresentation){var r=t[n].currentVisualIndex.getValue();0<=r&&r<t[n].cluster.ClusterVisualRepresentation.length&&e.push(t[n].cluster.ClusterVisualRepresentation[r])}return e},e.prototype.hasActiveOrAutoSelectedClusters=function(){for(var e=this.suggestionsClusters.getValue(),t=e.length,n=0;n<t;++n){var i=e[n].selection.getValue();if(i==o.SuggestionsClusterSelection.Active||i==o.SuggestionsClusterSelection.AutoSelected)return!0}return!1},e.prototype.hasAutoSelectedClusters=function(){for(var e=this.suggestionsClusters.getValue(),t=e.length,n=0;n<t;++n)if(e[n].selection.getValue()==o.SuggestionsClusterSelection.AutoSelected)return!0;return!1},e.prototype.getClustersSelection=function(){for(var e={},t=this.suggestionsClusters.getValue(),n=t.length,o=0;o<n;++o){var i=t[o];e[i.cluster.Name]=i.selection.getValue()}return e},e.prototype.getSuggestionsClustersLength=function(e){return this.suggestionsClusters.getWatchedValue(e).length},e.prototype.getClustersSelectionFromResponse=function(e){for(var t={},n=e.SuggestionsClusters,i=n.length,r=0;r<i;++r){var a=n[r],s=o.SuggestionsClusterSelection[a.Selection];switch(s){case o.SuggestionsClusterSelection.Inactive:case o.SuggestionsClusterSelection.Active:break;default:s=o.SuggestionsClusterSelection.Inactive}t[a.Name]=s}return t},e.prototype.updateClustersSelection=function(e){for(var t=this._suggestionsClusters.getValue(),n=t.length,i=0==t.length,r=0;r<n;++r){var a=t[r],s=e[a.cluster.Name];(s===o.SuggestionsClusterSelection.Active&&a.selection.getValue()!=s||s===o.SuggestionsClusterSelection.Inactive&&a.selection.getValue()==o.SuggestionsClusterSelection.Active)&&(a.selection.setValue(s),i=!0)}return i},e.prototype.sortClusters=function(){var e=this;this._suggestionsClusters.getValue().bubbleSort(function(e,t){return e.selection.getValue()-t.selection.getValue()}),TDB.applyUpdate(function(){e.suggestionsClusters.notify()},TDB.Justification.SynchronousBrowserEvent)},e.prototype.deselectAll=function(){for(var e=this,t=this.suggestionsClusters.getValue(),n=0;n<t.length;n++)t[n].setClusterActivity(!1);TDB.applyUpdate(function(){e.numberOfSelectedClusters.setValue(0)})},e.prototype.markClusterSelect=function(){var e=this;this.deselectAll(),TDB.applyUpdate(function(){e.numberOfSelectedClusters.setValue(e.numberOfSelectedClusters.getValue()+1)})},e.prototype.markClusterDeselect=function(){this.numberOfSelectedClusters.setValue(this.numberOfSelectedClusters.getValue()-1)},e.prototype.supportedLanguage=function(){var e=CommonSettings.UserLocaleString.substr(0,2);return ArrayExtensions.contains(StoryPageEditSettings.SuggestedContentPartiallySupportedLanguages,e)||ArrayExtensions.contains(StoryPageEditSettings.SuggestedContentSupportedLanguages,e)},e.prototype.showVisualClusters=function(e){var t=this.selectedSource.getWatchedValue(e),o=this._args.context.getSelectedContentPage(e).getCurrentContentCollection(e),i=!!o&&o.hasDisplayedElements.getWatchedValue(e),r=0==this.numberOfSelectedClusters.getWatchedValue(e),a=i,s=!this.preventVisualClusters.getWatchedValue(e),l=!(-1!=t.landingPageTabIndex)||t.providerType==n.ContentProvider[n.ContentProvider.SuggestedContent];return this._suggestionsClusters.getWatchedValue(e),r&&!a&&s&&l&&this.supportedLanguage()},e.prototype.EncodeTypesToString=function(){for(var e="",t=0;t<this.getAllClusters().length;t++){var n=this.getAllClusters()[t];"General"==n.ClusterClass?e+="G":"Wildcard"==n.ClusterClass?e+="W":e+="#","Person"==n.ClusterSubType?e+="P":"Organization"==n.ClusterSubType?e+="O":"Location"==n.ClusterSubType?e+="L":"Title"==n.ClusterSubType?e+="T":"SubTitle"==n.ClusterSubType?e+="S":"EmphasizedText"==n.ClusterSubType?e+="E":"UnknownEntity"==n.ClusterSubType?e+="U":"Topic"==n.ClusterSubType?e+="C":"Text"==n.ClusterSubType?e+="X":"KeyPhrase"==n.ClusterSubType?e+="K":e+="#",e+=";"}return e},e}();t.SuggestionsClusterCollection=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Server.Decomposition.WP,o=function(e){function t(t,n){var o=e.call(this,t,n.buttonArgs)||this;return o.model=n,o}return __extends(t,e),t.prototype.textTextArgs=function(e){return this.model.cluster.Name},t.prototype.wrapperCssArgs=function(e){return{SuggestionsClusterVisualWrapper:this.model.showingVisualClusters(e)}},t.prototype.contentAttrArgs=function(e){var t=this.getButtonAttributes(e);return t[Aria.Attributes.Role]=Aria.Roles.Option,t[Aria.Attributes.Label]=ResourceManager.ResolveString(Resources.SuggestionsClusterScreenReaderValue,[this.model.cluster.Name]),t[Aria.Attributes.Selected]=Aria.BooleanState.fromBoolean(e.watchValue(this.model.selection)===n.SuggestionsClusterSelection.Active),t},t.prototype.contentCssArgs=function(e){return{SuggestionsClusterActive:e.watchValue(this.model.selection)===n.SuggestionsClusterSelection.Active,SuggestionsClusterVisual:this.model.showingVisualClusters(e)}},t.prototype.textCssArgs=function(e){var t=this.model.showingVisualClusters(e);return{SuggestedClusterTextWhite:t&&!StoryPageEditSettings.HideVisualClusterBackgroundImage,SuggestedClusterTextGray:t&&StoryPageEditSettings.HideVisualClusterBackgroundImage,segoeUISemilight:t,SuggestionsClusterContentWrapper:!t}},t.prototype.ifSuggestionsDecoratorArgs=function(e){return this.model.isVisualRepresentation(e)},t.prototype.ifSuggestionsSeparatorsArgs=function(e){return!this.model.isVisualRepresentation(e)},t.prototype.ifSuggestionsClusterImageArgs=function(e){return StoryPageEditSettings.VisualClustersEnabled&&this.model.clusterCollection.showVisualClusters(e)},t.prototype.ifSuggestionsClusterSearchIconArgs=function(e){return this.model.isVisualRepresentation(e)},t.prototype.suggestionsClusterSearchIconClassNameArgs=function(){return StoryPageEditSettings.HideVisualClusterBackgroundImage?"SuggestionsClusterSearchIconWrapperGray":"SuggestionsClusterSearchIconWrapperWhite"},t.prototype.suggestionsDecoratorClassNameArgs=function(){return StoryPageEditSettings.HideVisualClusterBackgroundImage?"SuggestionsClusterDecoratorWhite":"SuggestionsClusterDecoratorBlack"},t.prototype.suggestionsClusterImageStyleArgs=function(e){if(!StoryPageEditSettings.VisualClustersEnabled||StoryPageEditSettings.HideVisualClusterBackgroundImage)return{"background-image":"","background-color":""};if(null!=this.model.cluster.ClusterVisualRepresentation&&e.watchValue(this.model.currentVisualIndex)<this.model.cluster.ClusterVisualRepresentation.length){var t=document.createElement("img");return t.onerror=this.imageCheck.bind(this),t.src=this.model.getVisualRepresentation(e),{"background-image":"url('"+this.model.getVisualRepresentation(e)+"')","background-color":""}}return{"background-image":"","background-color":"rgb(50, 50, 50)"}},t.prototype.imageCheck=function(e){var t=this;return StoryLog.TraceTag(596473816,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"SuggestionsCluster : imageCheck : Image index for visual cluster is not zero: ["+this.model.cluster.Id+", "+(this.model.currentVisualIndex.getValue()+1)+"]"),TDB.applyUpdate(function(){t.model.currentVisualIndex.setValue(t.model.currentVisualIndex.getValue()+1)}),!0},t.prototype.onAction=function(e){this.model.setClusterActivity(this.model.selection.getValue()==n.SuggestionsClusterSelection.Inactive),ActionLogger.RecordClientAction(new ClientAction.SuggestedContentClusterClickAction(this.model.cluster.Id));var t=new ClientAction.SelectSuggestedContentClusterData(this.model.cluster.Id,this.model.cluster.Index,this.model.cluster.ClusterClass,this.model.cluster.ClusterSubType,this.model.cluster.SCQueryIds.join(";"),n.SuggestionsClusterSelection[this.model.previousSelection.getValue()].toString(),n.SuggestionsClusterSelection[this.model.selection.getValue()].toString(),this.model.clusterCollection.getActiveClusters().length,this.model.clusterCollection.getAllClusters().length,this.model.clusterCollection.EncodeTypesToString(),this.model.context.getContentSource().providerType);return ActionLogger.RecordClientAction(t),this.setFocus(),TDB.EventPropagation.Bypass},t}(StoryApp.View.ViewElements.ButtonVE);t.SuggestionsClusterVEBase=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Server.Decomposition.WP,o=function(){function e(e){this.naturalWidth=TDB.watchableTag(596473812,this,0),this.currentVisualIndex=TDB.watchableTag(596473813,this,0),this.context=e.context,this.clusterCollection=e.collection,this.cluster=e.suggestionsCluster,this.selection=TDB.watchableTag(596473814,this,e.initialSelection),this.previousSelection=TDB.watchableTag(596473815,this,e.previousSelection),this.buttonArgs=e}return e.prototype.showingVisualClusters=function(e){return this.clusterCollection.showVisualClusters(e)&&StoryPageEditSettings.VisualClustersEnabled},e.prototype.isVisualRepresentation=function(e){return null!=this.cluster.ClusterVisualRepresentation&&(this.clusterCollection.showVisualClusters(e)&&StoryPageEditSettings.VisualClustersEnabled)},e.prototype.getVisualRepresentation=function(e){return this.cluster.ClusterVisualRepresentation[this.currentVisualIndex.getWatchedValue(e)]},e.prototype.setClusterActivity=function(e){var t=this;e&&(this.clusterCollection.wereClustersPreviouslyVisual=this.clusterCollection.showVisualClusters(),this.clusterCollection.numberOfPreviouslySelectedClusters=this.clusterCollection.numberOfSelectedClusters.getValue()),TDB.applyUpdate(function(){e!=(t.selection.getValue()==n.SuggestionsClusterSelection.Active)&&(e?t.clusterCollection.markClusterSelect():t.clusterCollection.markClusterDeselect(),t.previousSelection.setValue(t.selection.getValue()),t.selection.setValue(e?n.SuggestionsClusterSelection.Active:n.SuggestionsClusterSelection.Inactive),t.clusterCollection.hasActiveOrAutoSelectedClusters()||(t.cluster.PreviousSelection=n.SuggestionsClusterSelection[t.selection.getValue()].toString(),t.cluster.Selection=n.SuggestionsClusterSelection[t.selection.getValue()].toString()),t.context&&t.buttonArgs.click&&t.buttonArgs.click.call(t.context))},TDB.Justification.SynchronousBrowserEvent)},e}();t.SuggestionsClusterViewModel=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(t){function n(e,n){var o=t.call(this,e)||this;return o.args=n,o.contentCollection=n.contentCollection,o.contentFilter=n.contentFilter,o.authoringModel=n.authoringModel,o}return __extends(n,t),n.prototype.getModel=function(){return this.args.model},n.prototype.ifSuggestedContentWrapperArgs=function(e){return this.isVisible(e)},n.prototype.isVisible=function(e){return 0!==this.contentCollection.getContentPieces(e).length||0!==DictionaryExtensions.length(this.contentCollection.getContentPiecesByProvider(e))},n.prototype.contentWrapperMagazineLiquidLayoutInitArgs=function(){var e=this.args.model;return{allContentPieces:this.contentCollection.getContentPiecesWatchable(),hasDisplayedElements:this.contentCollection.hasDisplayedElements,nextProvider:e.providerNextDecomp,providerDecompNexts:e.nextDecomps,providerRules:e.providerRules,elementTopMargin:2,crossClipTypeSectionPadding:8,elementLeftPadding:32,elementBottomMargin:2,filterType:this.contentFilter}},n.prototype.contentWrapperMagazineLiquidLayoutElementsArgs=function(e){var t=this.contentCollection,n=t.getContentPiecesByProvider(e);return e.watch(t.hasDisplayedElements),e.watch(this.authoringModel.addContentPaneResize),this.args.model.isSuggestedContentTabVisible(e),{contentByProvider:n,builtContent:this.contentPieces}},n.prototype.contentWrapperInfinitelyScrollableAreaInitArgs=function(){return{bottomReached:this.bottomReached.bind(this),checkHeightReference:{}}},n.prototype.contentWrapperScrollPositionArgs=function(e){return e.watch(this.args.model.resetScrollPosition),{top:0}},n.prototype.contentWrapperAttrArgs=function(e){var t=this.args.model,n={};n[Aria.Attributes.Role]=Aria.Roles.Listbox;var o=0===t.getActiveClusters().length?t.getLastSearchQuery():t.getActiveClusters()[0].Name;return n[Aria.Attributes.Label]=o?ResourceManager.ResolveString(Resources.AddContentPaneContentListLabel,[o]):void 0,n[Aria.Attributes.Multiselectable]=Aria.BooleanState.True,n},n.prototype.contentPiecesArgs=function(e){var t=this,n=this.contentCollection.getContentPiecesByProvider(e),o=this.contentCollection.getContentPieces(e);if(!e.watchValue(this.contentCollection.hasDisplayedElements)){o=[];for(var i in n)o=o.concat(n[i]);TDB.applyUpdate(function(){t.contentCollection.hasDisplayedElements.setValue(!0),t.contentCollection.setContentPieces(o)},TDB.Justification.InitialConversion)}return o},n.prototype.getActivatableChildren=function(){var e=this.filterActivatable(t.prototype.getActivatableChildren.call(this));return CommonSettings.SiteUiRtl?e.sort(function(e,t){return e.compareTabbingOrderTo(t,TDB.ControlSet.contentFlowDirection)}):e},n.prototype.handleNavigationKey=function(e){return this.args.model.loadingMessageVisible()?TDB.EventPropagation.PreventDefault:t.prototype.handleNavigationKey.call(this,e)},n.prototype.bottomReached=function(){var t=this.args.model;if(StoryLog.TraceTag(596473863,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.info,"SuggestedContentTabVE: bottomReached. Decomposing next batch of suggestions."),this.args.paneStateManager.getPaneVisible(e.AuthoringPaneType.Content)){var n=new ClientAction.ScrollDownAction(t.getCurrentContentCollection().getContentPieces().length,t.getActiveClusters().length,t.getCurrentContentCollection().nextDecompNotAvailable());ActionLogger.RecordClientAction(n),t.decomposeNext(t.providerNextDecomp.getValue())}},n}(StoryApp.View.ViewElements.GridViewPanelVE);e.SuggestedContentResultsPanelVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(e){function n(t,n){var o=e.call(this,t)||this;return o.author=n,o}return __extends(n,e),n.prototype.wrapperAttrArgs=function(e){return{title:this.author.displayName}},n.prototype.iconArgs=function(){var e={fontIconName:{value:FontIcons.CardDeckCoAuthorPresenceIcon},fontIconSizeClass:FontIcons.CardDeckCoAuthorPresenceIconSize};return new TDB.ChildArgs(t.FontIconVE,e)},n.prototype.nameTextArgs=function(e){return(this.author.givenName?this.author.givenName.charAt(0).toUpperCase():"")+(this.author.surname?this.author.surname.charAt(0).toUpperCase():"")},n}(TDB.FocusableViewElement);e.CardAuthorEntryVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(t){function n(e,n){var o=t.call(this,e)||this;return o.focusedAuthors=n,o}return __extends(n,t),n.prototype.authorEntriesArgs=function(t){var n=this.focusedAuthors.getWatchedValue(t);return n?n.map(function(t){return new TDB.ChildArgs(e.CardAuthorEntryVE,t)}):null},n}(TDB.FocusableViewElement);e.CardAuthorsListVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel;t.CardElementTabIndex={CardRegion:1,Teaser:2};var o=function(o){function i(n,i){var r=o.call(this,n,{features:TDB.ControlSetFeatures.Isolated,tabIndex:i.tabIndex?i.tabIndex:t.CardElementTabIndex.CardRegion})||this;r._viewModel=i.viewModel,r._viewModel.setCardVE(r),r._authoringModel=i.authoringModel,r.cardParent=i.cardParent,r.resourceFactory=i.resourceFactory,r.aboutToClone=TDB.watchableTag(596473753,r,!1),r.scrollIntoViewWatchable=TDB.watchableTag(596473754,r,void 0),r._isMouseOver=TDB.watchableTag(596473755,r,!1),r.isMouseOver=r._isMouseOver,r.cardsContainer=i.cardsContainer,r.cardDeckMenuHost=i.cardDeckMenuHost,r.cardDragHandler=i.cardDragHandler,r.paneStateManager=i.paneStateManager,r.additionalCSSMenuClasses="",r.isPopup=!1,r.isHeading=!1,r.showSocketLabel=i.showSocketLabel,r.cardLabelDefaultText=i.cardLabelText,null!=r.cardParent.cardNestingLevel?r.cardNestingLevel=r.cardParent.cardNestingLevel+1:r.cardNestingLevel=0;var a={domAttached:r.onDomAttached,domDetached:TDB.DomListenerManager.emptyDomDetatched};return r._domListener=Obj.implement(r,a),r.addDomListener(r._domListener),StoryPageEditSettings.StorylineVirtualizationEnabled&&(r._cardHeightWatcher=TDB.watcherTag(596473756,r,r,r.calculateCardHeight),r._cardHeightRecalcNotifier=TDB.notifierTag(596473757,r)),r.isEmptySocketCard()||r.isPlaceholderCard()||r.addResource(e.Model.currentUndoManager().get(r.pageId).registerStatefulComponent(r,r._viewModel.getModelId())),r.focusableSurrogate=new TDB.FocusableSurrogate(r,{getTabIndex:r.getTabIndex,domFocusable:{compute:new TDB.ComputedOptionArgs(r,r.isFocusable)}}),r.addFocusableChild(r.focusableSurrogate),r.copied=TDB.watchableTag(596473758,r,!1),r.createLabelMenuItem(),r}return __extends(i,o),i.prototype.getState=function(){return this._viewModel.calculateCardMode()},i.prototype.setState=function(e){this.setCardMode(e)},i.prototype.getCardExpandedView=function(){return this.cardExpandedView},i.prototype.getViewModel=function(){return this._viewModel},i.prototype.getModelObjectId=function(){return this._viewModel.getModelId()},i.prototype.acceptDraggables=function(e){return!0},i.prototype.isContainerCard=function(){return!1},i.prototype.wrapperAttrArgs=function(e){var t={},n=this.isFocusable(e),o=this.ifErrorMessageArgs(e);return t[Aria.Attributes.Role]=n?Aria.Roles.Region:Aria.Roles.Presentation,this.ifSocketLabelArgs()?t[Aria.Attributes.Label]=this._viewModel.getSocketLabel():t[Aria.Attributes.Label]=n?this._viewModel.getStorylineDescriptionWithStateInMultipleSelection(e,o):void 0,t[Aria.Attributes.Describedby]=o?this.errorWrapperId():void 0,t},i.prototype.mediaCardErrorWrapperAttrArgs=function(e){var t={};return t[Aria.Attributes.Role]=Aria.Roles.Status,t[Aria.Attributes.Id]=this.errorWrapperId(),t},i.prototype.ifErrorMessageArgs=function(e){return!1},i.prototype.errorWrapperId=function(){return"error_"+this.id},i.prototype.canEnter=function(){return!this._viewModel.inTeaserMode()},i.prototype.isVisible=function(e){return!0},i.prototype.isFocusable=function(e){return!(this.cardParent&&this.cardParent.isPopup||this._viewModel.inTeaserMode(e))},i.prototype.moveFocusInsideCard=function(){var e=this.getPrimaryInputElement();return!!e&&(e.setFocusToEnd(),!0)},i.prototype.onActivatedItem=function(){this.enter()},i.prototype.onDeactivatedItem=function(){this.exit()},i.prototype.activateItem=function(e){var t=this.getListView();if(!t)return!1;if(!e&&TextEditor.Selection.isSelection()&&this.getTextEditorElement()!==StoryApp.Utilities.getDocumentActiveElement()){try{TextEditor.Selection.clear()}catch(e){StoryApp.Utilities.browser.isIE||StoryLog.TraceTag(596473759,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"The following error occurred while trying to modify selection: "+e)}TextEditor.Cursor.cursorRangeIsNowOutdated()}return t.activateListItem(this,e),this.isActiveItem()},i.prototype.canActivateItem=function(){return!0},i.prototype.setItemActiveState=function(e){this._viewModel.setActive(e)},i.prototype.isActiveItem=function(e){return this._viewModel.isActiveItem(e)},i.prototype.setSelectedState=function(e){this.isSelectable()&&this.getListView().notifySelectionStateChanged(this,e)},i.prototype.isSelectable=function(e){return!0},i.prototype.isSelected=function(e){return!1},i.prototype.getListView=function(){return this.findParent(t.CardDeckVEBase)},i.prototype.getPrimaryTextViewModel=function(e){},i.prototype.getPrimaryInputElement=function(){},i.prototype.onEntering=function(){this.activateItem(!0)},i.prototype.mouseOver=function(e){var t=this;return TDB.applyUpdate(function(){t._isMouseOver.setValue(!0)},TDB.Justification.SynchronousBrowserEvent),!0},i.prototype.mouseOut=function(e){var t=this;return TDB.applyUpdate(function(){t._isMouseOver.setValue(!1)},TDB.Justification.SynchronousBrowserEvent),!0},i.prototype.wrapperEventsInitArgs=function(){return{mouseover:this.mouseOver,mouseout:this.mouseOut}},i.prototype.cardSelectionOverlayArgs=function(e){if(this.ifSelectionOverlayArgs(e))return new TDB.ChildArgsNoModel(t.CardSelectionStatusVE)},i.prototype.ifSelectionOverlayArgs=function(e){return!1},i.prototype.getCardSelectionStatusVE=function(){return this._selectionStatus},i.prototype.wrapperDraggableInitArgs=function(){var e=this,t={};return t.disable=this._viewModel.inSocket(),t.opacity=.4,t.scroll=!0,t.appendTo="#pane-holder",t.axis="y",t.cancel=".ms-rtestate-write, .EmbedCardHTMLCode, .CardDeckTweener, .CardDeckMenu, .JackWrapper, .monaco-editor",t.cursorAt={top:78},t.helper=function(){TDB.applyUpdate(function(){e.aboutToClone.setValue(!0)},TDB.Justification.SynchronousBrowserEvent);var t=e.createDraggingHelper(this);return TDB.applyUpdate(function(){e.aboutToClone.setValue(!1)},TDB.Justification.SynchronousBrowserEvent),t},t},i.prototype.createDraggingHelperForOM=function(){this.createDraggingHelper(document.createElement("div"))},i.prototype.createDraggingHelper=function(e){this._viewModel.isExpanded()&&this.setCardMode(n.CardMode.Collapsed);var t=$(e).clone();return $("<div />").css({"max-height":"155px","overflow-y":"hidden","overflow-x":"hidden"}).width($(e).outerWidth()).height($(e).outerHeight()).append(t)},i.prototype.wrapperDraggableOptionsArgs=function(e){return{disabled:this._viewModel.isInteractive(e)&&!this.cardParent.isPopup?"false":"true"}},i.prototype.ifCardWrapperArgs=function(e){return this.isVisible(e)},i.prototype.wrapperStyleArgs=function(e){var t={},n=this._viewModel.isSelected(e)?"none":"",o=this._viewModel.isDragging(e)?"0":void 0;e.watchValue(this.cardsContainer.activeCard);var i=this.menuVisible(e)?"0px":void 0;return t.touchAction=n,t.opacity=o,t.marginTop=i,t},i.prototype.wrapperScrollIntoViewInitArgs=function(){return 120},i.prototype.wrapperScrollIntoViewArgs=function(e){return this.scrollIntoViewWatchable.getWatchedValue(e)},i.prototype.wrapperCssArgs=function(e){var n=this._viewModel.inTeaserMode(e),o=this._viewModel.isMultiselected(e),i=this.cardParent.isCollapsed(e),r=this.cardParent.isHeading,a=this instanceof t.SetCardVE,s=this.getPrimaryTextViewModel(e),l=!!s&&s.hasFocus.getWatchedValue(e);return{PopupCard:this.cardParent.isPopup,BasicCard:!n,BasicCardTeaser:n&&!r,BasicCardWithInputFocus:l,BackgroundCardTeaser:n&&r,CardMultiselect:o&&!i&&!a,DraggableCard:!this._viewModel.inSocket(),NonDraggableCard:this._viewModel.inSocket()}},i.prototype.wrapperFloatingMenuArgs=function(e){return this.menuVisible(e)},i.prototype.wrapperFloatingMenuInitArgs=function(){return this.cardsContainer.menuOnCard},i.prototype.cardDetailButtonArgs=function(e){if(this.supportsExpandedMode(e))return new TDB.ChildArgs(VE.GlyphButtonVE,{buttonId:ClientAction.ButtonId.CardAction_ExpandCardDetail,context:this,cssClass:{watchable:TDB.watcherTag(596473760,this,this,this.calculateCardDetailButtonCssStyle)},description:{value:ResourceManager.ResolveString(Resources.ShowCardDetailsWithType,[this.cardLabelDefaultText])},tooltip:{value:Resources.ShowCardDetails},fontIconName:{value:FontIcons.ExpandIcon},fontIconSizeClass:FontIcons.ExpandIconSize,fontIconWrapperClass:{value:"ContainerCardCollapseFontIconWrapper"},textClass:"CardDetailButtonText ContainerCardHeaderLabel segoeUISemibold",text:{value:Resources.CardDetailButtonText},textPlacementRight:!0,click:this.cardDetailButtonClicked,role:Aria.Roles.Button})},i.prototype.calculateCardDetailButtonCssStyle=function(e){var t="CardDetailButton";return this.isPlaceholderHighlighted(this._placeholderCard,e)&&(t+=" PlaceholderActiveCardDetailButton"),t},i.prototype.isPlaceholderHighlighted=function(e,n){var o=e===this.cardsContainer.getActivePlaceholder(n)&&!!e,i=this.paneStateManager.getPaneVisible(t.AuthoringPaneType.Content,n);return o&&i},i.prototype.supportsExpandedMode=function(e){return this._viewModel.hasSockets()&&this.isActiveItem(e)&&this._viewModel.requiredSocketNotEmpty(e)},i.prototype.cardExpandedViewArgs=function(e){return new TDB.ChildArgs(t.ExpandedCardVE,{viewModelArgs:this._viewModel.getExpandedViewModelCreationArgs(),authoringModel:this._authoringModel})},i.prototype.cardDetailButtonClicked=function(e){return this.isCollapsed()&&this._viewModel.setCardMode(n.CardMode.Expanded),this.setFocus(),TDB.EventPropagation.Bypass},i.prototype.selectionOverlayEventsInitArgs=function(){return{click:this.selectionOverlayClick}},i.prototype.selectionOverlayClick=function(e){return this._viewModel.selectCard(),!1},i.prototype.getCardDeckMenu=function(e){return this.cardDeckMenuHost.menuVisible(e)?this._viewModel.createMenuChildArgs(this.cardDeckMenuHost,!0):void 0},i.prototype.menuVisible=function(e){return this._viewModel.isMenuVisible(e)},i.prototype.menuArgs=function(e){if(this._viewModel.isMenuVisible(e)&&!this.cardDeckMenuHost.menuVisible(e))return this._viewModel.createMenuChildArgs(this,!1)},i.prototype.getCardMenuVE=function(){return this._menu},i.prototype.sidebarArgs=function(e){return this._viewModel.getSideBar(e)},i.prototype.selectionBarArgs=function(e){if(!this._viewModel.inTeaserMode(e)&&this._viewModel.isSelectionCheckmarkVisible.getWatchedValue(e)&&!this._viewModel.inSocket())return this._viewModel.createSelectionBar()},i.prototype.getSelectionBarVE=function(){return this._selectionBar},i.prototype.wrapperDistanceFromIPInitArgs=function(){return this.distanceFromIPRef={},this.distanceFromIPRef},i.prototype.createLabelMenuItem=function(){var e={text:{compute:new TDB.ComputedOptionArgs(this,this.labelText)},textVisible:{compute:new TDB.ComputedOptionArgs(this,this.labelTextVisible)}};this._label=new VE.StaticMenuItem({primaryType:t.CardLabelVE,primaryArgs:e,widthBuffer:40})},i.prototype.labelArgs=function(e){var t=this.getLabelMenuItem(e);return t&&t.getPrimaryArgs()},i.prototype.getLabelMenuItem=function(e){return this.labelVisible(e)?this._label:void 0},i.prototype.labelVisible=function(e){var t=this.getViewModel().hasSockets()&&this.isExpanded(e),n=this._viewModel.inTeaserMode(e),o=this.menuVisible(e)&&this._viewModel.isMultiselected(e);return!t&&!n&&!o},i.prototype.labelTextVisible=function(e){var t=this.menuVisible(e),n=t&&(!this._menu||this._menu&&this._menu.hasRoomForLabel(e));return!this._viewModel.areShowingControls(e)&&(!t||n)},i.prototype.labelText=function(e){return this.cardLabelDefaultText},i.prototype.jackArgs=function(){return this._viewModel.createJackArgs()},i.prototype.getJack=function(e){if(this.jack&&this.enableJack(e))return this.jack.getChild(e)},i.prototype.authorsListArgs=function(e){return this._viewModel.createAuthorsList(e)},i.prototype.hideJack=function(e){return!this.enableJack(e)},i.prototype.enableJack=function(e){return this.canAddAnyContentToParent(e)},i.prototype.moveFocusForRemove=function(){if(this.isActiveItem()){var e=this.getListView(),t=this.cardParent.getChildCards();t&&t[t.length-1]===this?e.updateActiveChild(TDB.OffsetOrigin.RemovedCurrent,0):e.updateActiveChild(TDB.OffsetOrigin.RemovedCurrent,1)}},i.castCardParent=function(e){if(e&&e.getChildCards)return e},i.prototype.isAncestorSelected=function(){return this._viewModel.isAncestorSelected()},i.prototype.childAcceptDraggables=function(e,t){return!1},i.prototype.areDescendantsVisible=function(e){return!1},i.prototype.isCollapsed=function(e){return this._viewModel.isCollapsed(e)},i.prototype.remove=function(e){this._viewModel.remove(e),this.cardsContainer.computeCardDeckElements()},i.prototype.getTextEditorElement=function(){return null},i.prototype.getTextAggregator=function(){return this._authoringModel?this._authoringModel.getTextAggregator():null},i.prototype.scrollIntoView=function(e){var t=this;TDB.applyUpdate(function(){t.scrollIntoViewWatchable.setValue(e),t.scrollIntoViewWatchable.notify()})},i.prototype.dispose=function(){o.prototype.dispose.call(this),this._domListener&&(this.removeDomListener(this._domListener),this._domListener=void 0,this.cardsContainer.removeTrackedCard(this)),this.cardsContainer.removeDisposedCard(this)},i.prototype.mouseClicked=function(e){return this._viewModel.shouldHandleMouseEvents()?(e.ctrlKey||e.shiftKey?this._viewModel.selectCard():(this._viewModel.clearSelection(),this.setFocus()),this._viewModel.doCardAction(e)):TDB.EventPropagation.Bubble},i.prototype.keyDown=function(e){switch(e.keyCode){case KeyCodeType.EscapeKey:if(!e.altKey&&!e.ctrlKey)return this._viewModel.isSelectionMode()&&this._viewModel.clearSelection(),this.setActiveChild(void 0),this.updateActiveChild(TDB.OffsetOrigin.Initial,0),TDB.EventPropagation.PreventDefault;break;case KeyCodeType.UpArrowKey:if(e.shiftKey&&e.altKey&&!e.ctrlKey&&!e.metaKey)return this._viewModel.moveCard(!1),TDB.EventPropagation.PreventDefault;break;case KeyCodeType.DownArrowKey:if(e.shiftKey&&e.altKey&&!e.ctrlKey&&!e.metaKey)return this._viewModel.moveCard(!0),TDB.EventPropagation.PreventDefault}return o.prototype.keyDown.call(this,e)},i.prototype.keyPress=function(e){var n=this.getPrimaryInputElement();if(this.isFocused()&&n instanceof t.CommonTextVE&&!n.isFocused()&&e.keyCode!==KeyCodeType.EscapeKey&&e.keyCode!==KeyCodeType.DownArrowKey&&e.keyCode!==KeyCodeType.UpArrowKey&&e.keyCode!==KeyCodeType.RightArrowKey&&e.keyCode!==KeyCodeType.LeftArrowKey){if(e.altKey||e.ctrlKey||e.metaKey)return TDB.EventPropagation.Bubble;n.setFocus(),StoryApp.Utilities.browser.isIE&&n.onGainingFocus()}return TDB.EventPropagation.Bubble},i.prototype.handleShortcutKey=function(e){var o=this._authoringModel.storyPageState.isEditMode,i=TDB.EventPropagation.Bubble,r=this.getShortcutElements(TDB.ShortcutIdentifier.createShortcutIdentifierFromEvent(e));if(r.length>0)i=this.executeShortcutElements(r,e);else if(o&&o.getValue()&&this.isFocused())switch(e.keyCode){case KeyCodeType.EnterKey:if(this.supportsExpandedMode())this.toggleExpandCollapse();else{var a=this.getPrimaryInputElement();a instanceof t.CommonTextVE&&a.setFocus()}i=TDB.EventPropagation.PreventDefault;break;case KeyCodeType.LeftArrowKey:this._viewModel.hasSockets()&&this._viewModel.calculateCardMode()===n.CardMode.Expanded&&(this._viewModel.setCardMode(n.CardMode.Collapsed),i=TDB.EventPropagation.PreventDefault);break;case KeyCodeType.RightArrowKey:this.supportsExpandedMode()&&this._viewModel.isCollapsed()&&(this._viewModel.setCardMode(n.CardMode.Expanded),i=TDB.EventPropagation.PreventDefault);break;case KeyCodeType.EscapeKey:this._viewModel.clearSelection()}return e.ctrlKey||e.metaKey||e.altKey||e.keyCode!=KeyCodeType.SpaceKey&&e.keyCode!=KeyCodeType.EnterKey||this._viewModel.doCardAction(e),i},i.prototype.toggleExpandCollapse=function(){this._viewModel.isCollapsed()?this.cardDetailButtonClicked(void 0):this._viewModel.isExpanded()&&this.cardExpandedView.getViewModel()&&this.cardExpandedView.getViewModel().collapseButtonClicked(void 0)},i.prototype.getActivatableChildren=function(){var e=this;if(this._viewModel.isSelected()){var t=[];if(this._selectionStatus&&t.push(this._selectionStatus),this._selectionBar&&t.push(this._selectionBar),this._menu){var n=TDB.ControlSet.getActivatableChildren(this._menu);t=t.concat(n)}return t}var o=this.getFocusableElements();return o.sort(function(t,n){return t.compareTabbingOrderTo(n,TDB.ControlSet.contentFlowDirection,e,o)})},i.prototype.getFocusableElements=function(){var e=this;return this.traverseFocusable(function(t){return t!==e&&t instanceof TDB.ControlBase&&t.isTabbable()&&t.canActivate()?t:void 0},function(n){return!(n instanceof TDB.ControlBase)||n===e||n instanceof t.PlaceholderCardVE})},i.prototype.toString=function(){return o.prototype.toString.call(this)+" TeaserMode="+this._viewModel.inTeaserMode()+" MenuVisible="+this.menuVisible()+" CardType="+t.CardType[this.cardType]+" IsCollapsed="+this.isCollapsed()+" CardNestingLevel="+this.cardNestingLevel+" IsPopup="+this.isPopup},i.prototype.mouseDoubleClicked=function(e){return this._viewModel.inTeaserMode()&&this.cardParent.isCollapsed()?(this.cardsContainer.scrollToCardsAndSetFocus([this],!0),TDB.EventPropagation.Bypass):TDB.EventPropagation.Bubble},i.prototype.isInContainerCard=function(){return this.cardParent instanceof t.ContainerCardVE},i.prototype.getSelectionNotifier=function(){var e=this.getPrimaryInputElement();return e?e.getSelectionNotifier():null},i.prototype.isTextAreaEmpty=function(e){var t=this.getPrimaryTextViewModel(e);if(t)return t.isEmpty.getWatchedValue(e)},i.prototype.wrapperTouchToMouseArgs=function(e){return{enabled:this._viewModel.isSelected(e)}},i.prototype.isHostedInPopup=function(){return this.cardParent.isPopup},i.prototype.isRootHeading=function(){return!1},i.prototype.highlight=function(e,n){var o=this.getPrimaryInputElement();n===VE.HighlightingType.CurrentSearchHit&&(this.ensureVisible(),this.activateItem(!0)),o instanceof t.CommonTextVE&&o.highlight(e,n)},i.prototype.ensureVisible=function(){for(var e=this.cardParent;e instanceof t.ContainerCardVE;)e.isCollapsed()&&e.setCollapsed(!1),e=e.cardParent;this.uncullCard()},i.prototype.getChildCards=function(e){return[]},i.prototype.getCardHeight=function(e){return this._cardHeightWatcher?this._cardHeightWatcher.getWatchedValue(e):0},i.prototype.updateCardHeight=function(){var e=this;this._cardHeightRecalcNotifier&&TDB.applyUpdate(function(){return e._cardHeightRecalcNotifier.notify()})},i.prototype.setFocus=function(){this.uncullCard(),this.setSelection(),this.focusableSurrogate.setFocus()},i.prototype.setSelection=function(){var e=window.getSelection(),o=this.getTextEditorElement();if(!o&&StoryApp.Utilities.browser.isEdge&&(o=this.findFirstNode()),o){var i=n.TextHelperMethods.isDescendant(o,e.anchorNode),r=n.TextHelperMethods.isDesendant(t.AuthoringHintVE.HintTextClassName,e.anchorNode);if(!i&&!r){StoryApp.Utilities.removeAllRanges();var a=this._viewModel.isSelectionMode();if(StoryApp.Utilities.browser.isEdge&&!a){var s=document.createRange();s.setStart(o,0),s.setEnd(o,0),e.addRange(s)}}}else StoryApp.Utilities.removeAllRanges()},i.prototype.isFocused=function(){return this.focusableSurrogate.isFocused()},i.prototype.setFocusWhenInDom=function(){this._inDom?this.setFocus():this.setFocusOnDomAttached=!0},i.prototype.uncullCard=function(){this.uncull();for(var e=this.cardParent;e instanceof i;)e.uncull(),e=e.cardParent},i.prototype.calculateCardHeight=function(e){e.watch(this._cardHeightRecalcNotifier);var n=0,o=this.findFirstNode();return o&&(n=$(o).outerHeight(!0)),Math.max(t.CardDeckVE.MinimumCardHeight,n)},i.prototype.onDomAttached=function(){var e=this;this.setFocusOnDomAttached&&(platform.setTimeout(function(){e.setFocus()},0),this.setFocusOnDomAttached=!1),StoryPageEditSettings.StorylineVirtualizationEnabled&&(this.cardsContainer.addTrackedCard(this),TDB.applyUpdate(function(){return e._cardHeightRecalcNotifier.notify()},TDB.Justification.DynamicMenu))},i.prototype.collapsedOrTeaserArgs=function(e){return this._viewModel.areCollapsedOrTeaserMode(e)},i.prototype.hasRTECursor=function(){var e=this.getPrimaryInputElement().domElement;if(e instanceof HTMLElement){var t=TextEditor.Cursor.get_Range();return t&&e===t.getEditableRegion()}return!1},i.prototype.ifSocketLabelArgs=function(){return this.showSocketLabel&&this._viewModel.inSocket()},i.prototype.socketLabelTextArgs=function(e){return this._viewModel.getSocketLabel()},i.prototype.setCardMode=function(e){this._viewModel.setCardMode(e)},i.prototype.isExpanded=function(e){return this._viewModel.calculateCardMode(e)===n.CardMode.Expanded},i.prototype.useExpandedUX=function(e){return this.isExpanded(e)},i.prototype.isExpandedSocketifiedCard=function(){var e=this.getViewModel();return e.isExpanded()&&e.hasSockets()},i.prototype.supportsAltText=function(e){return this._viewModel.supportsAltText(e)},i.prototype.isAncestor=function(e){for(;e;){if(this===e)return!0;e=e.cardParent}return!1},i.prototype.getCardDetailButton=function(){return this.cardDetailButton},i.prototype.isPlaceholderCard=function(){return!1},i.prototype.isEmptySocketCard=function(){return!1},i.prototype.shouldSplitOnPaste=function(){return!1},i.prototype.FocusableInitArgs=function(){return{surrogate:this.focusableSurrogate}},i.areEqual=function(e,t){return e.viewModel===t.viewModel},i.prototype.setRecordingDialogVisibility=function(e){e?this._authoringModel.showRecordingDialog(this):this._authoringModel.hideRecordingDialog()},i.prototype.isGroupCard=function(){return!1},i.prototype.ifCardCopyAvailableArgs=function(e){return this.isActiveItem(e)||this._viewModel.isSelected(e)},i.prototype.cardCopiedFadeVisibleInitArgs=function(){return{transitionIn:"none",transitionOut:"opacity 2s ease-in",visibleInit:!1}},i.prototype.cardCopiedFadeVisibleArgs=function(e){return{visible:this.copied.getWatchedValue(e)}},i.prototype.cardCopiedClassNameArgs=function(e){return this.isExpanded(e)?"GreenCopiedOverlayExpandedCard":"GreenCopiedOverlay"},i.prototype.cardCopiedIconArgs=function(){var e={buttonId:ClientAction.ButtonId.CardDeck_CopiedOverlay,fontIconName:{value:FontIcons.CardCopiedIcon},fontIconSizeClass:FontIcons.CardCopiedIconSize,cssClass:{value:"GreenImageOverlayIcon segoeUISemilight"},description:{value:Resources.Added},textClass:"GreenImageOverlayIconText",text:{value:Resources.CardDeckCopiedOverlay},domFocusable:{value:!1}};return new TDB.ChildArgs(VE.GlyphButtonVE,e)},i.prototype.triggerCopiedOverlay=function(){var e=this;TDB.applyUpdate(function(){return e.copied.setValue(!0)}),platform.setTimeout(function(){TDB.applyUpdate(function(){e.copied.setValue(!1)})},750)},i.prototype.linkButtonClicked=function(){return!1},i.prototype.recordButtonClicked=function(){return!1},i.prototype.canAddAnyContentToParent=function(e){return!(this.parent instanceof EditVE.CardVE)||this.parent.getViewModel().canAddAnyContent(e)},i}(TDB.ControlSet);t.CardVE=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(n){var o=e.View.ViewModel,i=StoryApp.View.ViewElements,r=StoryApp.View.Common.FRE,a=function(a){function s(e,t){var o=a.call(this,e,t)||this;return o.cardType=n.CardType.Heading,o._cardFactory=t.cardFactory,o.isPopup=!1,o.isHeading=!0,o.hideDismissAllHints=TDB.watchableTag(596473741,o,!1),o._viewModel.isSubheading()&&(o.additionalCSSMenuClasses="CardMenuNoPlaceholder"),o.titleArgsWatcher=TDB.watcherTag(596464973,o._viewModel,o,o._viewModel.getTextEditorCreationArgs),o}return __extends(s,a),s.prototype.contentWrapperCssArgs=function(e){var t={},n=this._viewModel.isMultiselected(e),o=this._viewModel.isMenuVisible(e);return t.ContentWrapperMultiselect=n&&o,this._viewModel.isSubheading()?t.PaddingLeftNoPlaceholder=!0:t.PaddingLeftWithPlaceholder=!0,t},s.prototype.getPrimaryTextViewModel=function(e){return this.titleArgsWatcher.getWatchedValue(e).viewModel},s.prototype.getPrimaryInputElement=function(){return this.titleEditor},s.prototype.selectionBarArgs=function(e){return this._viewModel.isRootHeading()?null:a.prototype.selectionBarArgs.call(this,e)},s.prototype.sidebarArgs=function(e){return this._viewModel.isRootHeading()?null:a.prototype.sidebarArgs.call(this,e)},s.prototype.wrapperClassNameArgs=function(e){var t="BasicCard HeadingCard segoeUISemilight";return this._viewModel.isMultiselected(e)&&(t+=" CardMultiselect"),this._viewModel.isSubheading()&&(t+=" SubheadingCard"),t},s.prototype.ifThumbnailPaneArgs=function(){return!this._viewModel.isSubheading()},s.prototype.wrapperDraggableOptionsArgs=function(e){var t=a.prototype.wrapperDraggableOptionsArgs.call(this,e);return t[ControlAttributes.Attributes.Disabled]=ControlAttributes.DisabledState.Disabled,t},s.prototype.ifSelectionOverlayArgs=function(e){return this._viewModel.isSelectionOverlayVisible(e)},s.prototype.ifPlaceholderCardArgs=function(e){return this.placeholderCardVisible(e)},s.prototype.headerIconArgs=function(){var e={fontIconName:{value:FontIcons.CardHeaderIcon},fontIconSizeClass:FontIcons.CardHeaderIconSize,fontIconWrapperClass:{value:"HeadingCardHeaderIcon"}};return new TDB.ChildArgs(i.FontIconVE,e)},s.prototype.titleArgs=function(e){return new TDB.ChildArgs(n.TextUnitEditorVE,this.titleArgsWatcher.getWatchedValue(e))},s.prototype.titleCalloutArgs=function(e){var t=r.CalloutID.SwayTitle;if(this._viewModel.isRootHeading()&&r.getCalloutManager().isActiveCallout(e,t))return new TDB.ChildArgs(i.FRECalloutVE,r.CalloutArgsCreator.createArgsForSwayTitle())},s.prototype.ifTitleWrapperArgs=function(e){return!this._viewModel.inTeaserMode(e)},s.prototype.placeholderCardArgs=function(e){var t="HeadingCardBackgroundPlaceholder";this._viewModel.inTeaserMode(e)&&this._viewModel.hasText(e)&&(t+=" HeaderFullTeaser");var o={fontIconName:this._viewModel.inTeaserMode(e)?FontIcons.CardHeaderIcon:FontIcons.ImagePlaceholderIcon,fontIconSizeClass:this._viewModel.inTeaserMode(e)?FontIcons.CardHeaderIconSize:FontIcons.PlaceholderIconSize,fontIconClass:"HeadingCardBackgroundPlaceholderIcon",text:{compute:new TDB.ComputedOptionArgs(this,this.backgroundPlaceholderText)},description:{compute:new TDB.ComputedOptionArgs(this,this.backgroundPlaceholderDescription)},css:t,context:this,clicked:this.backgroundPlaceholderClicked,tabIndex:n.CardElementTabIndex.Teaser,fileuploader:this._authoringModel.fileUploader},i=this._cardFactory.createPlaceholderCardArgs({cardParent:this,attributes:o,viewModel:this._viewModel.getPlaceholderCardViewModel()});return new TDB.ChildArgs(n.PlaceholderCardVE,i)},s.prototype.getPlaceholderCard=function(){return this._placeholderCard},s.prototype.placeholderCardVisible=function(e){return this._viewModel.isPlaceholder(e)},s.prototype.isPlaceholderHighlighted=function(e,t){var o=e===this.cardsContainer.getActivePlaceholder(t)&&!this.backgroundCardArgs(t),i=this.paneStateManager.getPaneVisible(n.AuthoringPaneType.Content,t);return o&&i},s.prototype.backgroundCardArgs=function(e){if(this._viewModel.hasValidModel()&&this._viewModel.hasBackground(e)&&!this._viewModel.isExpanded(e))return this._cardFactory.createArgs({viewModel:this._viewModel.getBackgroundViewModel(e),cardParent:this})},s.prototype.backgroundWrapperCssArgs=function(e){return{ThumbnailFrame:!this._viewModel.hasBackground(e)}},s.prototype.backgroundPlaceholderClicked=function(e){var t=this;return ActionLogger.RecordClientAction(new ClientAction.StorylinePlaceholderClickedData("Heading placeholder clicked",[this._viewModel.getModelId()],[n.CardType[this.cardType]],[o.CardMode[this._viewModel.getCardMode()]])),TDB.applyUpdate(function(){n.ShowAddContentAction.execute(null,{paneStateManager:t.paneStateManager,cardsContainer:t.cardsContainer,sourceCardType:n.CardType.Heading})}),this.paneStateManager.activateAddContentPane(),TDB.EventPropagation.Bypass},s.prototype.backgroundPlaceholderText=function(e){return this._viewModel.inTeaserMode(e)?Resources.CardDeckHeadingLabel:this.paneStateManager.getPaneVisible(n.AuthoringPaneType.Content,e)?Resources.CardDeckImagePlaceholderDragText:Resources.CardDeckBackgroundPlaceholderText},s.prototype.backgroundPlaceholderDescription=function(e){return this.paneStateManager.getPaneVisible(n.AuthoringPaneType.Content,e)?Resources.CardDeckImagePlaceholderDragText:Resources.CardDeckBackgroundPlaceholderDescription},s.prototype.handleShortcutKey=function(t){var n=this,o=this.titleEditor;if(o){var i=o.isFocused();if(t.keyCode==KeyCodeType.EnterKey&&i)return e.Model.currentUndoManager().get(this.pageId).captureUserUpdate(function(){o.commit()},"User hit Enter on a heading card"),e.Model.currentUndoManager().get(this.pageId).captureUserUpdate(function(){var e=n._viewModel.createTextCardUnderHeading();platform.setTimeout(function(){e.setFocusToText(!0)},0)},"User hit Enter and created a new text card"),r.FirstRunTriggers.jackClicked(),TDB.EventPropagation.PreventDefault;this.isRootHeading()&&s.isPrintableCharacter(t.which||t.keyCode)&&r.FirstRunTriggers.swayTitleAdded(!1)}return a.prototype.handleShortcutKey.call(this,t)},s.isPrintableCharacter=function(e){return!(e==KeyCodeType.BackspaceKey||e==KeyCodeType.TabKey||e==KeyCodeType.EnterKey||e==KeyCodeType.ShiftKey||e==KeyCodeType.CtrlKey||e==KeyCodeType.AltKey||e==KeyCodeType.EscapeKey||e==KeyCodeType.SpaceKey||e==KeyCodeType.EndKey||e==KeyCodeType.HomeKey||e==KeyCodeType.LeftArrowKey||e==KeyCodeType.UpArrowKey||e==KeyCodeType.RightArrowKey||e==KeyCodeType.DownArrowKey||e==KeyCodeType.InsertKey||e==KeyCodeType.DeleteKey||e==KeyCodeType.OSKey||e==KeyCodeType.ContextMenuKey||e==KeyCodeType.PageUpKey||e==KeyCodeType.PageDownKey||e==KeyCodeType.NumLockKey||e==KeyCodeType.ScrollLockKey||e==KeyCodeType.PauseBreakKey||e>=KeyCodeType.F1Key&&e<=KeyCodeType.F12Key)},s.prototype.getChildCards=function(e){return this.backgroundCardArgs(e),this._viewModel.areCollapsedOrTeaserMode(e)?this.backgroundCard?[this.backgroundCard]:[]:this.cardExpandedView?this.cardExpandedView.getChildCards(e):[]},s.prototype.childAcceptDraggables=function(e,t){return!1},s.prototype.isSelectable=function(e){return!this._viewModel.isRootHeading()},s.prototype.canBeDeleted=function(){return!this._viewModel.isRootHeading()},s.prototype.setFocusToText=function(e){void 0===e&&(e=!1);var t=this.titleEditor;e?t.setFocusToEnd():t.setFocus()},s.prototype.getTextEditorElement=function(){var e=this.titleEditor;if(e&&t.ViewModel.TextHelperMethods.isNodeInDOM(e.element))return e.element},s.prototype.labelText=function(e){return this.cardLabelDefaultText},s.prototype.areDescendantsVisible=function(e){return this.isVisible(e)&&this.cardParent.areDescendantsVisible(e)},s.prototype.isCollapsed=function(e){return a.prototype.isCollapsed.call(this,e)},s.prototype.hideJack=function(e){return!(!this.jackHidden||!this.jackHidden.getWatchedValue(e))||a.prototype.hideJack.call(this,e)},s.prototype.isRootHeading=function(){return this._viewModel.isRootHeading()},s.prototype.cardLabelWrapperTouchToMouseArgs=function(e){return{enabled:!0}},s.prototype.cardModeArgs=function(e){return this._viewModel.calculateCardMode(e)},s.prototype.wrapperCssArgs=function(e){var t=a.prototype.wrapperCssArgs.call(this,e),n=this._viewModel.calculateCardMode(e)===o.CardMode.Expanded;return t.BasicCard=t.BasicCard&&!n,t.ExpandedSocketifiedCard=t.ExpandedSocketifiedCard||n,t.DraggableCard=t.DraggableCard&&!this._viewModel.isRootHeading(),t},s.prototype.authoringHintTextArgs=function(e){return Resources.CreateOutlineDismissAllHintsMessage},s.prototype.ifHintDismissAllArgs=function(e){return this._viewModel.isRootHeading()&&!this.hideDismissAllHints.getWatchedValue(e)&&this._viewModel.hintsAvailable(e)},s.prototype.supportsExpandedMode=function(e){return!!this.isRootHeading()||a.prototype.supportsExpandedMode.call(this,e)},s.prototype.closeButtonArgs=function(e){var t=this;if(this._viewModel.isMenuVisible(e)){var n={buttonId:ClientAction.ButtonId.EditImagePane_Close,click:function(e){return TDB.applyUpdate(function(){t.hideDismissAllHints.setValue(!0)}),TDB.EventPropagation.Bypass},context:this,cssClass:{value:"HintCloseButtonHeading"},description:{value:ResourceManager.ResolveString(Resources.ClosePaneButtonDescription,[Resources.FocusPaneTitle])},fontIconName:{value:FontIcons.ClosePaneIcon},fontIconSizeClass:FontIcons.ClosePaneIconSize};return new TDB.ChildArgs(i.GlyphButtonVE,n)}},s.prototype.dismissAllButtonArgs=function(){var t=this,n={context:this,click:function(n){return e.Model.currentUndoManager().get(t.pageId).captureUserUpdate(function(){t._viewModel.clearAllHints()},"User dissmised all hints"),TDB.EventPropagation.Bypass},cssClass:{value:"AuthoringHintDismissAllButton segoeUI"},buttonId:ClientAction.ButtonId.CreateOutline_DismissAll,text:{value:Resources.CreateOutlineDismissAllHintsButtonText},tooltip:{value:Resources.CreateOutlineDismissAllHintsButtonText},description:{value:Resources.CreateOutlineDismissAllHintsButtonText}};return new TDB.ChildArgs(i.TextButtonVE,n)},s}(n.CardVE);n.ComplexHeadingCardVEBase=a}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel,o=function(e){function o(t,n){var o=e.call(this,t,n)||this;return o.cardSelectionManager=n.cardSelectionManager,o._cardFactory=n.cardFactory,o._hasHeaderIcon=n.hasHeaderIcon?n.hasHeaderIcon:o._hasHeaderIcon,o._containerHeaderVisible=n.containerHeaderVisible?n.containerHeaderVisible:o._containerHeaderVisible,o._authoringModel=n.authoringModel?n.authoringModel:o._authoringModel,o.createHeaderMenuItem(),o}return __extends(o,e),o.prototype.getViewModel=function(){return this._viewModel},o.prototype.getCardCollapsedStateDescription=function(e){return this._viewModel.isCollapsed(e)?Resources.CollapsedStateGroupDescription:Resources.ExpandedStateGroupDescription},o.prototype.createDraggingHelper=function(t){return this.wasCollapsedBeforeDragging=this.isCollapsed(),this.setCollapsed(!0,!1),e.prototype.createDraggingHelper.call(this,t)},o.prototype.contentWrapperSlideVisibleArgs=function(e){var n=this.animateWhileCollapsing;return this.animateWhileCollapsing=!0,{visible:this instanceof t.GroupCardVE||!this.isCollapsed(e),duration:n?void 0:0}},o.prototype.ifSelectionOverlayArgs=function(e){return this._viewModel.isSelectionOverlayVisible(e)},o.prototype.createHeaderMenuItem=function(){var e={headerParent:this,labelText:TDB.watcherTag(596465674,this._viewModel,this,this._viewModel.getLabel),labelGlyph:this._hasHeaderIcon?TDB.watcherTag(596465675,this,this,this.getGlyph):void 0,labelFontIcon:this._hasHeaderIcon?TDB.watcherTag(596465676,this,this,this.getFontIcon):void 0};this.headerButton=new VE.StaticMenuItem({primaryType:t.ContainerCardHeaderButtonVE,primaryArgs:e,viewElementVisible:this._containerHeaderVisible})},o.prototype.headerArgs=function(){var e={authoringModel:this._authoringModel,cardSelectionManager:this.cardSelectionManager,visible:this._containerHeaderVisible,buttonArgs:this.headerButton.getPrimaryArgs()};return new TDB.ChildArgs(t.ContainerCardHeaderVE,e)},o.prototype.getHeaderButton=function(e){return this.containsHeader(e)?this.headerButton:void 0},o.prototype.hideJack=function(t){return this._viewModel.bottomTweenerActive.getWatchedValue(t)||e.prototype.hideJack.call(this,t)},o.prototype.stackWrapperCssArgs=function(e){return{CardStackWrapperHidden:!this._viewModel.isCollapsed(e)}},o.prototype.stackBottomFakeCardCssArgs=function(e){return{CardStackFakeCardHidden:!this._viewModel.isCollapsed(e)}},o.prototype.stackTopFakeCardCssArgs=function(e){return{CardStackFakeCardHidden:!this._viewModel.isCollapsed(e)}},o.prototype.getGlyph=function(e){throw StoryApp.RethrowLogger.createError("getGlyph should be overriden by our subclasses")},o.prototype.getFontIcon=function(e){throw StoryApp.RethrowLogger.createError("getFontIcon should be overriden by our subclasses")},o.prototype.getLastChild=function(){return ArrayExtensions.lastOrDefault(this.getChildCards())},o.prototype.resetCollapsed=function(){this.setCollapsed(!!this.wasCollapsedBeforeDragging)},o.prototype.setCollapsed=function(e,t){var o=this;void 0===t&&(t=!0),e!=this.isCollapsed()&&(this.animateWhileCollapsing=t,TDB.applyUpdate(function(){o._viewModel.setCardMode(e?n.CardMode.Collapsed:n.CardMode.Expanded)}),this.cardsContainer.computeCardDeckElements())},o.prototype.setCollapsedRecursive=function(e,t){void 0===t&&(t=!0),this.setCollapsed(e,t),this.parent instanceof o&&this.parent.setCollapsedRecursive(e,t)},o.prototype.areDescendantsVisible=function(e){return this.isVisible(e)&&!this.isCollapsed(e)&&this.cardParent.areDescendantsVisible(e)},o.prototype.onCollapse=function(){var e=this,o=this.getViewModel().isCollapsed(),i=new ClientAction.StorylineActionData(ClientAction.ActionType.Storyline_CollapseClicked,"Collapse button clicked",[this.getViewModel().getModelId()],[t.CardType[this.cardType]]);i.setContext({Collapsed:!o}),ActionLogger.RecordClientAction(i),this.activateItem(),TDB.applyUpdate(function(){e.getViewModel().setCardMode(o?n.CardMode.Expanded:n.CardMode.Collapsed)}),this.cardsContainer.computeCardDeckElements()},o.prototype.handleShortcutKey=function(t){return(t.keyCode===KeyCodeType.EnterKey||t.keyCode===KeyCodeType.LeftArrowKey&&!this._viewModel.isCollapsed()||t.keyCode===KeyCodeType.RightArrowKey&&this._viewModel.isCollapsed())&&this.isFocused()?(this.onCollapse(),TDB.EventPropagation.PreventDefault):e.prototype.handleShortcutKey.call(this,t)},o.prototype.isRootHeading=function(){return!1},o.prototype.isContainerCard=function(){return!0},o.prototype.calculateCardHeight=function(n){var o=e.prototype.calculateCardHeight.call(this,n),i=this._viewModel.isCollapsed(n),r=this.getChildCards(n).reduce(function(e,o){var i=o.getCardHeight(n);return o instanceof t.ComplexHeadingCardVE?e:e+i},0);return i?t.CardDeckVE.CollapsedCardHeight:o>t.CardDeckVE.MinimumCardHeight?o:o+r},o.prototype.useExpandedUX=function(e){return!this.isCollapsed(e)},o.prototype.getContentCards=function(e){return this.contentCards.getChildren(e)},o}(t.CardVE);t.ContainerCardVE=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(t){function n(e,n){var o=t.call(this,e,n)||this;return o.acceptedTransformText=TDB.watchableTag(596473731,o,""),o.fileuploader=n.authoringModel.fileUploader,o}return __extends(n,t),n.prototype.innerWrapperStyleArgs=function(e){return{opacity:this._viewModel.isDragging(e)?"0":void 0}},n.prototype.contentWrapperCssArgs=function(e){var t=this._viewModel.isMultiselected(e),n=this._viewModel.isMenuVisible(e);return{ContentWrapperMultiselect:t&&n}},n.prototype.dropTargetOverlayArgs=function(){var t={context:this,acceptDraggable:this.overlayAcceptDraggable,drop:this.overlayDrop,getOverlayText:this.overlayText,zOrder:this.cardNestingLevel,fileUploader:this.fileuploader,cardDragHandler:this.cardDragHandler,expandable:!1};return new TDB.ChildArgs(e.CardDropTargetOverlayVE,t)},n.prototype.getTweener=function(){return this._tweener},n.prototype.ifShowTweenerArgs=function(){return!this.getViewModel().inSocket()},n.prototype.tweenerArgs=function(){var t=this._viewModel.createTweenerArgs();return new TDB.ChildArgs(e.TweenerVE,t)},n.prototype.hideJack=function(e){return this._viewModel.tweenerActive.getWatchedValue(e)||t.prototype.hideJack.call(this,e)},n.prototype.ifSelectionOverlayArgs=function(e){return this._viewModel.isSelectionOverlayVisible(e)},n.prototype.overlayAcceptDraggable=function(e){var t=this;if(!this._viewModel.acceptDraggable(e))return!1;var n=this._viewModel.getTransformOptionForDraggable(e);return n&&TDB.applyUpdate(function(){t.acceptedTransformText.setValue(n.dropZoneText)}),void 0!=n},n.prototype.overlayDrop=function(e){this._viewModel.createGroup(e)},n.prototype.overlayText=function(e){return e.watchValue(this.acceptedTransformText)},n.prototype.textOverlayVisibleArgs=function(e){return!this._viewModel.isDragging(e)},n.prototype.overlayLabelTextArgs=function(e){return this.cardLabelDefaultText},n}(e.CardVE);e.ContentCardVE=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(n){function o(t,o){var i=this;return o.cardLabelText=Resources.ChartCardStorylineDescription,i=n.call(this,t,o)||this,i.cardType=e.CardType.Agave,i}return __extends(o,n),o.prototype.agaveInfoMessageTextArgs=function(e){return Resources.ChartInfoMessage.split("{0}")[0]},o.prototype.agaveJumpLinkArgs=function(){var e={buttonId:ClientAction.ButtonId.Card_Chart_PreviewEdit,click:this.onJumpLinkClick,context:this,cssClass:{value:"AgaveMessageLink"},tooltip:{value:ResourceManager.ResolveString(Resources.ChartInfoMessage,[Resources.ChartInfoMessageLink])},description:{value:ResourceManager.ResolveString(Resources.ChartInfoMessage,[Resources.ChartInfoMessageLink])},text:{value:Resources.ChartInfoMessageLink}};return new TDB.ChildArgs(t.TextButtonVE,e)},o.prototype.agaveInfoMessagePostfixTextArgs=function(e){return Resources.ChartInfoMessage.split("{0}")[1]},o.prototype.onJumpLinkClick=function(e){return this._viewModel.navigateToContent("AgaveVE:onJumpLinkClick"),TDB.EventPropagation.Bypass},o.prototype.agaveIconArgs=function(){var e={fontIconName:{value:FontIcons.ChartCardPlaceholderIcon},fontIconSizeClass:FontIcons.PlaceholderIconSize,fontIconWrapperClass:{value:"OverlayIconText"}};return new TDB.ChildArgs(t.FontIconVE,e)},o.prototype.imageWrapperTouchToMouseArgs=function(e){return{enabled:!0}},o.prototype.ifOverlayLabelArgs=function(e){return this._viewModel.inTeaserMode(e)},o}(e.ContentCardVE);e.AgaveCardVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(t){function n(n,o){var i=this;return o.cardLabelText=Resources.TableCardStorylineDescription,i=t.call(this,n,o)||this,i.cardType=e.CardType.Table,i._cardFactory=o.cardFactory,i}return __extends(n,t),n.prototype.tableInfoMessageTextArgs=function(e){return Resources.TableCardStorylineMessage},n.prototype.imageWrapperTouchToMouseArgs=function(e){return{enabled:!0}},n.prototype.ifOverlayLabelArgs=function(e){return this._viewModel.inTeaserMode(e)},n.prototype.imageRepresentationCardArgs=function(e){return this._cardFactory.createArgs({viewModel:this._viewModel.getImageRepresentationViewModel(e),cardParent:this})},n}(e.ContentCardVE);e.TableCardVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements.MonacoEditorVE,o=function(o){function i(e,n){var i=this;return n.cardLabelText=Resources.CodeCardLabel,i=o.call(this,e,n)||this,i.cardType=t.CardType.Code,i.additionalCSSMenuClasses="CardMenuNoPlaceholder",i.args=n,i}return __extends(i,o),i.prototype.wrapperStyleArgs=function(e){var t=o.prototype.wrapperStyleArgs.call(this,e);return t.height=i.cardHeight+"px",t},i.prototype.editorArgs=function(){var t=this,o=this._viewModel.getCodeModel();return new TDB.ChildArgs(n,{resourceFactory:this.args.resourceFactory,getCode:function(e){return o.getCode(e)},getLanguage:function(e){return o.getLanguage(e)},setCode:function(n){e.Model.currentUndoManager().get(t.pageId).captureUserUpdate(function(){return o.setCode(n)},"Updating Monaco code")},isReadOnly:!1,scrollbarsEnabled:!0,scrollBeyondLastLine:!1})},i.prototype.codeMenuArgs=function(){var n=this,o=this._viewModel.getCodeModel();return new TDB.ChildArgs(t.CodeMenuVE,{getLanguage:function(e){return o.getLanguage(e)},setLanguage:function(t){e.Model.currentUndoManager().get(n.pageId).captureUserUpdate(function(){o.setLanguage(t),n.editor.setLanguage(t)},"Updating Monaco language")}})},i.prototype.ifTeaserOverlayArgs=function(e){return this._viewModel.inTeaserMode(e)},i.prototype.placeholderIconArgs=function(){var e={fontIconName:{value:FontIcons.CardTextIcon},fontIconSizeClass:FontIcons.CardTextIconSize,fontIconWrapperClass:{value:"OverlayIconWrapper"}};return new TDB.ChildArgs(VE.FontIconVE,e)},i.prototype.ifPlaceholderArgs=function(e){return this._viewModel.inPlaceholderMode(e)},i.prototype.overlayCssArgs=function(e){return{PlaceholderCard:this._viewModel.inPlaceholderMode(e),TextCardTeaserOverlay:!this._viewModel.inPlaceholderMode(e)}},i.prototype.textOverlayClassNameArgs=function(e){return this.cardParent.isPopup?t.TextCardVE.PopupTextOverlayClassName:""},i.prototype.cardLabelWrapperTouchToMouseArgs=function(e){return{enabled:!0}},i.cardHeight=140,i}(t.ContentCardVE);t.CodeCardVEBase=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(n){function o(t,o){var i=this;return o.cardLabelText=Resources.CardDeckEmbedLabel,i=n.call(this,t,o)||this,i._mediaCardErrorOkButtonCss=TDB.watchableTag(596473730,i,"MediaCardErrorOkButtonCentered"),i.cardType=e.CardType.Embed,i}return __extends(o,n),o.prototype.embedMessageInfoArgs=function(e){var n=this._viewModel.getEmbedMessageInfoArray(e);return n&&0!==n.length?n.map(function(e){return e.message?new TDB.ChildArgs(t.SpanMessageVE,e):new TDB.ChildArgs(t.LinkButtonVE,e)}):[]},o.prototype.creatingEmbedLinkTextArgs=function(e){return Resources.EmbedCreatingLinkMessage},o.prototype.creatingEmbedLinkStyleArgs=function(e){return this.setDisplayStyleUploadStatusHelper(e,"block","none","block")},o.prototype.textAreaArgs=function(){var e={placeholder:Resources.EmbedPlaceholderText,cssClass:"EmbedCardHTMLCode",rows:"2",context:this,setValue:this.setHTMLCode,getValue:this.getHTMLCode,telemetryId:ClientAction.ButtonId.Embed_TextField,style:{display:this._viewModel.hasUploadInfo()?"none":"block"}};return new TDB.ChildArgs(t.TextAreaVE,e)},o.prototype.ifErrorMessageArgs=function(e){return this._viewModel.isInvalidMessageVisible(e)},o.prototype.errorMessageArgs=function(e){var n={cssClass:"MediaCardErrorText",text:this._viewModel.invalidMessageTextArgs(e)};return new TDB.ChildArgs(t.TextBlockVE,n)},o.prototype.mediaCardErrorWrapperAttrArgs=function(e){var t=n.prototype.mediaCardErrorWrapperAttrArgs.call(this,e);return t[Aria.Attributes.Label]=this._viewModel.invalidMessageTextArgs(e),t},o.prototype.mediaCardErrorOkButtonArgs=function(e){if(this._viewModel.isConversionFailureVisible(e)){var n={id:"mediaCardErrorOkButton",buttonId:ClientAction.ButtonId.Embed_DismissErrorMessage,click:this.dismissErrorMessage,cssClass:{watchable:this._mediaCardErrorOkButtonCss},context:this,text:{value:Resources.ButtonOK}};return new TDB.ChildArgs(t.TextButtonVE,n)}return null},o.prototype.mediaCardErrorWrapperHeightWatcherInitArgs=function(){return this.updateHeight},o.prototype.updateHeight=function(e){var t=this;if(this._errorMessage){var n=$(this._errorMessage.findFirstNode());n&&0!==n.length&&TDB.applyUpdate(function(){t._mediaCardErrorOkButtonCss.setValue(n.height()>=1.5*parseFloat(n.css("line-height"))?"MediaCardErrorOkButtonBottomAligned":"MediaCardErrorOkButtonCentered")})}},o.prototype.labelText=function(e){return this._viewModel.getLabelText(e)},o.prototype.ifOverlayLabelArgs=function(e){return this._viewModel.inTeaserMode(e)},o.prototype.viewEmbedCodeTextArgs=function(e){return Resources.EmbedOneDriveViewEmbedCode},o.prototype.viewEmbedCodeEventsInitArgs=function(){return{click:this.showEmbedCode}},o.prototype.showEmbedCode=function(e){var t=this;return this._viewModel.logEmbedCodeClick(),TDB.applyUpdate(function(){t._textAreaVE.setStyle({display:"block"})}),!1},o.prototype.viewEmbedCodeStyleArgs=function(e){return this._viewModel.isEmbedCodeVisible(e)?{display:"inline"}:{display:"none"}},o.prototype.embedDocumentImageOrSpinnerStyleArgs=function(e){return this._viewModel.isConvertingToNativeCard(e)||this._viewModel.isUploading(e)?{backgroundImage:"url('"+CommonSettings.ContentBaseUrl+"whitespinner.32x32.gif')"}:{backgroundImage:""}},o.prototype.embedDocumentImageOrSpinnerCssArgs=function(e){var t={};return t[this._viewModel.embedDocumentClassName()]=!this.ifErrorMessageArgs(e),t.EmbedCode=""!==this.getHTMLCode(e),t.PlaceholderCard=!this._viewModel.isUploading(e)&&!this.getHTMLCode(e)&&!this.ifErrorMessageArgs(e),t},o.prototype.ifThumbnailOverlayArgs=function(e){return this._viewModel.isUploading(e)||this.ifErrorMessageArgs(e)},o.prototype.placeholderIconArgs=function(e){if(!this._viewModel.isUploading(e)){var n={fontIconName:{value:this._viewModel.embedDocumentFontIconName()},fontIconSizeClass:FontIcons.EmbedPlaceholderIconSize,fontIconWrapperClass:{value:"EmbedDocumentFontIconWrapper"}};return new TDB.ChildArgs(t.FontIconVE,n)}return null},o.prototype.setHTMLCode=function(e){this._viewModel.setEmbedCode(e)},o.prototype.getHTMLCode=function(e){return this._viewModel.getEmbedCodeWithoutPrefix(e)},o.prototype.setDisplayStyleUploadStatusHelper=function(e,t,n,o){return{display:this._viewModel.selectStyleForStatus(e,t,n,o)}},o.prototype.dismissErrorMessage=function(e){return this._viewModel.acknowledgeConversionFailure(),TDB.EventPropagation.Bypass},o.prototype.imageWrapperTouchToMouseArgs=function(e){return{enabled:!0}},o.prototype.getTextArea=function(){return this._textAreaVE},o}(e.ContentCardVE);e.EmbedCardVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel;t.MaxTitleLength=40;var o=function(e){function o(n,o){var i=this;return o.containerHeaderVisible={compute:new TDB.ComputedOptionArgs(o.viewModel,o.viewModel.headerVisible)},i=e.call(this,n,o)||this,i.cardType=t.CardType.Group,i._placeholderVisible=TDB.watcherTag(596473687,i,i,i.isPlaceholderVisible),i.headingCard=TDB.watcherOwnerTag(596473688,i._viewModel,i,i._viewModel.calculateHeadingCard),i}return __extends(o,e),o.prototype.isFocusable=function(e){return this._viewModel.getModel().getHeading(e)&&!this._viewModel.isRootGroup()},o.prototype.getViewModel=function(){return this._viewModel},o.prototype.containsHeader=function(e){return!this.ifTeaserModeArgs(e)},o.prototype.isPlaceholderVisible=function(e){return this.isCollapsed(e)},o.prototype.wrapperStyleArgs=function(t){var n=e.prototype.wrapperStyleArgs.call(this,t);return n.marginTop=this._viewModel.isRootGroup()?"0px":"7px",StoryApp.Utilities.ipad&&StoryApp.Utilities.safari&&!StoryApp.Utilities.chrome&&(n.opacity=void 0,n.visibility=this._viewModel.isDragging(t)?"hidden":"visible"),n},o.prototype.placeholderCardArgs=function(){var e={fontIconName:FontIcons.ContentPlaceholderIcon,fontIconSizeClass:FontIcons.PlaceholderIconSize,fontIconClass:"ContainerCardPlaceholderIcon",placeholderVisible:{watchable:this._placeholderVisible},text:{value:Resources.CardDeckContentPlaceholderText},description:{value:Resources.CardDeckContentPlaceholderText},context:this,clicked:this.placeholderClicked,fileuploader:this._authoringModel.fileUploader},n=this._cardFactory.createPlaceholderCardArgs({attributes:e,viewModel:this._viewModel.getPlaceholderCardViewModel(),cardParent:this});return new TDB.ChildArgs(t.PlaceholderCardVE,n)},o.prototype.wrapperCssArgs=function(t){var n=e.prototype.wrapperCssArgs.call(this,t),o=this._viewModel.isCollapsed(t);return n.BasicCard=o,n.GroupCardCollapsed=o,n.GroupCardWithPaddingBottom=this._viewModel.getHeading(t)&&!o,n},o.prototype.wrapperDraggableOptionsArgs=function(t){return this._viewModel.isRootGroup()?{disabled:"true"}:e.prototype.wrapperDraggableOptionsArgs.call(this,t)},o.prototype.ifStackWrapperArgs=function(e){return!!this.headingCard.getWatchedValue(e)},o.prototype.ifSelectionOverlayArgs=function(e){return!1},o.prototype.stackWrapperStyleArgs=function(e){return{float:this._viewModel.isCollapsed(e)?CommonSettings.SiteUiRtl?"right":"left":void 0,display:this.isCollapsed(e)&&this.cardNestingLevel>=3?"none":void 0}},o.prototype.headingCardArgs=function(){return this.headingCard},o.prototype.contentWrapperSlideVisibleInitArgs=function(){return!0},o.prototype.contentWrapperCssArgs=function(e){return{GroupCardContentCollapsed:this._viewModel.isCollapsed(e)}},o.prototype.bottomTweenerWrapperCssArgs=function(e){return{BottomTweenerWrapper:!this._viewModel.isCollapsed(e)}},o.prototype.topTweenerArgs=function(e){if(this.headingCard.getWatchedValue(e))return new TDB.ChildArgs(t.TweenerVE,this._viewModel.getTopTweenerArgs())},o.prototype.contentCardsArgs=function(e){return this._viewModel.createCardArgs(e)},o.prototype.dropTargetOverlayArgs=function(e){if(this._viewModel.isCollapsed(e)){var n={context:this,acceptDraggable:this.overlayAcceptDraggable,drop:this.overlayDrop,zOrder:this.cardNestingLevel,fileUploader:this._authoringModel.fileUploader,cardDragHandler:this.cardDragHandler,expandable:!0};return new TDB.ChildArgs(t.CardDropTargetOverlayVE,n)}},o.prototype.getChildCards=function(e){var t=this.getContentCards(e).slice(),n=this.headingCard.getWatchedValue(e);return n&&!n.disposed&&t.splice(0,0,n),t},o.prototype.childAcceptDraggables=function(e,t){return!0},o.prototype.acceptDraggables=function(e){return this.isCollapsed()},o.prototype.firstRunJackHintArgs=function(e){return this._viewModel.getFirstRunJackHint(e)},o.prototype.overlayAcceptDraggable=function(e){return!!this._viewModel.acceptDraggable(e)&&this._viewModel.overlayAcceptDraggable(e)},o.prototype.overlayDrop=function(e){this._viewModel.addViewElements(e)},o.prototype.placeholderClicked=function(e){var o=this;return ActionLogger.RecordClientAction(new ClientAction.StorylinePlaceholderClickedData("Group placeholder clicked",[this._viewModel.getModelId()],[t.CardType[this.cardType]],[n.CardMode[this._viewModel.getCardMode()]])),TDB.applyUpdate(function(){t.ShowAddContentAction.execute(null,{paneStateManager:o.paneStateManager,cardsContainer:o.cardsContainer})}),this.paneStateManager.activateAddContentPane(),TDB.EventPropagation.Bypass},o.prototype.ifTeaserModeArgs=function(e){return this.getViewModel().inTeaserMode(e)&&StoryPageEditSettings.SubHeadingsEnabled},o.prototype.thumbnailLabelTextArgs=function(e){return this.getViewModel().getThumbnailLabel(e)},o.prototype.thumbnailIconTextTextArgs=function(e){return this.getViewModel().getHeadingPositionPrefix(e)},o.prototype.thumbnailWrapperCssArgs=function(e){return{PlaceholderCard:!this.getViewModel().hasContent(e)}},o.prototype.ifImageArgs=function(e){return this.getViewModel().hasThumbnailImage(e)},o.prototype.imageAttrArgs=function(e){return this.getViewModel().getImageAttributes(e)},o.prototype.bottomTweenerArgs=function(e){var n=this.getViewModel();if(!n.isRootGroup()){var o=this._viewModel.getBottomTweenerArgs();return n.getHeading(e)||(o.clickable=!1),new TDB.ChildArgs(t.TweenerVE,o)}},o.prototype.isGroupCard=function(){return!0},o.prototype.hideJack=function(t){return!this.getViewModel().getModel().getHeading()||e.prototype.hideJack.call(this,t)},o.prototype.canEnter=function(){return e.prototype.canEnter.call(this)&&!this._viewModel.isRootGroup()},o}(t.ContainerCardVE);t.GroupCardVEBase=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.View.ViewModel,i=function(e){function t(t,n){var o=e.call(this,t)||this;return o.parent=t,o._viewModel=n.viewModel,o._labelText=n.labelText,o._cardMode=n.cardMode||TDB.watchableTag(596473684,o.parent,o._viewModel.calculateCardMode(void 0)),o}return __extends(t,e),t.prototype.ifUploadingPlaceholderArgs=function(e){return this._viewModel.isUploadingPlaceholderVisble(e)},t.prototype.ifThumbnailPaneBackgroundArgs=function(e){return this._viewModel.isImageVisble(e)&&!this._viewModel.isUploadingPlaceholderVisble(e)},t.prototype.uploadingSpinnerStyleArgs=function(e){return this._viewModel.isWaitingForAugmentation(e)||!o.UploadManager.getInstance().getUploadController(this._viewModel.getModelId(),e)?{backgroundImage:"url('"+Icons.UploadingSpinner+"')"}:{}},t.prototype.imageAttrArgs=function(e){if(this._viewModel.isWaitingForAugmentation(e))return{src:"",alt:"",role:Aria.Roles.Presentation};var t=""===this._viewModel.getImageSource(e)?Aria.Roles.Presentation:void 0;return{src:this._viewModel.getImageSource(e),alt:this._viewModel.createAltText(e),role:t}},t.prototype.imageStyleArgs=function(e){return{"max-height":this._viewModel.getImageMaxHeight(e)+"px","background-color":this.ifUploadingPlaceholderArgs(e)?"":"white"}},t.prototype.imageDivAttrArgs=function(e){return{"aria-label":this._viewModel.createAltText(e)}},t.prototype.imageDivStyleArgs=function(e){return{backgroundImage:this._viewModel.isWaitingForAugmentation(e)?"":"url('"+this._viewModel.getImageSource(e)+"')","max-height":this._viewModel.getImageMaxHeight(e).toString()+"px","background-color":this.ifUploadingPlaceholderArgs(e)?"":"rgb(33, 33, 33)"}},t.prototype.imageEventsInitArgs=function(){var e=this,t={};return this.parent.getViewModel().inSocket()&&(t.dragstart=function(e){return e.preventDefault(),!1}),t.error=function(t){return TDB.applyUpdate(function(){e._viewModel.thumbnailFailedToLoad.setValue(!0)}),!0},t.load=function(t){return TDB.applyUpdate(function(){e._viewModel.thumbnailFailedToLoad.setValue(!1)}),!0},t},t.prototype.thumbnailPaneBackgroundStyleArgs=function(e){return{"margin-top":this._viewModel.getImageMaxHeight(e).toString()+"px"}},t.prototype.ifSupportsObjectFitArgs=function(){return"objectFit"in document.body.style},t.prototype.ifImageArgs=function(e){return this._viewModel.isImageVisble(e)},t.prototype.ifOverlayIconArgs=function(e){return!this.ifUploadingPlaceholderArgs(e)},t.prototype.overlayIconArgs=function(){return this._viewModel.getOverlayIcon(this)},t.prototype.ifOverlayLabelArgs=function(e){var t=this._viewModel.getMedia(),i=this._cardMode.getWatchedValue(e)===o.CardMode.Teaser;return this.parent.cardParent.isHeading?!this.parent.cardParent.isRootHeading()&&i:!(t instanceof n.ImageContent)&&i},t.prototype.overlayLabelTextArgs=function(e){return this._labelText},t.prototype.wrapperCssArgs=function(e){return{MediaCardImageSocketWrapper:this.parent.getViewModel().inSocket()}},t}(TDB.FocusableViewElement);t.MediaCardImageVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(n){var o=e.View.ViewModel,i=StoryApp.View.ViewElements,r=e.View.Common.MediaCardToEmbedCardConversionValidator,a=e.View.Common.MediaCardToEmbedCardConverter,s=function(s){function l(e,t){var n=s.call(this,e,t)||this;return n.timeoutTime=200,n.args=t,n.textSocketArgs=TDB.watcherTag(596473681,n._viewModel,n,n._viewModel.calcTextSocket),n.isPopup=!1,n.isHeading=!1,n.mediaCardToEmbedCardConversionValidator=new r(n.pageId),n.mediaCardToEmbedCardConverter=new a,n}return __extends(l,s),l.prototype.getViewModel=function(){return this._viewModel},l.prototype.getPrimaryTextViewModel=function(e){var t=this.textSocketArgs.getWatchedValue(e);return t&&t.getModel().viewModel},l.prototype.getPrimaryInputElement=function(){return this.textSocket},l.prototype.imageWrapperCssArgs=function(e){return{ThumbnailFrame:!this._viewModel.inTeaserMode(e)}},l.prototype.imageWrapperTouchToMouseArgs=function(e){return{enabled:!0}},l.prototype.ifThumbnailOverlayArgs=function(e){return this._viewModel.isThumbnailOverlayVisible(e)},l.prototype.childAcceptDraggables=function(e,t){return!1},l.prototype.getChildCards=function(e){return!this._viewModel.areCollapsedOrTeaserMode(e)&&this.cardExpandedView?this.cardExpandedView.getChildCards(e).mapSome(function(e){return e instanceof n.CardVE?e:void 0}):[]},l.prototype.uploadProgressArgs=function(e){if(!this._viewModel.inTeaserMode(e)){var t=this._viewModel.uploadController.getWatchedValue(e);return t&&new TDB.ChildArgs(n.CardUploadProgressVE,t)}},l.prototype.processingProgressArgs=function(t){if(StoryPageEditSettings.MediaProcessProgressEnabled&&this._viewModel.getUploadStatus(t)===e.Model.AuthoringModel.UploadStatus.Preprocessing){var o={mediaModelId:this.getViewModel().getModel().getMedia().id,notificationType:e.Server.NotificationBus.NotificationType.MediaProcessingProgress,canBeUpdatedToLowerValue:!1,notificationManager:e.Server.NotificationBus.currentNotificationManager().get(this.pageId)},i={progressUpdater:new n.NotificationProgressUpdater(o)};return new TDB.ChildArgs(n.CardProgressBarVE,i)}},l.prototype.showProcessingProgressArgs=function(t){return this._viewModel.getUploadStatus(t)===e.Model.AuthoringModel.UploadStatus.Preprocessing&&!this._viewModel.inTeaserMode(t)},l.prototype.transferProgressArgs=function(t){if(StoryPageEditSettings.MediaTransferProgressEnabled&&this._viewModel.getUploadStatus(t)===e.Model.AuthoringModel.UploadStatus.Transferring){var o={mediaModelId:this.getViewModel().getModel().getMedia().id,notificationType:e.Server.NotificationBus.NotificationType.MediaTransferProgress,canBeUpdatedToLowerValue:!1,notificationManager:e.Server.NotificationBus.currentNotificationManager().get(this.pageId)},i={progressUpdater:new n.NotificationProgressUpdater(o)};return new TDB.ChildArgs(n.CardProgressBarVE,i)}},l.prototype.showTransferProgressArgs=function(t){return this._viewModel.getUploadStatus(t)===e.Model.AuthoringModel.UploadStatus.Transferring&&!this._viewModel.inTeaserMode(t)},l.prototype.getMediaCard=function(){return this._mediaImage},l.prototype.ifCaptionWrapperArgs=function(e){return!this._viewModel.inTeaserMode(e)&&!this.ifStatusMessageArgs(e)},l.prototype.mediaCardImageArgs=function(e){if(!this._viewModel.isPlaceholderVisible(e)){var t={viewModel:this._viewModel,labelText:this.parent instanceof n.ComplexHeadingCardVE?this.parent.cardLabelDefaultText:this.cardLabelDefaultText,cardMode:this.parent instanceof n.ComplexHeadingCardVE?TDB.watchableTag(596473682,this.parent.getViewModel(),this.parent.getViewModel().calculateCardMode(e)):TDB.watchableTag(596473683,this._viewModel,this._viewModel.calculateCardMode(e))};return new TDB.ChildArgs(n.MediaCardImageVE,t)}},l.prototype.placeholderCardArgs=function(e){if(this._viewModel.isPlaceholderVisible(e)&&this._viewModel.calculateCardMode(e)!==o.CardMode.Expanded){var t=new TDB.ReusingComputedOptionArgs(this,this.mediaPlaceholderText),i={fontIconName:this.args.placeholderFontIconName,fontIconSizeClass:this.args.placeholderFontIconSizeClass,fontIconClass:"MediaPlaceholderIcon",text:{compute:t},description:{compute:t},css:"MediaPlaceholderImage",context:this,clicked:this.mediaPlaceholderClicked,tabIndex:n.CardElementTabIndex.Teaser,fileuploader:this.args.fileUploader},r=this.args.cardFactory.createPlaceholderCardArgs({cardParent:this,attributes:i,viewModel:this._viewModel.getPlaceholderCardViewModel()});return new TDB.ChildArgs(n.PlaceholderCardVE,r)}},l.prototype.getPlaceholderCard=function(){return this._placeholderCard},l.prototype.textArgs=function(){return this.textSocketArgs},l.prototype.areDescendantsVisible=function(e){return this.isVisible(e)&&this.cardParent.areDescendantsVisible(e)},l.prototype.mediaPlaceholderClicked=function(e){var t=this;return ActionLogger.RecordClientAction(new ClientAction.StorylinePlaceholderClickedData("Media placeholder clicked",[this._viewModel.getModelId()],[n.CardType[this.cardType]],[o.CardMode[this._viewModel.getCardMode()]])),TDB.applyUpdate(function(){n.ShowAddContentAction.execute(null,{paneStateManager:t.paneStateManager,cardsContainer:t.cardsContainer,sourceCardType:t.cardType})}),this.paneStateManager.activateAddContentPane(),TDB.EventPropagation.Bypass},l.prototype.mediaPlaceholderText=function(e){return this.paneStateManager.getPaneVisible(n.AuthoringPaneType.Content,e)?this.args.placeholderDragText:this.args.placeholderText},l.prototype.ifErrorMessageArgs=function(e){return this._viewModel.isErrorMessageVisible(e)},l.prototype.ifStatusMessageArgs=function(e){return this._viewModel.isStatusMessageVisible(e)},l.prototype.filenameTextArgs=function(e){return this._viewModel.getFilename(e)},l.prototype.errorMessageTextArgs=function(e){return this._viewModel.getErrorText(e)},l.prototype.statusMessageTextArgs=function(e){var t=this._viewModel.getStatusText(e);return 0==t.length?this.mediaPlaceholderText(e):t},l.prototype.getTextEditorElement=function(){var e=this.textSocket;if(e&&t.ViewModel.TextHelperMethods.isNodeInDOM(e.element))return e.element},l.prototype.focusOnOurPlaceholder=function(){var e=this;platform.setTimeout(function(){e._placeholderCard&&e._placeholderCard.setActivePlaceholder()},this.timeoutTime)},l.prototype.isRootHeading=function(){return!1},l.prototype.authoringHintWrapperVisibleArgs=function(e){return""!==this._viewModel.hintText(e)},l.prototype.authoringHintClassNameArgs=function(e){return n.AuthoringHintVE.HintTextMediaClassName},l.prototype.hintTextArgs=function(e){return new TDB.ChildArgs(n.AuthoringHintVE,this._viewModel.getHint(e))},l.prototype.closeButtonArgs=function(e){if(this._viewModel.isSelectionCheckmarkVisible.getWatchedValue(e)){var t={buttonId:ClientAction.ButtonId.EditImagePane_Close,click:this.closeButtonClicked,context:this,cssClass:{value:"HintCloseButton"},description:{value:ResourceManager.ResolveString(Resources.ClosePaneButtonDescription,[Resources.FocusPaneTitle])},fontIconName:{value:FontIcons.ClosePaneIcon},fontIconSizeClass:FontIcons.ClosePaneIconSize};return new TDB.ChildArgs(i.GlyphButtonVE,t)}},l.prototype.closeButtonClicked=function(e){return this._viewModel.clearHint(),TDB.EventPropagation.Bypass},l.prototype.mouseDown=function(){return this.attemptToConvertToEmbedCard(),TDB.EventPropagation.PreventDefault},l.prototype.attemptToConvertToEmbedCard=function(){if(this.isEligibleForMediaCardToEmbedCardConversion()){var e=this.mediaCardToEmbedCardConverter.convert(this,this.pageId);return!!e&&!!e.embedCardVe&&!!e.embedCardVm}return!1},l.prototype.isEligibleForMediaCardToEmbedCardConversion=function(){return this.mediaCardToEmbedCardConversionValidator.validate(this)},l.prototype.linkButtonClicked=function(){return this.attemptToConvertToEmbedCard()},l.prototype.recordButtonClicked=function(){return this.attemptToConvertToEmbedCard()},l}(n.ContentCardVE);n.MediaCardVE=s}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel,o=function(e){function o(n,o){var i=this;return o.cardLabelText=Resources.CardDeckAudioLabel,i=e.call(this,n,o)||this,i.cardType=t.CardType.Audio,i}return __extends(o,e),o.prototype.wrapperCssArgs=function(t){var o=e.prototype.wrapperCssArgs.call(this,t),i=this._viewModel.calculateCardMode(t)==n.CardMode.Expanded;return o.CaptionLabeledCard=!i,o.BasicCard=o.BasicCard&&!i,o.SetCard=o.SetCard||i,o.ExpandedSocketifiedCard=o.ExpandedSocketifiedCard||i,o},o.prototype.labelText=function(e){var t=this._viewModel.getFilename(e);return t?ResourceManager.ResolveString(Resources.CardLabelSpacing,[Resources.AudioCardStorylineDescription,t]):Resources.AudioCardStorylineDescription},o.prototype.mediaPlaceholderClicked=function(o){return ActionLogger.RecordClientAction(new ClientAction.StorylinePlaceholderClickedData("Media placeholder clicked",[this._viewModel.getModelId()],[t.CardType[this.cardType]],[n.CardMode[this._viewModel.getCardMode()]])),StoryPageSettings.IsNativeClient?e.prototype.mediaPlaceholderClicked.call(this,o):(t.UploadMediaAction.getInstance().execute(null,{uploadElement:$("#fileToUpload"),cardsContainer:this.cardsContainer}),this.setFocus(),o.preventDefault(),o.stopPropagation(),TDB.EventPropagation.Bypass)},o.prototype.collapsedOrTeaserArgs=function(e){return!StoryPageEditSettings.SocketifiedAudioCardEnabled||this._viewModel.areCollapsedOrTeaserMode(e)},o.prototype.cardDetailButtonArgs=function(e){if(this.supportsExpandedMode(e)&&StoryPageEditSettings.SocketifiedAudioCardEnabled)return new TDB.ChildArgs(VE.GlyphButtonVE,{buttonId:ClientAction.ButtonId.CardAction_ExpandCardDetail,context:this,cssClass:{watchable:TDB.watcherTag(596473761,this,this,this.calculateCardDetailButtonCssStyle)},description:{value:ResourceManager.ResolveString(Resources.ShowCardDetailsWithType,[this.cardLabelDefaultText])},tooltip:{value:Resources.ShowCardDetails},fontIconName:{value:FontIcons.ExpandIcon},fontIconSizeClass:FontIcons.ExpandIconSize,fontIconWrapperClass:{value:"ContainerCardCollapseFontIconWrapper"},textClass:"CardDetailButtonText ContainerCardHeaderLabel segoeUISemibold",text:{value:Resources.CardDetailButtonText},textPlacementRight:!0,click:this.cardDetailButtonClicked,role:Aria.Roles.Button})},o}(t.MediaCardVE);t.AudioCardVEBase=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype.ifErrorMessageArgs=function(e){return this._viewModel.isErrorPlaceholderVisible(e)},t.prototype.ifUploadingPlaceholderArgs=function(e){return this._viewModel.isUploadingPlaceholderVisible(e)},t.prototype.placeholderSpinnerStyleArgs=function(e){return{backgroundImage:"url('"+CommonSettings.ContentBaseUrl+"whitespinner.32x32.gif')"}},t.prototype.labelText=function(e){var t=this._viewModel.getFilename(e);return t?ResourceManager.ResolveString(Resources.CardLabelSpacing,[Resources.DocumentCardStorylineDescription,t]):Resources.DocumentCardStorylineDescription},t.prototype.errorMessageTextArgs=function(e){return this._viewModel.getErrorText(e)},t.prototype.statusMessageTextArgs=function(e){return this._viewModel.getStatusText(e)},t.prototype.placeholderIconArgs=function(e){if(this.ifErrorMessageArgs(e)){var t={fontIconName:{value:this._viewModel.embedDocumentFontIconName()},fontIconSizeClass:FontIcons.EmbedPlaceholderIconSize,fontIconWrapperClass:{value:"EmbedDocumentFontIconWrapper"}};return new TDB.ChildArgs(VE.FontIconVE,t)}return null},t.prototype.imageWrapperTouchToMouseArgs=function(e){return{enabled:!0}},t}(e.ContentCardVE);e.DocumentCardVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(e){function n(t,n){return n.cardLabelText=Resources.DocumentCardTitle,e.call(this,t,n)||this}return __extends(n,e),n.prototype.importingOrEmbeddingDocumentErrorTextArgs=function(e){return Resources.ImportingOrEmbeddingErrorMessage},n.prototype.documentImageOrSpinnerStyleArgs=function(e){return this._viewModel.isUploading(e)?{backgroundImage:"url('"+CommonSettings.ContentBaseUrl+"whitespinner.32x32.gif')"}:{backgroundImage:""}},n.prototype.documentImageOrSpinnerCssArgs=function(e){var t={};return t[this._viewModel.embedDocumentClassName(e)]=!this._viewModel.isUploading(e),t},n.prototype.ifThumbnailOverlayArgs=function(e){return this._viewModel.isUploading(e)},n.prototype.placeholderIconArgs=function(e){if(!this._viewModel.isUploading(e)){var n={fontIconName:{value:this._viewModel.embedDocumentFontIconName()},fontIconSizeClass:FontIcons.EmbedPlaceholderIconSize,fontIconWrapperClass:{value:"ImportingOrEmbeddingDocumentFontIconWrapper"}};return new TDB.ChildArgs(t.FontIconVE,n)}return null},n.prototype.importingOrEmbeddingDocumentMessageTextArgs=function(e){return this._viewModel.isUploading(e)?Resources.ImportingOrEmbeddingUploadingMessage:Resources.ImportingOrEmbeddingDocumentQuestion},n.prototype.importingOrEmbeddingDocumentMessageStyleArgs=function(e){return{display:this._viewModel.isMessageVisible(e)?"":"none"}},n.prototype.importingOrEmbeddingDocumentErrorStyleArgs=function(e){return{display:this._viewModel.isErrorVisible(e)?"":"none"}},n.prototype.importingOrEmbeddingDocumentButtonsWrapperStyleArgs=function(e){return{display:this._viewModel.isButtonVisible(e)?"":"none"}},n.prototype.labelText=function(e){var t=this._viewModel.getFilename(e);return t?ResourceManager.ResolveString(Resources.CardLabelSpacing,[Resources.DocumentCardTitle,t]):Resources.DocumentCardTitle},n.prototype.ifOverlayLabelArgs=function(e){return this._viewModel.inTeaserMode(e)},n.prototype.ifValidStateArgs=function(e){return this._viewModel.isValidState(e)},n.prototype.importButtonVEArgs=function(){var e={buttonId:ClientAction.ButtonId.Add_Document_ImportButtonClick,click:this._viewModel.importDocument,context:this._viewModel,cssClass:{value:"DocumentImportButton"},enabled:{compute:new TDB.ComputedOptionArgs(this._viewModel,this._viewModel.canBeImported)},textClass:"DocumentImportButtonText",text:{value:Resources.ImportDocumentButtonText}};return new TDB.ChildArgs(t.TextButtonVE,e)},n.prototype.embedButtonVEArgs=function(){var e={buttonId:ClientAction.ButtonId.Add_Document_EmbedButtonClick,click:this._viewModel.embedDocument,context:this._viewModel,cssClass:{value:"DocumentEmbedButton"},textClass:"DocumentEmbedButtonText",text:{value:Resources.EmbedDocumentButtonText}};return new TDB.ChildArgs(t.TextButtonVE,e)},n.prototype.getViewModel=function(){return this._viewModel},n.prototype.imageWrapperTouchToMouseArgs=function(e){return{enabled:!0}},n}(e.ContentCardVE);e.ImportingOrEmbeddingDocumentCardVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel,o=function(e){function o(n,o){var i=this;return o.cardLabelText=Resources.CardDeckPictureLabel,i=e.call(this,n,o)||this,i.cardType=t.CardType.Image,i}return __extends(o,e),o.prototype.textVisibleArgs=function(e){return this._viewModel.isTextVisible(e)},o.prototype.labelText=function(e){return this._viewModel.getLabelText(e)},o.prototype.hasActivatableChildren=function(){return this._viewModel.inTeaserMode()},o.prototype.wrapperCssArgs=function(t){var o=e.prototype.wrapperCssArgs.call(this,t),i=this._viewModel.calculateCardMode(t)==n.CardMode.Expanded;return o.CaptionLabeledCard=!i,o.BasicCard=o.BasicCard&&!i,o.ExpandedSocketifiedCard=o.ExpandedSocketifiedCard||i,o},o.prototype.getChildCards=function(e){return!this._viewModel.areCollapsedOrTeaserMode(e)&&this.cardExpandedView?this.cardExpandedView.getChildCards(e).mapSome(function(e){return e instanceof t.CardVE?e:void 0}):[]},o.prototype.ifDropTargetOverlayArgs=function(){return!(this.cardParent instanceof t.ComplexHeadingCardVE&&this.getViewModel().getSocketDefinition())},o.prototype.ifCaptionWrapperArgs=function(){return this._viewModel.supportsCaption()},o.prototype.supportsExpandedMode=function(t){var n=this._viewModel.isErrorMessageVisible(t)&&!this._viewModel.showingSocketError(t)||this._viewModel.isStatusMessageVisible(t);return e.prototype.supportsExpandedMode.call(this,t)&&!n},o.prototype.imageOverlayStyleArgs=function(e){return{cursor:this._viewModel.inSocket()?"default":"move"}},o}(t.MediaCardVE);t.ImageCardVEBase=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.Model.AuthoringModel,i=function(i){function r(e,n){var o=i.call(this,e,n)||this;return o._attributes=n.attributes,o.cardType=t.CardType.Placeholder,o._cardVisibleWatchable=TDB.watchableOption(o,n.attributes.cardVisible,!0),o._placeholderVisibleWatchable=TDB.watchableOption(o,n.attributes.placeholderVisible,!0),o.descriptionWatchable=TDB.watchableOption(o,n.attributes.description,""),o.tooltipWatchable=TDB.watchableOption(o,n.attributes.tooltip,""),o._textWatchable=TDB.watchableOption(o,n.attributes.text,""),o}return __extends(r,i),r.prototype.getViewModel=function(){return this._viewModel},r.prototype.canEnter=function(){return!1},r.prototype.isVisible=function(e){return this._placeholderVisibleWatchable.getWatchedValue(e)},r.prototype.wrapperCssArgs=function(e){var t={};return t.PlaceholderCardActivated=this.isPlaceholderHighlighted(this,e),this._attributes.css&&(t[this._attributes.css]=!0),t},r.prototype.ifCardWrapperArgs=function(e){return this.isVisible(e)},r.prototype.wrapperAttrArgs=function(e){var t=this.descriptionWatchable.getWatchedValue(e),n=this.tooltipWatchable.getWatchedValue(e),o={};return o[Aria.Attributes.Label]=t,o[Aria.Attributes.Role]=Aria.Roles.Button,o[Aria.Attributes.Title]=n||t,o},r.prototype.dropTargetOverlayArgs=function(){var e={context:this,acceptDraggable:this.overlayAcceptDraggable,drop:this.overlayDrop,zOrder:this.cardNestingLevel,fileUploader:this._authoringModel.fileUploader,cardDragHandler:this.cardDragHandler,expandable:!1,useSlowFade:!0};return new TDB.ChildArgs(t.CardDropTargetOverlayVE,e)},r.prototype.getDropTargetOverlayArgs=function(){return this.dropTargetOverlayVE},r.prototype.iconArgs=function(){var e={fontIconName:{value:this._attributes.fontIconName},fontIconSizeClass:this._attributes.fontIconSizeClass,fontIconWrapperClass:{value:this._attributes.fontIconClass}};return new TDB.ChildArgs(n.FontIconVE,e)},r.prototype.textTextArgs=function(e){return this._textWatchable.getWatchedValue(e)},r.prototype.overlayAcceptDraggable=function(e){return this._viewModel.acceptDraggable(e)},r.prototype.overlayDrop=function(e){this._viewModel.addObjectsFromViewElements(e)},r.prototype.dragOver=function(e){var t=this;return this.dropTargetOverlayVE&&TDB.applyUpdate(function(){t.dropTargetOverlayVE.setActiveDropTarget(!0)},TDB.Justification.SynchronousBrowserEvent),!1},r.prototype.dragLeave=function(e){var t=this;return this.dropTargetOverlayVE&&TDB.applyUpdate(function(){t.dropTargetOverlayVE.setActiveDropTarget(!1)},TDB.Justification.SynchronousBrowserEvent),!1},r.prototype.drop=function(t){var n=this;return t.preventDefault(),this.dropTargetOverlayVE&&this.dropTargetOverlayVE.setActiveDropTarget(!1),this.setFocus(),this.setActivePlaceholder(),e.Model.currentUndoManager().get(this.pageId).captureUserUpdate(function(){var e=o.StoryController.getFilesFromDataTransfer(t.dataTransfer);n._attributes.fileuploader.uploadFiles(FileObject.createFileObjects(e))},"User dropped file(s) from their desktop onto a PlaceholderCardVE"),!1},r.prototype.onAction=function(e){var n=this,o=this.cardParent;return o.getViewModel().inTeaserMode()&&(o=o.cardParent),o instanceof t.CardVE&&o.activateItem(),this.setFocus(),this.setActivePlaceholder(),this._attributes.context&&this._attributes.clicked?(StoryApp.Utilities.browser.isIE?platform.setTimeout(function(){return n._attributes.clicked.call(n._attributes.context,e)},200):this._attributes.clicked.call(this._attributes.context,e),TDB.EventPropagation.PreventDefault):TDB.EventPropagation.Bubble},r.prototype.keyDown=function(e){var t=TDB.EventPropagation.Bubble;switch(e.keyCode){case KeyCodeType.EnterKey:case KeyCodeType.SpaceKey:t=this.onAction(e)}return t===TDB.EventPropagation.Bubble?i.prototype.handleShortcutKey.call(this,e):t},r.prototype.ifPlaceholderCardWrapperArgs=function(e){return e.watchValue(this._cardVisibleWatchable)},r.prototype.setSelection=function(){this.parent instanceof t.CardVE?this.parent.setSelection():i.prototype.setSelection.call(this)},r.prototype.setActivePlaceholder=function(){this.cardsContainer.setActivePlaceholder(this)},r.prototype.getTabIndex=function(){return this.cardParent.getViewModel().inTeaserMode()?0:this._attributes.tabIndex||0},r.prototype.isPlaceholderCard=function(){return!0},r.prototype.getDropTargetOverlay=function(){return this.dropTargetOverlayVE},r.prototype.jackArgs=function(){if(this._attributes.useJackMenu)return i.prototype.jackArgs.call(this)},r}(t.CardVE);t.PlaceholderCardVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel,o=StoryApp.View.ViewElements,i=function(e){function i(n,o){var i=e.call(this,n,o)||this;return i.cardType=t.CardType.Set,i.fileUploader=o.authoringModel.fileUploader,i}return __extends(i,e),i.prototype.getViewModel=function(){return this._viewModel},i.prototype.contentCardsArgs=function(e){return this._viewModel.createCardArgs(e)},i.prototype.containsHeader=function(e){return this.ifCardWrapperArgs(e)},i.prototype.wrapperCssArgs=function(t){var n=e.prototype.wrapperCssArgs.call(this,t),o=this._viewModel.isCollapsed(t),i=this._viewModel.isMultiselected(t);return n.BasicCard=!1,n.SetCardCollapsed=o,n.SetCardExpandedMultiselect=i&&!o,n},i.prototype.collapseCardCssArgs=function(t){var n=e.prototype.wrapperCssArgs.call(this,t),o=this._viewModel.isCollapsed(t),i=this._viewModel.isMultiselected(t);return n.BasicCard=o,n.SetCardCollapseCard=o,n.CardMultiselect=!1,n.SetCardMultiselect=i,n},i.prototype.ifCardWrapperArgs=function(e){return!this._viewModel.isParentCollapsed(e)},i.prototype.ifTeaserModeArgs=function(e){return!this.ifCardWrapperArgs(e)&&StoryPageEditSettings.NestedGroupingEnabled},i.prototype.bottomTweenerWrapperCssArgs=function(e){return{BottomTweenerWrapper:!this._viewModel.isCollapsed(e)}},i.prototype.bottomTweenerCssClass=function(e){return this._viewModel.isCollapsed(e)?"SetCardBottomTweener":"SetCardExpandedBottomTweener"},i.prototype.thumbSetCardTextTextArgs=function(e){return this.getLabel(e)},i.prototype.thumbSetCardIconArgs=function(){var e={fontIconName:{compute:new TDB.ComputedOptionArgs(this,this.getFontIcon)},fontIconSizeClass:FontIcons.PlaceholderIconSize,fontIconWrapperClass:{value:"SetCardThumbIcon"}};return new TDB.ChildArgs(o.FontIconVE,e)},i.prototype.dropTargetOverlayArgs=function(e){if(this._viewModel.isCollapsed(e)){var n={context:this,acceptDraggable:this.overlayAcceptDraggable,drop:this.overlayDrop,getOverlayText:this.overlayText,zOrder:this.cardNestingLevel,fileUploader:this.fileUploader,cardDragHandler:this.cardDragHandler,expandable:!0};return new TDB.ChildArgs(t.CardDropTargetOverlayVE,n)}},i.prototype.topTweenerArgs=function(){return new TDB.ChildArgs(t.TweenerVE,this._viewModel.getTopTweenerArgs())},i.prototype.getPlaceholderCard1=function(){return this.placeholderCard1},i.prototype.placeholderCard1Args=function(){return this.createPlaceholderChildArgs(this.placeholderCard1Visible,this.firstBackgroundPlaceholderDescription,this.firstBackgroundPlaceholderTooltip,this._viewModel.getPlaceholder1CardViewModel(),1)},i.prototype.placeholderCard2Args=function(){return this.createPlaceholderChildArgs(this.placeholderCard2Visible,this.secondBackgroundPlaceholderDescription,this.secondBackgroundPlaceholderTooltip,this._viewModel.getPlaceholder2CardViewModel(),2)},i.prototype.createPlaceholderChildArgs=function(e,n,o,i,r){var a=this,s={fontIconName:FontIcons.ContentPlaceholderIcon,fontIconSizeClass:FontIcons.PlaceholderIconSize,fontIconClass:"ContainerCardPlaceholderIcon",placeholderVisible:{compute:new TDB.ComputedOptionArgs(this,e)},text:{compute:new TDB.ComputedOptionArgs(this,this.backgroundPlaceholderText)},description:{compute:new TDB.ComputedOptionArgs(this,n)},tooltip:{compute:new TDB.ComputedOptionArgs(this,o)},context:this,clicked:function(e){return a.placeholderClicked(r,e)},fileuploader:this._authoringModel.fileUploader,useJackMenu:!0};return new TDB.ChildArgs(t.PlaceholderCardVE,this._cardFactory.createPlaceholderCardArgs({cardParent:this,viewModel:i,attributes:s}))},i.prototype.contentWrapperCssArgs=function(e){var t=this._viewModel.getUncollapsedCount(e),n=this._viewModel.isCollapsed(e)&&!this._viewModel.isContainerEmpty(e);return{SetCardContentCollapsed:n,SetCardContentExpanded:!n,SetCardContentArea:t<=2}},i.prototype.hideJack=function(n){var o=e.prototype.hideJack.call(this,n),i=this._viewModel.getUncollapsedCount(n);return o||i>1&&this.cardParent instanceof t.SetCardVE},i.prototype.ifPlaceholderCard1Args=function(e){var t=this.placeholderCard1Visible(e);return t||(this.placeholderCard1=null),t},i.prototype.ifPlaceholderCard2Args=function(e){return this.placeholderCard2Visible(e)},i.prototype.getLabel=function(e){return this._viewModel.getLabel(e)},i.prototype.getFontIcon=function(e){return this._viewModel.getFontIcon(e)},i.prototype.placeholderCard1Visible=function(e){return this._viewModel.isPlaceholderVisible(e)},i.prototype.placeholderCard2Visible=function(e){return this._viewModel.isSecondPlaceholderVisible(e)},i.prototype.backgroundPlaceholderText=function(e){return this._viewModel.onlySupportsImages(e)?Resources.CardDeckImagePlaceholderText:Resources.CardDeckContentPlaceholderText},i.prototype.firstBackgroundPlaceholderDescription=function(e){return this._viewModel.onlySupportsImages(e)?this.ifPlaceholderCard2Args(e)?Resources.CardDeckFirstImagePlaceholderDescription:Resources.CardDeckImagePlaceholderText:Resources.CardDeckContentPlaceholderText},i.prototype.secondBackgroundPlaceholderDescription=function(e){return this._viewModel.onlySupportsImages(e)?Resources.CardDeckSecondImagePlaceholderDescription:Resources.CardDeckContentPlaceholderText},i.prototype.firstBackgroundPlaceholderTooltip=function(e){return this._viewModel.onlySupportsImages(e)?this.ifPlaceholderCard2Args(e)?Resources.CardDeckFirstImagePlaceholderTooltip:Resources.CardDeckImagePlaceholderText:Resources.CardDeckContentPlaceholderText},i.prototype.secondBackgroundPlaceholderTooltip=function(e){return this._viewModel.onlySupportsImages(e)?Resources.CardDeckSecondImagePlaceholderTooltip:Resources.CardDeckContentPlaceholderText},i.prototype.placeholderClicked=function(e,o){ActionLogger.RecordClientAction(new ClientAction.StorylinePlaceholderClickedData("Set placeholder clicked",[this._viewModel.getModelId()],[t.CardType[this.cardType]],[n.CardMode[this._viewModel.getCardMode()]]));var i=2===e?this.placeholderCard2:this.placeholderCard1;i.activateItem(),i.setActivePlaceholder();var r=i.getJack();return r&&r.openMenu(),TDB.EventPropagation.Bypass},i.prototype.getChildCards=function(e){return this.getContentCards(e)},i.prototype.childAcceptDraggables=function(e,t){return this._viewModel.childAcceptDraggables(t)},i.prototype.overlayAcceptDraggable=function(e){return!!this._viewModel.acceptDraggable(e)&&this._viewModel.overlayAcceptDraggable(e)},i.prototype.overlayDrop=function(e){this._viewModel.addViewElements(e)},i.prototype.overlayText=function(e){},i.prototype.sidebarArgs=function(t){if(this._viewModel.isSidebarVisible(t))return e.prototype.sidebarArgs.call(this,t)},i.prototype.areDescendantsVisible=function(e){return this.isVisible(e)&&this.cardParent.areDescendantsVisible(e)},i.prototype.bottomTweenerArgs=function(){return new TDB.ChildArgs(t.TweenerVE,this._viewModel.getBottomTweenerArgs({compute:new TDB.ComputedOptionArgs(this,this.bottomTweenerCssClass)}))},i.prototype.ifSmallSpacerArgs=function(e){return 0===this._viewModel.getChildren(e).length},i}(t.ContainerCardVE);t.SetCardVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(t){function n(n,o){var i=this;return o.cardLabelText=Resources.CardDeckTweetLabel,i=t.call(this,n,o)||this,i._args=o,i.cardType=e.CardType.StatusUpdate,i.isPopup=!1,i.isHeading=!1,i._viewModel.measureTweetIfFirstTime(),i}return __extends(n,t),n.prototype.imageWrapperCssArgs=function(e){return{ThumbnailFrame:!this._viewModel.inTeaserMode(e)}},n.prototype.imageWrapperTouchToMouseArgs=function(e){return{enabled:!0}},n.prototype.thumbnailPaneTouchToMouseArgs=function(e){return{enabled:!0}},n.prototype.areDescendantsVisible=function(e){return this.isVisible(e)&&this.cardParent.areDescendantsVisible(e)},n.prototype.childAcceptDraggables=function(e,t){return!1},n.prototype.getChildCards=function(e){return[]},n.prototype.authorImageVisibleArgs=function(e){return this._viewModel.isAuthorImageVisible(e)},n.prototype.imageDivStyleArgs=function(e){return{backgroundImage:"url('"+this._viewModel.getImageUrl(e)+"')"}},n.prototype.ifSupportsObjectFitArgs=function(){return"objectFit"in document.body.style},n.prototype.bodyImageAttrArgs=function(e){return{src:this._viewModel.getImageUrl(e),role:Aria.Roles.Presentation}},n.prototype.bodyImageVisibleArgs=function(e){var t=this._viewModel.getImageUrl(e);return t&&t.length>0},n.prototype.ifOverlayIconArgs=function(e){return!0},n.prototype.overlayIconArgs=function(){return this._viewModel.getOverlayIcon(this)},n.prototype.ifOverlayLabelArgs=function(e){return this._viewModel.inTeaserMode(e)},n.prototype.ifThumbnailOverlayArgs=function(e){return this.ifOverlayIconArgs(e)&&this._viewModel.isExistingBodyImage(this._viewModel.getModel(),e)},n.prototype.ifStatusUpdateContentArgs=function(e){return!this._viewModel.inTeaserMode(e)},n.prototype.bodyTextArgs=function(e){return this._viewModel.getBodyText(e)},n.prototype.labelText=function(e){var t=this._viewModel.getAuthorText(e);return t?ResourceManager.ResolveString(Resources.CardLabelSpacing,[Resources.TweetCardStorylineDescription,t]):Resources.TweetCardStorylineDescription},n.prototype.isCollapsed=function(e){return!1},n.prototype.isRootHeading=function(){return!1},n}(e.ContentCardVE);e.StatusUpdateCardVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.Common.FRE,n=function(n){function o(t,o){var i=this;return o.cardLabelText=Resources.TextCardStorylineDescription,i=n.call(this,t,o)||this,i.cardType=e.CardType.Text,i.textControlArgs=i._viewModel.createTextControl("TextDropTargetActive","calibriRegular"),i.additionalCSSMenuClasses="CardMenuNoPlaceholder",i.resourceFactory.loadResource(7).then(function(){i._viewModel.intersectionObserverLoaded()}),i}return __extends(o,n),o.prototype.positionTrackerInViewportWatcherInitArgs=function(){return{onVisibilityChanged:this.isInViewportCallback,rootMargin:"20px"}},o.prototype.isInViewportCallback=function(e){e&&!t.getCalloutManager().isActiveCallout(void 0,t.CalloutID.PullQuote)&&t.FirstRunTriggers.pullquoteVisible(this)},o.prototype.pullquoteFreArgs=function(e){var n=t.CalloutID.PullQuote;if(t.getCalloutManager().isActiveCallout(e,n)&&t.getCalloutManager().getCurrentTriggerContext()==this)return new TDB.ChildArgs(VE.FRECalloutVE,t.CalloutArgsCreator.createArgsForPullQuote())},o.prototype.shouldTrackPositionArgs=function(e){return this._viewModel.shouldTrackPosition(e)},o.prototype.getPrimaryTextViewModel=function(e){return this.textControlArgs&&this.textControlArgs.getModel().viewModel},o.prototype.getPrimaryInputElement=function(){return this._textControl},o.prototype.ifTeaserOverlayArgs=function(e){return this._viewModel.inTeaserMode(e)},o.prototype.placeholderIconArgs=function(){var e={fontIconName:{value:FontIcons.CardTextIcon},fontIconSizeClass:FontIcons.CardTextIconSize,fontIconWrapperClass:{value:"OverlayIconWrapper"}};return new TDB.ChildArgs(VE.FontIconVE,e)},o.prototype.ifPlaceholderArgs=function(e){return this._viewModel.inPlaceholderMode(e)},o.prototype.overlayCssArgs=function(e){return{PlaceholderCard:this._viewModel.inPlaceholderMode(e),TextCardTeaserOverlay:!this._viewModel.inPlaceholderMode(e)}},o.prototype.textArgs=function(){return this.textControlArgs},o.prototype.textOverlayClassNameArgs=function(t){return this.cardParent.isPopup?e.TextCardVE.PopupTextOverlayClassName:""},o.prototype.getTextEditorElement=function(){return this._textControl&&this._textControl.element},o.prototype.acceptDraggables=function(e){return!!this._viewModel.acceptDraggable(e)&&this.cardParent.childAcceptDraggables(this,e)},o.prototype.setFocusToText=function(e){void 0===e&&(e=!1),e?this._textControl.setFocusToEnd():this._textControl.setFocus()},o.prototype.getTextControl=function(){return this._textControl},o.prototype.commit=function(){this._textControl.commit()},o.prototype.cardLabelWrapperTouchToMouseArgs=function(e){return{enabled:!0}},o.prototype.contentWrapperCssArgs=function(t){var o=n.prototype.contentWrapperCssArgs.call(this,t);return o[e.TextCardVE.PopupTextContentWrapper]=this.cardParent.isPopup,o},o.prototype.wrapperCssArgs=function(t){var o=n.prototype.wrapperCssArgs.call(this,t);return o[e.TextCardVE.SocketTextCardWrapper]=this._viewModel.inSocket(),o},o.prototype.authoringHintWrapperVisibleArgs=function(e){return""!==this._viewModel.hintText(e)},o.prototype.authoringHintClassNameArgs=function(t){return e.AuthoringHintVE.HintTextClassName},o.prototype.hintTextArgs=function(t){if(this._viewModel.hasValidModel())return new TDB.ChildArgs(e.AuthoringHintVE,this._viewModel.getHint(t))},o.prototype.closeButtonArgs=function(e){if(this._viewModel.isSelectionCheckmarkVisible.getWatchedValue(e)){var t={buttonId:ClientAction.ButtonId.EditImagePane_Close,click:this.closeButtonClicked,context:this,cssClass:{value:"HintCloseButton"},description:{value:Resources.CreateOutlineCloseHintButtonDescription},fontIconName:{value:FontIcons.ClosePaneIcon},fontIconSizeClass:FontIcons.ClosePaneIconSize};return new TDB.ChildArgs(VE.GlyphButtonVE,t)}},o.prototype.closeButtonClicked=function(e){return this._viewModel.clearHint(),TDB.EventPropagation.Bypass},o.prototype.handleShortcutKey=function(e){return t.getCalloutManager().getCurrentCalloutID()===t.CalloutID.FirstHint&&t.FirstRunTriggers.swayTextboxTextTyped(),n.prototype.handleShortcutKey.call(this,e)},o.prototype.hintCalloutArgs=function(e){if(this._viewModel.isFirst()){var n=t.CalloutID.FirstHint;if(!t.getCalloutManager().isActiveCallout(e,n))return;var o={calloutBoxClassName:"FirstHint-callout",calloutTapClassName:"FirstHint-tap-callout",calloutWrapperClassName:"HintCalloutDock",headerText:{value:Resources.FirstRunFirstHintHeader},bodyText:Resources.FirstRunFirstHintReader,readerText:Resources.FirstRunFirstHintReader,calloutID:n,beakPosition:VE.BeakPosition.BottomRight,delay:t.getDelayForCallout(t.CalloutID.FirstHint,t.FirstRunType.Default),context:this};return new TDB.ChildArgs(VE.FRECalloutVE,o)}},o.prototype.shouldSplitOnPaste=function(){return!this._viewModel.inSocket()},o.prototype.keyDown=function(e){return this.cardParent&&this.cardParent.isPopup&&e.which===KeyCodeType.EscapeKey?TDB.EventPropagation.Bubble:n.prototype.keyDown.call(this,e)},o.PopupTextOverlayClassName="PopupText",o.PopupTextContentWrapper="PopupTextContentWrapper",o.SocketTextCardWrapper="SocketTextCard",o}(e.ContentCardVE);e.TextCardVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel,o=function(e){function o(n,o){var i=this;return o.cardLabelText=Resources.CardDeckVideoLabel,i=e.call(this,n,o)||this,i.cardType=t.CardType.Video,i}return __extends(o,e),o.prototype.wrapperCssArgs=function(t){var o=e.prototype.wrapperCssArgs.call(this,t),i=this._viewModel.calculateCardMode(t)==n.CardMode.Expanded;return o.CaptionLabeledCard=!i,o.BasicCard=o.BasicCard&&!i,o.SetCard=o.SetCard||i,o.ExpandedSocketifiedCard=o.ExpandedSocketifiedCard||i,o},o.prototype.collapsedOrTeaserArgs=function(e){return!StoryPageEditSettings.SocketifiedVideoCardEnabled||this._viewModel.areCollapsedOrTeaserMode(e)},o.prototype.cardDetailButtonArgs=function(e){if(this.supportsExpandedMode(e)&&StoryPageEditSettings.SocketifiedVideoCardEnabled)return new TDB.ChildArgs(VE.GlyphButtonVE,{buttonId:ClientAction.ButtonId.CardAction_ExpandCardDetail,context:this,cssClass:{watchable:TDB.watcherTag(596473672,this,this,this.calculateCardDetailButtonCssStyle)},description:{value:ResourceManager.ResolveString(Resources.ShowCardDetailsWithType,[this.cardLabelDefaultText])},tooltip:{value:Resources.ShowCardDetails},fontIconName:{value:FontIcons.ExpandIcon},fontIconSizeClass:FontIcons.ExpandIconSize,fontIconWrapperClass:{value:"ContainerCardCollapseFontIconWrapper"},textClass:"CardDetailButtonText ContainerCardHeaderLabel segoeUISemibold",text:{value:Resources.CardDetailButtonText},textPlacementRight:!0,click:this.cardDetailButtonClicked,role:Aria.Roles.Button})},o.prototype.labelText=function(e){var t=this.filenameTextArgs(e);if(t)return ResourceManager.ResolveString(Resources.CardLabelSpacing,[Resources.VideoCardStorylineDescription,t]);var n=this._viewModel.getMedia(e);if(n){var o=n.getTitle(e);if(o)return ResourceManager.ResolveString(Resources.CardLabelSpacing,[Resources.VideoCardStorylineDescription,o])}return Resources.VideoCardStorylineDescription},o}(t.MediaCardVE);t.VideoCardVEBase=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel,o=function(e){function o(t,n){return e.call(this,t,n)||this}return __extends(o,e),o.prototype.mouseClicked=function(e){return this._viewModel.executeAction(),TDB.EventPropagation.Bypass},o.prototype.getViewModel=function(){return this._viewModel},o.prototype.showSocketMenuArgs=function(e){return this._viewModel.isMenuShown(e)},o.prototype.isVisibleArgs=function(e){return CommonSettings.IsPaidUser||!this._viewModel.getSocket().isPremium()||this._viewModel.isMenuShown(e)},o.prototype.placeholderTextArgs=function(e){return this._viewModel.getPlaceholderText()},o.prototype.socketMenuArgs=function(){var e=new n.SocketMenuViewModel(this,{cardDefinitionManager:this._viewModel.getDefinitionManager(),cardTypes:this._viewModel.getCardChoices()});return new TDB.ChildArgs(t.SocketMenuVE,{viewModel:e})},o.prototype.closeMenu=function(e){this._viewModel.closeMenu()},o.prototype.keyDown=function(t){var n=e.prototype.keyDown.call(this,t);return this._viewModel.menuShown.getValue()?t.keyCode!==KeyCodeType.EscapeKey&&t.keyCode!==KeyCodeType.UpArrowKey&&t.keyCode!==KeyCodeType.DownArrowKey||this.closeMenu():t.keyCode!==KeyCodeType.EnterKey&&t.keyCode!==KeyCodeType.SpaceKey||this._viewModel.executeAction(),n},o.prototype.socketWrapperAttrArgs=function(e){return{title:this._viewModel.getPlaceholderTooltip(),"aria-label":this._viewModel.getPlaceholderText()}},o.prototype.isEmptySocketCard=function(){return!0},o}(t.CardVE);t.EmptySocketVEBase=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=e.View.ViewElements,i=function(t){function i(e,n){var o=t.call(this,e,void 0,n)||this;return o.socket=n.socket,o._cardDefinitionManager=n.cardDefinitionManager,o.cardChoices=o.findCardChoices(),o.menuShown=TDB.watchableTag(596473689,o,!1),o.cardsContainer=n.cardsContainer,o.paneStateManager=n.paneStateManager,o}return __extends(i,t),i.prototype.getDefinitionManager=function(){return this._cardDefinitionManager},i.prototype.getCardChoices=function(){return this.cardChoices},i.prototype.getSocket=function(){return this.socket},i.prototype.getPlaceholderText=function(){return this.socket.getDefinition().getPlaceholderText()},i.prototype.isMenuShown=function(e){return this.menuShown.getWatchedValue(e)},i.prototype.executeAction=function(){ActionLogger.RecordClientAction(new ClientAction.StorylineActionData(ClientAction.ActionType.Storyline_EmptySocketClicked,"User clicked on an empty socket",[this.getModelId()],[this.socket.getDefinition().getId()]));var e=this.socket.getDefinition().getDefaultActionType();switch(e){case n.SocketActionType.AddCard:1===this.cardChoices.length?this.addDefaultModelAndSetFocus(this.cardChoices[0]):StoryLog.StructuredTraceTag(596473690,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.error,"Empty socket can add card only if socket has one card choice",{action:e.toString(),dataType:this.socket.getDefinition().getDefaultDataType().toString(),cardChoices:this.cardChoices.length.toString()});break;case n.SocketActionType.ShowMenu:this.showMenu();break;case n.SocketActionType.OpenFilePicker:this.openFilePicker();break;default:StoryLog.StructuredTraceTag(596473691,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.error,"Unsupported action type",{action:e+""})}},i.prototype.showMenu=function(){var e=this;TDB.applyUpdate(function(){return e.menuShown.setValue(!0)}),this._cardVE instanceof o.EmptySocketVE?this._cardVE.socketMenu.enter():StoryLog.StructuredTraceTag(596473692,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.error,"We expect EmptySocketViewModel.showMenu() to be called only in the context of EmptySocketVE",{context:this._cardVE.toString()})},i.prototype.closeMenu=function(){var e=this;TDB.applyUpdate(function(){return e.menuShown.setValue(!1)}),this._cardVE.setFocus()},i.prototype.getPlaceholderTooltip=function(){return this.socket.getDefinition().getPlaceholderTextTooltip()},i.prototype.findCardChoices=function(){switch(this.socket.getDefinition().getDefaultDataType()){case n.CompositeType.ImageWithTextComposite:return[n.ManualCardType.ImageId];case n.CompositeType.Paragraph:case n.CompositeType.TextGroup:return[n.ManualCardType.TextId];default:return[]}},i.prototype.addDefaultModelAndSetFocus=function(e){this.addCardToSocket();var t=this.socket.getModelObject();this.setFocusToCard(e,t)},i.prototype.addModelAndSetFocus=function(e,t){this.addCardModelToSocket(t),this.setFocusToCard(e,t)},i.prototype.canAddModelObject=function(e){return this.socket.canAddSocketModelObject(e)},i.prototype.setFocusToCard=function(e,t){var n=this._cardVE.cardParent;if(n instanceof o.CardVE){var i=this.cardsContainer.getCardForModelId(t.id,n);if(i)this.cardsContainer.scrollToCardsAndSetFocus([i],void 0),this.onAddedCardFocused(e,i);else{var r="";this._cardVE.parent.getChildCards().forEach(function(e){r+=e.getViewModel().getModelId()+" "}),StoryLog.StructuredTraceTag(596473693,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.error,"Couldn't find the model in parent card",{targetModelId:t.id,expandedCardId:r})}}else StoryLog.StructuredTraceTag(596473694,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.error,"Found an empty socket view element that is not in any card's expanded view",{CardId:this._cardVE.id})},i.prototype.addCardToSocket=function(){var t=this.socket;e.Model.currentUndoManager().get(this.pageId).captureUserUpdate(function(){t.createDefaultModel()},"Adding card to empty socket")},i.prototype.addCardModelToSocket=function(t){var n=this.socket;e.Model.currentUndoManager().get(this.pageId).captureUserUpdate(function(){n.addSocketModelObject(t)},"Adding card model to empty socket")},i.prototype.onAddedCardFocused=function(e,t){var i=this;e===n.ManualCardType.ImageId&&(TDB.applyUpdate(function(){o.ShowAddContentAction.execute(null,{paneStateManager:i.paneStateManager,cardsContainer:i.cardsContainer,sourceCardType:o.CardType.Image})}),t instanceof o.ImageCardVE?t.focusOnOurPlaceholder():StoryLog.StructuredTraceTag(596473695,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.error,"We failed to create a card with expected card type",{cardType:e,card:t.className(),cardModelId:t.getModelObjectId(),isValid:n.StoryController.isModelObjectValid(t.getViewModel().getModel()).toString()}))},i.prototype.getCardForModelId=function(e){},i.prototype.openFilePicker=function(){this._cardVE.activateItem();var t=this.socket.getDefinition().getDefaultDataType();switch(t){case n.CompositeType.ClosedCaption:this._args.authoringModel.closedCaptionUploader.openFilePicker();break;default:StoryLog.StructuredTraceTag(596473696,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Opening default file picker",{dataType:t.toString(),cardChoices:this.cardChoices.length.toString()}),e.View.ViewElements.UploadMediaAction.getInstance().execute(null,{uploadElement:$("#fileToUpload"),cardsContainer:this.cardsContainer})}},i}(t.CardViewModel);t.EmptySocketViewModel=i}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=function(n){function o(e,t){var o=n.call(this,e)||this;return o.activeDropTarget=TDB.watchableTag(596473669,o,!1),o.args=t,o}return __extends(o,n),o.prototype.wrapperDropTargetInitArgs=function(){var e={context:this,expandable:this.args.expandable,accept:this.acceptDraggable,calculateDropRect:this.calculateDropRect,setActive:this.setActiveDropTarget,drop:this.dropViewElements,setCollapsed:this.setCollapsed,dropFileOrText:this.dropFile},n=new t.CardDropTargetOwner(e);return{dragHandler:this.args.cardDragHandler,owner:n,zOrder:this.args.zOrder}},o.prototype.wrapperClassNameArgs=function(e){return this.parent.getViewModel().inTeaserMode(e)?"CardDropTargetOverlayTeaser":"CardDropTargetOverlay"},o.prototype.wrapperTouchToMouseArgs=function(e){return{enabled:!this.parent.getViewModel().isSelected(e)}},o.prototype.acceptDraggable=function(e){return this.args.acceptDraggable.call(this.args.context,e)},o.prototype.calculateDropRect=function(e){return e.top+=10,e.height-=20,e},o.prototype.setActiveDropTarget=function(e){var t=this;TDB.applyUpdate(function(){t.activeDropTarget.setValue(e)},TDB.Justification.SynchronousBrowserEvent)},o.prototype.dropViewElements=function(e){return this.args.drop.call(this.args.context,e)},o.prototype.foregroundStyleArgs=function(e){return this.args.useSlowFade||this.activeDropTarget.getWatchedValue(e)?{}:{display:"none"}},o.prototype.foregroundFadeVisibleInitArgs=function(){return{}},o.prototype.foregroundFadeVisibleArgs=function(e){return{visible:e.watchValue(this.activeDropTarget)}},o.prototype.textTextArgs=function(e){return this.args.context&&this.args.getOverlayText?this.args.getOverlayText.call(this.args.context,e):""},o.prototype.ifCardDropTargetOverlayTextArgs=function(e){return!(!this.args.context||!this.args.getOverlayText)&&void 0!=this.args.getOverlayText.call(this.args.context,e)},o.prototype.setCollapsed=function(e){this.parent instanceof t.ContainerCardVE&&this.parent.setCollapsed(e)},o.prototype.dropFile=function(n){var o=this;if(n.preventDefault(),n.stopPropagation(),n.dataTransfer.files.length>0){var i=this.args.context;if(this.args.context instanceof t.PlaceholderCardVE&&(i=this.args.context.parent),i instanceof t.ComplexHeadingCardVE){var r=i.getPlaceholderCard();r&&r.setFocus()}else if(i instanceof t.ContainerCardVE){var a=i;a.setCollapsed(!1);var s=a.getLastChild();if(s)s.activateItem();else if(a instanceof t.SetCardVE){var l=a.getPlaceholderCard1();l&&(l.setFocus(),l.setActivePlaceholder())}}e.Model.currentUndoManager().get(this.pageId).captureUserUpdate(function(){var t=e.Model.AuthoringModel.StoryController.getFilesFromDataTransfer(n.dataTransfer);o.args.fileUploader.uploadFiles(FileObject.createFileObjects(t));var i=new ClientAction.FileDraggedAndDropped(t.length);ActionLogger.RecordClientAction(i)},"User dropped file(s) from their desktop onto a CardDropTarget")}return!1},o}(TDB.FocusableViewElement);t.CardDropTargetOverlayVEBase=n}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){e[e.Label=0]="Label"}(e.CardLabelMenuItemId||(e.CardLabelMenuItemId={}));var t=function(e){function t(t,n){var o=e.call(this,t)||this;return o.textWatchable=TDB.watchableOption(o,n.text),o.textVisibleWatchable=TDB.watchableOption(o,n.textVisible,!0),o}return __extends(t,e),t.prototype.labelTextArgs=function(e){return this.textVisibleWatchable.getWatchedValue(e)?this.textWatchable.getWatchedValue(e):null},t.prototype.labelAttrArgs=function(e){var t={};return this.textVisibleWatchable.getWatchedValue(e)&&(t[Aria.Attributes.Title]=this.textWatchable.getWatchedValue(e)),t},t.prototype.cardLabelWrapperCssArgs=function(e){return{CardLabelSocket:this.parent.getViewModel().inSocket()}},t}(TDB.FocusableViewElement);e.CardLabelVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t,n){var o=e.call(this,t)||this;return o.cardSelectionManager=n.cardSelectionManager,o}return __extends(t,e),t.prototype.selectedCountTextArgs=function(e){var t=this.cardSelectionManager.getSelection(e);return t.length>1?ResourceManager.ResolveString(Resources.CardSelectionCountLabelPlural,[t.length]):ResourceManager.ResolveString(Resources.CardSelectionCountLabel,[t.length])},t}(TDB.FocusableViewElement);e.MultiSelectCardLabelVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel,o=function(e){function o(t,o){var i=e.call(this,t)||this;return i.args=o,i._switchToLightGlyphsNestingLevel=6,i._host=o.host,i.cardDeckMenu=o.cardDeckMenu,i._authoringModel=o.authoringModel,i._cardDeckAnimationsComplete=o.cardDeckAnimationsComplete,i._paneStateManager=o.paneStateManager,i._cardSelectionManager=o.cardSelectionManager,i.card=o.card,i._cardControls=new n.CardControlsViewModel({card:i.card,paneStateManager:o.paneStateManager,transformManager:o.transformManager,cardsContainer:o.cardsContainer,cardSelectionManager:i._cardSelectionManager,pageId:i.pageId}),i._cardContentControls=new n.CardContentControlsViewModel({cardsContainer:o.cardsContainer,cardSelectionManager:i._cardSelectionManager,card:i.card,resourceFactory:i.args.resourceFactory,textDirectionButtonsVisible:o.authoringModel.textDirectionButtonsVisible,pageId:i.pageId}),i._positionAdjust=TDB.watcherTag(596473665,i,i,i.calculatePositionAdjust),i.createSelectedCountMenuItem(),i}return __extends(o,e),o.prototype.controlsHaveMenuButtons=function(e){var t=this._cardContentControls.getMenuItems(e).some(function(t){return t.getViewElementVisible(e)}),n=this._cardControls.getMenuItems(e).some(function(t){return t.getViewElementVisible(e)});return t||n},o.prototype.innerWrapperDynamicMenuChunksArgs=function(e){var n=[];if(e.watch(this._cardDeckAnimationsComplete),n.push(this._cardControls),this._cardContentControls.hasVisibleElements(e))n.push(this._cardContentControls);else if(this.card instanceof t.ContainerCardVE){var o=this.card.getHeaderButton(e);o&&n.push(new VE.BasicMenuChunk([o]))}else if(this.card.labelVisible(e)&&this.card.getLabelMenuItem(e))n.push(new VE.BasicMenuChunk([this.card.getLabelMenuItem(e)]));else{var i=this.getSelectedCount(e);i&&n.push(new VE.BasicMenuChunk([i]))}return{visible:this._host.menuVisible(e),menuChunks:n,widthBuffer:this._positionAdjust.getWatchedValue(e)}},o.prototype.wrapperClassNameArgs=function(e){var n=(this.card.additionalCSSMenuClasses?" ":"")+this.card.additionalCSSMenuClasses;if(this.card.getViewModel().inTeaserMode(e))return"CardMenuTeaser"+n;if(this.cardDeckMenu)return this._paneStateManager.standardPaneVisible(e)?"CardDeckMenu CardsHorizontalConstraint CardsHorizontalConstraintWithStandardPane"+n:"CardDeckMenu CardsHorizontalConstraint"+n;var o=this._cardSelectionManager.isInMultiselectMode(e);return this._host.menuVisible(e)&&o?"CardMenuMultiselect"+n:t.CardMenuVE.useExpandedGroupClass(e,this.card)?"CardMenuExpandedGroup"+n:"CardMenu"+n},o.prototype.innerWrapperClassNameArgs=function(e){var n=this.cardDeckMenu?" "+t.CardMenuVE.InnerWrapperCardDeckClassName:"",o=this.card.isHostedInPopup()?" "+t.CardMenuVE.InnerWrapperPopupClassName:"";return t.CardMenuVE.InnerWrapperCardMenuClassName+n+o},o.prototype.wrapperFadeVisibleInitArgs=function(){return{disabled:this.cardDeckMenu||StoryApp.Utilities.browser.isChrome53}},o.prototype.wrapperFadeVisibleArgs=function(e){return{visible:this._host.menuVisible(e)&&this.card.getViewModel().isInteractive(e)}},o.prototype.editButtonsWrapperClassNameArgs=function(e){var n=this._cardSelectionManager.isInMultiselectMode(e),o=this.card.isExpanded(e),i=!(this.card.getPrimaryInputElement()instanceof t.CommonTextVE);return n||i||o?"CardMenuEditButtonsWrapperTransparent":"CardMenuEditButtonsWrapper"},o.prototype.ifEditButtonsArgs=function(e){return!this.card.getViewModel().inTeaserMode(e)},o.prototype.isSelectedCountVisible=function(e){return this._cardSelectionManager.isInMultiselectMode(e)},o.prototype.createSelectedCountMenuItem=function(){var e={cardSelectionManager:this._cardSelectionManager};this.selectedCount=new VE.StaticMenuItem({primaryType:t.MultiSelectCardLabelVE,primaryArgs:e})},o.prototype.getSelectedCount=function(e){return this.isSelectedCountVisible(e)&&this.ifEditButtonsArgs(e)?this.selectedCount:void 0},o.prototype.selectedCountArgs=function(e){var t=this.getSelectedCount(e);return t&&t.getPrimaryArgs()},o.prototype.cardButtonsWrapperClassNameArgs=function(e){var t,n=this._cardSelectionManager.isInMultiselectMode(e),o=this.card.getViewModel().inTeaserMode(e),i=this.shouldUseLightForeground(e);return this._host.menuVisible(e),n?t=o?"CardMenuButtonsWrapperMultiselectTeaser":"CardMenuButtonsWrapperMultiselect":this.cardDeckMenu?t="CardMenuButtonsWrapperCardDeck":i?t="CardMenuButtonsWrapperLight":o||(t="CardMenuButtonsWrapper"),t},o.prototype.cardControlsArgs=function(){return new TDB.ChildArgs(t.CardControlsVE,this._cardControls)},o.prototype.cardContentControlsArgs=function(){return new TDB.ChildArgs(t.CardContentControlsVE,this._cardContentControls)},o.prototype.isVisible=function(e){return this._host.menuVisible(e)},o.prototype.wrapperStyleArgs=function(e){var n,o,i,r,a=this._host.menuVisible(e)&&this.controlsHaveMenuButtons(e);if(this.cardDeckMenu&&(r=(65+UX.GetScrollbarSize()).toString()+"px"),t.CardMenuVE.useExpandedGroupClass(e,this.card)){var s=this._positionAdjust.getWatchedValue(e)+"px";n=s,o=s,i="auto"}var l={visibility:a?"inherit":void 0,display:a?void 0:"none",right:n,left:o,width:i};return l[CommonSettings.SiteUiRtl?"padding-left":"padding-right"]=r,l},o.useExpandedGroupClass=function(e,n){if(!n.isExpanded(e))return!1;var o=n instanceof t.ContainerCardVE,i=n.getViewModel().hasSockets();return o||i},o.useCollapsedGroupClass=function(e,n){return n instanceof t.ContainerCardVE&&n.isCollapsed(e)},o.prototype.dispose=function(){var t=this;e.prototype.dispose.call(this),platform.setTimeout(function(){TDB.FocusableViewElement.removeFocusListener(t)},0)},o.prototype.shouldUseLightForeground=function(e){return this.card instanceof t.SetCardVE&&!this.card.isCollapsed(e)&&this.card.cardNestingLevel>this._switchToLightGlyphsNestingLevel},o.prototype.hasVisibleContentControls=function(e){return this._cardContentControls.hasVisibleElements(e)},o.prototype.calculatePositionAdjust=function(e){var n=this._authoringModel.isCardDeckVisible(e);return this._cardSelectionManager.isSelected(this.card,e),t.CardMenuVE.useExpandedGroupClass(e,this.card)?n?-24:-6:0},o.prototype.hasRoomForLabel=function(e){return!this._cardContentControls.hasVisibleElements(e)},o.areEqual=function(e,t){return Obj.equalsObj(e,t)},o.InnerWrapperCardDeckClassName="CardDeckMenuInnerWrapper",o.InnerWrapperPopupClassName="PopupCardMenuInnerWrapper",o.InnerWrapperCardMenuClassName="CardMenuInnerWrapper",o}(TDB.FocusableViewElement);t.CardMenuVEBase=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(n){function o(e,t){var o=this,i={buttonId:ClientAction.ButtonId.CardAction_Select,role:Aria.Roles.Checkbox,shortcutIdentifiers:["SpaceKey"],tabIndex:t.tabIndex,description:{value:Resources.CardSelectionButtonDescription},tooltip:{value:Resources.CardSelectionButtonDescription}};return o=n.call(this,e,i)||this,o._checkmarkVisible=t.checkmarkVisible,o._checkmarkChecked=t.checkmarkChecked,o._cardSelectionManager=t.cardSelectionManager,o._authoringModel=t.authoringModel,o}return __extends(o,n),o.prototype.checkboxAttrArgs=function(e){if(this.checkboxVisible(e)){var t=this._checkmarkChecked.getWatchedValue(e);return this.getCheckboxWrapperAttributes(e,t)}return{}},o.prototype.selectionCountLabelFadeVisibleInitArgs=function(){return{visibleInit:!1}},o.prototype.checkmarkArgs=function(e){if(this.checkboxVisible(e)){var n={fontIconName:{value:FontIcons.CheckboxFontIcon},fontIconSizeClass:FontIcons.CheckboxFontIconSize};return new TDB.ChildArgs(t.FontIconVE,n)}},o.prototype.checkboxVisible=function(e){return this._authoringModel.isCardDeckVisible(e)&&(this._checkmarkVisible.getWatchedValue(e)||this._cardSelectionManager.isInMultiselectMode(e))},o.prototype.checkboxClassNameArgs=function(e){var t=this._checkmarkChecked.getWatchedValue(e)?"CardSelectionBarCheckmarkChecked":"CardSelectionBarCheckmarkUnchecked";return t+=this.hintPresent(e)?" CardSelectionBarCheckmarkWithHint":" CardSelectionBarCheckmarkNoHint"},o.prototype.onAction=function(e){return this.selectCard(),TDB.EventPropagation.PreventDefault},o.prototype.selectCard=function(){this.parent.getViewModel().selectCard()},o.prototype.handleShortcutKey=function(e){return this.isVisible()&&this.checkboxVisible()?this.action(e):TDB.EventPropagation.Bubble},o.prototype.wrapperClassNameArgs=function(e){return this.hintPresent(e)?"CardSelectionBarWithHint":"CardSelectionBar"},o.prototype.hintPresent=function(t){return!!(this.parent instanceof e.TextCardVE&&this.parent.authoringHintWrapperVisibleArgs(t))||!!(this.parent instanceof e.MediaCardVE&&this.parent.authoringHintWrapperVisibleArgs(t))},o}(t.CheckboxVE);e.CardSelectionBarVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.cardSelectionStatusTextArgs=function(e){return this.parent.getViewModel().getStorylineDescriptionWithStateInMultipleSelection(e)},t.prototype.isFocusable=function(t){return e.prototype.isFocusable.call(this,t)&&this.parent.getViewModel().getSelectionState(t)},t.prototype.mouseClicked=function(e){return this.parent.getViewModel().selectCard(),TDB.EventPropagation.Bypass},t}(TDB.Control);e.CardSelectionStatusVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.wrapperTouchToMouseArgs=function(e){return{enabled:!0}},t.prototype.wrapperCssArgs=function(e){return{CardSideBarSocket:this.parent.getViewModel().inSocket()}},t}(TDB.FocusableViewElement);e.CardSidebarVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(n){function o(e,t){var o=n.call(this,e)||this;return o.buttonClass="CardProgressButton",o.cardVE=e,o.uploader=t,o}return __extends(o,n),o.prototype.createPauseButton=function(){var e={buttonId:ClientAction.ButtonId.Upload_Pause,click:this.pauseUpload,context:this,cssClass:{value:this.buttonClass},description:{value:Resources.PauseUploadButtonDescription},fontIconName:{value:FontIcons.CardProgressPauseIcon},fontIconSizeClass:FontIcons.CardProgressIconSize};return new TDB.ChildArgs(t.GlyphButtonVE,e)},o.prototype.createResumeButton=function(){var e={buttonId:ClientAction.ButtonId.Upload_Resume,click:this.resumeUpload,context:this,cssClass:{value:this.buttonClass},description:{value:Resources.ResumeUploadButtonDescription},fontIconName:{value:FontIcons.CardProgressPlayIcon},fontIconSizeClass:FontIcons.CardProgressIconSize};return new TDB.ChildArgs(t.GlyphButtonVE,e)},o.prototype.createRetryButton=function(){var e={buttonId:ClientAction.ButtonId.Upload_Retry,click:this.retryUpload,context:this,cssClass:{value:this.buttonClass},description:{value:Resources.RetryUploadButtonDescription},fontIconName:{value:FontIcons.CardProgressRetryIcon},fontIconSizeClass:FontIcons.CardProgressIconSize};return new TDB.ChildArgs(t.GlyphButtonVE,e)},o.prototype.isPaused=function(e){return!!this.uploader&&this.uploader.isPaused(e)},o.prototype.isFaulted=function(e){return!!this.uploader&&this.uploader.isFaulted(e)},o.prototype.pauseUpload=function(e){return this.logProgressAction(ClientAction.ActionType.FileUpload_Pause),this.uploader&&this.uploader.pauseUpload(),TDB.EventPropagation.Bypass},o.prototype.resumeUpload=function(e){return this.logProgressAction(ClientAction.ActionType.FileUpload_Resume),this.uploader&&this.uploader.resumeUpload(),TDB.EventPropagation.Bypass},o.prototype.retryUpload=function(e){return this.logProgressAction(ClientAction.ActionType.FileUpload_Retry),this.uploader&&this.uploader.retryUpload(),TDB.EventPropagation.Bypass},o.prototype.logProgressAction=function(e){var t=this.cardVE.getViewModel().getModelId(),n=this.uploader?this.uploader.getProgress():100,o=new ClientAction.FileUploadProgressData(e,t,n);ActionLogger.RecordClientAction(o)},o.prototype.secondaryButtonArgs=function(e){return this.isFaulted(e)?this.createRetryButton():this.isPaused(e)?this.createResumeButton():this.uploader.canPauseUpload()?this.createPauseButton():void 0},o.prototype.progressBarArgs=function(t){var n={progressUpdater:new e.UploadProgressUpdater(this.uploader)};return new TDB.ChildArgs(e.CardProgressBarVE,n)},o}(TDB.FocusableViewElement);e.CardUploadProgressVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel;!function(e){e[e.CollapseButton=0]="CollapseButton"}(t.CardHeaderMenuItemId||(t.CardHeaderMenuItemId={}));var o=function(e){function o(t,n){var o=e.call(this,t)||this;return o._authoringModel=n.authoringModel,o._cardSelectionManager=n.cardSelectionManager,o.visible=TDB.watchableOption(o,n.visible,!0),o.buttonArgs=n.buttonArgs,o}return __extends(o,e),o.prototype.ifContainerCardHeaderArgs=function(e){return e.watchValue(this.visible)},o.prototype.backgroundStyleArgs=function(e){var o,i,r,a,s,l,c=this._cardSelectionManager.isSelected(this.parent,e),d=this.parent.getViewModel().isCollapsed(e),u=this._authoringModel.isCardDeckVisible(e);if(d)o="0px",i="0px",r="white";else{var p=u?t.ContainerCardHeaderVE.backplaneExtension:t.ContainerCardHeaderVE.smallBackplaneExtension;o="-"+p+"px",i="-"+p+"px",r="rgba(0,0,0, "+n.ContainerCardViewModel.BackgroundOpacityLevel+")"}return c&&(a="solid",s="rgb(0,130,114)",l="2px"),{left:o,right:i,backgroundColor:r,borderStyle:a,borderColor:s,borderWidth:l}},o.prototype.headerCssArgs=function(e){var n=this.parent.getViewModel().isCollapsed(e),o=this._cardSelectionManager.isInMultiselectMode(e),i=this._cardSelectionManager.isSelected(this.parent,e);return o=o&&i,{ContainerCardHeaderMultiselect:(this.parent.cardType===t.CardType.Group||o)&&n,ContainerCardHeaderExpanded:!n,ContainerCardHeaderCollapsed:n,ContainerCardHeaderCollapsedCardFocused:n&&this.parent.isActiveItem(e)}},o.prototype.headerTouchToMouseArgs=function(e){return{enabled:!0}},o.prototype.headerButtonArgs=function(){return this.buttonArgs},o.backplaneExtension=24,o.smallBackplaneExtension=6,o}(TDB.FocusableViewElement);t.ContainerCardHeaderVEBase=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(n,o){var i=e.call(this,n,o)||this;return i._viewModel=o.viewModel,i.additionalCSSMenuClasses=t.additionalCSSString,i}return __extends(t,e),t.prototype.overlayIconArgs=function(){return this._viewModel.getOverlayIcon()},t.prototype.imageAttrArgs=function(e){return{src:this._viewModel.getImageSource(e),alt:this._viewModel.createAltText(e)}},t.prototype.imageStyleArgs=function(e){var t={};return t[this._viewModel.calculateResizingBase()]="100%",t},t.prototype.imageEventsInitArgs=function(){var e={};return e.dragstart=function(e){return e.preventDefault(),!1},e},t.prototype.labelVisible=function(e){return!1},t.additionalCSSString="CardMenuNoPlaceholder CardMenuMediaSocket",t}(e.CardVE);e.ImageSocketVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return __extends(o,e),o.prototype.getImageSource=function(e){var t=this.socket.getModelObject();return n.ImageController.calculateSourceUrl(t,e,o.MaxImageWidth)},o.prototype.getOverlayIcon=function(){},o.prototype.createAltText=function(e){var t=this.socket.getModelObject();return n.MediaController.getDefaultAltText(t,e)},o.prototype.getStorylineDescription=function(e){return Resources.ImageSocketTitle},o.prototype.canTakeAction=function(o,i){if(o===t.CardAction.Remove)return!1;if(o==t.CardAction.Focus){var r=this.socket.getModelObject(),a=this._cardVE?this._cardVE.cardParent:void 0,s=a?a.getViewModel().getSocketDefinition()?a.getViewModel().getSocketDefinition().getCardCapabilities().focus:a.getViewModel().getCardDefinition().getCardControls().focus:void 0;return!!(this.card.model&&n.ImageController.isImageSizeKnown(r,i)&&s)}return e.prototype.canTakeAction.call(this,o,i)},o.prototype.calculateResizingBase=function(){var e=this.socket.getModelObject(),t=n.ImageController.getImageSize(e),i=t.width,r=t.height;return i/o.MaxImageWidth>r/o.MaxImageHeight?"width":"height"},o.MaxImageWidth=860,o.MaxImageHeight=222,o}(t.CardViewModel);t.ImageSocketViewModel=o}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getOverlayIcon=function(){var e={fontIconName:{value:FontIcons.VideoIcon},fontIconSizeClass:FontIcons.VideoSocketIconSize,fontIconWrapperClass:{value:"ImageSocketOverlayIcon"},fontIconBackgroundColorClass:"ThumbnailFontIconBackgroundColor"};return new TDB.ChildArgs(VE.FontIconVE,e)},t}(e.ImageSocketViewModel);e.VideoImageSocketViewModel=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(n,o){var i=e.call(this,n,o)||this;return i._viewModel=o.viewModel,i.additionalCSSMenuClasses=t.additionalCSSString,i}return __extends(t,e),t.prototype.imageAttrArgs=function(e){return{src:Icons.AudioWaveform,alt:this._viewModel.createAltText(e)}},t.prototype.imageEventsInitArgs=function(){var e={};return e.dragstart=function(e){return e.preventDefault(),!1},e},t.prototype.labelVisible=function(e){return!1},t.additionalCSSString="CardMenuNoPlaceholder CardMenuMediaSocket",t}(e.CardVE);e.AudioThumbnailSocketVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return __extends(o,e),o.prototype.createAltText=function(e){var t=this.socket.getModelObject();return n.MediaController.getDefaultAltText(t,e)},o.prototype.getStorylineDescription=function(e){return Resources.AudioThumbnailSocketTitle},o.prototype.canTakeAction=function(n,o){return n!==t.CardAction.Remove&&(n!=t.CardAction.Focus&&e.prototype.canTakeAction.call(this,n,o))},o}(t.CardViewModel);t.AudioThumbnailSocketViewModel=o}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=function(o){function i(e,t,i){var r=o.call(this,e,t,i)||this;return r.card=new n.ClosedCaptionCard({model:t,definition:i.cardDefinition}),r.controller=n.currentClosedCaptionController().get(i.authoringModel.getPageId()),r}return __extends(i,o),i.prototype.getSelectedLanguage=function(e){var n=this.card.model.getLanguage(e);return new t.Language(n)},i.prototype.isSelectedLanguage=function(e,t){return!!e&&this.getSelectedLanguage(t).getId()===e.getId()},i.prototype.getSocket=function(){return this._cardVE.cardParent.getViewModel().getSocket()},i.prototype.getFileName=function(e){return this.card.model.getFileName(e)},i.prototype.getLanguage=function(e){return this.card.model.getLanguage(e)},i.prototype.getMedia=function(e){return this.card.model.getContent(e)},i.prototype.isErrorMessageVisible=function(e){var t=!1;return n.StoryController.isModelObjectValid(this.card.model)&&(this.getMedia(e)&&(t=this.isInErrorUploadState(e)),t||(t=this.languageIsAlreadyUsed(e))),t},i.prototype.isSpinnerVisible=function(e){return this.getUploadStatus(e)===n.UploadStatus.Uploading},i.prototype.getUploadStatus=function(e){var t=this.getMedia(e);return this.controller.getUploadStatus(t,e)},i.prototype.getErrorText=function(e){if(this.getMedia(e)){if(this.isInErrorUploadState(e))return Resources.ClosedCaptionGenericError;if(this.languageIsAlreadyUsed(e))return Resources.ClosedCaptionLanguageExistsError}return""},i.prototype.isInErrorUploadState=function(e){var t=this.getUploadStatus(e);return t===n.UploadStatus.Error||t===n.UploadStatus.PreprocessingError},i.prototype.languageIsAlreadyUsed=function(e){return this.getParentViewModel().languageIsAlreadyUsed(this.card.model,e)},i.prototype.changeLanguage=function(t){var n=this;if(t&&!this.isSelectedLanguage(t)){e.Model.currentUndoManager().get(this._args.authoringModel.getPageId()).captureUserUpdate(function(){n.card.model.setLanguage(t.getId())},"Update closed caption model to the newly selected language");var o=new ClientAction.ButtonClickAction(ClientAction.ButtonId.ClosedCaptionSocket_LanguageDropdown,Diag.ULSCat.msoulscat_Story_Storyline,{Language:t.getId()});ActionLogger.RecordClientAction(o)}},i.prototype.getParentViewModel=function(){return this._cardVE.cardParent.getViewModel()},i.prototype.isLanguageEnabled=function(e,t){if(!e)return!1;if(this.isSelectedLanguage(e,t))return!0;var n=this.getParentViewModel().reservedLanguageIds.getWatchedValue(t);return!ArrayExtensions.contains(n,e.getId())},i}(t.CardViewModel);t.ClosedCaptionSocketViewModel=o}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t;!function(e){e[e.FocusableSurrogate=1]="FocusableSurrogate",e[e.DropdownList=2]="DropdownList",e[e.LowImportance=Number.MAX_VALUE]="LowImportance"}(t=e.TypeImportance||(e.TypeImportance={}));var n=function(n){function o(e,t){var i=this;return t.cardLabelText=ResourceManager.ResolveString(Resources.ClosedCaptionSocketCardTitle,[t.viewModel.getFileName()]),i=n.call(this,e,t)||this,i._viewModel=t.viewModel,i.languageDropdownWrapperClassName=TDB.watchableTag(596473664,i,o.c_defaultLanguageDropdownWrapperClass),i}return __extends(o,n),o.prototype.getViewModel=function(){return this._viewModel},o.prototype.labelTextVisible=function(e){return!0},o.prototype.spinnerStyleArgs=function(e){return this._viewModel.isSpinnerVisible(e)?{backgroundImage:"url("+CommonSettings.ContentBaseUrl+o.spinnerGif+")"}:{backgroundImage:void 0}},o.prototype.showLanguageDropdown=function(){var e=this;this.languageDropdownList&&!this.languageDropdownList.getDropdownVisibility()&&(TDB.applyUpdate(function(){return e.languageDropdownWrapperClassName.setValue(e.getLanguageDropdownWrapperClassName())}),this.languageDropdownList.setDropdownVisibility(!0))},o.prototype.ifErrorMessageArgs=function(e){return this._viewModel.isErrorMessageVisible(e)},o.prototype.errorMessageTextArgs=function(e){return this._viewModel.getErrorText(e)},o.prototype.closedCaptionErrorWrapperAttrArgs=function(e){return n.prototype.mediaCardErrorWrapperAttrArgs.call(this,e)},o.prototype.languageDropdownPlaceholderVisibleArgs=function(e){return!this.menuVisible(e)},o.prototype.languageDropdownPlaceholderTextArgs=function(e){return this._viewModel.getSelectedLanguage(e).getName()},o.prototype.languageDropdownListArgs=function(t){var n=this;if(this.menuVisible(t)){var o={headerText:Resources.LanguageLabel,headerId:"LanguageLabel",wrapperClassName:{watchable:this.languageDropdownWrapperClassName},dropdownButtonArgs:this.getSelectedLanguageOptionArgs(),listItemType:e.LanguageOptionVE,listItemsArgs:{compute:new TDB.ComputedOptionArgs(this,function(e){return n.getLanguageOptions(e)})},hideOnExit:!0,dropdownTelemetryId:ClientAction.ButtonId.ClosedCaptionSocket_LanguageDropdown,ulsCategory:Diag.ULSCat.msoulscat_Story_Storyline};return new TDB.ChildArgs(VE.DropdownListVE,o)}},o.prototype.getSelectedLanguageOptionArgs=function(){var e=this;return{context:this,isSelected:{value:!1},language:{compute:new TDB.ComputedOptionArgs(this,function(t){return e._viewModel.getSelectedLanguage(t)})},buttonId:ClientAction.ButtonId.SwaySettingsPane_LanguageDropdown,onAction:this.onSelectedLanguageAction}},o.prototype.onSelectedLanguageAction=function(e,t,n){var o=this;return this.languageDropdownList&&this.languageDropdownList.getDropdownVisibility()&&TDB.applyUpdate(function(){return o.languageDropdownWrapperClassName.setValue(o.getLanguageDropdownWrapperClassName())}),!1},o.prototype.getLanguageDropdownWrapperClassName=function(){var e=StoryApp.Common.Environment.getInstance().getWindowHeight().getWatchedValue(),t=this.languageSpinnerWrapperPositionBinding.getPosition().bottom+o.c_maxDropdownPopupHeight<e;return o.c_defaultLanguageDropdownWrapperClass.concat(" ClosedCaptionSocketLanguagePickerWrapperDropdown",t?"Below":"Above")},o.prototype.getLanguageOptions=function(e){for(var t=this,n=this.cardParent.getViewModel().getFilteredLanguages(e),o=[],i=this,r=0;r<n.length;r++)!function(e){var r=n[e],a={context:i,isSelected:{compute:new TDB.ComputedOptionArgs(i,function(e){return t._viewModel.isSelectedLanguage(r,e)})},onAction:i.changeLanguageOnAction,language:{value:r},enabled:{compute:new TDB.ComputedOptionArgs(i,function(e){return t._viewModel.isLanguageEnabled(r,e)})},buttonId:ClientAction.ButtonId.ClosedCaptionSocket_LanguageOption,description:{value:r.getName()}};o.push(a)}(r);return o},o.prototype.changeLanguageOnAction=function(e,t,n){return this._viewModel.changeLanguage(n),!1},o.prototype.getActivatableChildren=function(){var t=this,n=this.getFocusableElements();return n.sort(function(o,i){var r=e.ClosedCaptionSocketVE.getElementImportance(o)-e.ClosedCaptionSocketVE.getElementImportance(i);return 0===r?o.compareTabbingOrderTo(i,TDB.ControlSet.contentFlowDirection,t,n):r})},o.getElementImportance=function(e){return e instanceof TDB.FocusableSurrogate?t.FocusableSurrogate:e instanceof VE.DropdownListVE?t.DropdownList:t.LowImportance},o.c_maxDropdownPopupHeight=160,o.c_defaultLanguageDropdownWrapperClass="ClosedCaptionSocketLanguagePickerWrapper",o.spinnerGif="spinner_16x16.gif",o}(e.CardVE);e.ClosedCaptionSocketVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getChildCards=function(e){return this.getContentCards(e)},t.prototype.containsHeader=function(e){return!1},t.prototype.labelVisible=function(e){return!1},t.prototype.cardLabelWrapperTouchToMouseArgs=function(e){return{enabled:!0}},t.prototype.overlayLabelTextArgs=function(e){return this.cardLabelDefaultText},t.prototype.childAcceptDraggables=function(e,t){return!1},t.prototype.canActivateItem=function(){return!1},t}(e.ContainerCardVE);e.SocketContainerCardVE=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createViewModelChildren=function(){this.viewModelChildren=TDB.mappedWatcherOwnerTag(596473630,this,this,this.getSocketModelChildren,this.viewSocketModelConstructor)},t.prototype.getSocketModelChildren=function(e){for(var t=[],n=this.getChildren(e),o=n.length,i=0;i<o;i++){var r=n[i],a={socket:this.socket,model:r};t[i]=a}var s={socket:this.socket,model:null};return t[o]=s,t},t.prototype.viewSocketModelConstructor=function(e){return null===e.model?this._args.cardFactory.createEmptySocketCardVM(null,e.socket):this._args.cardFactory.createViewModel(null,{model:e.model,socket:e.socket})},t.prototype.inPlaceholderMode=function(e){return!1},t.prototype.getLabel=function(e){return""},t}(e.ContainerCardViewModel);e.SocketContainerCardViewModel=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(t){function n(e,n){var o=t.call(this,e,n)||this;return o._viewModel=n.viewModel,o}return __extends(n,t),n.prototype.getViewModel=function(){return this._viewModel},n.prototype.contentCardsArgs=function(e){return this._viewModel.createCardArgs(e)},n.prototype.ifSocketLabelArgs=function(e){return t.prototype.ifSocketLabelArgs.call(this)&&this._viewModel.getChildren(e).length>0},n.prototype.onFocusedElementRemoval=function(n){n instanceof e.EmptySocketVE||t.prototype.onFocusedElementRemoval.call(this,n)},n}(e.SocketContainerCardVE);e.ClosedCaptionsSocketContainerCardVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=function(e){function o(t,n,o){var i=e.call(this,t,n,o)||this;return i.languages=o.authoringModel.languages,i.reservedLanguageIds=TDB.watcherTag(596473635,i,i,i.calculateReservedLanguageIds),i}return __extends(o,e),o.prototype.getFilteredLanguages=function(e){return this.languages.getWatchedValue(e).filter(function(e){var t=e.getName();return t&&t.length>0}).sort(function(e,t){return e.getName().localeCompare(t.getName(),CommonSettings.UserLocaleString)})},o.prototype.createCardArgs=function(e){for(var t=[],n=this.viewModelChildren.getWatchedValue(e),o=n.length,i=0;i<o;i++)t.push(this._args.cardFactory.createArgs({viewModel:n[i],cardParent:this._cardVE,showSocketLabel:0!==i}));return t},o.prototype.getChildren=function(e){var t=this.socket.getParentModelObject(),o=new Array;return t instanceof n.MediaWithTextComposite&&(o=t.closedCaptions.getCollection(e)),o},o.prototype.calculateReservedLanguageIds=function(e){for(var t=[],o=this.getChildren(e),i=o.length,r=0;r<i;r++){var a=o[r];a instanceof n.ClosedCaptionComposite&&t.push(a.getLanguage(e))}return t},o.prototype.getLanguageForNewChild=function(){for(var e=new t.Language(this._args.authoringModel.model.traversalModel.getCulture()),n=[e].concat(this.getFilteredLanguages()),o=this.calculateReservedLanguageIds(),i=n.length,r=0;r<i;r++){var a=n[r];if(a&&a.getId()&&!ArrayExtensions.contains(o,a.getId()))return a}return e},o.prototype.getStorylineDescription=function(e){return Resources.ClosedCaptionSocketTitle},o.prototype.languageIsAlreadyUsed=function(e,t){for(var n=this.getChildren(t).indexOf(e),o=this.reservedLanguageIds.getWatchedValue(t),i=e.getLanguage(t),r=n-1;r>=0;r--)if(o[r]===i)return!0;return!1},o}(t.SocketContainerCardViewModel);t.ClosedCaptionsSocketContainerCardViewModel=o}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.View.ViewModel,i=StoryApp.View.ViewElements,r=StoryApp.View.Common.FRE,a=function(e){function a(t,n){var i=e.call(this,t)||this;return i.menuVisible=TDB.watchableTag(596473627,i,!1),i.visible=TDB.watchableOption(i,n.visible),i.args=n,i.isHighContrastMode=StoryApp.Utilities.isHighContrastMode(),i._viewModel=new o.JackViewModel(i,t,i.createNewMenuArgs(n)),i}return __extends(a,e),a.prototype.createNewMenuArgs=function(e){var t=this;return{cardsContainer:e.cardsContainer,cardDefinitionManager:e.cardDefinitionManager,pageId:this.pageId,paneStateManager:e.paneStateManager,parentCardType:e.cardType,showTriangle:this.args.showJackIcon,optionClickedCallback:function(){return t.closeMenu()}}},a.prototype.getViewModel=function(){return this._viewModel},a.prototype.wrapperStyleArgs=function(e){var t=e.watchValue(this.visible)?void 0:"none";return{top:this.args.showJackIcon?void 0:this._viewModel.areNewMenuTabsVisible(e)?"23px":"40px",display:t}},a.prototype.jackIconArgs=function(e){if(this.args.showJackIcon&&e.watchValue(this.visible)){var t={buttonId:ClientAction.ButtonId.Jack_AddMoreContent,click:this.jackClicked,context:this,description:{value:Resources.PlusJackCardButtonDescription},tooltip:{value:Resources.PlusJackCardButtonDescription},fontIconName:{value:FontIcons.JackDiamondIcon},fontIconSizeClass:FontIcons.JackDiamondIconSize,cssClass:{value:"JackButton"},shortcutIdentifiers:["Alt+Shift+AKey"]};return new TDB.ChildArgs(i.GlyphButtonVE,t)}},a.prototype.menuArgs=function(e){if(this.menuVisible.getWatchedValue(e)){var n=this.args;return new TDB.ChildArgs(t.JackMenuVE,{cardDeckAnimationsComplete:n.cardDeckAnimationsComplete,cardType:n.cardType,model:this.getViewModel().getNewMenu(e),parentCard:this.parent,visible:this.menuVisible})}},a.prototype.isVisible=function(e){return this.visible.getWatchedValue(e)},a.prototype.addModelObjects=function(e,o){if(ArrayExtensions.count(e,function(e){return e.model instanceof n.DocumentContent})>0&&this.parent&&this.parent.parent instanceof t.SetCardVE)return!1;if(0===e.length)return!0;var i=o?this.getViewModel().getInsertionPoint(!0):this.getViewModel().prepInsertion();return!!i&&(!!t.AddAction.isAvailable(e,{parent:i.parent,index:i.index},this.pageId)&&(t.AddAction.execute(e,{parent:i.parent,index:i.index},this.pageId,"Added card at Jack's current location"),!0))},a.prototype.jackClicked=function(){return this.toggleMenu(),TDB.EventPropagation.PreventDefault},a.prototype.mouseClicked=function(e){return this.toggleMenu(),TDB.EventPropagation.Bypass},a.prototype.toggleMenu=function(){this.isMenuShown()?this.closeMenu():this.openMenu()},a.prototype.openMenu=function(){var e=this;ActionLogger.RecordClientAction(new ClientAction.StorylineActionData(ClientAction.ActionType.Storyline_JackOpened,"User opened Jack",[this.parent.getViewModel().getModelId()],[t.CardType[this.parent.cardType]])),TDB.applyUpdate(function(){e.menuVisible.setValue(!0)}),this.menu?this.menu.scrollIntoView():this.parent.scrollIntoView(),r.FirstRunTriggers.jackClicked()},a.prototype.isMenuShown=function(e){return this.menuVisible.getWatchedValue(e)},a.prototype.closeMenu=function(e){var t=this;this.isMenuShown()&&TDB.applyUpdate(function(){t.menuVisible.setValue(!1)})},a.prototype.titleJackCalloutArgs=function(e){if(this.parent instanceof t.ComplexHeadingCardVE){var n=r.CalloutID.TitleJack;if(!r.getCalloutManager().isActiveCallout(e,n))return;return new TDB.ChildArgs(i.FRECalloutVE,r.CalloutArgsCreator.createArgsForTitleJack())}},a.JackMenuHeight=62,a}(TDB.FocusableViewElement);t.JackVEBase=a}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(e){function n(t,o){var i=this,r={buttonId:o.buttonId,tabIndex:o.tabIndex,visible:o.visible,enabled:o.enabled,description:{value:o.description},tooltip:{value:o.description}};return i=e.call(this,t,r)||this,i.parent=t,i.cardOptionId=o.id,i._title=o.title,i._context=o.context,i._clickCallback=o.clickCallback,i._fontIcon=o.fontIcon,i._wrapperCssClass=o.wrapperCssClass||n.WrapperCssClass,i._imageCssClass=o.imageCssClass||n.ImageCssClass,i._textCssClass=o.textCssClass||n.TextCssClass,i}return __extends(n,e),n.prototype.wrapperClassNameArgs=function(e){return this._wrapperCssClass},n.prototype.cardButtonAttrArgs=function(e){return this.getButtonAttributes(e)},n.prototype.cardButtonClassNameArgs=function(e){return this.isEnabled(e)?"NewCardOptionButton":"NewCardOptionButtonDisabled"},n.prototype.optionImageClassNameArgs=function(e){return this._imageCssClass},n.prototype.optionTextClassNameArgs=function(e){return this._textCssClass},n.prototype.optionTextTextArgs=function(e){return this._title},n.prototype.cardIconArgs=function(){var e={fontIconName:{value:this._fontIcon},fontIconSizeClass:FontIcons.CardOptionIconSize,fontIconWrapperClass:{value:"CardOptionIconWrapper"}};return new TDB.ChildArgs(t.FontIconVE,e)},n.prototype.onAction=function(e){return this._clickCallback.call(this._context,this.cardOptionId)},n.WrapperCssClass="NewCardOptionWrapper JackCardOptionDynamicWrapper",n.ImageCssClass="NewCardOptionImage",n.TextCssClass="NewCardOptionText",n.GlyphOnlyWrapperCssClass="NewCardOptionWrapper JackCardOptionDynamicWrapper JackCardOptionWrapperGlyphOnly",n.GlyphOnlyImageCssClass="JackCardOptionImageGlyphOnly",n.GlyphOnlyTextCssClass="JackCardOptionTextGlyphOnly",n.TextOnlyWrapperCssClass="NewCardOptionWrapper JackCardOptionDynamicWrapper",n.TextOnlyImageCssClass="JackCardOptionImageTextOnly",n.TextOnlyTextCssClass="JackCardOptionTextTextOnly",n}(t.ButtonVE);e.JackCardOptionVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t,n){var o=e.call(this,t,{features:TDB.ControlSetFeatures.HorizontalList|TDB.ControlSetFeatures.VerticalList|TDB.ControlSetFeatures.TabDisabled|TDB.ControlSetFeatures.TabInto})||this;return o._menuTabs=n.menuTabs,o._getSelectedTabIndex=n.getSelectedTabIndex,o}return __extends(t,e),t.prototype.cardOptionsArgs=function(e){var t=this._getSelectedTabIndex(e),n=this._menuTabs[t];return void 0!==n?n.menuItems.map(function(e){return e.getPrimaryArgs()}):void 0},t}(TDB.ControlSet);e.JackCardOptionsWrapperVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n,o=e.Model.AuthoringModel;!function(e){e.Suggested="Suggested",e.Text="Text",e.Media="Media",e.Group="Group"}(n=t.Tabs||(t.Tabs={}));var i;!function(e){e.Camera="Camera",e.Upload="Upload"}(i=t.SpecialCards||(t.SpecialCards={}));var r=function(){function e(){}return e.getMenuStructure=function(){var e=[o.ManualCardType.HeaderId,o.ManualCardType.SubHeaderId,o.ManualCardType.TextId];return StoryPageSettings.ShowCodeCardsButton&&e.push(o.ManualCardType.CodeId),[{id:n.Suggested,name:Resources.JackSuggestedTab,description:Resources.JackSuggestedTabDescription,menuItems:[o.ManualCardType.HeaderId,o.ManualCardType.TextId,o.ManualCardType.ImageId,o.ManualCardType.StackId,i.Upload]},{id:n.Text,name:Resources.CardsPanelSubHeaderText,description:Resources.JackTextTabDescription,menuItems:e},{id:n.Media,name:Resources.CardsPanelSubHeaderMedia,description:Resources.JackMediaTabDescription,menuItems:[o.ManualCardType.ImageId,o.ManualCardType.VideoId,o.ManualCardType.AudioId,o.ManualCardType.EmbedId,i.Upload,i.Camera]},{id:n.Group,name:Resources.CardsPanelSubHeaderGroup,description:Resources.JackGroupTabDescription,menuItems:[o.ManualCardType.GroupId,o.ManualCardType.UniformGridId,o.ManualCardType.ComparisonId,o.ManualCardType.StackId,o.ManualCardType.GalleryId]}]},e}();t.JackMenuStructure=r}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.View.ViewModel,i=function(e){function i(t,n){var o=e.call(this,t,{features:TDB.ControlSetFeatures.AutoEnter,visible:n.visible,getControllingElement:function(){return t&&t.parent}})||this;return o._cardDeckAnimationsComplete=n.cardDeckAnimationsComplete,o._parentCardType=n.cardType,o.parentCard=n.parentCard,o.scrollIntoViewWatchable=TDB.watchableTag(596131923,o,void 0),o._viewModel=n.model,o.createTabOptions(),o}return __extends(i,e),i.prototype.getViewModel=function(){return this._viewModel},i.prototype.getMenuItems=function(e){var t=this.tabHeader.getSelectedTabIndex(e),n=this.getViewModel().getMenuTabs()[t];return void 0!==n?n.menuItems:void 0},i.prototype.mouseClicked=function(e){return TDB.EventPropagation.PreventDefault},i.prototype.mouseDown=function(e){return TDB.EventPropagation.PreventDefault},i.prototype.getOverflowButtonWidth=function(){return 0},i.prototype.getOverflowButtonVisible=function(){return!1},i.prototype.predictOverflowButtonVisible=function(e){return!1},i.prototype.tabHeaderArgs=function(){return new TDB.ChildArgs(n.TabHeaderVE,this.tabHeader)},i.prototype.tabConstructor=function(e,t){var o=t.contentTab.description,i={text:t.contentTab.displayName,cssClass:"ContentNavRadioButton",selectedClass:"BasicContentPageTabSelected",index:e,description:o,tooltip:o};return new TDB.ChildArgs(n.TextTabVE,i)},i.prototype.tabSelected=function(e){var n=this.getViewModel().getTabsCollection(),o=n[this.tabHeader.getSelectedTabIndex()].contentTab.Id,i=n[e].contentTab.Id;o!==i&&ActionLogger.RecordClientAction(new ClientAction.StorylineJackChangeTab("User changed the selected tab in the New Jack Menu",o,i,t.CardType[this._parentCardType]))},i.prototype.createTabOptions=function(){var e=this,t={context:this,tabKeys:this.getViewModel().getTabsCollection(),tabConstructor:this.tabConstructor,tabSelected:this.tabSelected};this.tabHeader=new n.TabHeaderViewModel(t),TDB.applyUpdate(function(){e.tabHeader.selectTabIndex(0)},TDB.Justification.Initialization)},i.prototype.wrapperSlideVisibleInitArgs=function(){return!1},i.prototype.wrapperSlideVisibleArgs=function(e){return{visible:this.isVisible(e),duration:300,done:this.onPopupVisible}},i.prototype.wrapperStyleArgs=function(e){var n={},o=this.getViewModel().getOptionCount();return void 0!==o&&(n["min-width"]=o*t.JackMenuVE.OptionWidth+"px"),n},i.prototype.wrapperScrollIntoViewInitArgs=function(){return 50},i.prototype.wrapperScrollIntoViewArgs=function(e){return this.scrollIntoViewWatchable.getWatchedValue(e)},i.prototype.scrollIntoView=function(e){var t=this;TDB.applyUpdate(function(){t.scrollIntoViewWatchable.setValue(e),t.scrollIntoViewWatchable.notify()})},i.prototype.ifTabsArgs=function(){return this._viewModel.areTabsVisible()},i.prototype.wrapperDynamicMenuChunksArgs=function(e){e.watch(this._cardDeckAnimationsComplete);var t=this.isVisible(e);return{visible:t,menuChunks:t?[this]:[],widthBuffer:i.MenuWidthBuffer}},i.prototype.ifTriangleArgs=function(){return this.getViewModel().shouldShowTriangle()},i.prototype.escape=function(){this.parent.closeMenu()},i.prototype.keyDown=function(t){var n=e.prototype.keyDown.call(this,t);return n===TDB.EventPropagation.Bubble&&this.shouldCloseJackMenu(t)&&(this.parent.closeMenu(),n=TDB.EventPropagation.Bypass),n},i.prototype.shouldCloseJackMenu=function(e){var t=StoryApp.Utilities.isMacOsX?e.metaKey:e.ctrlKey;return!(e.keyCode===KeyCodeType.ShiftKey||t||o.CopyPasteImplementationBase.isInterestingKeyEvent(e,["v","V"]))},i.prototype.jackCardOptionsWrapperArgs=function(){var e=this;return new TDB.ChildArgs(t.JackCardOptionsWrapperVE,{visible:this.visible,menuTabs:this.getViewModel().getMenuTabs(),getSelectedTabIndex:function(t){return e.tabHeader.getSelectedTabIndex(t)}})},i.MenuWidthBuffer=50,i.OptionWidth=85,i}(n.PopupBaseVE);t.JackMenuVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=StoryApp.View.ViewElements,i=e.View.ViewElements,r=function(){function r(e,t,n){this.defaultOptionCount=5,this._cardDefinitionManager=t.cardDefinitionManager,this._showTriangle=!!t.showTriangle,this._pageId=t.pageId,this._parent=e,this._paneStateManager=t.paneStateManager,this._cardsContainer=t.cardsContainer,this._externalOptionClickedCallback=t.optionClickedCallback,this.createMenu(n)}return r.prototype.getMenuTabs=function(){return this._menuTabs},r.prototype.getTabsCollection=function(){return this.tabsCollection},r.prototype.getOptionCount=function(){for(var e=0,t=0;t<this._menuTabs.length;t++){var n=this._menuTabs[t].menuItems.length;n>e&&(e=n)}return e},r.prototype.areTabsVisible=function(){return void 0!==this._menuTabs&&this._menuTabs.length>1},r.prototype.shouldShowTriangle=function(){return this._showTriangle},r.prototype.getCardDefinition=function(e){return this._cardDefinitionManager.getCardDefinition(e)},r.prototype.createMenu=function(e){this._menuTabs=[],this.createMenuOptions(e),this.createTabs()},r.prototype.createMenuOptions=function(e){for(var n=this,o={},i=t.JackMenuStructure.getMenuStructure(),r=[],a=-1,s=0;s<i.length;s++){var l=i[s],c=l.menuItems.map(function(t){return{id:t,cardOption:n.getCardOption(t,o,e)}}).filter(function(e){return void 0!==e.cardOption});c.length>0&&(this._menuTabs.push({id:l.id,name:l.name,menuItems:c.map(function(e){return e.cardOption}),description:l.description}),r=r.concat(c.map(function(e){return e.id}).filter(function(e){return r.indexOf(e)<0})),l.id===t.Tabs.Suggested&&(a=s))}if(r.length<=this.defaultOptionCount){this._menuTabs=[];var d=i.first(function(e){return e.id===t.Tabs.Suggested});this._menuTabs.push({id:t.Tabs.Suggested,name:d.name,menuItems:r.map(function(t){return n.getCardOption(t,o,e)}),description:Resources.JackSuggestedTabDescription})}else if(-1!==a)for(s=0;s<this._menuTabs.length;s++)if(s!==a&&this.compareMenu(this._menuTabs[a].menuItems,this._menuTabs[s].menuItems)){delete this._menuTabs[a];break}},r.prototype.createTabs=function(){for(var e=[],t=0;t<this._menuTabs.length;t++){var n=this._menuTabs[t],o={contentTab:{Id:n.id,displayName:n.name,searchDescriptor:"",browseDescriptor:"",breadcrumbSkipUsername:!0,searchboxPlaceholderOverride:"",defaultSearchBoxFocusText:"",description:n.description},breadcrumbPath:new i.BreadcrumbPathViewModel(void 0),tabState:i.BasicContentPageState.ShowingContent};e.push(o)}this.tabsCollection=e},r.prototype.getCardOption=function(e,t,n){if(void 0!==t&&void 0!==t[e])return t[e];var o=this.createCardOption(e,n);return void 0!==t&&void 0!==o&&(t[e]=o),o},r.prototype.createCardOption=function(e,r){var a=this,s=void 0;switch(e){case t.SpecialCards.Upload:if(i.UploadMediaAction.getInstance().isAvailable()){var l={id:"Upload",buttonId:ClientAction.ButtonId.Jack_Upload,title:Resources.UploadButtonDescription,fontIcon:FontIcons.JackUploadIcon,context:this,clickCallback:this.cardOptionClicked,description:Resources.MyDeviceCardDescription,enabled:{compute:new TDB.ComputedOptionArgs(this,function(e){return!i.AuthoringPageVE.shouldContentPaneBeDisabled(a._pageId,e)})}};s=new o.CollapsibleMenuItem({primaryType:i.JackCardOptionVE,primaryArgs:l})}break;case t.SpecialCards.Camera:if(i.CameraAction.getInstance().isAvailable()){var c={id:"Camera",buttonId:ClientAction.ButtonId.Jack_Camera,title:Resources.JackAddCamera,fontIcon:FontIcons.JackAddCamera,context:this,clickCallback:this.cardOptionClicked,description:Resources.JackAddCamera};s=h=new o.CollapsibleMenuItem({primaryType:i.JackCardOptionVE,primaryArgs:c})}break;default:var d=this._parent.getInsertionPoint(),u=this.getCardDefinition(e),p=new n.Card({definition:u});if(i.AddAction.isAvailable([p],{parent:d.parent,index:d.index},this._pageId,r)){var g={id:u.id,buttonId:u.buttonId,title:u.title,fontIcon:u.fontIconName,context:this,clickCallback:this.cardOptionClicked,description:u.description},h=new o.CollapsibleMenuItem({primaryType:i.JackCardOptionVE,primaryArgs:g});s=h}}return s},r.prototype.cardOptionClicked=function(t){var o=this,r=this.getCardDefinition(t);if(r){var a;if(e.Model.currentUndoManager().get(this._pageId).captureUserUpdate(function(){return a=r.create(),o._cardsContainer.addCardObjects([new n.Card({definition:r,model:a})]),{activeModelObjectIds:[a.id]}},"Adding card from the card gallery"),ActionLogger.RecordClientAction(new ClientAction.StorylineJackAddCard("User added a card using the new Jack",t,a.id,i.CardType[this._parentCardType])),this._cardsContainer.scrollToModelsAndSetFocus([a],!0),t===n.ManualCardType.ImageId||t===n.ManualCardType.VideoId){TDB.applyUpdate(function(){i.ShowAddContentAction.execute(null,{paneStateManager:o._paneStateManager,cardsContainer:o._cardsContainer,sourceCardType:t===n.ManualCardType.ImageId?i.CardType.Image:i.CardType.Video})});var s=this._cardsContainer.getCardForModelId(a.id),l=s.cardType===i.CardType.Image||s.cardType===i.CardType.Video;s&&l&&s.parent instanceof i.CardVE&&s.focusOnOurPlaceholder()}}else"Upload"===t?(ActionLogger.RecordClientAction(new ClientAction.StorylineActionData(ClientAction.ActionType.Storyline_JackLocalClicked,"Jack local clicked",[this._parent.parent.getViewModel().getModelId()],[i.CardType[this._parentCardType]])),i.UploadMediaAction.getInstance().execute(null,{uploadElement:$("#fileToUpload"),cardsContainer:this._cardsContainer})):"Camera"===t&&i.CameraAction.getInstance().execute(this._cardsContainer);return this._externalOptionClickedCallback&&this._externalOptionClickedCallback(),!1},r.prototype.compareMenu=function(e,t){if(void 0===e||void 0===t)return!1;if(e.length!==t.length)return!1;for(var n in e)if(t.indexOf(e[n])<0)return!1;return!0},r}();t.JackMenuViewModel=r}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=ClientAction.StatisticalMeasure,o=e.Model.AuthoringModel,i=StoryApp.View.ViewElements,r=StoryApp.View.Common.FRE,a=e.View.ViewModel,s=StoryApp.Common,l=function(l){function c(o,i){var r=l.call(this,o,TDB.ControlSetFeatures.VerticalList|TDB.ControlSetFeatures.HomeEndNavigation|TDB.ControlSetFeatures.NoWrappingNavigation|TDB.ControlSetFeatures.PreserveFocusContext)||this;r.virtualizationThrottle=0,r.waitingSetImmediateOnDomAttached=!0,r.waitingInitialDomFocusToSettle=!0,r.cardDeckWrapperZIndex=TDB.watchableTag(595953052,r,StoryApp.Utilities.browser.isIE?"auto":"1"),r._authoringModel=i.authoringModel,r._paneStateManager=i.paneStateManager,r._selectionManager=new a.CardSelectionManager({cardsContainer:r}),r.isPopup=!1,r.cardParent=void 0,r.isHeading=!1,r.resourceFactory=i.resourceFactory,r.activePlaceholder=TDB.watchableTag(596473799,r,void 0),r.cardState=new t.CardState({cardsContainer:r}),r.model=i.model.traversalModel.getSpecifiedGrouping().getRootGroup(),r.activatableWatchable=i.activatable,r.activeCard=TDB.watchableTag(596473800,r,void 0),r.menuOnCard=TDB.watchableTag(596473801,t.CardDeckVE,!0),r.contentSearchVisible=TDB.watchableTag(596473802,t.CardDeckVE,!1),e.Model.currentUndoManager().get(r.pageId).registerStatefulComponent(r._selectionManager,"selectionManager"),e.Model.currentUndoManager().get(r.pageId).registerStatefulComponent(r.cardState,"focusManager",e.Model.StateChangePhase.Dom),r._popularityMetricsGenerator=void 0;try{s.UserState.getInstance().isUserOnFlight(FlightList.PopularityMetricsExperiment1)||s.UserState.getInstance().isUserOnFlight(FlightList.PopularityMetricsExperiment6)?r._popularityMetricsGenerator=new s.PopularityMetricsGenerator(s.PopularityMetric.OnlineAuthors,"Storyline"):(s.UserState.getInstance().isUserOnFlight(FlightList.PopularityMetricsExperiment2)||s.UserState.getInstance().isUserOnFlight(FlightList.PopularityMetricsExperiment5))&&(r._popularityMetricsGenerator=new s.PopularityMetricsGenerator(s.PopularityMetric.MadeSways,"Storyline"))}catch(e){StoryLog.StructuredTraceTag(596473803,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.error,"Failed to create popularity metrics generator, probably due to wrong BRS value for data.",{Exception:e})}if(r._showPopularityMetric=TDB.watchableTag(596473804,r,!0),r._startFadingPopularityMetric=TDB.watchableTag(596473805,r,!1),StoryApp.Utilities.query.has(StoryApp.Common.UrlHelper.URLParamStorylinevirtualization)&&(StoryPageEditSettings.StorylineVirtualizationEnabled=StoryApp.Utilities.query.fetch(StoryApp.Common.UrlHelper.URLParamStorylinevirtualization)===StoryApp.Common.UrlHelper.URLParamValueTrue),StoryPageEditSettings.StorylineVirtualizationEnabled){r._virtualizationEnabled=!0,ActionLogger.ObserveClientMeasure(n[n.CardDeckVirtualization],{cardElementsInDom:0,totalCardElements:0,computedTime:0});var c={domAttached:r.onDomAttached,domDetached:TDB.DomListenerManager.emptyDomDetatched};r._domListener=Obj.implement(r,c),r.addDomListener(r._domListener),r._trackedCards=[]}return r}return __extends(c,l),c.prototype.setup=function(e){this._dragHandler=new t.CardDragHandler({cardDeck:this,cardSelectionManager:this._selectionManager});var n={authoringModel:this._authoringModel,cardSelectionManager:this._selectionManager,cardsContainer:this,cardDeckMenuHost:this,cardDragHandler:this._dragHandler,cardDefinitionManager:this._authoringModel.cardDefinitionManager,resourceFactory:this.resourceFactory,transformManager:this._authoringModel.transformManager,paneStateManager:this._paneStateManager,fileUploader:e};this.cardFactory=new a.CardFactory(this,n),this.cardNestingLevel=0},c.prototype.getActiveCard=function(e){return this.activeCard.getWatchedValue(e)},c.prototype.getSelectionManager=function(){return this._selectionManager},c.prototype.getDragHandler=function(){return this._dragHandler},c.prototype.cardsWrapperClassNameArgs=function(e){var n=t.CardDeckVE.CardsWrapperClassName;return this._paneStateManager.standardPaneVisible(e)&&(n=t.CardDeckVE.CardsWrapperWithStandardPaneClassName),n},c.prototype.cardsWrapperStyleArgs=function(e){return{webkitOverflowScrolling:this.shouldFaderBeVisible(e)?void 0:"touch"}},c.prototype.cardDeckWrapperStyleArgs=function(e){var t=this;return"1"!==this.cardDeckWrapperZIndex.getValue()&&platform.setImmediate(function(){TDB.applyUpdate(function(){t.cardDeckWrapperZIndex.setValue("1")})}),{zIndex:this.cardDeckWrapperZIndex.getWatchedValue(e)}},c.prototype.cardsInnerWrapperClassNameArgs=function(e){var n=t.CardDeckVE.CardsInnerWrapperClassName;return this._authoringModel.isCardDeckVisible(e)||(n=t.CardDeckVE.CardsInnerWrapperWithNoCardDeckClassName),n},c.prototype.innerWrapperCssArgs=function(e){return{CardDeckInnerWrapper:!0,CardDeckInnerWrapperWithStandardPaneModeSwitch:this._paneStateManager.standardPaneVisible(e),CardDeckInnerWrapperWithAddContentPaneModeSwitch:this._paneStateManager.getPaneVisible(t.AuthoringPaneType.Content,e),CardDeckInnerWrapperWithFocusPaneModeSwitch:this._paneStateManager.getPaneVisible(t.AuthoringPaneType.EditImage,e)||this._paneStateManager.getPaneVisible(t.AuthoringPaneType.AccessibilityChecker,e)}},c.prototype.toggleStoryline=function(e){return this._authoringModel.toggleStoryline()},c.prototype.notifySelectionStateChanged=function(e,t){},c.prototype.getActiveListItem=function(){return this.activeChild},c.prototype.activateListItem=function(e,t){var n=void 0,o=this.getActiveListItem();if(e&&e!==o&&e.canActivateItem()&&(this.uncullTrackedCards(),this.setActiveListItem(e),t||e.onActivatedItem(),e.setItemActiveState(!0),o&&(o.setItemActiveState(!1),o.onDeactivatedItem()),this.setActivePlaceholder(void 0),n=o,o=e,n)){var i=this.getCardToCollapse(n,o);i&&this.onCollapse(i,n,o)}},c.prototype.onCollapse=function(e,t,n){if(StoryLog.StructuredTraceTag(596473806,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Auto-collapse is triggered",{autoCollapseCard:e.getViewModel().getModelId(),prevActive:t.getViewModel().getModelId(),currentActive:n.getViewModel().getModelId(),currentActiveInDom:(!!n.isInDom()).toString()}),n.isInDom()){var o=n.distanceFromIPRef.getBottomCoordinate();e.setCardMode(a.CardMode.Collapsed),n.scrollIntoView(o)}else e.setCardMode(a.CardMode.Collapsed)},c.prototype.getCardToCollapse=function(e,t){if(!t.isEmptySocketCard())return this.getOutmostExpandedCardToCollapse(this.getNearestExpandedSocketifiedAncestorCard(e),t)},c.prototype.getOutmostExpandedCardToCollapse=function(e,n){if(e&&n&&e.isExpandedSocketifiedCard())return e.isAncestor(n)?void 0:e.cardParent instanceof t.CardVE?this.getOutmostExpandedCardToCollapse(e.cardParent,n)||e:e},c.prototype.getNearestExpandedSocketifiedAncestorCard=function(e){if(e)return e.isExpandedSocketifiedCard()?e:this.getNearestExpandedSocketifiedAncestorCard(e.cardParent)},c.prototype.setActiveListItem=function(e){var n=this;this.activeChild=e,e&&this.enterNoFocus();var o=e;if(this._trackedCards)for(this.activeTrackedCard=void 0;o;){if(ArrayExtensions.contains(this._trackedCards,o)){this.activeTrackedCard=o;break}o=o.cardParent instanceof t.CardVE?o.cardParent:void 0}this.updateAuthoringLocation(e),TDB.applyUpdate(function(){return n.activeCard.setValue(e)})},c.prototype.menuVisible=function(e){if(!this._authoringModel.isCardDeckVisible(e))return!1;var t=this.menuOnCard.getWatchedValue(e),n=!1,o=this.activeCard.getWatchedValue(e);if(!this._selectionManager.isInMultiselectMode(e)&&o){var i=!!o.getTextEditorElement();n=!o.getViewModel().isDragging(e)&&i}return!t&&n},c.prototype.menuArgs=function(e){if(0===this._selectionManager.getSelection(e).length){var t=this.activeCard.getWatchedValue(e);if(t)return t.getCardDeckMenu(e)}},c.prototype.getActiveJack=function(e){var t=this.activeCard.getWatchedValue(e);return t?t.getJack(e):void 0},c.prototype.isJackMenuVisible=function(e){var t=this.getActiveJack(e);return!!t&&t.isMenuShown(e)},c.prototype.closeActiveJackMenu=function(){var e=this.getActiveJack();e&&e.closeMenu()},c.prototype.headerClassNameArgs=function(e){var n="StorylineHeader StorylineHeaderModeSwitch";return this._authoringModel.isCardDeckVisible(e)&&(this._paneStateManager.standardPaneVisible(e)?n+=" StorylineHeaderWithStandardPaneModeSwitch":this._paneStateManager.getPaneVisible(t.AuthoringPaneType.Content,e)?n+=" StorylineHeaderWithAddContentPaneModeSwitch":(this._paneStateManager.getPaneVisible(t.AuthoringPaneType.EditImage,e)||this._paneStateManager.getPaneVisible(t.AuthoringPaneType.AccessibilityChecker,e))&&(n+=" StorylineHeaderWithFocusPaneModeSwitch")),n},c.prototype.cardDeckOverlayVisibleArgs=function(e){return!this._authoringModel.isCardDeckVisible(e)},c.prototype.cardDeckFaderFadeVisibleInitArgs=function(){var e=this.getFaderTransition();return{transitionIn:e,transitionOut:e,visibleInit:!1,opacityWhenVisible:.75}},c.prototype.cardDeckFaderFadeVisibleArgs=function(e){var t=this.getFaderTransition(e);return{transitionIn:t,transitionOut:t,visible:this.shouldFaderBeVisible(e)}},c.prototype.getFaderTransition=function(e){return this._authoringModel.isCardDeckVisible(e)?"opacity 0.5s":"none"},c.prototype.shouldFaderBeVisible=function(e){return this.isJackMenuVisible(e)&&this._authoringModel.isCardDeckVisible(e)},c.prototype.cardsWrapperDragHandlerInitArgs=function(){return this._dragHandler},c.prototype.rootGroupCardArgs=function(){return this.rootGroupCardViewModel=this.cardFactory.createGroupCardVM(this,{model:this.model}),new TDB.ChildArgs(t.GroupCardVE,this.cardFactory.createGroupCardArgs({cardParent:this,viewModel:this.rootGroupCardViewModel}))},c.prototype.getRootGroupCard=function(){return this.rootGroupCard},c.prototype.isAncestorSelected=function(){return!1},c.prototype.getChildCards=function(e){return[this.getRootGroupCard()]},c.prototype.childAcceptDraggables=function(e,t){return!1},c.prototype.getFlattenedCardList=function(e,n,o,i,r){o||(o=function(e){return!0}),i||(i=function(e){return!0});for(var a=(n=n||this.getRootGroupCard()).getChildCards(e),s=a.length,l=[],c=0;c<s;c++){var d=[],u=a[c];o(u)&&d.push(u);var p=t.CardVE.castCardParent(u);p&&i(u)&&(d=r?this.getFlattenedCardList(e,p,o,i,r).concat(d):d.concat(this.getFlattenedCardList(e,p,o,i,r))),l=l.concat(d)}return l},c.prototype.getVisualCardList=function(){return c.getVisualCardListImp(this.getRootGroupCard(),[])},c.getVisualCardListImp=function(e,n){if(e instanceof t.ComplexHeadingCardVE)return n;if(n.push({card:e,containerEnd:!1}),e instanceof t.ContainerCardVE){if(!e.isCollapsed())for(var o=e.getChildCards(),i=0;i<o.length;i++)c.getVisualCardListImp(o[i],n);n.push({card:e,containerEnd:!0})}return n},c.prototype.getCardForModelId=function(e,t){return t?t.getViewModel().getCardForModelId(e):this.getRootGroupCard()?this.getRootGroupCard().getViewModel().getCardForModelId(e):null},c.prototype.addCardObjects=function(e){var n=this;if(!e||0===e.length)return!0;if(-1!==e.indexOf(null)||-1!==e.indexOf(void 0))return!1;var o=[];e.forEach(function(e){return o.push(e.model)});var i=!0,r=this.activeCard.getValue(),a=r instanceof t.SetCardVE&&r.getViewModel().getInsertingAtTop();if(TDB.applyUpdate(function(){var r=n.getActivePlaceholder(),a=n.activeCard.getValue();if(r&&r.getViewModel().addModelObjects(e))i=!1;else if(a){var s=a.cardParent;if(s instanceof t.ClosedCaptionsSocketContainerCardVE||s instanceof t.ComplexHeadingCardVE){var l=a.getViewModel().getCardDefinition()?a.getViewModel().getCardDefinition().id:"";i=!a.getViewModel().addModelObjectsAndSetFocus(l,o)}}n.startHidingPopularityMetric()}),a){var s=r.getJack();if(s&&s.addModelObjects(e,!0))return r.getViewModel().setInsertingAtTop(!1),!0}return!i||this.addModelObjectsToAncestor(e)},c.prototype.startHidingPopularityMetric=function(){var e=this;this._startFadingPopularityMetric.getValue()||(TDB.applyUpdate(function(){return e._startFadingPopularityMetric.setValue(!0)}),platform.setTimeout(function(){return TDB.applyUpdate(function(){return e._showPopularityMetric.setValue(!1)})},5e3))},c.prototype.addModelObjectsToAncestor=function(e){var t=this,n=[];e.forEach(function(e){return n.push(e.model)});var o=!1;return TDB.applyUpdate(function(){o=t.traverseCardsAndAddModelObjects(e,!1)}),o||this.logInfoForFailedAddingOfModelObjects(e),o},c.prototype.logInfoForFailedAddingOfModelObjects=function(e){var t=!1;try{t=this.traverseCardsAndAddModelObjects(e,!0)}catch(e){StoryLog.StructuredTraceTag(596473807,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.error,"Exception while collecting cards data",{exception:e?e.toString():""})}StoryLog.StructuredTraceTag(596473808,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.error,"We failed to add a model to our position.",{secondTryResult:t.toString()})},c.prototype.traverseCardsAndAddModelObjects=function(e,n){var o=!0,i=[];e.forEach(function(e){return i.push(e.model)});var r=this.activeCard.getValue();for(r||(r=this.getRootGroupCard().getLastChild()),r&&r.parent instanceof t.ComplexHeadingCardVE&&(r=r.parent);r;){var a=r.cardParent instanceof t.CardVE?r.cardParent:void 0;n&&StoryLog.StructuredTraceTag(596473809,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Card has no jack",{cardType:null!=r.cardType?t.CardType[r.cardType]:"",cardParentType:a?t.CardType[a.cardType]:"",cardHasJack:(!!r.getJack()).toString(),card_id:r._id,cardParentInstanceOfComplexHeadingCardVE:(!!a&&a instanceof t.ComplexHeadingCardVE).toString(),hasActiveCard:(void 0!=this.activeCard.getValue()).toString(),numObjectsToAdd:i.length.toString(),curCardViewModelInSocket:r.getViewModel().inSocket()+""});var s=r.getJack();if(s){if(n)return!0;if(s.addModelObjects(e))return!0;if(o){o=!1;for(var l=e.length-1;l>0;l--)if(s.addModelObjects(e.slice(0,l),!1)){e=e.slice(l);break}}}r=a}return!1},c.prototype.mouseClicked=function(e){return this._authoringModel.isCardDeckVisible()?(ActionLogger.RecordClientAction(new ClientAction.ButtonClickAction(ClientAction.ButtonId.CardDeck,Diag.ULSCat.msoulscat_Story_Storyline)),this.activateTheNearestCard(new Point(e.clientX,e.clientY)),TDB.EventPropagation.PreventDefault):this.toggleStoryline(e)},c.prototype.activateTheNearestCard=function(e){var n=function(e){return!(e instanceof t.GroupCardVE&&e.isExpanded())},o=function(e){return!e.isExpandedSocketifiedCard()&&!e.isCollapsed()},i=this.getFlattenedCardList(void 0,void 0,n,o,!0);i.addunique(this.getRootGroupCard().headingCard.getValue()),this._selectionManager.clearSelection();var r=this.findNearestCard(e,i);r&&(r.isExpandedSocketifiedCard()&&r.setCardMode(a.CardMode.Collapsed),r.activateItem())},c.prototype.areDescendantsVisible=function(e){return!0},c.prototype.onActivateChild=function(e){var t=e;return t.scrollIntoView(),t.enter(),t.activateItem(!0),e===this.getRootGroupCard().headingCard.getValue()&&!this.waitingSetImmediateOnDomAttached&&this.waitingInitialDomFocusToSettle&&(this.waitingInitialDomFocusToSettle=void 0),!0},c.prototype.getActivatableChildren=function(){var e=this.getRootGroupCard();return Obj.traverse(e,function(n){if(n===e||!n.canActivateItem())return null;if(n instanceof t.GroupCardVE){var o=n,i=o.getFocusableChildren();if(i&&!i.firstOrDefault(function(e){return e instanceof t.ComplexHeadingCardVE}))return null;var r=o.getChildCards();if(1===r.length&&r[0].getViewModel().isRemoving())return null}return n},function(e){return e&&e.getViewModel().calculateCardMode()===a.CardMode.Expanded&&!e.getViewModel().isRemoving()?e.getChildCards():null})},c.prototype.scrollToModelsAndSetFocus=function(e,n){if(void 0===n&&(n=!1),void 0!=e){for(var i=[],r=0;r<e.length;r++)if(o.StoryController.isModelObjectValid(e[r])){var a=this.getCardForModelId(e[r].id);if(!a&&n){var s=o.currentStoryController().get(this.pageId).findParent(e[r]),l=this.getCardForModelId(s.id);l&&l.isContainerCard()&&(l.setCollapsedRecursive(!1),a=this.getCardForModelId(e[r].id))}a&&a.parent instanceof t.CardVE&&i.push(a)}this.scrollToCardsAndSetFocus(i,n)}},c.prototype.scrollToCardsAndSetFocus=function(e,t){var n=this;if(void 0===t&&(t=!1),e&&0!==e.length){this._selectionManager.clearSelection();var o=e[e.length-1];StoryApp.View.Common.DialogManager.getCurrentDialog()||(o.isInContainerCard()&&t&&o.parent.setCollapsedRecursive(!1,!1),o.activateItem(),o.setFocusWhenInDom()),e.length>1&&e.forEach(function(e){return n._selectionManager.setSelection(e,!0)}),o.scrollIntoView()}},c.prototype.findNearestCard=function(e,t){var n=void 0;if(0!=t.length){for(var o=0,i=t.length,r=void 0;i-o>1;)t[r=Math.floor((o+i)/2)].distanceFromIPRef.getBottomCoordinate()>=e.top?i=r:o=r;n=t[o],o+1<t.length&&t[o+1].distanceFromIPRef.distanceFromIP(e)<n.distanceFromIPRef.distanceFromIP(e)&&(n=t[o+1])}return n},c.prototype.dragOver=function(e){var t=e,n=document.getElementById("CardDeck"),o=TDB.ViewElement.dataFor(this.children.first().domElement);this._dragHandler.beginDragging([o]);var i=t.originalEvent.pageY+n.scrollTop-$(n).offset().top,r=t.originalEvent.pageX-$(n).offset().left+n.scrollLeft,a=new Point(r,i);return this._dragHandler.mouseMove(null,a,new Point(t.originalEvent.pageX,t.originalEvent.pageY),this.children.first().domElement),!1},c.prototype.drop=function(e){return e.preventDefault(),e.stopPropagation(),this._dragHandler.dropFileOrText(e),this._dragHandler.resetDropState(),!1},c.prototype.dragLeave=function(e){return this._dragHandler.resetDropState(),!1},c.prototype.isCollapsed=function(e){return!1},c.prototype.getModelForActiveContent=function(e,t){var n=this._selectionManager.getModelForSelection(e,t);if(0===n.length){var o=this.activeCard.getWatchedValue(e);o&&n.push(o.getViewModel().getModel())}return n},c.prototype.getCardsForActiveContent=function(e,t){var n=this._selectionManager.getSelection(e,t);if(0===n.length){var o=this.activeCard.getWatchedValue(e);o&&n.push(o)}return n},c.prototype.removeDisposedCard=function(e){var t=this;e&&TDB.applyUpdate(function(){t._selectionManager.removeDisposedCard(e),t.removeDisposedPlaceholderCard(e)},TDB.Justification.InitialConversion)},c.prototype.setActivePlaceholder=function(e){var t=this;TDB.applyUpdate(function(){return t.activePlaceholder.setValue(e)},TDB.Justification.FocusManagement)},c.prototype.getActivePlaceholder=function(e){return this.activePlaceholder.getWatchedValue(e)},c.prototype.getActiveCardModel=function(e){var t=this.getActiveCard(e);return t?t.getViewModel().getModel():void 0},c.prototype.getActiveCardModelId=function(e){var t=this.getActiveCardModel(e);return t?t.id:""},c.prototype.getActiveNavigatableCardModelId=function(e){return o.StoryController.getNavigableModelId(this.getActiveCardModel(e))},c.prototype.removeDisposedPlaceholderCard=function(e){this.getActivePlaceholder()===e&&this.setActivePlaceholder(void 0)},c.prototype.updateAuthoringLocation=function(t){var n=e.Server.AuthorsManager.currentAuthorsManager().get(this.pageId);if(n){var o=t&&t.getViewModel().getModel()?t.getViewModel().getModelId():"";n.updateIPLocation(o)}},c.prototype.cardAuthorsStatusTextArgs=function(t){return e.Server.AuthorsManager.currentAuthorsManager().get(this.pageId).getCardAuthorsStatus().getWatchedValue(t)},c.prototype.isRootHeading=function(){return!1},c.prototype.showPopularityMetricArgs=function(e){return CommonSettings.PopularityMetricsExperimentEnabled&&(CommonSettings.PopularityMetricsExperimentTranslated||"en-us"===CommonSettings.UserLocaleString)&&o.StoryController.isStoryEmpty(!1)&&void 0!=this._popularityMetricsGenerator&&this._popularityMetricsGenerator.aboveTheThreshold()&&this._showPopularityMetric.getWatchedValue(e)},c.prototype.popularityMetricClassNameArgs=function(e){var t="PopularityMetricStoryline";return this._startFadingPopularityMetric.getWatchedValue(e)&&(t+=" PopularityMetricStorylineHidden"),t},c.prototype.popularityMetricMessagePrefixTextArgs=function(e){return this._popularityMetricsGenerator.getMetricMessagePrefix()},c.prototype.popularityMetricNumberTextArgs=function(e){return this._popularityMetricsGenerator.getMetricNumber().toString()},c.prototype.popularityMetricMessageTextArgs=function(e){return this._popularityMetricsGenerator.getMetricMessageText()},c.prototype.popularityMetricIconArgs=function(){return this._popularityMetricsGenerator.getMetricIcon()},c.prototype.calloutArgs=function(e){var t=r.CalloutID.Storyline;if(r.getCalloutManager().isActiveCallout(e,t)){var n={calloutBoxClassName:"Storyline-callout",headerText:{value:Resources.FirstRunPreviewEmptySwayStorylineHeader},bodyText:Resources.FirstRunPreviewEmptySwayStorylineBody,readerText:Resources.FirstRunPreviewEmptySwayReader,beakPosition:i.BeakPosition.TopLeft,calloutID:t,delay:r.getDelayForCallout(t,r.FirstRunType.Default)};return new TDB.ChildArgs(i.FRECalloutVE,n)}},c.prototype.contentSearchArgs=function(){var e={lookupId:StoryPageSettings.LookupId,context:this,highlighter:this.highlight,activatable:this.activatableWatchable,closed:this.minimizeSearch};return new TDB.ChildArgs(i.ContentSearchVE,e)},c.prototype.ifContentSearchVisibleArgs=function(e){return this.contentSearchVisible.getWatchedValue(e)},c.prototype.resetSearch=function(){this.contentSearch&&this.contentSearch.reset()},c.prototype.minimizeSearch=function(e){var t=this;return this.setVirtualization(!0),TDB.applyUpdate(function(){return t.contentSearchVisible.setValue(!1)}),this.activateItem(),TDB.EventPropagation.Bypass},c.prototype.maximizeSearch=function(e){var t=this;return this._authoringModel.parent.isPreviewMode.getValue()||!this._authoringModel.isCardDeckVisible()?TDB.EventPropagation.Bubble:(this.contentSearch?this.contentSearch.enter():(this.setVirtualization(!1),TDB.applyUpdate(function(){return t.contentSearchVisible.setValue(!0)})),TDB.EventPropagation.PreventDefault)},c.prototype.highlight=function(e,t){if(e){var n=e.ranges[0];if(!n)return;for(var o=this.getCardForModelId(n.contentId),i=0;!o&&i<n.parentalChain.length;i++){var r=n.parentalChain[i];o=this.getCardForModelId(r)}o&&o.highlight(e,t)}else this.getFlattenedCardList().forEach(function(n){return n.highlight(e,t)})},c.prototype.innerWrapperAttrArgs=function(e){var t={};return t[Aria.Attributes.Hidden]=this._authoringModel.isCardDeckVisible(e)?Aria.BooleanState.False:Aria.BooleanState.True,t[Aria.Attributes.Label]=Resources.StorylinePanelLabelNew,t},c.prototype.uncullTrackedCards=function(){if(this._cardDeckTop){for(var e=0;e<this._trackedCards.length;e++)this._trackedCards[e].uncull();this._cardDeckTop.style.minHeight=StoryApp.Utilities.toPxStr(0),this._cardDeckBottom.style.minHeight=StoryApp.Utilities.toPxStr(0)}},c.prototype.cardsWrapperEventsInitArgs=function(){return{scroll:this.handleScroll()}},c.prototype.handleScroll=function(){var e=this,t=void 0;return function(n){StoryPageEditSettings.StorylineVirtualizationEnabled&&e.onVirtualizationEvent();var o=function(){t=void 0,e.onScrollCompleted()};return clearTimeout(t),t=platform.setTimeout(o,500),!1}},c.prototype.onScrollCompleted=function(){if(this._cardDeck=document.getElementById("CardsWrapper"),this._cardDeck){StoryApp.Common.PageCompartmentManager.getInstance().createNewPageCompartment();if(this._cardDeck.scrollTop<=0&&this.rootGroupCard&&this.rootGroupCard.headingCard){var e=this.rootGroupCard.headingCard.getValue();if(e&&(!e.isInDom()||!e.isVisible())){var t=e.isInDom()?"invisible":"not in dom";StoryLog.TraceTag(596473810,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.error,"Card "+t+" when user scrolls to the top of storyline")}}}},c.prototype.onVirtualizationEvent=function(){var e=platform.now();return!(e-this.virtualizationThrottle<16)&&(this.virtualizationThrottle=e,void 0===this._scrollAdjustment?this.computeCardDeckElements():(this._cardDeck.scrollTop=this._scrollAdjustment,this._scrollAdjustment=void 0),!1)},c.prototype.computeCardDeckElements=function(e,o){var i=this;if(void 0===o&&(o=!1),StoryPageEditSettings.StorylineVirtualizationEnabled&&!this.disposed&&this._virtualizationEnabled){e=e||!this._cardDeckTop;var r=platform.now(),a=e?0:this._cardDeck.scrollTop;e&&(this._cardDeckTop=window.document.getElementById("CardDeckTop"),this._cardDeck=window.document.getElementById("CardsWrapper"),this._cardDeckBottom=window.document.getElementById("CardDeckBottom"));for(var s,l,c=t.CardDeckVE.TopMargin,d=this._cardDeck.parentElement.scrollHeight,u=this.getFlattenedCardList(),p=u.filter(function(e){return ArrayExtensions.contains(i._trackedCards,e)}),g=p.map(function(e){return e.getCardHeight()}),h=p.indexOf(this.activeTrackedCard),C=p.length,f=0;f<C;f++){var m=g[f],y=c>a+d||c+m<a;if(void 0!==s&&y){var v=f-1;l=h>=0?Math.max(h,v):v;break}void 0!==s||y||(s=h>=0?Math.min(h,f):f),c+=m}void 0===s&&(s=0),void 0===l&&(l=C-1),StoryApp.Utilities.weblog("storyline","cards between index: "+s+" and "+l+" are visible");for(var S=0,T=0,w=0,f=0;f<C;f++){var A=p[f],m=g[f];if(f<s)S+=m,A.cull();else if(f>l)T+=m,A.cull();else{var E=t.CardVE.castCardParent(A);E?w+=this.getFlattenedCardList(void 0,E).length:w++,A.uncull()}}this._cardDeckTop.style.minHeight=StoryApp.Utilities.toPxStr(S),this._cardDeckBottom.style.minHeight=StoryApp.Utilities.toPxStr(T),e&&o&&this.initDomFocus(),ActionLogger.ObserveClientMeasure(n[n.CardDeckVirtualization],{cardElementsInDom:w,totalCardElements:u.length,computedTime:platform.now()-r})}},c.prototype.initDomFocus=function(){!StoryApp.View.Common.BlockingProgressManager.getInstance().isBlocking()&&!StoryApp.View.Common.DialogManager.getCurrentDialog()&&this.canEnter()?this.getRootGroupCard().headingCard.getValue().setFocus():this.waitingInitialDomFocusToSettle=void 0},c.prototype.addTrackedCard=function(e){var t=this;e&&(e.parent===this.getRootGroupCard()||e.isRootHeading())&&(ArrayExtensions.contains(this._trackedCards,e)||(this._trackedCards.push(e),this._cardDeck?platform.setImmediate(function(){return t.computeCardDeckElements()}):e.cull()))},c.prototype.setVirtualization=function(e){StoryPageEditSettings.StorylineVirtualizationEnabled&&(this._virtualizationEnabled=e,this._virtualizationEnabled?(this._scrollAdjustment=this._cardDeck.scrollTop,this.computeCardDeckElements()):this.uncullTrackedCards())},c.prototype.removeTrackedCard=function(e){this._trackedCards&&this._trackedCards.removefirst(e)},c.prototype.dispose=function(){this._domListener&&(this.removeDomListener(this._domListener),this._domListener=void 0),this._cardDeckTop=void 0,this._cardDeck=void 0,this._cardDeckBottom=void 0,this._trackedCards=void 0,l.prototype.dispose.call(this)},c.prototype.onDomAttached=function(){var e=this;platform.setImmediate(function(){e.waitingSetImmediateOnDomAttached=void 0,e.computeCardDeckElements(!0,!0),e.addResource(StoryApp.Utilities.onResize(e.onVirtualizationEvent,e))})},c.prototype.canEnter=function(){return this._authoringModel.parent.isEditMode.getValue()&&this._authoringModel.isCardDeckVisible()&&l.prototype.canEnter.call(this)},c.prototype.containsRegions=function(){return!0},c.prototype.isExpandedSocketifiedCard=function(){return!1},c.prototype.hasInitialFocusSettled=function(){return!this.waitingInitialDomFocusToSettle},c.ContainerCardBackgroundInset=6,c.CardsWrapperClassName="CardsHorizontalConstraint CardsWrapper",c.CardsWrapperWithStandardPaneClassName="CardsHorizontalConstraint CardsWrapper CardsHorizontalConstraintWithStandardPane CardsHorizontalConstraintModeSwitch",c.CardsInnerWrapperClassName="CardsInnerWrapper",c.CardsInnerWrapperWithNoCardDeckClassName="CardsInnerWrapper CardsInnerWrapperHidden",c.MinimumCardHeight=148,c.CollapsedCardHeight=185,c.TopMargin=45,c}(i.RegionViewElement);t.CardDeckVEBase=l}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=function(){function n(e){this.dropTargets=[],this.acceptedDropTargets=[],this.draggingElements=[],this._dragging=TDB.watchableTag(596473797,this,!1),this.dragging=this._dragging,this._cardSelectionManager=e.cardSelectionManager,this._cardDeck=e.cardDeck,this._dragDropCallbacks=[],this._dragPosition=TDB.watchableTag(596473798,this,null),this.dragPosition=this._dragPosition}return n.prototype.accept=function(e){if(this.dragging.getValue())return!0;var t=this.getDraggingElements(e.get()[0]);return!!t.length&&this.beginDragging(t)},n.prototype.setAddContentSelectionManager=function(e){this._addContentSelectionManager=e},n.prototype.registerOnDropped=function(e){this._dragDropCallbacks.addunique(e)},n.prototype.beginDragging=function(e){var n=this.findAcceptedDropTargets(e);return n.length>0&&(this.acceptedDropTargets=n,this.draggingElements=e,TDB.applyUpdate(function(){for(var n=e.length,o=0;o<n;o++)e[o]instanceof t.CardVE&&e[o].getViewModel().setDragging(!0)},TDB.Justification.SynchronousBrowserEvent),!0)},n.prototype.findAcceptedDropTargets=function(e){for(var t=[],n=this.dropTargets.length,o=0;o<n;o++)this.dropTargets[o].owner.accept(e)&&t.push(this.dropTargets[o]);return t},n.prototype.over=function(e,t){this.resetDropState()},n.prototype.out=function(e,t){this.resetDropState()},n.prototype.drop=function(t,n){var o=this;this.selectedDropTarget&&e.Model.currentUndoManager().get(this._cardDeck.getPageId()).captureUserAction(function(){o.dropElements(o.selectedDropTarget.owner);var e=o.draggingElements.first();return{activeModelObjectIds:e?[e.getModelObjectId()]:void 0}},"User drag and dropped a card via its drag handle")},n.prototype.dropFileOrText=function(t){var n=this;this.selectedDropTarget&&e.Model.currentUndoManager().get(this._cardDeck.getPageId()).captureUserAction(function(){n.selectedDropTarget.owner.dropFileOrText(t)},"User drag and dropped file via its drag handle")},n.prototype.dropElements=function(e){if(e.drop(this.draggingElements),e.setActive(!1),this.draggingElements.length>0)for(var t=0;t<this._dragDropCallbacks.length;t++)this._dragDropCallbacks[t].onDropped(this.draggingElements)},n.prototype.activate=function(e,n){var o=this;if(n){var i=!1;for(var r in n.draggable){var a=TDB.ViewElement.dataFor(n.draggable[r]);(a instanceof t.CardVE||a instanceof t.ContentPieceVE||a instanceof t.CardOptionVE)&&(i=!0)}if(!i)return}TDB.applyUpdate(function(){o._dragging.setValue(!0),o._cardDeck.setVirtualization(!1)});for(var s=0;s<this.acceptedDropTargets.length;s++)this.acceptedDropTargets[s].owner.activate()},n.prototype.cleanup=function(){var e=this;this.resetDropState();for(var n=0;n<this.acceptedDropTargets.length;n++)this.acceptedDropTargets[n].owner.deactivate();this.acceptedDropTargets=[],TDB.applyUpdate(function(){for(var n=0;n<e.draggingElements.length;n++)e.draggingElements[n]instanceof t.CardVE&&e.draggingElements[n].getViewModel().setDragging(!1),e.draggingElements[n]instanceof t.ContainerCardVE&&e.draggingElements[n].resetCollapsed();e.draggingElements=[],e._dragging.setValue(!1),e._cardDeck.setVirtualization(!0),e._dragPosition.setValue(null),TDB.FocusableViewElement.getFocusedElement()instanceof t.ContentPieceVE&&e._cardSelectionManager.clearSelection()})},n.prototype.deactivate=function(e,t){this.cleanup()},n.prototype.resetDropState=function(){this.selectedDropTarget&&(this.selectedDropTarget.owner.setActive(!1),this.selectedDropTarget=void 0);for(var e=this.dropTargets.length,t=0;t<e;t++)this.dropTargets[t].cachedDropRect=void 0},n.prototype.mouseMove=function(e,t,n,o){var i=this;TDB.applyUpdate(function(){i._dragPosition.setValue(n)},TDB.Justification.SynchronousBrowserEvent);var r=this.findNearestElement(t,o,this.acceptedDropTargets);r&&this.selectedDropTarget!=r&&(this.selectedDropTarget&&this.selectedDropTarget.owner.setActive(!1),this.selectedDropTarget=r,this.selectedDropTarget.owner.setActive(!0),this.isExpandableDropTarget(this.selectedDropTarget)&&this.expandDropTarget(this.selectedDropTarget))},n.prototype.expandDropTarget=function(e){var t=this,n=e;platform.setTimeout(function(){e.owner.setCollapsed&&n==t.selectedDropTarget&&(n.owner.setCollapsed(!1),t.acceptedDropTargets=t.findAcceptedDropTargets(t.draggingElements),t.resetDropState())},1500)},n.prototype.isExpandableDropTarget=function(e){return!!(e&&e.owner&&e.owner.isExpandable)&&e.owner.isExpandable()},n.prototype.findNearestElement=function(e,t,o){for(var i,r=Number.MAX_VALUE,a=0,s=o.length,l=0;l<s;l++){var c=o[l],d=n.getDropRect(c,t).getDistanceToPoint(e),u=d<r,p=d==r&&c.zOrder>a;(u||p)&&(i=c,r=d,a=c.zOrder)}return i},n.prototype.addDropTarget=function(e,t,n){this.dropTargets.push({element:e,owner:t,cachedDropRect:void 0,zOrder:n})},n.prototype.removeDropTarget=function(e){for(var t=this.dropTargets.length,n=0;n<t;n++)if(this.dropTargets[n].element==e){this.dropTargets.splice(n,1);break}},n.getDropRect=function(e,t){return e.cachedDropRect&&!e.owner.refreshDropRect()||(e.cachedDropRect=n.calculateDropRect(e,t)),e.cachedDropRect},n.calculateDropRect=function(e,t){for(var n=e.element,o=new Rect(0,0,n.offsetWidth,n.offsetHeight);n&&n!=t;)o.top+=n.offsetTop,o.left+=n.offsetLeft,n=n.offsetParent;return e.owner.calculateDropRect(o)},n.prototype.getDraggingElements=function(e){var n=TDB.ViewElement.dataFor(e);if(!n)return[];if(n instanceof t.CardVE){var o=n;return this._cardSelectionManager&&this._cardSelectionManager.isSelected(o)?this._cardSelectionManager.getSelection(void 0,!0):[n]}if(this._addContentSelectionManager&&n instanceof t.ContentPieceVE){var i=this._addContentSelectionManager.selectedContent.slice(0);return i.indexOf(n)>-1?i:[n]}return[n]},n.DragHoverColor="rgb(127, 192, 184)",n}();t.CardDragHandler=n}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(e){this._args=e}return e.prototype.accept=function(e){return!!this._args.accept&&this._args.accept.call(this._args.context,e)},e.prototype.activate=function(){this._args.activate&&this._args.activate.call(this._args.context)},e.prototype.calculateDropRect=function(e){return this._args.calculateDropRect?this._args.calculateDropRect.call(this._args.context,e):e},e.prototype.refreshDropRect=function(){return!!this._args.refreshDropRect&&this._args.refreshDropRect.call(this._args.context)},e.prototype.setActive=function(e){if(this._args.setActive)return this._args.setActive.call(this._args.context,e)},e.prototype.drop=function(e){return!!this._args.drop&&this._args.drop.call(this._args.context,e)},e.prototype.dropFileOrText=function(e){return!!this._args.dropFileOrText&&this._args.dropFileOrText.call(this._args.context,e)},e.prototype.deactivate=function(){this._args.deactivate&&this._args.deactivate.call(this._args.context)},e.prototype.setCollapsed=function(e){this._args.setCollapsed&&this._args.setCollapsed.call(this._args.context,e)},e.prototype.isExpandable=function(){return this._args.expandable},e}();e.CardDropTargetOwner=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel,o=function(){function e(e){this._cardsContainer=e.cardsContainer}return e.prototype.getState=function(){var e=this._cardsContainer.getActiveCard();return e&&e.getViewModel().getModelId()?{activeCardId:e.getViewModel().getModelId(),selection:n.TextHelperMethods.getSelection(e.getTextEditorElement())}:null},e.prototype.setState=function(e){if(e){var t=e.activeCardId,o=this._cardsContainer.getFlattenedCardList().firstOrDefault(function(e){return e.getViewModel().getModel()&&e.getViewModel().getModelId()===t});o?(o.activateItem(),e.selection&&n.TextHelperMethods.setSelection(o.getTextEditorElement(),e.selection)):StoryLog.RaiseRecoverableError("couldn't find active card by ID")}},e}();t.CardState=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(e){this._cardsContainer=e.cardsContainer,this.selectedCards=TDB.watchableTag(596473796,this,[])}return e.prototype.getSelection=function(e,t){void 0===t&&(t=!1);var n=this.selectedCards.getWatchedValue(e).slice(0);if(t){var o=this._cardsContainer.getFlattenedCardList(e);n.sort(function(e,t){return o.indexOf(e)-o.indexOf(t)})}return n.length>0?n:[]},e.prototype.getSelectionLength=function(){return this.selectedCards.getValue().length},e.prototype.getModelForSelection=function(e,t){void 0===t&&(t=!1);for(var n=[],o=this.getSelection(e,t),i=o.length,r=0;r<i;r++)n.push(o[r].getViewModel().getModel());return n},e.prototype.toggleSelection=function(e){var t=!this.isSelected(e);return this.setSelection(e,t),t},e.prototype.setSelection=function(e,t){var n=this,o=this.selectedCards.getValue(),i=o.indexOf(e);i>-1!==t&&TDB.applyUpdate(function(){if(t){e.isSelectable()&&o.push(e);for(var r=0;r<o.length-1;r++)o[r].getViewModel().canBeSelected(e)||(o.splice(r,1),r--)}else o.splice(i,1);n.selectedCards.setValue(o),n.selectedCards.notify(),e.getListView()&&t&&e.activateItem()})},e.prototype.isSelected=function(e,t){return this.getSelection(t).indexOf(e)>-1},e.prototype.isLastSelected=function(e){var t=this.getSelection();return t.length>0&&e===t.last()},e.prototype.clearSelection=function(){var e=this;TDB.applyUpdate(function(){e.selectedCards.setValue([]),e.selectedCards.notify()},TDB.Justification.SynchronousBrowserEvent)},e.prototype.isInMultiselectMode=function(e){return this.getSelection(e).length>0},e.prototype.getState=function(){return this.selectedCards.getValue().map(function(e){return e.getViewModel().getModelId()})},e.prototype.setState=function(e){this.clearSelection();var t=ArrayExtensions.toDictionary(this._cardsContainer.getFlattenedCardList(),function(e,t){t[e.getViewModel().getModelId()]=e}),n=e.map(function(e){return t[e]});this.selectedCards.setValue(n),n.length>0&&n.first().activateItem()},e.prototype.removeDisposedCard=function(e){this._cardsContainer.getActiveCard()==e&&this._cardsContainer.activeCard.setValue(null),this.isSelected(e)&&this.setSelection(e,!1)},e}();e.CardSelectionManager=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){e[e.Invalid=0]="Invalid",e[e.Group=1]="Group",e[e.Set=2]="Set",e[e.Text=3]="Text",e[e.Image=4]="Image",e[e.Video=5]="Video",e[e.StatusUpdate=6]="StatusUpdate",e[e.Embed=7]="Embed",e[e.Heading=8]="Heading",e[e.Agave=9]="Agave",e[e.Placeholder=10]="Placeholder",e[e.Audio=11]="Audio",e[e.Code=12]="Code",e[e.Table=13]="Table"}(e.CardType||(e.CardType={}))}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t,n=StoryApp.View.ViewElements;!function(e){e[e.SurveyDismissed=0]="SurveyDismissed",e[e.SurveySubmitted=1]="SurveySubmitted"}(t||(t={}));var o=function(e){function o(t,n){var o=e.call(this,t)||this;return o._args=n,o.parent=t,o}return __extends(o,e),o.prototype.wrapperAttrArgs=function(){var e={};return e[Aria.Attributes.Role]=Aria.Roles.Form,e[Aria.Attributes.Label]=Resources.HelpUsImproveSurveyReader,e},o.prototype.surveyHeadingTextArgs=function(){return Resources.HelpUsImproveSurveyHeading},o.prototype.rateSwayQuestionTextArgs=function(){return Resources.HelpUsImproveSurveyRateSwayQuestion},o.prototype.ratingStarsSliderArgs=function(){return new TDB.ChildArgsNoModel(n.FeedbackSurveyStarsSliderVE)},o.prototype.textAreaFeedbackArgs=function(){var e={description:Resources.HelpUsImproveSurveyTextAreaFeedbackPlaceholder,telemetryId:ClientAction.ButtonId.HelpUsImproveSurvey_FeedbackTextArea,placeholder:Resources.HelpUsImproveSurveyTextAreaFeedbackPlaceholder,maxLength:1e3,role:Aria.Roles.Textbox,cssClass:"feedbackSurveyTextArea"};return new TDB.ChildArgs(n.TextAreaVE,e)},o.prototype.copySwayCheckboxArgs=function(){var e={message:Resources.HelpUsImproveSurveyCopySwayCheckbox,messageCss:"helpUsImproveCheckboxText"},t=new TDB.ChildArgs(n.SpanMessageVE,e),o={buttonId:ClientAction.ButtonId.RichCheckbox_HelpUsImproveSurveyCopySway,checked:!0,context:this,cssClass:{value:"helpUsImproveCopyCheckboxWrapperPosition"},richTextElementsUnchecked:[t],richTextElementsChecked:[t],descriptionDefault:e.message,fontIconName:{value:FontIcons.CheckboxFontIcon},fontIconSize:FontIcons.CheckboxFontIconSize,checkedIconWrapperClass:{value:"helpUsImproveCheckboxChecked"},uncheckedIconWrapperClass:{value:"helpUsImproveCheckboxUnchecked"},messagePartsWrapperClass:"helpUsImproveCheckboxTextWrapper"};return new TDB.ChildArgs(n.RichCheckboxVE,o)},o.prototype.submitButtonArgs=function(){var e={context:this,buttonId:ClientAction.ButtonId.HelpUsImproveSurvey_Submit,click:this.submitButtonClick,cssClass:{value:"feedbackSurveySubmitButton"},textClass:"feedbackSurveySubmitButtonText",text:{value:Resources.HelpUsImproveSurveySubmitButton},description:{value:Resources.HelpUsImproveSurveySubmitButton}};return new TDB.ChildArgs(n.TextButtonVE,e)},o.prototype.dismissButtonArgs=function(){var e={context:this,buttonId:ClientAction.ButtonId.HelpUsImproveSurvey_Dismiss,click:this.dismissButtonClick,cssClass:{value:"feedbackSurveyDismissButton"},textClass:"feedbackSurveyDismissButtonText",text:{value:Resources.HelpUsImproveSurveyDismissButton},description:{value:Resources.HelpUsImproveSurveyDismissButton}};return new TDB.ChildArgs(n.TextButtonVE,e)},o.prototype.submitButtonClick=function(e){var n=window.outerWidth?window.outerWidth:0,o=window.outerHeight?window.outerHeight:0,i=this.getZoomLevel();return this.logStoryFeedbackRequest(t.SurveySubmitted,this.ratingStarsSlider.totalRating.getValue(),this.textAreaFeedback.getText(),this.copySwayCheckbox.getChecked(),n,o,i),StoryApp.View.Common.DialogManager.closeCurrentDialog(),this._args.dialogCallback.call(this._args.context),TDB.EventPropagation.Bypass},o.prototype.dismissButtonClick=function(e){var n=window.outerWidth?window.outerWidth:0,o=window.outerHeight?window.outerHeight:0,i=this.getZoomLevel();return this.logStoryFeedbackRequest(t.SurveyDismissed,0,"",!1,n,o,i),StoryApp.View.Common.DialogManager.closeCurrentDialog(),this._args.dialogCallback.call(this._args.context),TDB.EventPropagation.Bypass},o.prototype.logStoryFeedbackRequest=function(e,t,n,i,r,a,s){var l={description:"Duplicate Sway user gave his feedback on",type:"POST",processData:!1,data:JSON.stringify({actionType:e,rating:t,feedback:n,canDuplicate:i,browserWidth:r,browserHeight:a,browserZoom:s}),contentType:StoryApp.RequestManager.JsonContentType,error:function(e,t,n){"timeout"===t||e&&0===e.status?StoryLog.StructuredTraceTag(596473763,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.info,"request timeouted or was terminated because of internet connection",{ErrorStatus:t,ErrorThrown:n,Status:e?e.status.toString():null}):StoryLog.StructuredTraceTag(596473792,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.warning,"request returned a error",{ErrorStatus:t,ErrorThrown:n,Status:e?e.status.toString():null})},timeout:o._requestTimeout};$.ajax(StoryApp.Common.UrlHelper.getInstance().logStoryFeedbackUrl(StoryPageSettings.LookupId),l)},o.prototype.getZoomLevel=function(){return window.screen.deviceXDPI&&window.screen.logicalXDPI?100*window.screen.deviceXDPI/window.screen.logicalXDPI:window.devicePixelRatio?100*window.devicePixelRatio:100},o.prototype.escape=function(){StoryApp.View.Common.DialogManager.closeCurrentDialog()},o._requestTimeout=3e5,o}(TDB.FocusableViewElement);e.HelpUsImproveSurveyVEBase=o}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=e.View.ViewModel,r=function(r){function a(e,t){var n=r.call(this,e)||this;return n.args=t,n.activeDropTarget=t.activeDropTarget||TDB.watchableTag(596473762,n,!1),n.grandparent=t.grandparent?t.grandparent:e.cardParent,n.clickable=void 0===t.clickable||t.clickable,n.cssClass=TDB.watchableOption(n,t.cssClass,""),n.visible=TDB.watchableOption(n,t.visible,!0),t.isGroupTopTweener&&(e.headingCard.getValue().jackHidden=n.activeDropTarget),n}return __extends(a,r),a.prototype.ifCardWrapperArgs=function(e){return e.watchValue(this.visible)},a.prototype.wrapperClassNameArgs=function(e){return(e.watchValue(this.activeDropTarget)?"CardDeckTweenerActive ":"")+(this.clickable?"CardDeckTweener ":"CardDeckNotClickableTweener ")+e.watchValue(this.cssClass)},a.prototype.createDropTargetOwner=function(){var e={context:this,expandable:!1,accept:this.acceptDraggable,calculateDropRect:this.calculateDropRect,setActive:this.setActive,drop:this.dropViewElements,dropFileOrText:this.drop};return new t.CardDropTargetOwner(e)},a.prototype.innerDropTargetInitArgs=function(){return{dragHandler:this.args.cardDragHandler,owner:this.createDropTargetOwner()}},a.prototype.innerClassNameArgs=function(e){if(!this.clickable)return"";this.args.cardsContainer.getActiveCard(e);var n=this.parent.getJack(e);return n&&!n.isMenuShown(e)&&this.parent instanceof t.ComplexHeadingCardVE&&this.parent.isRootHeading()?"CardDeckHeadingTweenerInner":"CardDeckTweenerInner"},a.prototype.hoverWrapperClassNameArgs=function(e){var n=this.getTweenerOwner(),o=n.getJack(e),i=n.isExpanded(e);if(o&&o.isMenuShown(e))return t.TweenerVE.TweenerHoverHiddenCssClass;var r=t.TweenerVE.TweenerHoverCssClass;return o&&o.isVisible(e)&&(r+=i?" "+t.TweenerVE.CardExpandedTweenerHoverWithJackCssClass:" "+t.TweenerVE.TweenerHoverWithJackCssClass),n.isCollapsed(e)?r+=" "+t.TweenerVE.TweenerHoverCollapsedCssClass:i&&(r+=" "+t.TweenerVE.CardExpandedTweenerHoverCssClass),r},a.prototype.acceptDraggable=function(e){if(!this.args.authoringModel.isCardDeckVisible()||this.visible&&!this.visible.getValue())return!1;var n=this.args.parentModel||this.args.model;if(!o.StoryController.isModelObjectValid(n))return!1;var i=o.currentStoryController().get(this.pageId).findOrCreateGroupInsertionPoint(n,this.args.isGroupTopTweener,!!this.args.parentModel),r={parent:i.parent,index:i.index};return!!t.AddAction.isAvailable(t.AuthoringHelperMethods.convertViewElementsToCards(e,this.pageId),r,this.pageId)&&this.grandparent.childAcceptDraggables(this.parent,e)},a.prototype.refreshDropRect=function(){return!1},a.prototype.calculateDropRect=function(e){return this.args.calculateDropRect?this.args.calculateDropRect.call(this.args.context,e):e},a.prototype.setActive=function(e){var t=this;TDB.applyUpdate(function(){t.activeDropTarget.setValue(e)},TDB.Justification.SynchronousBrowserEvent)},a.prototype.activate=function(){},a.prototype.deactivate=function(){},a.prototype.accept=function(e){return!0},a.prototype.dropViewElements=function(e){var n=o.currentStoryController().get(this.pageId).findOrCreateGroupInsertionPoint(this.args.parentModel||this.args.model,this.args.isGroupTopTweener,!!this.args.parentModel);this.parent.getViewModel().tryMoveAfter(e,n,"Dropped content on tweener");var r={};if(e&&1==e.length&&e[0]instanceof t.TextCardVE){var a=e[0].getViewModel().getModel();a&&a&&i.TextCardViewModel.isPullQuote(a)&&(r.isPullQuote=!0)}ActionLogger.RecordClientAction(new ClientAction.CardDeckMoveCardDragDropAction(this.parent.getViewModel().getCardDefinition().id,r))},a.prototype.dragOver=function(e){return!0},a.prototype.dragLeave=function(e){return!0},a.prototype.drop=function(e){return e.preventDefault(),e.stopPropagation(),e.dataTransfer.files.length>0?this.dropFile(e):e.dataTransfer.getData("Text")?this.dropText(e):this.setActive(!1),!1},a.prototype.dropFile=function(t){var i=this;this.setActive(!1),this.getTweenerOwner().activateItem();var r=this.args.beforeFileDrop;r&&r.call(this.args.context),e.Model.currentUndoManager().get(this.pageId).captureUserUpdate(function(){var e=o.StoryController.getFilesFromDataTransfer(t.dataTransfer);i.args.fileUploader.uploadFiles(FileObject.createFileObjects(e),n.ContentProvider[n.ContentProvider.MyDevice]);var r=new ClientAction.FileDraggedAndDropped(e.length);ActionLogger.RecordClientAction(r)},"User dropped file(s) from their desktop onto a Tweener")},a.prototype.dropText=function(n){var r,a=this,s=[],l=n.dataTransfer.getData("Text");e.Model.currentUndoManager().get(this.pageId).captureUserUpdate(function(){var e,n=TextEditor.Cursor.get_Range();t.CommonTextVE.dragging&&n&&(e=i.TextHelperMethods.getTextGroupFromCursor(n.get_startMarker(),a.pageId),n.deleteContent(),TextEditor.Cursor.update(),i.TextHelperMethods.removeEmptyCursorParagraphs(n.get_startMarker(),n.get_endMarker()),t.CommonTextVE.commit()),a.setActive(!1),a.parent.activateItem(),t.CommonTextVE.dragging&&e&&i.TextHelperMethods.deleteCardIfEmptyText(e,a.args.cardsContainer),s=i.TextHelperMethods.createParagraphsFromDraggedText(l,a.pageId),r=o.currentTextController().get(a.pageId).createFromParagraphs(s),a.args.cardsContainer.addCardObjects([new o.Card({definition:new o.CardDefinitionManager(a.pageId).getCardDefinition(o.ManualCardType.TextId),model:r})]);var c=new ClientAction.TextDraggedAndDropped(l.length);ActionLogger.RecordClientAction(c),t.CommonTextVE.dragging=!1},"User dropped text onto a Tweener"),r&&this.args.cardsContainer.scrollToModelsAndSetFocus([r],!1)},a.prototype.mouseClicked=function(e){if(this.clickable){if(1!==e.which)return TDB.EventPropagation.Bubble;this.args.cardSelectionManager.clearSelection();var t=this.getTweenerOwner();t.activateItem();var n=t.getJack();return n&&n.openMenu(),TDB.EventPropagation.Bypass}return TDB.EventPropagation.Bubble},a.prototype.getTweenerOwner=function(){return this.parent.isGroupCard()&&this.args.isGroupTopTweener?this.parent.getViewModel().getHeadingCard():this.parent},a.TweenerHoverHiddenCssClass="TweenerHoverHidden",a.TweenerHoverCssClass="TweenerHover",a.CardExpandedTweenerHoverWithJackCssClass="CardExpandedTweenerHoverWithJack",a.TweenerHoverWithJackCssClass="CardCollapsedTweenerHoverWithJack",a.CardExpandedTweenerHoverCssClass="CardExpandedTweenerHover",a.TweenerHoverCollapsedCssClass="TweenerHoverCollapsed",a}(TDB.FocusableViewElement);t.TweenerVEBase=r}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.View.ViewModel,i=function(e){function i(t,n){var i=e.call(this,t)||this;return i.viewModel=new o.ExpandedCardViewModel(i,n.viewModelArgs),i.viewModel.setView(i),i.authoringModel=n.authoringModel,i}return __extends(i,e),i.prototype.isRootHeading=function(){return!1},i.prototype.getViewModel=function(){return this.viewModel},i.prototype.backgroundStyleArgs=function(e){var n="-"+(this.authoringModel.isCardDeckVisible(e)?t.ContainerCardHeaderVE.backplaneExtension:t.ContainerCardHeaderVE.smallBackplaneExtension)+"px";return{left:n,right:n,backgroundColor:"rgba(0,0,0, .08)"}},i.prototype.collapseButtonWrapperStyleArgs=function(e){return{paddingBottom:"5px"}},i.prototype.collapseButtonArgs=function(e){var t={buttonId:ClientAction.ButtonId.CardAction_CollapseCardDetail,context:this.viewModel,cssClass:{value:"ContainerCardCollapseButton"},description:{value:ResourceManager.ResolveString(Resources.HideCardDetailsWithType,[this.parent.cardLabelDefaultText])},tooltip:{value:Resources.HideCardDetails},fontIconName:{value:FontIcons.CollapseIcon},fontIconSizeClass:FontIcons.ExpandIconSize,fontIconWrapperClass:{value:"ContainerCardCollapseFontIconWrapper"},click:this.viewModel.collapseButtonClicked,text:{value:this.viewModel.getLabel()},textClass:"ContainerCardHeaderLabel segoeUISemibold",textPlacementRight:!0};return new TDB.ChildArgs(n.GlyphButtonVE,t)},i.prototype.expandedCardContentArgs=function(e){return this.viewModel.getContentArgs(e)},i.prototype.getChildCards=function(e){return this.expandedCardContent.getChildren(e)},i.prototype.getCollapseButton=function(){return this.collapseButton},i}(TDB.FocusableViewElement);t.ExpandedCardVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=function(e){function o(t,n){var o=e.call(this,t)||this;return o._cardFactory=n.cardFactory,o._cardModel=n.cardModel,o._card=n.card,o._cardViewModel=n.cardViewModel,o.socketModels=[],o.viewModelChildren=TDB.mappedWatcherOwnerTag(596473793,o,o,o.getModelChildren,o.viewModelConstructor),o}return __extends(o,e),o.prototype.setView=function(e){this._view=e},o.prototype.getSockets=function(){var e=this._cardViewModel.getSockets(),t=this._cardViewModel.getSocket();return t&&!t.getDefinition().isCaptionSupported()?e.filter(function(e){return"Caption"!==e.getDefinition().getId()}):e},o.prototype.getModelChildren=function(e){var t=this.getSockets(),o=t.length,i=this.socketModels.length!=o;i&&(this.socketModels=[]);for(var r=0;r<o;r++){var a=t[r],s=a.getModelObject(e);if(i||s!==this.socketModels[r].model){StoryLog.StructuredTraceTag(596473794,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Create expanded card content",{card:this._cardViewModel.getModelId(),cardValid:n.StoryController.isModelObjectValid(this._cardViewModel.getModel()).toString(),socketIndex:r.toString(),socketModel:s?s.id:"undefined",socketValid:n.StoryController.isModelObjectValid(a.getModelObject()).toString()});var l={socket:a,model:s};i?this.socketModels.push(l):this.socketModels[r]=l}}return this.socketModels},o.prototype.viewModelConstructor=function(e){return!e.socket.socketModelExists()&&e.socket.getDefinition().getHasDefaultContent()?this._cardFactory.createViewModelWithoutModel(null,e.socket):e.socket.socketModelExists()?this._cardFactory.createViewModel(null,{model:e.model,socket:e.socket}):this._cardFactory.createEmptySocketCardVM(null,e.socket)},o.prototype.getContentArgs=function(e){for(var t=[],n=this.viewModelChildren.getWatchedValue(e),o=n.length,i=0;i<o;i++){var r=n[i],a=!0;0===i&&r.getSocket().getDefinition().isSocketRequired()&&(a=!1),t.push(this._cardFactory.createArgs({viewModel:r,cardParent:this._card,showSocketLabel:a}))}return t},o.prototype.collapseButtonClicked=function(e){return this._cardViewModel.setCardMode(t.CardMode.Collapsed),this._cardViewModel.getView().activateItem(),TDB.EventPropagation.Bypass},o.prototype.getLabel=function(){return 0===this._cardViewModel.getCardDefinition().getSocketDefinitions().length?(StoryLog.StructuredTraceTag(596473795,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.error,"Card definition does not have sockets but is expected to have at least one.",{"Definition ID":this._cardViewModel.getCardDefinition().id}),""):this._cardViewModel.getCardDefinition().title},o}(Disposable);t.ExpandedCardViewModel=o}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(e){this.controller=e.controller,this.modelProperties=e.modelProperties?e.modelProperties:{}}return e.areEqual=function(e,t){return null!=e&&null!=t&&(e.controller==t.controller&&Obj.equals(e.modelProperties,t.modelProperties))},e}();e.Blueprint=t}(e.AuthoringModel||(e.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function t(e){this.id=e.id,this.buttonId=e.buttonId,this.title=e.title,this.description=e.description,this.storylineDescription=e.storylineDescription,this.fontIconName=e.fontIconName,this.category=e.category,this.blueprint=e.blueprint,this.suggested=e.suggested,this.placeholderBlueprint=e.placeholderBlueprint?e.placeholderBlueprint:e.blueprint,this._socketDefinitions=e.socketDefinitions?e.socketDefinitions:[],this.textButtonId=e.textButtonId,this.enabled=e.enabled?e.enabled:TDB.watcherTag(596473625,this,null,function(e){return!0}),this.cardCapabilities={group:!0,groupType:!0,ungroup:!0,focus:!0,emphasis:!0,decorative:!0,record:!0}}return t.prototype.hasSockets=function(){return this._socketDefinitions.length>0},t.prototype.getSocketDefinitions=function(){return this._socketDefinitions},t.prototype.create=function(){return StoryApp.Common.UserState.getInstance().isEligibleForFirstClassEmbedCardExperiment()&&this.blueprint.controller instanceof e.EmbedController?this.blueprint.controller.create({modelProperties:this.blueprint.modelProperties},this.id):this.blueprint.controller.create({modelProperties:this.blueprint.modelProperties})},t.prototype.canTransform=function(t){return this.blueprint.controller instanceof e.ContainerController&&this.blueprint.controller.canTransform(t,{modelProperties:this.blueprint.modelProperties})},t.prototype.transform=function(e){if(this.canTransform(e))return this.blueprint.controller.transform(e,{modelProperties:this.blueprint.modelProperties})},t.prototype.getCardControls=function(){return this.cardCapabilities},t}();e.CardDefinition=t}(e.AuthoringModel||(e.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Server.Decomposition.WP,i=e.Server.ContentSourcesManager,r=function(){function e(){}return e.Background="Background",e.Title="Title",e.HeadingTitle="HeadingTitle",e.Image="Image",e.Video="Video",e.Caption="Caption",e.AltText="AltText",e.Subtitle="Subtitle",e.Author="Author",e.ClosedCaption="ClosedCaption",e.AudioThumbnail="AudioThumbnail",e.Logo="Logo",e}(),a=function(){function e(){}return e.Normal="Normal",e.Heading="Heading",e.Title="Title",e}();t.TextStyle=a;var s;!function(e){e[e.Text=0]="Text",e[e.Media=1]="Media",e[e.Visualizations=2]="Visualizations",e[e.Beta=3]="Beta",e[e.Hidden=4]="Hidden"}(s=t.CardCategory||(t.CardCategory={}));var l=function(){function e(e){var o=this;this.pageId=e,this.setupSocketDefinitions(),this.cardDefinitions={};var a=t.currentHeaderController().get(e),l=t.currentTextController().get(e),c=t.currentImageController().get(e),d=t.currentVideoController().get(e),u=t.currentStatusUpdateController().get(e),p=t.currentAudioController().get(e),g=t.currentEmbedController().get(e),h=t.currentAgaveController().get(e),C=t.currentSetController().get(e),f=t.currentDocumentContentController().get(e),m=t.currentGroupController().get(e),y=t.currentImportingOrEmbeddingDocumentController().get(e),v=t.currentCodeController().get(e),S=t.currentTableController().get(e);this.addCardDefinition(new t.CardDefinition({id:t.ManualCardType.HeaderId,buttonId:ClientAction.ButtonId.CardOption_Header,title:StoryPageEditSettings.SubHeadingsEnabled?Resources.HeaderCardTitleWithSubheadingEnabled:Resources.HeaderCardTitle,description:Resources.HeaderCardDescription,storylineDescription:Resources.HeaderCardStorylineDescription,fontIconName:FontIcons.CardHeaderIcon,category:s.Text,blueprint:new t.Blueprint({controller:a}),placeholderBlueprint:new t.Blueprint({controller:a,modelProperties:{placeholder:!0}}),textButtonId:ClientAction.ButtonId.Heading_TextField_H1,socketDefinitions:[this._socketDefinitions[r.HeadingTitle],this._socketDefinitions[r.Background]]})),this.addCardDefinition(new t.CardDefinition({id:t.ManualCardType.SubHeaderId,buttonId:ClientAction.ButtonId.CardOption_Subheader,title:Resources.SubHeaderCardTitleWithSubheadingEnabled,description:Resources.SubheaderCardDescription,storylineDescription:Resources.SubheaderCardStorylineDescription,fontIconName:FontIcons.CardSubheaderIcon,category:StoryPageEditSettings.SubHeadingsEnabled?s.Text:s.Hidden,textButtonId:ClientAction.ButtonId.Heading_TextField_H2,blueprint:new t.Blueprint({controller:a}),placeholderBlueprint:new t.Blueprint({controller:a,modelProperties:{placeholder:!0}})})),this.addCardDefinition(new t.CardDefinition({id:t.ManualCardType.TextId,buttonId:ClientAction.ButtonId.CardOption_Text,title:Resources.JackAddText,description:Resources.TextCardDescription,storylineDescription:Resources.TextCardStorylineDescription,fontIconName:FontIcons.CardTextIcon,category:s.Text,blueprint:new t.Blueprint({controller:l})})),StoryPageSettings.ShowCodeCardsButton&&this.addCardDefinition(new t.CardDefinition({id:t.ManualCardType.CodeId,buttonId:ClientAction.ButtonId.CardOption_Code,title:"Code",description:"Code card description",storylineDescription:"Code card storyline description",fontIconName:FontIcons.CardTextIcon,category:s.Text,blueprint:new t.Blueprint({controller:v})})),this.addCardDefinition(new t.CardDefinition({id:t.ManualCardType.ImageId,buttonId:ClientAction.ButtonId.CardOption_Picture,title:Resources.ImageCardTitle,description:Resources.PictureCardDescription,storylineDescription:Resources.PictureCardStorylineDescription,fontIconName:FontIcons.CardImageIcon,category:s.Media,blueprint:new t.Blueprint({controller:c}),placeholderBlueprint:new t.Blueprint({controller:c,modelProperties:{placeholder:!0}}),socketDefinitions:[this._socketDefinitions[r.Image],this._socketDefinitions[r.Caption],this._socketDefinitions[r.AltText]]})),this.addCardDefinition(new t.CardDefinition({id:t.ManualCardType.VideoId,buttonId:ClientAction.ButtonId.CardOption_Video,title:Resources.VideoCardTitle,description:Resources.VideoCardDescription,storylineDescription:Resources.VideoCardStorylineDescription,fontIconName:FontIcons.CardVideoIcon,category:s.Media,blueprint:new t.Blueprint({controller:d}),placeholderBlueprint:new t.Blueprint({controller:d,modelProperties:{placeholder:!0}}),socketDefinitions:[this._socketDefinitions[r.Video],this._socketDefinitions[r.Caption],this._socketDefinitions[r.AltText],this._socketDefinitions[r.ClosedCaption]]})),this.addCardDefinition(new t.CardDefinition({id:t.ManualCardType.StatusUpdateId,buttonId:ClientAction.ButtonId.CardOption_Tweet,title:Resources.TweetCardTitle,description:Resources.TweetCardDescription,storylineDescription:Resources.TweetCardStorylineDescription,fontIconName:FontIcons.CardTweetIcon,category:s.Hidden,blueprint:new t.Blueprint({controller:u}),placeholderBlueprint:new t.Blueprint({controller:u,modelProperties:{placeholder:!0}}),enabled:TDB.watcherTag(596473624,this,null,function(e){return i.ContentSourcesManager.isProviderAvailable(n.ContentProvider.Twitter,o.pageId,e)})})),StoryPageEditSettings.BlockAuthoring_Audio||this.addCardDefinition(new t.CardDefinition({id:t.ManualCardType.AudioId,buttonId:ClientAction.ButtonId.CardOption_Audio,title:Resources.AudioCardTitle,description:Resources.AudioCardDescription,storylineDescription:Resources.AudioCardDescription,fontIconName:FontIcons.CardAudioIcon,category:s.Media,blueprint:new t.Blueprint({controller:p}),placeholderBlueprint:new t.Blueprint({controller:p,modelProperties:{placeholder:!0}}),socketDefinitions:[this._socketDefinitions[r.AudioThumbnail],this._socketDefinitions[r.Caption],this._socketDefinitions[r.ClosedCaption]]})),StoryPageSettings.BlockService_EmbedDecomp||(StoryApp.Common.UserState.getInstance().isEligibleForFirstClassEmbedCardExperiment()&&(CommonSettings.CurrentUserType===UserType.MSA?StoryPageEditSettings.FirstClassEmbedCardMSASources:StoryPageEditSettings.FirstClassEmbedCardBUSSources).forEach(function(e){var n=o.getEmbedCardDefinitionPayload(e);n&&o.addCardDefinition(new t.CardDefinition({id:e,buttonId:n.buttonId,title:n.title,description:n.description,storylineDescription:n.storylineDescription,fontIconName:n.fontIconName,category:s.Media,blueprint:new t.Blueprint({controller:g})}))}),this.addCardDefinition(new t.CardDefinition({id:t.ManualCardType.EmbedId,buttonId:ClientAction.ButtonId.CardOption_Embed,title:Resources.EmbedAddButton,description:Resources.EmbedCardDescription,storylineDescription:Resources.EmbedCardStorylineDescription,fontIconName:FontIcons.CardEmbedIcon,category:s.Media,blueprint:new t.Blueprint({controller:g})}))),CommonSettings.ShowCodeCardsButton&&this.addCardDefinition(new t.CardDefinition({id:t.ManualCardType.CodeId,buttonId:ClientAction.ButtonId.CardOption_Code,title:Resources.EmbedAddButton,description:Resources.EmbedCardDescription,storylineDescription:Resources.EmbedCardStorylineDescription,fontIconName:FontIcons.CardEmbedIcon,category:s.Text,blueprint:new t.Blueprint({controller:v})})),this.addCardDefinition(new t.CardDefinition({id:t.ManualCardType.ChartId,buttonId:ClientAction.ButtonId.CardOption_Chart,title:Resources.ChartAddButton,description:Resources.ChartCardDescription,storylineDescription:Resources.ChartCardStorylineDescription,fontIconName:FontIcons.CardChartIcon,category:StoryPageEditSettings.SiteChartAuthoringEnabled?s.Media:s.Hidden,blueprint:new t.Blueprint({controller:h})})),this.addCardDefinition(new t.CardDefinition({id:t.ManualCardType.GroupId,buttonId:ClientAction.ButtonId.CardOption_Group,title:Resources.TransformAuto,description:Resources.AutomaticCardDescription,storylineDescription:Resources.AutomaticCardStorylineDescription,fontIconName:FontIcons.CardGroupIcon,category:s.Visualizations,blueprint:new t.Blueprint({controller:C,modelProperties:{visualization:n.Visualization.Auto}})})),this.addCardDefinition(new t.CardDefinition({id:t.ManualCardType.StackId,buttonId:ClientAction.ButtonId.CardOption_Stack,title:Resources.TransformStack,description:Resources.StackCardDescription,storylineDescription:Resources.StackCardStorylineDescription,fontIconName:FontIcons.CardStackIcon,category:s.Visualizations,blueprint:new t.Blueprint({controller:C,modelProperties:{visualization:n.Visualization.Stack}})})),StoryPageSettings.SiteAgaveEnabled&&(this.addCardDefinition(new t.CardDefinition({id:t.ManualCardType.ComparisonId,buttonId:ClientAction.ButtonId.CardOption_Comparison,title:Resources.TransformComparison,description:Resources.ComparisonCardDescription,storylineDescription:Resources.ComparisonCardStorylineDescription,fontIconName:FontIcons.CardComparisonIcon,category:s.Visualizations,blueprint:new t.Blueprint({controller:C,modelProperties:{visualization:n.Visualization.Comparison}})})),this.addCardDefinition(new t.CardDefinition({id:t.ManualCardType.GalleryId,buttonId:ClientAction.ButtonId.CardOption_Slideshow,title:Resources.TransformGallery,description:Resources.SlideshowCardDescription,storylineDescription:Resources.SlideshowCardStorylineDescription,fontIconName:FontIcons.CardSlideshowIcon,category:s.Visualizations,blueprint:new t.Blueprint({controller:C,modelProperties:{visualization:n.Visualization.Gallery}})}))),StoryPageEditSettings.LayoutEnableUniformGrid&&this.addCardDefinition(new t.CardDefinition({id:t.ManualCardType.UniformGridId,buttonId:ClientAction.ButtonId.CardOption_Grid,title:Resources.TransformUniformGrid,description:Resources.GridCardDescription,storylineDescription:Resources.GridCardStorylineDescription,fontIconName:FontIcons.CardUniformGridIcon,category:s.Visualizations,blueprint:new t.Blueprint({controller:C,modelProperties:{visualization:n.Visualization.UniformGrid}})})),this.addCardDefinition(new t.CardDefinition({id:t.ManualCardType.DocumentId,buttonId:ClientAction.ButtonId.CardOption_Document,title:Resources.DocumentCardTitle,description:Resources.DocumentCardDescription,storylineDescription:Resources.DocumentCardStorylineDescription,fontIconName:"",category:s.Hidden,blueprint:new t.Blueprint({controller:f})})),this.addCardDefinition(new t.CardDefinition({id:t.ManualCardType.rootSectionId,buttonId:ClientAction.ButtonId.CardOption_Group,title:"",description:"",storylineDescription:"",fontIconName:"",category:s.Hidden,blueprint:new t.Blueprint({controller:m})})),this.addCardDefinition(new t.CardDefinition({id:t.ManualCardType.ImportingDocumentId,buttonId:ClientAction.ButtonId.CardOption_ImportingOrEmbedding,title:"",description:"",storylineDescription:"",fontIconName:"",category:s.Hidden,blueprint:new t.Blueprint({controller:y})})),this.addCardDefinition(new t.CardDefinition({id:t.ManualCardType.SectionId,buttonId:ClientAction.ButtonId.CardOption_Group,title:"",description:"",storylineDescription:"",fontIconName:"",category:s.Hidden,blueprint:new t.Blueprint({controller:m})})),this.addCardDefinition(new t.CardDefinition({id:t.ManualCardType.SubSectionId,buttonId:ClientAction.ButtonId.CardOption_Group,title:"",description:"",storylineDescription:"",fontIconName:"",category:s.Hidden,blueprint:new t.Blueprint({controller:m})})),this.addCardDefinition(new t.CardDefinition({id:t.ManualCardType.TableId,buttonId:ClientAction.ButtonId.CardOption_Table,title:"",description:"",storylineDescription:"",fontIconName:"",category:s.Hidden,blueprint:new t.Blueprint({controller:S})}));var T=[this._socketDefinitions[r.Title],this._socketDefinitions[r.Background]];StoryPageEditSettings.StoryLogoEnabled&&T.push(this._socketDefinitions[r.Logo]),StoryPageEditSettings.StoryAuthorSubtitleEnabled&&(T.push(this._socketDefinitions[r.Subtitle]),T.push(this._socketDefinitions[r.Author])),this.addCardDefinition(new t.CardDefinition({id:t.ManualCardType.TitleId,buttonId:ClientAction.ButtonId.CardOption_Header,title:Resources.HeaderCardTitle,description:Resources.HeaderCardDescription,storylineDescription:Resources.HeaderCardStorylineDescription,fontIconName:FontIcons.CardHeaderIcon,category:s.Hidden,blueprint:new t.Blueprint({controller:a}),placeholderBlueprint:new t.Blueprint({controller:a,modelProperties:{placeholder:!0}}),socketDefinitions:T,textButtonId:ClientAction.ButtonId.Heading_TextField_Title})),this.setupClipTypeToCardMap(),this.setupPasteArgs()}return e.prototype.containsCardDefinition=function(e){return void 0!==this.cardDefinitions[e]},e.prototype.getCardDefinition=function(e){return this.cardDefinitions[e]},e.prototype.getCardDefinitions=function(e){var t={};if(null!=e)for(var n=e.length,o=0;o<n;o++)t[e[o]]=this.getCardDefinition(e[o]);return t},e.prototype.addCardDefinition=function(e){return null!=e&&null!=e.id&&""!=e.id&&!this.containsCardDefinition(e.id)&&(this.cardDefinitions[e.id]=e,!0)},e.prototype.getCardsForCategory=function(e,t){var n=[];for(var o in this.cardDefinitions){var i=this.getCardDefinition(o);null!=i&&i.category==e&&n.push(i)}return n},e.prototype.getVisibleCategories=function(e){return[s.Text,s.Media,s.Visualizations]},e.prototype.getCardsForChange=function(e){var n=[];return n.push(this.getCardDefinition(t.ManualCardType.GroupId)),n.push(this.getCardDefinition(t.ManualCardType.StackId)),n},e.prototype.setupClipTypeToCardMap=function(){this.clipTypeMap={},this.clipTypeMap[o.ClipType.Text]=this.getCardDefinition(t.ManualCardType.TextId),this.clipTypeMap[o.ClipType.Image]=this.getCardDefinition(t.ManualCardType.ImageId),this.clipTypeMap[o.ClipType.SuggestedImage]=this.getCardDefinition(t.ManualCardType.ImageId),this.clipTypeMap[o.ClipType.WikipediaCard]=this.getCardDefinition(t.ManualCardType.ImageId),this.clipTypeMap[o.ClipType.Video]=this.getCardDefinition(t.ManualCardType.VideoId),this.clipTypeMap[o.ClipType.Audio]=this.getCardDefinition(t.ManualCardType.AudioId),this.clipTypeMap[o.ClipType.StatusUpdate]=this.getCardDefinition(t.ManualCardType.StatusUpdateId),this.clipTypeMap[o.ClipType.Document]=this.getCardDefinition(t.ManualCardType.DocumentId)},e.prototype.setupPasteArgs=function(){this.pasteArgs=this.getCardDefinitions([t.ManualCardType.TextId,t.ManualCardType.ImageId,t.ManualCardType.GroupId])},e.prototype.setupSocketDefinitions=function(){this._socketDefinitions={},this._socketDefinitions[r.Background]=new t.SocketDefinition({id:r.Background,title:Resources.BackgroundSocketTitle,defaultDataType:t.CompositeType.ImageWithTextComposite,placeholderText:Resources.BackgroundSocketPlaceholder,placeholderTextTooltip:Resources.BackgroundSocketTooltip,modelProperty:t.SocketModelProperty.LegacyBackground,isRequiredSocket:!0,showWhenCollapsed:!0,telemetryId:ClientAction.ButtonId.Socket_BackgroundSocket,defaultActionType:t.SocketActionType.AddCard}),this._socketDefinitions[r.Title]=new t.SocketDefinition({id:r.Title,title:Resources.TitleSocketTitle,defaultDataType:t.CompositeType.Paragraph,placeholderText:"",placeholderTextTooltip:"",contentHint:Resources.CardDeckChapterTitlePlaceholder,modelProperty:t.SocketModelProperty.LegacyTitle,textPlaceholderText:Resources.CardDeckStoryTitlePlaceholder,textStyle:a.Title,authoringCapabilities:{textEmphasis:!0,textAccent:!0,textBullets:!1,textLink:!0,textHeading:!1,mediaDecorative:!1,textDirection:!0},showWhenCollapsed:!0,telemetryId:ClientAction.ButtonId.Socket_TitleSocket,defaultActionType:t.SocketActionType.AddCard}),this._socketDefinitions[r.HeadingTitle]=new t.SocketDefinition({id:r.HeadingTitle,title:Resources.CardDeckHeadingLabel,defaultDataType:t.CompositeType.Paragraph,placeholderText:"",placeholderTextTooltip:"",contentHint:Resources.CardDeckChapterTitlePlaceholder,modelProperty:t.SocketModelProperty.LegacyTitle,textPlaceholderText:Resources.CardDeckChapterTitlePlaceholder,textStyle:a.Heading,authoringCapabilities:{textEmphasis:!0,textAccent:!0,textBullets:!1,textLink:!0,textHeading:!1,mediaDecorative:!1,textDirection:!0},showWhenCollapsed:!0,telemetryId:ClientAction.ButtonId.Socket_HeadingSocket,defaultActionType:t.SocketActionType.AddCard}),this._socketDefinitions[r.Image]=new t.SocketDefinition({id:r.Image,title:Resources.ImageSocketTitle,defaultDataType:t.CompositeType.Image,placeholderText:"",placeholderTextTooltip:"",modelProperty:t.SocketModelProperty.LegacyImage,isRequiredSocket:!0,showWhenCollapsed:!0,telemetryId:ClientAction.ButtonId.Socket_ImageSocket,defaultActionType:t.SocketActionType.ShowMenu}),this._socketDefinitions[r.Video]=new t.SocketDefinition({id:r.Video,title:Resources.VideoCardTitle,defaultDataType:t.CompositeType.Image,placeholderText:"",placeholderTextTooltip:"",modelProperty:t.SocketModelProperty.LegacyImage,isRequiredSocket:!0,showWhenCollapsed:!0,telemetryId:ClientAction.ButtonId.Socket_VideoSocket,defaultActionType:t.SocketActionType.ShowMenu}),this._socketDefinitions[r.Caption]=new t.SocketDefinition({id:r.Caption,title:Resources.CaptionSocketTitle,defaultDataType:t.CompositeType.TextGroup,placeholderText:Resources.CaptionSocketPlaceholder,modelProperty:t.SocketModelProperty.LegacyCaption,placeholderTextTooltip:Resources.CaptionSocketTooltip,contentHint:Resources.CardDeckMediaCardCaptionPlaceholder,textPlaceholderText:Resources.CardDeckMediaCardCaptionPlaceholder,textStyle:a.Normal,authoringCapabilities:{textEmphasis:!0,textAccent:!0,textBullets:!0,textLink:!0,textHeading:!1,mediaDecorative:!1,textDirection:!0},showWhenCollapsed:!0,telemetryId:ClientAction.ButtonId.Socket_CaptionSocket,defaultActionType:t.SocketActionType.ShowMenu}),this._socketDefinitions[r.AltText]=new t.SocketDefinition({id:r.AltText,title:Resources.AltTextSocketTitle,defaultDataType:t.CompositeType.Paragraph,placeholderText:Resources.AltTextSocketPlaceholder,placeholderTextTooltip:Resources.AltTextSocketTooltip,contentHint:Resources.AccessibilityCheckerMissingAltTextTextBoxPlaceholder,modelProperty:t.SocketModelProperty.LegacyAltText,textPlaceholderText:Resources.AccessibilityCheckerMissingAltTextTextBoxPlaceholder,textStyle:a.Normal,authoringCapabilities:{textEmphasis:!1,textAccent:!1,textBullets:!1,textLink:!1,textHeading:!1,mediaDecorative:!0,textDirection:!0},showWhenCollapsed:!1,telemetryId:ClientAction.ButtonId.Socket_AltTextSocket,hasDefaultContent:!0,defaultActionType:t.SocketActionType.AddCard}),this._socketDefinitions[r.Subtitle]=new t.SocketDefinition({id:r.Subtitle,title:Resources.SubtitleSocketTitle,defaultDataType:t.CompositeType.Paragraph,placeholderText:Resources.SubtitleSocketPlaceholder,placeholderTextTooltip:Resources.SubtitleSocketPlaceholder,contentHint:Resources.SubtitleSocketPlaceholder,modelProperty:t.SocketModelProperty.LegacySubtitle,textPlaceholderText:Resources.SubtitleSocketPlaceholder,textStyle:a.Normal,authoringCapabilities:{textEmphasis:!1,textAccent:!1,textBullets:!1,textLink:!1,textHeading:!1,mediaDecorative:!1,textDirection:!0},showWhenCollapsed:!1,telemetryId:ClientAction.ButtonId.Socket_SubtitleSocket,defaultActionType:t.SocketActionType.AddCard}),this._socketDefinitions[r.Author]=new t.SocketDefinition({id:r.Author,title:Resources.AuthorSocketTitle,defaultDataType:t.CompositeType.Paragraph,placeholderText:Resources.AuthorSocketPlaceholder,placeholderTextTooltip:Resources.AuthorSocketPlaceholder,contentHint:Resources.AuthorSocketPlaceholder,modelProperty:t.SocketModelProperty.LegacyAuthor,textPlaceholderText:Resources.AuthorSocketPlaceholder,textStyle:a.Normal,authoringCapabilities:{textEmphasis:!1,textAccent:!1,textBullets:!1,textLink:!1,textHeading:!1,mediaDecorative:!1,textDirection:!0},showWhenCollapsed:!1,telemetryId:ClientAction.ButtonId.Socket_AuthorSocket,defaultActionType:t.SocketActionType.AddCard}),this._socketDefinitions[r.ClosedCaption]=new t.SocketDefinition({id:r.ClosedCaption,title:Resources.ClosedCaptionSocketTitle,defaultDataType:t.CompositeType.ClosedCaption,placeholderText:Resources.ClosedCaptionSocketPlaceholder,placeholderTextTooltip:Resources.ClosedCaptionSocketPlaceholder,contentHint:Resources.ClosedCaptionSocketPlaceholder,modelProperty:t.SocketModelProperty.LegacyClosedCaption,textPlaceholderText:Resources.ClosedCaptionSocketPlaceholder,textStyle:a.Normal,showWhenCollapsed:!1,telemetryId:ClientAction.ButtonId.Socket_ClosedCaptionSocket,hasDefaultContent:!0,defaultActionType:t.SocketActionType.OpenFilePicker}),this._socketDefinitions[r.AudioThumbnail]=new t.SocketDefinition({id:r.AudioThumbnail,title:Resources.AudioThumbnailSocketTitle,defaultDataType:t.CompositeType.Image,placeholderText:"",placeholderTextTooltip:"",modelProperty:t.SocketModelProperty.LegacyImage,isRequiredSocket:!0,showWhenCollapsed:!0,telemetryId:ClientAction.ButtonId.Socket_AudioThumbnailSocket,defaultActionType:t.SocketActionType.ShowMenu}),this._socketDefinitions[r.Logo]=new t.SocketDefinition({id:r.Logo,title:Resources.LogoSocketTitle,defaultDataType:t.CompositeType.ImageWithTextComposite,placeholderText:Resources.LogoSocketPlaceholder,placeholderTextTooltip:Resources.LogoSocketTooltip,modelProperty:t.SocketModelProperty.LegacyLogo,isRequiredSocket:!1,isPremiumSocket:!0,showWhenCollapsed:!1,authoringCapabilities:{textEmphasis:!1,textAccent:!1,textBullets:!1,textLink:!1,textHeading:!1,mediaDecorative:!1,textDirection:!1},telemetryId:ClientAction.ButtonId.Socket_LogoSocket,defaultActionType:t.SocketActionType.OpenFilePicker,cardControlOverrides:{group:!0,groupType:!0,ungroup:!0,focus:!1,emphasis:!1,decorative:!0,record:!0},captionSupported:!1})},e.prototype.getEmbedCardDefinitionPayload=function(e){switch(e){case t.ManualCardType.PowerBiId:return{buttonId:ClientAction.ButtonId.CardOption_PowerBi,title:Resources.EmbedInfoMessagePowerBiButtonTitle,fontIconName:FontIcons.CardEmbedIcon,description:Resources.PowerBiEmbedCardDescription,storylineDescription:Resources.PowerBiEmbedCardStorylineDescription};case t.ManualCardType.SharePointId:return{buttonId:ClientAction.ButtonId.CardOption_SharePoint,title:Resources.EmbedInfoMessageSharePointButtonTitle,fontIconName:FontIcons.CardEmbedIcon,description:Resources.SharePointEmbedCardDescription,storylineDescription:Resources.SharePointEmbedCardStorylineDescription};case t.ManualCardType.SwayId:return{buttonId:ClientAction.ButtonId.CardOption_Sway,title:Resources.ProductNameShort,fontIconName:FontIcons.SwayWatermarkIcon,description:Resources.SwayEmbedCardDescription,storylineDescription:Resources.SwayEmbedCardStorylineDescription};case t.ManualCardType.SketchfabId:return{buttonId:ClientAction.ButtonId.CardOption_Sketchfab,title:Resources.EmbedInfoMessageSketchfabButtonTitle,fontIconName:FontIcons.CardEmbedIcon,description:Resources.SketchfabEmbedCardDescription,storylineDescription:Resources.SketchfabEmbedCardStorylineDescription};case t.ManualCardType.VimeoId:return{buttonId:ClientAction.ButtonId.CardOption_Vimeo,title:Resources.SuggestSourceVimeo,fontIconName:FontIcons.CardEmbedIcon,description:Resources.VimeoEmbedCardDescription,storylineDescription:Resources.VimeoEmbedCardStorylineDescription};case t.ManualCardType.TwitterId:return{buttonId:ClientAction.ButtonId.CardOption_Twitter,title:Resources.FollowTwitter,fontIconName:FontIcons.CardTweetIcon,description:Resources.TwitterEmbedCardDescription,storylineDescription:Resources.TwitterEmbedCardStorylineDescription};default:return}},e}();t.CardDefinitionManager=l}(t.AuthoringModel||(t.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){function n(){return l||(l=a.PageCompartmentManager.getInstance().createAccessor("StoryController")),l}var o,i=e.Model.SM,r=e.Model.CSM,a=StoryApp.Common;!function(e){e[e.Text=0]="Text",e[e.Image=1]="Image",e[e.Video=2]="Video",e[e.StatusUpdate=3]="StatusUpdate",e[e.Map=4]="Map",e[e.Embed=5]="Embed",e[e.Document=6]="Document",e[e.WikipediaCard=7]="WikipediaCard",e[e.Audio=8]="Audio",e[e.ClosedCaption=9]="ClosedCaption"}(o=t.ClipType||(t.ClipType={}));var s;!function(e){e[e.Uploading=0]="Uploading",e[e.Error=1]="Error",e[e.WaitingPreprocessing=2]="WaitingPreprocessing",e[e.Preprocessing=3]="Preprocessing",e[e.PreprocessingError=4]="PreprocessingError",e[e.Completed=5]="Completed",e[e.Transferring=6]="Transferring"}(s=t.UploadStatus||(t.UploadStatus={}));var l;t.currentStoryController=n;var c=function(a){function l(e,t){var n=a.call(this,t)||this;return n.model=e,n.rootGroup=e.traversalModel.getSpecifiedGrouping().getRootGroup(),n}return __extends(l,a),l.prototype.getModel=function(){return this.model},l.prototype.getRootGroup=function(){return this.rootGroup},l.getMaxListDepth=function(){return l.maxListDepth},l.prototype.createGroup=function(){return i.SpecifiedGroup.Create(this.model)},l.prototype.addSpecifiedGroup=function(e,t,n){return l.addSpecifiedGroup(e,t,n)},l.addSpecifiedGroup=function(e,t,n){var o;return StoryLog.TraceTag(596473498,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.verbose,"Adding specified group at index "+n,null),TDB.applyUpdate(function(){if(o=i.SpecifiedGroup.Create(e.storyModel),l.setTitleForGroup(o,t||""),!(e instanceof i.SpecifiedGroup))throw StoryApp.RethrowLogger.createError("You can only add groups to other groups");e.children.add(o,n)}),StoryLog.TraceTag(596473499,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Specified group with id "+o.id+" added at index "+n,null),o},l.prototype.createSet=function(){return i.Set.Create(this.model)},l.prototype.moveChildrenToParent=function(e){if(e&&e.content){if(e.id==this.rootGroup.id)throw StoryApp.RethrowLogger.createError("Cannot reparent children of the root group");var t=this.getChildElementCollection(e);if(t){var n=this.findParent(e),o=-1;if(n instanceof i.Set&&n.content)o=this.getChildElementCollection(n).indexOf(e);else{var r=this.findContainingGroup(e);r&&r.children&&(o=this.getChildElementCollection(r).indexOf(e),n=r)}if(-1!=o)for(var a=0;a<t.length;a++)this.moveSpecifiedGroupChild(t[a],e,o+a,n)}}},l.prototype.findParent=function(e,t){if(e){t||(t=this.rootGroup);var n,o=t instanceof i.SpecifiedGroup?t:void 0;if(o){var r=o.getHeading(),a=r;if(r==e)return o;if(a instanceof i.TitleComposite){if(a.getTitle()==e)return o;var s=a.getBackground();if(s){if(s==e)return o;if(y=this.findParent(e,s))return y}var c=a.getSubtitle();if(c){if(c==e)return a;if(y=this.findParent(e,c))return y}var d=a.getAuthor();if(d){if(d==e)return a;if(y=this.findParent(e,d))return y}var u=a.getLogo();if(u){if(u==e)return o;if(y=this.findParent(e,u))return y}}}var p=t instanceof i.MediaWithTextComposite?t:void 0;if(p){if(p.getMedia()==e)return p;var g=p.getText();if(g==e)return p;if(g&&(y=this.findParent(e,g)))return y;if(p.getDescription()===e)return p;for(var h=p.closedCaptions.getCollection(),C=h.length,f=0;f<C;f++){var m=h[f];if(m===e)return p;var y=this.findParent(e,m);if(y)return y}}var v=t instanceof i.ClosedCaptionComposite?t:void 0;if(v&&v.getContent()===e)return v;var S=l.getPrimaryCollection(t);if((n=S?S.getCollection():[]).indexOf(e)>-1)return t;for(var T=n.length,f=0;f<T;f++){var w=n[f],A=this.findParent(e,w);if(A)return A}return null}},l.prototype.isPartOfHeading=function(e,t){if(t||(t=this.findParent(e)),!(t instanceof i.SpecifiedGroup))return!1;var n=t.getHeading();if(n==e)return!0;if(n instanceof i.TitleComposite){var o=n;if(o.getBackground()==e)return!0;if(o.getTitle()==e)return!0;if(o.getSubtitle()==e)return!0;if(o.getAuthor()==e)return!0;if(o.getLogo()==e)return!0}return!1},l.containsNullOrEmptyText=function(e){var t=l.getTextFromTextGroup(e);return!t||0===t.length},l.prototype.findContainingCollection=function(e,t){return t||(t=this.findParent(e)),l.getPrimaryCollection(t)},l.prototype.findContainingGroup=function(e){for(var t=e;!(t instanceof i.SpecifiedGroup)&&t;)t=this.findParent(t);return t},l.prototype.findContainingAtomParent=function(e,t){void 0===t&&(t=!1);for(var n=e;!(n instanceof i.SpecifiedGroup||n instanceof i.Set)&&n;)n=this.findParent(n);if(t&&this.rootGroup==n){var o=this.getChildElementCollection(this.rootGroup)[0];if(o&&!o.getHeading())return o;var r=this.createGroup();return this.addSpecifiedGroupChild(r,this.rootGroup,0),r}return n},l.prototype.getPreviousStorylinePosition=function(e){if(e&&e.parent&&l.getPrimaryCollection(e.parent)){if(e.index<1){var t=this.findParent(e.parent),n=t?l.getPrimaryCollection(t):void 0;return n?{parent:t,index:n.getCollection().indexOf(e.parent)}:void 0}if(e.index>l.getPrimaryCollection(e.parent).getCollection().length)return{parent:e.parent,index:l.getPrimaryCollection(e.parent).getCollection().length};var o=l.getPrimaryCollection(e.parent).getCollection()[e.index-1];return o instanceof i.SpecifiedGroup||o instanceof i.Set?{parent:o,index:l.getPrimaryCollection(o).getCollection().length}:{parent:e.parent,index:e.index-1}}},l.prototype.findPreviousAtomInsertionPosition=function(e){e=this.getPreviousStorylinePosition(e);for(var t=300;t>0&&e&&e.parent;t--){if(0===e.index)return e;if(!(l.getPrimaryCollection(e.parent).getCollection()[e.index-1]instanceof i.SpecifiedGroup))return e;e=this.getPreviousStorylinePosition(e)}},l.prototype.findOrCreateGroupInsertionPoint=function(e,t,n){var o,r,a=this;if(l.isModelObjectValid(e))if(n)o={parent:e,index:0};else if(e instanceof i.SpecifiedGroup&&t)o={parent:e,index:this.getChildElementCollection(e).length};else if(e!==this.rootGroup||t){r=this.findParent(e);var s=this.findContainingCollection(e,r),c=s?s.getCollection().indexOf(e)+1:0;o={parent:r,index:c}}else o={parent:this.rootGroup,index:this.getChildElementCollection(this.rootGroup).length};else TDB.applyUpdate(function(){r=a.createGroup(),o={parent:r,index:0},a.rootGroup.children.add(r,0)});return o},l.getPrimaryCollection=function(e){return e instanceof i.SpecifiedGroup?e.children:e instanceof i.Set?e.content:e instanceof i.TextGroup?e.children:e instanceof i.Paragraph?e.children:void 0},l.prototype.getChildsDepth=function(e){for(var t=this.rootGroup,n=0,o=e;o&&o!=t;)o=this.findParent(o),n++;return n},l.prototype.getDescendantMaxDepth=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=100);var o=0;if(n<0)return 0;if(e instanceof i.TitleComposite)return this.getDescendantMaxDepth(this.findContainingGroup(e),t,n-1);var r=l.getPrimaryCollection(e);if(r)for(var a=0;a<r.getCollection().length;a++){var s=r.getCollection()[a];(s instanceof i.SpecifiedGroup||s instanceof i.Set&&t)&&(o=Math.max(o,this.getDescendantMaxDepth(s,t,n-1)+1))}return o},l.prototype.removeSpecifiedGroupChild=function(e,t,n,o){var r=this;if(void 0===n&&(n=!1),void 0===o&&(o=!1),t||(t=this.findParent(e)),!t)return o&&StoryLog.TraceTag(596473500,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.error,"StoryController : removeSpecifiedGroupChild : parent of child to be removed was not found"),!1;var a=!1,s="Unknown error while removing child";return TDB.applyUpdate(function(){if(t instanceof i.SpecifiedGroup){var o=t;if(r.getChildElementCollection(o).indexOf(e)>-1)o.children.remove(e),a=!0;else{var l=o.getHeading();l==e?(o.setHeading(null),a=!0):l instanceof i.TitleComposite?(a=r.removeTitleCompositeChild(e,l))||(s="Title child was neither title background, title text, subtitle, author, or logo."):s="Title was not child or TitleComposite"}n||r.removeGroupIfEmpty(o)}else if(t instanceof i.TextGroup){var c=t,d=r.getChildElementCollection(c),u=e;d.indexOf(u)>-1?(c.children.remove(u),a=!0):s="textChild was not found under parent of type TextGroup"}else if(t instanceof i.Set)t.content.remove(e),a=!0;else if(t instanceof i.Paragraph)t.children.remove(e),a=!0;else if(t instanceof i.MediaWithTextComposite){var p=t;p.getMedia()==e?(p.setMedia(null),a=!0):p.getText()==e?(p.setText(null),a=!0):s="child of MediaWithTextComposite was not the image or text"}else t instanceof i.TitleComposite?(a=r.removeTitleCompositeChild(e,t))||(s="Title child was neither title background, title text, subtitle, author, or logo."):s="parent was of unknown type"}),!a&&o&&StoryLog.TraceTag(596473501,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.error,"StoryController : removeSpecifiedGroupChild : "+s),a},l.prototype.removeSpecifiedGroupChildRange=function(e,t,n){void 0==t&&(t=0);var o=l.getPrimaryCollection(e);void 0==n&&(n=o.getCollection().length-t);var r;return TDB.applyUpdate(function(){r=l.spliceObjectCollection(o,t,n)}),e instanceof i.SpecifiedGroup&&this.removeGroupIfEmpty(e),r},l.prototype.pruneEmptyGroups=function(e){e||(e=this.rootGroup);for(var t=this.getChildElementCollection(e),n=t.length,o=0;o<n;o++){var r=t[o];r instanceof i.SpecifiedGroup&&(this.pruneEmptyGroups(r),this.removeGroupIfEmpty(r,e))}},l.prototype.pruneHeaderlessGroup=function(e){e||(e=this.rootGroup);for(var t=this.getChildElementCollection(e),n=t.length-1;n>=0&&t[n]instanceof i.SpecifiedGroup;n--)this.pruneHeaderlessGroup(t[n]);if(!e.getHeading())if(1===this.getChildsDepth(e))this.pruneHeaderlessSectionAt(this.rootGroup,this.getChildElementCollection(this.rootGroup).indexOf(e));else{var o=this.findParent(e);this.pruneHeaderlessSubsectionAt(o,this.getChildElementCollection(o).indexOf(e))}},l.prototype.pruneHeaderlessSectionAt=function(e,t){for(var n=this,o=this.getChildElementCollection(e)[t],r=this.getChildElementCollection(o),a=[],s=[],c=0;c<r.length;c++)r[c]instanceof i.SpecifiedGroup?a.push(r[c]):s.push(r[c]);if(this.getChildElementCollection(e)[t-1]instanceof i.SpecifiedGroup){var d=this.getChildElementCollection(e)[t-1],u=l.getHeaderlessGroup(this.pageId);if(d===u){s.forEach(function(e){n.moveSpecifiedGroupChild(e,o,n.getChildElementCollection(d).length,d)});for(c=a.length-1;c>=0;c--)this.moveSpecifiedGroupChild(a[c],o,1,e)}else{var p=this.getLastGroup(d);s.forEach(function(e){p?n.moveSpecifiedGroupChild(e,o,n.getChildElementCollection(p).length,p):n.moveSpecifiedGroupChild(e,o,n.getChildElementCollection(d).length,d)}),a.forEach(function(e){n.moveSpecifiedGroupChild(e,o,n.getChildElementCollection(d).length,d)})}}else for(c=a.length-1;c>=0;c--)this.moveSpecifiedGroupChild(a[c],o,1,this.rootGroup,!0)},l.prototype.pruneHeaderlessSubsectionAt=function(e,t){for(var n=this.getChildElementCollection(e),o=n[t],r=this.getChildElementCollection(o),a=n[t-1]instanceof i.SpecifiedGroup,s=0;s<r.length;s++)if(a){var l=n[t-1];this.moveSpecifiedGroupChild(r[s],o,this.getChildElementCollection(l).length,l,!1)}else this.moveSpecifiedGroupChild(r[s],o,s,e)},l.prototype.removeGroupIfEmpty=function(e,t){e!=this.rootGroup&&l.isEmptyGroup(e)&&this.removeSpecifiedGroupChild(e,t)},l.isEmptyGroup=function(e){return 0==e.children.getCollection().length&&!e.getHeading()},l.prototype.removeTitleCompositeChild=function(e,t){var n=t;return n.getBackground()===e?(n.setBackground(null),!0):n.getTitle()===e?(n.setTitle(this.createParagraph()),!0):n.getSubtitle()===e?(n.setSubtitle(this.createParagraph()),!0):n.getAuthor()===e?(n.setAuthor(this.createParagraph()),!0):n.getLogo()===e&&(n.setLogo(void 0),!0)},l.prototype.addSpecifiedGroupChild=function(e,t,n){var o=this;e&&l.isModelObjectValid(e)&&TDB.applyUpdate(function(){if(!t||!l.isModelObjectValid(t)){var r=o.rootGroup,a=o.getChildElementCollection(r);if(0==a.length)t=l.addSpecifiedGroup(r);else{if(!(a[a.length-1]instanceof i.SpecifiedGroup))throw StoryApp.RethrowLogger.createError("Specified units can only be added to specified groups");t=a[a.length-1]}}t instanceof i.SpecifiedGroup?t.children.add(e,n):t instanceof i.TextGroup?t.children.add(e,n):t instanceof i.Set?t.content.add(e,n):t instanceof i.Paragraph&&e instanceof i.Paragraph&&t.children.add(e,n)})},l.prototype.addSet=function(e,t,n){this.addSpecifiedGroupChild(e,t,n)},l.prototype.addTextGroup=function(e,t,n){this.addSpecifiedGroupChild(e,t,n)},l.addSpecifiedGroupChildRange=function(e,t,n){var o=l.getPrimaryCollection(t);void 0==n&&(n=o.getCollection().length),TDB.applyUpdate(function(){l.spliceObjectCollection(o,n,0,e)})},l.addExistingSpecifiedGroupChildren=function(e,t,n){TDB.applyUpdate(function(){l.spliceObjectCollection(n,t,0,e)})},l.spliceObjectCollection=function(e,t,n,o){void 0===o&&(o=[]);var i=[];return TDB.applyUpdate(function(){var r=e.getCollection(),a=r.length;t<0&&(t=0),t+n>a&&(n=a),i=r.splice.apply(r,[t,n].concat(o)),e.set(r)}),i},l.prototype.moveSpecifiedGroup=function(e,t,n,o){l.moveSpecifiedGroup(e,t,n,o)},l.moveSpecifiedGroup=function(e,t,n,o){var i=t.children.getCollection().indexOf(e);t===o&&i===n||TDB.applyUpdate(function(){var e=l.spliceObjectCollection(t.children,i,1);l.spliceObjectCollection(o.children,n,0,e)})},l.prototype.moveSpecifiedGroupChild=function(e,t,n,o,i){var r=this,a=l.getGroupChildren(t).getCollection().indexOf(e);t==o&&a==n||TDB.applyUpdate(function(){r.removeSpecifiedGroupChild(e,t,i),r.addSpecifiedGroupChild(e,o,n)})},l.prototype.createMediaWithTextComposite=function(){return i.MediaWithTextComposite.Create(this.model)},l.prototype.createEmbed=function(){return i.EmbeddedContent.Create(this.model)},l.prototype.createTextGroup=function(e){void 0===e&&(e=!0);var t=i.TextGroup.Create(this.model);return e&&t.children.add(this.createParagraph()),t.setDirection(i.TextDirection.None),t},l.prototype.createParagraph=function(){var e=i.Paragraph.Create(this.model);return e.setContent(new i.TextBlock),this.model.traversalModel.getRTL()&&e.setDirection(i.TextDirection.RightToLeft),e},l.prototype.createNewImageContent=function(e){return void 0===e&&(e={}),t.currentImageController().get(this.pageId).createFromContent({contentArgs:e})},l.prototype.createNewVideoContent=function(e){return void 0===e&&(e={}),t.currentVideoController().get(this.pageId).createFromContent({contentArgs:e})},l.prototype.createNewAudioContent=function(e){return void 0===e&&(e={}),t.currentAudioController().get(this.pageId).createFromContent({contentArgs:e})},l.prototype.createNewStatusUpdateContent=function(e){return void 0===e&&(e={}),t.currentStatusUpdateController().get(this.pageId).createFromContent({contentArgs:e})},l.prototype.createNewEmbeddedContent=function(e){void 0===e&&(e={});return t.currentEmbedController().get(this.pageId).createFromContent({contentArgs:e})},l.prototype.createNewAgaveContent=function(e){void 0===e&&(e={});return t.currentAgaveController().get(this.pageId).createFromContent({contentArgs:e})},l.prototype.createNewClosedCaptionComposite=function(e){return t.currentClosedCaptionController().get(this.pageId).createFromContent({contentArgs:e})},l.prototype.createClosedCaptionComposite=function(){return i.ClosedCaptionComposite.Create(this.model)},l.prototype.clearCaption=function(e){var t=this.createParagraph();e.getText().children.set([t])},l.findCaption=function(e){if(!l.isModelObjectValid(e))return null;var t=e.getText();return t&&t.children?l.getTextFromTextGroup(t):null},l.getTextFromTextGroup=function(e){for(var t="",n=e.children.getCollection(),o=0;o<n.length;o++)n[o]instanceof i.Paragraph?t+=l.getTextFromParagraph(n[o]):n[o]instanceof i.TextGroup&&(t+=l.getTextFromTextGroup(n[o]));return t},l.getTextFromParagraph=function(e){var t="";null!=e.getContent()&&(t+=e.getContent().getText());for(var n=e.children.getCollection(),o=0;o<n.length;o++)t+=l.getTextFromParagraph(n[o]);return t},l.getFilesFromDataTransfer=function(e){if(!e||!e.files)return[];for(var t=e.files,n=Array(t.length),o=0;o<t.length;o++)n[o]=t[o];return n},l.prototype.setTitleForGroup=function(e,t){l.setTitleForGroup(e,t)},l.setTitleForGroup=function(e,t){var n=e.getHeading(),o=new i.TextBlock;o.setText(t),TDB.applyUpdate(function(){if(n)n.getTitle().setContent(o);else{var t=i.TitleComposite.Create(e.storyModel);e.setHeading(t);var r=i.Paragraph.Create(e.storyModel);t.setTitle(r),r.setContent(o)}})},l.prototype.setStoryTitleBackground=function(e){this.setTitleBackground(this.rootGroup,e)},l.prototype.setTitleBackground=function(e,t){var n=this,o=e.getHeading();o&&TDB.applyUpdate(function(){n.removeSpecifiedGroupChild(t),o.setBackground(t)})},l.prototype.createEmptyTitle=function(){var e=this.model,t=new i.TextBlock,n=i.TitleComposite.Create(e),o=i.Paragraph.Create(e);return n.setTitle(o),o.setContent(t),e.traversalModel.getRTL()&&o.setDirection(i.TextDirection.RightToLeft),n},l.prototype.createTextGroupFromCaptionString=function(e){var t=this.model,n=i.TextGroup.Create(t);if(e&&e.length>0)for(var o=0;o<e.length;o++)n.children.add(this.createParagraphFromCaptionParagraph(e[o]));else n.children.add(this.createParagraph());return n},l.prototype.createCodeBlock=function(){return i.CodeBlock.Create(this.model)},l.prototype.createParagraphsWithText=function(e){var t=this.model,n=i.Paragraph.Create(t),o=new i.TextBlock;return o.setText(e||""),n.setContent(o),n},l.prototype.createParagraphFromCaptionParagraph=function(e){var t=this.model,n=new i.TextBlock,o=i.Paragraph.Create(t);if(n.setText(e?e.text:""),o.setContent(n),e&&e.textRuns)for(var r=0;r<e.textRuns.length;r++){var a=e.textRuns[r];if(a){var s=new i.TextRun;n.runs.add(s),s.setIndex(a.index),s.setLength(a.length),s.setEmphasis(a.level),s.setUrl(a.hyperlink),s.setIsItalics(a.isItalics),s.setIsQuotation(a.isQuotation)}}return o},l.prototype.getTitleForGroup=function(e,t){return l.getTitleForGroup(e)},l.getTitleForGroup=function(e,t){var n=e.getHeading(t);return n?n.getTitle(t).getContent(t).getText(t):""},l.calculateVideoPlayerDescriptor=function(t,n){if(!t)return null;var o=null,i=e.Model.ContentStorageModel.getModelObject(t.id);i||e.Model.ContentStorageModel.contentRoot.contentNodes.getCollection(n);var a=i?i.getMetadata(n):null;if(a&&a instanceof r.VideoContentMetadata&&(o=a.getVideoPlayerDescriptorOverride(n)),!o){var s=t.getDecompInfo(n);if(s){var l=t.getVideoPlayerDescriptor(n),c=StoryEditPageMain.MediaPlayerDescriptorHandlerFactory.createVideoHandler(s.getProvider(n));!l||c.isDescriptorFake(l)||c.isCopyDescriptor(l)||(o=t.getVideoPlayerDescriptor(n))}}return o},l.calculateAudioPlayerDescriptor=function(t,n){if(!t)return null;var o=null,i=e.Model.ContentStorageModel.getModelObject(t.id);i||e.Model.ContentStorageModel.contentRoot.contentNodes.getCollection(n);var a=i?i.getMetadata(n):null;if(a&&a instanceof r.AudioContentMetadata&&(o=a.getAudioPlayerDescriptorOverride(n)),!o){var s=t.getDecompInfo(n);if(s){var l=t.getAudioPlayerDescriptor(n),c=StoryEditPageMain.MediaPlayerDescriptorHandlerFactory.createAudioHandler(s.getProvider(n));!l||c.isDescriptorFake(l)||c.isCopyDescriptor(l)||(o=t.getAudioPlayerDescriptor(n))}}return o},l.calculateImageClipPart=function(e,t,n){void 0===n&&(n=[i.ImageCategory.Thumbnail,i.ImageCategory.Image]);var o=[],r=e.imageParts.getCollection(t);return n.forEach(function(e){var n=r.firstOrDefault(function(n){return n.getType(t)===e});n&&(o[e]=n)}),0===o.length?null:Array.prototype.firstOrDefault.call(o,function(e){return void 0!==e})},l.calculateCsmImageClipPart=function(t,n,o){if(void 0===o&&(o=[i.ImageCategory.Thumbnail,i.ImageCategory.Image]),null!==t&&null!==t.imageParts&&0!==t.imageParts.getCollection().length){var r=t.imageParts.getCollection()[0].id,a=0,s=e.Model.ContentStorageModel.getModelObject(r);return s&&(a=s.getWidth()),a>0?s:(e.Model.ContentStorageModel.contentRoot.imageContentParts.getCollection(n),null)}},l.getGroupChildren=function(e){var t=null;return e instanceof i.SpecifiedGroup?t=e.children:e instanceof i.Set&&(t=e.content),t},l.groupChildHasImageContent=function(e){return e instanceof i.MediaWithTextComposite&&e.getMedia()instanceof i.ImageContent},l.prototype.getModelObject=function(e){return this.model.getModelObject(e)},l.prototype.getMediasByType=function(e,t,n){var r=this;if(!StoryApp.Utilities.arrayContainsAtLeastOneNonNullValue(e))return null;null==t&&(t=this.rootGroup);for(var a=0;a<e.length;a++){var s=e[a];if(t instanceof i.MediaWithTextComposite){var c=t.getMedia(n);if(s==o.Image&&c instanceof i.ImageContent)return[c];if(s==o.Video&&c instanceof i.VideoContent)return[c];if(s==o.Audio&&c instanceof i.AudioContent)return[c]}if(t instanceof i.StatusUpdateContent&&s==o.StatusUpdate)return[t];if(t instanceof i.EmbeddedContent&&s==o.Embed)return[t]}var d=[];if(t instanceof i.SpecifiedGroup){var u=t.getHeading(n);if(u){var p=u.getBackground(n);p&&(d=d.concat(this.getMediasByType(e,p)));var g=u.getLogo(n);g&&(d=d.concat(this.getMediasByType(e,g)))}}var h=l.getPrimaryCollection(t);if(null==h)return null;var C=h.getCollection(n);return null==C?null:(C.forEach(function(t){var o=r.getMediasByType(e,t,n);null!=o&&(d=d.concat(o))}),d)},l.prototype.getLoggableContentTypes=function(e,n){if(null==e)return null;for(var o=[],i=e.length,r=0;r<i;r++){var a=t.ObjectController.getCardDefinitionForModelObject(e[r],this.pageId),s=null!=a?a.id:l.UnknownContentType;o.push(s)}return o},l.prototype.getLoggableModelPath=function(e){if(!e)return"";for(var n="",o=e,r=this.findParent(o),a=10;o&&a>0;){var s=t.ObjectController.getCardDefinitionForModelObject(o,this.pageId),l=s?s.id:o instanceof i.SpecifiedGroup?t.ManualCardType.SectionId:"<Unknown>",c=-1;o===this.rootGroup?n="Root ("+o.id+")\\\\"+n:(r instanceof i.Set&&(c=this.getChildElementCollection(r).indexOf(o)),r instanceof i.SpecifiedGroup&&(c=this.getChildElementCollection(r).indexOf(o)),n="["+c.toString()+"] "+l+" ("+o.id+")"+(""===n?"":"\\\\"+n)),o=r,r=this.findParent(o),a--}return n},l.getUploadStatus=function(t,n){if(!t)return s.Completed;var o=t.getUploadInfo(n),i=e.Model.ContentStorageModel.getModelObject(t.id);if(!i)return o?(e.Model.ContentStorageModel.contentRoot.contentNodes.getCollection(n),s.Uploading):s.Completed;switch(i.getContentState(n)){case r.ContentState.Uploading:if(!o)return s.Completed;var a=(new Date).getTime()-new Date(o.getStartAttempt()).getTime();return l.uploadTimeOut-a<=0?s.Error:s.Uploading;case r.ContentState.UploadFailed:return s.Error;case r.ContentState.Transferring:return s.Transferring;case r.ContentState.TransferFailed:return s.Error;case r.ContentState.WaitingPreProcessing:return s.WaitingPreprocessing;case r.ContentState.PreProcessing:return s.Preprocessing;case r.ContentState.PreProcessingFailed:return s.PreprocessingError;default:return s.Completed}},l.isModelObjectValid=function(e){return!!e&&e.storyModel.graph.containsObject(e.id)},l.modelObjectsAreValid=function(e){if(!StoryApp.Utilities.arrayContainsAtLeastOneNonNullValue(e))return!1;for(var t=e.length,n=0;n<t;n++)if(!l.isModelObjectValid(e[n]))return!1;return!0},l.isStoryEmpty=function(t){var n=e.Model&&e.Model.StoryModel;if(n){var o=n.traversalModel.getSpecifiedGrouping().getRootGroup();return(!t||""===l.getTitleForGroup(o))&&0===o.children.getCollection().length}return!0},l.getNavigableModelId=function(e,t){if(e&&this.isModelObjectValid(e)){if(!(e instanceof i.Set))return e.id;var n=e;if(n.getVisualization(t)!==i.Visualization.Auto)return n.id;for(var o=n.content.getCollection(t),r=0;r<o.length;r++){var a=this.getNavigableModelId(o[r],t);if(a)return a}}},l.getHeaderlessGroup=function(e){var o=n().get(e).getRootGroup().children.getCollection();if(0!==o.length&&t.GroupController.isHeaderlessGroup(o[0]))return o[0]instanceof i.SpecifiedGroup?o[0]:void TDB.raiseRecoverableError("Root Group contains non group model")},l.prototype.getLastGroup=function(e,t){for(var n=this.getChildElementCollection(e),o=(t||n.length)-1;o>=0;o--)if(n[o]instanceof i.SpecifiedGroup)return n[o]},l.prototype.getChildElementCollection=function(t){return t instanceof e.Model.SM.Set?t.content.getCollection():t.children.getCollection()},l.uploadTimeOut=36e4,l.UnknownContentType="Unknown",l.maxListDepth=3,l}(CompartmentComponent);t.StoryController=c}(t.AuthoringModel||(t.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=function(){function i(){}return i.moveElementsToLocation=function(e,n,o,r,a){var s=i.convertViewElementsToCards(e,r,!0);t.AddAction.execute(s,{parent:n,index:o},r,a);var l=[];return s.forEach(function(e){return l.push(e.model)}),l},i.convertViewElementsToModels=function(e){for(var n=[],o=0;o<e.length;o++){var i=e[o];if(i instanceof t.CardVE)n.push(i.getViewModel().getModel());else if(i instanceof t.ContentPieceVE){var r=i.createCard().model;r&&n.push(r)}else i instanceof t.CardOptionVE&&n.push(i.card.create())}return n},i.convertViewElementsToBlueprints=function(e,n,i){for(var r=[],a=e.length,s=0;s<a;s++){var l=e[s];l instanceof t.ContentPieceVE&&r.push(l.getBlueprint()),l instanceof t.CardVE&&r.push(o.ObjectController.getBlueprint(l.getViewModel().getModel(),n,i)),l instanceof t.CardOptionVE&&r.push(l.card.placeholderBlueprint),l instanceof t.CardDeckVE&&r.push(new o.Blueprint({controller:o.currentImageController().get(n),modelProperties:{localFile:!0}}))}return r},i.convertViewElementsToCards=function(e,n,i){for(var r=[],a=0;a<e.length;a++){var s=e[a],l=void 0,c=void 0;if(s instanceof t.ContentPieceVE)i?r.push(s.createCard()):r.push(new o.Card({definition:s.getDefinition()}));else if(s instanceof t.CardVE){var d=s.getViewModel(),u=d.getModel(),p=d.getCardDefinition();r.push(new o.Card({definition:p,model:u}))}else s instanceof t.CardOptionVE?(c=s.card,l=i?c.create():void 0,r.push(new o.Card({model:l,definition:c}))):s instanceof t.CardDeckVE&&(c=new o.CardDefinitionManager(n).getCardDefinition(o.ManualCardType.ImageId),r.push(new o.Card({definition:c})))}return r},i.convertModelsToCards=function(e,t){var n=[];return e.forEach(function(e){n.push(new o.Card({definition:o.ObjectController.getCardDefinitionForModelObject(e,t),model:e}))}),n},i.getNumberOfStoryElements=function(t){var n=e.Model&&e.Model.StoryModel;if(n){var o=n.traversalModel.getSpecifiedGrouping().getRootGroup();return i.getNumberOfGroupElements(o,t)}return 0},i.getNumberOfGroupElements=function(e,t){var o=0;if(!e)return o;var r=[];if(e instanceof n.SpecifiedGroup){var a=e;r=a.children.getCollection(t);var s=a.getHeading(t);s&&(o++,s.getBackground(t)&&o++)}else e instanceof n.Set&&(r=e.content.getCollection(t));for(var l=r.length,c=0;c<l;c++){var d=r[c];d instanceof n.SpecifiedGroup?o+=i.getNumberOfGroupElements(d,t):d instanceof n.Set?o+=i.getNumberOfGroupElements(d,t):o+=1}return o},i}();t.AuthoringHelperMethods=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(e,t){if(this.start=void 0!==e?e:0,this.end=void 0!==t?t:this.start,this.start>this.end){var n=this.start;this.start=this.end,this.end=n}}return e.prototype.overlapsWith=function(e){return this.start<=e.start&&this.end>=e.start||(this.start<=e.end&&this.end>=e.end||(e.start<=this.start&&e.end>=this.start||e.start<=this.end&&e.end>=this.end))},e.prototype.mergeWith=function(e){return!!this.overlapsWith(e)&&(this.start=this.start<e.start?this.start:e.start,this.end=this.end>e.end?this.end:e.end,!0)},e}();e.AbsoluteRange=t}(e.Common||(e.Common={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=StoryApp.Model.RM,r=StoryApp.View.ViewElements,a=StoryApp.View.ViewElements.AuthoringState,s=function(e){function t(t,n){var o=e.call(this,n)||this;return o._currSelected=null,o._prevSelected=null,o._touchMoved=!1,o._skipNextClick=!1,o._mightBeInClick=!1,o._touchingContextMenu=!1,o._onlyContextMenu=!1,o._viewModel=t.viewModel,o._contextMenu=t.contextMenu,o._shortTextEditor=t.shortTextEditor,o._selectionUX=t.selectionUX,o._loggingSupport=t.loggingSupport,o.pageId=o._viewModel.getPageId(),o._elementSelected=TDB.watchable(o,!1),o.elementSelection=o._elementSelected,o._viewModel.addClientSignalListener(o),t.viewMode===StoryViewMode.Edit&&o._viewModel.registerEventHandler(o),StoryApp.Utilities.onResize(function(){return o.deselectElements(!0)}),r.DomEventRegister.getInstance().setTouchForAuthoringState(a.OOUI,!0),o._contextMenu.setup(o,o._shortTextEditor),o}return __extends(t,e),t.prototype.viewModeChanged=function(e){e===StoryViewMode.Edit?this._viewModel.registerEventHandler(this):this._viewModel.unregisterEventHandler(this)},t.prototype.getSelectedElementId=function(){return null!=this._currSelected?this._currSelected.element.getModelId():""},t.prototype.handleMouseClick=function(e,t){var n=e.srcElement||e.target;if(1==e.which){if(t instanceof r.TextSectionVE&&!getSelection().isCollapsed)return!1;if(t instanceof r.LayoutVE&&t._model.getIsOverlay())return this.fireEventOnBelowElement(n,e);var o=this.layoutElementSelected(e.pageX,e.pageY,n,t);return o&&t instanceof r.LayoutVE&&t._model.getIsClickThrough()?this.fireEventOnBelowElement(n,e):o}return!1},t.prototype.fireEventOnBelowElement=function(e,t){var n=e.style.visibility;e.style.visibility="hidden";var o=document.elementFromPoint(t.pageX,t.pageY);return o&&this.fireMouseEvent(t,o),e.style.visibility=n,!1},t.prototype.fireMouseEvent=function(e,t){var n=document.createEvent("MouseEvents");return n.initMouseEvent(e.type,e.bubbles,e.cancelable,e.view,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,null),r.DomEventRegister.getInstance().updateMouseclickTarget(t),t.dispatchEvent(n)&&!n.defaultPrevented},t.prototype.layoutElementSelected=function(e,t,n,o){if(this._skipNextClick)return this._skipNextClick=!1,!1;if(this._mightBeInClick&&(this._mightBeInClick=!1),!StoryPageEditSettings.SiteContextMenuEnabled||!this._viewModel.isEditMode.getValue())return!0;if(this._touchMoved)return!1;if(this.isSameElement(o,this._prevSelected))return!1;if(!this.isValidClickTarget(o))return!0;var i=!0;return null!=this.getGroupChild(o)&&(this.selectElement(e,t,n,o),i=!1),i},t.prototype.isValidClickTarget=function(e){if(null==e)return!1;try{var t=this.getGroupChild(e);if(null==t)return!1;if(t instanceof n.Paragraph&&""===t.getContent().getText())return!1;if(e.getContentType()==i.ContentType.StatusUpdate)return!1;var r=o.currentStoryController().get(this.pageId),a=r.findParent(t);if(a instanceof n.TextGroup&&(a=r.findParent(a)),a instanceof n.Set&&a.getVisualization()==n.Visualization.Stack)return!1}catch(e){return!1}return!this.isSameElement(e,this._currSelected)},t.prototype.selectElement=function(e,t,a,s){var l=this,c=s.getContentType(),d=this.getGroupChild(s),u=d,p=c===i.ContentType.Caption,g=c===i.ContentType.Text;if(p||g)for(var h=o.currentStoryController().get(this.pageId),C=h.findParent(d);C instanceof n.TextGroup;)d=C,C=h.findParent(C);(c===i.ContentType.Title||g)&&d instanceof n.TitleComposite&&(d=d.getTitle());var f={element:s,groupChild:d,contentType:c,originalGroupChild:u};this._contextMenu.show(e,t,f)&&(ActionLogger.RecordClientAction(new ClientAction.ContextualUIData(ClientAction.ActionType.Edit_Canvas_SelectAction,"User selected an item","","",i.ContentType[c])),this._currSelected=f,TDB.applyUpdate(function(){return l._elementSelected.setValue(!0)}),this._selectionUX.setupSelectionUX(a,s),r.DomEventRegister.getInstance().setAuthoringState(StoryApp.View.ViewElements.AuthoringState.OOUI))},t.prototype.deselectElements=function(e){var t=this,n=!1;this._currSelected&&ActionLogger.RecordClientAction(new ClientAction.ContextualUIData(ClientAction.ActionType.Edit_Canvas_DeselectAction,"User deselected an item","","",i.ContentType[this._currSelected.contentType])),this._contextMenu&&this._contextMenu.isVisible()&&(void 0!==e?this._onlyContextMenu=e:(e=this._onlyContextMenu,this._onlyContextMenu=!1),this._contextMenu.exit(),n=!e),this._shortTextEditor&&this._shortTextEditor.isVisible.getValue()&&!this._shortTextEditor.isOpening()&&(e||(this._shortTextEditor.dismiss(),n=!0)),n&&r.DomEventRegister.getInstance().setAuthoringState(StoryApp.View.ViewElements.AuthoringState.Canvas),this._mightBeInClick||TDB.applyUpdate(function(){return t._elementSelected.setValue(!1)},TDB.Justification.SynchronousBrowserEvent),this._mightBeInClick||(this._currSelected=null)},t.prototype.handleMouseDown=function(e,t){if(null!=e&&1!=e.which)return this._mightBeInClick=!1,void this.deselectElements();this._prevSelected=null,this._touchMoved=!1,this._skipNextClick=!1,this._mightBeInClick=!1,null!=this._shortTextEditor&&this._shortTextEditor.isVisible.getValue()&&(this._skipNextClick=!0),this._contextMenu.isVisible()&&this.isValidClickTarget(t)&&(this._mightBeInClick=!0,this._mouseDownElement=t),this.isContextMenuElement(t)||(this._prevSelected=this._currSelected,this.deselectElements())},t.prototype.handleMouseUp=function(e,t){this._mightBeInClick&&t!=this._mouseDownElement&&(this._mightBeInClick=!1,this._mouseDownElement=null,this.deselectElements())},t.prototype.handleMouseScroll=function(e){this.isContextMenuElement(e)||(this._skipNextClick=!1,this._mightBeInClick=!1,this._selectionUX.setAnimateSelection(!1),this.deselectAndSetFocus())},t.prototype.handleGlobalMouseEvent=function(e,t,n){switch(n){case TDB.ViewElementMouseEventType.MouseDownEvent:this.handleMouseDown(e,t);break;case TDB.ViewElementMouseEventType.MouseUpEvent:this.handleMouseUp(e,t);break;case TDB.ViewElementMouseEventType.MouseScroll:this.handleMouseScroll(t)}},t.prototype.handleGlobalKeyEvent=function(e,t){},t.prototype.touchStart=function(e){var t=TDB.ViewElement.dataFor(e.originalEvent.target);return this._touchingContextMenu=this.isContextMenuElement(t),!0},t.prototype.touchMove=function(e){return e.originalEvent.preventDefault(),this._touchingContextMenu||(this._skipNextClick=!1,this._mightBeInClick=!1,this._touchMoved=!0,this._selectionUX.setAnimateSelection(!1),this.deselectElements()),!0},t.prototype.touchStop=function(e){return this._touchingContextMenu=!1,!0},t.prototype.hideSelectionUX=function(){this._contextMenu.exit(),this._selectionUX.removeSelectionUX()},t.prototype.getGroupChild=function(e){var t=e.getLayoutContext();if(null!=t){var n=t.getContentProxy();return o.currentStoryController().get(this.pageId).getModel().getModelObject(n.id)}return null},t.prototype.isSameElement=function(e,t){if(null==e||null==t)return!1;var n=this.getGroupChild(e),o=e==t.element,i=null!=n&&n==t.groupChild&&e.getContentType()==t.contentType;return o||i},t.prototype.findAncestor=function(e,t){var n=!1;if(null==e||null==t)return!1;for(var o=e;null!=o;){if(o.parent==t){n=!0;break}o=o.parent}return n},t.prototype.deselectAndSetFocus=function(){var e=null;null!=this._currSelected&&(e=this._currSelected.element),this.deselectElements(),null!=e&&e.onFocusedElementRemoval(e)},t.prototype.isContextMenuElement=function(e){if(null==e)return!1;var t=e===this._contextMenu.getViewElement()||this.findAncestor(e,this._contextMenu.getViewElement()),n=e===this._shortTextEditor.getViewElement()||this.findAncestor(e,this._shortTextEditor.getViewElement());return t||n},t.prototype.dispose=function(){this._viewModel.removeClientSignalListener(this),this._viewModel.unregisterEventHandler(this),e.prototype.dispose.call(this)},t}(Disposable);t.SelectionManager=s}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.Model.RM,n=StoryApp.View.ViewElements,o=function(){function e(e,t){this._animateSelection=TDB.watchable(this,!0),this.animateSelection=this._animateSelection,this._surfaceSelectionId=e,this._rootId=t,this._surfaceSelection=null}return e.prototype.setAnimateSelection=function(e){var t=this;TDB.applyUpdate(function(){t._animateSelection.setValue(e)},TDB.Justification.InitialConversion)},e.prototype.removeSelectionUX=function(){if(this._surfaceSelection)for(;this._surfaceSelection.hasChildNodes();)this._surfaceSelection.removeChild(this._surfaceSelection.lastChild)},e.prototype.setupSelectionUX=function(e,o){var i=this;this._surfaceSelection||(this._surfaceSelection=document.getElementById(this._surfaceSelectionId)),this.removeSelectionUX();var r=o.getLayoutContext();if(null!=r){var a=r.parentLayoutNodes.getCollection().map(function(e){return e.id}),s=r.textParagraphs.getCollection();a=a.concat(s.map(function(e){return e.id}));var l=n.SelectableElement.getLayoutMapping(),c=a.map(function(e){return l[e]}).filter(function(e){return!!e}),d=void 0,u=o.getContentType()===t.ContentType.Caption,p=o.getContentType()===t.ContentType.Text;if(u||p){for(var g=c[0].parent;!(g instanceof n.TextBlockLayoutVE);)g=g.parent;var h=g.findFirstNode();d=h.children.length?[h.children[0]]:[h]}else d=c.map(function(e){return e.findFirstNode()}).filter(function(e){return!!e});for(var C="",f="",m=0;m<d.length;m++){var y=d[m];C=y.offsetTop+"px",f="OL"===y.parentElement.tagName||"UL"===y.parentElement.tagName?y.offsetLeft-parseFloat($(y.parentElement).css("margin-left"))+"px":y.offsetLeft+"px",this.setUpSelectionNodes(y,o.getContentType(),C,f)}}else this.setUpSelectionNodes(e,t.ContentType.None,"","");TDB.applyUpdate(function(){i._animateSelection.setValue(!0)})},e.prototype.setUpSelectionNodes=function(e,n,o,r){var a=e.cloneNode(!0);if(n==t.ContentType.Video)for(var s=a.getElementsByTagName("iframe"),l=0;l<s.length;l++){var c=s[l];c.src=c.src.replace(/&autoplay=1/i,"&autoplay=0")}if(n==t.ContentType.Text||n==t.ContentType.Title||n==t.ContentType.Caption){var d=document.createElement("div");d.appendChild(a),a=d}if(n==t.ContentType.Text&&(a.style.position="relative",a.style.top=o,a.style.left=r),n==t.ContentType.Text||n==t.ContentType.Title||n==t.ContentType.Caption){var u=$(a),p=this.calculateTextBackground(e);null!=p&&u.css("backgroundColor",p)}for(var g=new i(a),h=e.parentNode;!h.attributes.getNamedItem("id")||h.attributes.getNamedItem("id").value!=this._rootId;){var C=this.findMatchingElementInSurfaceSelection(h);if(C)return g.parent(C),void g.attached();var f=h.cloneNode(!1),m=h.scrollTop,y=h.scrollLeft;if(f=this.cleanUpParentNode(f),g.parent(f,m,y),!(h=h.parentNode))return $(a).remove(),void $(g).remove()}g.parent(this._surfaceSelection),g.attached()},e.prototype.findMatchingElementInSurfaceSelection=function(e){var t=this._surfaceSelection.getElementsByTagName(e.tagName),n=e.attributes.getNamedItem("id");if(null==n)return null;for(var o=0;o<t.length;o++)if(t[o].attributes.getNamedItem("id")&&t[o].attributes.getNamedItem("id").value==n.value)return t[o];return null},e.prototype.calculateTextBackground=function(e){var t=this.findTextColor(e);if(null==t)return null;var n=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),o=t.match(/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d+|\d+.\d+)\)$/);null==n&&(n=o);var i=parseInt(n[1]),r=parseInt(n[2]);return i+parseInt(n[3])+r>382.5?"rgb(0, 0, 0)":"rgb(255, 255, 255)"},e.prototype.findTextColor=function(e){var t=$(e);if("rgba(0, 0, 0, 0)"!=t.css("backgroundColor")&&"transparent"!=t.css("backgroundColor"))return null;if(!e.hasChildNodes)return t.css("color");for(var n=!1,o=0;o<e.childNodes.length;o++){if(1!=e.childNodes[o].nodeType)return t.css("color");var i=this.findTextColor(e.childNodes[o]);if(null!=i){if("rgb(0, 0, 0)"!=i)return i}else n=!0}return n?null:"rgb(0, 0, 0)"},e.prototype.cleanUpParentNode=function(e){var t=$(e);return t.css("backgroundColor","transparent"),t.css("backgroundImage","none"),t.css("fill","none"),t.css("stroke","none"),t[0]},e}();e.SelectionUX=o;var i=function(){function e(e){this.root=e,this.scrolled=[]}return e.prototype.getRoot=function(){return this.root},e.prototype.parent=function(e,t,n){e.appendChild(this.root),this.root=e,(t||n)&&this.scrolled.push({node:e,top:t,left:n})},e.prototype.attached=function(){this.applyscroll()},e.prototype.applyscroll=function(){this.scrolled.forEach(function(e){e.left&&(e.node.scrollLeft=e.left),e.top&&(e.node.scrollTop=e.top)}),this.scrolled.length=0},e}()}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.Model.SM,i=StoryApp.Server.Styles,r=StoryEditPageMain.StyleHelper,a=function(t){function a(e){var n=t.call(this,e)||this;return n.owner=e,n.selectedStyleOption=TDB.watchableTag(596473491,n,void 0),n.selectedColorPalette=TDB.watchableTag(596473492,n,void 0),n.sessionBackgroundSetId=r.getSelectedBackgroundSet(),n}return __extends(a,t),a.getPreviewWorlds=function(e){return a.getWorldOptions(e,!0)},a.getWorldOptions=function(t,n){var o=e.Model&&e.Model.StoryModel,i=[],r=StoryApp.WorldList.GetWorlds(t);if(0===r.length)return[];r.forEach(function(e){e.userSelectable&&(n?e.isPreview:!e.isPreview)&&i.push(e)});var a=o.traversalModel;if(n){var s=a.getWorldId(t);i.concat(r).every(function(e){return e.id!==s})&&i.push({id:s,name:s,description:s,supportsVisualizer:!1,randomWeight:0,userSelectable:!0,isEnabled:!0,isPreview:!0})}return i},a.prototype.getSelectedWorld=function(e){return r.getSelectedWorld(e)},a.prototype.swapWorld=function(t){var o=(e.Model&&e.Model.StoryModel).traversalModel;StoryLog.TraceTag(596473493,Diag.ULSCat.msoulscat_Story_Preview,Diag.ULSTraceLevel.info,"World selected: "+t+". Previous world: "+o.getWorldId(),null);var i=this.getSelectedStyle(),r=i;e.Model.currentUndoManager().get(this.owner.getPageId()).captureUserUpdate(function(){n.ViewModel.blockingUpdate.setValue(!0);var e=new ClientAction.WorldChangeData(o.getWorldId(),t,i,r,!1);ActionLogger.BeginSyncAction(e),o.setWorldId(t),ActionLogger.RecordClientAction(e)},"User changed the Sway world")},a.prototype.getStyleOptions=function(t){var n=e.Model.StoryModel.traversalModel.getCulture(t),o=i.currentStyleGalleryManager().get(this.owner.getPageId()).getStyleGalleryOptions(n,t),r={};for(var a in o){var s=o[a];r[a]=[];for(var l=0;l<s.length;l++){var c=new i.StyleOption(s[l].styleId);c.copyFrom(s[l]),r[a].push(c)}}return r},a.prototype.getSelectedStyle=function(e){return r.getSelectedStyle(e)},a.prototype.changeStyles=function(t){var i=(e.Model&&e.Model.StoryModel).traversalModel,r=i.getStyleId();this.selectedStyleOption.setValue(t),this.selectedColorPalette.setValue(void 0),this.sessionBackgroundSetId=t.backgroundSetId,n.ViewModel.blockingUpdate.setValue(!0);var a=new ClientAction.StyleChangeData(i.getWorldId(),r,t.styleId);ActionLogger.BeginSyncAction(a),i.setStyleId(t.styleId),this.setColorPalette(t.colorPalette),this.overrideSeedColors(t.seedColorOverrides),i.setColorOptionId(t.colorOptionId);var s=i.getStyleOverrides();s.setFontSetId(t.fontSetId),s.setBackgroundSetId(t.backgroundSetId),s.setAnimationAmount(o.AnimationLevel[t.animationLevel]),s.setFontScale(void 0),s.setFilterSetId(t.filterSetId),ActionLogger.RecordClientAction(a)},a.prototype.setColorOverride=function(t){var n=this;if(null!=t){var o=e.Model&&e.Model.StoryModel,r=new ClientAction.ColorChangeData(t.toString());TDB.applyUpdate(function(){ActionLogger.BeginSyncAction(r),n.selectedStyleOption.setValue(void 0),n.selectedColorPalette.setValue(t),o.traversalModel.setStyleId(t.dynamicStyleId);var e=[],a=t.colorPalette;for(var s in a)e.push(new i.NamedColor(s,a[s]));n.setColorPalette(e),o.traversalModel.setColorOptionId(t.colorOptionId);var l=[],c=t.seedColors;for(var s in c)l.push(new i.NamedColor(s,c[s]));n.overrideSeedColors(l);var d=o.traversalModel.getStyleOverrides();null!=t.backgroundSetId&&""!==t.backgroundSetId?d.setBackgroundSetId(t.backgroundSetId):d.setBackgroundSetId(n.sessionBackgroundSetId),ActionLogger.RecordClientAction(r)})}},a.prototype.overrideSeedColors=function(t){var n=(e.Model&&e.Model.StoryModel).traversalModel.getStyleOverrides().getSeedColorOverrides(),i=[];if(t)for(var r=0;r<t.length;r++){var a=new o.SeedColorOverride;a.setId(t[r].id),a.setValue(t[r].value),i.push(a)}n.getColors().setCollection(i)},a.prototype.setColorPalette=function(t){var n=(e.Model&&e.Model.StoryModel).traversalModel.getColorPalette(),i=[];if(t)for(var r=0;r<t.length;r++){var a=new o.LayoutColor;a.setId(t[r].id),a.setValue(t[r].value),i.push(a)}n.setCollection(i)},a.prototype.selectRandomWorldAndStyle=function(){var t=this,n=StoryApp.Common.Branding.canRemixWorld();StoryLog.TraceTag(596473494,Diag.ULSCat.msoulscat_Story_Style,Diag.ULSTraceLevel.verbose,"Remixing the Sway's World and Style",null);var o=this.selectRandomStyle(),i=n?this.selectRandomWorld():this.getSelectedWorld();o&&i&&e.Model.currentUndoManager().get(this.owner.getPageId()).captureUserUpdate(function(){n&&t.swapWorld(i),t.changeStyles(o)},"User selected a random World and Style"),StoryLog.TraceTag(596473495,Diag.ULSCat.msoulscat_Story_Style,Diag.ULSTraceLevel.info,"Finished remixing the Sway's World and Style",null)},a.prototype.selectRandomWorld=function(){var e=StoryApp.WorldList.GetWorlds().sort(function(e,t){return e.randomWeight-t.randomWeight}),t=null;if(e.length>0){var n=e.map(function(e){return e.randomWeight});t=e[this.selectRandomElementWeighted(n)].id}else StoryLog.TraceTag(596473496,Diag.ULSCat.msoulscat_Story_Style,Diag.ULSTraceLevel.warning,"User didn't receive the random world because world list is empty.",null);return t},a.prototype.selectRandomStyle=function(){var t=e.Model.StoryModel.traversalModel.getCulture(),n=i.currentStyleGalleryManager().get(this.owner.getPageId()).getStyleGalleryOptions(t),o=[];for(var r in n)o=o.concat(n[r]);var a=null;if(o.length>0){var s=o.map(function(e){return e.weight}),l=o[this.selectRandomElementWeighted(s)];(a=new i.StyleOption(l.styleId)).copyFrom(l)}else StoryLog.TraceTag(596473497,Diag.ULSCat.msoulscat_Story_Style,Diag.ULSTraceLevel.warning,"User didn't receive the random style because style option list is empty.",null);return a},a.prototype.selectRandomElementWeighted=function(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];for(var o=Math.max(Math.random()*t,.001),n=0;n<e.length;n++){if(o<e[n])return n;o-=e[n]}return Math.floor(Math.random()*e.length)},a.prototype.getFontSetOptions=function(e){return r.getFontSetOptions(e)},a.prototype.waitingForFontSets=function(e){return i.waitingForFontSets(e)},a.prototype.errorGettingFontSets=function(e){return i.errorGettingFontSets(e)},a.prototype.setFontSet=function(t){var o=(e.Model&&e.Model.StoryModel).traversalModel;this.selectedStyleOption.setValue(void 0),n.ViewModel.blockingUpdate.setValue(!0);var i=new ClientAction.FontSetChangeData(t,this.getSelectedFontSet(),this.getSelectedWorld(),this.getSelectedStyle());ActionLogger.BeginSyncAction(i);var r=o.getStyleOverrides();r&&r.setFontSetId(t),ActionLogger.RecordClientAction(i)},a.prototype.setAnimationLevel=function(e,t){var n=function(t){return t.setAnimationAmount(e)};this.setStyleOverrideValue(n,"Sets the override animation level.",t)},a.prototype.setFontScale=function(e,t){var n=function(t){return t.setFontScale(e)};this.setStyleOverrideValue(n,"Sets the font scale.",t)},a.prototype.setStyleOverrideValue=function(t,n,o){var i=this,r=(e.Model&&e.Model.StoryModel).traversalModel;TDB.applyUpdate(function(){i.selectedStyleOption.setValue(void 0)});var a=r.getStyleOverrides();if(a){var s=function(){return t(a)};o?e.Model.currentUndoManager().get(this.owner.getPageId()).captureUserUpdate(s,n):e.Model.currentUndoManager().get(this.owner.getPageId()).captureIgnorableUpdate(s,a.id)}},a.prototype.getStylePreviewImageAttributes=function(t,n){var o=e.Model.StoryModel.traversalModel.getCulture(n),r=i.currentStylePreviewManager().get(this.owner.getPageId()).getImageUri(t,o,n);return r?{src:r}:{}},a.prototype.getSelectedStyleOption=function(e){return r.getSelectedStyleOption(e)},a.prototype.getSelectedBackgroundSet=function(e){return r.getSelectedBackgroundSet(e)},a.prototype.getSelectedColorOption=function(e){return r.getSelectedColorOption(e)},a.prototype.getSelectedSeedColorOverrides=function(e){return r.getSelectedSeedColorOverrides(e)},a.prototype.getSelectedColorPalette=function(e){return r.getSelectedColorPalette(e)},a.prototype.getSelectedFontSet=function(e){return r.getSelectedFontSet(e)},a.prototype.getSelectedFontSetOption=function(e){var t=r.getSelectedFontSet(e),n=this.getFontSetOptions(e);if(n)return n.firstOrDefault(function(e){return!t||e.id==t})},a.prototype.getSelectedAnimationAmount=function(e){return r.getSelectedAnimationAmount(e)},a.prototype.getSelectedFontScale=function(e){return r.getSelectedFontScale(e)},a}(Disposable);t.StyleManager=a}(t.Common||(t.Common={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function t(t,n){this.range=void 0!==t?t:new e.AbsoluteRange(0,0),this.type=n}return t}();e.TextRunRange=t}(e.Common||(e.Common={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){e[e.Emphasized=0]="Emphasized",e[e.Normal=1]="Normal",e[e.Mixed=2]="Mixed"}(e.TextRunType||(e.TextRunType={}))}(e.Common||(e.Common={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n,o=StoryApp.View.ViewElements,i=e.Server.Decomposition,r=i.WP;!function(e){e[e.Initial=0]="Initial",e[e.ReportingInProgress=1]="ReportingInProgress",e[e.SuccessfullyReported=2]="SuccessfullyReported",e[e.FailedToReport=3]="FailedToReport"}(n=t.ReportDialogState||(t.ReportDialogState={}));var a;!function(e){e[e.CheckBoxForReportReasonOne=1]="CheckBoxForReportReasonOne",e[e.CheckBoxForReportReasonTwo=2]="CheckBoxForReportReasonTwo",e[e.CheckBoxForReportReasonThree=3]="CheckBoxForReportReasonThree",e[e.SubmitButton=4]="SubmitButton",e[e.CloseButton=5]="CloseButton",e[e.CancelButton=6]="CancelButton"}(a=t.ReportContentDialogTabIndexes||(t.ReportContentDialogTabIndexes={}));var s=[{text:Resources.InappropriateContentDialogOption1,tabIndex:a.CheckBoxForReportReasonOne,wireProtocolValue:r.ReportReason.NotRelevant},{text:Resources.InappropriateContentDialogOption2,tabIndex:a.CheckBoxForReportReasonTwo,wireProtocolValue:r.ReportReason.Offensive},{text:Resources.InappropriateContentDialogOption3,tabIndex:a.CheckBoxForReportReasonThree,wireProtocolValue:r.ReportReason.Adult}],l=function(){function e(e,t){var r=this;this.state=TDB.watchableTag(596473350,this,StoryApp.Common.Environment.getInstance().isClientOnline()?n.Initial:n.FailedToReport),this.reportInfo=e,this.decompService=t||new i.DecompositionAPI,this.checkboxes=s.map(function(e){return{text:e.text,tabIndex:e.tabIndex,wireProtocolValue:e.wireProtocolValue,checked:TDB.watchableTag(596460378,r,!1)}});var a={title:Resources.InappropriateContentDialogTitle,messages:[],frostOpacity:.65,dialogWrapperCssClass:{value:"ReportDialog"},dialogType:o.DialogType.Question,lightDismiss:!1,disableDismissOnClickOutside:!0,buttonsArgs:this.generateDialogButtonArgs(),dialogLogMessage:"Report an image",logEscapeDismiss:!0,dialogLogDictionary:function(){return r.createLogDictionary()},ariaLive:Aria.AriaLiveValue.Polite,description:Resources.InappropriateContentDialogTitle,contentArgs:this.createDialogContent(e)};this.dialog=StoryApp.View.Common.DialogManager.createDialog(a)}return e.prototype.showDialog=function(){StoryApp.View.Common.DialogManager.showDialog(this.dialog)},e.createAndShow=function(t,n){var o=new e(t,n);return o.showDialog(),o},e.prototype.updateState=function(e){var t=this;this.dialog.visible.getValue()&&TDB.applyUpdate(function(){t.state.setValue(e),t.dialog.updateButtons(t.generateDialogButtonArgs())})},e.prototype.onReportSubmit=function(){var e=this;this.updateState(n.ReportingInProgress);var t=this.getReportReasons(),o=function(t){t&&r.DecompositionStatus[t.Status]===r.DecompositionStatus.Success?e.updateState(n.SuccessfullyReported):e.updateState(n.FailedToReport)},i=function(){e.updateState(n.FailedToReport)};this.decompService.decomposeReport(t,this.reportInfo.descriptor).then(o,i)},e.prototype.generateDialogButtonArgs=function(){var e=this;return this.state.getValue()===n.Initial?[{buttonId:ClientAction.ButtonId.ReportDialog_Submit,caption:{value:Resources.InappropriateContentDialogSubmitButton},isDefault:!0,id:"ReportDialog_Submit",tabIndex:a.SubmitButton,dismissOnAction:!1,buttonClickDictionaryFunc:function(){return e.createLogDictionary()},onAction:function(){e.onReportSubmit()},enabled:{compute:new TDB.ComputedOptionArgs(this,this.isAnythingChecked)}},{buttonId:ClientAction.ButtonId.ReportDialog_Cancel,caption:{value:Resources.InappropriateContentDialogCancelButton},isDefault:!1,tabIndex:a.CancelButton,id:"ReportDialog_Cancel",dismissOnAction:!0,buttonClickDictionaryFunc:function(){return e.createLogDictionary()},isNeutralButton:!0}]:[{buttonId:ClientAction.ButtonId.ReportDialog_Close,caption:{value:Resources.InappropriateContentDialogCloseButton},isDefault:!1,tabIndex:a.CloseButton,id:"ReportDialog_Close",dismissOnAction:!0,buttonClickDictionaryFunc:function(){return e.createLogDictionary()},isNeutralButton:!1}]},e.prototype.isAnythingChecked=function(e){return this.checkboxes.some(function(t){return t.checked.getWatchedValue(e)})},e.prototype.getReportReasons=function(e){return this.checkboxes.filter(function(t){return t.checked.getWatchedValue(e)}).map(function(e){return e.wireProtocolValue})},e.prototype.createDialogContent=function(e){return new TDB.ChildArgs(t.ReportContentPieceDialogContentVE,{state:this.state,imageUrl:e.imageUrl,checkboxes:this.checkboxes})},e.prototype.createLogDictionary=function(){return{DialogState:this.state.getValue().toString(),ProviderType:this.reportInfo.logContentProvider}},e}();t.ReportContentPieceDialog=l}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(n){function o(e,t){var i=n.call(this,e)||this;return i.args=t,o.preloadSpinnerImage(),i}return __extends(o,n),o.prototype.ifShowCheckboxesArgs=function(t){return this.args.state.getWatchedValue(t)===e.ReportDialogState.Initial},o.prototype.ifShowSpinnerArgs=function(t){return this.args.state.getWatchedValue(t)===e.ReportDialogState.ReportingInProgress},o.prototype.ifShowImageOverlayArgs=function(t){return this.args.state.getWatchedValue(t)!==e.ReportDialogState.Initial},o.prototype.ifShowSubmittedArgs=function(t){return this.args.state.getWatchedValue(t)===e.ReportDialogState.SuccessfullyReported},o.prototype.imageVisualizatorArgs=function(){var t={showImage:{value:!0},imageSource:{value:this.args.imageUrl},imageContentClass:"ReportDialogImageContent",fillContainer:!0};return new TDB.ChildArgs(e.ImageVisualizatorVE,t)},o.prototype.reportingInProgressSpinnerArgs=function(){return new TDB.ChildArgs(t.DialogLoadingSpinnerVE,{ariaValueText:Resources.InappropriateContentDialogSendingReportTooltip,spinnerImage:"LoadingWhiteSpinner60.gif",width:40,height:40,centerVertically:!0})},o.preloadSpinnerImage=function(){(new Image).src=CommonSettings.ContentBaseUrl+"LoadingWhiteSpinner60.gif"},o.prototype.wholeImageOverlayClassNameArgs=function(t){switch(this.args.state.getWatchedValue(t)){case e.ReportDialogState.SuccessfullyReported:return"GreenImageOverlayNoAnimation";case e.ReportDialogState.FailedToReport:return"FailedSubmitImageOverlay";case e.ReportDialogState.Initial:case e.ReportDialogState.ReportingInProgress:default:return""}},o.prototype.submittedOverlayIconArgs=function(){var e={buttonId:ClientAction.ButtonId.AddContent_AddedOverlay,clipClass:{value:Glyphs.AddContentCheckmarkWhiteClip},cssClass:{value:"GreenImageOverlayIcon segoeUISemilight"},description:{value:Resources.InappropriateContentDialogSubmittedOverlay},glyphClass:{value:Glyphs.AddContentCheckmarkWhiteGlyph},textClass:"ReportButtonGreenImageOverlayIconText",text:{value:Resources.InappropriateContentDialogSubmittedOverlay},domFocusable:{value:!1}};return new TDB.ChildArgs(t.GlyphButtonVE,e)},o.prototype.messageTextArgs=function(t){switch(this.args.state.getWatchedValue(t)){case e.ReportDialogState.Initial:return Resources.InappropriateContentDialogText;case e.ReportDialogState.ReportingInProgress:return Resources.InappropriateContentDialogSendingReport;case e.ReportDialogState.SuccessfullyReported:return Resources.InappropriateContentDialogSuccessResponse;case e.ReportDialogState.FailedToReport:return Resources.DocumentEmbeddingNotAvailable;default:return""}},o.prototype.reportReasonCheckboxesArgs=function(){var e=this;return this.args.checkboxes.map(function(n){return new TDB.ChildArgs(t.RichCheckboxVE,e.createReportDialogCheckboxVEArgs(n))})},o.prototype.createReportDialogCheckboxVEArgs=function(e){var n=new TDB.ChildArgs(t.SpanMessageVE,{message:e.text,messageCss:"ReportDialogCheckboxText"});return{buttonId:ClientAction.ButtonId.ReportDialog_Checkbox,context:this,tabIndex:e.tabIndex,richTextElementsUnchecked:[n],richTextElementsChecked:[n],role:Aria.Roles.Checkbox,fontIconName:{value:FontIcons.CheckboxFontIcon},fontIconSize:FontIcons.CheckboxFontIconSize,cssClass:{value:"ReportDialogCheckboxWrapper"},checkedIconWrapperClass:{value:"ReportDialogCheckboxChecked"},uncheckedIconWrapperClass:{value:"ReportDialogCheckboxUnchecked"},messagePartsWrapperClass:"ReportDialogCheckboxTextWrapper",checkedWatchable:e.checked}},o}(TDB.FocusableViewElement);e.ReportContentPieceDialogContentVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(e,t){this._view=e,this._selectedLayout=TDB.watcherTag(596473304,this,this._view,t.styleManager.getSelectedWorld),this._styleManager=t.styleManager,this._visibility=t.visibility}return e.prototype.isWaiting=function(e){return StoryApp.WorldList.getWaitingForWorldsResponse(e)},e.prototype.inErrorState=function(e){return StoryApp.WorldList.getErrorGettingWorlds(e)},e.prototype.getSelectedLayout=function(){return this._selectedLayout},e.prototype.getStyleManager=function(){return this._styleManager},e}();e.LayoutChooserViewModel=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=function(){function t(e){this.args=e}return t.prototype.changeLayout=function(e){return this.args.isEnabled&&(ActionLogger.RecordClientAction(new ClientAction.ButtonClickAction(ClientAction.ButtonId.StructurePane_StructureOption,Diag.ULSCat.msoulscat_Story_Preview)),ActionLogger.RecordClientAction(new ClientAction.ChangeLayoutAction(StoryEditPageMain.ModelHelper.getNumberOfStoryElements())),this.args.styleManager.swapWorld(e)),!1},t.prototype.getSelected=function(e){return this.args.selectedId.getWatchedValue(e)},t.prototype.getLayoutId=function(){return this.args.layoutId},t.prototype.isOptionChecked=function(e){return this.getSelected(e)===this.args.layoutId},t.prototype.getRTL=function(t){return e.Model.StoryModel.traversalModel.getRTL(t)},t}();t.LayoutOptionViewModel=n}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel,o=function(e){function t(t,o){var i=e.call(this,t,o)||this;return i.args=o,i.language=TDB.watchableOption(i,o.language),i.viewModel=new n.LanguageOptionViewModel(i,{language:i.language}),i}return __extends(t,e),t.prototype.onAction=function(t){return e.prototype.onAction.call(this,t),this.args.onAction.call(this.args.context,this.args.role,this.dropdownList.getListIndex(this.args),this.language.getValue()),TDB.EventPropagation.Bypass},t.prototype.languageTextArgs=function(e){return this.viewModel.getLanguageName(e)},t.prototype.getDescription=function(e){return this.viewModel.getLanguageName(e)},t.prototype.getViewModel=function(){return this.viewModel},t}(StoryApp.View.ViewElements.DropdownListItemVE);t.LanguageOptionVEBase=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(e,t){this.args=t}return e.prototype.getLanguage=function(e){return this.args.language.getWatchedValue(e)},e.prototype.getLanguageName=function(e){var t=this.getLanguage(e);return t?t.getName():""},e}();e.LanguageOptionViewModel=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=function(t){function n(e,n){var o=t.call(this,e)||this;return o.sharingManager=n.sharingManager,o}return __extends(n,t),n.prototype.allowDuplicationCheckboxArgs=function(){var e=Resources.SharingAllowDuplicationText,t=new TDB.ChildArgs(VE.SpanMessageVE,{message:e,messageCss:"SwaySettingsPaneCheckboxText"}),n={buttonId:ClientAction.ButtonId.ShareDropdown_MoreOptionsCheckbox_DuplicateStory,context:this,checked:!StoryPageSettings.AuthorBlockDuplication,click:this.allowDuplicationCheckboxClicked,cssClass:{value:"SwaySettingsPaneCheckboxWrapper"},enabled:StoryApp.Common.Environment.getInstance().getClientOnline(),richTextElementsUnchecked:[t],richTextElementsChecked:[t],descriptionChecked:e,descriptionUnchecked:e,role:Aria.Roles.Checkbox,fontIconName:{value:FontIcons.CheckboxFontIcon},fontIconSize:FontIcons.CheckboxFontIconSize,checkedIconWrapperClass:{value:"SwaySettingsPaneCheckboxChecked"},uncheckedIconWrapperClass:{value:"SwaySettingsPaneCheckboxUnchecked"}};return new TDB.ChildArgs(VE.RichCheckboxVE,n)},n.prototype.allowDuplicationCheckboxClicked=function(e){var t,n,o=this,i=!this.allowDuplicationCheckbox.getChecked();return this.allowExportCheckbox&&(t=this.allowExportCheckbox.getChecked(),TDB.applyUpdate(function(){o.allowExportCheckbox.setChecked(!i)})),this.allowPrintCheckbox&&(n=this.allowPrintCheckbox.getChecked(),TDB.applyUpdate(function(){o.allowPrintCheckbox.setChecked(!i)})),this.sharingManager.changeBlockDuplication(!this.allowDuplicationCheckbox.getChecked(),StoryPageSettings.LookupId,$.proxy(this.onCheckboxOperationSuccess,this),$.proxy(this.onCheckboxOperationError([i,t,n],[this.allowDuplicationCheckbox,this.allowExportCheckbox,this.allowPrintCheckbox]),this)),TDB.EventPropagation.Bypass},n.prototype.allowPrintCheckboxArgs=function(){var e=this;if(!CommonSettings.IsExportStoryEnabled)return null;var t=Resources.SharingAllowPrintText,n=new TDB.ChildArgs(VE.SpanMessageVE,{message:t,messageCss:"SwaySettingsPaneCheckboxText"}),o={buttonId:ClientAction.ButtonId.ShareDropdown_MoreOptionsCheckbox_PrintStory,context:this,checked:!StoryPageSettings.AuthorBlockPrint,click:this.allowPrintCheckboxClicked,cssClass:{value:"SwaySettingsPaneCheckboxWrapper"},enabled:{compute:new TDB.ComputedOptionArgs(this,function(t){return StoryApp.Common.Environment.getInstance().isClientOnline(t)&&!e.allowDuplicationCheckbox.getChecked(t)})},richTextElementsUnchecked:[n],richTextElementsChecked:[n],descriptionChecked:t,descriptionUnchecked:t,role:Aria.Roles.Checkbox,fontIconName:{value:FontIcons.CheckboxFontIcon},fontIconSize:FontIcons.CheckboxFontIconSize,checkedIconWrapperClass:{value:"SwaySettingsPaneCheckboxChecked"},uncheckedIconWrapperClass:{value:"SwaySettingsPaneCheckboxUnchecked"}};return new TDB.ChildArgs(VE.RichCheckboxVE,o)},n.prototype.allowPrintCheckboxClicked=function(e){var t=!this.allowPrintCheckbox.getChecked();return this.sharingManager.changeBlockPrint(!this.allowPrintCheckbox.getChecked(),StoryPageSettings.LookupId,$.proxy(this.onCheckboxOperationSuccess,this),$.proxy(this.onCheckboxOperationError([t],[this.allowPrintCheckbox]),this)),TDB.EventPropagation.Bypass},n.prototype.allowExportCheckboxArgs=function(){var e=this;if(!CommonSettings.IsExportStoryEnabled)return null;var t=Resources.SharingAllowExportText,n=new TDB.ChildArgs(VE.SpanMessageVE,{message:t,messageCss:"SwaySettingsPaneCheckboxText"}),o={buttonId:ClientAction.ButtonId.ShareDropdown_MoreOptionsCheckbox_ExportStory,context:this,checked:!StoryPageSettings.AuthorBlockExport,click:this.allowExportCheckboxClicked,cssClass:{value:"SwaySettingsPaneCheckboxWrapper"},enabled:{compute:new TDB.ComputedOptionArgs(this,function(t){return StoryApp.Common.Environment.getInstance().isClientOnline(t)&&!e.allowDuplicationCheckbox.getChecked(t)})},richTextElementsUnchecked:[n],richTextElementsChecked:[n],descriptionChecked:t,descriptionUnchecked:t,role:Aria.Roles.Checkbox,fontIconName:{value:FontIcons.CheckboxFontIcon},fontIconSize:FontIcons.CheckboxFontIconSize,checkedIconWrapperClass:{value:"SwaySettingsPaneCheckboxChecked"},uncheckedIconWrapperClass:{value:"SwaySettingsPaneCheckboxUnchecked"}};return new TDB.ChildArgs(VE.RichCheckboxVE,o)},n.prototype.allowExportCheckboxClicked=function(e){var t=!this.allowExportCheckbox.getChecked();return this.sharingManager.changeBlockExport(!this.allowExportCheckbox.getChecked(),StoryPageSettings.LookupId,$.proxy(this.onCheckboxOperationSuccess,this),$.proxy(this.onCheckboxOperationError([t],[this.allowExportCheckbox]),this)),TDB.EventPropagation.Bypass},n.prototype.allowConsumptionWorldSwitchCheckboxArgs=function(){if(!StoryPageSettings.ConsumptionWorldSwitchFeatureEnabled)return null;var e=Resources.SharingAllowConsumptionWorldSwitchText,t=new TDB.ChildArgs(VE.SpanMessageVE,{message:e,messageCss:"SwaySettingsPaneCheckboxText"}),n={buttonId:ClientAction.ButtonId.ShareDropdown_MoreOptionsCheckbox_ConsumptionWorldSwitch,context:this,checked:VE.ViewModel.consumptionWorldSwitchAllowed.getValue(),click:this.allowConsumptionWorldSwitchCheckboxClicked,cssClass:{value:"SwaySettingsPaneCheckboxWrapper"},enabled:StoryApp.Common.Environment.getInstance().getClientOnline(),richTextElementsUnchecked:[t],richTextElementsChecked:[t],descriptionChecked:e,descriptionUnchecked:e,role:Aria.Roles.Checkbox,fontIconName:{value:FontIcons.CheckboxFontIcon},fontIconSize:FontIcons.CheckboxFontIconSize,checkedIconWrapperClass:{value:"SwaySettingsPaneCheckboxChecked"},uncheckedIconWrapperClass:{value:"SwaySettingsPaneCheckboxUnchecked"}};return new TDB.ChildArgs(VE.RichCheckboxVE,n)},n.prototype.allowConsumptionWorldSwitchCheckboxClicked=function(e){var t=this,n=!this.allowConsumptionWorldSwitchCheckbox.getChecked();return this.sharingManager.changeBlockConsumptionWorldSwitch(!this.allowConsumptionWorldSwitchCheckbox.getChecked(),StoryPageSettings.LookupId,function(e,n,o){TDB.applyUpdate(function(){VE.ViewModel.consumptionWorldSwitchAllowed.setValue(t.allowConsumptionWorldSwitchCheckbox.getChecked())}),t.onCheckboxOperationSuccess(e,n,o)},$.proxy(this.onCheckboxOperationError([n],[this.allowConsumptionWorldSwitchCheckbox]),this)),TDB.EventPropagation.Bypass},n.prototype.hideEndOfSwayCheckboxArgs=function(t){if(!this.hideEndOfSwayAvailable(t))return null;var n=ResourceManager.ResolveString(Resources.SharingHideEndOfSwayCheckboxText,[Resources.EndOfStoryHeading]),o=new TDB.ChildArgs(VE.SpanMessageVE,{message:n,messageCss:"SwaySettingsPaneCheckboxText"}),i={buttonId:ClientAction.ButtonId.ShareDropdown_MoreOptionsCheckbox_HideEndOfSway,context:this,checked:!e.Model.StoryModel.traversalModel.getHideEndOfSway(),click:this.hideEndOfSwayCheckboxClicked,cssClass:{value:"SwaySettingsPaneCheckboxWrapper"},richTextElementsUnchecked:[o],richTextElementsChecked:[o],descriptionChecked:n,descriptionUnchecked:n,role:Aria.Roles.Checkbox,fontIconName:{value:FontIcons.CheckboxFontIcon},fontIconSize:FontIcons.CheckboxFontIconSize,checkedIconWrapperClass:{value:"SwaySettingsPaneCheckboxChecked"},uncheckedIconWrapperClass:{value:"SwaySettingsPaneCheckboxUnchecked"}};return new TDB.ChildArgs(VE.RichCheckboxVE,i)},n.prototype.hideEndOfSwayCheckboxClicked=function(t){var n=this.hideEndOfSwayCheckbox.getChecked();return e.Model.currentUndoManager().get(this.pageId).captureUserAction(function(){TDB.applyUpdate(function(){e.Model.StoryModel.traversalModel.setHideEndOfSway(!n)})},"User changed HideEndOfSway value"),ActionLogger.RecordClientAction(new ClientAction.HideEndOfSwayToggled(!n)),TDB.EventPropagation.Bypass},n.prototype.hideEndOfSwayAvailable=function(e){return StoryPageEditSettings.HideMadeWithSwayEnabled&&CommonSettings.IsPaidUser},n.prototype.onCheckboxOperationSuccess=function(e,t,n){StoryLog.TraceTag(596473293,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Toggled checkbox in view settings successfully")},n.prototype.onCheckboxOperationError=function(e,t){return function(n,o,i){StoryLog.TraceTag(596473294,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Failed to toggle check box in view settings : {0}",[o]);for(var r=0;r<t.length;r++)!function(n){TDB.applyUpdate(function(){t[n]&&t[n].setChecked(e[n])},TDB.Justification.InitialConversion)}(r)}},n.prototype.viewSettingsLabelTextArgs=function(e){return Resources.ViewSettingsLabel},n}(TDB.FocusableViewElement);t.ViewSettingsVEBase=n}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=StoryApp.View.Common.FRE,o=function(e){function o(t,n){var o=e.call(this,t)||this;return o._args=n,o}return __extends(o,e),o.prototype.castDoneButtonClick=function(e){n.FirstRunTriggers.publishClicked();var t=StoryApp.Common.UrlHelper.getInstance().getCastRedirectLink();if(t)this.navigateWhenSyncFinished(t,!0);else if(CommonSettings.CastUrl&&CommonSettings.Branding===StoryBrandingMode.DocsJournal)(o=StoryApp.Common.UrlHelper.getInstance().absoluteDocsJournalUrl())&&this.navigateWhenSyncFinished(o,!0);else if(CommonSettings.CastUrl&&CommonSettings.Branding===StoryBrandingMode.DocsAbout){var o=StoryApp.Common.UrlHelper.getInstance().absoluteDocsAboutUrl();o&&this.navigateWhenSyncFinished(o,!0)}return TDB.EventPropagation.Bypass},o.prototype.castDoneButtonArgs=function(){var e={buttonId:ClientAction.ButtonId.AppBar_Publish,click:this.castDoneButtonClick,context:this,cssClass:{value:"shareCastViewButton shareCastDoneButton"+StoryApp.Common.Branding.getAdditionalBrandCssClasses()},textClass:"shareCastViewButtonText",text:{value:Resources.CastEmbedDone}};return new TDB.ChildArgs(t.TextButtonVE,e)},o.prototype.calloutArgs=function(e){if(StoryApp.Common.Branding.getStringFirstRunPreviewHeaderHeader()){var o=n.CalloutID.PublishButton;if(!n.getCalloutManager().isActiveCallout(e,o))return;var i={calloutBoxClassName:"PublishButton-callout",headerText:{value:StoryApp.Common.Branding.getStringPublishButtonFRE()},readerText:StoryApp.Common.Branding.getStringPublishButtonFREReader(),beakPosition:t.BeakPosition.TopRight,calloutID:o,delay:n.getDelayForCallout(n.CalloutID.PublishButton,n.FirstRunType.Default)};return new TDB.ChildArgs(t.FRECalloutVE,i)}},o.prototype.navigateWhenSyncFinished=function(e,n){if(this._args.syncManager){var o=!1,i=function(){o=!0};n&&t.PublishFromAppBarDialog.createAndShow(i),this._args.syncManager.waitUntilInSyncAsync().done(function(){o||(window.location.href=e)})}else window.location.href=e},o}(TDB.FocusableViewElement);e.CastDoneHeaderVEBase=o}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.View.ViewModel,i=function(i){function r(e,t){var n=i.call(this,e,{features:TDB.ControlSetFeatures.Isolated|TDB.ControlSetFeatures.ExitOnEscape,visible:t.visible,description:t.description})||this;return n.sanitizedColor=TDB.watchableTag(596464522,n,""),n.newColorAdded=!1,n.tryAddColorOnExit=!0,n.viewModel=new o.CustomColorEntryViewModel(t.viewModelArgs),n.args=t,n.accessibilityMessage=TDB.watchableTag(596464352,n,""),n}return __extends(r,i),r.prototype.customColorEntryColorStyleArgs=function(e){return{backgroundColor:this.sanitizedColor.getWatchedValue(e)||"white"}},r.prototype.notValidColorArgs=function(e){return!this.sanitizedColor.getWatchedValue(e)},r.prototype.textBoxArgs=function(e){var t=this,o={description:this.args.description,cssClass:"CustomColorEntryTextBox",role:Aria.Roles.Textbox,tooltip:this.args.tooltip,context:this,onInput:function(e){return t.onInput(e)},handleKeyDown:function(e){return t.handleKeyDown(e)},textColorState:this.textBoxClassName,ariaInvalidState:this.checkAriaState};return new TDB.ChildArgs(n.TextBoxVE,o)},r.prototype.textBoxClassName=function(e){return this.getSanitizedCustomColor(e)||0===e.length?"CustomColorEntryTextBox":"CustomColorEntryTextBoxInvalid"},r.prototype.checkAriaState=function(e){return!this.getSanitizedCustomColor(e)},r.prototype.onInput=function(e){return this.updateSanitizedColor(),this.sanitizedColor.getValue()&&this.dismissCustomColorEntryCallout(),!0},r.prototype.dismissCustomColorEntryCallout=function(){FRE.getCalloutManager().getCurrentCalloutID()===FRE.CalloutID.CustomColorEntry&&FRE.FirstRunTriggers.validCustomColorEntered()},r.prototype.handleKeyDown=function(e){switch(e.keyCode){case KeyCodeType.EnterKey:this.sanitizedColor.getValue()&&this.hide();break;case KeyCodeType.EscapeKey:this.tryAddColorOnExit=!1,this.hide();break;case KeyCodeType.TabKey:this.hide()}return TDB.EventPropagation.Bypass},r.prototype.updateSanitizedColor=function(){var e=this;TDB.applyUpdate(function(){e.sanitizedColor.setValue(e.getSanitizedCustomColor(e.textBox.getText()))})},r.prototype.setValue=function(e){this.textBox.setText(e),this.sanitizedColor.setValue(this.getSanitizedCustomColor(e))},r.prototype.getSanitizedCustomColor=function(e){var t=Color.parse(e);return t?t.toHexString():null},r.prototype.setupCustomColorEntry=function(){this.textBox.setText(""),this.accessibilityText(""),this.updateSanitizedColor(),this.tryAddColorOnExit=!0,this.newColorAdded=!1},r.prototype.entryButtonAttrArgs=function(e){var t={};return t.role=Aria.Roles.Button,t[Aria.Attributes.Disabled]=this.sanitizedColor.getWatchedValue(e)?Aria.BooleanState.False:Aria.BooleanState.True,t[Aria.Attributes.Label]=this.sanitizedColor.getWatchedValue(e)?Resources.AddButton+this.textBox.getWatchedText(e):"",t},r.prototype.entryButtonEventsInitArgs=function(){return{click:this.onClick}},r.prototype.entryButtonPropsArgs=function(e){return{disabled:!this.sanitizedColor.getWatchedValue(e)}},r.prototype.onClick=function(e){return ActionLogger.RecordClientAction(new ClientAction.ButtonClickAction(ClientAction.ButtonId.ColorPane_AddNewCustomColor,Diag.ULSCat.msoulscat_Story_Preview)),this.hide(),!0},r.prototype.accessibilityMessageTextArgs=function(e){return this.accessibilityMessage.getWatchedValue(e)},r.prototype.accessibilityText=function(e){var t=this;TDB.applyUpdate(function(){t.accessibilityMessage.setValue(e)})},r.prototype.tryAddCustomColorToModel=function(n,o){var i=this;o&&(ActionLogger.RecordClientAction(new ClientAction.AddCustomColorData(n,o)),e.Model.currentUndoManager().get(this.pageId).captureIgnorableUpdate(function(){e.Model.StoryModel.traversalModel.getCustomColors().add(n,0),i.args.selectedId.setValue(t.ColorChooserVE.customColorOptionIdPrefix+"0")},null),this.accessibilityText(Resources.Added+" "+n),this.newColorAdded=!0)},r.prototype.onExiting=function(){this.tryAddColorOnExit&&this.tryAddCustomColorToModel(this.textBox.getText(),this.sanitizedColor.getValue()),this.dismissCustomColorEntryCallout(),i.prototype.onExiting.call(this)},r.prototype.onRestoreFocus=function(e){return!this.newColorAdded||(this.args.context.setColorOptionFocus(2),!1)},r}(n.PopupBaseVE);t.CustomColorEntryVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(e){}return e}();e.CustomColorEntryViewModel=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.View.ViewModel,i=function(t){function i(e,n){var i=this,r=new o.CustomColorOptionViewModel(n.viewModelArgs);return i=t.call(this,e,{calculateChecked:function(e){return r.getSelectedOptionId(e)===n.optionId},buttonId:ClientAction.ButtonId.DesignPane_ColorOption,listIndex:n.listIndex,description:{value:n.description},tooltip:{value:n.tooltip}})||this,i.viewModel=r,i.args=n,i}return __extends(i,t),i.prototype.wrapperAttrArgs=function(e){return this.getOptionAttrArgs(e)},i.prototype.keyDown=function(e){return e.keyCode?e.keyCode===KeyCodeType.DeleteKey?(this.delete(),TDB.EventPropagation.Bypass):t.prototype.keyDown.call(this,e):TDB.EventPropagation.Bypass},i.prototype.customColorStyleArgs=function(e){return{backgroundColor:Color.parse(this.args.text).toHexString()}},i.prototype.textBoxAttrArgs=function(e){return{value:this.args.text,disabled:"disabled"}},i.prototype.labelTextArgs=function(e){return this.args.text},i.prototype.ifIsSelectedArgs=function(e){return this.viewModel.getSelectedOptionId(e)===this.args.optionId},i.prototype.getOptionId=function(){return this.args.optionId},i.prototype.getLabelText=function(){return this.args.text},i.prototype.deleteButtonArgs=function(){var e={buttonId:ClientAction.ButtonId.ColorPane_DeleteCustomColorOption,click:this.deleteButtonClicked,context:this,cssClass:{value:"CustomColorDeleteButton"},description:{value:Resources.ContextMenuDeleteButton},tooltip:{value:Resources.ContextMenuDeleteButton},fontIconName:{value:FontIcons.CustomColorDeleteIcon},fontIconSizeClass:FontIcons.CustomColorDeleteIconSize};return new TDB.ChildArgs(n.GlyphButtonVE,e)},i.prototype.deleteButtonClicked=function(e){return this.delete(),TDB.EventPropagation.Bypass},i.prototype.delete=function(){var t=this;ActionLogger.RecordClientAction(new ClientAction.ButtonClickAction(ClientAction.ButtonId.ColorPane_DeleteCustomColorOption,Diag.ULSCat.msoulscat_Story_Preview));var n=-1;e.Model.currentUndoManager().get(this.pageId).captureIgnorableUpdate(function(){n=t.args.context.updateSelectedOptionOnOptionDelete(t.args.optionId),e.Model.StoryModel.traversalModel.getCustomColors().removeAt(t.args.modelIndex)},null),-1!==n&&this.args.context.setColorOptionFocus(n)},i.prototype.onAction=function(e){return e instanceof MouseEvent&&1!=e.which?TDB.EventPropagation.Bubble:(ActionLogger.RecordClientAction(new ClientAction.ButtonClickAction(ClientAction.ButtonId.ColorPane_CustomColorOption,Diag.ULSCat.msoulscat_Story_Style,{ListIndex:this.args.listIndex.toString(),ListLength:this.parentCarouselList.getListLength().toString(),OptionId:this.args.optionId})),this.args.onAction.call(this.args.context,this.args.optionId),TDB.EventPropagation.Bypass)},i}(n.CarouselListItemVE);t.CustomColorOptionVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(e){this._selectedId=e.selectedId}return e.prototype.getSelectedOptionId=function(e){return e.watchValue(this._selectedId)},e}();e.CustomColorOptionViewModel=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.View.ViewModel,i=function(e){function t(t,n){var i=this,r=new o.NewCustomColorOptionViewModel({selectedId:n.selectedId});return i=e.call(this,t,{calculateChecked:function(e){return!1},buttonId:ClientAction.ButtonId.DesignPane_ColorDefaultOption,listIndex:n.listIndex,description:{value:Resources.NewCustomColorLabel},tooltip:{value:Resources.NewCustomColorTooltip}})||this,i.viewModel=r,i.args=n,i}return __extends(t,e),t.prototype.wrapperAttrArgs=function(e){return this.getOptionAttrArgs(e)},t.prototype.labelTextArgs=function(e){return Resources.NewCustomColorLabel},t.prototype.onAction=function(e){return ActionLogger.RecordClientAction(new ClientAction.ButtonClickAction(ClientAction.ButtonId.ColorPane_NewCustomColorOption,Diag.ULSCat.msoulscat_Story_Preview)),this.args.onAction.call(this.args.context),TDB.EventPropagation.Bubble},t}(n.CarouselListItemVE);t.NewCustomColorOptionVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(e){this._selectedId=e.selectedId}return e.prototype.getSelectedColorOptionId=function(e){return e.watchValue(this._selectedId)},e}();e.NewCustomColorOptionViewModel=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(e,t){this._view=e,this._styleManager=t.styleManager,this._defaultValue=t.defaultValue,this._slidebarPosition=TDB.watcherTag(596473289,this,e,this.getFontScale)}return e.prototype.getStyleManager=function(){return this._styleManager},e.prototype.getFontScale=function(t){return e.getFontScale(this._styleManager,this._defaultValue,t)},e.prototype.setFontScale=function(e,t){void 0===t&&(t=!0),this._styleManager.setFontScale(e,t)},e.prototype.getSlidebarPositionWatchable=function(){return this._slidebarPosition},e.getFontScaleString=function(t,n){var o=e.getFontScale(t,e.SCALE_NORMAL,n),i=e.FONT_SCALE_POINTS.firstOrDefault(function(e){return e.value===o});return i?i.text:void 0},e.getFontScale=function(e,t,n){var o=e.getSelectedFontScale(n);return o&&o>0?o:t},e.SCALE_SMALLEST=.7,e.SCALE_SMALL=.9,e.SCALE_NORMAL=1,e.SCALE_LARGE=1.1,e.SCALE_LARGEST=1.3,e.FONT_SCALE_POINTS=[{text:Resources.FontScaleSmall,value:e.SCALE_SMALLEST},{text:Resources.FontScaleMediumSmall,value:e.SCALE_SMALL,hidden:!0},{text:Resources.FontScaleNormal,value:e.SCALE_NORMAL},{text:Resources.FontScaleMediumLarge,value:e.SCALE_LARGE,hidden:!0},{text:Resources.FontScaleLarge,value:e.SCALE_LARGEST}],e}();e.FontScaleChooserViewModel=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t;!function(e){e[e.None=0]="None",e[e.Content=1]="Content",e[e.Navigation=2]="Navigation",e[e.Design=3]="Design",e[e.EditImage=4]="EditImage",e[e.GroupType=5]="GroupType",e[e.AccessibilityChecker=6]="AccessibilityChecker",e[e.SwaySettings=7]="SwaySettings"}(t=e.AuthoringPaneType||(e.AuthoringPaneType={})),function(e){function t(t){return EnumParser.fromString(t,e)}e.fromString=t}(t=e.AuthoringPaneType||(e.AuthoringPaneType={}));var n=function(e){function n(t,n){var o=e.call(this,t,{features:TDB.ControlSetFeatures.None})||this;return o._visible=TDB.watchableTag(596473301,o,!!n.startVisible),o.visible=o._visible,o._content=n.content,o.paneType=n.paneType,o._css=n.css,o._visibleCss=n.visibleCss?n.visibleCss:"AddContentPaneVisible",o.visibleCssModeSwitch=n.visibleCssModeSwitch?n.visibleCssModeSwitch:"AddContentPaneVisibleModeSwitch",o._lightDismiss=!!n.lightDismiss&&n.lightDismiss,o._paneStateManager=n.paneStateManager,o.storyPageState=n.storyPageState,o.triggersSync=n.triggersSync,o.visibleWatcher=TDB.watcherTag(596473302,o,o,o.calculateVisible),o}return __extends(n,e),n.prototype.isVisible=function(e){return this._visible.getWatchedValue(e)},n.prototype.setContent=function(e){this._content=e},n.prototype.onChildActiveStateChanged=function(t,n){if(!n){var o=t.last();o!==this._content.getViewElement()||o.isActivated()||this.exit()}e.prototype.onChildActiveStateChanged.call(this,t,n)},n.prototype.paneContentArgs=function(){return this._content.getViewElement()},n.prototype.paneClassNameArgs=function(e){var t=this.calculateVisible(e),n="AuthoringPane AuthoringPaneModeSwitch "+this._css;return t&&(n+=" "+this._visibleCss+" "+this.visibleCssModeSwitch),void 0!=this._content.onVisibilityChangeEvent&&this._content.onVisibilityChangeEvent(t),n},n.prototype.paneEventsInitArgs=function(){return{transitionend:this.onTransitionEnd}},n.prototype.paneVisibleArgs=function(e){return this.storyPageState.isEditMode.getWatchedValue(e)},n.prototype.paneStyleArgs=function(e){var t=!!VE.NotificationBarViewModel.getNotificationBar(this).getNotification(e),n=UX.topBarHeight+UX.swayBarHeight+1;return t&&(n+=UX.notificationBarHeight),{top:StoryApp.Utilities.toPxStr(n)}},n.prototype.paneAttrArgs=function(e){var t={},n=this._content.getTitleElementId();return n?t[Aria.Attributes.Labelledby]=n:t[Aria.Attributes.Label]=this._content.getTitleText(),t[Aria.Attributes.Hidden]=this.calculateVisible(e)?Aria.BooleanState.False:Aria.BooleanState.True,t},n.prototype.setVisible=function(e){var t=this;if(this.visible!==this._visible)throw StoryApp.RethrowLogger.createError("Cannot set the visible class if it has been overridden.");this.visible.getValue()!==e&&this._content.logVisibilityEvent(e),TDB.applyUpdate(function(){t._visible.setValue(e)}),!e&&this._content&&this._content.getViewElement().exit()},n.prototype.calculateVisible=function(e){var t=this.visible.getWatchedValue(e),n=this.storyPageState.isEditMode.getWatchedValue(e);return t&&n},n.prototype.firstChanceMouseEvent=function(n,o,i){var r=this;return o===TDB.ViewElementMouseEventType.MouseDownEvent&&this._lightDismiss&&!this.isElementUnder(i)&&(ActionLogger.RecordClientAction(new ClientAction.AuthoringPaneLightDismissData(t[this.paneType])),this.hideAuthoringPaneTimeoutId=platform.setTimeout(function(){r.hideAuthoringPaneTimeoutId=void 0,r._paneStateManager.hideAuthoringPane(r.paneType,!0)},200)),e.prototype.firstChanceMouseEvent.call(this,n,o,i)},n.prototype.isCardDeckSupported=function(){return this._content.isCardDeckSupported()},n.prototype.onTransitionEnd=function(e){return this._content&&this._content.onTransitionEndEvent&&this._content.onTransitionEndEvent(e),!0},n.prototype.getActivatableChildren=function(){return this._content.getViewElement().canActivate()?[this._content.getViewElement()]:[]},n.prototype.getContent=function(){return this._content},n.prototype.getTriggersSync=function(){return this.triggersSync},n.prototype.paneFadeVisibleInitArgs=function(){return{disabled:!1}},n.prototype.paneFadeVisibleArgs=function(e){return{visible:this.isVisible(e),transitionIn:"opacity 0.3s ease",transitionOut:"none"}},n.prototype.dispose=function(){this.hideAuthoringPaneTimeoutId&&clearTimeout(this.hideAuthoringPaneTimeoutId),e.prototype.dispose.call(this)},n}(TDB.ControlSet);e.AuthoringPaneVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements;!function(e){e[e.ClosePaneButton=1]="ClosePaneButton"}(e.AuthoringPaneTabIndex||(e.AuthoringPaneTabIndex={}));var n=function(t){function n(e,n){var o=t.call(this,e,n.features|TDB.ControlSetFeatures.ExitOnEscape)||this;return o.parent=e,o.args=n,o}return __extends(n,t),n.prototype.getViewElement=function(){return this},n.prototype.getTitleElementId=function(){return this.parent?"SidePaneHeaderTitle"+e.AuthoringPaneType[this.parent.paneType]:void 0},n.prototype.isCardDeckSupported=function(){return!0},n.prototype.paneHeaderArgs=function(){var t={paneStateManager:this.args.paneStateManager,title:this.getTitleText(),titleId:this.getTitleElementId(),paneCloseButtonId:this.args.paneCloseButtonId,context:this,closeButtonClicked:this.closePaneButtonClicked,leftAlign:this.args.leftAlign};return new TDB.ChildArgs(e.PaneHeaderVE,t)},n.prototype.closePaneButtonClicked=function(e){return this.args.paneStateManager.hideAuthoringPane(this.parent.paneType,!0),TDB.EventPropagation.Bypass},n.prototype.getInitialActiveChild=function(){var e=this;return t.prototype.getActivatableChildren.call(this).firstOrDefault(function(t){return t!==e.paneHeader.closeButton})},n}(t.RegionViewElement);e.AuthoringPaneContent=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.Model.AuthoringModel,i=function(t){function i(e,n){var o=this,i={buttonId:n.card.buttonId,role:Aria.Roles.Button,enabled:{value:!n.cardDisabled},description:{value:n.card.title===Resources.CardsPanelSubHeaderMedia?Resources.PictureCardDescription:n.card.description},tooltip:{value:n.card.description}};return o=t.call(this,e,i)||this,o.card=n.card,o._cardsContainer=n.cardsContainer,o.disabled=n.cardDisabled,o}return __extends(i,t),i.prototype.wrapperDraggableInitArgs=function(){var e={};return e.disable=this.disabled,e.opacity=.6,e.scroll=!0,e.appendTo="#pane-holder",e.helper=function(){var e=$(this).clone();e.css({position:"relative",width:"150px",height:"56px",left:0,top:0});var t=$("<div></div>").append(e);return t.width($(this).width()),t.height($(this).height()),t},e},i.prototype.wrapperDraggableOptionsArgs=function(e){var t=this.wrapperDraggableInitArgs();return{cursorAt:t.cursorAt,helper:t.helper}},i.prototype.cardButtonAttrArgs=function(e){return this.getButtonAttributes(e)},i.prototype.cardButtonClassNameArgs=function(e){return this.isEnabled()?"CardOptionButton":"CardOptionButtonDisabled"},i.prototype.cardIconArgs=function(){var e={fontIconName:{value:this.card.fontIconName},fontIconSizeClass:FontIcons.CardOptionIconSize};return new TDB.ChildArgs(n.FontIconVE,e)},i.prototype.optionTextClassNameArgs=function(e){return"CardOptionText"},i.prototype.optionTextTextArgs=function(e){return this.card.title},i.prototype.onAction=function(t){var n,i=this;return e.Model.currentUndoManager().get(this.pageId).captureUserUpdate(function(){n=i.card.create(),i._cardsContainer.addCardObjects([new o.Card({model:n,definition:i.card})])},"Adding card from the card gallery"),this._cardsContainer.scrollToModelsAndSetFocus([n],!1),ActionLogger.RecordClientAction(new ClientAction.CardGalleryAddCardData(ClientAction.ActionType.Edit_CardGallery_AddCard,"User added a card from the card gallery",this.card.id)),TDB.EventPropagation.Bypass},i.prototype.wrapperTouchToMouseArgs=function(e){return{enabled:!0}},i}(n.ButtonVE);t.CardOptionVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(n){function o(e,t){var o=n.call(this,e)||this;return o.args=t,o.title=TDB.watchableTag(596473298,o,t.title),o}return __extends(o,n),o.prototype.headerTitleTextArgs=function(e){return this.title.getWatchedValue(e)},o.prototype.headerTitleAttrArgs=function(e){return{id:this.args.titleId}},o.prototype.headerTitleClassNameArgs=function(e){return this.args.leftAlign?"SidePaneHeaderTitleLeftAlign":"SidePaneHeaderTitle"},o.prototype.closeButtonArgs=function(){var n={buttonId:this.args.paneCloseButtonId,click:this.args.closeButtonClicked,context:this.args.context,cssClass:{value:"PaneHeaderClosePaneButton"},description:{value:ResourceManager.ResolveString(Resources.ClosePaneButtonDescription,[this.args.title])},tooltip:{value:ResourceManager.ResolveString(Resources.ClosePaneButtonDescription,[this.args.title])},fontIconName:{value:FontIcons.ClosePaneIcon},fontIconSizeClass:FontIcons.ClosePaneIconSize,tabIndex:e.AuthoringPaneTabIndex.ClosePaneButton};return new TDB.ChildArgs(t.GlyphButtonVE,n)},o}(TDB.FocusableViewElement);e.PaneHeaderVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(t){function n(e,n){var o=t.call(this,e,n)||this;return o.authoringModel=n.authoringModel,o.storyPageEdit=n.storyPageEdit,o}return __extends(n,t),n.prototype.remixHeaderArgs=function(){if(!StoryAppCommon.UserState.getInstance().isUserOnFlight(FlightList.TopLevelRemixButton1)){var t={viewModel:this.storyPageEdit,nlDesignStory:this.storyPageEdit.nlDesignStory},n={viewModel:this.storyPageEdit,authoringModel:this.authoringModel,dropdownArgs:t,pageId:this.pageId,tabIndex:e.ModeSwitchStylePaneTabIndex.RemixButton},o=new e.RemixHeaderViewModel(n);return new TDB.ChildArgs(EditVE.RemixHeaderVE,o)}},n}(e.PaneHeaderVEBase);e.StylePaneHeaderVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewElements,o=function(o){function i(e,t,n){var i=o.call(this,e)||this;i.owner=e,i.view=t,i.paneStateManager=n.paneStateManager,i.textDirectionButtonsVisible=n.textDirectionButtonsVisible,i.languages=n.languages,i.languageOptions=TDB.watcherTag(596473295,i,t,i.getLanguageOptions),i.selectedLanguage=TDB.watcherTag(596473296,i,t,i.getSelectedLanguage);var r={context:i,isSelected:{value:!1},language:{watchable:i.selectedLanguage},buttonId:ClientAction.ButtonId.SwaySettingsPane_LanguageDropdown,onAction:i.languageOnAction};return i.languageDropdownButtonArgs=r,i}return __extends(i,o),i.prototype.canActivate=function(){return this.paneStateManager.getPaneVisible(n.AuthoringPaneType.SwaySettings)&&StoryPageEditSettings.SwaySettingsPaneEnabled},i.prototype.getLanguageOptions=function(e){for(var t=this.languages.getWatchedValue(e),n=[],o=this.selectedLanguage.getWatchedValue(e),i=0;i<t.length;i++){var r=t[i],a={context:this,isSelected:{value:o&&o.getId()===r.getId()},onAction:this.languageOnAction,language:{value:r},buttonId:ClientAction.ButtonId.SwaySettingsPane_LanguageOption};n.push(a)}return n},i.prototype.getSelectedLanguage=function(n){var o=e.Model.StoryModel.traversalModel,i=o.getCulture(n),r=o.getStyleOverrides(),a=r?r.getFontSetId():"";return new t.Language(i,a)},i.prototype.getTextDirectionButtonsVisible=function(){return this.textDirectionButtonsVisible},i.prototype.updateTextDirectionButton=function(e){var t=this;TDB.applyUpdate(function(){return t.textDirectionButtonsVisible.setValue(e)})},i.prototype.getSelectedLanguageOption=function(){return this.languageDropdownButtonArgs},i.prototype.languageOnAction=function(t,n,o){var i=this;return o&&e.Model.StoryModel.traversalModel.getCulture()!==o.getId()&&(e.Model.currentUndoManager().get(this.owner.getPageId()).captureUserUpdate(function(){var t=e.Model.StoryModel.traversalModel;t.setCulture(o.getId()),t.getStyleOverrides()&&t.getStyleOverrides().setFontSetId(o.getFontSetId()),o.isRtl()?(t.setRTL(!0),i.updateTextDirectionButton(!0)):t.setRTL(!1)},"User changed the sway language"),ActionLogger.RecordClientAction(new ClientAction.ButtonClickAction(ClientAction.ButtonId.SwaySettingsPane_LanguageOption,Diag.ULSCat.msoulscat_Story_Storyline,{ListIndex:n.toString(),Language:o.getId()}))),!1},i}(Disposable);t.SwaySettingsPaneViewModel=o}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel,o=StoryApp.View.ViewElements,i=function(i){function r(e,t){var o=this,r={features:TDB.ControlSetFeatures.Isolated,paneStateManager:t.paneStateManager,paneCloseButtonId:ClientAction.ButtonId.SwaySettingsPane_CloseButton,leftAlign:!0};return o=i.call(this,e,r)||this,o.viewModel=new n.SwaySettingsPaneViewModel(o,o,{paneStateManager:t.paneStateManager,textDirectionButtonsVisible:t.textDirectionButtonsVisible,languages:t.languages}),o.sharingManager=t.sharingManager,o}return __extends(r,i),r.prototype.logVisibilityEvent=function(e){var t=e?ClientAction.ActionType.Edit_SwaySettingsPane_Open:ClientAction.ActionType.Edit_SwaySettingsPane_Close;ActionLogger.RecordClientAction(new ClientAction.SimpleClientActionData(t,Diag.ULSCat.msoulscat_Story_Storyline))},r.prototype.getTitleText=function(){return Resources.SwaySettingsPaneTitleText},r.prototype.getViewModel=function(){return this.viewModel},r.prototype.showSettingsPane=function(){this.enter()},r.prototype.canActivate=function(){return this.viewModel.canActivate()},r.prototype.languageDropdownListArgs=function(){var e={headerText:Resources.LanguageLabel,headerId:r.LanguageLabelId,wrapperClassName:{value:"SwaySettingsPaneLanguageWrapper"},dropdownButtonArgs:this.viewModel.getSelectedLanguageOption(),listItemType:t.LanguageOptionVE,listItemsArgs:{watchable:this.viewModel.languageOptions},dropdownTelemetryId:ClientAction.ButtonId.SwaySettingsPane_LanguageDropdown,ulsCategory:Diag.ULSCat.msoulscat_Story_Storyline};return new TDB.ChildArgs(o.DropdownListVE,e)},r.prototype.showTextDirectionButtonCheckboxArgs=function(){var e=Resources.TextDirectionCheckboxText,t=new TDB.ChildArgs(o.SpanMessageVE,{message:e,messageCss:"SwaySettingsPaneCheckboxText"}),n={buttonId:ClientAction.ButtonId.SwaySettingsPane_TextDirectionCheckbox,context:this,checkedWatchable:this.viewModel.getTextDirectionButtonsVisible(),click:this.textDirectionCheckboxClicked,cssClass:{value:"SwaySettingsPaneFirstCheckboxWrapper"},enabled:{value:!0},richTextElementsChecked:[t],richTextElementsUnchecked:[t],role:Aria.Roles.Checkbox,fontIconName:{value:FontIcons.CheckboxFontIcon},fontIconSize:FontIcons.CheckboxFontIconSize,checkedIconWrapperClass:{value:"SwaySettingsPaneCheckboxChecked"},uncheckedIconWrapperClass:{value:"SwaySettingsPaneCheckboxUnchecked"},tooltipDefault:Resources.TextDirectionCheckboxTooltip};return new TDB.ChildArgs(o.RichCheckboxVE,n)},r.prototype.textDirectionCheckboxClicked=function(e){return this.viewModel.updateTextDirectionButton(this.showTextDirectionButtonCheckbox.getChecked()),TDB.EventPropagation.Bypass},r.prototype.rtlLayoutCheckboxArgs=function(){var e=TDB.watcherTag(596473297,this,this.rtlLayoutCheckbox,this.rtlLayoutCheckboxChecked),t=new TDB.ChildArgs(o.SpanMessageVE,{message:Resources.LayoutRtlCheckboxText,messageCss:"SwaySettingsPaneCheckboxText"}),n={buttonId:ClientAction.ButtonId.SwaySettingsPane_RtlLayoutCheckbox,context:this,checkedWatchable:e,click:this.rtlLayoutCheckboxClicked,cssClass:{value:"SwaySettingsPaneCheckboxWrapper"},enabled:{value:!0},richTextElementsChecked:[t],richTextElementsUnchecked:[t],role:Aria.Roles.Checkbox,fontIconName:{value:FontIcons.CheckboxFontIcon},fontIconSize:FontIcons.CheckboxFontIconSize,checkedIconWrapperClass:{value:"SwaySettingsPaneCheckboxChecked"},uncheckedIconWrapperClass:{value:"SwaySettingsPaneCheckboxUnchecked"},tooltipDefault:Resources.RTLLayoutCheckboxTooltip};return new TDB.ChildArgs(o.RichCheckboxVE,n)},r.prototype.rtlLayoutCheckboxClicked=function(t){var n=e.Model.StoryModel.traversalModel,o=!this.rtlLayoutCheckbox.getChecked();return e.Model.currentUndoManager().get(this.pageId).captureUserUpdate(function(){ActionLogger.RecordClientAction(new ClientAction.ButtonClickAction(ClientAction.ButtonId.SwaySettingsPane_RtlLayoutCheckbox,Diag.ULSCat.msoulscat_Story_Storyline)),n.setRTL(o)},"User toggled the RTL layout flag"),TDB.EventPropagation.Bypass},r.prototype.rtlLayoutCheckboxChecked=function(t){return e.Model.StoryModel.traversalModel.getRTL(t)},r.prototype.shouldShowViewSettingsArgs=function(){return StoryPageSettings.IsOwner},r.prototype.viewSettingsArgs=function(){var e={sharingManager:this.sharingManager};return new TDB.ChildArgs(t.ViewSettingsVE,e)},r.prototype.getInitialActiveChild=function(){return this.languageDropdownList},r.prototype.onExiting=function(){this.parent.isVisible()||this.languageDropdownList.setDropdownVisibility(!1)},r.prototype.escape=function(){this.viewModel.paneStateManager.hideAllAuthoringPanes()},r.prototype.autoplaySettingsVisibleArgs=function(e){return CommonSettings.IsPaidUser},r.prototype.autoplaySettingsArgs=function(){var n={traversalModel:e.Model.StoryModel.traversalModel};return new TDB.ChildArgs(t.AuthoringAutoplaySettingsVE,n)},r.LanguageLabelId="LanguageLabel",r}(t.AuthoringPaneContent);t.SwaySettingsPaneVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=function(t){function n(e,n){var o=t.call(this,e)||this;return o.owner=e,o.traversalModel=n.traversalModel,o}return __extends(n,t),n.prototype.getAutoPlayToggleLabelText=function(e){return this.getAutoPlayStartAutomatically(e)?Resources.SettingsPaneAutoPlayToggleCheckedLabel:Resources.SettingsPaneAutoPlayToggleUncheckedLabel},n.prototype.getAutoPlayStartAutomatically=function(e){return this.getAutoPlaySettingsFromTraversalOrDefault(!1,e).getStartAutomatically(e)},n.prototype.updateAutoPlayStartAutomatically=function(t){var n=this;e.Model.currentUndoManager().get(this.owner.getPageId()).captureUserUpdate(function(){ActionLogger.RecordClientAction(new ClientAction.ButtonClickAction(ClientAction.ButtonId.SwaySettingsPane_AutoPlayToggleSwitch,Diag.ULSCat.msoulscat_Story_Storyline)),n.getAutoPlaySettingsFromTraversalOrDefault(!0).setStartAutomatically(t)},"User toggled the auto-play: "+(t?"ON":"OFF"))},n.prototype.getTimingOptions=function(){return n.timingOptions},n.prototype.getAutoPlayTiming=function(e){return this.getAutoPlaySettingsFromTraversalOrDefault(!1,e).getSpeed(e)},n.prototype.updateAutoPlayTiming=function(t){var n=this;e.Model.currentUndoManager().get(this.owner.getPageId()).captureUserUpdate(function(){var e=new ClientAction.SlidebarSlideAction(ClientAction.SlidebarId.SettingsPlaneAutoPlayTimingSlidebar,Diag.ULSCat.msoulscat_Story_Style,{Slider:"Position changed",Timing:t.toString()});ActionLogger.RecordClientAction(e),n.getAutoPlaySettingsFromTraversalOrDefault(!0).setSpeed(t)},"User changed auto-play timing.")},n.prototype.getAutoPlayLoop=function(e){return this.getAutoPlaySettingsFromTraversalOrDefault(!1,e).getLoop(e)},n.prototype.updateAutoPlayLoop=function(t){var n=this;e.Model.currentUndoManager().get(this.owner.getPageId()).captureUserUpdate(function(){ActionLogger.RecordClientAction(new ClientAction.ButtonClickAction(ClientAction.ButtonId.SwaySettingsPane_AutoPlayLoopCheckbox,Diag.ULSCat.msoulscat_Story_Storyline)),n.getAutoPlaySettingsFromTraversalOrDefault(!0).setLoop(t)},"User toggled the auto-play loop checkbox: "+(t?"Checked":"Unchecked"))},n.prototype.getAutoPlaySettingsFromTraversalOrDefault=function(t,n){var o=this.traversalModel.getAutoPlaySettings(n);return o||(o=new e.Model.SM.AutoPlaySettings,t&&this.traversalModel.setAutoPlaySettings(o)),o},n.timingOptions=[3,5,10,15,20,25,30,35,40,45,50,55,60],n}(Disposable);t.AuthoringAutoplaySettingsViewModel=n}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.View.ViewModel,i=function(e){function t(t,n){var i=e.call(this,t)||this;return i.viewModel=new o.AuthoringAutoplaySettingsViewModel(i,{traversalModel:n.traversalModel}),i}return __extends(t,e),t.prototype.autoPlayLabelTextArgs=function(){return Resources.AutoPlaySettingsLabel},t.prototype.toggleAutoPlayArgs=function(){var e=this,t={buttonId:ClientAction.ButtonId.SwaySettingsPane_AutoPlayToggleSwitch,context:this,click:function(t){return e.viewModel.updateAutoPlayStartAutomatically(!e.toggleAutoPlay.isChecked.getValue()),TDB.EventPropagation.Bypass},calculateChecked:function(t){return e.viewModel.getAutoPlayStartAutomatically(t)},tooltip:{value:Resources.SettingsPaneAutoPlayToggleSwitchTooltip}};return new TDB.ChildArgs(n.ToggleSwitchVE,t)},t.prototype.toggleAutoPlayLabelTextArgs=function(e){return this.viewModel.getAutoPlayToggleLabelText(e)},t.prototype.slidebarArgs=function(){for(var e=this,t=[],o=this.viewModel.getTimingOptions(),i=o.length,r=0;r<i;r++){var a=o[r];t[r]={text:ResourceManager.ResolveString(Resources.AutoplayTimingSlidebarValue,[a]),value:a,hidden:0!==r&&r!==i-1}}var s={points:t,onSliderChange:function(t){e.viewModel.updateAutoPlayTiming(t)},position:TDB.watcher(this,this,function(t){return e.viewModel.getAutoPlayTiming(t)}),cssOverride:"consumptionAutoplaySlidebarWrapper",disabledCssOverride:"consumptionAutoplaySlidebarDisabledWrapper",description:Resources.AutoplayTimingSlidebarDescription,continuousMode:!1,showTooltip:!0,showTicks:!0,enabled:{compute:new TDB.ComputedOptionArgs(this,function(t){return e.viewModel.getAutoPlayStartAutomatically(t)})}};return new TDB.ChildArgs(n.SlidebarVE,s)},t.prototype.loopCheckboxArgs=function(){var e=this,t=new TDB.ChildArgs(n.SpanMessageVE,{message:Resources.AutoplayLoopCheckboxMessage}),o={buttonId:ClientAction.ButtonId.SwaySettingsPane_AutoPlayLoopCheckbox,context:this,checkedWatchable:TDB.watcher(this,this,function(t){return e.viewModel.getAutoPlayLoop(t)}),click:function(t){return e.viewModel.updateAutoPlayLoop(!e.loopCheckbox.getChecked()),TDB.EventPropagation.Bypass},cssClass:{value:"consumptionAutoplayLoopCheckboxWrapper"},richTextElementsUnchecked:[t],richTextElementsChecked:[t],role:Aria.Roles.Checkbox,fontIconName:{value:FontIcons.CheckboxFontIcon},fontIconSize:FontIcons.CheckboxFontIconSize,checkedIconWrapperClass:{value:"consumptionAutoplayLoopChecked"},uncheckedIconWrapperClass:{value:"consumptionAutoplayLoopUnchecked"},enabled:{compute:new TDB.ComputedOptionArgs(this,function(t){return e.viewModel.getAutoPlayStartAutomatically(t)})}};return new TDB.ChildArgs(n.RichCheckboxVE,o)},t}(TDB.FocusableViewElement);t.AuthoringAutoplaySettingsVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.View.Common,i=e.View.ViewModel,r=function(e){function r(t,n){var o=e.call(this,t)||this;return o.viewModel=new i.LayoutChooserViewModel(o,{styleManager:n.styleManager,visibility:n.layoutChooserPaneVisible}),o}return __extends(r,e),r.prototype.layoutCarouselOptionsArgs=function(e){var t=this;return o.StyleManager.getWorldOptions(e).map(function(e){return t.layoutCarouselOptionConstructor(e)})},r.prototype.layoutCarouselOptionConstructor=function(e){return{layoutTitle:e.name,layoutDescription:e.description,layoutId:e.id,selectedId:this.viewModel.getSelectedLayout(),styleManager:this.viewModel.getStyleManager(),isEnabled:e.isEnabled,listIndex:void 0,description:e.description}},r.prototype.layoutCarouselArgs=function(e){var o={optionArgsAndTypes:this.layoutCarouselOptionsArgs(e).map(function(e){return{optionArgs:e,optionType:t.LayoutCarouselOptionVE}}),logString:"LayoutChooserCarousel",description:Resources.LayoutOptionCarouselDescription,nextButtonID:ClientAction.ButtonId.DesignPane_LayoutCarouselNext,nextButtonCssClass:"CarouselNext LayoutChooserCarouselNextPrevious",nextButtonDescription:Resources.NextDesignButtonDescription,previousButtonID:ClientAction.ButtonId.DesignPane_LayoutCarouselPrevious,previousButtonCssClass:"CarouselPrevious LayoutChooserCarouselNextPrevious",previousButtonDescription:Resources.PreviousDesignButtonDescription,carouselCssClass:"LayoutCarousel",hideDisabledNextPreviousButtons:!0};return new TDB.ChildArgs(n.AccessibleCarouselVE,o)},r.prototype.mouseClicked=function(e){return TDB.EventPropagation.Bypass},r.prototype.styleHintsWrapperClassNameArgs=function(e){return"NavigationPaneScroller native-scroller StyleHintsWrapper LayoutChooserWrapper"},r}(TDB.FocusableViewElement);t.LayoutChooserVEBase=r}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.View.ViewModel,i=function(t){function n(e,n){var i=this,r=new o.LayoutOptionViewModel(n),a={context:r,id:n.layoutId,radioGroupName:"navigationRadioGroup",description:n.layoutDescription,getSelectedRadioButton:r.getSelected,click:r.changeLayout,value:n.layoutId,enabled:{value:n.isEnabled}};return i=t.call(this,e,a)||this,i.viewModel=r,i}return __extends(n,t),n.prototype.checkboxWrapperAttrArgs=function(e){return this.getRadioButtonAttributes(e)},n.prototype.imageAttrArgs=function(e){return{src:CommonSettings.ContentBaseUrl+"Layout"+this.viewModel.getLayoutId()+".png",alt:"",role:Aria.Roles.Presentation}},n.prototype.imageClassNameArgs=function(t){return e.Model.StoryModel.traversalModel.getRTL(t)?"MirrorTransform":void 0},n}(n.RadioButtonVE);t.LayoutOptionVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.View.ViewModel,i=function(t){function n(e,n){var i=this,r=new o.LayoutOptionViewModel(n);return i=t.call(this,e,{context:r,calculateChecked:r.isOptionChecked,buttonId:void 0,listIndex:n.listIndex,description:{value:n.layoutDescription},tooltip:{value:n.layoutDescription}})||this,i.viewModel=r,i}return __extends(n,t),n.prototype.checkboxWrapperAttrArgs=function(e){return this.getOptionAttrArgs(e)},n.prototype.checkboxWrapperClassNameArgs=function(e){var t="LayoutCarouselOptionCheckbox";return this.viewModel.isOptionChecked(e)&&(t+=" LayoutCarouselOptionSelected"),t},n.prototype.imageAttrArgs=function(e){return{src:CommonSettings.ContentBaseUrl+"Layout"+this.viewModel.getLayoutId()+(this.viewModel.isOptionChecked(e)?"Selected.png":"Unselected.png"),alt:"",role:Aria.Roles.Presentation}},n.prototype.imageClassNameArgs=function(e){return this.viewModel.getRTL(e)?"MirrorTransform":void 0},n.prototype.onAction=function(t){var n=this;return e.Model.currentUndoManager().get(this.pageId).captureUserUpdate(function(){n.viewModel.changeLayout(n.viewModel.getLayoutId())},"User changed the Sway style"),TDB.EventPropagation.Bypass},n.prototype.layoutOptionLabelTextArgs=function(){switch(this.viewModel.getLayoutId()){case"VerticalWorld":return Resources.LayoutVerticalLabel;case"PanoramaWorld":return Resources.LayoutHorizontalLabel;case"ExpoWorld":return Resources.LayoutExpoLabel;default:return""}},n}(n.CarouselListItemVE);t.LayoutCarouselOptionVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){!function(e){e[e.Focus=0]="Focus"}(e.EditImagePaneType||(e.EditImagePaneType={}));var t=function(t){function n(e,n){var o=this,i={features:TDB.ControlSetFeatures.Isolated,paneStateManager:n.paneStateManager,paneCloseButtonId:ClientAction.ButtonId.EditImagePane_Close};return o=t.call(this,e,i)||this,o._paneStateManager=n.paneStateManager,o._restoreFocus=void 0,o.authoringModel=n.authoringModel,o}return __extends(n,t),n.prototype.canActivate=function(){return this._paneStateManager.getPaneVisible(e.AuthoringPaneType.EditImage)},n.prototype.logVisibilityEvent=function(e){e?ActionLogger.RecordClientAction(new ClientAction.SimpleClientActionData(ClientAction.ActionType.Edit_EditImage_Open,Diag.ULSCat.msoulscat_Story_Storyline)):ActionLogger.RecordClientAction(new ClientAction.SimpleClientActionData(ClientAction.ActionType.Edit_EditImage_Close,Diag.ULSCat.msoulscat_Story_Storyline))},n.prototype.onVisibilityChangeEvent=function(e){!e&&this.focusPane&&this.focusPane.clearImage()},n.prototype.onTransitionEndEvent=function(t){if(this.focusPane.onTransitionEndEvent(t),!this.parent.isVisible()&&this._restoreFocus){if(this._openedFromCard){var n=this.findParent(e.AuthoringPageVE);n.isCardDeckVisible()||n.toggleStoryline()}this._restoreFocus=void 0}},n.prototype.getViewElement=function(){return this},n.prototype.closePaneButtonClicked=function(e){return this.focusPane.clearImage(),this.escape(),TDB.EventPropagation.Bypass},n.prototype.focusPaneArgs=function(){var t={};return new TDB.ChildArgs(e.FocusPaneVE,t)},n.prototype.getFocusPane=function(){return this.focusPane},n.prototype.getFocusImage=function(){if(this.focusPane)return this.focusPane.focusImage},n.prototype.setImage=function(e){this._openedFromCard=e.openedFromCard,this.focusPane.setImage(e.model)},n.prototype.escape=function(){this._restoreFocus=!0,this._paneStateManager.hideAuthoringPane(this.parent.paneType,!0)},n.prototype.getTitleText=function(){return Resources.FocusPaneTitle},n.prototype.isCardDeckSupported=function(){return this.authoringModel.isCardDeckFullScreen()},n}(e.AuthoringPaneContent);e.EditImagePaneVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=StoryApp.Common,i=e.View.ViewModel,r=function(e){function t(t,n){var o=e.call(this,t)||this;o.focusImageViewModel=new i.FocusImageViewModel(o);var r={height:0,left:0,top:0,width:0};o.mobileRect=TDB.watchableTag(596473307,o,r);var a={height:0,left:0,top:0,width:0};o.desktopRect=TDB.watchableTag(596473308,o,a);var s={height:0,left:0,top:0,width:0};return o.tabletRect=TDB.watchableTag(596473309,o,s),o.focusableImage=new TDB.FocusableSurrogate(o,{}),o.addFocusableChild(o.focusableImage),o}return __extends(t,e),t.prototype.focusImageArgs=function(){return this.focusImageViewModel.getViewArgs()},t.prototype.resetButtonArgs=function(){var e={buttonId:ClientAction.ButtonId.EditImagePane_Reset,click:this.resetButtonClicked,context:this,cssClass:{value:"FocusPaneResetButton"},text:{value:Resources.FocusPaneResetButton},describedby:"resetAllButtonAdditionalDescription"};return new TDB.ChildArgs(n.TextButtonVE,e)},t.prototype.ifFocusImageEnabledArgs=function(e){return this.focusImageViewModel.focusImageEnabledWatcher.getWatchedValue(e)},t.prototype.previewMobileStyleArgs=function(e){return{"background-image":"url("+CommonSettings.ContentBaseUrl+"Mobile.png)"}},t.prototype.previewDesktopStyleArgs=function(e){return{"background-image":"url("+CommonSettings.ContentBaseUrl+"Desktop.png)"}},t.prototype.previewTabletStyleArgs=function(e){return{"background-image":"url("+CommonSettings.ContentBaseUrl+"Tablet.png)"}},t.prototype.desktopCropStyleArgs=function(e){var t=this.desktopRect.getWatchedValue(e);return this.getCropStyleArgs(e,t)},t.prototype.mobileCropStyleArgs=function(e){var t=this.mobileRect.getWatchedValue(e);return this.getCropStyleArgs(e,t)},t.prototype.tabletCropStyleArgs=function(e){var t=this.tabletRect.getWatchedValue(e);return this.getCropStyleArgs(e,t)},t.prototype.getCropStyleArgs=function(e,t){var n=this.focusImageViewModel.getImageSrc(e);return{"background-image":n?"url("+n+")":"",left:t.left.toString()+"px",top:t.top.toString()+"px",height:t.height.toString()+"px",width:t.width.toString()+"px"}},t.prototype.keepEntireCheckboxArgs=function(){var e={message:Resources.FocusPaneCheckboxText},t=new TDB.ChildArgs(n.SpanMessageVE,e),o={buttonId:ClientAction.ButtonId.RichCheckbox_FocusPane,context:this,click:this.keepEntireCheckboxClicked,cssClass:{value:"FocusPaneKeepEntireCheckbox"},richTextElementsUnchecked:[t],richTextElementsChecked:[t],descriptionDefault:e.message,fontIconName:{value:FontIcons.CheckboxFontIcon},fontIconSize:FontIcons.CheckboxFontIconSize,checkedIconWrapperClass:{value:"FocusPaneCheckboxChecked"},uncheckedIconWrapperClass:{value:"FocusPaneCheckboxUnchecked"},messagePartsWrapperClass:"FocusPaneCheckboxMessageWrapper",checkedWatchable:this.focusImageViewModel.keepEntireImageWatcher};return new TDB.ChildArgs(n.RichCheckboxVE,o)},t.prototype.editTextTextArgs=function(e){return o.UserState.getInstance().isUserOnFlight(FlightList.FocusPaneStringExp1)?Resources.FocusPaneEditText:Resources.FocusPaneEditTextNew},t.prototype.previewTextTextArgs=function(e){return Resources.FocusPanePreviewText},t.prototype.resetAllButtonAdditionalDescriptionTextArgs=function(){return Resources.FocusPaneResetAllButtonAdditionalDescription},t.prototype.focusPointAdditionalDescriptionTextArgs=function(){return Resources.FocusPaneFocusPointInitialStateAdditionalDescription},t.prototype.keepEntireCheckboxClicked=function(e){var t=this.focusImageViewModel,n=t.keepEntireImageWatcher.getValue();return t.keepEntireImage(!n)},t.prototype.onTransitionEndEvent=function(e){this.focusImageViewModel.recalculateCurrentHeightAndDiameter()},t.prototype.resetButtonClicked=function(e){return this.focusImageViewModel.resetFocusImage()},t.prototype.setImage=function(e){this.focusImageViewModel.setImage(e)},t.prototype.clearImage=function(){this.focusImageViewModel.clearImage()},t}(TDB.FocusableViewElement);t.FocusPaneVEBase=r}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t,n){var o=e.call(this,t,{features:TDB.ControlSetFeatures.Isolated})||this;return o._viewModel=n,o.focusPoints=void 0,o}return __extends(t,e),t.prototype.ifFocusImageEnabledArgs=function(e){return this._viewModel.shouldFocusImageEnabled(e)},t.prototype.focusPointsArgs=function(e){return this._viewModel.obtainFocusPointArgsFromModel(e)},t.prototype.focusPointMovingStatusTextArgs=function(e){return this._viewModel.getFocusPointMovingStatus(e)},t.prototype.focusImageWrapperAttrArgs=function(e){return this._viewModel.focusImageWrapperAttr(e)},t.prototype.showFocusPaneImageArgs=function(e){return this._viewModel.shouldShowFocusPaneImage(e)},t.prototype.focusPaneImageAttrArgs=function(e){return this._viewModel.focusImageAttr(e)},t.prototype.focusPaneImageEventsInitArgs=function(){return{load:this.focusPaneImageLoaded}},t.prototype.focusPaneImageLoaded=function(e){return this._viewModel.focusPaneImageLoaded(e)},t.prototype.ifFocusPaneImageBorderArgs=function(e){return this._viewModel.getImageDimensions(e)&&this._viewModel.keepEntireImageWatcher.getWatchedValue(e)},t.prototype.focusPaneImageBorderStyleArgs=function(e){var t=this._viewModel.getImageDimensions(e);if(t)return{height:StoryApp.Utilities.toPxStr(t.height),width:StoryApp.Utilities.toPxStr(t.width),left:"calc(50% - "+t.width/2+"px)"}},t.prototype.focusImageWrapperStyleArgs=function(e){var t=this._viewModel.getImageDimensions(e);return{height:StoryApp.Utilities.toPxStr(t?t.height:1)}},t.prototype.mouseClicked=function(e){return this._viewModel.mouseClickedAction(e)?TDB.EventPropagation.Bubble:TDB.EventPropagation.Bypass},t.prototype.mouseDown=function(e){return TDB.EventPropagation.PreventDefault},t.prototype.focusPaneSmallImageStyleArgs=function(e){var t=this._viewModel.getImageSrc(e);return{"background-image":t?"url("+t+")":""}},t.prototype.focusPaneNotifyTextTextArgs=function(e){return Resources.FocusPaneNotifyText},t.prototype.keyDown=function(t){var n=TDB.EventPropagation.Bubble;if(this.isFocused())switch(t.keyCode){case KeyCodeType.EnterKey:case KeyCodeType.SpaceKey:n=this._viewModel.keyDownAction(t)}return n===TDB.EventPropagation.Bubble?e.prototype.keyDown.call(this,t):n},t.prototype.applyFocusPointChangesToModel=function(){this._viewModel.applyFocusPointChangesToModel()},t.prototype.getActivatableChildren=function(){return this.focusPoints||[]},t.prototype.onGainingFocus=function(){this.setEntered(!1)},t.prototype.isFocused=function(){return this.parent.focusableImage.isFocused()},t.prototype.update=function(t){e.prototype.update.call(this,t),this._viewModel.updateFocus(t)},t.prototype.escape=function(){e.prototype.escape.call(this),this.parent.focusableImage.setFocus()},t.prototype.FocusableInitArgs=function(){return{surrogate:this.parent.focusableImage}},t}(TDB.ControlSet);e.FocusImageVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n,o=e.Model.SM,i=e.Model.CSM,r=e.View.ViewElements,a=e.Model.AuthoringModel,s=e.Model.AuthoringModel.StoryController;!function(e){e[e.Initial=0]="Initial",e[e.InsertFocusPoint=1]="InsertFocusPoint",e[e.MoveFocusPoint=2]="MoveFocusPoint"}(n=t.FocusImageState||(t.FocusImageState={}));var l=function(t){function l(e){var o=t.call(this,e)||this;return o._imageSrc=TDB.watchableTag(596473310,o,void 0),o._imageModel=TDB.watchableTag(596473311,o,void 0),o._imageMediaContent=void 0,o._imageDimensions=TDB.watchableTag(596473312,o,void 0),o._currentFocusPointDiameter=TDB.watchableTag(596473313,o,0),o.focusImageEnabledWatcher=TDB.watcherTag(596473314,o,o,o.shouldEnableFocusImage),o.keepEntireImageWatcher=TDB.watcherTag(596473315,o,o,o.getCropStateFromModel),o._ourLoadedImage=void 0,o.state=n.Initial,o._focusPointMovingStatus=TDB.watchableTag(596473344,o,""),o.nextFocusPointMovingStatus="",o.croppingPreviewRetrieved=!1,StoryApp.Utilities.onResize(o.recalculateCurrentHeightAndDiameter,o),o}return __extends(l,t),l.prototype.getViewArgs=function(){var e=this;return new TDB.ChildArgs(r.FocusImageVE,this,function(t){e._view=t})},l.prototype.getDescription=function(e){var t=this._imageModel.getWatchedValue(e),n=0;return a.StoryController.isModelObjectValid(t)&&1===(n=t.getFocusRegions().getCollection(e).length)?ResourceManager.ResolveString(Resources.FocusPanePreviewImageWithSingularFocusPointDescription,[n]):ResourceManager.ResolveString(Resources.FocusPanePreviewImageWithMultipleFocusPointsDescription,[n])},l.prototype.clearFocusPointMovingStatus=function(){var e=this;this._focusPointMovingStatus.getValue()&&TDB.applyUpdate(function(){e._focusPointMovingStatus.setValue("")})},l.prototype.shouldEnableFocusImage=function(t){var n=this._imageModel.getWatchedValue(t);if(!n)return!0;var o=n.getWidth(),i=n.getHeight();if(0===o&&0===i){var r=e.Model.ContentStorageModel.getModelObject(n.id);r instanceof e.Model.CSM.ImageContentPart&&(o=r.getWidth(),i=r.getHeight())}return Math.min(o,i)>=l._minimumImageDimension},l.prototype.getCropStateFromModel=function(t){var n=this._imageModel.getWatchedValue(t);if(!n)return!1;var r=e.Model.ContentStorageModel.getModelObject(n.id),a=n.getCropState(t),s=n.getSemantic(t),l=this._imageMediaContent?e.Model.ContentStorageModel.getModelObject(this._imageMediaContent.id):void 0,c=!1;if(l){var d=l.getContentState(t);c=null!=d&&(d===i.ContentState.Ready||d===i.ContentState.Failed)}else e.Model.ContentStorageModel.contentRoot.contentNodes.getCollection(t);return c||StoryLog.TraceTag(596473345,Diag.ULSCat.msoulscat_Story_DocumentImport,Diag.ULSTraceLevel.info,"User opened focus pane before augmentation is finished."),a===o.ImageCropState.DoNotCrop||a===o.ImageCropState.Auto&&(r&&c&&r.getSemantic(t)===i.ImageSemantic.NonCroppable||s===o.ImageSemantic.Chart||s===o.ImageSemantic.SmartArt||s===o.ImageSemantic.Table||s===o.ImageSemantic.OtherNonCroppableElement)},l.prototype.recalculateImageHeight=function(){var e=this.getImageAreaSize(),t=this._ourLoadedImage[0];0!==t.naturalWidth?this._ourLoadedImage.css("height",Math.min(e.height,t.naturalHeight*e.width/t.naturalWidth)):(this._ourLoadedImage.css("height",e.height),StoryLog.StructuredTraceTag(596473346,Diag.ULSCat.msoulscat_Story_DocumentImport,Diag.ULSTraceLevel.warning,"naturalWidth of image is 0",{naturalWidth:t.naturalWidth.toString(),naturalHeight:t.naturalHeight.toString(),imageAreaSizeHeight:e.height.toString()}))},l.prototype.getImageAreaSize=function(){var e=0;this._ourLoadedImage&&(e=this._ourLoadedImage[0].naturalHeight),this._editRegion=this._editRegion||$("#focusPaneEditRegion"),this._previewRegion=this._previewRegion||$("#focusPanePreviewRegion");var t=$(".FocusPaneEditRegionText").outerHeight(!0),n=$(".FocusPaneOptions").outerHeight(!0),o=this._editRegion.innerHeight()-this._editRegion.height(),i=this._previewRegion.outerHeight(!0),r=this._editRegion.parent().outerHeight(!0),a=this._editRegion.width(),s=Math.max(238,r-(t+n+o+i+1));return this._ourLoadedImage&&e<s&&(s=e),new Size(a,s)},l.prototype.recalculateCurrentHeightAndDiameter=function(){var t=this;this._ourLoadedImage&&TDB.applyUpdate(function(){t.recalculateImageHeight();var n=new Size(t._ourLoadedImage.width(),t._ourLoadedImage.height()),o=t._imageDimensions.getValue()?t._imageDimensions.getValue().height/n.height:1;t._imageDimensions.setValue(n);var i=t.coefficientFromDefaultImageSize(t._imageDimensions.getValue());if(t._view&&t._view.focusPoints)for(var r=0;r<t._view.focusPoints.length;r++){var a=t._view.focusPoints[r];a&&a.scalePositionByFactor(o)}var s=l._defaultFocusPointDiameter*i,c=Math.min(n.width,n.height)*l._maximumFocusPointDiameterCoefficient;s=Math.max(Math.min(c,s),l._minimumFocusPointDiameter),t._currentFocusPointDiameter.setValue(s),(s>t._imageDimensions.getValue().height||s>t._imageDimensions.getValue().width)&&(e.Model.currentUndoManager().get(t._view.getPageId()).captureIgnorableUpdate(function(){return t.resetFocusRegionsInModel()},void 0),t.getCroppingPreview())})},l.prototype.obtainFocusPointArgsFromModel=function(e){var t=this,n=this._imageModel.getWatchedValue(e);if(!a.StoryController.isModelObjectValid(n))return[];var o=this._imageDimensions.getWatchedValue(e);return this._ourLoadedImage&&o?n.getFocusRegions().getCollection(e).map(function(e,n){var i={parentViewModel:t,id:n+1,position:{x:(e.getLeft()+e.getRight())/2*o.width,y:(e.getTop()+e.getBottom())/2*o.height}};return new TDB.ChildArgs(r.FocusPointVE,i)}):[]},l.prototype.shouldShowFocusPaneImage=function(e){return void 0!==this._imageSrc.getWatchedValue(e)},l.prototype.shouldFocusImageEnabled=function(e){return this.focusImageEnabledWatcher.getWatchedValue(e)},l.prototype.focusImageAttr=function(e){return{ondragstart:"return false;",src:this._imageSrc.getWatchedValue(e),role:Aria.Roles.Presentation,alt:""}},l.prototype.focusImageWrapperAttr=function(e){var t={};return t[Aria.Attributes.Label]=this.getDescription(e),t[Aria.Attributes.Dropeffect]=Aria.AriaDropEffectValue.Move,t},l.prototype.getFocusPointMovingStatus=function(e){return this._focusPointMovingStatus.getWatchedValue(e)},l.prototype.applyFocusPointChangesToModel=function(){var e=this,t=this._imageDimensions.getValue();if(t&&this._view.focusPoints&&a.StoryController.isModelObjectValid(this._imageModel.getValue())){for(var n=[],o=0;o<this._view.focusPoints.length;++o){var i=this._view.focusPoints[o].getFocusPointRectangle();i.setLeft(Math.max(Math.min(i.getLeft()/t.width,1),0)),i.setRight(Math.max(Math.min(i.getRight()/t.width,1),0)),i.setTop(Math.max(Math.min(i.getTop()/t.height,1),0)),i.setBottom(Math.max(Math.min(i.getBottom()/t.height,1),0)),n.push(i)}this.applyUserActionToModelAndRefresh(function(){TDB.applyUpdate(function(){e._imageModel.getValue().getFocusRegions().setCollection(n)})},"User changed focus of an image.")}},l.prototype.applyUserActionToModelAndRefresh=function(t,n){var o=this._imageModel.getValue();a.StoryController.isModelObjectValid(o)&&(e.Model.currentUndoManager().get(this._view.getPageId()).captureUserAction(t,n),this.getCroppingPreview())},l.prototype.addFocusRegionToModel=function(e){var t=this,n=this._imageDimensions.getValue();e.setLeft(Math.max(Math.min(e.getLeft()/n.width,1),0)),e.setRight(Math.max(Math.min(e.getRight()/n.width,1),0)),e.setTop(Math.max(Math.min(e.getTop()/n.height,1),0)),e.setBottom(Math.max(Math.min(e.getBottom()/n.height,1),0)),TDB.applyUpdate(function(){return t._imageModel.getValue().getFocusRegions().add(e)})},l.prototype.resetFocusRegionsInModel=function(){var e=this;0!==this._imageModel.getValue().getFocusRegions().getCollection().length&&TDB.applyUpdate(function(){return e._imageModel.getValue().getFocusRegions().setCollection([])})},l.prototype.setCropStateToModel=function(e){var t=this._imageModel.getValue();e!==t.getCropState()&&(e===o.ImageCropState.ShouldCrop&&t.getCropState()===o.ImageCropState.Auto&&this.keepEntireImageWatcher.getValue()&&StoryLog.TraceTag(596473347,Diag.ULSCat.msoulscat_Story_DocumentImport,Diag.ULSTraceLevel.info,"User choosed to crop image that our cropping eligibility engine detected as non-croppable."),TDB.applyUpdate(function(){return t.setCropState(e)}))},l.prototype.getCroppingPreview=function(){var e=this;this.croppingPreviewRetrieved=!1;var t={height:40,width:61},n={height:66,width:241},o=[];if(this.keepEntireImageWatcher.getValue())o.push({top:0,left:0,height:1,width:1});else if(this._view.focusPoints)for(var i=this._view.focusPoints,r=0;r<i.length;r++){var a=i[r].getFocusPointRectangle(),s=this._imageDimensions.getValue(),l=Math.max(Math.min(a.getTop()/s.height,1),0),c=Math.max(Math.min(a.getLeft()/s.width,1),0),d=Math.max(Math.min((a.getBottom()-a.getTop())/s.height,1-l),0),u=Math.max(Math.min((a.getRight()-a.getLeft())/s.width,1-c),0);o.push({top:l,left:c,height:d,width:u})}var p={id:this._imageModel.getValue().id,focusRegions:o,cropRequests:[{height:t.height,width:t.width},{height:n.height,width:n.width}]},g={name:"GetImageCrops",description:"Gets that image crop regions for given request",type:"POST",data:JSON.stringify(p),dataType:"json",contentType:StoryApp.RequestManager.JsonContentType,cache:!1,success:function(t){TDB.applyUpdate(function(){2===t.crops.length&&(e._view.parent.mobileRect.setValue(t.crops[0]),e._view.parent.tabletRect.setValue(t.crops[1]))}),e.croppingPreviewRetrieved=!0},timeout:6e4};$.ajax(StoryApp.Common.UrlHelper.getInstance().getImageCropsUrl(StoryPageSettings.LookupId),g)},l.prototype.focusPointStopMovingHandler=function(){var e=this._view.focusPoints||[];ActionLogger.RecordClientAction(new ClientAction.FocusPaneUIFocusPointAction(ClientAction.ActionType.FocusPane_FocusPointEdit_Keyboard,e.length)),this.applyFocusPointChangesToModel()},l.prototype.coefficientFromDefaultImageSize=function(e){return Math.max(e.height/600,e.width/600)},l.prototype.canEnter=function(){return this._view.getActivatableChildren().length>0},l.prototype.keyDownAction=function(e){return this.canEnter()?this._view.enter():this.insertNewFocusPointAtImageCenter(),TDB.EventPropagation.PreventDefault},l.prototype.getImageSrc=function(e){return this._imageSrc.getWatchedValue(e)},l.prototype.getImageDimensions=function(e){return this._imageDimensions.getWatchedValue(e)},l.prototype.getCurrentDiameter=function(e){return this._currentFocusPointDiameter.getWatchedValue(e)},l.prototype.mouseClickedAction=function(e){if(!this._ourLoadedImage)return!0;var t=this._ourLoadedImage.offset(),n=this._imageDimensions.getValue(),o=this._currentFocusPointDiameter.getValue(),i=o/2;if(!n||!o||e.pageX<t.left||e.pageX>t.left+n.width)return!0;var r=Math.min(Math.max(e.pageX-t.left,i),n.width-i),a=Math.min(Math.max(e.pageY-t.top,i),n.height-i);return this.insertNewFocusPoint(r,a,ClientAction.ActionType.FocusPane_FocusPointAdd)},l.prototype.insertNewFocusPointAtImageCenter=function(){var e=this._imageDimensions.getValue();if(!e)return!0;var t=e.width/2,n=e.height/2;return this.insertNewFocusPoint(t,n,ClientAction.ActionType.FocusPane_FocusPointAdd_Keyboard)},l.prototype.insertNewFocusPoint=function(e,t,i){var r=this,a=this._view.focusPoints||[],s=this._imageDimensions.getValue(),l=this._currentFocusPointDiameter.getValue(),c=l/2;if(!this._ourLoadedImage||!s||l>s.height||l>s.width)return!0;var d=new o.Rect;return d.setLeft(e-c),d.setTop(t-c),d.setRight(e+c),d.setBottom(t+c),ActionLogger.RecordClientAction(new ClientAction.FocusPaneUIFocusPointAction(i,a.length)),this.state===n.MoveFocusPoint&&this.applyFocusPointChangesToModel(),this.state=n.InsertFocusPoint,this.applyUserActionToModelAndRefresh(function(){return r.setCropStateToModel(o.ImageCropState.ShouldCrop),r.addFocusRegionToModel(d),{activeModelObjectId:r._imageModel.getValue().id}},"User added focus point to model."),!1},l.prototype.focusPaneImageLoaded=function(e){var t=$(e.target);return this._ourLoadedImage=t,this.recalculateCurrentHeightAndDiameter(),this.getCroppingPreview(),!1},l.prototype.isFocusPaneImageLoaded=function(){return!!this._ourLoadedImage},l.prototype.clearImage=function(){var e=this;this._ourLoadedImage=void 0,this._imageMediaContent=void 0,TDB.applyUpdate(function(){e._imageDimensions.setValue(void 0),e._imageSrc.setValue(void 0),e._imageModel.setValue(void 0)},TDB.Justification.InitialConversion)},l.prototype.setImage=function(e){var t=this;if(s.isModelObjectValid(e)){this.clearImage();var n,i=void 0;if(e instanceof o.TitleComposite){if(!(n=e.getBackground()))return;i=n.getMedia()}else if(e instanceof o.MediaWithTextComposite)i=(n=e).getMedia();else{if(!(e instanceof o.ImageContent))return;i=e}if(i){var r=i.imageParts.getCollection().firstOrDefault(function(e){return e.getType()===o.ImageCategory.Image});if(r){var l=this.getImageAreaSize(),c=a.ImageController.calculateSourceUrl(i,void 0,Math.max(l.width,l.height));StoryLog.StructuredTraceTag(596473348,Diag.ULSCat.msoulscat_Story_DocumentImport,Diag.ULSTraceLevel.info,"Info about image in focus pane.",{imageId:r.id,imageWidth:r.getWidth().toString(),imageHeight:r.getHeight().toString()}),this._imageSrc.getValue()!==c&&(this._imageMediaContent=i,TDB.applyUpdate(function(){t._imageSrc.setValue(c),t._imageModel.setValue(r)}))}else this.clearImage()}}},l.prototype.resetFocusImage=function(){var e=this;return this.applyUserActionToModelAndRefresh(function(){e.resetFocusRegionsInModel(),e.setCropStateToModel(o.ImageCropState.Auto)},"User clicked reset button"),ActionLogger.RecordClientAction(new ClientAction.FocusPaneUIFocusPointAction(ClientAction.ActionType.FocusPane_FocusPointsReset,0)),TDB.EventPropagation.Bypass},l.prototype.keepEntireImage=function(e){var t=this;return ActionLogger.RecordClientAction(new ClientAction.FocusPaneUIKeepEntireImageAction(ClientAction.ActionType.FocusPane_KeepEntireImageChecked,e)),this.applyUserActionToModelAndRefresh(function(){t.setCropStateToModel(e?o.ImageCropState.DoNotCrop:o.ImageCropState.ShouldCrop),t.resetFocusRegionsInModel()},"User clicked prevent cropping checkbox."),TDB.EventPropagation.Bypass},l.prototype.updateFocus=function(e){var t=this,o=this._view.focusPoints?this._view.focusPoints.length:0;switch(e){case TDB.UpdatePhase.WriteOnly:o||this._view.isEntered()&&this._view.escape();break;case TDB.UpdatePhase.ReadWrite:var i=0;if(!o)break;if(this.state===n.InsertFocusPoint)i=o-1;else{if(this._view.isFocused()||!this._view.isEntered()||this._view.getActiveChildIndex()<0)return;i=this._view.getActiveChildIndex()}i=Math.min(Math.max(i,0),o-1),this._view.focusPoints[i].setFocus(),this.state=n.Initial,platform.setImmediate(function(){TDB.applyUpdate(function(){t._focusPointMovingStatus.setValue(t.nextFocusPointMovingStatus)})})}},l.prototype.getModel=function(){return this._imageMediaContent},l.prototype.setView=function(e){this._view=e},l.prototype.wasCroppingPreviewRetrieved=function(){return this.croppingPreviewRetrieved},l._defaultFocusPointDiameter=75,l._minimumFocusPointDiameter=20,l._maximumFocusPointDiameterCoefficient=.8,l._minimumImageDimension=30,l}(Disposable);t.FocusImageViewModel=l}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=function(){function e(e,t){this._view=t,this._owner=e.parentViewModel,this.position=TDB.watchableTag(596473306,this,e.position),this.id=e.id}return e.prototype.getDescription=function(){return ResourceManager.ResolveString(Resources.FocusPaneFocusPointDescription,[this.id])},e.prototype.focusPointAttr=function(e){var t={};return t[Aria.Attributes.Label]=this.getDescription(),t[Aria.Attributes.Describedby]="focusPointAdditionalDescription",t[Aria.Attributes.Grabbed]=Aria.BooleanState.False,t},e.prototype.focusPointClicked=function(e){return this.deleteFocusPoint(ClientAction.ActionType.FocusPane_FocusPointDelete)},e.prototype.deleteKeyDown=function(e){return this._view.cancelMovement(),this.deleteFocusPoint(ClientAction.ActionType.FocusPane_FocusPointDelete_Keyboard)},e.prototype.deleteFocusPoint=function(e){if(this._view.isDragged)return this._view.isDragged=!1,TDB.EventPropagation.Bypass;var t=this._view.parent.focusPoints;return t&&t.removefirst(this._view)&&ActionLogger.RecordClientAction(new ClientAction.FocusPaneUIFocusPointAction(e,t.length)),this._owner.applyFocusPointChangesToModel(),this._view.dispose(),TDB.EventPropagation.Bypass},e.prototype.getFocusPointRectangle=function(){var e=new n.Rect,t=this.getDiameter(),o=this.position.getValue(),i=o.x,r=o.y;return e.setLeft(Math.floor(i-t/2)),e.setTop(Math.floor(r-t/2)),e.setRight(Math.floor(i+t/2)),e.setBottom(Math.floor(r+t/2)),e},e.prototype.scalePositionByFactor=function(e){var t=this;TDB.applyUpdate(function(){var n=t.position.getValue(),o=n.x/e,i=n.y/e;t.position.setValue({x:o,y:i})})},e.prototype.updatePosition=function(e){var t=this,n=this.ensurePositionBoundary(e);this._view.position=n,this._owner.nextFocusPointMovingStatus=this.updateMovingStatus(n),TDB.applyUpdate(function(){t.position.setValue(n)})},e.prototype.updateMovingStatus=function(e){var t=this.getPosition(),n=this.getImageSize(),o=this.getDiameter();if(!n||!o||!t)return"";var i=t.x,r=t.y,a=o/2,s="";return e.x>i?s=ResourceManager.ResolveString(Resources.FocusPaneFocusPointMovingRightStateDescription,[this.id]):e.x<i?s=ResourceManager.ResolveString(Resources.FocusPaneFocusPointMovingLeftStateDescription,[this.id]):e.y>r?s=ResourceManager.ResolveString(Resources.FocusPaneFocusPointMovingDownStateDescription,[this.id]):e.y<r&&(s=ResourceManager.ResolveString(Resources.FocusPaneFocusPointMovingUpStateDescription,[this.id])),e.x===a&&(s+=Resources.FocusPaneFocusPointCannotMoveFurtherLeftStateDescription),e.x===n.width-a&&(s+=Resources.FocusPaneFocusPointCannotMoveFurtherRightStateDescription),e.y===a&&(s+=Resources.FocusPaneFocusPointCannotMoveFurtherUpStateDescription),e.y===n.height-a&&(s+=Resources.FocusPaneFocusPointCannotMoveFurtherDownStateDescription),s},e.prototype.clearMovingStatus=function(){this._owner.clearFocusPointMovingStatus()},e.prototype.startMovingHandler=function(){this.clearMovingStatus(),this._owner.state=t.FocusImageState.MoveFocusPoint},e.prototype.stopMovingHandler=function(){this._owner.focusPointStopMovingHandler()},e.prototype.insertKeyDown=function(e){return this._view.cancelMovement(),this._owner.insertNewFocusPointAtImageCenter()?TDB.EventPropagation.Bubble:TDB.EventPropagation.PreventDefault},e.prototype.keyDownAction=function(e){return this.insertKeyDown(e)},e.prototype.moveToImageEdge=function(e){var t=this.getPosition();switch(e.keyCode){case KeyCodeType.UpArrowKey:t.y=0;break;case KeyCodeType.DownArrowKey:t.y=this.getImageSize().height;break;case KeyCodeType.LeftArrowKey:t.x=0;break;case KeyCodeType.RightArrowKey:t.x=this.getImageSize().width}return this._view.moveTo(t),TDB.EventPropagation.PreventDefault},e.prototype.ensurePositionBoundary=function(e){var t=e.x,n=e.y,o=this.getImageSize(),i=this.getDiameter();return o&&i&&(t=Math.min(t,o.width-i/2),n=Math.min(n,o.height-i/2)),i&&(t=Math.max(t,i/2),n=Math.max(n,i/2)),{x:t,y:n}},e.prototype.getDiameter=function(e){return this._owner.getCurrentDiameter(e)},e.prototype.getImageSize=function(e){return this._owner.getImageDimensions(e)},e.prototype.getPosition=function(e){return this.position.getWatchedValue(e)},e.movementTimerLifetime=1e3,e.longPressTimerLifetime=200,e}();t.FocusPointViewModel=o}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel,o=StoryApp.View.ViewElements,i=function(e){function t(t,i){var r=this,a={x:i.position.x,y:i.position.y,movementTime:n.FocusPointViewModel.movementTimerLifetime,accelerateTime:n.FocusPointViewModel.longPressTimerLifetime,defaultSpeed:1,direction:o.MovingDirection.All};return r=e.call(this,t,a)||this,r.viewModel=new n.FocusPointViewModel(i,r),r.isDragged=!1,r.focusPointStrokeWidth=1,r.focusPointStrokeOffset=3,r}return __extends(t,e),t.prototype.focusPointCircleAttrArgs=function(e){return this.viewModel.focusPointAttr(e)},t.prototype.focusPointCircleStyleArgs=function(e){var t=this.viewModel.getDiameter(e),n=this.viewModel.getImageSize(e);if(n){var o=StoryApp.Utilities.toPxStr(t),i=this.viewModel.getPosition(e),r=i.x,a=i.y;return r-=(n.width+t)/2,a-=t/2,{left:"calc(50% + "+r.toString()+"px)",top:StoryApp.Utilities.toPxStr(a),height:o,width:o}}},t.prototype.start=function(){this.viewModel.startMovingHandler()},t.prototype.stop=function(){this.viewModel.stopMovingHandler()},t.prototype.updatePosition=function(e){this.viewModel.updatePosition(e)},t.prototype.mouseClicked=function(e){return this.viewModel.focusPointClicked(e)},t.prototype.focusPointCircleDraggableInitArgs=function(){return this.commonDraggableArgs(void 0)},t.prototype.focusPointCircleDraggableOptionsArgs=function(e){var t,n,o,i=this.commonDraggableArgs(e);return t=i.cursorAt,n=i.helper,o=i.start,{cursorAt:t,helper:n,start:o}},t.prototype.focusPointCircleTouchToMouseArgs=function(e){return{enabled:!0}},t.prototype.commonDraggableArgs=function(e){var t=this,n={},o=this.viewModel.getDiameter(e)/2;return n.cursorAt={top:o,left:o},n.opacity=.35,n.revert=null,n.helper=function(){return $(this).clone()},n.start=function(n,o,i){var r=t.viewModel.getDiameter(e)/2;i.draggable("option","cursorAt",{left:r,top:r}),t.isDragged=!0,i.attr(Aria.Attributes.Grabbed,Aria.BooleanState.True),i.hide()},n.stop=function(n,o,i){TDB.applyUpdate(function(){var o=t.viewModel.getImageSize(),i=$(".FocusPaneImage").offset();if(i){var r=n.pageX-i.left,a=n.pageY-i.top,s=t.parent.focusPoints;if(r<0||r>o.width||a<0||a>o.height)s&&s.removefirst(t)&&ActionLogger.RecordClientAction(new ClientAction.FocusPaneUIFocusPointAction(ClientAction.ActionType.FocusPane_FocusPointDelete,s.length));else{var l=t.viewModel.getDiameter(e)/2;r=Math.min(Math.max(r,l),o.width-l),a=Math.min(Math.max(a,l),o.height-l),s&&ActionLogger.RecordClientAction(new ClientAction.FocusPaneUIFocusPointAction(ClientAction.ActionType.FocusPane_FocusPointDragDrop,s.length)),t.viewModel.position.setValue({x:r,y:a})}}}),i.attr(Aria.Attributes.Grabbed,Aria.BooleanState.False),t.parent.applyFocusPointChangesToModel(),t.isDragged=!1},n},t.prototype.firstChanceMouseEvent=function(t,n,o){return this.isDragged?TDB.EventPropagation.PreventDefault:e.prototype.firstChanceMouseEvent.call(this,t,n,o)},t.prototype.getFocusPointRectangle=function(){return this.viewModel.getFocusPointRectangle()},t.prototype.scalePositionByFactor=function(e){this.viewModel.scalePositionByFactor(e)},t.prototype.ensurePositionBoundary=function(e){return this.viewModel.ensurePositionBoundary(e)},t.prototype.keyDown=function(t){var n=TDB.EventPropagation.Bubble,o=!t.shiftKey&&!t.altKey&&t.ctrlKey,i=!(t.shiftKey||t.altKey||t.ctrlKey||t.metaKey);switch(t.keyCode){case KeyCodeType.DeleteKey:i&&(n=this.viewModel.deleteKeyDown(t));break;case KeyCodeType.InsertKey:i&&(n=this.viewModel.insertKeyDown(t));break;case KeyCodeType.AddKey:case KeyCodeType.EqualFFKey:case KeyCodeType.EqualKey:(i||t.shiftKey)&&(n=this.viewModel.insertKeyDown(t));break;case KeyCodeType.EnterKey:case KeyCodeType.SpaceKey:i&&(n=this.viewModel.keyDownAction(t));break;case KeyCodeType.UpArrowKey:case KeyCodeType.DownArrowKey:case KeyCodeType.LeftArrowKey:case KeyCodeType.RightArrowKey:o&&(this.startMoving(),n=this.viewModel.moveToImageEdge(t))}return n!==TDB.EventPropagation.Bubble?n:e.prototype.keyDown.call(this,t)},t}(o.MovableElement);t.FocusPointVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function t(e){this.args=e}return t.prototype.getType=function(){return this.args.type},t.prototype.getSeverity=function(){return this.args.severity},t.prototype.getVerifier=function(){return this.args.verifier},t.prototype.getModifier=function(){return this.args.modifier},t.prototype.defineVerifier=function(t){t&&(t.type=null!=t.type?t.type:this.args.type,t.severity=null!=t.severity?t.severity:this.args.severity,this.args.verifier=new e.AccessibilityIssueVerifier(t))},t.prototype.defineModifier=function(t){t&&(this.args.modifier=new e.AccessibilityIssueModifier(t))},t}();e.AccessibilityIssue=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(e){this.args=e}return e.prototype.executeVerification=function(){for(var e=this.args.generator.call(this.args.context),t=[],n=this.args.maxNumberOfResults,o=0;o<e.length&&!(null!=n&&n<=0);++o){var i=e[o];this.args.verifier.call(this.args.context,i)&&(t.push(i),--n)}return this.generateResult(t)},e.prototype.generateResult=function(e){return{type:this.args.type,severity:this.args.severity,issues:e}},e.prototype.singleVerification=function(e){return this.args.verifier.call(this.args.context,e)},e}();e.AccessibilityIssueVerifier=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=function(){function t(e){this.args=e}return t.prototype.executeModification=function(t){var n=this;try{e.Model.currentUndoManager().get(this.args.pageId).captureUserAction(function(){TDB.applyUpdate(function(){n.args.modifier.call(n.args.context,t)})},this.args.message)}catch(e){return StoryLog.TraceTag(596474015,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.warning,"Error in apply the change to model {0}",e),!1}return!0},t}();t.AccessibilityIssueModifier=n}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n,o=e.View.ViewElements,i=e.Model.SM,r=e.Model.AuthoringModel;!function(e){e[e.MissingAltText=0]="MissingAltText",e[e.InaccessibleChart=1]="InaccessibleChart",e[e.UnclearHyperlink=2]="UnclearHyperlink",e[e.DefaultAltText=3]="DefaultAltText",e[e.ReviewAllAltText=4]="ReviewAllAltText",e[e.ReviewAllHyperlink=5]="ReviewAllHyperlink",e[e.ReviewEmbed=6]="ReviewEmbed"}(n=t.AccessibilityIssueType||(t.AccessibilityIssueType={}));var a;!function(e){e[e.Error=0]="Error",e[e.Suggestion=1]="Suggestion",e[e.ReviewAll=2]="ReviewAll"}(a=t.AccessibilityIssueSeverity||(t.AccessibilityIssueSeverity={}));var s=function(e){function s(t,o){var i=e.call(this,t)||this;return i.supportedVerification=[n.MissingAltText,n.InaccessibleChart,n.UnclearHyperlink,n.DefaultAltText,n.ReviewAllAltText,n.ReviewAllHyperlink,n.ReviewEmbed],i.authoringPage=o.authoringPage,i.result=TDB.watchableTag(596474018,i,void 0),i.supportedIssues=void 0,i}return __extends(s,e),s.prototype.defineSupportedIssues=function(){this.supportedIssues=this.supportedIssues||{};for(var e=void 0,o=void 0,i=void 0,r=0;r<this.supportedVerification.length;++r){var l=this.supportedVerification[r];if(!this.supportedIssues[l]){var c=void 0;switch(l){case n.MissingAltText:e={type:n.MissingAltText,severity:a.Error},o={context:this,generator:this.getImageAccessibilityCheckerItems,verifier:this.verifyMissingAltText,maxNumberOfResults:s.maxNumberOfResults},i={context:this,modifier:this.modifyAltText,message:"User modified the alt text of an image to address Missing alt text issue.",pageId:this.authoringPage.getPageId()},c=new t.AccessibilityIssue(e);break;case n.DefaultAltText:e={type:n.DefaultAltText,severity:a.Suggestion},o={context:this,generator:this.getImageAccessibilityCheckerItems,verifier:this.verifyDefaultAltText,maxNumberOfResults:s.maxNumberOfResults},i={context:this,modifier:this.modifyAltText,message:"User modified the alt text of an image to address Default alt text issue.",pageId:this.authoringPage.getPageId()},c=new t.AccessibilityIssue(e);break;case n.ReviewAllAltText:e={type:n.ReviewAllAltText,severity:a.ReviewAll},o={context:this,generator:this.getImageAccessibilityCheckerItems,verifier:this.verifyReviewAllAltText,maxNumberOfResults:s.maxNumberOfResults},i={context:this,modifier:this.modifyAltText,message:"User modified the alt text of an image in Review all alt text.",pageId:this.authoringPage.getPageId()},c=new t.AccessibilityIssue(e);break;case n.UnclearHyperlink:e={type:n.UnclearHyperlink,severity:a.Suggestion},o={context:this,generator:this.getHyperlinkAccessibilityCheckerItems,verifier:this.verifyUnclearHyperlink,maxNumberOfResults:s.maxNumberOfResults},i={context:this,modifier:this.modifyHyperlink,message:"User modified the properties of a hyperlink to address Unclear hyperlink issue.",pageId:this.authoringPage.getPageId()},c=new t.AccessibilityIssue(e);break;case n.ReviewAllHyperlink:e={type:n.ReviewAllHyperlink,severity:a.ReviewAll},o={context:this,generator:this.getHyperlinkAccessibilityCheckerItems,verifier:this.verifyReviewAllHyperlink,maxNumberOfResults:s.maxNumberOfResults},i={context:this,modifier:this.modifyHyperlink,message:"User modified the properties of a hyperlink when review its accessibility.",pageId:this.authoringPage.getPageId()},c=new t.AccessibilityIssue(e);break;case n.InaccessibleChart:e={type:n.InaccessibleChart,severity:a.Error},o={context:this,generator:this.getExternalContentAccessibilityCheckerItems,verifier:this.verifyInaccessibleChart,maxNumberOfResults:s.maxNumberOfResults},i=void 0,c=new t.AccessibilityIssue(e);break;case n.ReviewEmbed:e={type:n.ReviewEmbed,severity:a.ReviewAll},o={context:this,generator:this.getExternalContentAccessibilityCheckerItems,verifier:this.verifyReviewEmbed,maxNumberOfResults:s.maxNumberOfResults},i=void 0,c=new t.AccessibilityIssue(e);break;default:TDB.raiseRecoverableError("Unsupported Accessibility checker issue type "+l+".")}c.defineVerifier(o),c.defineModifier(i),this.supportedIssues[l]=c}}},s.prototype.modifyAltText=function(e){if(null!=e.altText){var t=r.currentStoryController().get(this.authoringPage.getPageId()).createParagraphsWithText(e.altText);e.model.setDescription(t)}else e.model.setDescription(void 0)},s.prototype.modifyHyperlink=function(e){var t=e.paragraph.getContent();r.TextController.updateLinkInTextBlock(t,e.run,e.text,e.url)},s.prototype.getParagraphsFromCard=function(e){var t,n=e.getViewModel().getModel();return n instanceof i.TextGroup?t=n.children.getCollection().filter(function(e){return e instanceof i.Paragraph}):n instanceof i.TitleComposite?t=[n.getTitle()]:n instanceof i.MediaWithTextComposite&&(t=n.getText().children.getCollection().filter(function(e){return e instanceof i.Paragraph})),t||[]},s.prototype.getTextBlocksFromCard=function(e){return this.getParagraphsFromCard(e).map(function(e){return e.getContent()})},s.prototype.getLinkRunsFromParagraph=function(e){var t=e.getContent();return t?t.runs.getCollection().filter(function(e){return!!e.getUrl()}).map(function(t){return{paragraph:e,run:t}}):[]},s.prototype.getUserDefinedAltText=function(e,t){return r.MediaController.getUserDefinedAltText(e,t)},s.prototype.getDefaultAltTextFromMedia=function(e,t){return r.MediaController.getDefaultAltText(e,t)},s.prototype.getMediaCompositeFromCard=function(e){var t=e.getViewModel().getModel(),n=void 0;return t instanceof i.MediaWithTextComposite&&(n=t),n},s.prototype.getMediaFromModel=function(e){var t=void 0,n=void 0;if(e instanceof i.MediaWithTextComposite){if(n=e,(t=n.getMedia())instanceof i.ImageContent||t instanceof i.VideoContent)return t}else if(e instanceof i.ImageContent)return e},s.prototype.getCardList=function(e){var t=this.authoringPage.cardDeckVE;return t?t.getFlattenedCardList(void 0,void 0,function(t){return!e||t.supportsAltText()}):[]},s.prototype.getExternalContentAccessibilityCheckerItems=function(){return this.getCardList().map(function(e){return{card:e}})},s.prototype.getImageAccessibilityCheckerItems=function(){var e=this;return this.getCardList(!0).map(function(t){return{model:e.getMediaCompositeFromCard(t)}})},s.prototype.getHyperlinkAccessibilityCheckerItems=function(){var e=this;return this.getCardList().mapmany(function(t){return e.getParagraphsFromCard(t)}).mapmany(function(t){return e.getLinkRunsFromParagraph(t)})},s.prototype.verifyDefaultAltText=function(e){var t=this.getMediaFromModel(e.model);return!!this.getDefaultAltTextFromMedia(t)&&null==(null==e.altText?this.getUserDefinedAltText(e.model):e.altText)},s.prototype.verifyMissingAltText=function(e){if(null==(e.altText||this.getUserDefinedAltText(e.model))){var t=this.getMediaFromModel(e.model);return!this.getDefaultAltTextFromMedia(t)}return!1},s.prototype.verifyReviewAllAltText=function(e){return!!this.getMediaFromModel(e.model)},s.prototype.verifyUnclearHyperlink=function(e){if(!e.paragraph||!e.run)return!1;var t,n=e.run,o=e.url||n.getUrl();if(!o)return!1;o.indexOf("//")>-1&&(t=o.slice(o.indexOf("//")+2));var i=e.paragraph.getContent(),r=i?i.getText():"",a=e.text||r.substr(n.getIndex(),n.getLength());return o===a||t===a},s.prototype.verifyReviewAllHyperlink=function(e){if(!e.paragraph||!e.run)return!1;var t=e.run;return!(!e.url&&!t.getUrl())},s.prototype.verifyInaccessibleChart=function(e){return!!e.card&&e.card instanceof o.AgaveCardVE},s.prototype.verifyReviewEmbed=function(e){return!!e.card&&e.card instanceof o.EmbedCardVE},s.prototype.executeVerification=function(){var e=this;this.defineSupportedIssues();for(var t={},n=0;n<this.supportedVerification.length;++n){var o=this.supportedVerification[n];this.supportedIssues[o]&&(t[o]=this.supportedIssues[o].getVerifier().executeVerification())}TDB.applyUpdate(function(){e.result.setValue(t)})},s.prototype.getResults=function(e){return this.result.getWatchedValue(e)},s.prototype.getResultsAsList=function(e){var t=this.result.getWatchedValue(e);if(t){for(var n=[],o=0;o<this.supportedVerification.length;++o){var i=this.supportedVerification[o];this.supportedIssues[i]&&n.push(t[i])}return n}},s.prototype.getResult=function(e,t){var n=this.result.getWatchedValue(t);if(n&&n[e]&&ArrayExtensions.contains(this.supportedVerification,e))return n[e]},s.prototype.getSupportedIssues=function(){return this.supportedIssues},s.prototype.getSupportedIssueTypes=function(){return this.supportedVerification},s.decorativeImageAltText="",s.maxNumberOfResults=99,s}(Disposable);t.AccessibilityChecker=s}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(e){function n(t,n){var o=e.call(this,t)||this;return o.args=n,o}return __extends(n,e),n.prototype.subPaneHeadingTextArgs=function(e){return this.args.subHeading},n.prototype.backButtonArgs=function(){var e={buttonId:ClientAction.ButtonId.AccessibilityCheckerPane_BackToSummaryButton,click:this.args.backButtonClickHandler,context:this.args.context,cssClass:{value:"AccessibilityCheckerPaneBackButton"},description:{value:Resources.AccessibilityCheckerBackToListButtonDescription},tooltip:{value:Resources.AccessibilityCheckerBackToListButtonDescription},fontIconName:{value:FontIcons.LeftArrowGreyIcon},fontIconSizeClass:FontIcons.LeftArrowGreyIconSize};return new TDB.ChildArgs(t.GlyphButtonVE,e)},n}(TDB.FocusableViewElement);e.SubPaneHeaderVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n,o=StoryApp.View.ViewElements,i=e.View.ViewModel,r=function(e){function t(n,o){var i=this,r={buttonId:t.issueTelemetryId[o.issueType],enabled:{value:o.numberOfIssues>0},cssClass:{value:o.numberOfIssues>0?"IssuesStatusButtonWrapper TransparentButton":"IssuesStatusButtonWrapper"},role:o.numberOfIssues>0?Aria.Roles.Button:Aria.Roles.Presentation,description:{value:o.description},tooltip:{value:o.tooltip}};return i=e.call(this,n,r)||this,i.args=o,i}return __extends(t,e),t.prototype.wrapperClassNameArgs=function(e){return this.getButtonClass(e)},t.prototype.wrapperAttrArgs=function(e){return this.getButtonAttributes(e,{id:this.id})},t.prototype.numberIndicatorWrapperClassNameArgs=function(e){return this.args.severity===i.AccessibilityIssueSeverity.Error?t.seriousIssueNumberWrapperClassName:t.normalNumberIWrapperClassName},t.prototype.numberOfIssuesTextArgs=function(e){return this.args.numberOfIssues.toString()},t.prototype.issueLabelTextArgs=function(e){return this.args.label},t.prototype.ifContainIssuesArgs=function(){return this.args.numberOfIssues>0},t.prototype.noIssueCheckmarkArgs=function(){return new TDB.ChildArgs(o.FontIconVE,{fontIconName:{value:FontIcons.NoIssueCheckmarkIcon},fontIconSizeClass:FontIcons.NoIssueCheckmarkIconSize,fontIconWrapperClass:{value:"IssueCheckmarkWrapper"}})},t.prototype.browseIssuesIconArgs=function(){if(0!==this.args.numberOfIssues)return new TDB.ChildArgs(o.FontIconVE,{fontIconName:{value:FontIcons.BrowseIssuesIcon},fontIconSizeClass:FontIcons.BrowseIssuesIconSize,fontIconWrapperClass:{value:"BrowseIssuesIconWrapper"}})},t.prototype.onAction=function(e){return this.args.context&&this.args.click?this.args.click.call(this.args.context,e,this.args.issueType):TDB.EventPropagation.Bypass},t.seriousIssueNumberWrapperClassName="BlackBadge",t.normalNumberIWrapperClassName="GreyBadge",t.issueTelemetryId=(n={},n[i.AccessibilityIssueType.MissingAltText]=ClientAction.ButtonId.AccessibilityCheckerPane_MissingAltTextIssueButton,n[i.AccessibilityIssueType.DefaultAltText]=ClientAction.ButtonId.AccessibilityCheckerPane_DefaultAltTextIssueButton,n[i.AccessibilityIssueType.ReviewAllAltText]=ClientAction.ButtonId.AccessibilityCheckerPane_ReviewAllAltTextIssueButton,n[i.AccessibilityIssueType.UnclearHyperlink]=ClientAction.ButtonId.AccessibilityCheckerPane_UnclearHyperlinkIssueButton,n[i.AccessibilityIssueType.ReviewAllHyperlink]=ClientAction.ButtonId.AccessibilityCheckerPane_ReviewAllHyperlinkIssueButton,n[i.AccessibilityIssueType.ReviewEmbed]=ClientAction.ButtonId.AccessibilityCheckerPane_ReviewEmbedIssueButton,n[i.AccessibilityIssueType.InaccessibleChart]=ClientAction.ButtonId.AccessibilityCheckerPane_InaccessibleChartIssueButton,n),t}(o.ButtonVE);t.IssuesStatusButtonVEBase=r}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.View.ViewModel,i=function(e){function i(t,n){var i=e.call(this,t)||this;return i.parent=t,i.viewModel=new o.AccessibilityIssueModifierBaseViewModel(i,i,n),i}return __extends(i,e),i.prototype.subPaneHeaderArgs=function(){var e={subHeading:this.viewModel.getHeadingTitle(),backButtonClickHandler:this.backToSummaryButtonClickHandler,context:this};return new TDB.ChildArgs(t.SubPaneHeaderVE,e)},i.prototype.backToSummaryButtonClickHandler=function(e){return this.parent.showAccessibilityCheckerResultSummary(),TDB.EventPropagation.Bypass},i.prototype.ifShowIssueModifyingContentArgs=function(){return this.viewModel.showIssueModifyingContent()},i.prototype.contentDeletedMessageArgs=function(e){if(!this.viewModel.isValidContent(e)){var t={message:Resources.AccessibilityCheckerDeletedContentMessageLabel,messageCss:"DeletedContentMessageLabel"};return new TDB.ChildArgs(n.SpanMessageVE,t)}},i.prototype.previousIssueButtonClickHandler=function(e){return this.viewModel.previousIssueButtonClickHandler(e)},i.prototype.nextIssueButtonClickHandler=function(e){return this.viewModel.nextIssueButtonClickHandler(e)},i.prototype.doneButtonClickHandler=function(e){return this.parent.showAccessibilityCheckerResultSummary(),TDB.EventPropagation.Bypass},i.prototype.nextIssueButtonArgs=function(e){if(this.viewModel.isLastIssue(e)){var t={buttonId:ClientAction.ButtonId.AccessibilityCheckerPane_DoneButton,click:this.doneButtonClickHandler,context:this,cssClass:{compute:new TDB.ComputedOptionArgs(this.viewModel,this.viewModel.getDoneButtonStyle)},text:{value:Resources.AccessibilityCheckerDone}};return new TDB.ChildArgs(n.TextButtonVE,t)}var o={buttonId:ClientAction.ButtonId.AccessibilityCheckerPane_NextIssueButton,click:this.nextIssueButtonClickHandler,context:this,cssClass:{compute:new TDB.ComputedOptionArgs(this.viewModel,this.viewModel.getNextButtonStyle)},description:{value:Resources.AccessibilityCheckerNextButtonDescription},fontIconName:{value:FontIcons.NextIssueIcon},fontIconSizeClass:FontIcons.NextIssueIconSize};return new TDB.ChildArgs(n.GlyphButtonVE,o)},i.prototype.previousIssueButtonArgs=function(e){var t=!this.viewModel.isFirstIssue(e),o={buttonId:ClientAction.ButtonId.AccessibilityCheckerPane_PreviousIssueButton,click:this.previousIssueButtonClickHandler,context:this,enabled:{value:t},cssClass:{value:"NeutralButton AccessibilityCheckerNavigationButton"},description:{value:Resources.AccessibilityCheckerPreviousButtonDescription},tooltip:{value:Resources.AccessibilityCheckerPreviousButtonDescription},fontIconName:{value:FontIcons.PreviousIssueIcon},fontIconSizeClass:FontIcons.PreviousIssueIconSize};return new TDB.ChildArgs(n.GlyphButtonVE,o)},i.prototype.navigationStatusLabelTextArgs=function(e){return this.viewModel.getCurrentNavigationStatus(e)},i}(TDB.FocusableViewElement);t.AccessibilityIssueModifierBaseVE=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(t){function n(e,n,o){var i=t.call(this,e)||this;return i.view=n,i.issueType=o.issueType,i.checkerResult=o.accessibilityChecker.getResult(i.issueType),i.currentIssueIndex=TDB.watchableTag(596474014,i,o.currentIssueIndex),i.accessibilityChecker=o.accessibilityChecker,i}return __extends(n,t),n.prototype.getHeadingTitle=function(){switch(this.issueType){case e.AccessibilityIssueType.MissingAltText:return Resources.AccessibilityCheckerMissingAltText;case e.AccessibilityIssueType.DefaultAltText:return Resources.AccessibilityCheckerReviewDefaultAltText;case e.AccessibilityIssueType.UnclearHyperlink:return Resources.AccessibilityCheckerReviewUnclearHyperlink;case e.AccessibilityIssueType.ReviewAllHyperlink:return Resources.AccessibilityCheckerReviewAllHyperlink;case e.AccessibilityIssueType.ReviewAllAltText:return Resources.AccessibilityCheckerReviewAllAltText;case e.AccessibilityIssueType.InaccessibleChart:return Resources.AccessibilityCheckerChartsArentAccessible;case e.AccessibilityIssueType.ReviewEmbed:return Resources.AccessibilityCheckerReviewEmbed;default:TDB.raiseRecoverableError("Unsupported Accessibility checker issue type "+this.issueType+".")}return""},n.prototype.getCurrentIssueIndex=function(e){return this.currentIssueIndex.getWatchedValue(e)},n.prototype.getCurrentIssueByIndex=function(e){if(this.checkerResult)return this.checkerResult.issues[e]},n.prototype.getCheckerResult=function(){return this.checkerResult},n.prototype.getCurrentIssue=function(e){var t=this.getCurrentIssueIndex(e);return this.getCurrentIssueByIndex(t)},n.prototype.isCurrentIssueResolved=function(e){return!1},n.prototype.verifiyItem=function(e){return!this.accessibilityChecker.getSupportedIssues()[this.issueType].getVerifier().singleVerification(e)},n.prototype.updateUserChangeToStoryModel=function(){throw StoryApp.RethrowLogger.createError("Method not implemented by subclass.")},n.prototype.getCurrentNavigationStatus=function(e){var t=this.getCurrentIssueIndex(e)+1,n=this.totalNumberOfIssues();return ResourceManager.ResolveString(Resources.AccessibilityCheckerIssueCurrentOfTotal,[t,n])},n.prototype.previousIssueButtonClickHandler=function(e){var t=this;if(!this.checkerResult)return TDB.EventPropagation.Bubble;var n=Math.max(this.getCurrentIssueIndex()-1,0);return TDB.applyUpdate(function(){return t.currentIssueIndex.setValue(n)}),TDB.EventPropagation.Bypass},n.prototype.nextIssueButtonClickHandler=function(e){var t=this;if(!this.checkerResult)return TDB.EventPropagation.Bubble;var n=Math.min(this.getCurrentIssueIndex()+1,this.totalNumberOfIssues()-1);return TDB.applyUpdate(function(){return t.currentIssueIndex.setValue(n)}),TDB.EventPropagation.Bypass},n.prototype.showIssueModifyingContent=function(){return this.checkerResult&&this.totalNumberOfIssues()>0},n.prototype.isValidContent=function(e){return!1},n.prototype.isLastIssue=function(e){return this.getCurrentIssueIndex(e)+1===this.totalNumberOfIssues()},n.prototype.isFirstIssue=function(e){return 0===this.getCurrentIssueIndex(e)},n.prototype.totalNumberOfIssues=function(){return this.checkerResult.issues?this.checkerResult.issues.length:0},n.prototype.getNextButtonStyle=function(e){return"AccessibilityCheckerNavigationButton "+(this.isCurrentIssueResolved(e)?n.resolvedIssueNavigationButtonStyle:n.unresolvedIssueNavigationButtonStyle)},n.prototype.getDoneButtonStyle=function(e){return"AccessibilityCheckerDoneButton "+(this.isCurrentIssueResolved(e)?n.resolvedIssueNavigationButtonStyle:n.unresolvedIssueNavigationButtonStyle)},n.resolvedIssueNavigationButtonStyle="EmphasisButton",n.unresolvedIssueNavigationButtonStyle="NeutralButton",n}(Disposable);e.AccessibilityIssueModifierBaseViewModel=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.View.ViewModel,i=function(e){function i(t,n){var i=e.call(this,t,n)||this;return i.viewModel=new o.EditImageAltTextViewModel(i,i,n),i}return __extends(i,e),i.prototype.imageVisualizatorArgs=function(){return new TDB.ChildArgs(t.ImageVisualizatorVE,this.viewModel.createImageVisualizator())},i.prototype.altTextTextAreaLabelTextArgs=function(e){return Resources.AccessibilityCheckerMissingAltTextTextBoxLabel},i.prototype.altTextEditorArgs=function(){return new TDB.ChildArgs(t.TextUnitEditorVE,this.viewModel.createAltTextEditor("TextDropTargetActive","calibriRegular"))},i.prototype.decorativeImageCheckboxArgs=function(){var e=ResourceManager.resolveWithChildArgs(Resources.AccessibilityCheckerDecorativeImageCheckboxLabel,[]),t=TDB.watcherTag(596474013,this.viewModel,this,this.viewModel.isDecorativeImage),o={buttonId:ClientAction.ButtonId.AccessibilityCheckerPane_DecorativeImageCheckbox,context:this,checkedWatchable:t,click:this.decorativeImageCheckboxClicked,cssClass:{value:"DecorativeImageCheckbox"},checkedIconWrapperClass:{value:"DecorativeImageCheckboxChecked"},uncheckedIconWrapperClass:{value:"DecorativeImageCheckboxUnchecked"},messagePartsWrapperClass:"DecorativeImageCheckboxMessageWrapper",fontIconName:{value:FontIcons.CheckboxFontIcon},fontIconSize:FontIcons.CheckboxFontIconSize,richTextElementsUnchecked:e,richTextElementsChecked:e};return new TDB.ChildArgs(n.RichCheckboxVE,o)},i.prototype.decorativeImageCheckboxClicked=function(e){var t=this.viewModel.isDecorativeImage();return this.viewModel.decorativeImageClickHandler(t)},i}(t.AccessibilityIssueModifierBaseVE);t.EditImageAltTextVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=function(o){function i(e,t,n){var i=o.call(this,e,t,n)||this;return i.args=n,i.imageSrc=TDB.watcherTag(596474012,i,i,i.getImageSrc),i}return __extends(i,o),i.prototype.createImageVisualizator=function(){return{showImage:{compute:new TDB.ComputedOptionArgs(this,this.showPreviewImage)},imageSource:{watchable:this.imageSrc},imageContentClass:"EditImageAltTextPreviewImageContent",imageClass:"EditImageAltTextPreviewImage",loadingMessageContainerClassName:"AccessibilityCheckerLoadingMessage"}},i.prototype.showPreviewImage=function(e){return!!this.getCurrentImageMedia(e)},i.prototype.getCurrentImageModel=function(e){var t=this.getCurrentIssue(e);if(t)return n.StoryController.isModelObjectValid(t.model)?t.model:void 0},i.prototype.getCurrentImageMedia=function(e){var t=this.getCurrentImageModel(e);return t?t.getMedia(e):void 0},i.prototype.getImagePart=function(e){var t=this.getCurrentImageMedia(e);return n.ImageController.calculateImagePart(t,e)},i.prototype.getImageSrc=function(e){var t=this.getCurrentImageMedia(e);if(t&&this.getImagePart(e)){var o=this.calculateImageQuality(e);return n.ImageController.calculateSourceUrl(t,e,o)}},i.prototype.calculateImageSize=function(e){var t=this.getImageAreaSize(),o=this.getCurrentImageMedia(e),i=n.ImageController.getMediaSize(o,e);if(i){var r=0!==i.width?t.width/i.width:1,a=i.height*r;a>t.height&&(r=0!==i.height?t.height/i.height:1),r=Math.min(r,1),a=i.height*r;var s=i.width*r;return new Size(s,a)}},i.prototype.getImageAreaSize=function(){var e=$(".AddContentPane").width()-64,t=Math.max(e/i.aspectRatio,238);return new Size(e,t)},i.prototype.calculateImageQuality=function(e){var t=this.calculateImageSize(e);return t?Math.floor(Math.max(t.width,t.height)):void 0},i.prototype.updateUserChangeToStoryModel=function(e){if(null!=e){var t=this.accessibilityChecker.getSupportedIssues()[this.issueType],n=this.getCurrentIssue();n&&(n.altText=e,t.getModifier().executeModification(n))}},i.prototype.isCurrentIssueResolved=function(e){var t=this.getCurrentImageModel(e);if(!t)return!1;var o={model:t,altText:n.MediaController.getUserDefinedAltText(t,e)};return this.verifiyItem(o)},i.prototype.isValidContent=function(e){return!!this.getCurrentImageModel(e)},i.prototype.getCurrentUserDefinedAltText=function(e){var t=this.getCurrentImageModel(e);return t?n.MediaController.getUserDefinedAltText(t,e):void 0},i.prototype.getDefaultAltText=function(e){var t=this.getCurrentImageMedia(e);return n.MediaController.getDefaultAltText(t,e)},i.prototype.calculateDecorativeImageValue=function(e){return this.getCurrentUserDefinedAltText(e)===t.AccessibilityChecker.decorativeImageAltText},i.prototype.calculateTextAreaEnabledValue=function(e){return!this.calculateDecorativeImageValue(e)},i.prototype.getAltTextModel=function(e){var t=this.getCurrentImageModel(e);return n.MediaController.getAltTextModel(t,e)},i.prototype.setAltText=function(e){var t=this.getCurrentImageModel();n.MediaController.setAltText(t,e,this.view.getPageId())},i.prototype.getAltText=function(e){var t=this.getCurrentImageModel(e);return n.MediaController.getAltText(t,e)},i.prototype.createAltTextEditor=function(e,n){var o=Resources.AccessibilityCheckerMissingAltTextTextBoxPlaceholder;return{viewModel:new t.TextUnitEditorViewModel({textModel:void 0,getTextModel:this.getAltTextModel,getTextContent:this.getAltText,setTextContent:this.setAltText,getTextFieldDisabled:this.getTextFieldDisabled,textHandlerContext:this,card:void 0,pageId:this.view.getPageId(),cardSelectionManager:void 0,textAggregator:void 0,fileUploader:void 0,cardDefinitionManager:void 0,cardsContainer:void 0,onCanvas:void 0}),placeholder:o,css:"EditImageAltTextTextArea calibriRegular TextGroupVE textMedium",telemetryId:ClientAction.ButtonId.AccessibilityCheckerPane_ImageAltTextTextArea,resourceFactory:this.args.resourceFactory}},i.prototype.isDecorativeImage=function(e){var t=this.getCurrentImageModel(e);return!!t&&t.getIsDecorative(e)},i.prototype.decorativeImageClickHandler=function(t){var n=this.getCurrentImageModel();return e.Model.currentUndoManager().get(this.view.getPageId()).captureUserAction(function(){TDB.applyUpdate(function(){n.setIsDecorative(!t)})},"Set decorative image flag: "+!t),TDB.EventPropagation.Bypass},i.prototype.getTextFieldDisabled=function(e){return!this.isDecorativeImage(e)},i.aspectRatio=1.5,i}(t.AccessibilityIssueModifierBaseViewModel);t.EditImageAltTextViewModel=o}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel,o=StoryApp.View.ViewElements,i=function(e){function t(t,o){var i=e.call(this,t,o)||this;return i.viewModel=new n.EditHyperlinkViewModel(i,i,o),i}return __extends(t,e),t.prototype.displayTextTextBoxLabelTextArgs=function(e){return Resources.TextLinkDialogDisplayTextBoxLabel},t.prototype.linkTextBoxLabelTextArgs=function(e){return Resources.TextLinkDialogLinkTextBoxLabel},t.prototype.displayTextTextBoxLabelAttrArgs=function(e){return{id:t.displayTextLabelId}},t.prototype.linkTextBoxLabelAttrArgs=function(e){return{id:t.webLinkLabelId}},t.prototype.displayTextBoxArgs=function(){var e={context:this.viewModel,setValue:this.viewModel.setDisplayText,getValue:this.viewModel.getDisplayText,cssClass:"HyperlinkInputBox",labelledBy:t.displayTextLabelId};return new TDB.ChildArgs(o.TextBoxVE,e)},t.prototype.linkTextBoxArgs=function(){var e={context:this.viewModel,setValue:this.viewModel.setUrl,getValue:this.viewModel.getUrl,cssClass:"HyperlinkInputBox",inputType:"url",labelledBy:t.webLinkLabelId};return new TDB.ChildArgs(o.TextBoxVE,e)},t.prototype.getDisplayTextBox=function(){return this.displayTextBox},t.prototype.getLinkTextBox=function(){return this.linkTextBox},t.displayTextLabelId="editHyperlinkDisplayTextLabel",t.webLinkLabelId="editHyperlinkWebLinkLabel",t}(t.AccessibilityIssueModifierBaseVE);t.EditHyperlinkVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=function(e){function o(t,n,o){return e.call(this,t,n,o)||this}return __extends(o,e),o.prototype.getDisplayText=function(e){this.updateLinkRun();var t=this.getCurrentIssue(e);if(t&&n.StoryController.isModelObjectValid(t.paragraph)){var o=t.paragraph.getContent(e);return n.TextController.getTextOfRun(o,t.run)}return""},o.prototype.getUrl=function(e){this.updateLinkRun();var t=this.getCurrentIssue(e);return t&&n.StoryController.isModelObjectValid(t.paragraph)&&t.run?t.run.getUrl(e):""},o.prototype.isValidContent=function(e){var t=this.getCurrentIssue(e);return t&&n.StoryController.isModelObjectValid(t.paragraph)},o.prototype.setDisplayText=function(e){this.updateUserChangeToStoryModel(e,void 0)},o.prototype.setUrl=function(e){this.updateUserChangeToStoryModel(void 0,e)},o.prototype.updateLinkRun=function(e){var t=this.getCurrentIssue(e);if(t&&n.StoryController.isModelObjectValid(t.paragraph)&&t.run){var o=t.run,i=t.paragraph.getContent().runs.getCollection();if(i&&i.length>0)for(var r=0;r<i.length;r++){var a=i[r];if(a.getUrl()&&a.getIndex()===o.getIndex())return void(t.run=a)}t.run=void 0}},o.prototype.updateUserChangeToStoryModel=function(e,n){var o=e||this.view.getDisplayTextBox().getText(),i=n||this.view.getLinkTextBox().getText();if(t.LinkUtilities.validateUrl(i)){i=t.LinkUtilities.checkAndUpdateUrl(i);var r=this.accessibilityChecker.getSupportedIssues()[this.issueType],a=this.getCurrentIssue();a.url=i,a.text=o,r.getModifier().executeModification(a)}},o.prototype.isCurrentIssueResolved=function(e){var o=this.getCurrentIssue(e);if(!o||!n.StoryController.isModelObjectValid(o.paragraph))return!1;var i=this.getDisplayText(e),r=this.getUrl(e);r=t.LinkUtilities.checkAndUpdateUrl(r);var a={paragraph:o.paragraph,run:o.run,url:r,text:i};return this.verifiyItem(a)},o}(t.AccessibilityIssueModifierBaseViewModel);t.EditHyperlinkViewModel=o}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel,o=function(e){function t(t,o){var i=e.call(this,t,o)||this;return i.introText=o.introText,i.viewModel=new n.EditExternalContentViewModel(i,i,o),i}return __extends(t,e),t.prototype.introTextArgs=function(e){return this.introText},t.prototype.scrollCurrentIssueIntoView=function(){this.viewModel.scrollCurrentIssueIntoView()},t}(t.AccessibilityIssueModifierBaseVE);t.EditExternalContentVEBase=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=function(e){function t(t,n,o){return e.call(this,t,n,o)||this}return __extends(t,e),t.prototype.scrollCurrentIssueIntoView=function(){if(this.isValidContent()){var e=this.getCurrentIssue().card;e&&(e.ensureVisible(),e.scrollIntoView(),e.activateItem(!0))}},t.prototype.isValidContent=function(e){var t=this.getCurrentIssue(e);if(!t)return!1;var o=t.card,i=o?o.getViewModel().getModel():void 0;return!!n.StoryController.isModelObjectValid(i)},t.prototype.previousIssueButtonClickHandler=function(t){return e.prototype.previousIssueButtonClickHandler.call(this,t),this.scrollCurrentIssueIntoView(),TDB.EventPropagation.Bypass},t.prototype.nextIssueButtonClickHandler=function(t){return e.prototype.nextIssueButtonClickHandler.call(this,t),this.scrollCurrentIssueIntoView(),TDB.EventPropagation.Bypass},t}(t.AccessibilityIssueModifierBaseViewModel);t.EditExternalContentViewModel=o}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=function(n){function o(e,t){var o=n.call(this,e)||this;return o.args=t,o}return __extends(o,n),o.prototype.sectionTitleTextArgs=function(e){return this.args.title},o.prototype.listIssueButtonsArgs=function(){var n={itemArgs:this.args.issueStatusButtonArgs.map(function(n){return{contentArgs:n,contentType:e.IssuesStatusButtonVE,htmlTag:t.ListItemHTMLTag.LI}}),description:this.args.title,className:"AccessibilityCheckerResultSummaryGroupList",htmlTag:t.ListHTMLTag.DIV};return new TDB.ChildArgs(t.ListVE,n)},o}(TDB.FocusableViewElement);e.AccessibilityCheckerResultsGroupVEBase=n}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.View.ViewModel,i=function(e){function i(t,n){var i=e.call(this,t)||this;return i.parent=t,i.viewModel=new o.AccessibilityCheckerSummaryViewModel(i,i,n),i}return __extends(i,e),i.prototype.issuesGroupArgs=function(e){var n=this.viewModel.getGroupArgsModel(e,o.AccessibilityIssueSeverity.Error,Resources.AccessibilityCheckerIssues);if(n)return new TDB.ChildArgs(t.AccessibilityCheckerResultsGroupVE,n)},i.prototype.improvementsGroupArgs=function(e){var n=this.viewModel.getGroupArgsModel(e,o.AccessibilityIssueSeverity.Suggestion,Resources.AccessibilityCheckerImprovements);if(n)return new TDB.ChildArgs(t.AccessibilityCheckerResultsGroupVE,n)},i.prototype.reviewAllGroupArgs=function(e){var n=this.viewModel.getGroupArgsModel(e,o.AccessibilityIssueSeverity.ReviewAll,Resources.AccessibilityCheckerReviewAll);if(n)return new TDB.ChildArgs(t.AccessibilityCheckerResultsGroupVE,n)},i.prototype.ifShowNoIssuesTextArgs=function(e){return this.viewModel.hasNoIssues(e)},i.prototype.noIssueIntroTextArgs=function(e){return Resources.AccessibilityCheckerAllGoodIntroLabel},i.prototype.tipsLinkArgs=function(){var e={url:StoryApp.Common.UrlHelper.accessibilityTipsUrl,message:Resources.AccessibilityCheckerAccessibleTips};return new TDB.ChildArgs(n.ClickableLinkVE,e)},i}(TDB.FocusableViewElement);t.AccessibilityCheckerSummaryVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(t){function n(e,n,o){var i=t.call(this,e)||this;return i.view=n,i.accessibilityChecker=o.accessibilityChecker,i}return __extends(n,t),n.prototype.getGroupArgsModel=function(e,t,n){var o=this.getCheckerResultsAsList(e);if(o){o=o.filter(function(e){return e.severity===t});for(var i=[],r=0;r<o.length;++r){var a=o[r],s=a.issues?a.issues.length:0;if(s>0){var l={context:this,click:s>0?this.openIssueModificationSubPane:void 0,issueType:a.type,severity:a.severity,numberOfIssues:s,label:this.getIssueButtonLabel(a.type,s),description:this.getIssuesButtonDescription(a.type,s),tooltip:this.getIssuesButtonDescription(a.type,s)};i.push(l)}}if(0!==i.length)return{title:n,issueStatusButtonArgs:i}}},n.prototype.hasNoIssues=function(e){for(var t=0,n=this.accessibilityChecker.getSupportedIssueTypes();t<n.length;t++){var o=n[t],i=this.accessibilityChecker.getResult(o,e);if(i&&i.issues&&i.issues.length>0)return!1}return!0},n.prototype.openIssueModificationSubPane=function(t,n){var o=e.AccessibilityCheckerPaneViewState.Summary;switch(n){case e.AccessibilityIssueType.DefaultAltText:case e.AccessibilityIssueType.MissingAltText:case e.AccessibilityIssueType.ReviewAllAltText:o=e.AccessibilityCheckerPaneViewState.EditImageAltText;break;case e.AccessibilityIssueType.ReviewAllHyperlink:case e.AccessibilityIssueType.UnclearHyperlink:o=e.AccessibilityCheckerPaneViewState.EditHyperlink;break;case e.AccessibilityIssueType.InaccessibleChart:case e.AccessibilityIssueType.ReviewEmbed:o=e.AccessibilityCheckerPaneViewState.EditExternalContent;break;default:TDB.raiseRecoverableError("Unsupported Accessibility checker issue type "+n+".")}return this.view.parent.getViewModel().setIssueType(n),this.view.parent.getViewModel().transitionTo(o),this.needToScrollFirstIssueIntoView(n)&&this.view.parent.getViewModel().scrollCurrentIssueIntoView(),!1},n.prototype.needToScrollFirstIssueIntoView=function(t){return t===e.AccessibilityIssueType.InaccessibleChart||t===e.AccessibilityIssueType.ReviewEmbed},n.prototype.getCheckerResultsAsList=function(e){return this.accessibilityChecker.getResultsAsList(e)},n.prototype.getIssueButtonLabel=function(t,n){var o,i=n>0?1:0;switch(t){case e.AccessibilityIssueType.MissingAltText:o=[Resources.AccessibilityCheckerNoMissingAltText,Resources.AccessibilityCheckerMissingAltText];break;case e.AccessibilityIssueType.DefaultAltText:o=["",Resources.AccessibilityCheckerReviewDefaultAltTextButtonLabel];break;case e.AccessibilityIssueType.UnclearHyperlink:o=[Resources.AccessibilityCheckerNoUnclearHyperlink,Resources.AccessibilityCheckerReviewUnclearHyperlinkButtonLabel];break;case e.AccessibilityIssueType.ReviewAllHyperlink:o=["",Resources.AccessibilityCheckerReviewAllHyperlinkButtonLabel];break;case e.AccessibilityIssueType.ReviewAllAltText:o=["",Resources.AccessibilityCheckerReviewAllAltTextButtonLabel];break;case e.AccessibilityIssueType.InaccessibleChart:o=["",Resources.AccessibilityCheckerChartsArentAccessible];break;case e.AccessibilityIssueType.ReviewEmbed:o=["",Resources.AccessibilityCheckerReviewEmbedButtonLabel];break;default:TDB.raiseRecoverableError("Unsupported Accessibility checker issue type "+t+".")}return o[i]},n.prototype.getIssuesButtonDescription=function(t,n){var o,i=Math.max(Math.min(n,2),0);switch(t){case e.AccessibilityIssueType.MissingAltText:o=[Resources.AccessibilityCheckerNoMissingAltText,Resources.AccessibilityCheckerMissingAltTextSingleButtonDescription,ResourceManager.ResolveString(Resources.AccessibilityCheckerMissingAltTextMultipleButtonDescription,[n])];break;case e.AccessibilityIssueType.DefaultAltText:o=[Resources.AccessibilityCheckerReviewDefaultAltTextSingleButtonDescription,Resources.AccessibilityCheckerReviewDefaultAltTextSingleButtonDescription,ResourceManager.ResolveString(Resources.AccessibilityCheckerReviewDefaultAltTextMultipleButtonDescription,[n])];break;case e.AccessibilityIssueType.UnclearHyperlink:o=[Resources.AccessibilityCheckerNoUnclearHyperlink,Resources.AccessibilityCheckerReviewUnclearHyperlinkSingleButtonDescription,ResourceManager.ResolveString(Resources.AccessibilityCheckerReviewUnclearHyperlinkMultipleButtonDescription,[n])];break;case e.AccessibilityIssueType.ReviewAllHyperlink:o=["",Resources.AccessibilityCheckerReviewAllHyperlinkSingleButtonDescription,ResourceManager.ResolveString(Resources.AccessibilityCheckerReviewAllHyperlinkMultipleButtonDescription,[n])];break;case e.AccessibilityIssueType.ReviewAllAltText:o=["",Resources.AccessibilityCheckerReviewAllAltTextSingleButtonDescription,ResourceManager.ResolveString(Resources.AccessibilityCheckerReviewAllAltTextMultipleButtonDescription,[n])];break;case e.AccessibilityIssueType.InaccessibleChart:o=["",Resources.AccessibilityCheckerInaccessibleChartSingleButtonDescription,ResourceManager.ResolveString(Resources.AccessibilityCheckerInaccessibleChartMultipleButtonDescription,[n])];break;case e.AccessibilityIssueType.ReviewEmbed:o=["",Resources.AccessibilityCheckerReviewEmbedSingleButtonDescription,ResourceManager.ResolveString(Resources.AccessibilityCheckerReviewEmbedMultipleButtonDescription,[n])];break;default:TDB.raiseRecoverableError("Unsupported Accessibility checker issue type "+t+".")}return o[i]},n}(Disposable);e.AccessibilityCheckerSummaryViewModel=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel,o=function(e){function o(t,o){var i=this,r={features:TDB.ControlSetFeatures.Isolated,paneStateManager:o.paneStateManager,paneCloseButtonId:ClientAction.ButtonId.AccessibilityCheckerPane_CloseButton};return i=e.call(this,t,r)||this,i.resourceFactory=o.resourceFactory,i.viewModel=new n.AccessibilityCheckerPaneViewModel(i,i,o),i}return __extends(o,e),o.prototype.canActivate=function(){return this.viewModel.canActivate()},o.prototype.logVisibilityEvent=function(e){ActionLogger.RecordClientAction(new ClientAction.SimpleClientActionData(e?ClientAction.ActionType.OpenAccessibilityCheckerPane:ClientAction.ActionType.CloseAccessibilityCheckerPane,Diag.ULSCat.msoulscat_Story_Preview))},o.prototype.accessibilityCheckerSummaryArgs=function(){var e={accessibilityChecker:this.viewModel.accessibilityChecker};return new TDB.ChildArgs(t.AccessibilityCheckerSummaryVE,e)},o.prototype.editImageAltTextContentArgs=function(e){var n=this.viewModel.issueType.getWatchedValue(e);if(void 0!==n){var o={issueType:n,accessibilityChecker:this.viewModel.accessibilityChecker,currentIssueIndex:0,resourceFactory:this.resourceFactory};return new TDB.ChildArgs(t.EditImageAltTextVE,o)}},o.prototype.editHyperlinkContentArgs=function(e){var n=this.viewModel.issueType.getWatchedValue(e);if(void 0!==n){var o={issueType:n,accessibilityChecker:this.viewModel.accessibilityChecker,currentIssueIndex:0};return new TDB.ChildArgs(t.EditHyperlinkVE,o)}},o.prototype.editExternalContentArgs=function(e){var o=this.viewModel.issueType.getWatchedValue(e),i=void 0;if(o===n.AccessibilityIssueType.InaccessibleChart)i={introText:Resources.AccessibilityCheckerChartsArentAccessibleIntroLabel,issueType:o,accessibilityChecker:this.viewModel.accessibilityChecker,currentIssueIndex:0};else{if(o!==n.AccessibilityIssueType.ReviewEmbed)return;i={introText:Resources.AccessibilityCheckerReviewEmbedIntroLabel,issueType:o,accessibilityChecker:this.viewModel.accessibilityChecker,currentIssueIndex:0}}return new TDB.ChildArgs(t.EditExternalContentVE,i)},o.prototype.reviewEmbedContentArgs=function(e){var n=this.viewModel.issueType.getWatchedValue(e);if(void 0!==n){var o={introText:Resources.AccessibilityCheckerReviewEmbedIntroLabel,issueType:n,accessibilityChecker:this.viewModel.accessibilityChecker,currentIssueIndex:0};return new TDB.ChildArgs(t.EditExternalContentVE,o)}},o.prototype.paneStateArgs=function(e){return this.viewModel.getState(e)},o.prototype.getTitleText=function(){return Resources.AccessibilityChecker},o.prototype.getViewModel=function(){return this.viewModel},o.prototype.showAccessibilityCheckerResultSummary=function(){this.viewModel.accessibilityChecker.executeVerification(),this.viewModel.transitionTo(n.AccessibilityCheckerPaneViewState.Summary)},o.prototype.escape=function(){this.viewModel.paneStateManager.hideAllAuthoringPanes()},o.prototype.getInitialActiveChild=function(){switch(this.viewModel.getState()){case n.AccessibilityCheckerPaneViewState.EditImageAltText:return this.editImageAltTextContent.altTextEditor;case n.AccessibilityCheckerPaneViewState.EditHyperlink:return this.editHyperlinkContent.getDisplayTextBox()}return e.prototype.getInitialActiveChild.call(this)},o}(t.AuthoringPaneContent);t.AccessibilityCheckerPaneVEBase=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n,o=e.View.ViewElements;!function(e){e[e.Summary=0]="Summary",e[e.EditImageAltText=1]="EditImageAltText",e[e.EditHyperlink=2]="EditHyperlink",e[e.EditExternalContent=3]="EditExternalContent"}(n=t.AccessibilityCheckerPaneViewState||(t.AccessibilityCheckerPaneViewState={}));var i=function(e){function i(t,o,i){var r=e.call(this,t)||this;return r.view=o,r.paneStateManager=i.paneStateManager,r.accessibilityChecker=i.accessibilityChecker,r.state=TDB.watchableTag(596474016,r,n.Summary),r.issueType=TDB.watchableTag(596474017,r,void 0),r}return __extends(i,e),i.prototype.getState=function(e){return this.state.getWatchedValue(e)},i.prototype.setIssueType=function(e){var t=this;TDB.applyUpdate(function(){return t.issueType.setValue(e)})},i.prototype.transitionTo=function(e){var t=this;TDB.applyUpdate(function(){return t.state.setValue(e)}),this.view.enter()},i.prototype.scrollCurrentIssueIntoView=function(){var e;switch(this.issueType.getValue()){case t.AccessibilityIssueType.InaccessibleChart:case t.AccessibilityIssueType.ReviewEmbed:e=this.view.editExternalContent;break;default:TDB.raiseRecoverableError("Unsupported scroll into view issue type "+this.issueType.getValue()+".")}e&&e.scrollCurrentIssueIntoView()},i.prototype.canActivate=function(){return this.paneStateManager.getPaneVisible(o.AuthoringPaneType.AccessibilityChecker)},i.prototype.getCheckerResult=function(e,t){return this.accessibilityChecker.getResult(e,t)},i}(Disposable);t.AccessibilityCheckerPaneViewModel=i}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=StoryApp.Common,o=function(){function o(e){this._args=e,this.menuItem=new t.HideableMenuItem({primaryType:t.ToggleButtonVE,primaryArgs:this.buttonArgs()})}return o.prototype.getPaneType=function(){return this._args.paneType},o.prototype.buttonArgs=function(){var n=this._args;return n.paneType!=e.AuthoringPaneType.Navigation||StoryApp.Common.Branding.navigationButtonVisible()?{buttonId:n.buttonId,calculateChecked:this.calculateActive,click:this.buttonClick,context:this,cssClass:{value:"AppBarNearSideButton"},enabled:{compute:new TDB.ComputedOptionArgs(this,this.calculateEnabled)},shortcutIdentifiers:n.shortcutIdentifiers,shortcutProcessor:t.DomEventRegister.getInstance().getRootPanelElement(),textElementText:{value:n.text},domId:n.buttonDomId,description:{value:n.description},tooltip:{value:n.tooltip}}:null},o.prototype.getOverflowArgs=function(){var e=this._args,o={context:this,click:this.buttonClick,text:{value:e.text},description:{value:e.description},tooltip:{value:e.tooltip},buttonId:e.buttonId,enabled:e.supportsOffline?void 0:n.Environment.getInstance().getClientOnline(),telemetryId:e.overflowTelemetryId,shortcutIdentifiers:e.shortcutIdentifiers,shortcutProcessor:t.DomEventRegister.getInstance().getRootPanelElement()};return{type:t.OverflowMenuChildType.GlyphButton,args:o,label:e.overflowButtonLabel,visible:this.menuItem.getOverflowVisibility(),category:t.OverflowMenuCategory.Overflow}},o.prototype.buttonClick=function(t){var n="";return this.calculateActive()?(this._args.paneStateManager.hideAuthoringPane(this._args.paneType,!0),n="Close"):(this._args.paneType==e.AuthoringPaneType.Content&&this._args.paneStateManager.getAuthoringPane(EditVE.AuthoringPaneType.Content).setSourceCardType(void 0),this._args.paneStateManager.showAuthoringPane(this._args.paneType,!1),n="Open"),ActionLogger.RecordClientAction(new ClientAction.AuthoringTabToggleData("User toggled an authoring tab",this.getPaneTypeString(),n)),TDB.EventPropagation.PreventDefault},o.prototype.calculateActive=function(e){return this._args.paneStateManager.getPaneVisible(this._args.paneType,e)},o.prototype.calculateEnabled=function(e){return(this._args.supportsOffline||n.Environment.getInstance().getClientOnlineWatcher().getWatchedValue(e))&&TDB.getOptionValue(this._args.enabledWatchableOption,e,!0)},o.prototype.getPaneTypeString=function(){var t=e.AuthoringPaneType[this._args.paneType];return t||"Unrecognized AuthoringPaneType; This is a BUG."},o}();e.PanelButtonViewModel=o}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=StoryApp.Common,o=function(){function o(o){this.pageId=o.pageId;Resources.AuthoringPanelContent;n.UserState.getInstance().isUserOnFlight(FlightList.InsertTabRename1)&&Resources.CreateFromDoc,this._buttons={},this._buttons[e.AuthoringPaneType.Content]=new e.PanelButtonViewModel({text:Resources.AuthoringPanelContent,description:Resources.PlusJackCardButtonDescription,tooltip:Resources.AppBarInsertContentButtonDescription,paneType:e.AuthoringPaneType.Content,buttonId:ClientAction.ButtonId.AddContent_Open,supportsOffline:!1,overflowButtonLabel:t.OverflowButtonLabel.Content,paneStateManager:o.paneStateManager,enabledWatchableOption:{compute:new TDB.ComputedOptionArgs(this,this.shouldEnableContentPane)},buttonDomId:"PanelButtonContent",shortcutIdentifiers:["Alt+Shift+IKey"],overflowTelemetryId:StoryApp.Common.TelemetryConstants.panelContentOverflowButtonId}),this._buttons[e.AuthoringPaneType.Design]=new e.PanelButtonViewModel({text:Resources.AuthoringPanelDesign,description:Resources.AuthoringPanelDesign,tooltip:Resources.AppBarDesignButtonDescription,paneType:e.AuthoringPaneType.Design,buttonId:ClientAction.ButtonId.DesignPane_Open,supportsOffline:!1,overflowButtonLabel:t.OverflowButtonLabel.Design,paneStateManager:o.paneStateManager,buttonDomId:"PanelButtonDesign",shortcutIdentifiers:["Alt+Shift+GKey"],overflowTelemetryId:StoryApp.Common.TelemetryConstants.panelDesignOverflowButtonId})}return o.prototype.getMenuControlsInfo=function(){var n=[];return n.push(this.createMenuControl(e.AuthoringPaneType.Content,t.AppBarButtonLabel.Content)),n.push(this.createMenuControl(e.AuthoringPaneType.Design,t.AppBarButtonLabel.Design)),n},o.prototype.createMenuControl=function(e,n){return{type:t.AppBarChildType.UnknownElement,menuItem:this._buttons[e].menuItem,label:n,isFar:!1,overflowArgs:this._buttons[e].getOverflowArgs()}},o.prototype.shouldEnableContentPane=function(t){return!e.AuthoringPageVE.shouldContentPaneBeDisabled(this.pageId,t)},o}();e.PanelsHeaderViewModel=o}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t,n){var o=e.call(this,t,{features:TDB.ControlSetFeatures.Isolated,getControllingElement:function(){return t._remixButton},visible:n.visible})||this;return o.args=n,o}return __extends(t,e),t.prototype.wrapperSlideVisibleInitArgs=function(){return!1},t.prototype.wrapperSlideVisibleArgs=function(e){return{visible:this.isVisible(e),done:this.onPopupVisible}},t.prototype.titleDescriptionTextArgs=function(e){return Resources.RemixDropdownTitleText},t.prototype.mouseClicked=function(e){return TDB.EventPropagation.Bypass},t.prototype.designTextBoxArgs=function(){return new TDB.ChildArgs(VE.TextBoxVE,{description:Resources.RemixDropdownTextBoxDescription,readOnly:!1,selectTextOnFocus:!1,cssClass:"RemixDropdownDesignTextBox"})},t.prototype.designTextButtonArgs=function(){return new TDB.ChildArgs(VE.TextButtonVE,{buttonId:ClientAction.ButtonId.Remix_NlDesign,click:this.onDesignButtonClick,context:this,cssClass:{value:"dlgButton RemixDropdownDesignTextButton"},textClass:"dlgButtonText RemixDropdownDesignText",text:{value:Resources.RemixDropdownDesignButton}})},t.prototype.onDesignButtonClick=function(e){var t=this,n=this.designTextBox.getText(),o={name:"nlDesign",description:"NL Design",type:"POST",dataType:"json",data:JSON.stringify({designQuery:n}),contentType:StoryApp.RequestManager.JsonContentType,timeout:3e4,cache:!1,success:function(n){var o=n;t.args.nlDesignStory.call(t.args.viewModel,e,o)},error:function(e){StoryLog.TraceTag(596473292,Diag.ULSCat.msoulscat_Story_Style,Diag.ULSTraceLevel.warning,"NlDesign attempt failed for query: "+n)}};return $.ajax(StoryApp.Common.UrlHelper.getInstance().suggestedNlDesignUrl(StoryPageSettings.LookupId),o),TDB.EventPropagation.Bypass},t}(StoryApp.View.ViewElements.PopupBaseVE);e.RemixDropdownVEBase=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=StoryApp.Common,i=StoryApp.View.Common.FRE,r=function(){function r(e){this.args=e,this.dropdownVisible=TDB.watchableTag(596473291,this,!1),this.menuItem=new n.HideableMenuItem({primaryArgs:this,primaryType:t.RemixHeaderVE,viewElementVisible:{watchable:this.args.viewModel.isEditMode}}),e.dropdownArgs.visible=this.dropdownVisible,this.tabIndex=e.tabIndex}return r.prototype.getOverflowArgs=function(){var e={context:this,click:this.remixClick,text:{value:Resources.SwayThis},buttonId:ClientAction.ButtonId.AppBar_Remix,enabled:{compute:new TDB.ComputedOptionArgs(this,this.remixEnabled)}};return{type:n.OverflowMenuChildType.GlyphButton,label:n.OverflowButtonLabel.Remix,args:e,visible:this.menuItem.getOverflowVisibility(),category:n.OverflowMenuCategory.Overflow}},r.prototype.remixClick=function(e){var t=this;return CommonSettings.NlDesignEnabled?TDB.applyUpdate(function(){t.dropdownVisible.setValue(!t.dropdownVisible.getValue())}):(this.remixStory(e),i.FirstRunTriggers.remixClicked()),TDB.EventPropagation.PreventDefault},r.prototype.remixStory=function(t){var n=this;return this.args.viewModel.blockingUpdate.getValue()||(this.args.authoringModel.isCardDeckVisible()&&this.args.authoringModel.setStorylineMode(),e.Model.currentUndoManager().get(this.args.pageId).captureUserAction(function(){n.args.authoringModel.styleManager.selectRandomWorldAndStyle(),ActionLogger.RecordClientAction(new ClientAction.RemixAction(StoryEditPageMain.ModelHelper.getNumberOfStoryElements()))},"User hit the Remix! button")),TDB.EventPropagation.Bypass},r.prototype.remixEnabled=function(e){return o.Environment.getInstance().isClientOnline(e)&&!StoryApp.Server.Styles.currentStyleGalleryManager().get(this.args.pageId).getDefaultCultureStyleOptionsNeeded(e)&&!StoryApp.WorldList.getWorldOptionsNeeded(e)},r}();t.RemixHeaderViewModel=r}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.View.ViewElements,n=StoryApp.View.Common.FRE,o=function(o){function i(e,t){var n=o.call(this,e,t)||this;return n.model=t,n}return __extends(i,o),i.prototype.ifHeaderWrapperArgs=function(e){return this.getVisible(e)},i.prototype.wrapperClassNameArgs=function(e){return"RemixHeaderWrapperDynamic AppBarNearSideHeaderWrapper"},i.prototype.remixButtonArgs=function(){var e={buttonId:ClientAction.ButtonId.AppBar_Remix,click:this.model.remixClick,context:this.model,cssClass:{value:"StylePaneRemixButton"},enabled:{compute:new TDB.ComputedOptionArgs(this.model,this.model.remixEnabled)},shortcutProcessor:t.DomEventRegister.getInstance().getRootPanelElement(),text:{value:Resources.SwayThis},description:{value:Resources.SwayThis},tooltip:{value:Resources.AppBarRemixButtonDescription}};return new TDB.ChildArgs(t.TextButtonVE,e)},i.prototype.remixDropdownArgs=function(){return new TDB.ChildArgs(e.RemixDropdownVE,this.model.args.dropdownArgs)},i.prototype.showRemixCalloutArgs=function(){return StoryPageEditSettings.FRERemixButtonEnabled},i.prototype.calloutArgs=function(e){var o=n.CalloutID.RemixButton;if(n.getCalloutManager().isActiveCallout(e,o)){var i="",r="",a={calloutBoxClassName:"RemixButton-callout",calloutTapClassName:"RemixButton-tap-callout",headerText:{value:i=Resources.FirstRunRemixButtonHeader},bodyText:r=Resources.FirstRunRemixButtonBody,readerText:Resources.FirstRunRemixButtonReader,beakPosition:t.BeakPosition.TopRight,calloutID:o,delay:n.getDelayForCallout(o,n.FirstRunType.Default)};return new TDB.ChildArgs(t.FRECalloutVE,a)}},i}(t.CustomMenuControl);e.RemixHeaderVEBase=o}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=StoryApp.View.Common.FRE,i=function(){function t(e){this.pageId=e.pageId}return t.prototype.getMenuControlsInfo=function(){return[{type:n.AppBarChildType.GlyphButton,args:this.undoButtonArgs(),label:n.AppBarButtonLabel.Undo,overflowLabel:n.OverflowButtonLabel.Undo,stateMap:n.MenuItem.createGenericButtonStateMap(),isFar:!1,category:n.OverflowMenuCategory.Overflow},{type:n.AppBarChildType.GlyphButton,args:this.redoButtonArgs(),label:n.AppBarButtonLabel.Redo,overflowLabel:n.OverflowButtonLabel.Redo,stateMap:n.MenuItem.createGenericButtonStateMap(),isFar:!1,category:n.OverflowMenuCategory.Overflow}]},t.prototype.computeUndoEnabled=function(t){return e.Model.currentUndoManager().get(this.pageId).hasUndo(t)},t.prototype.computeRedoEnabled=function(t){return e.Model.currentUndoManager().get(this.pageId).hasRedo(t)},t.prototype.undoClick=function(t){return e.Model.currentUndoManager().get(this.pageId).undo(),o.FirstRunTriggers.undoClicked(),TDB.EventPropagation.Bypass},t.prototype.redoClick=function(t){return e.Model.currentUndoManager().get(this.pageId).redo(),TDB.EventPropagation.Bypass},t.prototype.undoButtonArgs=function(){var e={calloutBoxClassName:"UndoButton-calloutV2",calloutTapClassName:"UndoButton-tap-callout",headerText:{value:Resources.FirstRunUndoButtonV2},readerText:Resources.FirstRunUndoButtonReader,beakPosition:n.BeakPosition.TopRight,calloutID:o.CalloutID.UndoButton,delay:o.getDelayForCallout(o.CalloutID.UndoButton,o.FirstRunType.Default)};return{buttonId:ClientAction.ButtonId.AppBar_Undo,click:this.undoClick,context:this,cssClass:{value:"UndoButtonDynamic"},description:{value:Resources.UndoButton},tooltip:{value:Resources.AppBarUndoButtonDescription},enabled:{compute:new TDB.ComputedOptionArgs(this,this.computeUndoEnabled)},fontIconName:{value:FontIcons.UndoButtonIcon},fontIconSizeClass:FontIcons.UndoButtonIconSize,fontIconWrapperClass:{value:"headerStyleGlyphWrapper"},calloutArgs:{value:e},wrapperClassName:"UndoButtonDynamicWrapper"}},t.prototype.redoButtonArgs=function(){return{buttonId:ClientAction.ButtonId.AppBar_Redo,click:this.redoClick,context:this,cssClass:{value:"RedoButtonDynamic"},description:{value:Resources.RedoButton},tooltip:{value:Resources.AppBarRedoButtonDescription},enabled:{compute:new TDB.ComputedOptionArgs(this,this.computeRedoEnabled)},fontIconName:{value:FontIcons.RedoButtonIcon},fontIconSizeClass:FontIcons.RedoButtonIconSize,fontIconWrapperClass:{value:"headerStyleGlyphWrapper"}}},t}();t.UndoHeaderViewModel=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=StoryApp.View.ViewElements,i=e.View.ViewModel,r=function(e){function t(t,n){var o=e.call(this,t)||this;return o._viewModel=new i.AnimationLevelChooserViewModel(o,{styleManager:n.styleManager}),o}return __extends(t,e),t.prototype.slidebarArgs=function(){var e={points:[{text:Resources.AnimationLevelOff,value:n.AnimationLevel.Less},{text:Resources.AnimationLevelSubtle,value:n.AnimationLevel.More},{text:Resources.AnimationLevelAlive,value:n.AnimationLevel.Very}],onSliderChange:this.onAnimationSliderChange,position:this._viewModel.getAnimationSlidebarPosition(),titleText:Resources.AnimationLevelTitle,describedById:t._messageElementId,continuousMode:!1,showTicks:!0};return new TDB.ChildArgs(o.SlidebarVE,e)},t.prototype.getSlidebarVE=function(){return this._slidebarVE},t.prototype.messageTextArgs=function(e){return this.isMessageVisible(e)?Resources.AnimationLevelNotAvailable:""},t.prototype.messageStyleArgs=function(e){return{display:this.isMessageVisible(e)?"":"none"}},t.prototype.messageAttrArgs=function(e){var n={};return n[Aria.Attributes.Live]=Aria.AriaLiveValue[Aria.AriaLiveValue.Polite],n[Aria.Attributes.Atomic]=Aria.BooleanState.True,n.id=t._messageElementId,n},t.prototype.isMessageVisible=function(e){return this._viewModel.isMessageElementVisible(e)},t.prototype.onAnimationSliderChange=function(e){var t=new ClientAction.SlidebarSlideAction(ClientAction.SlidebarId.AnimationLevelSlidebar,Diag.ULSCat.msoulscat_Story_Style,{Slider:"Position changed",AnimationLevel:e.toString(),World:this._viewModel.getStyleManager().getSelectedWorld(null),Style:this._viewModel.getStyleManager().getSelectedStyle(null)});ActionLogger.RecordClientAction(t),this._viewModel.getStyleManager().setAnimationLevel(e,!0)},t.prototype.getAnimationSlidebarPosition=function(e){return this._viewModel.calculateAnimationSlidebarPosition(e)},t._messageElementId="AnimationLevelChooserMessage",t}(TDB.FocusableViewElement);t.AnimationLevelChooserVEBase=r}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=StoryApp.Common,i=function(){function t(e,t){this._view=e,this._styleManager=t.styleManager,this._animationSlidebarPosition=TDB.watcherTag(596473290,this,e,this.calculateAnimationSlidebarPosition)}return t.prototype.getStyleManager=function(){return this._styleManager},t.prototype.isMessageElementVisible=function(e){var t=this._styleManager.getSelectedWorld(e),o=this._styleManager.getSelectedStyle(e),i=this._styleManager.getSelectedAnimationAmount(e);return"PanoramaWorld"==t&&(o.search("Kawaii")>-1||o.search("Vanilla")>-1)&&i==n.AnimationLevel.More||"VerticalWorld"==t&&o.search("WindowsPhoto")>-1&&i==n.AnimationLevel.Very||"ExpoWorld"==t&&i==n.AnimationLevel.Less},t.prototype.getAnimationSlidebarPosition=function(){return this._animationSlidebarPosition},t.prototype.calculateAnimationSlidebarPosition=function(t){var i=this,r=this._styleManager.getSelectedAnimationAmount(t);if(r==n.AnimationLevel.Auto){var a=(e.Model&&e.Model.StoryModel).traversalModel.getStyleId(),s=StoryPageSettings.LookupId;return $.ajax(o.UrlHelper.getInstance().getAnimationLevelForStyleUrl(s,a),{type:"GET",success:function(e){i._styleManager.getSelectedAnimationAmount()===n.AnimationLevel.Auto&&(0==e?i._styleManager.setAnimationLevel(n.AnimationLevel.More,!1):i._styleManager.setAnimationLevel(e,!1))},error:function(e){i._styleManager.getSelectedAnimationAmount()===n.AnimationLevel.Auto&&i._styleManager.setAnimationLevel(n.AnimationLevel.More,!1)},cache:!1}),n.AnimationLevel.Less}return r},t}();t.AnimationLevelChooserViewModel=i}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel,o=StoryApp.View.ViewElements,i=function(e){function t(t,o){var i=e.call(this,t)||this;return i._viewModel=new n.FontScaleChooserViewModel(i,{styleManager:o.styleManager,defaultValue:n.FontScaleChooserViewModel.SCALE_NORMAL}),i}return __extends(t,e),t.prototype.slidebarArgs=function(){var e={points:n.FontScaleChooserViewModel.FONT_SCALE_POINTS,onSliderChange:this.handleSliderMove,position:this._viewModel.getSlidebarPositionWatchable(),titleText:Resources.FontScaleTitle,continuousMode:!1,showTicks:!0};return new TDB.ChildArgs(o.SlidebarVE,e)},t.prototype.getSlidebarVE=function(){return this._slidebarVE},t.prototype.getFontScale=function(e){return this._viewModel.getFontScale(e)},t.prototype.handleSliderMove=function(e){var t=this._viewModel.getStyleManager(),n=new ClientAction.SlidebarSlideAction(ClientAction.SlidebarId.FontScaleSlidebar,Diag.ULSCat.msoulscat_Story_Style,{Slider:"Position changed",FontScale:e.toString(),World:t.getSelectedWorld(null),Style:t.getSelectedStyle(null)});ActionLogger.RecordClientAction(n),this._viewModel.setFontScale(e)},t}(TDB.FocusableViewElement);t.FontScaleChooserVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.View.ViewModel,i=function(e){function i(t,n){var i=e.call(this,t)||this;return i.args=n,i._viewModel=new o.StyleCustomizationPaneViewModel({styleManager:n.styleManager,visibility:n.colorChooserPaneVisible,curatedColorOptions:n.curatedColorOptions}),i}return __extends(i,e),i.prototype.isVisible=function(e){return this._viewModel.visibility.getWatchedValue(e)},i.prototype.fontSetChooserArgs=function(){var e={styleManager:this.args.styleManager};return new TDB.ChildArgs(t.FontSetChooserVE,e)},i.prototype.getFontSetChooser=function(){return this._fontSetChooserVE},i.prototype.setFontSetChooserVisibility=function(e){this._fontSetChooserVE.setDropdownVisibility(e)},i.prototype.colorChooserArgs=function(){var e={styleManager:this._viewModel.getStyleManager(),colorChooserPaneVisible:this._viewModel.visibility,curatedColorOptions:this._viewModel.getCuratedColorOptions()};return new TDB.ChildArgs(t.ColorChooserVE,e)},i.prototype.customColorCalloutArgs=function(e){return new TDB.ChildArgs(n.FRECalloutVE,FRE.CalloutArgsCreator.createArgsForCustomColorEntry(e))},i.prototype.getColorChooser=function(){return this._colorChooser},i.prototype.animationChooserArgs=function(){return o.StyleCustomizationPaneViewModel.isStoryPageAnimationLevelAdjustEnabled()?new TDB.ChildArgs(t.AnimationLevelChooserVE,{styleManager:this.args.styleManager}):null},i.prototype.getAnimationChooser=function(){return this._animationChooser},i.prototype.getFontScaleChooser=function(){return this._fontScaleChooser},i.prototype.fontScaleChooserArgs=function(){return o.StyleCustomizationPaneViewModel.isFontScaleEnabled()?new TDB.ChildArgs(t.FontScaleChooserVE,{styleManager:this._viewModel.getStyleManager()}):null},i.prototype.previewImageAttrArgs=function(e){return this.parent.getViewModel().getPreviewImageAttribute(e)},i.prototype.backButtonArgs=function(){var e={buttonId:ClientAction.ButtonId.DesignPane_CustomizeBackButton,click:this.backButtonClick,context:this,cssClass:{value:"StyleCustomizePaneBackButton"},description:{value:Resources.ButtonBack},fontIconName:{value:FontIcons.LeftArrowGreyIcon},fontIconSizeClass:FontIcons.LeftArrowGreyIconSize,fontIconWrapperClass:{value:"StyleCustomizePaneBackButtonIconWrapper"},textClass:"StyleCustomizationPaneBackButtonText",textPlacementRight:!0,text:{value:Resources.ButtonBack},tabIndex:this.args.backToStyleChooserButtonTabIndex};return new TDB.ChildArgs(n.GlyphButtonVE,e)},i.prototype.backButtonClick=function(e){return ActionLogger.RecordClientAction(new ClientAction.ButtonClickAction(ClientAction.ButtonId.DesignPane_CustomizeBackButton,Diag.ULSCat.msoulscat_Story_Style)),this._fontSetChooserVE.setDropdownVisibility(!1),this.args.backButtonClicked.call(this.parent),TDB.EventPropagation.Bypass},i}(TDB.FocusableViewElement);t.StyleCustomizationPaneVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(e){this._styleManager=e.styleManager,this.visibility=e.visibility,this._curatedColorOptions=e.curatedColorOptions}return e.prototype.getStyleManager=function(){return this._styleManager},e.prototype.getCuratedColorOptions=function(){return this._curatedColorOptions},e.isStoryPageAnimationLevelAdjustEnabled=function(){return StoryPageEditSettings.AnimationLevelUIEnabled},e.isFontScaleEnabled=function(){return CommonSettings.LayoutFontScaleEnabled},e}();e.StyleCustomizationPaneViewModel=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel;!function(e){e[e.CustomizeButton=2]="CustomizeButton",e[e.BackToStyleChooserButton=2]="BackToStyleChooserButton"}(t.StylePaneTabIndex||(t.StylePaneTabIndex={}));var o;!function(e){e[e.RemixButton=2]="RemixButton",e[e.BackToStyleChooserButton=3]="BackToStyleChooserButton"}(o=t.ModeSwitchStylePaneTabIndex||(t.ModeSwitchStylePaneTabIndex={}));var i=function(e){function i(t,o){var i=this,r={features:TDB.ControlSetFeatures.Isolated,paneStateManager:o.paneStateManager,paneCloseButtonId:ClientAction.ButtonId.DesignPane_CloseButton};return i=e.call(this,t,r)||this,i._viewModel=new n.StylePaneViewModel(i,{styleManager:o.styleManager,paneStateManager:o.paneStateManager}),i.authoringModel=o.authoringModel,i.storyPageEdit=o.storyPageEdit,i}return __extends(i,e),i.prototype.canActivate=function(){return this._viewModel.canActivate()},i.prototype.getInitialActiveChild=function(){return this.paneHeader.remixHeader},i.prototype.showMoodPane=function(){var e=this;TDB.applyUpdate(function(){e._viewModel.hideStyleCustomizationPane(),e._viewModel.showStyleChooserPane()}),this.enter()},i.prototype.showCustomizationPane=function(){var e=this;TDB.applyUpdate(function(){e._viewModel.hideStyleChooserPane(),e._viewModel.showStyleCustomizationPane()}),this.setActiveChild(this.styleCustomizationPane.backButton)},i.prototype.styleChooserPaneClassNameArgs=function(e){var t="InnerSidePane";return e.watchValue(this._viewModel.getStyleChooserPaneVisible())&&(t+=" InnerSidePaneVisible InnerSidePaneCombinedDesignAndLayout"),t},i.prototype.styleCustomizationPaneWrapperClassNameArgs=function(e){var t="InnerSidePane";return e.watchValue(this._viewModel.getStyleCustomizationPaneVisible())&&(t+=" InnerSidePaneVisible"),t},i.prototype.styleChooserArgs=function(){var e={styleManager:this._viewModel.styleManager,styleChooserPaneVisible:this._viewModel.getStyleChooserPaneVisible(),customizeButtonClicked:this.showCustomizationPane,customizeButtonTabIndex:void 0};return new TDB.ChildArgs(t.StyleChooserVE,e)},i.prototype.getStyleChooserVE=function(){return this.styleChooser},i.prototype.styleCustomizationPaneArgs=function(e){if(this.isStyleCustomizationPaneVisible(e)){var n=this._viewModel.styleManager;return this.syncCuratedColorOptions(n.getSelectedStyle(e)),new TDB.ChildArgs(t.StyleCustomizationPaneVE,{styleManager:n,colorChooserPaneVisible:this._viewModel.getStyleChooserPaneVisible(),backButtonClicked:this.showMoodPane,curatedColorOptions:this._viewModel.getCuratedColorOptions(),backToStyleChooserButtonTabIndex:o.BackToStyleChooserButton})}},i.prototype.getStyleCustomizationPane=function(){return this.styleCustomizationPane},i.prototype.mouseClicked=function(e){return TDB.EventPropagation.Bypass},i.prototype.logVisibilityEvent=function(e){ActionLogger.RecordClientAction(new ClientAction.SimpleClientActionData(e?ClientAction.ActionType.OpenStylePane:ClientAction.ActionType.CloseStylePane,Diag.ULSCat.msoulscat_Story_Preview))},i.prototype.escape=function(){this._viewModel.paneStateManager.hideAllAuthoringPanes()},i.prototype.isStyleChooserPaneVisible=function(e){return this._viewModel.getStyleChooserPaneVisible().getWatchedValue(e)},i.prototype.isStyleCustomizationPaneVisible=function(e){return this._viewModel.getStyleCustomizationPaneVisible().getWatchedValue(e)},i.prototype.getCuratedColorOptions=function(){return this._viewModel.getCuratedColorOptions()},i.prototype.syncCuratedColorOptions=function(e){this._viewModel.syncCuratedColorOptions(e)},i.prototype.getTitleText=function(){return Resources.StylePaneTitle},i.prototype.isCardDeckSupported=function(){return!1},i.prototype.getViewModel=function(){return this._viewModel},i.prototype.paneHeaderArgs=function(){var e={paneStateManager:this.args.paneStateManager,title:this.getTitleText(),titleId:this.getTitleElementId(),paneCloseButtonId:this.args.paneCloseButtonId,context:this,closeButtonClicked:this.closePaneButtonClicked,leftAlign:this.args.leftAlign,authoringModel:this.authoringModel,storyPageEdit:this.storyPageEdit};return new TDB.ChildArgs(t.StylePaneHeaderVE,e)},i}(t.AuthoringPaneContent);t.StylePaneVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewElements,o=function(){function e(e,t){this._view=e,this.paneStateManager=t.paneStateManager,this.styleManager=t.styleManager,this._curatedColorOptions=TDB.watchableTag(596473284,this,{}),this._styleChooserPaneVisible=TDB.watchableTag(596473285,this,!0),this._styleCustomizationPaneVisible=TDB.watchableTag(596473286,this,!1)}return e.prototype.canActivate=function(){return this.paneStateManager.getPaneVisible(n.AuthoringPaneType.Design)},e.prototype.getCuratedColorOptions=function(){return this._curatedColorOptions},e.prototype.getStyleCustomizationPaneVisible=function(){return this._styleCustomizationPaneVisible},e.prototype.showStyleCustomizationPane=function(){ActionLogger.RecordClientAction(new ClientAction.SimpleClientActionData(ClientAction.ActionType.OpenColorPane,Diag.ULSCat.msoulscat_Story_Preview)),this._styleCustomizationPaneVisible.setValue(!0)},e.prototype.hideStyleCustomizationPane=function(){ActionLogger.RecordClientAction(new ClientAction.SimpleClientActionData(ClientAction.ActionType.CloseColorPane,Diag.ULSCat.msoulscat_Story_Preview)),this._styleCustomizationPaneVisible.setValue(!1)},e.prototype.getStyleChooserPaneVisible=function(){return this._styleChooserPaneVisible},e.prototype.showStyleChooserPane=function(){ActionLogger.RecordClientAction(new ClientAction.SimpleClientActionData(ClientAction.ActionType.OpenMoodMenu,Diag.ULSCat.msoulscat_Story_Preview)),this._styleChooserPaneVisible.setValue(!0)},e.prototype.hideStyleChooserPane=function(){ActionLogger.RecordClientAction(new ClientAction.SimpleClientActionData(ClientAction.ActionType.CloseMoodMenu,Diag.ULSCat.msoulscat_Story_Preview)),this._styleChooserPaneVisible.setValue(!1)},e.prototype.syncCuratedColorOptions=function(e){var t=this,n=this._curatedColorOptions.getValue();if(!n[e]){var o=StoryPageSettings.LookupId;$.ajax({type:"GET",url:StoryApp.Common.UrlHelper.getInstance().curatedColorOptionsUrl(o,e),dataType:"json",traditional:!0}).done(function(o){if(o&&0!=o.length){var i=StoryApp.Server.Styles.convertToColorPaletteData(o,"default");n[e]=i,TDB.applyUpdate(function(){return t._curatedColorOptions.notify()})}else{var r={styleId:e};StoryLog.StructuredTraceTag(596473287,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.warning,"Call to GetCuratedColorOptions returned 0 results.",r)}}).fail(function(t,n,o){var i={status:t.status,textStatus:n,errorThrown:o,styleId:e};StoryLog.StructuredTraceTag(596473288,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.info,"Call to GetCuratedColorOptions didn't complete.",i)})}},e.prototype.getPreviewImageAttribute=function(e){var t=this.styleManager.getSelectedStyleOption(e),n=this.styleManager.getStylePreviewImageAttributes(t,e)||{},o=this.getSelectedStyleDescription(e);return n.alt=o,n[Aria.Attributes.Title]=o,n},e.prototype.getSelectedStyleDescription=function(e){var n,o=t.FontScaleChooserViewModel.getFontScaleString(this.styleManager,e),i=this.styleManager.getSelectedFontSetOption(e);return this._view.styleChooser&&(n=this._view.styleChooser.getViewModel().getDisplayNameForSelectedStyle(e)),o&&i&&n?ResourceManager.ResolveString(Resources.SelectedStyleDetailedDescription,[n,i.headingFontDescription,i.bodyFontDescription,o]):Resources.SelectedStyleOptionDescription},e}();t.StylePaneViewModel=o}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.View.ViewModel;!function(e){e[e.no=0]="no",e[e.yes=1]="yes",e[e.error=2]="error"}(t.PaletteReadyStatus||(t.PaletteReadyStatus={}));var i=function(i){function r(t,n){var r=i.call(this,t)||this;return r.showCustomColorEntry=TDB.watchableTag(596464523,r,!1),r.viewModel=new o.ColorChooserViewModel(r,{styleManager:n.styleManager,curatedColorOptions:n.curatedColorOptions}),r.addResource(e.Model.currentUndoManager().get(r.pageId).registerStatefulComponent(r,"colorChooser")),r._subscribeToWatchable(r.viewModel.getPrefetchColorSuggestions(),TDB.UpdatePhase.WriteOnly),r.optionsCarouselViewModel=TDB.watcherOwnerTag(596464913,r,r,r.computeOptionsCarouselViewModel),r}return __extends(r,i),r.prototype.computeOptionsCarouselViewModel=function(e){var o=[],i={selectedId:this.viewModel.getSelectedColorOptionId(),styleManager:this.viewModel.getStyleManager(),listIndex:void 0,description:Resources.ColorDefaultOptionLabel};if(o.push({optionArgs:i,optionType:t.ColorDefaultOptionVE}),StoryPageEditSettings.SiteCustomColorsEnabled){var r=this.getArgsForNewCustomTile();o.push({optionArgs:r,optionType:t.NewCustomColorOptionVE});for(var a=this.viewModel.calculateCustomColorOptions(e),s=0;s<a.length;++s)o.push({optionArgs:a[s],optionType:t.CustomColorOptionVE})}for(var l=this.viewModel.calculateColorOptions(e),s=0;s<l.length;++s)o.push({optionArgs:l[s],optionType:t.ColorOptionVE});return new n.CarouselListViewModel(void 0,{optionArgsAndTypes:o})},r.prototype.colorOptionsCarouselArgs=function(e){var t=this.optionsCarouselViewModel.getWatchedValue(e),o={optionArgsAndTypes:t.args.optionArgsAndTypes,logString:"ColorChooserImageCarousel",description:this.ColorInspirationHeaderTextArgs(e),nextButtonID:ClientAction.ButtonId.DesignPane_CarouselNext,nextButtonCssClass:"CarouselNext",nextButtonDescription:Resources.NextDesignButtonDescription,previousButtonID:ClientAction.ButtonId.DesignPane_CarouselPrevious,previousButtonCssClass:"CarouselPrevious",previousButtonDescription:Resources.PreviousDesignButtonDescription,carouselCssClass:"ColorInspirationCarousel",viewModel:t};return new TDB.ChildArgs(n.AccessibleCarouselVE,o)},r.prototype.getArgsForNewCustomTile=function(){return{selectedId:this.viewModel.getSelectedColorOptionId(),listIndex:void 0,context:this.viewModel,description:Resources.NewCustomColorLabel,onAction:this.viewModel.isUserEnteringCustomColor}},r.prototype.customColorEntryArgs=function(e){return new TDB.ChildArgs(t.CustomColorEntryVE,this.viewModel.getCustomColorEntryArgs(e))},r.prototype.customColorEntryContainerWrapperStyleArgs=function(e){return{display:this.showCustomColorEntry.getWatchedValue(e)?"flex":"none"}},r.prototype.onUpdate=function(e){this.viewModel.onUpdate(e)},r.calculateColorPaletteCacheId=function(e,t){return e+" "+t},r.calculateCustomColorCacheId=function(e,t){return"Custom "+e+" "+t},r.prototype.selectColorPalette=function(e){this.viewModel.selectColorPalette(e)},r.prototype.selectColorOption=function(e){this.viewModel.selectColorOption(e)},r.prototype.ColorInspirationHeaderTextArgs=function(e){return Resources.ColorOptionSectionHeader},r.prototype.ColorInspirationHeaderClassNameArgs=function(e){return"StyleCustomizePaneSectionHeader"},r.prototype.PaletteChoiceHeaderTextArgs=function(e){return Resources.ColorPaletteSectionHeader},r.prototype.PaletteChoiceHeaderClassNameArgs=function(e){return"StyleCustomizePaneSectionHeader"},r.prototype.PaletteChoiceMessageTextArgs=function(e){return this.viewModel.calculatePaletteMessage(e)},r.prototype.PaletteChoiceMessageClassNameArgs=function(e){return"ColorPaletteMessageText"},r.prototype.ifPaletteChoiceMessageArgs=function(e){return this.viewModel.isPaletteMessageVisible(e)},r.prototype.getColorOptionDisabled=function(e,t){return this.viewModel.shouldColorOptionDisabled(e,t)},r.prototype.getColorOptionsArgs=function(e){return this.viewModel.calculateColorOptions(e)},r.prototype.getCustomColorOptionsArgs=function(e){return this.viewModel.calculateCustomColorOptions(e)},r.prototype.getPaletteOptions=function(e){return this.viewModel.getPaletteOptions(e)},r.prototype.colorPalettesCarouselArgs=function(e){var o={optionArgsAndTypes:this.getPaletteOptions(e).map(function(e){return{optionArgs:e,optionType:t.ColorPaletteVE}}),logString:"ColorChooserPaletteCarousel",description:this.PaletteChoiceHeaderTextArgs(e),nextButtonID:ClientAction.ButtonId.DesignPane_CarouselNext,nextButtonCssClass:"CarouselNext",nextButtonDescription:Resources.NextDesignButtonDescription,previousButtonID:ClientAction.ButtonId.DesignPane_CarouselPrevious,previousButtonCssClass:"CarouselPrevious",previousButtonDescription:Resources.PreviousDesignButtonDescription};return new TDB.ChildArgs(n.AccessibleCarouselVE,o)},r.prototype.mouseClicked=function(e){return TDB.EventPropagation.Bypass},r.prototype.getSelectedColorPalette=function(e){return this.viewModel.getSelectedColorPalette(e)},r.prototype.getSelectedColorOptionId=function(){return this.viewModel.getSelectedColorOptionId().getValue()},r.prototype.getState=function(){return this.viewModel.getState()},r.prototype.setState=function(e){this.viewModel.setState(e)},r.prototype.getColorPalettesSuccess=function(e,t){this.viewModel.getColorPalettesSuccess(e,t)},r.defaultId="default",r.newCustomId="NewCustom",r.customColorOptionIdPrefix="custom_",r.numberOfImagesInChunk=10,r}(TDB.FocusableViewElement);t.ColorChooserVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.Server.Styles,o=e.View.ViewElements,i=e.Model.AuthoringModel,r=e.Model.CSM,a=function(){function t(e,t){this.view=e,this.nextCustomColorOption=0,this._styleManager=t.styleManager,this._curatedColorOptions=t.curatedColorOptions,this.notifyPaletteUpdate=TDB.notifierTag(596473249,this),this._selectedColorOptionId=TDB.watchableTag(596473250,this,o.ColorChooserVE.defaultId),this._selectedPaletteColorOptionId=TDB.watchableTag(596473251,this,o.ColorChooserVE.defaultId),this._selectedPaletteIndex=TDB.watchableTag(596473280,this,-1),this._selectedColorPalette=TDB.watchableTag(596473281,this,void 0),this.bonusUserDefaultPalette=TDB.watchableTag(596473282,this,void 0),this.prefetchColorSuggestions=TDB.watcherTag(596473283,this,e,this.getColorSuggestions)}return t.prototype.getColorSuggestions=function(t){if(StoryPageEditSettings.SiteSuggestedColorsEnabled){for(var i=this._styleManager.getSelectedStyle(t),r=this._styleManager.getSelectedFontSet(),a=e.Model.StoryModel.traversalModel.getCustomColors(t).getCollection(t),s=this.checkSelectedIndex(i,t),l=this.view.optionsCarouselViewModel.getWatchedValue(t).getFirstUnvisitedElement(t),c=[],d=0;d<a.length+s.length&&d<l+o.ColorChooserVE.numberOfImagesInChunk;d++)if(d<a.length)this.getColorSuggestionsForCustomColor(a[d],i,r);else{var u=d-a.length;if(s[u]){var p=this.processColorSuggestionsForImage(s[u].id,i,r,t);p&&(c=c.concat(p))}}if(c.length>0){var g={imageIdsToExtract:c,styleIdUsedToExtract:i};n.getSuggestedColorPalettes(StoryPageSettings.LookupId,c,StoryPageEditSettings.NumberOfSuggestedPalettes,this,this.getColorPalettesSuccess,this.getColorPalettesError,g,i,r)}}},t.prototype.getColorSuggestionsForCustomColor=function(e,t,i){var r=this,a=Color.parse(e).toHexString();if(null!==a){var s=o.ColorChooserVE.calculateCustomColorCacheId(a,t),l=o.ColorSuggestionsCache.getInstance().getColorSuggestion(s);null!=l&&l.paletteReadyStatus!=o.PaletteReadyStatus.no||(o.ColorSuggestionsCache.getInstance().addColorSuggestion(s,{paletteData:[],paletteReadyStatus:o.PaletteReadyStatus.no}),n.getCustomColorPalettes(StoryPageSettings.LookupId,a,StoryPageEditSettings.NumberOfSuggestedPalettes,this,function(e){return r.getCustomColorPalettesResult(e,a,t,function(e){return e?o.PaletteReadyStatus.yes:o.PaletteReadyStatus.no})},function(){return r.getCustomColorPalettesResult([],a,t,function(e){return o.PaletteReadyStatus.error})},t,i))}},t.prototype.processColorSuggestionsForImage=function(t,n,i,a){var s=o.ColorChooserVE.calculateColorPaletteCacheId(t,n),l=o.ColorSuggestionsCache.getInstance().getColorSuggestion(s);if(null==l||l.paletteReadyStatus==o.PaletteReadyStatus.no){var c=e.Model.ContentStorageModel.getModelObject(t),d=e.Model.StoryModel.getModelObject(t);if(null!=c&&(c.getContentState(a)==r.ContentState.Ready||c.getContentState(a)==r.ContentState.Failed)&&null!=d)return o.ColorSuggestionsCache.getInstance().addColorSuggestion(s,{paletteData:[],paletteReadyStatus:o.PaletteReadyStatus.no}),t;e.Model.ContentStorageModel.contentRoot.contentNodes.getCollection(a)}return null},t.prototype.checkSelectedIndex=function(t,r){for(var a=this,s=i.currentStoryController().get(this.view.getPageId()).getMediasByType([i.ClipType.Image],null,r),l=e.Model.StoryModel.traversalModel.getCustomColors(r).getCollection(r),c=s.length;c--;)i.MediaController.isMediaEmpty(s[c],r)&&s.splice(c,1);var d=s.map(function(e){return o.ColorChooserVE.calculateColorPaletteCacheId(e.id,t)});d.push.apply(l.map(function(e){return o.ColorChooserVE.calculateCustomColorCacheId(e,t)})),o.ColorSuggestionsCache.getInstance().removeObsoleteEntries(d);var u=this._selectedPaletteColorOptionId.getValue(),p=this._selectedColorOptionId.getValue(),g=-1,h=-1;if(u!=o.ColorChooserVE.defaultId||p!=o.ColorChooserVE.defaultId){for(f=0;f<s.length;f++){var C=s[f];C.id==u&&(g=f),C.id==p&&(h=f)}for(var f=0;f<l.length;++f){var m=o.ColorChooserVE.customColorOptionIdPrefix+f;m==u&&(g=f),m==p&&(h=f)}if(-1==g){var y=new ClientAction.DeleteImageActionData(this._selectedPaletteColorOptionId.getValue(),!0);ActionLogger.RecordClientAction(y),TDB.applyUpdate(function(){a._selectedPaletteColorOptionId.setValue(o.ColorChooserVE.defaultId),a._selectedPaletteIndex.setValue(0);var e=a._selectedColorPalette.getValue();if(e&&e.variation){var t=new n.ColorPaletteData(o.ColorChooserVE.defaultId,e.variation,e.seedColors,e.dynamicStyleId,e.colorOptionId,e.colorPalette,e.backgroundSetId,e.telemetryData);a.bonusUserDefaultPalette.setValue(t)}},TDB.Justification.InitialConversion)}-1===h&&TDB.applyUpdate(function(){a._selectedColorOptionId.setValue(o.ColorChooserVE.defaultId)},TDB.Justification.InitialConversion)}return s},t.prototype.getBuiltInColorPalettesForStyle=function(e,t){return this._curatedColorOptions.getWatchedValue(t)[e]||[]},t.prototype.getDefaultPaletteOptions=function(t){var o=this._styleManager.getSelectedStyle(t);this.checkBonusPalette(o);var i=[],r=this.getBuiltInColorPalettesForStyle(o,t),a=[],s=t.watchValue(this.bonusUserDefaultPalette);if(s){c={colorPaletteData:s,styleManager:this._styleManager,listIndex:0,description:ResourceManager.ResolveString(Resources.ColorPaletteButtonDescription,[1]),tooltip:ResourceManager.ResolveString(Resources.ColorPaletteButtonDescription,[1]),context:this,onAction:this.selectColorPalette};i=i.concat(c),a.push(this.getStyleOption(o,s))}for(var l=0;l<r.length;l++){var c={colorPaletteData:r[l],styleManager:this._styleManager,listIndex:i.length,description:ResourceManager.ResolveString(Resources.ColorPaletteButtonDescription,[i.length]),tooltip:ResourceManager.ResolveString(Resources.ColorPaletteButtonDescription,[i.length]),context:this,onAction:this.selectColorPalette};i=i.concat(c),a.push(this.getStyleOption(o,r[l]))}var d=e.Model.StoryModel.traversalModel.getCulture(t),u=n.currentStylePreviewManager().get(this.view.getPageId());return u.batchStyles(a.slice(0,5),1,!1,d),u.batchStyles(a.slice(5),0,!0,d),i},t.prototype.checkBonusPalette=function(e){var t=this,n=this.bonusUserDefaultPalette.getValue();n&&n.dynamicStyleId!=e&&TDB.applyUpdate(function(){t.bonusUserDefaultPalette.setValue(void 0)},TDB.Justification.InitialConversion)},t.prototype.getStyleOption=function(e,t){var n=this._styleManager.getSelectedStyleOption();return n.setColorPalette(t.colorPalette),n.setColorOptionId(t.colorOptionId),n.setSeedColorOverrides(t.seedColors),null!=t.backgroundSetId&&""!==t.backgroundSetId?n.setBackgroundSetId(t.backgroundSetId):n.setBackgroundSetId(this._styleManager.sessionBackgroundSetId),n},t.prototype.getColorPalettesSuccess=function(e,t){var n=this,i=t;i.imageIdsToExtract.forEach(function(t){var n=e[t],r=o.ColorChooserVE.calculateColorPaletteCacheId(t,i.styleIdUsedToExtract),a=o.ColorSuggestionsCache.getInstance().getColorSuggestion(r);a&&(a.paletteData=n,a.paletteReadyStatus=void 0==n?o.PaletteReadyStatus.no:o.PaletteReadyStatus.yes)}),TDB.applyUpdate(function(){n.notifyPaletteUpdate.notify()})},t.prototype.getColorPalettesError=function(e){var t=this;if(e){var n=e;n.imageIdsToExtract.forEach(function(e){var t=o.ColorChooserVE.calculateColorPaletteCacheId(e,n.styleIdUsedToExtract),i=o.ColorSuggestionsCache.getInstance().getColorSuggestion(t);i&&(i.paletteData=[],i.paletteReadyStatus=o.PaletteReadyStatus.error)}),TDB.applyUpdate(function(){t.notifyPaletteUpdate.notify()})}},t.prototype.getCustomColorPalettesResult=function(e,t,n,i){var r=this,a=o.ColorChooserVE.calculateCustomColorCacheId(t,n),s=o.ColorSuggestionsCache.getInstance().getColorSuggestion(a);s&&(s.paletteData=e,s.paletteReadyStatus=i(void 0!==e)),TDB.applyUpdate(function(){r.notifyPaletteUpdate.notify()})},t.prototype.getStyleManager=function(){return this._styleManager},t.prototype.calculateColorOptions=function(e){var t=this;if(!StoryPageEditSettings.SiteSuggestedColorsEnabled)return[];var n=this._styleManager.getSelectedStyle(e),i=this._selectedColorPalette.getValue(),r=this.checkSelectedIndex(n,e);i&&i.dynamicStyleId!==n&&TDB.applyUpdate(function(){t._selectedColorOptionId.setValue(o.ColorChooserVE.defaultId),t._selectedPaletteColorOptionId.setValue(o.ColorChooserVE.defaultId),t._selectedPaletteIndex.setValue(-1)},TDB.Justification.InitialConversion);for(var a=[],s=0;s<r.length;s++)if(r[s]){var l={viewModelArgs:{imageContent:r[s],selectedId:this._selectedColorOptionId,styleManager:this._styleManager},listIndex:void 0,description:ResourceManager.ResolveString(Resources.ColorOptionButtonDescription,[s+1]),tooltip:ResourceManager.ResolveString(Resources.ColorOptionButtonDescription,[s+1]),context:this,onAction:this.selectColorOption,getColorOptionDisabled:this.shouldColorOptionDisabled};a=a.concat(l)}return a},t.prototype.getCustomColorEntryArgs=function(e){return{viewModelArgs:{},description:Resources.CustomColorDefaultText,tooltip:Resources.CustomColorTooltip,selectedId:this.getSelectedColorOptionId(),context:this,visible:this.view.showCustomColorEntry}},t.prototype.calculateCustomColorOptions=function(t){for(var n=e.Model.StoryModel.traversalModel.getCustomColors(t).getCollection(t),i=[],r=0;r<n.length;++r)i.push({viewModelArgs:{selectedId:this._selectedColorOptionId},optionId:o.ColorChooserVE.customColorOptionIdPrefix+r,listIndex:void 0,description:Resources.CustomColorDefaultText,tooltip:ResourceManager.ResolveString(Resources.ColorOptionButtonDescription,[n[r]]),context:this,onAction:this.selectColorOption,modelIndex:r,text:n[r]});return i},t.prototype.getSelectedColorOptionId=function(){return this._selectedColorOptionId},t.prototype.getSelectedColorPalette=function(e){return this._selectedColorPalette.getWatchedValue(e)},t.prototype.onUpdate=function(e){e===TDB.UpdatePhase.WriteOnly&&this.prefetchColorSuggestions.resolve()},t.prototype.getPrefetchColorSuggestions=function(){return this.prefetchColorSuggestions},t.prototype.selectColorPalette=function(t){var n=this,i=this._selectedColorPalette.getValue();if(!i||i!==t){var r,a=this._selectedColorOptionId.getValue(),s=this._styleManager.getSelectedWorld(),l=this._styleManager.getSelectedStyle(),c=this.calculateCacheId(a,l),d=o.ColorSuggestionsCache.getInstance().getColorSuggestion(c),u=this.bonusUserDefaultPalette.getValue();a==o.ColorChooserVE.defaultId?(r=this.getBuiltInColorPalettesForStyle(l),u&&r.unshift(u)):r=d.paletteData;for(var p=0,g=0;g<r.length;g++)if(t==r[g]){p=g;break}var h=!1;a==o.ColorChooserVE.defaultId&&u&&0===p&&(h=!0);var C=new ClientAction.ColorPaletteChangeData(p,r.length,s,l,JSON.stringify(void 0===t?void 0:t.getLoggingData()),JSON.stringify(void 0===i?void 0:i.getLoggingData()),this._selectedColorOptionId.getValue(),h);ActionLogger.RecordClientAction(C),e.Model.currentUndoManager().get(this.view.getPageId()).captureUserAction(function(){TDB.applyUpdate(function(){n._selectedColorPalette.setValue(t),n._selectedPaletteIndex.setValue(p),n._selectedPaletteColorOptionId.setValue(n._selectedColorOptionId.getValue())}),n._styleManager.setColorOverride(t)},"User selected a color palette for their Sway")}},t.prototype.getPaletteOptions=function(t){t&&t.watch(this.notifyPaletteUpdate);var i=this._selectedColorOptionId.getWatchedValue(t),r=this._styleManager.getSelectedStyle(t),a=this.calculateCacheId(i,r),s=o.ColorSuggestionsCache.getInstance().getColorSuggestion(a);if(i==o.ColorChooserVE.defaultId)return this.getDefaultPaletteOptions(t);if(!s||!s.paletteData||s.paletteReadyStatus!=o.PaletteReadyStatus.yes)return[];for(var l=[],c=[],d=0;d<s.paletteData.length;d++){var u={colorPaletteData:s.paletteData[d],styleManager:this._styleManager,listIndex:void 0,description:ResourceManager.ResolveString(Resources.ColorPaletteButtonDescription,[d+1]),tooltip:ResourceManager.ResolveString(Resources.ColorPaletteButtonDescription,[d+1]),context:this,onAction:this.selectColorPalette};l=l.concat(u),c.push(this.getStyleOption(r,s.paletteData[d]))}var p=e.Model.StoryModel.traversalModel.getCulture(t);return n.currentStylePreviewManager().get(this.view.getPageId()).batchStyles(c,0,!0,p),l},t.prototype.calculateCacheId=function(e,t,n){if(this.isCustomColorId(e)){var i=this.getCustomColorValue(e,n);return o.ColorChooserVE.calculateCustomColorCacheId(i,t)}return o.ColorChooserVE.calculateColorPaletteCacheId(e,t)},t.prototype.isCustomColorId=function(e){return e.substr(0,o.ColorChooserVE.customColorOptionIdPrefix.length)===o.ColorChooserVE.customColorOptionIdPrefix},t.prototype.getCustomColorValue=function(t,n){var i=parseInt(t.substr(o.ColorChooserVE.customColorOptionIdPrefix.length)),r=e.Model.StoryModel.traversalModel.getCustomColors(n).getCollection(n)[i];return r?Color.parse(r).toHexString():null},t.prototype.selectColorOption=function(e){var t=this;e!=this._selectedColorOptionId.getValue()&&TDB.applyUpdate(function(){t._selectedColorOptionId.setValue(e)})},t.prototype.calculatePaletteMessage=function(e){e.watch(this.notifyPaletteUpdate);var t=e.watchValue(this._selectedColorOptionId),n=this._styleManager.getSelectedStyle(e),i=o.ColorChooserVE.calculateColorPaletteCacheId(t,n),r=o.ColorSuggestionsCache.getInstance().getColorSuggestion(i);return null==r||r.paletteReadyStatus==o.PaletteReadyStatus.no||null==r.paletteData?Resources.ColorPaletteSectionMessageWaiting:(r.paletteReadyStatus,o.PaletteReadyStatus.error,Resources.ColorPaletteSectionMessageError)},t.prototype.isUserEnteringCustomColor=function(){this.view.showCustomColorEntry.getValue()||this.view.customColorEntry.setupCustomColorEntry(),FRE.FirstRunTriggers.newCustomColorClicked(),this.view.customColorEntry.show()},t.prototype.updateSelectedOptionOnOptionDelete=function(e){var t=this;if(e===this._selectedColorOptionId.getValue())for(var n=this.view.colorOptionsCarousel.carouselList.getActivatableChildren(),i=0;i<n.length;i++){var r=function(i){var r=null;if(n[i]instanceof o.CustomColorOptionVE&&e===n[i].getOptionId()){var a=i+1;return a<n.length&&(n[a]instanceof o.CustomColorOptionVE?r=e:n[a]instanceof o.ColorOptionVE&&(r=n[a].getOptionId()),a=i),null===r&&i>2&&(n[a=i-1]instanceof o.CustomColorOptionVE?r=n[a].getOptionId():n[a]instanceof o.ColorOptionVE&&(r=n[a].getOptionId())),null===r&&(a=0,r=o.ColorChooserVE.defaultId),TDB.applyUpdate(function(){t._selectedColorOptionId.setValue(r)}),{value:a}}}(i);if("object"==typeof r)return r.value}return-1},t.prototype.setColorOptionFocus=function(e){var t=this.view.colorOptionsCarousel.carouselList.getActivatableChildren();t.length>e&&t[e].setFocus()},t.prototype.isPaletteMessageVisible=function(e){e.watch(this.notifyPaletteUpdate);var t=e.watchValue(this._selectedColorOptionId);if(t==o.ColorChooserVE.defaultId)return!1;var n,i=this._styleManager.getSelectedStyle(e);if(this.isCustomColorId(t)){var r=this.getCustomColorValue(t,e);if(!r)return!1;n=o.ColorChooserVE.calculateCustomColorCacheId(r,i)}else n=o.ColorChooserVE.calculateColorPaletteCacheId(t,i);var a=o.ColorSuggestionsCache.getInstance().getColorSuggestion(n);return null==a||a.paletteReadyStatus==o.PaletteReadyStatus.no||a.paletteReadyStatus==o.PaletteReadyStatus.error||null==a.paletteData},t.prototype.shouldColorOptionDisabled=function(e,t){t&&t.watch(this.notifyPaletteUpdate);var n=this._styleManager.getSelectedStyle(t),i=o.ColorChooserVE.calculateColorPaletteCacheId(e,n),r=o.ColorSuggestionsCache.getInstance().getColorSuggestion(i);return null==r||r.paletteReadyStatus==o.PaletteReadyStatus.no||r.paletteReadyStatus==o.PaletteReadyStatus.error||null==r.paletteData},t.prototype.getState=function(){return{optionId:this._selectedPaletteColorOptionId.getValue(),paletteIndex:this._selectedPaletteIndex.getValue(),palette:this._selectedColorPalette.getValue()}},t.prototype.setState=function(e){this._selectedPaletteColorOptionId.setValue(e.optionId),void 0!==e.palette?this._selectedColorPalette.setValue(new n.ColorPaletteData(e.palette.imageId,e.palette.variation,e.palette.seedColors,e.palette.dynamicStyleId,e.palette.colorOptionId,e.palette.colorPalette,e.palette.backgroundSetId,e.palette.telemetryData)):this._selectedColorPalette.setValue(void 0),this._selectedPaletteIndex.setValue(e.paletteIndex)},t}();t.ColorChooserViewModel=a}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.View.ViewModel,i=function(e){function n(n,i){var r=this,a=new o.ColorDefaultOptionViewModel({styleManager:i.styleManager,selectedId:i.selectedId});return r=e.call(this,n,{calculateChecked:function(e){return a.getSelectedColorOptionId(e)===t.ColorChooserVE.defaultId},buttonId:ClientAction.ButtonId.DesignPane_ColorDefaultOption,listIndex:i.listIndex,description:{value:Resources.ColorDefaultOptionLabel},tooltip:{value:Resources.ColorDefaultOptionLabel}})||this,r.viewModel=a,r}return __extends(n,e),n.prototype.wrapperAttrArgs=function(e){return this.getOptionAttrArgs(e)},n.prototype.imageAttrArgs=function(e){return{src:StoryApp.Common.UrlHelper.getInstance().getHomepageContent("CuratedColorSwatch.png"),role:Aria.Roles.Presentation}},n.prototype.labelTextArgs=function(e){return Resources.ColorDefaultOptionLabel},n.prototype.onAction=function(e){var n=this;return ActionLogger.RecordClientAction(new ClientAction.ButtonClickAction(ClientAction.ButtonId.ColorPane_ColorImageDefaultOption,Diag.ULSCat.msoulscat_Story_Preview)),TDB.applyUpdate(function(){n.viewModel.setSelectedColorOptionId(t.ColorChooserVE.defaultId)}),TDB.EventPropagation.Bubble},n}(n.CarouselListItemVE);t.ColorDefaultOptionVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(e){this._styleManager=e.styleManager,this._selectedId=e.selectedId}return e.prototype.getSelectedColorOptionId=function(e){return e.watchValue(this._selectedId)},e.prototype.setSelectedColorOptionId=function(e){return this._selectedId.setValue(e)},e}();e.ColorDefaultOptionViewModel=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.View.ViewModel,i=function(e){function t(t,n){var i=this,r=new o.ColorOptionViewModel(n.viewModelArgs);return i=e.call(this,t,{calculateChecked:function(e){return r.getSelectedOptionId(e)===r.getImageContent().id},buttonId:ClientAction.ButtonId.DesignPane_ColorOption,listIndex:n.listIndex,description:{value:n.description},tooltip:{value:n.tooltip}})||this,i.viewModel=r,i.args=n,i}return __extends(t,e),t.prototype.wrapperAttrArgs=function(e){return this.getOptionAttrArgs(e)},t.prototype.imageStyleArgs=function(e){return{opacity:this.args.getColorOptionDisabled.call(this.args.context,this.viewModel.getImageContent().id,e)?"0.6":"1"}},t.prototype.imageAttrArgs=function(e){return{src:this.viewModel.calculateImageURL(e),alt:"",role:Aria.Roles.Presentation}},t.prototype.onAction=function(e){return e instanceof MouseEvent&&1!=e.which?TDB.EventPropagation.Bubble:(ActionLogger.RecordClientAction(new ClientAction.ButtonClickAction(ClientAction.ButtonId.ColorPane_ColorImageOption,Diag.ULSCat.msoulscat_Story_Style,{ListIndex:this.args.listIndex.toString(),ListLength:this.parentCarouselList.getListLength().toString(),ImageId:this.viewModel.getImageContent().id})),this.args.onAction.call(this.args.context,this.viewModel.getImageContent().id),TDB.EventPropagation.Bypass)},t.prototype.getOptionId=function(){return this.viewModel.getImageContent().id},t}(n.CarouselListItemVE);t.ColorOptionVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=function(){function e(e){this._styleManager=e.styleManager,this._selectedId=e.selectedId,this._imageContent=e.imageContent}return e.prototype.getImageContent=function(){return this._imageContent},e.prototype.getSelectedOptionId=function(e){return e.watchValue(this._selectedId)},e.prototype.calculateImageURL=function(e){return n.ImageController.calculateSourceUrl(this._imageContent,e)},e}();t.ColorOptionViewModel=o}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.View.ViewModel,i=function(e){function t(t,n){var i=this,r=new o.ColorPaletteViewModel({colorPaletteData:n.colorPaletteData,styleManager:n.styleManager});return i=e.call(this,t,{calculateChecked:function(e){return e.watchValue(r.getStyleManager().selectedColorPalette)===r.getColorPaletteData()},buttonId:ClientAction.ButtonId.DesignPane_ColorPalette,listIndex:n.listIndex,description:{value:n.description},tooltip:{value:n.tooltip}})||this,i.viewModel=r,i.args=n,i}return __extends(t,e),t.prototype.wrapperAttrArgs=function(e){return this.getOptionAttrArgs(e)},t.prototype.imageAttrArgs=function(e){var t=this.viewModel.getStyleManager(),n=t.getSelectedStyleOption(e);n.setColorPalette(this.viewModel.getColorPaletteData().colorPalette),n.setColorOptionId(this.viewModel.getColorPaletteData().colorOptionId),n.setSeedColorOverrides(this.viewModel.getColorPaletteData().seedColors);var o=this.viewModel.getColorPaletteData().backgroundSetId;null!=o&&""!==o?n.setBackgroundSetId(o):n.setBackgroundSetId(t.sessionBackgroundSetId);var i=this.viewModel.getStyleManager().getStylePreviewImageAttributes(n,e);return i.alt="",i[Aria.Attributes.Role]=Aria.Roles.Presentation,i},t.prototype.onAction=function(e){var t=new ClientAction.ButtonClickAction(ClientAction.ButtonId.ColorPane_ColorPaletteOption,Diag.ULSCat.msoulscat_Story_Style,{ListIndex:this.args.listIndex.toString(),ListLength:this.parentCarouselList.getListLength().toString()});return ActionLogger.RecordClientAction(t),this.args.onAction.call(this.args.context,this.viewModel.getColorPaletteData()),TDB.EventPropagation.Bypass},t}(n.CarouselListItemVE);t.ColorPaletteVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(e){this._styleManager=e.styleManager,this._colorPaletteData=e.colorPaletteData}return e.prototype.getStyleManager=function(){return this._styleManager},e.prototype.getColorPaletteData=function(){return this._colorPaletteData},e}();e.ColorPaletteViewModel=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel,o=function(e){function o(t,o){var i=e.call(this,t)||this;return i.viewModel=new n.FontSetChooserViewModel(i,{styleManager:o.styleManager}),i.statusText=TDB.watcherTag(596473247,i,i,i.getFontSetChooserStatusText),i.readyToDisplay=TDB.watcherTag(596473248,i,i,i.isReadyToDisplay),i}return __extends(o,e),o.prototype.dropdownListArgs=function(){var e={headerText:Resources.FontSetChooserTitle,headerId:o.fontSetChooserHeaderId,statusText:this.statusText,wrapperClassName:{value:"FontSetChooserWrapper"},readyToDisplay:this.readyToDisplay,dropdownButtonArgs:this.viewModel.getSelectedOption(),listItemType:t.FontSetOptionVE,listItemsArgs:{watchable:this.viewModel.fontSetOptionsArgs},dropdownTelemetryId:ClientAction.ButtonId.DesignPane_FontSetChooser_Dropdown,ulsCategory:Diag.ULSCat.msoulscat_Story_Style};return new TDB.ChildArgs(VE.DropdownListVE,e)},o.prototype.setDropdownVisibility=function(e){this.dropdownList.setDropdownVisibility(e)},o.prototype.isReadyToDisplay=function(e){var t=this.viewModel.isInWaitingState(e),n=this.viewModel.isInErrorState(e);return!t&&!n},o.prototype.getFontSetChooserStatusText=function(e){var t=this.viewModel.isInWaitingState(e),n=this.viewModel.isInErrorState(e),o=void 0;return t?o=Resources.FontSetChooserStatusWaiting:n&&(o=Resources.FontSetChooserStatusError),o},o.fontSetChooserHeaderId="FontSetChooserHeader",o}(TDB.FocusableViewElement);t.FontSetChooserVEBase=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=function(){function t(e,t){this.view=e,this.styleManager=t.styleManager,this.fontSetOptionsArgs=TDB.watcherTag(596473244,this,e,this.getFontSetOptionModels),this.selectedFontSetOption=TDB.watcherTag(596473245,this,e,this.getSelectedFontSetOption);var n={styleManager:this.styleManager,isSelected:{value:!1},fontSetOptionData:this.selectedFontSetOption,context:this,onAction:this.fontSetOptionOnAction,buttonId:ClientAction.ButtonId.DesignPane_FontSetOption,description:{compute:new TDB.ComputedOptionArgs(this,this.getSelectedFontSetDescription)}};this.fontSetOptionDropdownButtonArgs=n}return t.prototype.getSelectedFontSetDescription=function(e){var t=this.getSelectedFontSetOption(e);return t?ResourceManager.ResolveString(Resources.FontSetButtonDescription,[t.headingFontDescription,t.bodyFontDescription]):Resources.FontSetChooserTitle},t.prototype.getFontSetOptionModels=function(e){var t=this.styleManager.getFontSetOptions(e),n=this.styleManager.getSelectedFontSet(e),o=[];if(t&&t.length>0){""===n&&(n=t[0].id);for(var i=0;i<t.length;i++){var r={styleManager:this.styleManager,isSelected:{value:n===t[i].id},fontSetOptionData:TDB.watchableTag(596473246,this,t[i]),context:this,onAction:this.fontSetOptionOnAction,buttonId:ClientAction.ButtonId.DesignPane_FontSetOption,description:{value:t[i]?ResourceManager.ResolveString(Resources.FontSetButtonDescription,[t[i].headingFontDescription,t[i].bodyFontDescription]):void 0},tooltip:{value:t[i]?ResourceManager.ResolveString(Resources.FontSetButtonDescription,[t[i].headingFontDescription,t[i].bodyFontDescription]):void 0}};o.push(r)}}return o},t.prototype.getStyleManager=function(){return this.styleManager},t.prototype.isInWaitingState=function(e){return this.styleManager.waitingForFontSets(e)},t.prototype.isInErrorState=function(e){return this.styleManager.errorGettingFontSets(e)},t.prototype.getSelectedFontSetOption=function(e){var t=this.styleManager.getFontSetOptions(e),n=this.styleManager.getSelectedFontSet(e);if(t&&t.length>0){return null===n||""===n?t[0]:t.firstOrDefault(function(e){return e.id===n})}},t.prototype.getSelectedOption=function(){return this.fontSetOptionDropdownButtonArgs},t.prototype.fontSetOptionOnAction=function(t,n,o){var i=this;if(t!==Aria.Roles.Button&&o){var r=o.id;e.Model.currentUndoManager().get(this.view.getPageId()).captureUserUpdate(function(){i.styleManager.setFontSet(r)},"User changed the Sway font set");var a=new ClientAction.ButtonClickAction(ClientAction.ButtonId.DesignPane_FontSetOption,Diag.ULSCat.msoulscat_Story_Style,{ListIndex:n.toString(),ListLength:this.styleManager.getFontSetOptions().length.toString(),FontSetId:r});ActionLogger.RecordClientAction(a)}return!1},t}();t.FontSetChooserViewModel=n}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.View.ViewModel,i=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.args=n,i._viewModel=new o.FontSetOptionViewModel(i,{styleManager:n.styleManager}),i}return __extends(t,e),t.prototype.fontSetOptionImageAttrArgs=function(e){var t=this.args.fontSetOptionData.getWatchedValue(e);return{src:t?t.images[0].url:void 0}},t.prototype.onAction=function(t){return e.prototype.onAction.call(this,t),this.args.role!==Aria.Roles.Button&&this.isSelected()?TDB.EventPropagation.Bypass:this.args.onAction.call(this.args.context,this.args.role,this.dropdownList.getListIndex(this.args),this.args.fontSetOptionData.getWatchedValue())},t.prototype.getDescription=function(e){var t=this.args.fontSetOptionData.getWatchedValue(e);return t?ResourceManager.ResolveString(Resources.FontSetButtonDescription,[t.headingFontDescription,t.bodyFontDescription]):void 0},t}(n.DropdownListItemVE);t.FontSetOptionVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(e,t){this.args=t}return e.prototype.getStyleManager=function(){return this.args.styleManager},e}();e.FontSetOptionViewModel=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.View.ViewModel,i=function(e){function i(t,n){var i=e.call(this,t)||this;return i.args=n,i._viewModel=new o.StyleChooserViewModel(i,{styleManager:n.styleManager,visibility:n.styleChooserPaneVisible}),i}return __extends(i,e),i.prototype.isVisible=function(e){return this._viewModel.isVisible(e)},i.prototype.selectionDescriptionTextArgs=function(e){return StoryApp.Common.Branding.getStringStylePaneSelectionDescription()},i.prototype.stylePreviewImageAttrArgs=function(e){return this.parent.getViewModel().getPreviewImageAttribute(e)},i.prototype.styleCustomizeButtonArgs=function(){var e={buttonId:ClientAction.ButtonId.DesignPane_CustomizeButton,click:this.customizeButtonClick,context:this,cssClass:{value:"StylePaneCustomizeButton"},text:{value:Resources.ButtonCustomize},tabIndex:this.args.customizeButtonTabIndex};return new TDB.ChildArgs(n.TextButtonVE,e)},i.prototype.customizeButtonClick=function(e){return ActionLogger.RecordClientAction(new ClientAction.ButtonClickAction(ClientAction.ButtonId.DesignPane_CustomizeButton,Diag.ULSCat.msoulscat_Story_Style)),this.args.customizeButtonClicked.call(this.parent),TDB.EventPropagation.Bypass},i.prototype.stylePaneOptionsWrapperClassNameArgs=function(){return"StylePaneOptionsWrapper StylePaneScroller native-scroller StylePaneOptionsWrapperWithLayoutInDesignPane"},i.prototype.styleOptionCarouselsArgs=function(){return this._viewModel.getStyleOptionCarousels()},i.prototype.stylePaneOptionsWrapperLoadingClassNameArgs=function(e){var t=this._viewModel.isInWaitingState(e),n=this._viewModel.isInErrorState(e);return t?"loading-spinner":n?"StyleCustomizePaneSectionHeader":""},i.prototype.stylePaneOptionsWrapperLoadingTextArgs=function(e){return this._viewModel.isInErrorState(e)?Resources.StyleChooserError:""},i.prototype.layoutChooserArgs=function(){var e={styleManager:this.args.styleManager,layoutChooserPaneVisible:this._viewModel.layoutChooserPaneVisible};return new TDB.ChildArgs(t.LayoutChooserVE,e)},i.prototype.mouseClicked=function(e){return TDB.EventPropagation.Bypass},i.prototype.getViewModel=function(){return this._viewModel},i}(TDB.FocusableViewElement);t.StyleChooserVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.View.ViewElements,i=StoryApp.Server.Styles,r=function(){function t(e,t){this._view=e,this._styleManager=t.styleManager,this._visibility=t.visibility,this._styleOptionsArgs=TDB.watcherTag(596473241,this,this._view,this.getStyleOptionsArgs),this._styleOptionCarousels=TDB.mappedWatcherOwnerTag(596473242,this,this._view,this.getStyleThemes,this.styleOptionCarouselConstructor),this._selectedStyle=TDB.watcherTag(596473243,this,this._view,this._styleManager.getSelectedStyle),this.stylePreviewManager=t.stylePreviewManager?t.stylePreviewManager:i.currentStylePreviewManager().get(e.getPageId()),this.layoutChooserPaneVisible=TDB.watchableTag(596455936,this,!0)}return t.prototype.isVisible=function(e){return this._visibility.getWatchedValue(e)},t.prototype.getDisplayNameForSelectedStyle=function(e){var t=this._styleManager.getSelectedStyle(e);if(t){var n=this._styleManager.getStyleOptions(e),o=0;for(var i in n)if(n.hasOwnProperty(i)&&(o++,-1!==t.indexOf(i)))return o.toString()}},t.prototype.getStyleThemes=function(e){for(var t=[],n={},i=0,r=e.watchValue(this._styleOptionsArgs);i<r.length;i++){var a=r[i];n[l=a.key]?n[l].push(a):n[l]=[a]}var s=0;for(var l in n){s++;var c={optionArgsAndTypes:n[l].map(function(e){return{optionArgs:e,optionType:o.StyleOptionVE}}),logString:"StylePane-Carousel: "+l,description:ResourceManager.ResolveString(Resources.DesignOptionCarouselDescription,[s]),nextButtonID:ClientAction.ButtonId.DesignPane_CarouselNext,nextButtonCssClass:"CarouselNext",nextButtonDescription:Resources.NextDesignButtonDescription,previousButtonID:ClientAction.ButtonId.DesignPane_CarouselPrevious,previousButtonCssClass:"CarouselPrevious",previousButtonDescription:Resources.PreviousDesignButtonDescription};t.push(c)}return t},t.prototype.getStyleOptionsArgs=function(t){var n=this._styleManager.getStyleOptions(t),o=[],i=0;for(var r in n)if(n.hasOwnProperty(r)){var a=n[r];i++;for(var s=0;s<a.length;s++){var l={key:r,styleManager:this._styleManager,listIndex:void 0,styleOption:a[s],description:ResourceManager.ResolveString(Resources.StyleOptionButtonDescription,[i,s+1]),tooltip:ResourceManager.ResolveString(Resources.StyleOptionButtonDescription,[i,s+1])};o.push(l)}var c=e.Model.StoryModel?e.Model.StoryModel.traversalModel.getCulture(t):CommonSettings.UserLocaleString;this.stylePreviewManager.batchStyles(a.slice(0,5),0,!1,c),this.stylePreviewManager.batchStyles(a.slice(5),0,!0,c)}return o},t.prototype.styleOptionCarouselConstructor=function(e){return new n.AccessibleCarouselVE(this._view,e)},t.prototype.isInErrorState=function(e){return i.currentStyleGalleryManager().get(this._view.getPageId()).getErrorGettingGalleryOptions(e)},t.prototype.isInWaitingState=function(e){return i.currentStyleGalleryManager().get(this._view.getPageId()).getWaitingForGalleryOptions(e)},t.prototype.getStyleOptionCarousels=function(){return this._styleOptionCarousels},t}();t.StyleChooserViewModel=r}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.View.ViewModel,i=function(t){function n(e,n){var i=this,r=new o.StyleOptionViewModel({styleTheme:n.key,styleOption:n.styleOption,styleManager:n.styleManager,listIndex:n.listIndex});return i=t.call(this,e,{context:r,calculateChecked:r.isStyleOptionSelected,buttonId:ClientAction.ButtonId.DesignPane_StyleOption,listIndex:n.listIndex,description:{value:n.description},tooltip:{value:n.tooltip}})||this,i._viewModel=r,i}return __extends(n,t),n.prototype.wrapperAttrArgs=function(e){return this.getOptionAttrArgs(e)},n.prototype.imageAttrArgs=function(e){var t=this._viewModel.getStyleManager().getStylePreviewImageAttributes(this._viewModel.getStyleOption(),e);return t.alt="",t[Aria.Attributes.Role]=Aria.Roles.Presentation,t},n.prototype.onAction=function(t){var n=this;return ActionLogger.RecordClientAction(new ClientAction.ButtonClickAction(ClientAction.ButtonId.MoodPane_MoodOption,Diag.ULSCat.msoulscat_Story_Style,{ListIndex:this._viewModel.getListIndex().toString(),ListLength:this.parentCarouselList.getListLength().toString(),ColorOptionId:this._viewModel.getStyleOption().colorOptionId,StyleId:this._viewModel.getStyleOption().styleId,BackgroundSetId:this._viewModel.getStyleOption().backgroundSetId,FontSetId:this._viewModel.getStyleOption().fontSetId,StyleVariationId:this._viewModel.getStyleOption().styleVariationId,FilterSetId:this._viewModel.getStyleOption().filterSetId})),e.Model.currentUndoManager().get(this.pageId).captureUserUpdate(function(){n._viewModel.getStyleManager().changeStyles(n._viewModel.getStyleOption())},"User changed the Sway style"),TDB.EventPropagation.Bypass},n}(n.CarouselListItemVE);t.StyleOptionVEBase=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(e){this._styleTheme=e.styleTheme,this._styleOption=e.styleOption,this._styleManager=e.styleManager,this._listIndex=e.listIndex}return e.prototype.getStyleOption=function(){return this._styleOption},e.prototype.isStyleOptionSelected=function(e){return this._styleOption===e.watchValue(this._styleManager.selectedStyleOption)},e.prototype.getStyleManager=function(){return this._styleManager},e.prototype.getListIndex=function(){return this._listIndex},e}();e.StyleOptionViewModel=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(t){this._card=t.card,this._textModel=t.textModel,this._cardSelectionManager=t.cardSelectionManager,this._textAggregator=t.textAggregator,this._fileUploader=t.fileUploader,this._cardDefinitionManager=t.cardDefinitionManager,this._cardsContainer=t.cardsContainer,this._onCanvas=t.onCanvas,this.abilities=t.abilities||e.getDefaultAbilities(),this.isEmpty=TDB.watchableTag(596455906,this,!0),this.hasFocus=TDB.watchableTag(596455907,this,!1)}return e.getDefaultAbilities=function(){return{header:!0,emphasis:!0,special:!0,link:!0,bullets:!0,numbers:!0,direction:!0}},e.prototype.getModel=function(){return this._textModel},e.prototype.getCardSelectionManager=function(){return this._cardSelectionManager},e.prototype.getCardDefinitionManager=function(){return this._cardDefinitionManager},e.prototype.getTextAggregator=function(){return this._textAggregator},e.prototype.getFileUploader=function(){return this._fileUploader},e.prototype.getCardsContainer=function(){return this._cardsContainer},e.prototype.getCard=function(){return this._card},e.prototype.isOnCanvs=function(){return this._onCanvas},e}();e.CommonTextViewModel=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var TextEditor;!function(e){function t(){return"undefined"!=typeof RTE}var n=StoryAppEdit.Model.SM,o=StoryAppEdit.View.ViewModel,i=function(){function e(){}return e.AREA="AREA",e.B="B",e.BODY="BODY",e.BUTTON="BUTTON",e.BR="BR",e.CENTER="CENTER",e.DEL="DEL",e.EM="EM",e.EMBED="EMBED",e.FONT="FONT",e.LI="LI",e.HTML="HTML",e.I="I",e.IFRAME="IFRAME",e.TABLE="TABLE",e.TBODY="TBODY",e.TFOOT="TFOOT",e.THEAD="THEAD",e.TD="TD",e.TH="TH",e.TR="TR",e.UL="UL",e.OBJECT="OBJECT",e.OL="OL",e.OPTION="OPTION",e.MENU="MENU",e.DIR="DIR",e.P="P",e.DIV="DIV",e.BLOCKQUOTE="BLOCKQUOTE",e.A="A",e.IMG="IMG",e.INPUT="INPUT",e.META="META",e.LINK="LINK",e.PARAM="PARAM",e.H1="H1",e.H2="H2",e.H3="H3",e.H4="H4",e.H5="H5",e.H6="H6",e.HR="HR",e.S="S",e.SELECT="SELECT",e.SPAN="SPAN",e.SCRIPT="SCRIPT",e.STYLE="STYLE",e.STRIKE="STRIKE",e.STRONG="STRONG",e.SUP="SUP",e.SUB="SUB",e.SVG="SVG",e.TEXTAREA="TEXTAREA",e.U="U",e.XML="XML",e}();e.HtmlTagNameUppercase=i,e.isRteLoaded=t;var r=function(){function e(){}return e.currentEditableRegion=function(){if(t())return RTE.Canvas.currentEditableRegion()},Object.defineProperty(e,"_editableRegions$i",{get:function(){return t()?RTE.Canvas._editableRegions$i:[]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"_lastEditableRegion$p",{get:function(){if(t())return RTE.Canvas._lastEditableRegion$p},set:function(e){t()&&(RTE.Canvas._lastEditableRegion$p=e)},enumerable:!0,configurable:!0}),e.isTextEditorCursor=function(e){if(e&&e.nodeType===Node.ELEMENT_NODE&&t()){var n=e.id;if(e.nodeName===i.SPAN&&n.indexOf("ms-rterangecursor")>-1)return!0}return!1},e.isTextEditorControlNode=function(e){if(e&&e.nodeType===Node.ELEMENT_NODE&&t()){var n=e,o=n.id,r=n.className,a=e.nodeName.toUpperCase();if(a===i.SPAN&&o.indexOf("ms-rterangepaste")>-1)return!0;if(a===i.DIV&&r.indexOf("ms-rte-pasteremove")>-1)return!0}return!1},e.textNodeContainsControlCharacter=function(e){return!(!e||e.nodeType!==Node.TEXT_NODE||!t())&&(e===RTE.Cursor._zeroWidthSpace$p&&RTE.Cursor._zeroWidthSpace$p.textContent.indexOf(o.TextHelperMethods.ZeroWidthSpace)>-1)},e.nodeContainsUserText=function(e){if(!e||!t())return!1;var n=e.textContent;return 0!==n.length&&(n.length>1||(!o.TextHelperMethods.isDescendant(e,RTE.Cursor._zeroWidthSpace$p)||RTE.Cursor._zeroWidthSpace$p.textContent!==o.TextHelperMethods.ZeroWidthSpace))},e.getNodeStyle=function(e){if(t())return RTE.RteUtility.getCurrentStyle(e)},e.editableRegionClassName="ms-rtestate-read",e}();e.Canvas=r;var a=function(){function o(){}return Object.defineProperty(o,"allowSafariDragAndDrop",{get:function(){if(t())return RTE.Cursor.allowSafariDragAndDrop},set:function(e){t()&&(RTE.Cursor.allowSafariDragAndDrop=e)},enumerable:!0,configurable:!0}),o.cursorRangeIsNowOutdated=function(){t()&&RTE.Cursor.cursorRangeIsNowOutdated()},o.getCurrentElement=function(){if(t())return RTE.Cursor.getCurrentElement()},o.get_isRangeOutdatedFromCurrentSelection=function(){return!!t()&&RTE.Cursor.get_isRangeOutdatedFromCurrentSelection()},o.update=function(){t()&&RTE.Cursor.update()},o.get_Range=function(){if(t())return this.textEditorRange||(this.textEditorRange=new e.CanvasRange),this.textEditorRange},o.updateRangeToCurrentSelection=function(){t()&&RTE.Cursor.updateRangeToCurrentSelection()},o._cancelCurrentWait$p=function(){t()&&RTE.Cursor._cancelCurrentWait$p()},o.bold=function(){t()&&(RTE.RichTextEditor.bold(),e.Cursor.updateRangeToCurrentSelection())},o.bulletedList=function(){t()&&RTE.RichTextEditor.bulletedList()},o.decreaseIndent=function(){t()&&RTE.RichTextEditor.decreaseIndent()},o.italic=function(){t()&&(RTE.RichTextEditor.italic(),e.Cursor.updateRangeToCurrentSelection())},o.numberedList=function(){t()&&RTE.RichTextEditor.numberedList()},o.isInBoldNode=function(){return!!t()&&RTE.RichTextEditor.queryBold().get_applied()},o.isInBulletedList=function(){return!!t()&&RTE.RichTextEditor.queryBulletedList().get_applied()},o.queryDirection=function(t){var o,i=window.getSelection().anchorNode;if(i){o=i.nodeType===Node.TEXT_NODE?i.parentNode:i;var r=e.Canvas.getNodeStyle(o);if(r)return"rtl"===r.direction.toLowerCase()?n.TextDirection.RightToLeft:n.TextDirection.LeftToRight}return t?n.TextDirection.RightToLeft:n.TextDirection.LeftToRight},o.isInItalicNode=function(){return!!t()&&RTE.RichTextEditor.queryItalic().get_applied()},o.isInLinkUrl=function(){return!!t()&&RTE.RichTextEditor.queryLinkUrl().get_enabled()},o.isInNumberList=function(){return!!t()&&RTE.RichTextEditor.queryNumberedList().get_applied()},o.removeLink=function(){t()&&RTE.RichTextEditor.removeLink()},o.setDirection=function(e){t()&&RTE.RichTextEditor.setDirection(e)},o.setLinkUrl=function(e){t()&&RTE.RichTextEditor.setLinkUrl(e)},o.cursorStartId="ms-rterangecursor-start",o.cursorEndId="ms-rterangecursor-end",o}();e.Cursor=a;var s=function(){function n(){}return n.prototype.getRange=function(){if(t())return RTE.Cursor.get_range()},n.prototype.clear=function(){t()&&(this.getRange().clear(),e.Cursor.cursorRangeIsNowOutdated())},n.prototype.deleteContent=function(){this.getRange().deleteContent()},n.prototype.getEditableRegion=function(){return t()&&RTE.Cursor.get_isRangeOutdatedFromCurrentSelection()?RTE.BrowserCursor.getEditableRegion():this.getRange().getEditableRegion()},n.prototype.get_endMarker=function(){if(t())return this.getRange().get_endMarker()},n.prototype.get_startMarker=function(){if(t())return this.getRange().get_startMarker()},n.prototype.get_text=function(){if(t())try{return this.getRange().get_text()}catch(e){return void StoryLog.StructuredTraceTag(595947934,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.warning,"Exception while getting the text of the current stored cursor",{message:e.message},e.stack)}},n.prototype.getInnerNodes=function(e){return t()?this.getRange().getInnerNodes(e):[]},n.prototype.isEmpty=function(){return!t()||(RTE.Cursor.get_isRangeOutdatedFromCurrentSelection()?RTE.BrowserCursor.isEmpty():this.getRange().isEmpty())},n.prototype.isValid=function(){return t()?RTE.Cursor.get_isRangeOutdatedFromCurrentSelection()?(StoryLog.TraceTag(595932251,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Range is outdated from current selection"),RTE.BrowserCursor.isValid()):(StoryLog.TraceTag(595932252,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Range is not outdated from current selection"),this.getRange().isValid()):(StoryLog.TraceTag(595932250,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Range not valid because RTE is not loaded"),!1)},n.prototype.moveAfterNode=function(e){t()&&this.getRange().moveAfterNode(e)},n.prototype.moveBeforeNode=function(e){t()&&this.getRange().moveBeforeNode(e)},n.prototype.moveToEndOfNode=function(e){t()&&this.getRange().moveToEndOfNode(e)},n.prototype.moveToRange=function(e){t()&&this.getRange().moveToRange(new RTE.Range(e))},n.prototype.moveToStartOfNode=function(e){t()&&this.getRange().moveToStartOfNode(e)},n.prototype.parentElement=function(){if(t())return RTE.Cursor.get_isRangeOutdatedFromCurrentSelection()?RTE.BrowserCursor.parentElement():this.getRange().parentElement()},n.prototype.selectAll=function(){t()&&this.getRange().selectAll()},n.prototype.insertTextBefore=function(e){return!!t()&&this.getRange().insertTextBefore(e)},n}();e.CanvasRange=s;var l=function(){function e(){}return e.clear=function(){t()&&RTE.Selection.getSelection().clear()},e.isSelection=function(){return!!t()&&!!RTE.Selection.getSelection()},e}();e.Selection=l;var c=function(){function e(){}return e.createStyledElement=function(e,n){t()&&RTE.FontCommands.createStyledElement(e,n)},e}();e.FontCommands=c;var d=function(){function e(){}return e.registerPasteModeWithCleanup=function(e){var t=this;return StoryApp.Preload.resourceFactory.loadResource(19).then(function(){t.pasteMode=new RTE.AsIsPasteMode,t.pasteMode.cleanupAndFinish=e,RTE.RtePasteManager.registerPasteMode(t.pasteMode)})},e.removeDefaultPasteMode=function(){return StoryApp.Preload.resourceFactory.loadResource(19).then(function(){RTE.RtePasteManager.removePasteMode(RTE.PasteMode.pastePlainId)})},e.finishCleanup=function(e){return StoryApp.Preload.resourceFactory.loadResource(19).then(function(){RTE.AsIsPasteMode.prototype.cleanupAndFinish.call(e)})},Object.defineProperty(e,"testOnly_BaseCleanupAndFinish",{get:function(){return RTE.AsIsPasteMode.prototype.cleanupAndFinish},set:function(e){RTE.AsIsPasteMode.prototype.cleanupAndFinish=e},enumerable:!0,configurable:!0}),e}();e.PasteManager=d;var u=function(){function e(){}return e.initialize=function(){var e=this;return this.initialized?$.Deferred().resolve().promise():(this.initialized=!0,this.eventListeners=new Sys.EventHandlerList,this.registeredEventListeners={},StoryApp.Preload.resourceFactory.loadResource(19).then(function(t){if(0===t.state){g.MyUiServices.registerClass("MyUiServices",RTE.UiServices);var n=new g.MyUiServices;RTE.UiServices.set_current(n),RTE.CanvasEvents.registerListener(RTE.CanvasEvents.editableRegionBlurEvent,function(t,n){e.redirectTextEditorControlEvent(e.textEditorLeavingEditorEvent,t,n)}),RTE.CanvasEvents.registerListener(RTE.CanvasEvents.editableRegionChangedEvent,function(t,n){e.redirectTextEditorControlEvent(e.textEditorContentChangedEvent,t,n)}),RTE.CanvasEvents.registerListener(RTE.CanvasEvents.editableRegionFocusEvent,function(t,n){e.redirectTextEditorControlEvent(e.textEditorFocusedEvent,t,n)}),RTE.CanvasEvents.registerListener(RTE.CanvasEvents.editableRegionSelectionEvent,function(t,n){e.redirectTextEditorControlEvent(e.textEditorRegionSelectionEvent,t,n)}),RTE.CanvasEvents.registerListener(RTE.CanvasEvents.handleShortcut,function(t,n){e.redirectTextEditorControlEvent(e.textEditorHandleShortcutEvent,t,n)})}else StoryLog.TraceTag(596473240,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.warning,"RTE failed to load")}))},e.redirectTextEditorControlEvent=function(e,t,n){if(this.registeredEventListeners[e]>0){var o=this.eventListeners.getHandler(e);if(o)try{o(t,n)}catch(e){Sys.Debug.assert(!1)}}},e.getNodeFromEvent=function(e){return RTE.CanvasEvents.getNodeFromEvent(e)},e.registerListener=function(e,t){var n=this;return this.initialize().then(function(){n.eventListeners.addHandler(e,t),n.registeredEventListeners[e]||(n.registeredEventListeners[e]=0),n.registeredEventListeners[e]=n.registeredEventListeners[e]+1})},e.unregisterListener=function(e,t){return this.eventListeners.removeHandler(e,t),this.registeredEventListeners[e]=this.registeredEventListeners[e]-1,!0},e.testOnly_setEditableRegion=function(e){RTE.CanvasEvents.dispatchFocus(e)},e.textEditorLeavingEditorEvent="textEditorLeavingEditorEvent",e.textEditorContentChangedEvent="textEditorContentChanged",e.textEditorFocusedEvent="textEditorFocusedEvent",e.textEditorRegionSelectionEvent="textEditorRegionSelectionEvent",e.textEditorHandleShortcutEvent="textEditorHandleShortcutEvent",e.initialized=!1,e}();e.CanvasEvents=u;var p=function(){function t(){}return t.testOnly_setEditableRegion=function(e){RTE.CanvasEvents.dispatchFocus(e)},t.testOnly_fireEvent=function(t,n,o){void 0===o&&(o={});var i=void 0;switch(t){case e.CanvasEvents.textEditorContentChangedEvent:i=RTE.CanvasEvents.editableRegionChangedEvent;break;case e.CanvasEvents.textEditorFocusedEvent:i=RTE.CanvasEvents.editableRegionFocusEvent;break;case e.CanvasEvents.textEditorHandleShortcutEvent:i=RTE.CanvasEvents.handleShortcut;break;case e.CanvasEvents.textEditorLeavingEditorEvent:i=RTE.CanvasEvents.editableRegionBlurEvent;break;case e.CanvasEvents.textEditorRegionSelectionEvent:i=RTE.CanvasEvents.editableRegionSelectionEvent}i&&RTE.CanvasEvents.dispatchEvent(i,n,o)},t}();e.TestOnly=p;var g;!function(e){var t=function(){function e(){e.initializeBase(this)}return e.prototype.isFocusValidOnThisNode=function(e){return TDB.ViewElement.dataFor(e)instanceof StoryAppEdit.View.ViewElements.CommonTextVE},e.prototype.sendApplicationStateChangedEvent=function(){this.onApplicationStateChangedEvent&&this.onApplicationStateChangedEvent()},e}();e.MyUiServices=t}(g||(g={}))}(TextEditor||(TextEditor={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(){this.cursorChanged=!1}return e.prototype.markCursorChanged=function(){TextEditor.isRteLoaded()&&(this.cursorChanged||(this.cursorChanged=!0,TextEditor.Cursor.updateRangeToCurrentSelection()))},e.prototype.updateCursorIfNeeded=function(){if(TextEditor.isRteLoaded()&&this.cursorChanged){TextEditor.Cursor.update();var e=TextEditor.Cursor.get_Range(),t=e.get_startMarker().previousSibling,n=e.get_endMarker().nextSibling;if(e.isEmpty()&&(e.clear(),t&&n&&t.parentNode&&n.parentNode&&t.nodeType===Node.TEXT_NODE&&n.nodeType===Node.TEXT_NODE)){var o=t.textContent.length;t.textContent+=n.textContent,n.parentNode.removeChild(n);var i=document.createRange();i.setStart(t,o),i.setEnd(t,o);var r=window.getSelection();r.removeAllRanges(),r.addRange(i)}}},e}();e.TextFormatterCursorManager=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=StoryApp.View.Common,i=e.View.ViewModel,r=function(e){function t(t,n){var o=e.call(this,t)||this;return o._viewModel=new i.TextLinkDialogContentViewModel,o._args=n,o}return __extends(t,e),t.prototype.displayTextBoxLabelTextArgs=function(e){return Resources.TextLinkDialogDisplayTextBoxLabel},t.prototype.linkTextBoxLabelTextArgs=function(e){return Resources.TextLinkDialogLinkTextBoxLabel},t.prototype.linkErrorBodyTextArgs=function(e){return this._viewModel.getErrorMessage(e)},t.prototype.getLinkText=function(){var e;return this._args.link?e=$(this._args.link).text():this._args.range.isEmpty()||(e=this._args.range.get_text()),e||""},t.prototype.displayTextBoxArgs=function(){var e={cssClass:"TextLinkInputBox calibriRegular",text:this.getLinkText(),description:Resources.TextLinkDialogDisplayTextBoxLabel};return new TDB.ChildArgs(n.TextBoxVE,e)},t.prototype.getDisplayTextBox=function(){return this._displayTextBox},t.prototype.linkTextBoxArgs=function(){var e={cssClass:"TextLinkInputBox calibriRegular",text:this._args.link?this._args.link.getAttribute("href"):"",description:Resources.TextLinkDialogLinkTextBoxLabel,inputType:"url"};return new TDB.ChildArgs(n.TextBoxVE,e)},t.prototype.getLinkTextBox=function(){return this._linkTextBox},t.prototype.removeLinkButtonArgs=function(){if(this._args.link){var e={buttonId:ClientAction.ButtonId.CardToolbar_Link_RemoveLink,click:this.removeLinkClicked,context:this,cssClass:{value:"TextLinkRemoveLinkButton"},text:{value:Resources.TextLinkDialogRemoveLinkButton}};return new TDB.ChildArgs(n.TextButtonVE,e)}return null},t.prototype.removeLinkClicked=function(e){return this._args.client.removeLink(),o.DialogManager.closeCurrentDialog(),TDB.EventPropagation.Bypass},t.prototype.keyDown=function(e){return e.keyCode===KeyCodeType.EnterKey?(this._args.client.validateUrlAndCommit(),TDB.EventPropagation.PreventDefault):e.keyCode===KeyCodeType.EscapeKey?(o.DialogManager.closeCurrentDialog(),TDB.EventPropagation.PreventDefault):TDB.EventPropagation.Bubble},t.prototype.updateErrorMessage=function(e){var t=this;TDB.applyUpdate(function(){t._viewModel.setErrorMessage(e),t._linkTextBox.setFocus()})},t.prototype.onShowing=function(){""!==this.getLinkText()&&this._linkTextBox.setFocus()},t}(TDB.FocusableViewElement);t.TextLinkDialogContentVEBase=r}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(){this._errorMessage=TDB.watchableTag(596473222,this,"")}return e.prototype.setErrorMessage=function(e){this._errorMessage.setValue(e)},e.prototype.getErrorMessage=function(e){return this._errorMessage.getWatchedValue(e)},e}();e.TextLinkDialogContentViewModel=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=function(){function n(){}return n.canTryAutoLink=function(e){return n.isTriggerKey(e.keyCode)&&!t.TextHelperMethods.keyboardEventContainsModifierKey(e)&&!TextEditor.Cursor.isInLinkUrl()},n.getRangeToMoveBackCursorForAutoLink=function(e,o,i){if(void 0!==e.startContainer){var r,a;if(o===KeyCodeType.EnterKey){var s=t.TextHelperMethods.findParentBlockElement(e.startContainer);if(void 0===s)return void StoryLog.TraceTag(596452937,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.warning,"getRangeToMoveBackCursorForAutoLink: Could not find a parent block element: "+e);var l=s.previousSibling;if(null===l)return void StoryLog.TraceTag(596452938,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.warning,"getRangeToMoveBackCursorForAutoLink: Could not find parent block element's previous sibling: "+e);if(l.childNodes.length<=0)return void StoryLog.TraceTag(596452939,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.warning,"getRangeToMoveBackCursorForAutoLink: Parent block element's previous sibling had no children: "+e);r=l.childNodes[l.childNodes.length-1]}else{if(o!==KeyCodeType.SpaceKey)return void StoryLog.TraceTag(596452940,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.warning,"getRangeToMoveBackCursorForAutoLink: The input key was not an expected trigger key: "+o+".");r=e.startContainer,!t.TextHelperMethods.isBlockElement(e.startContainer)&&e.startOffset-n.moveBackForSpace<0&&(r=r.previousSibling)}if(i)for(;r&&r.nodeName!==TextEditor.HtmlTagNameUppercase.A;)r=(d=(c=StoryApp.Common.TextHelpers.getNodesByName(r,TextEditor.HtmlTagNameUppercase.A)).length>0?c[c.length-1]:void 0)||r.previousSibling;for(;r&&r.nodeType!==Node.TEXT_NODE;){var c=StoryApp.Common.TextHelpers.getNodesByType(r,Node.TEXT_NODE),d=c.length>0?c[c.length-1]:void 0;r=d||r.previousSibling}if(r){o===KeyCodeType.EnterKey?a=r.length-n.moveBackForEnter>0?r.length-n.moveBackForEnter:0:o===KeyCodeType.SpaceKey&&(a=e.startContainer.nodeType!==Node.TEXT_NODE||i?(a=i?r.length-(n.moveBackForSpace-1):r.length-n.moveBackForSpace)>0?a:0:e.startOffset-n.moveBackForSpace>0?e.startOffset-n.moveBackForSpace:0);var u=StoryApp.Utilities.createRange();if(void 0!==u)return u.setStart(r,a),u.setEnd(r,a),u;StoryLog.TraceTag(596452942,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.warning,"getRangeToMoveBackCursorForAutoLink: Tried to createRange on document but couldn't. (Check logs from RethrowLogger for more info.)")}else StoryLog.TraceTag(596452941,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.warning,"getRangeToMoveBackCursorForAutoLink: Could not find a node to anchor our moveBackRange on: "+e)}else StoryLog.TraceTag(596452936,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.warning,"getRangeToMoveBackCursorForAutoLink: Input originalRange had no startContainer: "+e)},n.isAutoLinkJustCreatedFlagOn=function(){return n.isTriggerKey(n.autoLinkJustCreated)},n.isTriggerKey=function(e){return-1!==n.triggerKeys.indexOf(e)},n.removeJustCreatedAutoLink=function(e,o){var i=t.TextHelperMethods.getCurrentRange();if(void 0!==i){var r=n.getRangeToMoveBackCursorForAutoLink(i,n.autoLinkJustCreated,!0);void 0!==r?(t.TextHelperMethods.moveCursorToRange(r),TextEditor.Cursor.update(),t.LinkUtilities.removeLink(e,"User removed link via backspace: autoLinkJustCreated flag ON"),t.TextHelperMethods.moveCursorToRange(i),o.preventDefault()):StoryLog.TraceTag(596452953,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.warning,"Tried to remove just created auto link but got unexpected input (e.g. malformed range or unexpected trigger key).")}},n.shouldKeyTurnOffAutoLinkJustCreatedFlag=function(e){return-1===n.flagExemptKeys.indexOf(e)},n.tryAutoLink=function(o,i,r,a){if(void 0===a&&(a=t.TextHelperMethods.getCurrentRange()),n.isTriggerKey(i)&&void 0!==a){e.View.ViewElements.CommonTextVE.commit();var s=n.getRangeToMoveBackCursorForAutoLink(a,i,!1);if(void 0!==s){t.TextHelperMethods.moveCursorToRange(s);var l=TextEditor.Cursor.get_Range();t.TextHelperMethods.expandCursorToAutoLink(l);var c=l.get_text();if(t.TextHelperMethods.moveCursorToRange(a),void 0!==c){var d=c.trim();if(t.LinkUtilities.isAutoUrl(d)||t.LinkUtilities.isEmail(d)){var u=d;t.LinkUtilities.isEmail(d)&&0!==d.indexOf("mailto")&&(u="mailto:"+d),t.TextHelperMethods.moveCursorToRange(s),t.LinkUtilities.createLink(o,"User added link via auto link",u,d,l,r),t.TextHelperMethods.moveCursorToRange(a),n.turnOnAutoLinkJustCreatedFlag(i)}}}else StoryLog.TraceTag(596452954,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.warning,"Tried to detect range to auto link but got unexpected input (e.g. malformed range or unexpected trigger key).")}},n.turnOffAutoLinkJustCreatedFlag=function(){n.autoLinkJustCreated=n.flagOff},n.turnOnAutoLinkJustCreatedFlag=function(e){n.autoLinkJustCreated=e},n.flagExemptKeys=[KeyCodeType.AltKey,KeyCodeType.CapsLockKey,KeyCodeType.ContextMenuKey,KeyCodeType.CtrlKey,KeyCodeType.InsertKey,KeyCodeType.NumLockKey,KeyCodeType.OSKey,KeyCodeType.PauseBreakKey,KeyCodeType.ScrollLockKey,KeyCodeType.ShiftKey],n.flagOff=-1,n.moveBackForEnter=1,n.moveBackForSpace=2,n.triggerKeys=[KeyCodeType.EnterKey,KeyCodeType.SpaceKey],n.autoLinkJustCreated=n.flagOff,n}();t.AutoLinkHandler=n}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel,o=function(o){function i(e,t){var n=o.call(this,e,{tabIndex:t.tabIndex})||this;n.lastOperationDelete=!1,n.forwardKeyCount=0,n.ongoingUserAction=!1,n.imeCompositionActive=!1,n.inPasteAction=!1,n._viewModel=t.viewModel,n.placeholder=t.placeholder?t.placeholder:"",n.css=t.css?t.css:null,n.resourceFactory=t.resourceFactory;var i=n._viewModel.getTextAggregator();return i&&i.addCommonTextVE(n),n.telemetryId=t.telemetryId,n.socketParentCardType=t.socketParentCardType,n.selectionChanged=TDB.notifierTag(596473182,n),n}return __extends(i,o),i.prototype.commit=function(t,n){return this.ongoingUserAction&&(e.Model.currentUndoManager().get(this.pageId).cancelUserAction(),this.ongoingUserAction=!1),this.inPasteAction&&(this.inPasteAction=!1),this.onCommit(t,n)},i.commit=function(e){var t=null;return i.focusedTextVE&&(t=i.focusedTextVE.commit(e)),t},i.prototype._create=function(e,t){var o=this;this.resourceFactory.loadResource(19).then(function(){if(!o.disposed){var t=!1;TextEditor.Cursor.allowSafariDragAndDrop=!0,o.setupListener(TextEditor.CanvasEvents.textEditorHandleShortcutEvent),o.setupListener(TextEditor.CanvasEvents.textEditorContentChangedEvent),o.setupListener(TextEditor.CanvasEvents.textEditorFocusedEvent),o.setupListener(TextEditor.CanvasEvents.textEditorLeavingEditorEvent),o.setupListener(TextEditor.CanvasEvents.textEditorRegionSelectionEvent),i.registerPasteVE(o,o.element),TDB.on(o,$(o.element),"compositionstart",function(e){o.imeCompositionActive=!0}),TDB.on(o,$(o.element),"compositionend",function(e){o.imeCompositionActive=!1,StoryApp.Utilities.browser.isFirefox&&(o.lastModifiedDate=new Date)}),TDB.on(o,$(o.element),"keydown",function(e){if(e.which===KeyCodeType.BackspaceKey||e.which===KeyCodeType.DeleteKey){if(e.which===KeyCodeType.BackspaceKey&&StoryPageEditSettings.EdgePageReloadWorkaroundEnabled&&n.TextHelperMethods.AddEmptyParagraphAfterIfNeeded(),StoryPageEditSettings.AutoLinkEnabled&&e.keyCode===KeyCodeType.BackspaceKey&&!n.TextHelperMethods.keyboardEventContainsModifierKey(e)){var t=n.TextHelperMethods.getCurrentRange();if(void 0===t)return;n.AutoLinkHandler.isAutoLinkJustCreatedFlagOn()?n.AutoLinkHandler.removeJustCreatedAutoLink(o.pageId,e):n.LinkUtilities.rangeAtEndOfLink(t)&&(n.LinkUtilities.removeLink(o.pageId,"User removed link via backspace: autoLinkJustCreated flag OFF"),e.preventDefault())}o.startAction(!1,!0),o.forwardKeyCount=0}else if(e.which===KeyCodeType.EnterKey&&!StoryApp.Utilities.browser.isWebkit){var i=n.TextHelperMethods.getFirstParentWithSpecifiedTag(TextEditor.Cursor.getCurrentElement(),TextEditor.HtmlTagNameUppercase.LI,TextEditor.Canvas.currentEditableRegion());i&&!TextEditor.Canvas.nodeContainsUserText(i)&&n.TextFormatter.removeElementStructureIfPresent(i)}StoryPageEditSettings.AutoLinkEnabled&&n.AutoLinkHandler.shouldKeyTurnOffAutoLinkJustCreatedFlag(e.keyCode)&&n.AutoLinkHandler.turnOffAutoLinkJustCreatedFlag()}),TDB.on(o,$(o.element),"keypress",function(e){if(0!==e.charCode||e.keyCode!==KeyCodeType.BackspaceKey&&e.keyCode!==KeyCodeType.DeleteKey){o.forwardKeyCount++,e.which===".".charCodeAt(0)?t||(t=!0,platform.setImmediate(function(){o.commit(!0,!0)}),o.forwardKeyCount=0):(t=!1,o.forwardKeyCount>i.maxForwardKeyCount&&(o.commit(!0,!0),o.forwardKeyCount=1));var n=TextEditor.Cursor.get_Range();o.startAction(!0,n&&!n.isEmpty())}}),TDB.on(o,$(o.element),"keyup",function(e){o.imeCompositionActive||(e.keyCode===KeyCodeType.EnterKey&&o.commit(!0,!0),StoryPageEditSettings.AutoLinkEnabled&&n.AutoLinkHandler.canTryAutoLink(e)&&n.AutoLinkHandler.tryAutoLink(o.pageId,e.keyCode,o.isOnCanvas()))}),TDB.on(o,$(o.element),"cut",function(){var e=TextEditor.Cursor.get_Range();o.startAction(!1,e&&!e.isEmpty())}),TDB.on(o,$(o.element),"paste",function(){o.inPasteAction=!0;var e=TextEditor.Cursor.get_Range();o.startAction(!0,e&&!e.isEmpty())}),TDB.on(o,$(o.element),"dragover",o.onDragOver),TDB.on(o,$(o.element),"dragstart",o.onDragStart),TDB.on(o,$(o.element),"dragend",o.onDragEnd),o.setAriaAttributes(),o.focusableBinding=new TDB.View.Bindings.Focusable.Binding(o.element,e,o,o,o.FocusableInitArgs())}}).then(function(){if(!o.disposed&&!i.initialSetupCompleted)return i.initialSetupCompleted=!0,o.registerListeners(o.pageId)})},i.prototype.setAriaAttributes=function(){this.element&&(this.element.setAttribute(Aria.Attributes.Role,Aria.Roles.Textbox),this.element.setAttribute(Aria.Attributes.Multiline,Aria.BooleanState.True),this.element.setAttribute(Aria.Attributes.Label,this.placeholder))},i.prototype.startAction=function(n,o){var i=this;if(n===this.lastOperationDelete&&(this.commit(!0,!0),this.lastOperationDelete=!n),this.ongoingUserAction||(this.ongoingUserAction=!0,e.Model.currentUndoManager().get(this.pageId).startUserAction(function(){i.ongoingUserAction=!1,i.commit(!0,!0)})),this.parent instanceof t.CardVE){var r=this.parent;platform.setImmediate(function(){r.updateCardHeight(),o&&r.cardsContainer.computeCardDeckElements()})}},i.prototype.setupListener=function(e){null==i.listeners[e]&&(i.listeners[e]=[]);for(var t=0;t<i.listeners[e].length;t++)if(i.listeners[e][t].element===this.element)return void TDB.raiseRecoverableError("CommonTextVE.setupListener(): Multiple listeners are not allowed on one element for the same event.",TDB.LogLevel.error);i.listeners[e].push({element:this.element,textVE:this})},i.prototype.removeListener=function(e){if(null!=i.listeners[e])for(var t=0;t<i.listeners[e].length;t++)if(i.listeners[e][t].textVE==this)return i.listeners[e].splice(t,1),void(0===i.listeners[e].length&&(TextEditor.CanvasEvents.unregisterListener(e,i.canvasListeners[e]),delete i.canvasListeners[e]))},i.registerPasteVE=function(e,t){i.findPasteVE(t)||i.pasteListeners.push({element:t,textVE:e})},i.unregisterPasteVE=function(e){for(var t=0;t<i.pasteListeners.length;t++)if(i.pasteListeners[t].textVE===e)return void i.pasteListeners.splice(t,1)},i.findPasteVE=function(e){for(var t=0;t<i.pasteListeners.length;t++)if(i.pasteListeners[t].element===e)return i.pasteListeners[t].textVE;return null},i.prototype.registerListeners=function(t){var o=[];return o.push(TextEditor.CanvasEvents.registerListener(TextEditor.CanvasEvents.textEditorHandleShortcutEvent,i.canvasListeners[TextEditor.CanvasEvents.textEditorHandleShortcutEvent]=StoryApp.Utilities.safeCallback(function(e,t){for(var n=i.listeners[TextEditor.CanvasEvents.textEditorHandleShortcutEvent].length,o=0;o<n;o++)if(t.event&&i.listeners[TextEditor.CanvasEvents.textEditorHandleShortcutEvent][o].element===t.event.target){i.listeners[TextEditor.CanvasEvents.textEditorHandleShortcutEvent][o].textVE.onHandleShortcut(e,t);break}}))),o.push(TextEditor.CanvasEvents.registerListener(TextEditor.CanvasEvents.textEditorContentChangedEvent,i.canvasListeners[TextEditor.CanvasEvents.textEditorContentChangedEvent]=StoryApp.Utilities.safeCallback(function(e,t){for(var n=i.listeners[TextEditor.CanvasEvents.textEditorContentChangedEvent].length,o=0;o<n;o++)if(i.listeners[TextEditor.CanvasEvents.textEditorContentChangedEvent][o].element===t.editableRegion){i.listeners[TextEditor.CanvasEvents.textEditorContentChangedEvent][o].textVE.onEditableRegionChange(e,t);break}}))),o.push(TextEditor.CanvasEvents.registerListener(TextEditor.CanvasEvents.textEditorFocusedEvent,i.canvasListeners[TextEditor.CanvasEvents.textEditorFocusedEvent]=StoryApp.Utilities.safeCallback(function(e,t){for(var n=i.listeners[TextEditor.CanvasEvents.textEditorFocusedEvent].length,o=0;o<n;o++)if(i.listeners[TextEditor.CanvasEvents.textEditorFocusedEvent][o].element===t.newEditableRegion){i.listeners[TextEditor.CanvasEvents.textEditorFocusedEvent][o].textVE.onEditableRegionFocus(e,t);break}}))),o.push(TextEditor.CanvasEvents.registerListener(TextEditor.CanvasEvents.textEditorLeavingEditorEvent,i.canvasListeners[TextEditor.CanvasEvents.textEditorLeavingEditorEvent]=StoryApp.Utilities.safeCallback(function(e,t){for(var n=i.listeners[TextEditor.CanvasEvents.textEditorLeavingEditorEvent].length,o=0;o<n;o++)if(i.listeners[TextEditor.CanvasEvents.textEditorLeavingEditorEvent][o].element===t.oldEditableRegion){i.listeners[TextEditor.CanvasEvents.textEditorLeavingEditorEvent][o].textVE.onEditableRegionBlur(e,t);break}}))),o.push(TextEditor.CanvasEvents.registerListener(TextEditor.CanvasEvents.textEditorRegionSelectionEvent,i.canvasListeners[TextEditor.CanvasEvents.textEditorRegionSelectionEvent]=StoryApp.Utilities.safeCallback(function(e,t){for(var n=i.listeners[TextEditor.CanvasEvents.textEditorRegionSelectionEvent].length,o=0;o<n;o++)if(i.listeners[TextEditor.CanvasEvents.textEditorRegionSelectionEvent][o].element===t.editableRegion){i.listeners[TextEditor.CanvasEvents.textEditorRegionSelectionEvent][o].textVE.onEditableRegionSelection(e,t);break}}))),TextEditor.PasteManager.registerPasteModeWithCleanup(function(){var o,r=this,a=StoryApp.Utilities.getDocumentActiveElement(),s=this.arguments.container;if(!o&&a&&a.getAttribute("contenteditable")&&(o=a),!o)for(o=s.parentElement;o&&!o.getAttribute("contenteditable");)o=o.parentElement;!o&&this.arguments.editableRegion&&this.arguments.editableRegion.getAttribute("contenteditable")&&(o=this.arguments.editableRegion);var l=i.findPasteVE(o);if(l){l.getCardsContainer().closeActiveJackMenu();var c=l.getPasteHandlerArgs(),d=new n.TextPasteHandler(c);e.Model.currentUndoManager().get(t).captureUserUpdate(function(){var e=d.filterPaste(s,o,r);return i.commit(),{activeModelObjectIds:e}},"user pasted into a text area")}}),TextEditor.PasteManager.removeDefaultPasteMode(),$.when.apply($,o).promise()},i.prototype.registerPasteEventListener=function(){i.globalPasteEventListener&&i.globalPasteEventListenerId===this.id||(this.unregisterPasteEventListener(),i.globalPasteEventListenerId=this.id,window.addEventListener("paste",i.globalPasteEventListener=function(e){try{if(!TextEditor.Canvas.isTextEditorControlNode(StoryApp.Utilities.getDocumentActiveElement()))return;e.clipboardData&&e.clipboardData.items}catch(e){return void ActionLogger.RecordClientAction(new ClientAction.StorylinePasteException("EDP content pasted."))}if(e.clipboardData&&e.clipboardData.items)for(var t=e.clipboardData.items,n=0;n<t.length;n++){if(!(t[n].type.indexOf("image")>=0))return void(i.clipboardImages=[]);var o=t[n].getAsFile();if(o)i.clipboardImages.addunique(o);else{var r=t[n],a=" Type: "+t[n].type,s=r.kind?" kind: "+r.kind:" object did not have a kind property.";TDB.raiseRecoverableError("CommonTextVE.registerListeners(): 'paste' event found an image item that did not produce a file."+a+s,TDB.LogLevel.warning)}}}))},i.prototype.unregisterPasteEventListener=function(){i.globalPasteEventListener&&i.globalPasteEventListenerId===this.id&&(window.removeEventListener("paste",i.globalPasteEventListener),i.globalPasteEventListener=void 0,i.globalPasteEventListenerId=void 0)},i.prototype.onHandleShortcut=function(e,t){},i.prototype.onEditableRegionChange=function(e,t){},i.prototype.onEditableRegionFocus=function(e,t){this.registerPasteEventListener()},i.prototype.onEditableRegionBlur=function(e,t){this.unregisterPasteEventListener()},i.prototype.getModelIdForTextSelection=function(){var e=this.element;if(e){var t=n.TextHelperMethods.getSelection(e);if(t){var o=n.TextHelperMethods.findNodeAtCursorPosition(t.start,e,!1);if(o&&o.node&&o.node.parentNode instanceof HTMLElement){for(var i=o.node.parentNode;i&&i.id&&0==i.id.length;)i=i.parentElement;return i?n.TextHelperMethods.getModelId(i):void 0}}}},i.prototype.onEditableRegionSelection=function(e,t){var o=this;TDB.applyUpdate(function(){o.selectionChanged.notify()});var r=this.getModelIdForTextSelection();TDB.applyUpdate(function(){i.textSelectionModelId.setValue(r)});var a=this._viewModel.isEmpty;TDB.applyUpdate(function(){a.getValue()&&n.TextHelperMethods.nodeHasWordCharacters(o.element)?a.setValue(!1):a.getValue()||n.TextHelperMethods.nodeHasWordCharacters(o.element)||a.setValue(!0)})},i.prototype.onPasteCleanupAndFinish=function(e,t,n){},i.prototype.onDragOver=function(e){var t=TDB.ViewElement.dataFor(e.target);null!=t&&t.handleDragOrDropEvent(e,TDB.ViewElementDragDropEventType.DragOverEvent)},i.prototype.onDragStart=function(e){i.dragging=!0},i.prototype.onDragEnd=function(e){i.dragging=!1},i.prototype.updatePlaceholder=function(){for(var e=0;e<this.element.childNodes.length;e++){var t=this.element.childNodes[e].nodeName.toUpperCase();if(t==TextEditor.HtmlTagNameUppercase.UL||t==TextEditor.HtmlTagNameUppercase.OL)return void this.element.removeAttribute("data-placeholder")}""==$(this.element).text().replace(StoryApp.Common.TextHelpers.zeroWidthRegex,"")?this.element.setAttribute("data-placeholder",this.placeholder):this.element.removeAttribute("data-placeholder")},i.prototype.dispose=function(e){var t=this;o.prototype.dispose.call(this,e);var n=this.focusableBinding;n&&(n.dispose(),this.focusableBinding=void 0),i.focusedTextVE===this&&(i.focusedTextVE=null);var r=this._viewModel.getTextAggregator();r&&r.removeCommonTextVE(this),this.unregisterPasteEventListener(),this.resourceFactory.loadResource(19).then(function(){t.removeListener(TextEditor.CanvasEvents.textEditorHandleShortcutEvent),t.removeListener(TextEditor.CanvasEvents.textEditorContentChangedEvent),t.removeListener(TextEditor.CanvasEvents.textEditorFocusedEvent),t.removeListener(TextEditor.CanvasEvents.textEditorLeavingEditorEvent),t.removeListener(TextEditor.CanvasEvents.textEditorRegionSelectionEvent),i.unregisterPasteVE(t);for(var e=TextEditor.Canvas._editableRegions$i,n=0;n<e.length;n++)if(e[n]===t.domElement){e.splice(n,1);break}TextEditor.Canvas._lastEditableRegion$p===t.domElement&&(TextEditor.Canvas._lastEditableRegion$p=null)}),void 0==i.canvasListeners[TextEditor.CanvasEvents.textEditorHandleShortcutEvent]&&(i.initialSetupCompleted=!1)},i.prototype.drop=function(e){return e.preventDefault(),e.stopPropagation(),!0},i.prototype.dragOver=function(e){return!0},i.prototype.onGainingFocus=function(){var e=this;TDB.applyUpdate(function(){e._viewModel.hasFocus.setValue(!0)});var n=this.getCardSelectionManager();n&&n.getSelectionLength()>0&&n.clearSelection(),i.focusedTextVE=this;var o=this.activeSearchResult;if(this.removeHighlighting(),o){var r=document.getSelection();r.removeAllRanges();for(var a=0;a<o.ranges.length;a++){var s=o.ranges[a],l=this.createTextRange(s);l&&r.addRange(l)}TextEditor.Cursor.updateRangeToCurrentSelection()}var c=this.findParent(t.CardDeckVE);c&&c.resetSearch()},i.prototype.onLosingFocus=function(){var e=this;StoryPageEditSettings.AutoLinkEnabled&&n.AutoLinkHandler.turnOffAutoLinkJustCreatedFlag(),TDB.applyUpdate(function(){e._viewModel.hasFocus.setValue(!1)}),this.updatePlaceholder(),this.forwardKeyCount=0,TextEditor.Cursor._cancelCurrentWait$p()},i.prototype.setFocusToEnd=function(){this.element.focus();var e=TextEditor.Cursor.get_Range();e&&(e.moveToEndOfNode(this.element),TextEditor.Cursor.update())},i.prototype.setFocusToParagraph=function(e){this.element.focus();var t=this.element.children.namedItem(e),n=TextEditor.Cursor.get_Range();t&&n?(n.moveToStartOfNode(t),TextEditor.Cursor.update()):this.setFocusToEnd()},i.prototype.textMouseClick=function(e){return!1},i.prototype.mouseClicked=function(e){return StoryPageEditSettings.AutoLinkEnabled&&n.AutoLinkHandler.turnOffAutoLinkJustCreatedFlag(),ActionLogger.RecordClientAction(new ClientAction.ButtonClickAction(this.telemetryId,Diag.ULSCat.msoulscat_Story_Storyline)),this.textMouseClick(e)?TDB.EventPropagation.Bubble:TDB.EventPropagation.Bypass},i.prototype.contextMenu=function(e){return StoryPageEditSettings.AutoLinkEnabled&&n.AutoLinkHandler.turnOffAutoLinkJustCreatedFlag(),ActionLogger.RecordClientAction(new ClientAction.ButtonRightClickAction(this.telemetryId,Diag.ULSCat.msoulscat_Story_Storyline)),!1},i.prototype.hasUncommittedStructuralChanges=function(){return!1},i.prototype.keyDown=function(e){var n=TDB.EventPropagation.Bubble;if(this.isFocused())switch(e.keyCode){case KeyCodeType.LeftArrowKey:case KeyCodeType.RightArrowKey:case KeyCodeType.UpArrowKey:case KeyCodeType.DownArrowKey:case KeyCodeType.HomeKey:case KeyCodeType.EndKey:case KeyCodeType.DeleteKey:case KeyCodeType.SpaceKey:case KeyCodeType.BackspaceKey:n=TDB.EventPropagation.Bypass;break;case KeyCodeType.EnterKey:n=this.parent instanceof t.ComplexHeadingCardVE?TDB.EventPropagation.Bubble:TDB.EventPropagation.Bypass}return n===TDB.EventPropagation.Bubble?o.prototype.keyDown.call(this,e):n},i.prototype.getSelectionNotifier=function(){return this.selectionChanged},i.getFocusedTextVE=function(){return i.focusedTextVE},i.prototype.getViewModel=function(){return this._viewModel},i.prototype.highlight=function(e,t){if(t!==VE.HighlightingType.None){if(e&&this._viewModel.getModel()&&this.element)for(var n=0;n<e.ranges.length;n++){var o=e.ranges[n],i=this.createTextRange(o);if(i){this.hasHighlighting=!0;var r=i.startContainer.parentNode,a=VE.ContentSearchVE.otherSearchHitClass,s=t===VE.HighlightingType.CurrentSearchHit;if(s&&(a=VE.ContentSearchVE.currentSearchHitClass,this.activeSearchResult=e),r.nodeName===StoryApp.Common.TextHelpers.HtmlMarkTag)r.className=a;else{var l=i.extractContents();(r=document.createElement(StoryApp.Common.TextHelpers.HtmlMarkTag)).className=a,r.appendChild(l),i.insertNode(r)}s&&r.scrollIntoView(!1)}}}else this.removeHighlighting()},i.prototype.createTextRange=function(e){var t=void 0,o=this._viewModel.getModel(),i=n.TextHelperMethods.generateElementId(e.contentId),r=e.contentId===o.id?this.element:$(this.element).find("#"+i)[0];return r&&(t=StoryApp.Common.TextHelpers.createTextRange(r,e.position,e.length)),t},i.prototype.removeHighlighting=function(){this.hasHighlighting&&(StoryApp.Common.TextHelpers.removeMarks(this.element),this.hasHighlighting=void 0),this.activeSearchResult=void 0},i.prototype.getFileUploader=function(){return this._viewModel.getFileUploader()},i.prototype.getCardsContainer=function(){return this._viewModel.getCardsContainer()},i.prototype.getCardSelectionManager=function(){return this._viewModel.getCardSelectionManager()},i.prototype.getCard=function(){return this._viewModel.getCard()},i.prototype.isOnCanvas=function(){return this._viewModel.isOnCanvs()},i.prototype.isCurrentActiveElement=function(){return StoryApp.Utilities.getDocumentActiveElement()===this.element},i.prototype.getTelemetryId=function(){return this.telemetryId},i.prototype.getSocketParentCardType=function(){return this.socketParentCardType},i.listeners={},i.canvasListeners={},i.pasteListeners=[],i.initialSetupCompleted=!1,i.focusedTextVE=null,i.textSelectionModelId=TDB.watchableTag(596473181,null,null),i.maxForwardKeyCount=50,i.clipboardImages=[],i.dragging=!1,i}(TDB.Control);t.CommonTextVE=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=function(){function n(){}return n.checkAndUpdateUrl=function(e){return n.uncStart.test(e)?n.fileStart+e.replace(/\:/,"|").replace(n.uncStart,"/"):n.urlStart.test(e)||""==e?e:"https://"+e},n.createLink=function(o,i,r,a,s,l){s.isValid()?e.Model.currentUndoManager().get(o).captureUserUpdate(function(){t.TextHelperMethods.logTextAction(ClientAction.ActionType.Storyline_Text_Link,i,l,s),""===(a=a.replace(t.TextHelperMethods.zeroWidthRegex,""))&&(a=r),r=n.checkAndUpdateUrl(r);var e=StoryApp.Utilities.createRange();e.setStartAfter(s.get_startMarker()),e.setEndBefore(s.get_endMarker());var o=e.extractContents(),c=document.createElement(TextEditor.HtmlTagNameUppercase.A);c.href=r,c.setAttribute("rel","nofollow noopener noreferrer"),a!=$(o).text()?c.textContent=a:(c.appendChild(o),t.TextLinkDialogViewModel.formatLinkElement(c));for(var d=s.get_startMarker(),u=s.get_endMarker(),p=d.parentElement,g=d,h=[],C=u;C&&!t.TextHelperMethods.isBlockElement(C);C=C.parentElement)h.push(C);for(;p&&!ArrayExtensions.contains(h,p)&&!t.TextHelperMethods.isBlockElement(p);)g=p,p=p.parentElement;g?($(c).insertAfter(g),s.moveAfterNode(c)):StoryLog.TraceTag(596453312,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.error,"TextLinkDialogViewModel.commitLinkUpdates(). Attempted to insert link before 'undefined' element")},i):StoryLog.TraceTag(595932420,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.warning,"Attempted to create link using an invalid range")},n.isAllowedSchema=function(e){return!!n.allowedProtocols.test(e)||!n.urlStart.test(e)&&""!=e&&!n.isUncPath(e)},n.isAutoUrl=function(e){return n.allowedProtocols.test(e)&&n.urlStart.test(e)||n.wwwDotStart.test(e)},n.isEmail=function(e){return n.recognizedEmail.test(e)},n.isUncPath=function(e){return!!(n.uncStart.test(e)||e.search(n.fileStart)>-1)},n.rangeAtEndOfLink=function(e){return TextEditor.Cursor.isInLinkUrl()&&e.startOffset===e.startContainer.length},n.removeLink=function(n,o,i){void 0===i&&(i=function(){return TextEditor.Cursor.isInLinkUrl()}),i()&&e.Model.currentUndoManager().get(n).captureUserUpdate(function(){t.TextHelperMethods.logTextAction(ClientAction.ActionType.Storyline_Text_RemoveLink,o,!1),TextEditor.Cursor.removeLink(),EditVE.CommonTextVE.commit()},o)},n.validateUrl=function(e){var o=new RegExp(t.TextHelperMethods.spaceRegex,"g");return!(t.TextHelperMethods.hasWordCharacters(e)&&(!n.isAllowedSchema(e)||o.test(e)&&!n.isUncPath(e)))},n.allowedProtocols=/^(https?|ftp|mailto|onenote|news|tel)\:/i,n.fileStart="file:///",n.recognizedEmail=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,n.uncStart=/\\/g,n.urlStart=/^[a-z]*\:/i,n.wwwDotStart=/^(www\.).+/i,n}();t.LinkUtilities=n}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(){this._commonTextVEs=[],this._commonTextVEs=[]}return e.prototype.addCommonTextVE=function(e){this.isRegistered(e)||this._commonTextVEs.push(e)},e.prototype.removeCommonTextVE=function(e){var t=this._commonTextVEs.indexOf(e);t>-1&&this._commonTextVEs.splice(t,1)},e.prototype.isRegistered=function(e){return this._commonTextVEs.indexOf(e)>-1},e.prototype.hasUncommittedStructuralChanges=function(){for(var e=this._commonTextVEs.length,t=0;t<e;t++)if(this._commonTextVEs[t].hasUncommittedStructuralChanges())return!0;return!1},e}();e.TextAggregator=t}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=function(){function e(){}return e.formatElement=function(n,o,i,r){if(void 0===i&&(i=!0),TextEditor.isRteLoaded()){o||(o={}),platform.setTimeout(function(){i=i&&$(n).is(":focus")},0),!r&&i&&(r=new t.TextFormatterCursorManager),this.clearCssTextDirection(n);for(var a=0;a<n.childNodes.length;a++){var s=n.childNodes[a],l=s.nodeType==Node.ELEMENT_NODE?s.nodeName.toUpperCase():"";if(!e.isRTECursor(s)&&!TextEditor.Canvas.isTextEditorControlNode(s))if(ArrayExtensions.contains(e.nodesToBeRemoved,l)||o.removeFormatting&&ArrayExtensions.contains(e.formatNodesToBeRemoved,l))r&&r.markCursorChanged(),e.removeNodeButKeepChildren(s),a--;else if(l in e.nodesToBeReplaced)r&&r.markCursorChanged(),e.replaceWithTag(s,e.nodesToBeReplaced[l]),a--;else if(this.clearCssTextDirection(s),o.isSingleLine)if(e.isValidInlineElement(s)){if(e.removeEmptyStyleTag(s,r)){a--;continue}e.formatElement(s,{isSingleLine:!0},i,r)}else e.appendChildrenToSiblings(s,r)&&a--;else if(e.isInlineElement(s)||t.TextHelperMethods.nodeIsTag(s,TextEditor.HtmlTagNameUppercase.BR)){r&&r.markCursorChanged();var c=document.createElement(TextEditor.HtmlTagNameUppercase.P);n.insertBefore(c,s);do{var d=s.nextSibling;c.appendChild(s),s=d}while(s&&e.isInlineElement(s));s&&s.nodeName.toUpperCase()===TextEditor.HtmlTagNameUppercase.BR&&c.appendChild(s),e.setElementStructureIfRequired(c),a--}else if(l==TextEditor.HtmlTagNameUppercase.P||t.TextHelperMethods.isListElement(s))e.formatBlockElement(s,o,r);else if(l!=TextEditor.HtmlTagNameUppercase.DIV)if(l!=TextEditor.HtmlTagNameUppercase.LI){if(l==TextEditor.HtmlTagNameUppercase.BLOCKQUOTE){var u=!!s.firstChild&&t.TextHelperMethods.isListElement(s.firstChild);r&&r.markCursorChanged();for(var p=0;p<s.childNodes.length;p++){var g=s.childNodes[p];if(!t.TextHelperMethods.isListElement(g)){u=!1;break}}if(u){h=document.createElement(s.firstChild.nodeName.toUpperCase());for(s.parentNode.insertBefore(h,s);s.firstChild;)h.appendChild(s.firstChild);a--}else e.appendChildrenToSiblings(s,r)&&a--;s.parentNode.removeChild(s)}}else{if(r&&r.markCursorChanged(),s.previousSibling&&t.TextHelperMethods.isListElement(s.previousSibling))s.previousSibling.appendChild(s),a--;else{var h=document.createElement(TextEditor.HtmlTagNameUppercase.UL);s.parentNode.insertBefore(h,s),h.appendChild(s)}e.formatBlockElement(s,o,r)}else r&&r.markCursorChanged(),e.replaceWithTag(s,TextEditor.HtmlTagNameUppercase.P)}r&&r.updateCursorIfNeeded()}},e.formatBlockElement=function(n,o,i){var r=t.TextHelperMethods.isListElement(n);r&&e.formatListElement(n,i);for(d=0;d<n.childNodes.length;d++)if((u=n.childNodes[d]).nodeType!==Node.TEXT_NODE||TextEditor.Canvas.textNodeContainsControlCharacter(u)){if(u.nodeType==Node.ELEMENT_NODE){var a=u.nodeName.toUpperCase(),s=t.TextHelperMethods.isListElement(u);TextEditor.Canvas.isTextEditorControlNode(u)||(ArrayExtensions.contains(e.nodesToBeRemoved,a)?(i&&i.markCursorChanged(),e.removeNodeButKeepChildren(u),d--):a in e.nodesToBeReplaced?(i&&i.markCursorChanged(),e.replaceWithTag(u,e.nodesToBeReplaced[a]),d--):a==TextEditor.HtmlTagNameUppercase.BR&&TextEditor.Canvas.nodeContainsUserText(n)?(i&&i.markCursorChanged(),u.parentNode&&n.removeChild(u),d--):e.removeEmptyStyleTag(u,i)?(i&&i.markCursorChanged(),d--):(this.clearCssTextDirection(u),e.isValidInlineElement(u)?("EM"===a&&"lighter"===u.style.fontWeight&&(u.style.fontWeight=""),e.condenseInlineElements(u,!1,i),e.isRTECursor(u)||e.formatBlockElement(u,null,i)):!r||a!=TextEditor.HtmlTagNameUppercase.LI&&!s?e.appendChildrenToSiblings(u,i)&&d--:e.formatBlockElement(u,o,i)))}}else u.textContent.indexOf(t.TextHelperMethods.ZeroWidthSpace)>-1&&(i&&i.markCursorChanged(),t.TextHelperMethods.removeZeroWidthSpaces(u)),""===u.textContent&&(i&&i.markCursorChanged(),n.removeChild(u),d--);if(!(""!==n.textContent||e.isCursorEnterableNode(n)||t.TextHelperMethods.isListElement(n)||t.TextHelperMethods.nodeContainsCursor(n)||t.TextHelperMethods.nodeContainsSavedCursorLocation(n))){i&&i.markCursorChanged();for(var l=[],c=n.childNodes.length,d=0;d<c;d++){var u=n.childNodes[d];TextEditor.Canvas.isTextEditorControlNode(u)&&l.push(u)}n.textContent="",e.setElementStructureIfRequired(n);for(d=0;d<l.length;d++)n.appendChild(l[d])}},e.clearCssTextDirection=function(e){var t=e;t.style&&(t.style.direction="")},e.formatListElement=function(o,i){if(!t.TextHelperMethods.isListElement(o))return!1;if(0==o.childNodes.length)return i&&i.markCursorChanged(),o.parentNode.removeChild(o),!0;for(var r,a=!1,s=0;s<o.childNodes.length;s++){var l=o.childNodes[s];if(l.nodeType==Node.TEXT_NODE||e.isValidInlineElement(l)){if(r)s--;else{if(i&&i.markCursorChanged(),r=document.createElement(TextEditor.HtmlTagNameUppercase.LI),!l.parentNode){s--;continue}l.parentNode.insertBefore(r,l),e.setElementStructureIfRequired(r)}r.appendChild(l)}else{r=l.nodeName.toUpperCase()==TextEditor.HtmlTagNameUppercase.LI?l:void 0;for(var c=1,d=o.parentNode;t.TextHelperMethods.isListElement(d);)c++,d=d.parentNode;c>=n.StoryController.getMaxListDepth()&&t.TextHelperMethods.isListElement(l)&&e.appendChildrenToSiblings(l,i)&&(s--,a=!0)}}return a},e.removeEmptyStyleTag=function(n,o){var i=n.nodeName;return!(i!==TextEditor.HtmlTagNameUppercase.STRONG&&i!==TextEditor.HtmlTagNameUppercase.EM||t.TextHelperMethods.nodeHasWordCharacters(n)||t.TextHelperMethods.nodeContainsCursor(n)||t.TextHelperMethods.nodeContainsSavedCursorLocation(n))&&(o&&o.markCursorChanged(),e.removeNodeButKeepChildren(n),!0)},e.appendChildrenToSiblings=function(e,t,n){if(void 0===n&&(n=0),n>e.childNodes.length)return!1;for(var o=e.parentNode,i=!1;e.childNodes.length>n;)t&&t.markCursorChanged(),o.insertBefore(e.childNodes[n],e),i=!0;return i&&0==e.childNodes.length&&(t&&t.markCursorChanged(),o.removeChild(e)),i},e.isValidInlineElement=function(t){if(e.isRTECursor(t))return!0;var n=t.nodeName.toUpperCase();if(n==TextEditor.HtmlTagNameUppercase.A)return!0;if(n==TextEditor.HtmlTagNameUppercase.SPAN){var o=t.getAttribute("class");return o&&o.indexOf("ms-rteStyle")>-1}return n==TextEditor.HtmlTagNameUppercase.STRONG||n==TextEditor.HtmlTagNameUppercase.EM},e.isInlineElement=function(e){if(e.nodeType==Node.TEXT_NODE)return!0;var t=e.nodeName.toUpperCase();return t===TextEditor.HtmlTagNameUppercase.SPAN||t===TextEditor.HtmlTagNameUppercase.A||t===TextEditor.HtmlTagNameUppercase.STRONG||t===TextEditor.HtmlTagNameUppercase.EM},e.isRTECursor=function(e){return TextEditor.Canvas.isTextEditorCursor(e)},e.condenseInlineElements=function(t,n,o){void 0===n&&(n=!1);var i=e.condenseFormattingSpans(t,o);if(t.nodeType==Node.TEXT_NODE)for(;t.nextSibling&&t.nextSibling.nodeType==Node.TEXT_NODE;)o&&o.markCursorChanged(),t.textContent=t.textContent+t.nextSibling.textContent,t.parentNode.removeChild(t.nextSibling),i=!0;if(n)for(var r=0;r<t.childNodes.length;r++){var a=e.condenseInlineElements(t.childNodes[r],!0,o);i=i||a}return i},e.condenseFormattingSpans=function(e,n){var o,i=!1;if(void 0!==(o=t.TextHelperMethods.getFormatType(e)))for(;o===t.TextHelperMethods.getFormatType(e.nextSibling);){n&&n.markCursorChanged();for(var r=e.nextSibling;r.childNodes.length||r.children.length;)e.appendChild(r.firstChild);e.parentNode.removeChild(r),i=!0}return i},e.replaceWithTag=function(t,n){for(var o=document.createElement(n);0!=t.childNodes.length;)o.appendChild(t.childNodes[0]);var i=t.parentNode;i.insertBefore(o,t),i.removeChild(t),e.setElementStructureIfRequired(o)},e.removeNodeButKeepChildren=function(t){0===t.childNodes.length?t.parentNode.removeChild(t):e.appendChildrenToSiblings(t)},e.getEmptyElementHTMLString=function(){return document.createElement(TextEditor.HtmlTagNameUppercase.BR).outerHTML},e.removeElementStructureIfPresent=function(e){e&&$(e).find(TextEditor.HtmlTagNameUppercase.BR).each(function(e,t){$(t).remove()})},e.setElementStructureIfRequired=function(n){if(n&&(t.TextHelperMethods.nodeIsTag(n,TextEditor.HtmlTagNameUppercase.P)||t.TextHelperMethods.nodeIsTag(n,TextEditor.HtmlTagNameUppercase.LI))&&!e.isCursorEnterableNode(n)){var o=n.ownerDocument.createElement(TextEditor.HtmlTagNameUppercase.BR);$(n).append(o),e.fixCursorPositionIfAfterBR()}},e.isCursorEnterableNode=function(e){if(!e)return!1;if(StoryApp.Utilities.browser.isEdge){if(t.TextHelperMethods.nodeHasWordCharacters(e))return!0}else if(TextEditor.Canvas.nodeContainsUserText(e))return!0;var n=!1;if($(e).find("BR:first").each(function(e,t){n=!0}),n)return!0;if(StoryApp.Utilities.browser.isIEOrEdge&&e.nodeType===Node.ELEMENT_NODE){var o=e.ownerDocument.createElement(TextEditor.HtmlTagNameUppercase.BR).outerHTML.toUpperCase();if(e.innerHTML.toUpperCase().indexOf(o)>-1)return!0}return!1},e.fixCursorPositionIfAfterBR=function(){var e=window.getSelection(),t=e.anchorNode,n=e.anchorOffset,o=e.focusNode,i=e.focusOffset,r=!1;if(t&&t.hasChildNodes()&&t.lastChild.nodeName.toUpperCase()===TextEditor.HtmlTagNameUppercase.BR&&n===t.childNodes.length&&(n--,r=!0),o&&o.hasChildNodes()&&o.lastChild.nodeName.toUpperCase()===TextEditor.HtmlTagNameUppercase.BR&&i===o.childNodes.length&&(i--,r=!0),r){var a=document.createRange();a.setStart(t,n),a.setEnd(o,i),e.removeAllRanges(),e.addRange(a)}},e.nodesToBeRemoved=[TextEditor.HtmlTagNameUppercase.U],e.formatNodesToBeRemoved=[TextEditor.HtmlTagNameUppercase.B,TextEditor.HtmlTagNameUppercase.STRONG,TextEditor.HtmlTagNameUppercase.I,TextEditor.HtmlTagNameUppercase.EM],e.nodesToBeReplaced={B:TextEditor.HtmlTagNameUppercase.STRONG,I:TextEditor.HtmlTagNameUppercase.EM},e}();t.TextFormatter=o}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=e.View.ViewElements,r=e.View.ViewModel,a=function(t){function a(e,n,o,i){var r=t.call(this,e)||this;return r.owner=e,r._element=n,r._textGroup=o,r._args=i,r._dropTargets=[],r}return __extends(a,t),a.prototype.createDropTargets=function(){for(;this._dropTargets.length>0;)this._dropTargets[0].removeDropTarget(),this._dropTargets.shift();for(var e,t=this._element.children.length,n=0;n<t;n++){var o=this._element.children[n],a=o.nodeName.toUpperCase(),s=r.TextHelperMethods.getModelId(o);(a==TextEditor.HtmlTagNameUppercase.P||r.TextHelperMethods.isListElement(o))&&s&&(e&&this._dropTargets.push(new i.TextGroupDropTarget(this,this,e,this._args)),e=o)}},a.prototype.drop=function(e,t){var a=this;TDB.applyUpdate(function(){for(var s=a.owner.getPageId(),l=!0,c=0;c<t.length;c++){var d=t[c]instanceof i.CardVE?t[c]:null;if(!(d&&d.getViewModel().getModel()instanceof n.TextGroup)){l=!1;break}}if(l)for(var u=a._textGroup.storyModel.getModelObject(e),p=a._textGroup.children.getCollection().indexOf(u)+1,c=0;c<t.length;c++){var g=t[c].getViewModel().getModel(),h=g.children.getCollection();o.StoryController.addExistingSpecifiedGroupChildren(h,p,a._textGroup.children),p+=h.length,o.currentStoryController().get(s).removeSpecifiedGroupChild(g)}else{var C=o.currentStoryController().get(s).findParent(a._textGroup),f=r.TextHelperMethods.splitTextGroup(a._textGroup,e,!1,s);i.AuthoringHelperMethods.moveElementsToLocation(t,C,f+1,s,"Dropped content in a text area"),platform.setImmediate(function(){var e=ArrayExtensions.lastOrDefault(t);if(e instanceof i.CardVE){var n=StoryApp.Utilities.getDocumentActiveElement();n&&n instanceof HTMLElement&&"function"==typeof n.blur&&n.blur(),e.setFocus()}})}a._args.cardsContainer.computeCardDeckElements()})},a.prototype.dropFileOrText=function(e,t){e.dataTransfer.files.length>0?this.dropFile(e,t):e.dataTransfer.getData("Text")&&this.dropText(e,t)},a.prototype.dropFile=function(t,i){var r=this,a=this.owner.getPageId();e.Model.currentUndoManager().get(a).captureUserUpdate(function(){var e=o.currentStoryController().get(a),s=e.findParent(r._textGroup),l=e.findContainingCollection(r._textGroup,s);if(l){var c=n.TextGroup.Create(r._textGroup.storyModel),d=l.getCollection().indexOf(r._textGroup);l.add(c,d+1);for(var u=r._textGroup.children.getCollection().length-1;u>=0;u--){var p=r._textGroup.children.getCollection()[u];if(p.id==i)break;r._textGroup.children.remove(p),c.children.add(p,0)}var g=r._args.cardsContainer.getCardForModelId(r._textGroup.id);g.setItemActiveState(!1),g.setFocus();var h=o.StoryController.getFilesFromDataTransfer(t.dataTransfer);r._args.fileUploader.uploadFiles(FileObject.createFileObjects(h));var C=new ClientAction.FileDraggedAndDropped(h.length);ActionLogger.RecordClientAction(C)}},"User dropped file(s) from their desktop onto a Text Group")},a.prototype.dropText=function(t,n){var a=this,s=t.dataTransfer.getData("Text"),l=[],c=this.owner.getPageId();e.Model.currentUndoManager().get(c).captureUserUpdate(function(){var e,t=TextEditor.Cursor.get_Range();i.CommonTextVE.dragging&&t&&(e=r.TextHelperMethods.getTextGroupFromCursor(t.get_startMarker(),c),t.deleteContent(),TextEditor.Cursor.update(),r.TextHelperMethods.removeEmptyCursorParagraphs(t.get_startMarker(),t.get_endMarker()),i.CommonTextVE.commit()),l=r.TextHelperMethods.createParagraphsFromDraggedText(s,c);var d=a._textGroup.storyModel.getModelObject(n),u=a._textGroup.children.getCollection().indexOf(d)+1;o.StoryController.addExistingSpecifiedGroupChildren(l,u,a._textGroup.children),i.CommonTextVE.dragging&&e&&r.TextHelperMethods.deleteCardIfEmptyText(e,a._args.cardsContainer);var p=new ClientAction.TextDraggedAndDropped(s.length);ActionLogger.RecordClientAction(p),i.CommonTextVE.dragging=!1},"User dropped a text into TextGroup")},a}(Disposable);t.TextGroupDropManager=a}(t.Common||(t.Common={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewModel,o=function(e){function t(t,n,o,i){var r=e.call(this,t)||this;return r._parent=n,r._element=o,r._args=i,r._args.dragHandler.addDropTarget(r._element,r,0),r}return __extends(t,e),t.prototype.removeDropTarget=function(){this._args.dragHandler.removeDropTarget(this._element)},t.prototype.accept=function(e){return!this._args.context||!this._args.acceptDraggables||this._args.acceptDraggables.call(this._args.context,e)},t.prototype.activate=function(){},t.prototype.calculateDropRect=function(e){return e.top=e.bottom-5,e.height=20,e},t.prototype.refreshDropRect=function(){return!1},t.prototype.setActive=function(e){this._args.activeCss&&(e?$(this._element).addClass(this._args.activeCss):$(this._element).removeClass(this._args.activeCss))},t.prototype.drop=function(e){this._parent.drop(n.TextHelperMethods.getModelId(this._element),e)},t.prototype.dropFileOrText=function(e){return e.preventDefault(),e.stopPropagation(),this._parent.dropFileOrText(e,n.TextHelperMethods.getModelId(this._element)),this.setActive(!1),!1},t.prototype.deactivate=function(){},t.prototype.dispose=function(){this.removeDropTarget()},t.prototype.isExpandable=function(){return!1},t}(Disposable);t.TextGroupDropTarget=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=function(){function i(e,t,n){this.element=e,this.model=t,this.baseStates={},this.pageId=n}return i.prototype.applyModelToRoot=function(e){var t=this.model.children.getCollection(e);this.applyModelToChildCollection(this.element,t,!1,e)},i.prototype.applyModelToChildCollection=function(e,o,r,a){for(var s,l=i.getNextFilteredElement(e.firstElementChild,!0),c=0;;){var d=c<o.length?o[c]:null;if(!l&&!d)break;var u=l?l.nodeName:"";if((u==TextEditor.HtmlTagNameUppercase.OL||u==TextEditor.HtmlTagNameUppercase.UL)&&r){var p=s instanceof n.Paragraph?s:void 0,g=p?p.children.getCollection(a):[];if(g.length>0){s=void 0,this.applyModelToChildCollection(l,g,!0,a),l=i.getNextFilteredElement(l);continue}var h=d instanceof n.Paragraph?d:void 0,C=h?h.children.getCollection(a):[];if(C.length>0&&void 0==h.getContent(a)){s=void 0,this.applyModelToChildCollection(l,C,!0,a),l=i.getNextFilteredElement(l),c++;continue}d=void 0}var f=l?t.TextHelperMethods.getModelId(l):null,m=d?d.id:null;if(!l||!d||f!=m||d instanceof n.TextGroup&&d.getListStyle(a)!==i.getListStyle(l))if(s=void 0,d){StoryLog.TraceTag(596473226,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.verbose,"Unit("+m+") added to "+c);var y=i.createUnitElement(d,r,a);if(0==y.length){c++;continue}for(var v=0;v<y.length;v++)e.insertBefore(y[v],l);l=y[0]}else if(!l||d);else{StoryLog.TraceTag(596473227,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.verbose,"Unit("+m+") removed");var S=l;l=i.getNextFilteredElement(l),e.removeChild(S)}else{this.applyModelToUnit(l,d,a),l=i.getNextFilteredElement(l),c++,s=d;var T=d instanceof n.Paragraph?d:void 0;if(T&&T.children.getCollection(a).length>0){var w=l?l.nodeName:"";if(!(w==TextEditor.HtmlTagNameUppercase.OL||w==TextEditor.HtmlTagNameUppercase.UL)){var A=i.createListElement(T.getListStyle(a));e.insertBefore(A,l),l=A}}}}},i.prototype.applyModelToUnit=function(e,o,i){if(StoryLog.TraceTag(596473228,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.verbose,"Applying model to child("+o.id+")"),o instanceof n.Paragraph){var r=o,a=r.getContent(i),s=new n.TextBlock;t.TextHelperMethods.convertElementToTextBlock(s,e);var l=JSON.stringify(s.serialize()),c=this.baseStates[o.id];if(c&&c!=l)return void StoryLog.TraceTag(596473229,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.verbose,"Child element has uncommitted changes");var d=a?JSON.stringify(a.serialize()):void 0;if(d!=l){var u=t.TextHelperMethods.convertTextBlockToHtml(a);$(e).html(u)}var p="ltr",g="left";r.getDirection(i)===n.TextDirection.RightToLeft&&(p="rtl",g="right"),e.setAttribute("dir",p),e.style&&(e.style.textAlign=g),this.baseStates[o.id]=d}if(o instanceof n.TextGroup){var h=o,C=o.getDirection(i),p="",g="";C===n.TextDirection.LeftToRight?(p="ltr",g="left"):C===n.TextDirection.RightToLeft&&(p="rtl",g="right"),e.setAttribute("dir",C===n.TextDirection.None?"":C===n.TextDirection.RightToLeft?"rtl":"ltr"),e.style&&(e.style.textAlign=C===n.TextDirection.None?"":C===n.TextDirection.RightToLeft?"right":"left");var f=h.children.getCollection(i);this.applyModelToChildCollection(e,f,!0,i)}},i.prototype.commitRootToModel=function(e){void 0===e&&(e=!0),StoryLog.TraceTag(596473230,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.verbose,"Commiting model to root"),i.cleanDuplicateIDs(this.element),this.baseStates={},t.TextFormatter.formatElement(this.element,{},e),this.commitChildCollectionToModel(this.element,this.model,this.model.children,!1),o.StoryController.isModelObjectValid(this.model)&&0==this.model.children.getCollection().length&&this.model.children.add(o.currentStoryController().get(this.pageId).createParagraph())},i.prototype.commitChildCollectionToModel=function(r,a,s,l){this.baseStates={};for(var c=i.getNextFilteredElement(r.firstElementChild,!0),d=0;;){if(!o.StoryController.isModelObjectValid(s.modelObject))break;var u=s.getCollection(),p=d<u.length?u[d]:null;if(!c&&!p)break;var g=c?c.nodeName:"";if((g==TextEditor.HtmlTagNameUppercase.OL||g==TextEditor.HtmlTagNameUppercase.UL)&&l){var h=p instanceof n.Paragraph?p:void 0;if(h&&!h.getContent()){this.commitChildCollectionToModel(c,h,h.children,!0),h.setListStyle(i.getListStyle(c)),c=i.getNextFilteredElement(c),d++;continue}var C=this.createGroupChildModel(c,l);s.add(C,d),this.commitChildCollectionToModel(c,C,C.children,!0),c=i.getNextFilteredElement(c),d++}else{var f=c?t.TextHelperMethods.getModelId(c):null,m=p?p.id:null;if(c&&p&&f==m){this.commitUnitToModel(c,p),c=i.getNextFilteredElement(c),d++;var y=p instanceof n.Paragraph?p:void 0;if(y&&l){y.setListStyle(i.getListStyle(c));var v=c?c.nodeName:"";if(v==TextEditor.HtmlTagNameUppercase.OL||v==TextEditor.HtmlTagNameUppercase.UL){this.commitChildCollectionToModel(c,y,y.children,!0),c=i.getNextFilteredElement(c);continue}y.children.set([])}}else{var S=o.currentStoryController().get(this.pageId),T=void 0!=m&&void 0!=document.getElementById(t.TextHelperMethods.generateElementId(m));if(!p||T&&c){var w=f?this.model.storyModel.getModelObject(f):null;if(w&&S.findParent(w,a))StoryLog.TraceTag(596473233,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.verbose,"Unit("+m+") was to index "+d),S.removeSpecifiedGroupChild(w,void 0,!0),o.StoryController.addExistingSpecifiedGroupChildren([w],d,s);else if(c){var A=this.createGroupChildModel(c,l);s.add(A,d),StoryLog.TraceTag(596473234,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.verbose,"Unit("+A.id+") was added to index "+d),t.TextHelperMethods.setElementId(c,A.id)}else;}else if(StoryLog.TraceTag(596473231,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.verbose,"Unit("+m+") was removed"),p.getContentSource()===e.Model.SM.ContentCreator.DocumentIngestion&&StoryLog.TraceTag(596473232,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Paragraph created by Document Ingestion has been deleted"),!S.removeSpecifiedGroupChild(p,void 0,!0,!0))break}}}},i.prototype.commitUnitToModel=function(o,r){if(o.nodeName==TextEditor.HtmlTagNameUppercase.P||o.nodeName==TextEditor.HtmlTagNameUppercase.LI){var a=(u=r).getContent(),s=JSON.stringify(a?a.serialize():null),l=new n.TextBlock;t.TextHelperMethods.convertElementToTextBlock(l,o);var c=JSON.stringify(l.serialize());c!=s&&(StoryLog.TraceTag(596473235,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.verbose,"Commiting unit("+r.id+") to the model"),u.setContent(l),r.getContentSource()===e.Model.SM.ContentCreator.DocumentIngestion&&StoryLog.StructuredTraceTag(596460871,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Card created by Document Ingestion modified",{ModelId:r.id.toString()})),t.TextHelperMethods.commitParagraphDirection(o,u),this.baseStates[r.id]=c}if(o.nodeName==TextEditor.HtmlTagNameUppercase.UL||o.nodeName==TextEditor.HtmlTagNameUppercase.OL){var d=r instanceof n.TextGroup?r:void 0;d&&(d.setListStyle(i.getListStyle(o)),t.TextHelperMethods.commitTextGroupDirection(o,d),this.commitChildCollectionToModel(o,d,d.children,!0));var u=r instanceof n.Paragraph?r:void 0;u&&(u.setListStyle(i.getListStyle(o)),t.TextHelperMethods.commitParagraphDirection(o,u),this.commitChildCollectionToModel(o,u,u.children,!0))}},i.cleanDuplicateIDs=function(e,n){void 0===n&&(n=[]);for(var o=e.children.length,r=0;r<o;r++){var a=e.children[r],s=t.TextHelperMethods.getModelId(a);n.indexOf(s)>-1?a.removeAttribute("id"):""!=s&&n.push(s),a.childElementCount>0&&(n=i.cleanDuplicateIDs(a,n))}return n},i.getNextFilteredElement=function(e,t){for(void 0===t&&(t=!1),!t&&e&&(e=e.nextElementSibling);e;e=e.nextElementSibling)if(i.isFilteredElement(e))return e;return null},i.isFilteredElement=function(e){if(e.nodeType!=Node.ELEMENT_NODE)return!1;var t=e,n=t.nodeName.toUpperCase();if(TextEditor.Canvas.isTextEditorCursor(t))return!1;var o=n==TextEditor.HtmlTagNameUppercase.P,i=n==TextEditor.HtmlTagNameUppercase.UL||n==TextEditor.HtmlTagNameUppercase.OL,r=n==TextEditor.HtmlTagNameUppercase.LI;return o||i||r},i.prototype.getKnownIds=function(e,t){void 0===t&&(t=[]),e?t.push(e.id):e=this.model;var o;if(e instanceof n.TextGroup)o=e.children.getCollection();else{if(!(e instanceof n.Paragraph))throw StoryApp.RethrowLogger.createError("Unknown text group child type");o=e.children.getCollection()}for(var i=o.length,r=0;r<i;r++){var a=o[r];this.getKnownIds(a,t)}return t},i.prototype.hasUncommittedStructuralChanges=function(){t.TextFormatter.formatElement(this.element);var e=this.getKnownIds();return!!i.hasAddedOrRemovedElements(this.element,e)||e.length>0},i.hasAddedOrRemovedElements=function(e,n){for(var o=i.getNextFilteredElement(e.firstElementChild,!0);o;){var r=t.TextHelperMethods.getModelId(o);if(!r)return!0;var a=n.indexOf(r);if(a<0)return!0;if(n.splice(a,1),i.hasAddedOrRemovedElements(o,n))return!0;o=i.getNextFilteredElement(o)}return!1},i.createUnitElement=function(e,o,r){var a=[];if(StoryLog.TraceTag(596473236,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.verbose,"Creating element for unit("+e.id+")"),e instanceof n.Paragraph){StoryLog.TraceTag(596473237,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.verbose,"Creating paragraph");var s=e;if(s.getContent(r)){var l=t.TextHelperMethods.convertTextBlockToHtml(s.getContent(r)),c=o?TextEditor.HtmlTagNameUppercase.LI:TextEditor.HtmlTagNameUppercase.P,d=document.createElement(c);t.TextHelperMethods.setElementId(d,e.id),$(d).html(l),a.push(d),t.TextFormatter.setElementStructureIfRequired(d)}s.children.getCollection(r).length>0&&a.push(i.createListElement(s.getListStyle(r)))}if(e instanceof n.TextGroup){var u=e.getListStyle(r);if(u==n.ListStyle.Bulleted||u==n.ListStyle.Numbered){d=i.createListElement(u);t.TextHelperMethods.setElementId(d,e.id),a.push(d)}}return a},i.createListElement=function(e){var t=e==n.ListStyle.Bulleted?TextEditor.HtmlTagNameUppercase.UL:TextEditor.HtmlTagNameUppercase.OL;return document.createElement(t)},i.prototype.createGroupChildModel=function(e,t){var r,a=e.nodeName,s=a==TextEditor.HtmlTagNameUppercase.P||a==TextEditor.HtmlTagNameUppercase.LI,l=a==TextEditor.HtmlTagNameUppercase.UL||a==TextEditor.HtmlTagNameUppercase.OL;return(s||t&&l)&&(StoryLog.TraceTag(596473238,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.verbose,"Creating text node from paragraph"),r=o.currentStoryController().get(this.pageId).createParagraph(),l&&(r.setListStyle(i.getListStyle(e)),r.setContent(null))),!t&&l&&(StoryLog.TraceTag(596473239,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.verbose,"Creating text group from a list"),(r=n.TextGroup.Create(this.model.storyModel)).setListStyle(i.getListStyle(e))),r},i.getListStyle=function(e){return e?e.nodeName==TextEditor.HtmlTagNameUppercase.UL?n.ListStyle.Bulleted:e.nodeName==TextEditor.HtmlTagNameUppercase.OL?n.ListStyle.Numbered:n.ListStyle.None:n.ListStyle.None},i}();t.TextGroupSyncHandler=i}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=e.View.ViewModel,r=e.View.Common,a=function(a){function s(e,t){var n=this;if(!(e&&t&&t.viewModel&&t.focusedAuthors))throw StoryApp.RethrowLogger.createError("Missing required argument");return n=a.call(this,e,t)||this,n.currentRenderedIPs=[],n.dropManagerArgs=t.dropManagerArgs?t.dropManagerArgs:null,n.focusedAuthors=t.focusedAuthors,n}return __extends(s,a),s.prototype._create=function(e,t){var n=this;this.element=document.createElement("div"),this.domElement=this.element,e.insertBefore(this.element,t),this.element._context=this,this.element.setAttribute("useinlinestyle","true"),this.element.setAttribute("contenteditable","true"),this.element.setAttribute("rtedirty","false"),this.element.setAttribute("spellcheck","true"),this.element.setAttribute("dir",this.getStoryModel().model.getRTL()?"rtl":"ltr"),this.textGroupOnKeyDownHandler=function(e){n.onKeyDown(e)},$(this.element).on("keydown",this.textGroupOnKeyDownHandler),this.syncHandler=new i.TextGroupSyncHandler(this.element,this.getStoryModel(),this.pageId),this.dropManagerArgs&&StoryPageEditSettings.AuthoringNewFeaturesEnabled&&(this.dropManager=new r.TextGroupDropManager(this,this.element,this.getStoryModel(),this.dropManagerArgs)),this.cssWatcher=TDB.watcherTag(596473223,this,this,this.updateCss),this._subscribeToWatchable(this.cssWatcher,TDB.UpdatePhase.WriteOnly),this.htmlWatcher=TDB.watcherTag(596473224,this,this,this.updateHtml),this._subscribeToWatchable(this.htmlWatcher,TDB.UpdatePhase.ReadWrite),this.ipWatcher=TDB.watcherTag(596473225,this,this,this.updateIP),this._subscribeToWatchable(this.ipWatcher,TDB.UpdatePhase.ReadWrite),this.onUpdate(TDB.UpdatePhase.WriteOnly),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite),a.prototype._create.call(this,e,t)},s.prototype.onKeyDown=function(n){var r=this;if(n.which==KeyCodeType.SpaceKey){if(!(h=TextEditor.Cursor.get_Range())||!h.isValid())return;var a=window.getSelection().anchorNode,s=i.TextHelperMethods.findParentBlockElement(a);if(!s||s.nodeName.toUpperCase()!=TextEditor.HtmlTagNameUppercase.P)return;var l=$(s).text();l=l.replace(StoryApp.Common.TextHelpers.zeroWidthRegex,"");var c=i.TextHelperMethods.bulletedListPrefixesRegex.test(l),d=i.TextHelperMethods.numberedListPrefixesRegex.test(l);if(c||d){var u=c?ClientAction.ActionType.Storyline_Text_Bullets_Auto:ClientAction.ActionType.Storyline_Text_Numbers_Auto,p=c?"User auto created bulleted list":"User auto created numbered list";platform.setImmediate(function(){e.Model.currentUndoManager().get(r.pageId).captureUserUpdate(function(){return{activeModelObjectIds:[t.CommonTextVE.commit()]}},"commit before auto list creation"),e.Model.currentUndoManager().get(r.pageId).captureUserUpdate(function(){$(s).text(""),TextEditor.Cursor.update();var e=TextEditor.Cursor.get_Range();return e&&e.moveToEndOfNode(s),e&&e.isValid()&&(i.TextHelperMethods.logTextAction(u,p,r.isOnCanvas(),e),c?TextEditor.Cursor.bulletedList():TextEditor.Cursor.numberedList(),i.TextFormatter.formatElement(i.TextHelperMethods.currentEditableRegion()),i.TextHelperMethods.moveCursorForListCreation(e)),{activeModelObjectIds:[t.CommonTextVE.commit()]}},"User auto created a list")})}}if(n.which===KeyCodeType.BackspaceKey){if(!(h=TextEditor.Cursor.get_Range())||!h.isValid())return;var a=window.getSelection().anchorNode,g=i.TextHelperMethods.getFirstParentWithSpecifiedTag(a,TextEditor.HtmlTagNameUppercase.LI,this.element);if(g&&i.TextHelperMethods.IsCursorAtTheBeginning(g))return TextEditor.Cursor.decreaseIndent(),i.TextFormatter.formatElement(i.TextHelperMethods.currentEditableRegion()),n.stopImmediatePropagation(),void n.preventDefault()}if(n.which==KeyCodeType.TabKey&&!n.altKey){var h=TextEditor.Cursor.get_Range();if(!h||!h.isValid())return;var C=h.parentElement(),f=C?C.tagName.toUpperCase():null;if(f==TextEditor.HtmlTagNameUppercase.SPAN&&(f=(C=C.parentElement)?C.tagName.toUpperCase():null),!this.isInListNode(C)){if(this.parent instanceof t.CardVE){var m=this.parent;n.preventDefault(),n.stopPropagation(),m.onNavigateList(TDB.OffsetOrigin.Current,n.shiftKey?-1:1,0)}return}if(n.shiftKey)return;var y=!1;((y=i.TextHelperMethods.isListElement(C)?this.isSelectionPastMaxDepth(C,this.getListItemDepth(C.parentNode)):this.getListItemDepth(C)>=o.StoryController.getMaxListDepth())||void 0===y)&&(n.stopPropagation(),n.preventDefault())}},s.prototype.isSelectionPastMaxDepth=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n={inSelection:!1});var r=window.getSelection(),a=void 0,s=-1,l=e.nodeName===TextEditor.HtmlTagNameUppercase.LI,c=n.inSelection,d=!1;if(n.inSelection?(a=r.focusNode,s=r.focusOffset):(a=r.anchorNode,s=r.anchorOffset),(a.nodeType===Node.TEXT_NODE&&a===e||a===e)&&(n.inSelection=!n.inSelection,n.inSelection&&s===a.childNodes.length&&(d=!0),n.inSelection||0!==s||(c=!1)),e.nodeName.toUpperCase()!==TextEditor.HtmlTagNameUppercase.BLOCKQUOTE){(l||i.TextHelperMethods.isListElement(e))&&t++;for(var u=0;u<e.childNodes.length;u++){var p=this.isSelectionPastMaxDepth(e.childNodes[u],t,n);if(void 0===p)return;if(p)return!0}return!!(l&&!d&&(n.inSelection||c)&&t>=o.StoryController.getMaxListDepth())}},s.prototype.getListItemDepth=function(e){for(var t=-1;e&&e!==TextEditor.Canvas.currentEditableRegion();){if((i.TextHelperMethods.isListElement(e)||e.nodeName===TextEditor.HtmlTagNameUppercase.LI)&&t++,e.nodeName.toUpperCase()===TextEditor.HtmlTagNameUppercase.BLOCKQUOTE)return;e=e.parentNode}return t},s.prototype.isInListNode=function(e){if(!e)return!1;for(var t=[TextEditor.HtmlTagNameUppercase.UL,TextEditor.HtmlTagNameUppercase.OL,TextEditor.HtmlTagNameUppercase.LI,TextEditor.HtmlTagNameUppercase.EM,TextEditor.HtmlTagNameUppercase.STRONG,TextEditor.HtmlTagNameUppercase.A],n=0;e&&n<4;n++){var o=e.tagName?e.tagName.toUpperCase():void 0,i=TextEditor.Cursor.get_Range(),r=!i||i.isEmpty();if(!ArrayExtensions.contains(t,o))return!1;if(o===TextEditor.HtmlTagNameUppercase.LI||!r&&(o===TextEditor.HtmlTagNameUppercase.UL||o===TextEditor.HtmlTagNameUppercase.OL))return!0;e=e.parentElement}return!1},s.prototype.keyDown=function(e){var t=TDB.EventPropagation.Bubble;if(this.isFocused())switch(e.keyCode){case KeyCodeType.TabKey:t=TDB.EventPropagation.Bypass}return t===TDB.EventPropagation.Bubble?a.prototype.keyDown.call(this,e):t},s.prototype.onHandleShortcut=function(e,t){var n=t.event;if(this.isCursorMovement(n)||(this.lastModifiedDate=new Date),n.keyCode==KeyCodeType.EnterKey&&n.shiftKey)t.handled=!0;else if(n.ctrlKey&&!n.altKey&&!n.shiftKey){switch(n.keyCode){case KeyCodeType.SKey:this.commit();break;default:return}t.handled=!0}},s.prototype.onEditableRegionFocus=function(e,t){var n,o=this,i=this.lastModifiedDate;this.activityTimer=platform.setInterval(function(){if(i!=o.lastModifiedDate){n||(n=o.lastModifiedDate);var e=new Date-o.lastModifiedDate,t=n?new Date-n:0,r=window.getSelection(),a=r.anchorNode===r.focusNode&&r.anchorOffset===r.focusOffset,l=StoryPageEditSettings.SyncTextGroupInactivityTimeMs||s.inactiveSyncTimeSpan,c=StoryPageEditSettings.SyncTextGroupActiveTimeMs||s.maxActiveSyncTimeSpan;if((e>l||t>c)&&a&&!o.imeCompositionActive){var d=o.isCurrentActiveElement();o.commit(d),i=o.lastModifiedDate,n=void 0}}},s.activityCheckInterval),a.prototype.onEditableRegionFocus.call(this,e,t)},s.prototype.onEditableRegionBlur=function(e,t){clearInterval(this.activityTimer),this.commit(),a.prototype.onEditableRegionBlur.call(this,e,t)},s.prototype.getPasteHandlerArgs=function(){var e=this._viewModel.abilities,n={model:this.getStoryModel(),fileUploader:this.getFileUploader(),cardsContainer:this.getCardsContainer(),pageId:this.pageId,cardDeckCopyPasteHandler:this.getCard().getAuthoringModel().getCardDeckCopyPasteHandler(),removeLinks:!e.link,removeLists:!e.bullets||!e.numbers},i=this.parent&&this.parent.constructor&&this.parent.constructor.name;ActionLogger.RecordClientAction(new ClientAction.StorylinePasteContext("TextGroupVE",i));var r=o.currentStoryController().get(this.pageId).findContainingAtomParent(this.getStoryModel()),a=this._viewModel.getCardDefinitionManager(),s=a?a.pasteArgs:null;return s&&(n.removeHeadings=!t.AddAction.isAvailable([new o.Card({definition:s[o.ManualCardType.GroupId]})],{parent:r},this.pageId),n.removeImages=!t.AddAction.isAvailable([new o.Card({definition:s[o.ManualCardType.ImageId]})],{parent:r},this.pageId),n.removeOverflowText=!t.AddAction.isAvailable([new o.Card({definition:s[o.ManualCardType.TextId]})],{parent:r},this.pageId)),n},s.prototype.onUpdate=function(e){e===TDB.UpdatePhase.WriteOnly&&this.cssWatcher.resolve(),e===TDB.UpdatePhase.ReadWrite&&(this.htmlWatcher.resolve(),this.ipWatcher.resolve())},s.prototype.updateCss=function(e){var t="ms-rtestate-write TextGroupVE "+(this.getStoryModel().getEmphasis(e)==n.EmphasisLevel.More?"TextBlockquote":"textMedium");this.css&&(t+=" "+this.css),this.element.className=t},s.prototype.updateHtml=function(e){this.syncHandler.applyModelToRoot(e),this.dropManager&&this.dropManager.createDropTargets(),this.updatePlaceholder()},s.prototype.updateIP=function(e){var t=this.focusedAuthors.getWatchedValue(e),n=t.length,o=this.currentRenderedIPs.slice();this.currentRenderedIPs=[];for(var r=0;r<n;r++)for(var a=t[r].getTextIPLocation(e),s=a.length,l=0;l<s;l++){u=a[l];if(!(this.currentRenderedIPs.indexOf(u)>-1)){var c=o.indexOf(u);c>-1&&o.splice(c,1);var d=i.TextHelperMethods.addCSSRule("#_"+a[l],["before"],"content: ''");d.style.position="absolute",d.style.left="-8px",d.style.height="100%",d.style.width="3px",d.style.backgroundColor="#e0e2e5",this.currentRenderedIPs.push(u)}}for(;o.length>0;){var u=o.shift();i.TextHelperMethods.removeCSSRule("#_"+u,["before"])}},s.prototype.onCommit=function(n,o){var r=this;if(void 0===n&&(n=!0),!(this.disposed||this.parent.disposed||this.parent instanceof t.MediaCardVE&&this.parent.isEligibleForMediaCardToEmbedCardConversion())){this.lastCommitedDate=new Date;var a,s=this.parent,l=i.TextCardViewModel.isPullQuote(s.getViewModel().getModel());if(l&&(a=(d=(c=s.getViewModel().getModel()).children.getCollection()[0]).getContent().getText()),e.Model.currentUndoManager().get(this.pageId).captureUserUpdate(function(){return r.syncHandler.commitRootToModel(n),{activeModelObjectIds:[r.syncHandler.model.id]}},"User's text was saved",o),l){var c=s.getViewModel().getModel(),d=c.children.getCollection()[0],u=d.getContent().getText();a!=u&&StoryLog.StructuredTraceTag(595981514,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Pullquote edited",{oldLength:a.length,length:u.length})}return this.syncHandler.model.id}},s.prototype.hasUncommittedStructuralChanges=function(){return!!this.isFocused()&&(!(this.lastCommitedDate>=this.lastModifiedDate)&&this.syncHandler.hasUncommittedStructuralChanges())},s.prototype.onLosingFocus=function(){this.parent instanceof t.MediaCardVE&&this.parent.attemptToConvertToEmbedCard();var e=o.currentStoryController().get(this.pageId).findParent(this.getStoryModel());!this.inPasteAction&&e&&this.commit(!1),a.prototype.onLosingFocus.call(this)},s.prototype.dispose=function(e){for(a.prototype.dispose.call(this,e);this.currentRenderedIPs.length>0;){var t=this.currentRenderedIPs.shift();i.TextHelperMethods.removeCSSRule("#"+t,["before"])}$(this.element).off("keydown",this.textGroupOnKeyDownHandler),clearInterval(this.activityTimer)},s.prototype.getStoryModel=function(){return this.getViewModel().getModel()},s.prototype.isCursorMovement=function(e){return e.keyCode===KeyCodeType.LeftArrowKey||e.keyCode===KeyCodeType.RightArrowKey||e.keyCode===KeyCodeType.UpArrowKey||e.keyCode===KeyCodeType.DownArrowKey},s.inactiveSyncTimeSpan=1e3,s.maxActiveSyncTimeSpan=5e3,s.activityCheckInterval=100,s}(t.CommonTextVE);t.TextGroupVE=a}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.View.ViewElements,o=e.View.ViewModel,i=function(){function e(e){this.pageId=e,this._viewModel=new o.TextLinkDialogViewModel(this)}return e.createAndShow=function(t,n){TextEditor.Cursor.updateRangeToCurrentSelection();var i=TextEditor.Cursor.get_Range();if(i&&i.isValid()){o.TextHelperMethods.expandCursorToWord(i);var r=TextEditor.CanvasEvents.getNodeFromEvent("Link");new e(n).show(r,i,t)}},e.prototype.getPageId=function(){return this.pageId},e.prototype.show=function(e,o,i){var r=this;this.range=o,this._onCanvas=i;var a=new TDB.ChildArgs(t.TextLinkDialogContentVE,{link:e,range:o,client:this},function(e){r.textLinkDialogContentVE=e}),s={title:Resources.TextLinkDialogTitle,description:Resources.TextLinkDialogTitle,dialogWrapperCssClass:{value:"TextLinkDialog ms-rte-ui"},noFocus:!0,dialogType:n.DialogType.Info,lightDismiss:!1,width:500,keepFocusOnClose:!0,buttonsArgs:[{caption:{value:Resources.ButtonOK},id:"idlinkButtonDismissOK",dismissOnAction:!1,onAction:function(e,t){r.validateUrlAndCommit()}},{caption:{value:Resources.ButtonCancel},id:"idlinkButtonDismissCancel",dismissOnAction:!0,isNeutralButton:!0}],onShowing:this.onShowing,onClose:this.onClose,context:this,contentArgs:a};return StoryApp.View.Common.DialogManager.createAndShow(s)},e.prototype.onShowing=function(){var e=this;platform.setImmediate(function(){e.textLinkDialogContentVE&&e.textLinkDialogContentVE.onShowing()})},e.prototype.onClose=function(){TextEditor.Cursor.update()},e.prototype.validateUrlAndCommit=function(e,t){this._viewModel.validateUrlAndCommit(e,t)},e.prototype.removeLink=function(){o.LinkUtilities.removeLink(this.getPageId(),"User removed link via text link dialog: clicked remove link button")},e.prototype.getLinkRange=function(){return this.range},e.prototype.getDialogContentVE=function(){return this.textLinkDialogContentVE},e.prototype.isOnCanvas=function(){return this._onCanvas},e}();t.TextLinkDialog=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.ViewElements,o=StoryApp.View.Common,i=function(){function i(e){this.view=e}return i.prototype.commitLinkUpdates=function(o,i){var r=this,a=this.view.getLinkRange();e.Model.currentUndoManager().get(this.view.getPageId()).captureUserUpdate(function(){var e=!!o;if(e||i&&i!=a.get_text()){var s=TextEditor.CanvasEvents.getNodeFromEvent("Link");s?(t.TextHelperMethods.logTextAction(ClientAction.ActionType.Storyline_Text_Link,"User edited link via text link dialog",r.view.isOnCanvas()),i!=$(s).text()&&($(s).text(i),a.moveAfterNode(s)),e?(o=t.LinkUtilities.checkAndUpdateUrl(o),TextEditor.Cursor.setLinkUrl(o)):t.LinkUtilities.removeLink(r.view.getPageId(),"User removed link via text link dialog: href not specified")):e&&(t.TextHelperMethods.logTextAction(ClientAction.ActionType.Storyline_Text_Link,"User added link via text link dialog",r.view.isOnCanvas()),t.LinkUtilities.createLink(r.view.getPageId(),"User added link via text link dialog",o,i,a,r.view.isOnCanvas()))}else t.LinkUtilities.removeLink(r.view.getPageId(),"User removed link via text link dialog: href not specified");n.CommonTextVE.commit(!1)},"user closed the link dialog")},i.prototype.validateUrlAndCommit=function(e,n){var i=e||this.view.getDialogContentVE().getLinkTextBox().getText().trim(),r=n||this.view.getDialogContentVE().getDisplayTextBox().getText();t.LinkUtilities.validateUrl(i)?(this.commitLinkUpdates(i,r),o.DialogManager.closeCurrentDialog()):(this.view.getDialogContentVE().updateErrorMessage(Resources.TextLinkDialogErrorBody),StoryLog.TraceTag(596473221,Diag.ULSCat.msoulscat_Story_AddContent,Diag.ULSTraceLevel.warning,"TextLinkDialogViewModel.validateUrlAndCommit(). Invalid URL: '"+i+"'"))},i.formatLinkElement=function(e){for(var t=e.firstChild;t;)if(t.nodeType==Node.ELEMENT_NODE)if(t.nodeName.toUpperCase()!=TextEditor.HtmlTagNameUppercase.SPAN&&t.nodeName.toUpperCase()!=TextEditor.HtmlTagNameUppercase.STRONG&&t.nodeName.toUpperCase()!=TextEditor.HtmlTagNameUppercase.EM){for(var n=t.firstChild?t.firstChild:t.nextSibling;t.firstChild;)e.insertBefore(t.firstChild,t);e.removeChild(t),t=n}else i.formatLinkElement(t),t=t.nextSibling;else t=t.nextSibling},i}();t.TextLinkDialogViewModel=i}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.getViewModel().setView(o),o}return __extends(t,e),t.prototype._create=function(t,n){var o=this.getViewModel();this.element=document.createElement("div"),this.domElement=this.element,t.insertBefore(this.element,n),this.element._context=this,this.element.setAttribute("useinlinestyle","true"),this.element.setAttribute("contenteditable","true"),this.element.setAttribute("rtedirty","false"),this.element.setAttribute("spellcheck","true"),this.element.setAttribute("allowmultilines","false"),this.cssWatcher=TDB.watcherTag(596473218,this,this,this.updateCss),this._subscribeToWatchable(this.cssWatcher,TDB.UpdatePhase.WriteOnly),this.htmlWatcher=TDB.watcherTag(596473219,o,this,o.applyModelToRoot),this._subscribeToWatchable(this.htmlWatcher,TDB.UpdatePhase.ReadWrite),this.onUpdate(TDB.UpdatePhase.WriteOnly),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite),e.prototype._create.call(this,t,n)},t.prototype.onHandleShortcut=function(e,t){var n=t.event;if(this.lastModifiedDate=new Date,n.ctrlKey&&!n.altKey&&!n.shiftKey){switch(n.keyCode){case KeyCodeType.SKey:this.commit();break;default:return}t.handled=!0,TextEditor.Cursor.update()}},t.prototype.onEditableRegionFocus=function(n,o){var i=this,r=this.lastModifiedDate;this.activityTimer=platform.setInterval(function(){if(r!=i.lastModifiedDate||i.lastCommitedDate==i.lastModifiedDate||i.imeCompositionActive)r=i.lastModifiedDate;else{var e=i.isCurrentActiveElement();i.commit(e),i.lastCommitedDate=i.lastModifiedDate}},StoryPageEditSettings.SyncShortTextInactivityTimeMs||t.activityCheckInterval),e.prototype.onEditableRegionFocus.call(this,n,o)},t.prototype.onEditableRegionBlur=function(t,n){clearInterval(this.activityTimer),this.commit(),e.prototype.onEditableRegionBlur.call(this,t,n)},t.prototype.getPasteHandlerArgs=function(){var e=this.getViewModel(),t=this.parent&&this.parent.constructor&&this.parent.constructor.name;return ActionLogger.RecordClientAction(new ClientAction.StorylinePasteContext("TextUnitEditorVE",t)),e.getPasteHandlerArgs()},t.prototype.onUpdate=function(e){e===TDB.UpdatePhase.WriteOnly&&this.cssWatcher.resolve(),e===TDB.UpdatePhase.ReadWrite&&this.htmlWatcher.resolve()},t.prototype.updateCss=function(e){var t="ms-rtestate-write";this.css&&(t+=" "+this.css),this.element.className=t},t.prototype.onCommit=function(e,t){return this.getViewModel().onCommit(e,t)},t.prototype.onLosingFocus=function(){this.commit(!1),e.prototype.onLosingFocus.call(this)},t.prototype.dispose=function(t){clearInterval(this.activityTimer),e.prototype.dispose.call(this,t)},t.prototype.getViewModel=function(){return this._viewModel},t.activityCheckInterval=1500,t}(e.CommonTextVE);e.TextUnitEditorVE=t}(e.ViewElements||(e.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=function(i){function r(e){var t=i.call(this,e)||this;return e.abilities||(t.abilities.header=!1,t.abilities.bullets=!1,t.abilities.numbers=!1),t._args=e,t._docIngestionAlreadyLogged=!1,t}return __extends(r,i),r.prototype.setView=function(e){this._view=e,this._baseState=void 0},r.prototype.getTextBlock=function(){return this.getTextContent()},r.prototype.getTextModel=function(e){return this.getModel()?this.getModel():this._args.textHandlerContext?this._args.getTextModel.call(this._args.textHandlerContext,e):void 0},r.prototype.getTextContent=function(e){var t=void 0,n=this.getTextModel(e);return n?t=n.getContent(e):this._args.textHandlerContext&&(t=this._args.getTextContent.call(this._args.textHandlerContext,e)),t},r.prototype.setTextContent=function(t){var n=this.getTextModel();n?(n.setContent(t),this._card&&this._card.getModel().getContentSource()===e.Model.SM.ContentCreator.DocumentIngestion&&ActionLogger.RecordClientAction(new ClientAction.ModifyIngestedHeadingCard(this._card.getModel().id))):this._args.textHandlerContext&&this._args.setTextContent.call(this._args.textHandlerContext,t)},r.prototype.getTextFieldDisabled=function(e){return!(this._args.getTextFieldDisabled&&!this._args.getTextFieldDisabled.call(this._args.textHandlerContext,e))},r.prototype.applyModelToRoot=function(e){var o="",i=this.getTextContent(e);if(i){var r=JSON.stringify(i.serialize());o=t.TextHelperMethods.convertTextBlockToHtml(i),this._baseState!=r&&(this._baseState=r,""===o&&(o=t.TextFormatter.getEmptyElementHTMLString()),$(this._view.element).html(o));var a=this.getTextModel(),s=this._view.element,l="ltr",c="left";a&&a.getDirection(e)===n.TextDirection.RightToLeft&&(l="rtl",c="right"),s.setAttribute("dir",l),s.style.textAlign=c,this.getTextFieldDisabled(e)?(s.setAttribute("contenteditable",Aria.BooleanState.True),s.removeAttribute("disabled")):(s.setAttribute("contenteditable",Aria.BooleanState.False),s.setAttribute("disabled","disabled")),this._view.updatePlaceholder()}},r.prototype.onCommit=function(i,r){var a=this,s=this.getTextModel(),l=this.getCard();if(!o.StoryController.isModelObjectValid(s)&&!this.hasCustomTextHandler())return null;var c=this.getTextContent();return t.TextFormatter.formatElement(this._view.element,{isSingleLine:!0,removeFormatting:this.shouldRemoveFormatting()},i),e.Model.currentUndoManager().get(this._view.getPageId()).captureUserUpdate(function(){var o=new n.TextBlock;t.TextHelperMethods.convertElementToTextBlock(o,a._view.element);var i=JSON.stringify(o.serialize());if(s&&t.TextHelperMethods.commitParagraphDirection(a._view.element,s),!c||JSON.stringify(c.serialize())!=i){!a._docIngestionAlreadyLogged&&l instanceof t.ComplexHeadingCardViewModel&&l.getModel().getContentSource()===e.Model.SM.ContentCreator.DocumentIngestion&&(a._docIngestionAlreadyLogged=!0,StoryLog.TraceTag(596473217,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,(a._args.placeholder==StoryApp.Common.Branding.getStringCardDeckTitlePlaceholder()?"Title":"Heading")+" created by Document Ingestion has been "+(i.trim().length>0)?"changed":"deleted")),a.setTextContent(o),a._baseState=i;var r=a.getTextModel();return{activeModelObjectIds:[r?r.id:""]}}},"User's text was saved",r),s?s.id:""},r.prototype.hasCustomTextHandler=function(){return!!this._args.textHandlerContext||!!this._args.getTextContent||!!this._args.setTextContent},r.prototype.getPasteHandlerArgs=function(){var e=this._card?this._card.getAuthoringCapabilities():void 0,t=this._card?this._card.getAuthoringModel():void 0;return{model:this.getModel(),fileUploader:this.getFileUploader(),cardsContainer:this.getCardsContainer(),pageId:this._args.pageId,cardDeckCopyPasteHandler:t?t.getCardDeckCopyPasteHandler():void 0,isSingleLine:!0,removeFormatting:this.shouldRemoveFormatting(),removeLinks:!!e&&!e.textLink,removeHeadings:!!e&&!e.textHeading,removeLists:!!e&&!e.textBullets}},r.prototype.shouldRemoveFormatting=function(){var e=this._card?this._card.getAuthoringCapabilities():void 0;return!!e&&(!e.textAccent&&!e.textEmphasis)},r}(t.CommonTextViewModel);t.TextUnitEditorViewModel=i}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=function(e){function o(t,n){var o=this,i={features:TDB.ControlSetFeatures.Isolated|TDB.ControlSetFeatures.VerticalList,paneStateManager:n.paneStateManager,paneCloseButtonId:ClientAction.ButtonId.TransformChooser_Close};return o=e.call(this,t,i)||this,o._activeVisualization=TDB.watcherTag(596473216,o,o,o.calculateActiveVisualization),o._transformManager=n.transformManager,o._paneStateManager=n.paneStateManager,o._loggingSupport=n.loggingSupport,o._cardDefinitionManager=n.cardDefinitionManager,o._cardsContainer=n.cardsContainer,o}return __extends(o,e),o.prototype.getTransformOptions=function(){return this.transformOptions},o.prototype.canActivate=function(){return this._paneStateManager.getPaneVisible(t.AuthoringPaneType.GroupType)},o.prototype.calculateActiveVisualization=function(e){var n=this._cardsContainer.getModelForActiveContent(e);return t.ShowGroupTypePaneAction.isAvailable(n,this._transformManager)?n[0].getVisualization(e):null},o.prototype.transformOptionsArgs=function(e){var n=this;return this.getTransforms(e).map(function(e){return new TDB.ChildArgs(t.TransformOptionVE,{transformable:e,transformManager:n._transformManager,selectedTransform:n._activeVisualization})})},o.prototype.getTransforms=function(e){var t=this._cardsContainer.getModelForActiveContent(e);return this._transformManager.getAvailableTransforms(t)},o.prototype.mouseClicked=function(e){return this.activate(),TDB.EventPropagation.Bypass},o.prototype.escape=function(){this._paneStateManager.hideAllAuthoringPanes()},o.prototype.logVisibilityEvent=function(e){if(e){var t=this._cardsContainer.getModelForActiveContent();ActionLogger.RecordClientAction(new ClientAction.TransformUIOpenData(ClientAction.ActionType.Edit_ChangeTransformUI_Opened,"User opened the transform pane","",this._loggingSupport.getViewContext(),n.currentStoryController().get(this.pageId).getLoggableContentTypes(t,this._cardDefinitionManager)))}else ActionLogger.RecordClientAction(new ClientAction.SimpleClientActionData(ClientAction.ActionType.Edit_ChangeTransformUI_Closed,Diag.ULSCat.msoulscat_Story_Storyline))},o.prototype.getTitleText=function(){return Resources.ChangeTransformGalleryTitle},o.prototype.transformChooserOptionsWrapperAttrArgs=function(e){var t={};return t[Aria.Attributes.Label]=Resources.ChangeTransformGalleryTitle,t},o}(t.AuthoringPaneContent);t.TransformChooserVEBase=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=function(e){function t(t,n){var o=this,i={id:ClientAction.ButtonId[n.transformable.buttonId],buttonId:n.transformable.buttonId,ulsCategory:Diag.ULSCat.msoulscat_Story_Storyline,radioGroupName:"transformRadioGroup",description:n.transformable.text,value:n.transformable.getVisualization()};return o=e.call(this,t,i)||this,o.args.context=o,o.args.getSelectedRadioButton=o.getSelectedTransform,o.args.click=function(){return o.changeTransform(n.transformable)},o.transformable=n.transformable,o.transformManager=n.transformManager,o.selectedTransform=n.selectedTransform,o}return __extends(t,e),t.prototype.checkboxWrapperAttrArgs=function(e){return this.getRadioButtonAttributes(e)},t.prototype.imageAttrArgs=function(e){return{src:CommonSettings.ContentBaseUrl+this.transformable.filename,role:Aria.Roles.Presentation}},t.prototype.titleTextArgs=function(e){return this.transformable.hasVisualization(n.Visualization.GalleryContinuous)||this.transformable.hasVisualization(n.Visualization.GalleryWithThumbs)?"":this.transformable.text},t.prototype.titleClassNameArgs=function(e){return"TransformOptionTitle"},t.prototype.changeTransform=function(e){return this.transformManager.transformActiveContent(e),!1},t.prototype.isSelected=function(e){return this.parent.calculateActiveVisualization(e)===this.transformable.getVisualization()},t.prototype.transformOptionWrapperClassNameArgs=function(e){return this.transformable.hasVisualization(n.Visualization.Gallery)||this.transformable.hasVisualization(n.Visualization.GalleryWithThumbs)?"TransformOptionWrapper":"TransformOptionWrapper TransformOptionBottomPadding"},t.prototype.getSelectedTransform=function(e){return this.selectedTransform.getWatchedValue(e)},t}(StoryApp.View.ViewElements.RadioButtonVE);t.TransformOptionVEBase=o}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=function(){function e(t){this.text=t.text,this.dropZoneText=void 0!==t.dropZoneText?t.dropZoneText:t.text,this.cardDefinition=t.cardDefinition,this.abilities={},this.abilities[e.createsGroup]=!1,this.filename=t.filename,this._createArgs=t.createArgs,this._addArgs=t.addArgs,this._transformArgs=t.transformArgs,this.pageId=t.pageId,this.buttonId=t.buttonId}return e.prototype.canTransform=function(e){var t=this.cardDefinition.blueprint;return!!(t&&t.controller instanceof o.ContainerController)&&t.controller.canTransform(e,this._transformArgs)},e.prototype.canAddNew=function(e){return t.AddAction.isAvailable([new o.Card({definition:this.cardDefinition})],{parent:e},this.pageId)},e.prototype.getAddArgs=function(){return this._addArgs},e.prototype.getTransformArgs=function(){return this._transformArgs},e.prototype.getVisualization=function(){var e=this._transformArgs;return(e?e.modelProperties:void 0)?e.modelProperties.visualization:n.Visualization.Auto},e.prototype.hasVisualization=function(e){return this.getVisualization()===e},e.prototype.transform=function(e){var t=this.cardDefinition.blueprint;if(t.controller instanceof o.ContainerController){var n=t.controller,i=this._transformArgs;return e&&e.length>0&&(i.destinationChild=e[e.length-1]),n.transform(e,i)}return null},e.prototype.getContentType=function(){return this.cardDefinition.id},e.createsGroup="createsGroup",e}();t.Transformable=i}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=e.View.ViewElements,r=function(){function t(e){this._defaultGroupTransformable=o.ManualCardType.GroupId,this._cardManager=e.cardManager,this._loggingSupport=e.loggingSupport,this._groupTypeChangeNotifier=e.groupTypeChangeNotifier,this._cardsContainer=e.cardsContainer,this.pageId=e.pageId,this._transformables=[],this._transformables.push(new i.Transformable({buttonId:ClientAction.ButtonId.TransformAuto,text:Resources.TransformAuto,dropZoneText:Resources.TransformGroup,cardDefinition:this.getCardDefinition(o.ManualCardType.GroupId),filename:"TransformGroup.png",createArgs:{modelProperties:{visualization:n.Visualization.Auto}},transformArgs:{modelProperties:{visualization:n.Visualization.Auto}},pageId:this.pageId})),this._transformables.push(new i.Transformable({buttonId:ClientAction.ButtonId.TransformStack,text:Resources.TransformStack,cardDefinition:this.getCardDefinition(o.ManualCardType.StackId),filename:"TransformStack.png",createArgs:{modelProperties:{visualization:n.Visualization.Stack}},transformArgs:{modelProperties:{visualization:n.Visualization.Stack}},pageId:this.pageId})),StoryPageEditSettings.LayoutEnableUniformGrid&&this._transformables.push(new i.Transformable({buttonId:ClientAction.ButtonId.TransformUniformGrid,text:Resources.TransformUniformGrid,cardDefinition:this.getCardDefinition(o.ManualCardType.UniformGridId),filename:"TransformGrid.png",createArgs:{modelProperties:{visualization:n.Visualization.UniformGrid}},transformArgs:{modelProperties:{visualization:n.Visualization.UniformGrid}},pageId:this.pageId})),StoryPageSettings.SiteAgaveEnabled&&(this._transformables.push(new i.Transformable({buttonId:ClientAction.ButtonId.TransformGallery,text:Resources.TransformGallery,cardDefinition:this.getCardDefinition(o.ManualCardType.GalleryId),filename:"slideshowSingle.png",createArgs:{modelProperties:{visualization:n.Visualization.Gallery}},transformArgs:{modelProperties:{visualization:n.Visualization.Gallery}},pageId:this.pageId})),this._transformables.push(new i.Transformable({buttonId:ClientAction.ButtonId.TransformGalleryHorizontalThumbs,text:Resources.StyleHintsGalleryHorizontalThumbs,cardDefinition:this.getCardDefinition(o.ManualCardType.GalleryId),filename:"slideshowThumbnail.png",createArgs:{modelProperties:{visualization:n.Visualization.GalleryWithThumbs}},transformArgs:{modelProperties:{visualization:n.Visualization.GalleryWithThumbs}},pageId:this.pageId})),this._transformables.push(new i.Transformable({buttonId:ClientAction.ButtonId.TransformGalleryContinuous,text:Resources.StyleHintsGalleryContinuous,cardDefinition:this.getCardDefinition(o.ManualCardType.GalleryId),filename:"slideshowContinuous.png",createArgs:{modelProperties:{visualization:n.Visualization.GalleryContinuous}},transformArgs:{modelProperties:{visualization:n.Visualization.GalleryContinuous}},pageId:this.pageId}))),this._transformables.push(new i.Transformable({buttonId:ClientAction.ButtonId.TransformComparison,text:Resources.TransformComparison,cardDefinition:this.getCardDefinition(o.ManualCardType.ComparisonId),filename:"TransformComparison.png",createArgs:{modelProperties:{visualization:n.Visualization.Comparison}},transformArgs:{modelProperties:{visualization:n.Visualization.Comparison}},pageId:this.pageId}))}return t.prototype.getCardDefinition=function(e){return this._cardManager.getCardDefinition(e)},t.prototype.getAvailableTransforms=function(e){for(var t=[],i=this._transformables.length,r=0;r<i;r++){var a=this._transformables[r];if(a){var s="function"==typeof a.canTransform,l="function"==typeof a.hasVisualization;if(s&&l||StoryLog.TraceTag(596473186,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.error,"Transformable object type: "+a.constructor.toString()),s&&a.canTransform(e))t.push(this._transformables[r]);else if(l&&1===e.length&&o.StoryController.isModelObjectValid(e[0])&&e[0]instanceof n.Set){var c=e[0].getVisualization();a.hasVisualization(c)&&t.push(a)}}else StoryLog.StructuredTraceTag(596473185,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.error,"Transformable was null or undefined in getAvailableTransforms.",{arrayLength:i.toString(),index:r.toString()})}return t},t.prototype.getAvailableTransformsForCreate=function(e){if(!e)return null;for(var t=[],n=this._transformables.length,o=0;o<n;o++)this._transformables[o].canAddNew(e)&&t.push(this._transformables[o]);return t},t.prototype.getDefaultTransforms=function(e){var t=e&&e.length>0?e[e.length-1]:void 0;if(o.currentSetController().get(this.pageId).canTransform(e,{modelProperties:{visualization:n.Visualization.Auto},destinationChild:t,canCrossSetBoundaries:!0}))for(var i=this._transformables.length,r=0;r<i;r++)if(this._transformables[r].getContentType()==this._defaultGroupTransformable)return this._transformables[r]},t.prototype.getModelBlueprintDefaultTransform=function(e,t){if(e&&t){var i=o.currentStoryController().get(this.pageId).findParent(e);if(!(o.HeaderController.modelIsTitleBackground(e,i)||i instanceof n.Set&&t.blueprint.controller instanceof o.SetController)){var r,a=o.ObjectController.getBlueprint(e,this.pageId);if(i&&a){var s=[new o.Card({model:e,definition:o.ObjectController.getCardDefinitionForModelObject(e,this.pageId)}),new o.Card({definition:t})];o.currentSetController().get(this.pageId).canAddBlueprints(s,{})&&(r=this.getAvailableTransformsForCreate(i))}return r?r.firstOrDefault():void 0}}},t.prototype.transformActiveContent=function(t){var i=this;e.Model.currentUndoManager().get(this.pageId).captureUserUpdate(function(){var e=i._cardsContainer.getModelForActiveContent(),r=t.transform(e);r&&(i._cardsContainer.getCardForModelId(r.id).scrollIntoView(),t.hasVisualization(n.Visualization.Gallery)&&i._groupTypeChangeNotifier.notify(),ActionLogger.RecordClientAction(new ClientAction.TransformActionData(ClientAction.ActionType.Edit_ChangeTransformUI_SelectTransform,"User transformed content","",t.getContentType(),i._loggingSupport.getViewContext(),o.currentStoryController().get(i.pageId).getLoggableContentTypes(e,i._cardManager))))},"User chose to transform content")},t}();t.TransformManager=r}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n,o=e.Model.SM,i=e.Model.AuthoringModel,r=e.View.ViewElements,a=e.View.Common.HTMLEntities;!function(e){e[e.Emphasis=0]="Emphasis",e[e.Special=1]="Special",e[e.SpecialEmphasis=2]="SpecialEmphasis"}(n=t.TextFormatType||(t.TextFormatType={}));var s=function(){function s(){}return s.convertElementToTextBlock=function(e,t){for(var n=t.childNodes,i=0;i<n.length;i++){var r=n[i],a=r.nodeName.toUpperCase();if(r.nodeType!=Node.TEXT_NODE){if(r.nodeType==Node.ELEMENT_NODE)switch(a){case TextEditor.HtmlTagNameUppercase.STRONG:case TextEditor.HtmlTagNameUppercase.B:s.convertStyledElementToTextBlock(e,r,o.EmphasisLevel.More,!1);break;case TextEditor.HtmlTagNameUppercase.EM:case TextEditor.HtmlTagNameUppercase.I:s.convertStyledElementToTextBlock(e,r,null,!0);break;case TextEditor.HtmlTagNameUppercase.A:s.convertLinkElementToTextBlock(e,r)}}else{var l=r.textContent.replace(StoryApp.Common.TextHelpers.zeroWidthRegex,"");""!=l&&e.setText(e.getText()+l)}}},s.convertStyledElementToTextBlock=function(e,t,n,i,r){r=r||"";for(var a=t.childNodes,l=0;l<a.length;l++){var c=a[l],d=c.nodeName.toUpperCase();if(c.nodeType!=Node.TEXT_NODE)switch(d){case TextEditor.HtmlTagNameUppercase.STRONG:case TextEditor.HtmlTagNameUppercase.B:s.convertStyledElementToTextBlock(e,c,o.EmphasisLevel.More,i);break;case TextEditor.HtmlTagNameUppercase.EM:case TextEditor.HtmlTagNameUppercase.I:s.convertStyledElementToTextBlock(e,c,n,!0);break;case TextEditor.HtmlTagNameUppercase.A:s.convertLinkElementToTextBlock(e,c,n,i)}else{var u=c.textContent.replace(StoryApp.Common.TextHelpers.zeroWidthRegex,"");if(""!=u){var p=e.runs.getLength(),g=!0,h="",C=void 0;if(p>0&&(C=e.runs.itemAtIndex(p-1),h=s.getTextRunUrl(C,e),g=C.getIndex()+C.getLength()!=e.getText().length||C.getIsItalics()!=i||(null==n||n===o.EmphasisLevel.Auto)&&0!=C.getEmphasis()||null!=n&&n!==o.EmphasisLevel.Auto&&C.getEmphasis()!=n||h!=r),g){var f=new o.TextRun;f.setLength(u.length),f.setIndex(e.getText().length),null!=n&&n!==o.EmphasisLevel.Auto&&f.setEmphasis(n),i&&f.setIsItalics(i),e.runs.add(f)}else""==r&&""==h&&C.setLength(C.getLength()+u.length);e.setText(e.getText()+u)}}}},s.convertLinkElementToTextBlock=function(e,t,n,i){var r,a,l=(t.nodeType==Node.ELEMENT_NODE?t.nodeName.toUpperCase():"")==TextEditor.HtmlTagNameUppercase.A;try{r=decodeURI(t.getAttribute("href"))}catch(e){l=!1}r?((a=new o.TextRun).setUrl(r),a.setIndex(e.getText().length),null!=n&&n!==o.EmphasisLevel.Auto&&a.setEmphasis(n),i&&a.setIsItalics(i),e.runs.add(a)):l=!1;for(var c=t.childNodes,d=0;d<c.length;d++){var u=c[d],p=u.nodeName.toUpperCase();if(u.nodeType!=Node.TEXT_NODE)p==TextEditor.HtmlTagNameUppercase.STRONG&&s.convertStyledElementToTextBlock(e,u,o.EmphasisLevel.More,i,r),p==TextEditor.HtmlTagNameUppercase.EM&&s.convertStyledElementToTextBlock(e,u,n,!0,r);else{var g=u.textContent.replace(StoryApp.Common.TextHelpers.zeroWidthRegex,"");""!=g&&e.setText(e.getText()+g)}}l&&a.setLength(e.getText().length-a.getIndex())},s.convertTextBlockToHtml=function(e){var n="";if(!e)return t.TextFormatter.getEmptyElementHTMLString();var o=e.getText()||"",i=e.runs.getCollection().slice(0),r=i.length;i.sort(s.compareTextRuns);for(var a=0,l=0;l<r;){var c=i[l],d=c.getIndex(),u=c.getLength();if(a<d){var p=o.substring(a,d);n+=s.sanitizeHtml(p)}n+=s.convertTextRunToHtml(l,i,o),a=d+u,l=s.getNextTextRunIndex(l+1,a,i)}if(a<o.length){var g=o.substring(a,o.length);n+=s.sanitizeHtml(g)}return""===n&&(n=t.TextFormatter.getEmptyElementHTMLString()),n},s.compareTextRuns=function(e,t){var n=e.getIndex()-t.getIndex(),o=t.getLength()-e.getLength();return 0!==n?n:o},s.convertTextRunToHtml=function(e,t,n){var i="",r=t[e],a=r.getIndex(),l=r.getLength(),c=r.getEmphasis(),d=c!=o.EmphasisLevel.Auto&&c!=o.EmphasisLevel.None,u=r.getIsItalics();d&&(i+="<strong>"),u&&(i+="<em>");var p=r.getUrl();s.validateTextRunURL(p)&&(i+='<a rel="nofollow noreferrer" href="'+encodeURI(p)+'">');for(var g=a,h=(e=s.getNextTextRunIndex(e+1,a,t))<a+l?t[e]:null,C=h?h.getIndex():0,f=h?h.getLength():0;h&&C<a+l;){if(g<C){var m=n.substring(g,C);i+=s.sanitizeHtml(m)}i+=s.convertTextRunToHtml(e,t,n),g=C+f,C=(h=(e=s.getNextTextRunIndex(e+1,g,t))<l?t[e]:null)?h.getIndex():0,f=h?h.getLength():0}if(g<a+l){var y=n.substring(g,a+l);i+=s.sanitizeHtml(y)}return s.validateTextRunURL(p)&&(i+="</a>"),u&&(i+="</em>"),d&&(i+="</strong>"),i},s.getNextTextRunIndex=function(e,t,n){for(var o=n.length,i=e;i<o;i++)if(n[i].getIndex()>=t)return i;return o},s.isElementGroupEmpty=function(e,t){return!(!e.title||0!=e.children.length||s.nodeHasWordCharacters(e.title))||!e.title&&1==e.children.length&&!s.nodeHasWordCharacters(e.children[0].element)&&1==t},s.commitParagraphDirection=function(e,t){for(var n=e.getAttribute("dir"),i=e;!n&&(i=i.parentNode)&&i.getAttribute;)n=i.getAttribute("dir");var r=t.storyModel.traversalModel.getRTL()?o.TextDirection.RightToLeft:o.TextDirection.LeftToRight,a=s.getDirection(n,r);a!==t.getDirection()&&(StoryLog.TraceTag(596473173,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.verbose,"Committing direction change for unit("+t.id+") to the model"),t.setDirection(a))},s.commitTextGroupDirection=function(e,t){var n=o.TextDirection.None;t.getListStyle()!==o.ListStyle.None&&(n=t.storyModel.traversalModel.getRTL()?o.TextDirection.RightToLeft:o.TextDirection.LeftToRight);var i=s.getDirection(e.getAttribute("dir"),n);i!==t.getDirection()&&(StoryLog.TraceTag(596473174,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.verbose,"Committing direction change for unit("+t.id+") to the model"),t.setDirection(i))},s.getDirection=function(e,t){return"rtl"===e?o.TextDirection.RightToLeft:"ltr"===e?o.TextDirection.LeftToRight:t},s.hasWordCharacters=function(e){return!!e&&s.WordCharacterPattern.test(e)},s.nodeHasWordCharacters=function(e){if(!e)return!1;if(e.nodeType===Node.TEXT_NODE)return s.hasWordCharacters(e.nodeValue);if(e.nodeType!==Node.ELEMENT_NODE)return!1;for(var t=e.firstChild;t;){if(s.nodeHasWordCharacters(t))return!0;t=t.nextSibling}return!1},s.nodeContainsCursor=function(e){if(!e)return!1;var t=window.getSelection();if(!t)return!1;if(e===t.anchorNode||e===t.focusNode)return!0;if(!e.hasChildNodes())return!1;for(var n=e.childNodes.length,o=0;o<n;o++)if(s.nodeContainsCursor(e.childNodes[o]))return!0;return!1},s.nodeContainsSavedCursorLocation=function(e){return s.nodeContainsId(e,[TextEditor.Cursor.cursorStartId,TextEditor.Cursor.cursorEndId])},s.nodeContainsId=function(e,t){if(!e||!t||0==t.length)return!1;if(e.nodeType===Node.ELEMENT_NODE&&t.indexOf(e.id)>=0)return!0;var n=e.childNodes;if(n)for(var o=n.length,i=0;i<o;i++)if(s.nodeContainsId(n[i],t))return!0;return!1},s.nodeIsTag=function(e,t){return!(!e||!t)&&t.toUpperCase()===e.nodeName.toUpperCase()},s.isManagedElement=function(e){var t=e.nodeName.toUpperCase();if(t==TextEditor.HtmlTagNameUppercase.H1||t==TextEditor.HtmlTagNameUppercase.P)return!0;var n=e.getAttribute("class");return!!(t==TextEditor.HtmlTagNameUppercase.DIV&&n&&n.indexOf(TextEditor.Canvas.editableRegionClassName)>-1)},s.removeZeroWidthSpaces=function(e){var t=!1;if(e.nodeType==Node.TEXT_NODE)StoryApp.Common.TextHelpers.zeroWidthRegex.test(e.textContent)&&!TextEditor.Canvas.textNodeContainsControlCharacter(e)&&(e.textContent=e.textContent.replace(StoryApp.Common.TextHelpers.zeroWidthRegex,""),t=!0);else for(var n=e.childNodes.length,o=0;o<n;o++)t=t||s.removeZeroWidthSpaces(e.childNodes[o]);return t},s.expandCursorToAutoLink=function(e){s.expandCursor(e,s.noAutoLinkPunctuation)},s.expandCursorToWord=function(e){var t=new RegExp(s.spaceRegex,"g");s.expandCursor(e,t)},s.expandCursor=function(e,t){for(var n=e.get_startMarker().previousSibling,o=e.get_endMarker().nextSibling,i=new RegExp(s.spaceRegex,"g");n&&n.nodeType==Node.TEXT_NODE&&n.nodeValue===s.ZeroWidthSpace;)n=n.previousSibling;for(;o&&o.nodeType==o.TEXT_NODE&&o.nodeValue===s.ZeroWidthSpace;)o=o.nextSibling;if(e.isEmpty()&&s.nodeHasWordCharacters(e.getEditableRegion())){if(!s.nodeHasWordCharacters(n)&&!s.nodeHasWordCharacters(o))return;var r=o?o.textContent:void 0;!!(r&&r.length>0)&&!r.charAt(0).match(i)&&s.expandCursorHelper(e,t)}},s.expandCursorHelper=function(e,t){var n=e.get_startMarker(),o=e.get_endMarker(),i=StoryApp.Utilities.createRange();i.setStartBefore(n),i.setEndAfter(o);var r=!1,a=n.previousSibling;if(a&&a.nodeType==Node.TEXT_NODE){for(s=0;;){if((c=(l=a.textContent).split("").reverse().join("").search(t))>-1){s=l.length-c;break}if(!(d=a.previousSibling)||d.nodeType!=Node.TEXT_NODE)break;a=d}i.setStart(a,s),r=!0}if((a=o.nextSibling)&&a.nodeType==Node.TEXT_NODE){for(var s=0;;){var l=a.textContent,c=l.search(t);if(c>-1){s=c;break}var d=a.nextSibling;if(!d||d.nodeType!=Node.TEXT_NODE){s=a.textContent.length;break}a=d}i.setEnd(a,s),r=!0}r&&e.moveToRange(i)},s.removeAllAttrs=function(e,t){void 0===t&&(t=[]);for(var n=e.attributes.length;n-- >0;){var o=e.attributes[n];ArrayExtensions.contains(t,o.name)||e.removeAttributeNode(o)}},s.isBlockElement=function(e){if(!e)return!1;var t=e.nodeName.toUpperCase();return t==TextEditor.HtmlTagNameUppercase.P||t==TextEditor.HtmlTagNameUppercase.DIV||t==TextEditor.HtmlTagNameUppercase.UL||t==TextEditor.HtmlTagNameUppercase.OL},s.findParentBlockElement=function(e){if(e){for(;e&&!s.isBlockElement(e);)e=e.parentNode;return e&&e.nodeType===Node.ELEMENT_NODE?e:void 0}},s.isListElement=function(e){var t=e.nodeName.toUpperCase();return t==TextEditor.HtmlTagNameUppercase.OL||t==TextEditor.HtmlTagNameUppercase.UL},s.isParagraphElement=function(e){return e.nodeName.toUpperCase()==TextEditor.HtmlTagNameUppercase.P},s.isTextElement=function(e){switch(e.nodeType){case e.CDATA_SECTION_NODE:case e.TEXT_NODE:case e.COMMENT_NODE:return!0}return!1},s.isNodeInDOM=function(e){return!!e&&s.isDescendant(e.ownerDocument,e)},s.isDescendant=function(e,t){for(;t;){if(e===t)return!0;t=t.parentNode}return!1},s.isDesendant=function(e,t){for(;t;){if(t.className&&t.className.indexOf(e)>-1)return!0;t=t.parentNode}return!1},s.elementInLink=function(e){for(;e&&e.nodeName!=TextEditor.HtmlTagNameUppercase.A;)e=e.parentNode;return!!e},s.elementInTag=function(e,t,n){if(void 0===n&&(n=void 0),!e||!t)return!1;for(t=t.toUpperCase();e&&e!==n&&e.nodeName&&e.nodeName.toUpperCase()!==t;)e=e.parentNode;return!!e},s.getCursorPosition=function(e,t){for(var n=0,o=e;o&&!s.isBlockElement(o)&&o.nodeName.toUpperCase()!==TextEditor.HtmlTagNameUppercase.LI;){for(var i=o.previousSibling;i;)n+=i.textContent.replace(StoryApp.Common.TextHelpers.zeroWidthRegex,"").length,i=i.previousSibling;o=o.parentNode}for(var r=[];o&&o.parentNode&&o!==t;){var a=o.parentNode;r.unshift(Array.prototype.slice.call(a.childNodes).filter(function(e){return e instanceof Element}).indexOf(o)),o=a}return o?{blockPath:r,characterOffset:n}:null},s.getSelection=function(e){var t=document.getSelection();if(!e||!t||1!==t.rangeCount)return null;var n=t.getRangeAt(0);if(!n||!s.isDescendant(e,n.commonAncestorContainer))return null;var o=s.getCursorPosition(s.getNodeForOffset(n.startContainer,n.startOffset),e);if(!o)return null;s.isTextElement(n.startContainer)&&(o.characterOffset+=n.startOffset);var i={start:o,end:null};if(n.collapsed)return i;var r=s.getCursorPosition(s.getNodeForOffset(n.endContainer,n.endOffset),e);return r?(s.isTextElement(n.endContainer)&&(r.characterOffset+=n.endOffset),i.end=r,i):i},s.setSelection=function(e,t){if(e){if(t){var n=s.findNodeAtCursorPosition(t.start,e);if(n){var o;t.end&&((o=s.findNodeAtCursorPosition(t.end,e))||StoryLog.TraceTag(596473176,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.warning,"Failed to restore selection end position on undo/redo")),o=o||n;var i=document.getSelection();if(i){i.removeAllRanges();var r=StoryApp.Utilities.createRange();r.setStart(n.node,n.offset),r.setEnd(o.node,o.offset),i.addRange(r),TextEditor.Cursor.updateRangeToCurrentSelection()}}else StoryLog.TraceTag(596473175,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.warning,"Failed to restore cursor position on undo/redo")}}else StoryLog.RaiseRecoverableError("couldn't find editable region for cursor")},s.getNodeForOffset=function(e,t){return s.isTextElement(e)?e:e.childNodes.item(t)},s.findNodeAtCursorPosition=function(e,t,n){void 0===n&&(n=!0);for(var o=e.blockPath,i=t,r=0,a=o.length;r<a;++r)if(!(i=Array.prototype.slice.call(i.childNodes).filter(function(e){return e instanceof Element})[o[r]]))return null;var s=e.characterOffset,l=i.firstChild;if(!l)return 0===s?{node:i,offset:s}:null;for(i=l;i;){var c=i.textContent.replace(StoryApp.Common.TextHelpers.zeroWidthRegex,""),d=c.length;if(d<s)s-=d,i=i.nextSibling;else{var u=i.firstChild;if(!u)return n&&(i.textContent=c),{node:i,offset:s};i=u}}return null},s.updateClassList=function(e){if(e.nodeName.toUpperCase()==TextEditor.HtmlTagNameUppercase.SPAN){var t=e,n=!1,o=!1;t.style.fontWeight==s.emphasisFontWeight&&(n=!0),t.style.fontStyle==s.specialFontStyle&&(o=!0),t.removeAttribute("style"),n&&o&&!t.classList.contains(s.specialEmphasisClass)?t.classList.add(s.specialEmphasisClass):n&&!t.classList.contains(s.emphasisClass)?t.classList.add(s.emphasisClass):o&&!t.classList.contains(s.specialClass)&&t.classList.add(s.specialClass)}},s.formatContainsFormat=function(e,t){return void 0!==e&&void 0!==t&&(e===n.SpecialEmphasis||e===t)},s.getFormatType=function(e){return e&&e.nodeName.toUpperCase()==TextEditor.HtmlTagNameUppercase.STRONG?e.parentNode&&e.parentNode.nodeName.toUpperCase()==TextEditor.HtmlTagNameUppercase.EM?n.SpecialEmphasis:n.Emphasis:e&&e.nodeName.toUpperCase()==TextEditor.HtmlTagNameUppercase.EM?e.parentNode&&e.parentNode.nodeName.toUpperCase()==TextEditor.HtmlTagNameUppercase.STRONG?n.SpecialEmphasis:n.Special:void 0},s.getChildrensFormat=function(e){var t=s.getFormatType(e);if(void 0!==t)return t;for(var n=void 0,o=0;o<e.childNodes.length;o++)if(e.childNodes[o].textContent.replace(StoryApp.Common.TextHelpers.zeroWidthRegex,"")){var i=s.getChildrensFormat(e.childNodes[o]);if(void 0===i)return;if(void 0===n&&(n=i),n!==i)return}return n},s.createParagraphsFromDraggedText=function(e,t){var n=[],a=e.replace(s.CRLFRegex,"\n").replace(s.carriageReturnRegex,"\n");a&&r.CommonTextVE.dragging&&(a=a.replace(s.doubleNewLineRegex,"\n"));for(var l=a.split("\n"),c=0;c<l.length;c++)if(a.length>0||c<l.length-1){var d=i.currentStoryController().get(t).createParagraph(),u=new o.TextBlock;u.setText(l[c]),d.setContent(u),n.push(d)}return n},s.getTextGroupFromCursor=function(t,n){var o=s.findParentBlockElement(t);if(!o)return null;var r=s.getModelId(o),a=e.Model.StoryModel.getModelObject(r);return i.currentStoryController().get(n).findParent(a)},s.removeEmptyCursorParagraphs=function(e,t){var n=e.parentElement,o=t.parentElement;if(n&&n.nodeName==TextEditor.HtmlTagNameUppercase.P){var i=$(o).text();""!=i&&"\n"!=i&&i!=s.ZeroWidthSpace||n.parentElement.removeChild(n)}if(n!=o&&o&&o.nodeName==TextEditor.HtmlTagNameUppercase.P){var r=$(o).text();""!=r&&"\n"!=r&&r!=s.ZeroWidthSpace||o.parentElement.removeChild(o)}},s.deleteCardIfEmptyText=function(e,t){var n=t.getCardForModelId(e.id);if(n instanceof r.TextCardVE){e.children.getCollection().every(function(e,t,n){return e instanceof o.Paragraph&&0==e.getContent().getText().length})&&n.remove("Removed empty text card")}},s.getFirstParentWithSpecifiedTag=function(e,t,n){if(t){var o=e;for(t=t.toUpperCase();o;){if(o.nodeName.toUpperCase()===t)return o;if(o===n)return;o=o.parentNode}}},s.getFileExtensionFromFileType=function(e){return e.split("/").last()},s.updateTextStyle=function(o,i,a,l){TextEditor.Cursor.updateRangeToCurrentSelection();var c=TextEditor.Cursor.get_Range();c&&c.isValid()&&(e.Model.currentUndoManager().get(l).captureUserUpdate(function(){return{activeModelObjectIds:[r.CommonTextVE.commit()]}},"commit text before user update text format operation",!0),e.Model.currentUndoManager().get(l).captureUserUpdate(function(){switch(s.expandCursorToWord(c),o){case n.Emphasis:TextEditor.Cursor.bold(),s.logFormatChange(o,TextEditor.Cursor.isInBoldNode(),c,i);break;case n.Special:TextEditor.Cursor.italic(),s.logFormatChange(o,TextEditor.Cursor.isInItalicNode(),c,i)}return t.TextFormatter.formatElement(s.currentEditableRegion(),{isSingleLine:a},!1),TextEditor.Cursor.update(),{activeModelObjectIds:[r.CommonTextVE.commit()]}},"User updated the text format"))},s.getTextRunUrl=function(e,t){if(""!=e.getUrl())return e.getUrl();for(var n=e.getIndex(),o=e.getIndex()+e.getLength(),i=0;i<t.runs.getLength();i++){var r=t.runs.itemAtIndex(i);if(r!=e&&r.getIndex()<=n&&r.getIndex()+r.getLength()>=o&&""!=r.getUrl())return r.getUrl()}return""},s.updateParagraphDirection=function(t,n,o){TextEditor.Cursor.updateRangeToCurrentSelection();var i=TextEditor.Cursor.get_Range();i&&i.isValid()&&e.Model.currentUndoManager().get(o).captureUserUpdate(function(){return{activeModelObjectIds:[r.CommonTextVE.commit()]}},"commit text before user update text format operation",!0),e.Model.currentUndoManager().get(o).captureUserUpdate(function(){var e=t?ClientAction.ActionType.Storyline_Text_LeftToRight:ClientAction.ActionType.Storyline_Text_RightToLeft;return s.logTextAction(e,"User changed text direction",!1),TextEditor.Cursor.setDirection(t),TextEditor.Cursor.update(),{activeModelObjectIds:[r.CommonTextVE.commit()]}},"User updated the text direction")},s.logFormatChange=function(e,t,i,r){if(s.formatContainsFormat(e,n.Special)){l={"New Special":t};s.logTextAction(ClientAction.ActionType.Storyline_Text_Special,"User changed special",r,i,void 0,void 0,l)}if(s.formatContainsFormat(e,n.Emphasis)){var a=t?o.EmphasisLevel.More:o.EmphasisLevel.None,l={"New Emphasis":o.EmphasisLevel[a]};s.logTextAction(ClientAction.ActionType.Storyline_Text_Emphasize,"User changed emphasis",r,i,void 0,void 0,l)}},s.populateCssClassToFormat=function(){var e={};return e[s.emphasisClass]=n.Emphasis,e[s.specialClass]=n.Special,e[s.specialEmphasisClass]=n.SpecialEmphasis,e},s.getModelId=function(e){var t=e.getAttribute("id");return t?t.substring(1):void 0},s.generateElementId=function(e){return"_"+e},s.setElementId=function(e,t){e.setAttribute("id",s.generateElementId(t))},s.removeParagraph=function(e){if(e){var t=s.generateElementId(e.id),n=document.getElementById(t);n&&n.parentElement.removeChild(n)}},s.getCSSRule=function(e,t){if(void 0===t&&(t=[]),document.styleSheets){e=e.toLowerCase();for(var n=0;n<document.styleSheets.length;n++){var o=document.styleSheets[n],i=0,r=void 0;do{if(r=s.getCssStyleRuleAtIndex(o,i),s.cssSelectorTextMatches(r,e,t))return r;i++}while(r)}}},s.addCSSRule=function(e,t,n){void 0===t&&(t=[]);var o=s.getCSSRule(e,t);if(document.styleSheets&&!o){for(var i=0;i<t.length;i++)e+="::"+t[i];var r=document.styleSheets[0];r.addRule?r.addRule(e,n,0):(n=n?"{ "+n+" }":"{ }",r.insertRule(e+" "+n,0)),o=s.getCssStyleRuleAtIndex(r,0)}return o},s.removeCSSRule=function(e,t){if(void 0===t&&(t=[]),document.styleSheets){e=e.toLowerCase();for(var n=0;n<document.styleSheets.length;n++){var o=document.styleSheets[n],i=0,r=void 0;do{if(r=s.getCssStyleRuleAtIndex(o,i),s.cssSelectorTextMatches(r,e,t))return void(o.deleteRule?o.deleteRule(i):o.removeRule&&o.removeRule(i));i++}while(r)}}},s.logTextAction=function(e,t,n,o,i,r,a){var l=-1;if(o){var c=window.getSelection();if(i||(i=(d=s.findParentBlockElement(c.anchorNode))&&s.getModelId(d)),!r){var d=s.findParentBlockElement(c.focusNode);r=d&&s.getModelId(d)}var u=o.get_text();void 0!==u&&(l=u.length)}var p=new ClientAction.StorylineTextActionData(e,t,i,r,l,n,a);ActionLogger.RecordClientAction(p)},s.getCssStyleRuleAtIndex=function(e,t){return s.hasCssRules(e)?e.cssRules[t]:e.rules?e.rules[t]:void 0},s.hasCssRules=function(e){try{if(e.cssRules)return!0}catch(e){if("SecurityError"===e.name)return!1;throw e}return!1},s.cssSelectorTextMatches=function(e,t,n){var o=e&&e.selectorText?e.selectorText.toLocaleLowerCase():"",i=[];if(o.indexOf("::")>-1)o=(r=o.split("::"))[0],i=r.slice(1);else if(o.indexOf(":")>-1){var r=o.split(":");o=r[0],i=r.slice(1)}if(o!=t)return!1;if(n.length!=i.length)return!1;for(var a=0;a<n.length;a++)if(n[a]!=i[a])return!1;return!0},s.validateTextRunURL=function(e){return e&&""!=e&&-1==e.indexOf("javascript:")},s.splitParagraphs=function(t,n,r){var a=s.findParentBlockElement(t);if(!a||a.nodeName.toUpperCase()!=TextEditor.HtmlTagNameUppercase.P)return null;var l=s.findParentBlockElement(n);if(!l||l.nodeName.toUpperCase()!=TextEditor.HtmlTagNameUppercase.P){var c=n.previousSibling;if(!l||!c||c.nodeName.toLocaleUpperCase()!=TextEditor.HtmlTagNameUppercase.P)return null;c.appendChild(n),l=c}var d=a==l,u=s.getModelId(a),p=d?u:s.getModelId(l);if(!u||!p)return null;var g=e.Model.StoryModel,h=g.getModelObject(u),C=d?h:g.getModelObject(p),f=i.currentStoryController().get(r).findParent(h);if(!(f&&f instanceof o.TextGroup))return null;if(t.nextSibling==n)return""!=h.getContent().getText().trim()?[h]:null;var m=f.children.getCollection(),y=ArrayExtensions.indexOfFirst(m,function(e){return e.id==u}),v=d?y:ArrayExtensions.indexOfFirst(m,function(e){return e.id==p});if(-1==y||-1==v)return null;var S=s.splitParagraph(t,a,f,h,y,!0,r),T=S.insertIndex,w=S.splittedParagraph,A=T>y&&w&&0!=w.textContent.length;d&&A&&(l=w,C=f.children.getCollection()[T]),A&&v++;var E=(S=s.splitParagraph(n,l,f,C,v,!1,r)).insertIndex;return f.children.getCollection().slice(T,E+1)},s.splitParagraph=function(e,n,r,a,l,c,d){if(0==n.textContent.length)return{insertIndex:l,splittedParagraph:null};var u=document.createElement("p"),p=document.createElement("p");s.splitClone(n,e,u,p,!1,!0),t.TextFormatter.setElementStructureIfRequired(u),t.TextFormatter.setElementStructureIfRequired(p);var g=l,h=c?p:u;if(0==u.textContent.length||0==p.textContent.length)return 0==h.textContent.length&&(c?g++:g--),{insertIndex:g,splittedParagraph:h};var C=new o.TextBlock;s.convertElementToTextBlock(C,c?u:p),a.setContent(C),g=c?l+1:l;var f=i.currentStoryController().get(d).createParagraph();return C=new o.TextBlock,s.convertElementToTextBlock(C,c?p:u),f.setContent(C),i.currentStoryController().get(d).addSpecifiedGroupChild(f,r,g),{insertIndex:g,splittedParagraph:h}},s.containsNode=function(e,t){if(e.isEqualNode(t))return!0;if(e.hasChildNodes())for(var n=0;n<e.childNodes.length;n++)if(s.containsNode(e.childNodes[n],t))return!0;return!1},s.splitClone=function(e,t,n,o,i,r){if(e.isEqualNode(t))return!0;var a=n,l=o;r||(n.appendChild(e.cloneNode(!1)),o.appendChild(e.cloneNode(!1)),a=n.lastChild,l=o.lastChild);for(var c=0;c<e.childNodes.length;c++){var d=e.childNodes[c];s.containsNode(d,t)?i=s.splitClone(d,t,a,l,i,!1):i?l.appendChild(d.cloneNode(!0)):a.appendChild(d.cloneNode(!0))}return i},s.moveCursorForListCreation=function(e){var n=new t.TextFormatterCursorManager;n.markCursorChanged();var o=e.get_startMarker();if(jQuery.contains(document.body,o)){if(t.TextFormatter.condenseInlineElements(o.parentNode,!0,n),!jQuery.contains(document.body,o)){if(TextEditor.Cursor.updateRangeToCurrentSelection(),!jQuery.contains(document.body,o))return void StoryLog.TraceTag(596473178,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.warning,"moveCursorForListCreation: condenseInlineElements removed the cursor markers. updating the range did not fix the issue");StoryLog.TraceTag(596473179,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"moveCursorForListCreation: condenseInlineElements removed the cursor markers. updating the range fixed the issue")}o.previousSibling&&""!==o.previousSibling.textContent.replace(StoryApp.Common.TextHelpers.zeroWidthRegex,"")?e.moveAfterNode(o.previousSibling):e.moveToEndOfNode(o.parentNode),n.updateCursorIfNeeded()}else{var i=window.getSelection().anchorNode;StoryLog.TraceTag(596473177,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.warning,"moveCursorForListCreation not required because the selection was not in the Text Area. Selection Anchor:"+i)}},s.getCurrentRange=function(){try{return StoryApp.RethrowLogger.logIfError(function(){var e=window.getSelection(),t=StoryApp.Utilities.createRange();return t.setStart(e.anchorNode,e.anchorOffset),t.setEnd(e.focusNode,e.focusOffset),t})}catch(e){return}},s.moveCursorToRange=function(e){try{var t=window.getSelection();t.removeAllRanges(),t.addRange(e)}catch(e){StoryLog.TraceTag(596455488,Diag.ULSCat.msoulscat_Story_Site,Diag.ULSTraceLevel.info,"Failed to clear DOM focus: "+e)}},s.currentEditableRegion=function(){var e=TextEditor.Canvas.currentEditableRegion();if(e)return e;for(var t=TextEditor.Cursor.getCurrentElement();t&&!(t instanceof HTMLDivElement);)t=t.parentElement;return t},s.IsCursorAtTheBeginning=function(e,t){if(void 0===t&&(t=!0),t){var n=TextEditor.Cursor.get_Range();if(!n||!n.isEmpty())return!1}var o=window.getSelection(),i=o.anchorNode,r=o.anchorOffset;if(e.nodeType===Node.TEXT_NODE)return e===i&&(0===r||1===r&&i.textContent[0]===s.ZeroWidthSpace);if(e===i){for(var a=!1,l=0;l<r;l++)if((u=e.childNodes[l].textContent)!==s.ZeroWidthSpace||a){if(u.length>0)return!1}else a=!0;return!0}for(var c=e.childNodes.length,a=!1,l=0;l<c;l++){var d=e.childNodes[l];if(s.nodeContainsCursor(d))return s.IsCursorAtTheBeginning(d,!1);var u=d.textContent;if(u!==s.ZeroWidthSpace||a){if(u.length>0)return!1}else a=!0}return!1},s.AddEmptyParagraphAfterIfNeeded=function(){var e=window.getSelection();if(e.anchorNode){var n=e.anchorNode.nodeType===Node.TEXT_NODE?e.anchorNode:e.anchorNode.childNodes[e.anchorOffset],o=s.findParentBlockElement(n);if(o||(n=TextEditor.Cursor.get_Range().get_startMarker(),o=s.findParentBlockElement(n)),null!=o&&o instanceof HTMLParagraphElement){var i=o;if(""!=i.textContent&&s.IsCursorAtTheBeginning(i)){var r=i.parentElement;if(null!=r){var a=i.previousSibling,l=i.nextSibling;if(null!=a&&s.isListElement(a)&&null!=a.childNodes&&a.childNodes.length>0&&s.isListElement(a.childNodes[a.childNodes.length-1])&&null!=l&&s.isListElement(l)){StoryLog.TraceTag(596473180,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Work around applied for merging list item with a paragraph followed by another list item.");var c=document.createElement(TextEditor.HtmlTagNameUppercase.P);r.insertBefore(c,l),t.TextFormatter.setElementStructureIfRequired(c)}}}}}},s.sanitizeHtml=function(e){return a.SymbolsToHTMLEntities(e)},s.containsClassNamePrefix=function(e,t){return!t||!!e&&(0===e.indexOf(t)||e.indexOf(" "+t)>=0)},s.splitTextGroup=function(e,t,n,r){if(!e||!t)return 0;var a=i.currentStoryController().get(r),l=a.findParent(e),c=a.findContainingCollection(e,l);if(!c)return 0;var d=c.getCollection().indexOf(e),u=e.children.getCollection(),p=u.length-1;if(t===u[p].id)return d;var g=o.TextGroup.Create(e.storyModel);for(c.add(g,d+1),p=e.children.getCollection().length-1;p>=0;p--){var h=e.children.getCollection()[p];if(h.id===t)break;n&&s.removeParagraph(h),e.children.remove(h),g.children.add(h,0)}return d},s.selectTextAtCurrentIP=function(){var e=window.getSelection();if(e.focusNode){var t=StoryApp.Utilities.createRange();t.setStartBefore(e.focusNode),t.setEndAfter(e.focusNode),e.addRange(t)}},s.keyboardEventContainsModifierKey=function(e){return e.altKey||e.ctrlKey||e.metaKey||e.shiftKey},s.ZeroWidthSpaceHtml="&#8203;",s.ZeroWidthSpace="",s.zeroWidthRegex=/[\u200B-\u200D\uFEFF]/g,s.WordCharacterPattern=/[^ \f\n\r\t\v\u00a0\u1680\u180e\u2000-\u200b\u2028\u2029\u202f\u205f\u3000\ufeff]/,s.bulletedListPrefixesRegex=/^[\*\-]$/,s.numberedListPrefixesRegex=/^1[\.\)]$/,s.carriageReturnRegex=/\r/g,s.lineFeedRegex=/\n/g,s.CRLFRegex=/\r\n/g,s.doubleNewLineRegex=/\n\n/g,s.spaceRegex="\\s",s.noAutoLinkPunctuation=/([.,!?$%\^\*;:{}=\-_`~()]+\s|\s)/g,s.emphasisClass="ms-rteStyle-Emphasis",s.specialClass="ms-rteStyle-Special",s.specialEmphasisClass="ms-rteStyle-SpecialEmphasis",s.emphasisFontWeight="bold",s.specialFontStyle="italic",s.cssClassToFormat=s.populateCssClassToFormat(),s}();t.TextHelperMethods=s}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=e.View.ViewElements,r=function(){function e(e){this.supportedTextElementsForNewParagraphs=[TextEditor.HtmlTagNameUppercase.P,TextEditor.HtmlTagNameUppercase.SPAN,TextEditor.HtmlTagNameUppercase.A,TextEditor.HtmlTagNameUppercase.UL,TextEditor.HtmlTagNameUppercase.OL,TextEditor.HtmlTagNameUppercase.STRONG,TextEditor.HtmlTagNameUppercase.EM],this.emphasisNodeNames=[TextEditor.HtmlTagNameUppercase.B,TextEditor.HtmlTagNameUppercase.STRONG,TextEditor.HtmlTagNameUppercase.H2,TextEditor.HtmlTagNameUppercase.H3,TextEditor.HtmlTagNameUppercase.H4,TextEditor.HtmlTagNameUppercase.H5],this.specialNodeNames=[TextEditor.HtmlTagNameUppercase.I,TextEditor.HtmlTagNameUppercase.EM],this._args=e}return e.prototype.clearPasteContainer=function(e,t){for(;e.firstChild;)e.removeChild(e.firstChild);TextEditor.PasteManager.finishCleanup(t)},e.prototype.filterPaste=function(t,n,o){if(this._args){i.DeserializeAction.isSerializedData($(t).text())?StoryLog.TraceTag(596473169,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"User pasted some cards into the storyline"):(this.hasFoundUnusableImage=!1,this.unusableImageCount=0,this.filterPastedElement(t),this.hasFoundUnusableImage&&StoryLog.TraceTag(596473168,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Unusable images found ("+this.unusableImageCount+"). Bug: 1600829."));var r=[];i.DeserializeAction.isSerializedData($(t).text())&&(r=this.getSiblingsAbsorbedByPastedGroup(),this.removeTagsFromSerializedData(t));var a=[];this.transferFilteredElement(t,a,this._args);var s=$(n).find("#ms-rterangepaste-start").get()[0],l=[],c=[];if(StoryApp.Utilities.arrayContainsAtLeastOneNonNullValue(a)){c=this.addElementsToModel(a);var d=this.calculateIndexOfFlow(c);if(0===d)RTE.RtePasteManager.keepSelectedText=!0;else{var u=this.getElementsAfterPasteCursor(n,t,s),p=c.slice(0,d),g=c.slice(d),h=p[p.length-1],C=ArrayExtensions.mapAndFilter(r,function(e){return e.getViewModel().getModel()}),f=this.addTrailingTextElementsToModel(u,h,C);l=p.concat(f).concat(g)}}e.uploadRemainingClipboardImages(i.CommonTextVE.clipboardImages,this._args.fileUploader),i.CommonTextVE.clipboardImages=[],TextEditor.PasteManager.finishCleanup(o);var m=s&&s.parentElement;if(m!=n){if(""==(m&&$(m).text().replace(StoryApp.Common.TextHelpers.zeroWidthRegex,""))&&m.parentNode){for(var y=m.childNodes.length,v=0;v<y;v++){var S=m.childNodes[v];S.nodeType===Node.ELEMENT_NODE&&S.id.indexOf("ms-rte")>-1&&(m.parentNode.insertBefore(S,m),v--,y--)}m.parentNode.removeChild(m)}""==(m&&m.previousSibling?$(m.previousSibling).text().replace(StoryApp.Common.TextHelpers.zeroWidthRegex,""):void 0)&&m.previousSibling.parentNode&&m.previousSibling.parentNode.removeChild(m.previousSibling)}return e.removeInitialZWSpaceParagraph(m),this._args.cardsContainer&&this._args.cardsContainer.scrollToModelsAndSetFocus(c,!1),ArrayExtensions.mapAndFilter(l,function(e){return e.id})}this.clearPasteContainer(t,o)},e.prototype.filterPastedElement=function(n,o){if(void 0===o&&(o=!0),o&&(this.curTextContainer=void 0,this.containsBlockElement=e.containsBlockElement(n),null!=n.parentNode)){var i=n.parentNode.nodeName.toUpperCase();i==TextEditor.HtmlTagNameUppercase.P||i==TextEditor.HtmlTagNameUppercase.H1||i==TextEditor.HtmlTagNameUppercase.BODY||i==TextEditor.HtmlTagNameUppercase.DIV?this.topLevelIsBlockElement=!0:this.topLevelIsBlockElement=!1}for(var r=0;r<n.childNodes.length;r++){var a=n.childNodes[r];if(a.nodeType!=Node.TEXT_NODE)if(a.nodeType!=Node.COMMENT_NODE){var s=a.nodeName.toUpperCase();if(s!=TextEditor.HtmlTagNameUppercase.BR)if(s!=TextEditor.HtmlTagNameUppercase.P&&s!=TextEditor.HtmlTagNameUppercase.H1)if(s!=TextEditor.HtmlTagNameUppercase.IMG)if(s!=TextEditor.HtmlTagNameUppercase.DIV)if(s!=TextEditor.HtmlTagNameUppercase.OL&&s!=TextEditor.HtmlTagNameUppercase.UL)if(s!=TextEditor.HtmlTagNameUppercase.LI)if(s!=TextEditor.HtmlTagNameUppercase.SPAN)if(ArrayExtensions.contains(this.emphasisNodeNames,s)){if(1==a.childNodes.length&&ArrayExtensions.contains(this.specialNodeNames,a.firstChild.nodeName)){r=this.filterFormattedChild(n,a,r,o,t.TextHelperMethods.specialEmphasisClass,!0);continue}r=this.filterFormattedChild(n,a,r,o,t.TextHelperMethods.emphasisClass)}else if(ArrayExtensions.contains(this.specialNodeNames,s)){if(1==a.childNodes.length&&ArrayExtensions.contains(this.emphasisNodeNames,a.firstChild.nodeName)){r=this.filterFormattedChild(n,a,r,o,t.TextHelperMethods.specialEmphasisClass,!0);continue}r=this.filterFormattedChild(n,a,r,o,t.TextHelperMethods.specialClass)}else s!=TextEditor.HtmlTagNameUppercase.A?s!=TextEditor.HtmlTagNameUppercase.IFRAME?s!=TextEditor.HtmlTagNameUppercase.STYLE?(StoryLog.TraceTag(596473170,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.verbose,"Removing unknown element "+s),r=this.removeElement(n,a,r,!0)):r=this.filterStyleChild(n,a,r):r=this.filterIFrameChild(n,a,r):r=this.filterLinkChild(n,a,r,o);else r=this.filterSpanChild(n,a,r,o);else r=this.filterListItemChild(n,a,r);else e.handleBug135582(n),r=this.filterListChild(n,a,r,o);else r=this.filterDivChild(n,a,r);else r=this.filterImageChild(n,a,r,o);else r=this.filterParagraphOrHeadingChild(n,a,r,o);else r=this.filterBreakChild(n,a,r)}else n.removeChild(a),r--;else r=this.filterTextChild(n,a,r,o)}},e.containsBlockElement=function(t){for(var n=t.childNodes.length,o=0;o<n;o++){var i=t.childNodes[o];if(i.nodeType==Node.ELEMENT_NODE){var r=i.nodeName.toUpperCase();if(r==TextEditor.HtmlTagNameUppercase.DIV||r==TextEditor.HtmlTagNameUppercase.P)return!0;if(e.containsBlockElement(i))return!0}}return!1},e.prototype.filterTextChild=function(e,n,o,i){var r=n.textContent;if(i&&/^(\r\n|\n|\r)+$/.test(r))return this.removeElement(e,n,o);if(r=r.replace(/(\r\n|\n|\r)/gm," "),r=r.replace(/[\u2028\u2029]/g," "),r=r.replace(/\t/g," "),!i||this.topLevelIsBlockElement&&!this.containsBlockElement)n.textContent=r;else{this.curTextContainer?o--:(this.curTextContainer=document.createElement("p"),e.insertBefore(this.curTextContainer,n));var a=document.createTextNode(r);this.curTextContainer.appendChild(a),e.removeChild(n),t.TextFormatter.setElementStructureIfRequired(this.curTextContainer)}return o},e.prototype.filterBreakChild=function(e,t,n){this.curTextContainer=void 0;var o=t.parentNode;if(o.nodeName.toUpperCase()==TextEditor.HtmlTagNameUppercase.P)for(var i=$(o).contents(),r=i.length-1;r>-1;r--){var a=i[r];if(a==t){e.removeChild(t);break}$(a).insertAfter(o)}else e.removeChild(t),n--;return n},e.prototype.filterParagraphOrHeadingChild=function(e,n,o,i){var r=n.nodeName.toUpperCase()==TextEditor.HtmlTagNameUppercase.H1;if(this._args.removeHeadings&&r)return this.removeElement(e,n,o,!0);if(n!==this.curTextContainer&&(this.curTextContainer=void 0),t.TextHelperMethods.removeAllAttrs(n),i)this.filterPastedElement(n,!1),""===$(n).text()&&t.TextFormatter.setElementStructureIfRequired(n);else{var a=n.parentNode;if(a.nodeName.toUpperCase()==TextEditor.HtmlTagNameUppercase.P)for(var s=$(a).contents(),l=s.length-1;l>-1;l--){var c=s[l];if($(c).insertAfter(a),c==n)break}else $(n).contents().insertAfter(n),e.removeChild(n),o--}return o},e.prototype.filterImageChild=function(e,n,o,r){if(this._args.removeImages)return this.removeElement(e,n,o);this.curTextContainer=void 0;var a=n.getAttribute("src");if(!a)return e.removeChild(n),o-1;if(i.CommonTextVE.clipboardImages=[],0===a.indexOf("http://")||0===a.indexOf("https://")||0===a.indexOf("data:image")){if(t.TextHelperMethods.removeAllAttrs(n,["src"]),!r)for(var s=$(n.parentNode),l=s.contents(),c=l.length-1;c>-1;c--){var d=l[c];if(d!=n)$(d).insertAfter(s);else for(var u=$(n.parentNode),p=u.contents(),g=p.length-1;g>-1;g--){var h=p[g];h==n&&$(h).insertAfter(u)}}return o}return a.indexOf("file://")>-1&&(this.hasFoundUnusableImage=!0,this.unusableImageCount++),this.removeElement(e,n,o)},e.prototype.filterDivChild=function(e,t,n){return this.removeElement(e,t,n,!0)},e.prototype.filterListChild=function(e,n,o,i){return this._args.removeLists?this.removeElement(e,n,o,!0):(this.curTextContainer=void 0,t.TextHelperMethods.removeAllAttrs(n),this.filterPastedElement(n,!1),o)},e.prototype.filterListItemChild=function(e,n,o){if(this._args.removeLists){var i=document.createElement("p");return e.insertBefore(i,n),$(i).append($(n).contents()),t.TextFormatter.setElementStructureIfRequired(i),e.removeChild(n),o-1}return t.TextHelperMethods.removeAllAttrs(n),this.filterPastedElement(n,!1),o},e.handleBug135582=function(t){for(var n=function(t){return e.stringContainsBug135582Pattern(t.textContent)>-1?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT},o=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,n,!1),i=o.firstChild();i;){var r=i.textContent;i.textContent=e.workAroundBug135582(r),i=o.nextNode()}StoryLog.StructuredTraceTag(596473171,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Workaround",{BugId:"135582"})},e.stringContainsBug135582Pattern=function(e){return e.search(/(\r|\n)+\s{5,}/)},e.workAroundBug135582=function(e){return e.replace(/(\r|\n)+\s{5,}/g," ")},e.prototype.filterSpanChild=function(e,n,o,i){if(this._args.removeFormatting)return this.removeElement(e,n,o,!0);var r=n.getAttribute("class");if(r&&t.TextHelperMethods.containsClassNamePrefix(r,"ms-rte"))return o-=this.ensureTextContainer(e,n,i),this.filterPastedElement(n,!1),o;var a,s="italic"===n.style.fontStyle&&!t.TextHelperMethods.elementInTag(n,"em"),l="bold"===n.style.fontWeight&&!t.TextHelperMethods.elementInTag(n,"strong");if(s&&(a=document.createElement("em"),$(a).append($(n).contents())),l){var c=document.createElement("strong");a?c.appendChild(a):$(c).append($(n).contents()),a=c}return a&&$(a).insertAfter(n),this.removeElement(e,n,o,!0)},e.prototype.filterFormattedChild=function(e,n,o,i,r,a){if(void 0===a&&(a=!1),this._args.removeFormatting)return this.removeElement(e,n,o,!0);var s,l=a?n.firstChild:n,c=n.nodeName.toUpperCase()===TextEditor.HtmlTagNameUppercase.H1||n.nodeName.toUpperCase()===TextEditor.HtmlTagNameUppercase.H2||n.nodeName.toUpperCase()===TextEditor.HtmlTagNameUppercase.H3||n.nodeName.toUpperCase()===TextEditor.HtmlTagNameUppercase.H4||n.nodeName.toUpperCase()===TextEditor.HtmlTagNameUppercase.H5||n.nodeName.toUpperCase()===TextEditor.HtmlTagNameUppercase.H6;if(r==t.TextHelperMethods.specialEmphasisClass){var d=document.createElement(TextEditor.HtmlTagNameUppercase.EM);$(d).append($(l).contents()),s=document.createElement(TextEditor.HtmlTagNameUppercase.STRONG),$(s).append($(d))}else r==t.TextHelperMethods.emphasisClass?(s=document.createElement(TextEditor.HtmlTagNameUppercase.STRONG),$(s).append($(l).contents())):(s=document.createElement(TextEditor.HtmlTagNameUppercase.EM),$(s).append($(l).contents()));return e.insertBefore(s,n),e.removeChild(n),o-=this.ensureTextContainer(e,s,i),c&&(this.curTextContainer=void 0),this.filterPastedElement(s,!1),o},e.prototype.filterLinkChild=function(e,n,o,i){var r=n.getAttribute("href");return this._args.removeLinks||!r?this.removeElement(e,n,o,!0):(t.TextHelperMethods.removeAllAttrs(n,["href"]),n.setAttribute("rel","nofollow noreferrer"),o-=this.ensureTextContainer(e,n,i),this.filterPastedElement(n,!1),o)},e.prototype.filterIFrameChild=function(e,t,n){return this.removeElement(e,t,n)},e.prototype.filterStyleChild=function(e,t,n){return this.removeElement(e,t,n)},e.prototype.removeElement=function(e,t,n,o){return void 0===o&&(o=!1),o&&$(t).contents().insertAfter(t),e.removeChild(t),--n},e.prototype.ensureTextContainer=function(e,n,o){var i=0;return!o||!this.containsBlockElement&&this.topLevelIsBlockElement||(this.curTextContainer?i++:(this.curTextContainer=document.createElement("p"),e.insertBefore(this.curTextContainer,n)),this.curTextContainer.appendChild(n),t.TextFormatter.setElementStructureIfRequired(this.curTextContainer),i++),i},e.prototype.getElementsAfterPasteCursor=function(e,n,o){var i=[],r=n,a=n.parentElement;if(a&&"BODY"==a.nodeName.toUpperCase()){if(!o)return[];a=(r=o).parentElement}var s=function(n){var o,l=n.parentNode,c=n==r;c&&(o=document.createElement(l.nodeName));for(var d=$(l).contents().index(n)+1;d<l.childNodes.length;d++)if(c){var u=a.childNodes.item(d);if(u.nodeName.toUpperCase()==TextEditor.HtmlTagNameUppercase.SPAN&&u.id&&u.id.indexOf("ms-rte")>-1)continue;u&&u.attributes&&u.attributes.getNamedItem("id")&&u.attributes.removeNamedItem("id"),o.appendChild(u),d--}else{var p=l.childNodes.item(d);l.removeChild(p),i.push(p),d--}if(c&&o&&o.childNodes.length>0&&i.push(o),t.TextFormatter.setElementStructureIfRequired(o),l!=e){if(i.length>0){for(var g=document.createElement(l.nodeName),h=0;h<i.length;h++)g.appendChild(i[h]);i=[g]}s(l)}};return s(r),i},e.prototype.addElementsToModel=function(e,t){var n=this;if(!StoryApp.Utilities.arrayContainsAtLeastOneNonNullValue(e))return[];TextEditor.Cursor.updateRangeToCurrentSelection();var o,i=window.getSelection().anchorNode;return TDB.applyUpdate(function(){o=n.addElementsToModelUpdate(e,n._args,t)}),i!=window.getSelection().anchorNode&&TextEditor.Cursor.update(),o},e.prototype.addElementsToModelUpdate=function(e,r,a){var s=o.currentStoryController().get(this._args.pageId),l=[],c=r.model;if(a&&a.length>0){var d=a[a.length-1];if(d)if(d instanceof n.SpecifiedGroup){var u=d.children.getCollection();c=0===u.length?d.getHeading():u[u.length-1]}else c=d}var p=s.findContainingAtomParent(c,!0);if(!p)return l;p===c&&(p=s.findParent(c));for(var g=o.StoryController.getPrimaryCollection(p).getCollection(),h=s.findParent(c,p);h;){var C=s.findParent(h,p);if(C==p)break;h=C}h=h||c;var f=g.indexOf(h),m=s.getRootGroup(),y=m.children.getCollection().indexOf(p);if(StoryApp.Utilities.arrayContainsAtLeastOneNonNullValue(e)){for(var v,S,T,w=p,A=y>=0?y:-1,E=f>=0?f:-1,_=document.createElement(TextEditor.HtmlTagNameUppercase.DIV),x=e.length,B=0;B<x;B++){if(S=e[B],T=S.nodeName.toUpperCase(),S.nodeType,i.DeserializeAction.isSerializedData(S.textContent)){var b=this.addSerializedDataElements(S.textContent);l=l.concat(b);break}if(S.nodeType!=Node.TEXT_NODE&&!ArrayExtensions.contains(this.supportedTextElementsForNewParagraphs,T)||(v instanceof n.TextGroup||(v=s.createTextGroup(!1),l.addunique(v)),_.appendChild(S.cloneNode(!0)),!(B<x-1)))if(v instanceof n.TextGroup&&(""!=$(_).text().replace(StoryApp.Common.TextHelpers.zeroWidthRegex,"")&&(new t.TextGroupSyncHandler(_,v,this._args.pageId).commitRootToModel(!1),o.StoryController.getPrimaryCollection(w).add(v,++E)),v=null,_=document.createElement(TextEditor.HtmlTagNameUppercase.DIV)),T!=TextEditor.HtmlTagNameUppercase.H1){if(T==TextEditor.HtmlTagNameUppercase.IMG){var D=S,M=D.src;if(0!=M.indexOf("data:image")){M.length>=2&&"//"==M.substring(0,2)&&(M="https:"+M);var V={sourceUrl:M,type:n.ImageCategory.Image,width:D.width,height:D.height},I={imageContentParts:[]};I.imageContentParts.push(V);var P=o.currentImageController().get(this._args.pageId).createFromContent({contentArgs:I});o.StoryController.getPrimaryCollection(w).add(P,++E),l.addunique(P);continue}var k=StoryApp.Utilities.convertBase64ImageToBlob(D);k&&i.CommonTextVE.clipboardImages.addunique(k)}}else{var R=s.removeSpecifiedGroupChildRange(w,E+1),L=(w=o.StoryController.addSpecifiedGroup(m,"",++A)).getHeading().getTitle().getContent();t.TextHelperMethods.convertElementToTextBlock(L,S),l.addunique(w.getHeading()),o.StoryController.addSpecifiedGroupChildRange(R,w),v=null,E=-1}}return l}},e.prototype.addSerializedDataElements=function(e){i.DeserializeAction.isSerializedData(e)||TDB.raiseRecoverableError("We called addSerializedDataElements without valid serialized data.");var n=JSON.parse(e),o={},r=this._args.cardsContainer,a=i.DeserializeAction.execute({modelData:n.modelData,cardsContainer:r,objIds:o,videoPlaceholderIds:n.videoPlaceholderIds,storyHostedVideoIds:n.storyHostedVideoIds,audioPlaceholderIds:n.audioPlaceholderIds,storyHostedAudioIds:n.storyHostedAudioIds,addModelsToGraph:!1,replaceSelectedCards:!1},this._args.pageId),s=new ClientAction.CardDeckPasteAction(n.swayID===StoryPageSettings.LookupId,t.CardDeckCopyPasteHandler.getPropertyValues("objType",n.modelData));ActionLogger.RecordClientAction(s);var l=[];return a.forEach(function(e){return l.push(e.model)}),this._args.cardsContainer.addCardObjects(a),t.CardDeckCopyPasteHandler.updateCopyInfo(l,n.externalDataIds,o,n.swayID),l},e.prototype.appendExistingSpecifiedGroupChildren=function(e,t){for(var n=o.currentStoryController().get(this._args.pageId),i=n.findParent(e),r=o.StoryController.getPrimaryCollection(i);!r;)i=n.findParent(i),r=o.StoryController.getPrimaryCollection(i);var a=r.getCollection(),s=a.indexOf(e);if(i!=n.getRootGroup()&&-1!=s)for(var l=s+1;l<a.length;l++)n.removeSpecifiedGroupChild(a[l],i),n.addSpecifiedGroupChild(a[l],t)},e.prototype.transferFilteredElement=function(e,n,o){for(var r=0,a=0,s=e.childNodes.length,l=!1,c=0;c<e.childNodes.length;c++){var d=e.childNodes.item(c),u=d.nodeName.toUpperCase();if(u==TextEditor.HtmlTagNameUppercase.H1&&r++,u==TextEditor.HtmlTagNameUppercase.IMG&&a++,(u==TextEditor.HtmlTagNameUppercase.H1&&o.isSingleLine||u==TextEditor.HtmlTagNameUppercase.P)&&0==c)$(d).contents().insertAfter(d),e.removeChild(d),c--;else{u!=TextEditor.HtmlTagNameUppercase.H1&&u!=TextEditor.HtmlTagNameUppercase.IMG||(l=!0),o.isSingleLine&&!t.TextFormatter.isInlineElement(d)&&(l=!0);var p=$(e).text();i.DeserializeAction.isSerializedData(p)&&(l=!0),u==TextEditor.HtmlTagNameUppercase.P&&l&&o.removeOverflowText?(e.removeChild(d),c--):l&&(e.removeChild(d),n.push(d),c--)}}ActionLogger.RecordClientAction(new ClientAction.StorylinePasteInfo(s,r,a))},e.removeInitialZWSpaceParagraph=function(e){if(e&&e.childElementCount>0){var t=$(e).find("#ms-rterangepaste-start").get()[0],n=t?t.previousElementSibling:null;n&&!n.previousElementSibling&&""==$(n).text().replace(StoryApp.Common.TextHelpers.zeroWidthRegex,"")&&n.parentNode&&(n.parentNode.removeChild(n),StoryLog.StructuredTraceTag(596473172,Diag.ULSCat.msoulscat_Story_Storyline,Diag.ULSTraceLevel.info,"Workaround",{BugId:"49395"}))}},e.uploadRemainingClipboardImages=function(e,n){for(var o=e.length;o--;){var i=e.pop(),r=t.TextHelperMethods.getFileExtensionFromFileType(i.type),a=FileObject.createFromBlob(i,Resources.ImageUploadDefaultFilename+"."+r);n.uploadFiles([a])}},e.prototype.calculateIndexOfFlow=function(e){var t=this._args.cardsContainer.getActiveCard();return!(t instanceof i.TextCardVE||t instanceof i.ComplexHeadingCardVE)||t.getViewModel().inSocket()?0:this._args.cardDeckCopyPasteHandler.indexOfFlow(e)},e.prototype.removeTagsFromSerializedData=function(e){if(StoryApp.Utilities.browser.isIE){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if("A"==n.nodeName){var o=document.createTextNode($(n).html());e.replaceChild(o,e.childNodes[t])}}e.childNodes.length>0&&(e.textContent=e.childNodes[0].wholeText)}},e.prototype.getSiblingsAbsorbedByPastedGroup=function(){var e=this,t=this._args.cardsContainer.getActiveCard().parent;if(t instanceof i.GroupCardVE){var r=t.getContentCards();if(t.getViewModel().getModel()===o.currentStoryController().get(this._args.pageId).getRootGroup()){if(!(r[0]instanceof i.GroupCardVE)||r[0].headingCard.getValue())return[];r=r[0].getContentCards()}var a=ArrayExtensions.indexOfFirst(r,function(e){return e instanceof n.SpecifiedGroup});a=-1!==a?a:r.length;var s=ArrayExtensions.indexOfFirst(r,function(t){return t===e._args.cardsContainer.getActiveCard()});return r.slice(s+1,a)}return[]},e.prototype.addTrailingTextElementsToModel=function(e,t,o){if(t instanceof n.SpecifiedGroup){var i=t.children.getCollection().length-o.length;t=0===i?t.getHeading():t.children.getCollection()[i-1]}return this.addElementsToModel(e,[t])},e}();t.TextPasteHandler=r}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.View.Bindings,o=CommonBindings.View.Bindings,i=TDB.View.Bindings,r=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new a.C1(n),e,t)},t}(t.BreadcrumbPathVEBase);t.BreadcrumbPathVE=r;var a;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n;var i=TDB.watcherTag(17323652,n,null,n.breadcrumbsArgs),r=new TDB.NewForeachInstructionVE(n,i);r.addResource(i),this.addChild(r,o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=t}(a||(a={}));var s=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new l.Cwrapper(n),e,t)},t}(t.BreadcrumbVEBase);t.BreadcrumbVE=s;var l;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,i=document.createElement("div");this.domElement=i,i._context=n,this._ClassNameBinding=new o.ClassName.Binding(i,e,n,this,n.wrapperClassNameArgs);var r=n.textButtonVEArgs();r&&this.addChild(r.build(n),i,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},t}(TDB.ViewElement);e.Cwrapper=t}(l||(l={}));var c=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o._subscribeToWatchable(o._updateLanguagesListWatcher=TDB.watcherTag(5796370,o,o,o.updateLanguagesList),TDB.UpdatePhase.WriteOnly),o._subscribeToWatchable(o._updateNavigationHintWatcher=TDB.watcherTag(5796370,o,o,o.updateNavigationHint),TDB.UpdatePhase.ReadWrite),o}return __extends(t,e),t.prototype._create=function(e,t){var n=this;TDB.perfMeasurement("AuthoringPageVE_create",function(){var o=n,i=TDB.watcherTag(17323653,o,null,o.swayBarArgs),r=new TDB.NewSubTemplateInstructionVE(o,i,"swayBar");r.addResource(i),n.addChild(r,e,t);i=TDB.watcherTag(17323653,o,null,o.autoScrollerArgs);(r=new TDB.NewSubTemplateInstructionVE(o,i)).addResource(i),n.addChild(r,e,t),n.addChild(new d.CcardDeck(o),e,t);var a=TDB.watcherTag(4543753,o,null,o.authoringPanesArgs);(r=new TDB.ForeachInstructionVE(!1,a)).addResource(a),n.addChild(r,e,t);i=TDB.watcherTag(17323653,o,null,o.recordingDialogArgs);(r=new TDB.NewSubTemplateInstructionVE(o,i,"recordingDialog")).addResource(i),n.addChild(r,e,t);var s=o.closedCaptionUploaderArgs();s&&n.addChild(new TDB.NewSubTemplateInstructionVE(o,TDB.immutableWatchable(s),"closedCaptionUploader"),e,t),n._updateLanguagesListWatcher.resolve(),n.receivePhaseNotification(TDB.UpdatePhase.ReadWrite)})},t.prototype.onUpdate=function(e){e===TDB.UpdatePhase.WriteOnly?this._updateLanguagesListWatcher.resolve():e===TDB.UpdatePhase.ReadWrite&&this._updateNavigationHintWatcher.resolve()},t}(t.AuthoringPageVEBase);t.AuthoringPageVE=c;var d;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,r.id="cardDeck",r.className="CardDeckPane",this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.cardDeckClassNameArgs),this._VisibleBinding=new i.Visible.Binding(r,e,n,this,n.cardDeckVisibleArgs),this._EventsBinding=new i.Events.Binding(r,e,n,this,n.cardDeckEventsInitArgs()),this._FadeVisibleBinding=new o.FadeVisible.Binding(r,e,n,this,n.cardDeckFadeVisibleInitArgs(),n.cardDeckFadeVisibleArgs),this._StyleBinding=new i.Style.Binding(r,e,n,this,n.cardDeckStyleArgs);var a=n.cardDeckArgs();a&&this.addChild(a,r,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._ClassNameBinding.update(e),this._VisibleBinding.update(e),this._FadeVisibleBinding.update(e),this._StyleBinding.update(e)},t.prototype.disposeBindings=function(){this._EventsBinding.dispose(),this._FadeVisibleBinding.dispose()},t}(TDB.ViewElement);e.CcardDeck=t}(d||(d={}));var u=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new p.CswayBarWrapper(n),e,t)},t}(t.SwayBarVEBase);t.SwayBarVE=u;var p;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,this._CssBinding=new i.Css.Binding(r,t,o,this,o.swayBarWrapperCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.C1(o),r,null),this.addChild(new e.C2(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._CssBinding.update(e)},n}(TDB.ViewElement);e.CswayBarWrapper=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.setAttribute("role","tablist"),o.className="SwayBarTabs";var i=TDB.watcherTag(17323653,n,null,n.digitalPrintStorylineCalloutArgs),r=new TDB.NewSubTemplateInstructionVE(n,i);r.addResource(i),this.addChild(r,o,null);i=TDB.watcherTag(17323653,n,null,n.storylineButtonArgs);(r=new TDB.NewSubTemplateInstructionVE(n,i)).addResource(i),this.addChild(r,o,null);i=TDB.watcherTag(17323653,n,null,n.designButtonCalloutArgs);(r=new TDB.NewSubTemplateInstructionVE(n,i)).addResource(i),this.addChild(r,o,null);i=TDB.watcherTag(17323653,n,null,n.previewButtonArgs);(r=new TDB.NewSubTemplateInstructionVE(n,i)).addResource(i),this.addChild(r,o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="SwayRightButtonWrapper";var i=TDB.watcherTag(17323653,n,null,n.remixHeaderArgs),r=new TDB.NewSubTemplateInstructionVE(n,i,"remixHeader");r.addResource(i),this.addChild(r,o,null);i=TDB.watcherTag(17323653,n,null,n.maximizeSearchButtonArgs);(r=new TDB.NewSubTemplateInstructionVE(n,i)).addResource(i),this.addChild(r,o,null);i=TDB.watcherTag(17323653,n,null,n.undoButtonArgs);(r=new TDB.NewSubTemplateInstructionVE(n,i)).addResource(i),this.addChild(r,o,null);i=TDB.watcherTag(17323653,n,null,n.redoButtonArgs);(r=new TDB.NewSubTemplateInstructionVE(n,i)).addResource(i),this.addChild(r,o,null);i=TDB.watcherTag(17323653,n,null,n.insertButtonArgs);(r=new TDB.NewSubTemplateInstructionVE(n,i,"insertButton")).addResource(i),this.addChild(r,o,null);i=TDB.watcherTag(17323653,n,null,n.stylesButtonCalloutArgs);(r=new TDB.NewSubTemplateInstructionVE(n,i)).addResource(i),this.addChild(r,o,null);i=TDB.watcherTag(17323653,n,null,n.designButtonArgs);(r=new TDB.NewSubTemplateInstructionVE(n,i,"designButton")).addResource(i),this.addChild(r,o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C2=o}(p||(p={}));var g=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new h.CifEmphasisFlyout(n),e,t)},t}(t.ContextMenuFlyoutVEBase);t.ContextMenuFlyoutVE=g;var h;!function(e){var t=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifEmphasisFlyoutArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C1(o),t,n)},n}(TDB.IfInstructionVE);e.CifEmphasisFlyout=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n;var i=n.emphasisFlyoutArgs();i&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(i),"_emphasisFlyout"),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=n}(h||(h={}));var C=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new f.C1(n),e,t)},t}(t.EmphasisFlyoutVEBase);t.EmphasisFlyoutVE=C;var f;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="flexCenter";var i=TDB.watcherTag(17323652,n,null,n.emphasisCommandsArgs),r=new TDB.NewForeachInstructionVE(n,i);r.addResource(i),this.addChild(r,o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=t}(f||(f={}));var m=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new y.CifHeroButton(n),e,t)},t}(t.HeroCommandButtonVEBase);t.HeroCommandButtonVE=m;var y;!function(e){var t=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifHeroButtonArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C1(o),t,n)},n}(TDB.IfInstructionVE);e.CifHeroButton=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ContextHeroCommandButtonContainer";var i=n.heroButtonArgs();i&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(i),"commandButton"),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=n}(y||(y={}));var v=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new S.CifDismissableMessage(n),e,t)},t}(t.DismissableNotificationVEBase);t.DismissableNotificationVE=v;var S;!function(e){var t=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifDismissableMessageArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CdismissableMessageContainer(o),t,n)},n}(TDB.IfInstructionVE);e.CifDismissableMessage=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var i=this._context,r=document.createElement("div");this.domElement=r,r._context=i,this._ClassNameBinding=new o.ClassName.Binding(r,t,i,this,i.dismissableMessageContainerClassNameArgs);this.addChild(new e.CdismissableMessageText(i),r,null);var a=i.dismissableMessageCloseArgs();a&&this.addChild(a.build(i),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},n}(TDB.ViewElement);e.CdismissableMessageContainer=n;var i=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,i=document.createElement("div");this.domElement=i,i._context=n,this._ClassNameBinding=new o.ClassName.Binding(i,e,n,this,n.dismissableMessageTextClassNameArgs);var r=TDB.watcherTag(17323652,n,null,n.messagePartsArgs),a=new TDB.NewForeachInstructionVE(n,r);a.addResource(r),this.addChild(a,i,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},t}(TDB.ViewElement);e.CdismissableMessageText=i}(S||(S={}));var T=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new w.C1(n),e,t)},t}(t.FirstRunElementVEBase);t.FirstRunElementVE=T;var w;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o;this.addChild(new e.CfirstRunWrapper(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var r=this._context,a=document.createElement("div");this.domElement=a,a._context=r,this._FadeVisibleBinding=new o.FadeVisible.Binding(a,t,r,this,r.firstRunWrapperFadeVisibleInitArgs(),r.firstRunWrapperFadeVisibleArgs),this._AttrBinding=new i.Attr.Binding(a,t,r,this,r.firstRunWrapperAttrArgs);this.addChild(new e.CfirstRunArrow(r),a,null),this.addChild(new e.CfirstRunText(r),a,null),r.ifFirstRunDetailsTextArgs()&&this.addChild(new e.CfirstRunDetailsText(r),a,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._FadeVisibleBinding.update(e),this._AttrBinding.update(e)},n.prototype.disposeBindings=function(){this._FadeVisibleBinding.dispose()},n}(TDB.ViewElement);e.CfirstRunWrapper=n;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("img");this.domElement=o,o._context=n,this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.firstRunArrowAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e)},t}(TDB.ViewElement);e.CfirstRunArrow=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.firstRunTextClassNameArgs),this._TextBinding=new i.Text.Binding(r,e,n,this,n.firstRunTextTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._ClassNameBinding.update(e),this._TextBinding.update(e)},t}(TDB.ViewElement);e.CfirstRunText=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.firstRunDetailsTextClassNameArgs),this._TextBinding=new i.Text.Binding(r,e,n,this,n.firstRunDetailsTextTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._ClassNameBinding.update(e),this._TextBinding.update(e)},t}(TDB.ViewElement);e.CfirstRunDetailsText=s}(w||(w={}));var A=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new E.CifSearchBox(n),e,t)},t}(t.SearchBoxVEBase);t.SearchBoxVE=A;var E;!function(e){var t=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifSearchBoxArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C1(o),t,n)},n}(TDB.IfInstructionVE);e.CifSearchBox=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="SearchBoxWrapper";this.addChild(new e.CsearchForm(o),i,null);var r=TDB.watcherTag(17323653,o,null,o.searchBoxCalloutArgs),a=new TDB.NewSubTemplateInstructionVE(o,r);a.addResource(r),this.addChild(a,i,null),this.addChild(new e.CifSearchResults(o),i,null),this.addChild(new e.CsearchSuggestionsListWrapper(o),i,null),this.addChild(new e.CsearchBoxReader(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=n;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("form");this.domElement=o,o._context=n,this._EventsBinding=new i.Events.Binding(o,e,n,this,n.searchFormEventsInitArgs());var r=TDB.watcherTag(17323653,n,null,n.searchBoxArgs),a=new TDB.NewSubTemplateInstructionVE(n,r,"searchBox");a.addResource(r),this.addChild(a,o,null);r=TDB.watcherTag(17323653,n,null,n.clearButtonArgs);(a=new TDB.NewSubTemplateInstructionVE(n,r)).addResource(r),this.addChild(a,o,null);r=TDB.watcherTag(17323653,n,null,n.searchButtonArgs);(a=new TDB.NewSubTemplateInstructionVE(n,r)).addResource(r),this.addChild(a,o,null),this._addToDom(e,t)},t.prototype.disposeBindings=function(){this._EventsBinding.dispose()},t}(TDB.ViewElement);e.CsearchForm=r;var a=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifSearchResultsArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CsearchResults(o),t,n)},n}(TDB.IfInstructionVE);e.CifSearchResults=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.searchResultsClassNameArgs),this._TextBinding=new i.Text.Binding(r,e,n,this,n.searchResultsTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._ClassNameBinding.update(e),this._TextBinding.update(e)},t}(TDB.ViewElement);e.CsearchResults=s;var l=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,this._VisibleBinding=new i.Visible.Binding(o,e,n,this,n.searchSuggestionsListWrapperVisibleArgs);var r=n.searchSuggestionsListArgs();r&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(r),"searchSuggestionsList"),o,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._VisibleBinding.update(e)},t}(TDB.ViewElement);e.CsearchSuggestionsListWrapper=l;var c=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("span");this.domElement=o,o._context=n,o.setAttribute("aria-live","polite"),o.setAttribute("aria-atomic","true"),o.setAttribute("aria-hidden","true"),o.className="inlineScreenReaderOnly",this._TextBinding=new i.Text.Binding(o,e,n,this,n.searchBoxReaderTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CsearchBoxReader=c}(E||(E={}));var _=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this,o=TDB.watcherTag(17323653,n,null,n.dropdownListArgs),i=new TDB.NewSubTemplateInstructionVE(n,o,"dropdownList");i.addResource(o),this.addChild(i,e,t)},t}(t.SearchSuggestionsListVEBase);t.SearchSuggestionsListVE=_;var x=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new B.Cwrapper(n),e,t)},t}(t.SearchSuggestionVEBase);t.SearchSuggestionVE=x;var B;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var r=this._context,a=document.createElement("div");this.domElement=a,a._context=r,this._StyleBinding=new i.Style.Binding(a,t,r,this,r.wrapperStyleArgs),this._AttrBinding=new i.Attr.Binding(a,t,r,this,r.wrapperAttrArgs),this._ClassNameBinding=new o.ClassName.Binding(a,t,r,this,r.wrapperClassNameArgs),this._FocusableBinding=r.focusableBinding=new i.Focusable.Binding(a,t,r,this,r.FocusableInitArgs());r.ifSearchSuggestionImageArgs()&&this.addChild(new e.CsearchSuggestionImage(r),a,null),this.addChild(new e.CsearchSuggestionName(r),a,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._StyleBinding.update(e),this._AttrBinding.update(e),this._ClassNameBinding.update(e),this._FocusableBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.Cwrapper=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="searchSuggestionImage",this._StyleBinding=new i.Style.Binding(o,e,n,this,n.searchSuggestionImageStyleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e)},t}(TDB.ViewElement);e.CsearchSuggestionImage=n;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="searchSuggestionName",this._TextBinding=new i.Text.Binding(o,e,n,this,n.searchSuggestionNameTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CsearchSuggestionName=r}(B||(B={}));var b=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;TDB.perfMeasurement("SurfaceAuthoringVE_create",function(){var o=n;n.addChild(new D.CSelectionVellum(o),e,t),n.addChild(new D.CSurfaceSelection(o),e,t);var i=o.contextMenuArgs();i&&n.addChild(i,e,t),n.addChild(new D.C1(o),e,t)})},t}(t.SurfaceAuthoringVEBase);t.SurfaceAuthoringVE=b;var D;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,i=document.createElement("div");this.domElement=i,i._context=n,i.className="selectionVellum",i.setAttribute("style","display: none"),this._FadeVisibleBinding=new o.FadeVisible.Binding(i,e,n,this,n.SelectionVellumFadeVisibleInitArgs(),n.SelectionVellumFadeVisibleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._FadeVisibleBinding.update(e)},t.prototype.disposeBindings=function(){this._FadeVisibleBinding.dispose()},t}(TDB.ViewElement);e.CSelectionVellum=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,i=document.createElement("div");this.domElement=i,i._context=n,i.id="surfaceSelection",i.setAttribute("style","display: none"),this._FadeVisibleBinding=new o.FadeVisible.Binding(i,e,n,this,n.SurfaceSelectionFadeVisibleInitArgs(),n.SurfaceSelectionFadeVisibleArgs),this._ClassNameBinding=new o.ClassName.Binding(i,e,n,this,n.SurfaceSelectionClassNameArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._FadeVisibleBinding.update(e),this._ClassNameBinding.update(e)},t.prototype.disposeBindings=function(){this._FadeVisibleBinding.dispose()},t}(TDB.ViewElement);e.CSurfaceSelection=n;var i=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ShortTextEditorWrapper OnSurfaceTextEditorWrapper";var i=n.shortTextEditorArgs();i&&this.addChild(i,o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=i}(D||(D={}));var M=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new V.CcontextMenuRoot(n),e,t)},t}(t.ContextMenuVEBase);t.ContextMenuVE=M;var V;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.id="contextMenuRoot",this._StyleBinding=new i.Style.Binding(r,t,o,this,o.contextMenuRootStyleArgs),this._VisibleBinding=new i.Visible.Binding(r,t,o,this,o.contextMenuRootVisibleArgs);this.addChild(new e.CcontextMenuCommandsWrapper(o),r,null),this.addChild(new e.CcontextMenuFlyoutWrapper(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._StyleBinding.update(e),this._VisibleBinding.update(e)},n}(TDB.ViewElement);e.CcontextMenuRoot=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="ContextMenuCommandsWrapper",this._StyleBinding=new i.Style.Binding(r,t,o,this,o.contextMenuCommandsWrapperStyleArgs);this.addChild(new e.CcontextMenuCommands(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._StyleBinding.update(e)},n}(TDB.ViewElement);e.CcontextMenuCommandsWrapper=n;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="ContextMenuCommands",this._StyleBinding=new i.Style.Binding(r,t,o,this,o.contextMenuCommandsStyleArgs);this.addChild(new e.CcontextMenuHeroCommands(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._StyleBinding.update(e)},n}(TDB.ViewElement);e.CcontextMenuCommands=r;var a=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var i=this._context,r=document.createElement("div");this.domElement=r,r._context=i,this._ClassNameBinding=new o.ClassName.Binding(r,t,i,this,i.contextMenuHeroCommandsClassNameArgs);this.addChild(new e.C1(i),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},n}(TDB.ViewElement);e.CcontextMenuHeroCommands=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="flexCenter";var i=TDB.watcherTag(17323652,n,null,n.heroCommandsArgs),r=new TDB.NewForeachInstructionVE(n,i);r.addResource(i),this.addChild(r,o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=s;var l=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="ContextMenuFlyoutWrapper",this._VisibleBinding=new i.Visible.Binding(r,t,o,this,o.contextMenuFlyoutWrapperVisibleArgs);this.addChild(new e.C2(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._VisibleBinding.update(e)},n}(TDB.ViewElement);e.CcontextMenuFlyoutWrapper=l;var c=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ContextMenuFlyoutInnerWrapper";var i=TDB.watcherTag(17323653,n,null,n.contextMenuFlyoutArgs),r=new TDB.NewSubTemplateInstructionVE(n,i,"contextMenuFlyout");r.addResource(i),this.addChild(r,o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C2=c}(V||(V={}));var I=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new P.CimageContent(n),e,t)},t}(t.ImageVisualizatorVEBase);t.ImageVisualizatorVE=I;var P;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var i=this._context,r=document.createElement("div");this.domElement=r,r._context=i,this._ClassNameBinding=new o.ClassName.Binding(r,t,i,this,i.imageContentClassNameArgs);switch(i.ifUseImgArgs()){case!0:var a=TDB.watcherTag(17323653,i,null,i.previewImageArgs),s=new TDB.NewSubTemplateInstructionVE(i,a);s.addResource(a),this.addChild(s,r,null);break;case!1:this.addChild(new e.CpreviewDiv(i),r,null)}var l=i.loadingMessageArgs();l&&this.addChild(l.build(i),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},n}(TDB.ViewElement);e.CimageContent=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,this._AttrBinding=new i.Attr.Binding(r,e,n,this,n.previewDivAttrArgs),this._StyleBinding=new i.Style.Binding(r,e,n,this,n.previewDivStyleArgs),this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.previewDivClassNameArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._StyleBinding.update(e),this._ClassNameBinding.update(e)},t}(TDB.ViewElement);e.CpreviewDiv=n}(P||(P={}));var k=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new R.C1(n),e,t)},t}(t.BasicContentPageVEBase);t.BasicContentPageVE=k;var R;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="BasicContentPageWrapper";this.addChild(new e.C2(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="BasicContentPageInnerWrapper";o.ifTabHeaderArgs()&&this.addChild(new e.C3(o),i,null);var r=o.licenseCheckboxArgs();r&&this.addChild(r.build(o),i,null),(r=o.creativeCommonsLegalNotificationArgs())&&this.addChild(r.build(o),i,null),(r=o.attributionNotificationArgs())&&this.addChild(r.build(o),i,null),this.addChild(new e.CifMessage(o),i,null),this.addChild(new e.C5(o),i,null),(r=o.loadingMessageArgs())&&this.addChild(r.build(o),i,null),(r=o.resultsPanelArgs())&&this.addChild(r.build(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C2=n;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="SuggestedContentPageHeader";this.addChild(new e.C4(o),i,null);var r=TDB.watcherTag(17323653,o,null,o.breadcrumbPathArgs),a=new TDB.NewSubTemplateInstructionVE(o,r);a.addResource(r),this.addChild(a,i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C3=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="horizontalRadioGroup";var i=n.tabHeaderArgs();i&&this.addChild(i.build(n),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C4=a;var s=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifMessageArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.Cmessage(o),t,n)},n}(TDB.IfInstructionVE);e.CifMessage=s;var l=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,r.setAttribute("aria-live","polite"),r.setAttribute("aria-atomic","true"),this._TextBinding=new i.Text.Binding(r,e,n,this,n.messageTextArgs),this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.messageClassNameArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e),this._ClassNameBinding.update(e)},t}(TDB.ViewElement);e.Cmessage=l;var c=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="BasicContentPageConnectWrapper";var i=TDB.watcherTag(17323653,n,null,n.connectButtonArgs),r=new TDB.NewSubTemplateInstructionVE(n,i);r.addResource(i),this.addChild(r,o,null);i=TDB.watcherTag(17323653,n,null,n.refreshButtonArgs);(r=new TDB.NewSubTemplateInstructionVE(n,i)).addResource(i),this.addChild(r,o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C5=c}(R||(R={}));var L=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new U.CcontentWrapper(n),e,t)},t}(t.BasicContentPageResultsPanelVEBase);t.BasicContentPageResultsPanelVE=L;var U;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var r=this._context,a=document.createElement("div");this.domElement=a,a._context=r,this._LiquidLayoutBinding=new i.LiquidLayout.Binding(a,e,r,this,r.contentWrapperLiquidLayoutInitArgs(),r.contentWrapperLiquidLayoutElementsArgs),this._InfinitelyScrollableAreaBinding=new i.InfinitelyScrollableArea.Binding(a,e,r,this,r.contentWrapperInfinitelyScrollableAreaInitArgs()),this._ScrollPositionBinding=new n.ScrollPosition.Binding(a,e,r,this,r.contentWrapperScrollPositionArgs),this._ClassNameBinding=new o.ClassName.Binding(a,e,r,this,r.contentWrapperClassNameArgs),this._AttrBinding=new i.Attr.Binding(a,e,r,this,r.contentWrapperAttrArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);var s=TDB.watcherTag(17323652,r,null,r.contentPiecesArgs),l=new TDB.KeyedNewForeachInstructionVE(r,s,"contentPieces");l.addResource(s),this.addChild(l,a,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._LiquidLayoutBinding.update(e),this._ScrollPositionBinding.update(e),this._ClassNameBinding.update(e),this._AttrBinding.update(e)},t.prototype.disposeBindings=function(){this._LiquidLayoutBinding.dispose(),this._InfinitelyScrollableAreaBinding.dispose()},t}(TDB.ViewElement);e.CcontentWrapper=t}(U||(U={}));var F=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new N.C1(n),e,t)},t}(t.ContentUnavailableForClientPageVEBase);t.ContentUnavailableForClientPageVE=F;var N;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="BasicContentPageWrapper";this.addChild(new e.C2(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="BasicContentPageInnerWrapper";this.addChild(new e.C3(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C2=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.setAttribute("aria-live","polite"),o.setAttribute("aria-atomic","true"),o.className="BasicContentPageErrorMessage";var i=n.unavailableErrorMessageArgs();i&&this.addChild(i.build(n),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C3=o}(N||(N={}));var O=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new W.C1(n),e,t)},t}(t.AddContentVEBase);t.AddContentVE=O;var W;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="AddContent";this.addChild(new e.C2(o),i,null),this.addChild(new e.CloadingSpinner(o),i,null),this.addChild(new e.ClicenseNotificationWrapper(o),i,null);var r=o.clusterStripeArgs();r&&this.addChild(new TDB.NewSubTemplateInstructionVE(o,TDB.immutableWatchable(r),"clusterStripe"),i,null),this.addChild(new e.CifAttributionReportPane(o),i,null);var a=TDB.watcherTag(17323653,o,null,o.selectedSourceArgs),s=new TDB.NewSubTemplateInstructionVE(o,a);s.addResource(a),this.addChild(s,i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="AddContentHeader";var i=n.sourceSelectorArgs();i&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(i),"sourceSelector"),o,null),(i=n.searchBoxArgs())&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(i),"searchBox"),o,null),(i=n.addContentMenuArgs())&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(i),"addContentMenuVE"),o,null),(i=n.closeButtonArgs())&&this.addChild(i.build(n),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C2=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ContentLoadingSpinner",this._StyleBinding=new i.Style.Binding(o,e,n,this,n.loadingSpinnerStyleArgs),this._VisibleBinding=new i.Visible.Binding(o,e,n,this,n.loadingSpinnerVisibleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e),this._VisibleBinding.update(e)},t}(TDB.ViewElement);e.CloadingSpinner=o;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="licenseNoficationWrapper",this._VisibleBinding=new i.Visible.Binding(o,e,n,this,n.licenseNotificationWrapperVisibleArgs);var r=n.licenseNotificationArgs();r&&this.addChild(r.build(n),o,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._VisibleBinding.update(e)},t}(TDB.ViewElement);e.ClicenseNotificationWrapper=r;var a=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifAttributionReportPaneArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C3(o),t,n)},n}(TDB.IfInstructionVE);e.CifAttributionReportPane=a;var s=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="AddContentAttributionReportPaneWrapper";this.addChild(new e.CifAttributionLink(o),i,null),this.addChild(new e.CifReportButton(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C3=s;var l=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifAttributionLinkArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C4(o),t,n)},n}(TDB.IfInstructionVE);e.CifAttributionLink=l;var c=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="AddContentAttributionPane";var i=TDB.watcherTag(17323652,n,null,n.addContentAttributionLinkTextPartsArgs),r=new TDB.NewForeachInstructionVE(n,i,"addContentAttributionLinkTextParts");r.addResource(i),this.addChild(r,o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C4=c;var d=function(e){function t(t){var n=this,o=TDB.watcherTag(4543754,t,null,t.ifReportButtonArgs);return(n=e.call(this,o)||this).addResource(o),n._context=t,n}return __extends(t,e),t.prototype.buildChildren=function(e,t){var n=this._context,o=n.reportButtonArgs();o&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"reportButton"),e,t)},t}(TDB.IfInstructionVE);e.CifReportButton=d}(W||(W={}));var H=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new G.CifPaneMenu(n),e,t)},t}(t.AddContentMenuVEBase);t.AddContentMenuVE=H;var G;!function(e){var t=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifPaneMenuArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C1(o),t,n)},n}(TDB.IfInstructionVE);e.CifPaneMenu=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="PaneMenuWrapper";var i=n.addButtonArgs();i&&this.addChild(i.build(n),o,null);var r=TDB.watcherTag(17323653,n,null,n.clearSelectionButtonVEArgs),a=new TDB.NewSubTemplateInstructionVE(n,r);a.addResource(r),this.addChild(a,o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=n}(G||(G={}));var z=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new j.CifClusterStripe(n),e,t)},t}(t.ClusterStripeVEBase);t.ClusterStripeVE=z;var j;!function(e){var t=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifClusterStripeArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CsuggestionsClustersDrawerWrapper(o),t,n)},n}(TDB.IfInstructionVE);e.CifClusterStripe=t;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="ClusterStripeWrapper",this._StyleBinding=new i.Style.Binding(r,e,o,this,o.suggestionsClustersDrawerWrapperStyleArgs),this._ScrollPositionBinding=new n.ScrollPosition.Binding(r,e,o,this,o.suggestionsClustersDrawerWrapperScrollPositionArgs),this._CssBinding=new i.Css.Binding(r,e,o,this,o.suggestionsClustersDrawerWrapperCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);var a=o.resultsPanelArgs();a&&this.addChild(a.build(o),r,null);var s=TDB.watcherTag(17323653,o,null,o.drawerButtonArgs),l=new TDB.NewSubTemplateInstructionVE(o,s,"drawerButton");l.addResource(s),this.addChild(l,r,null);s=TDB.watcherTag(17323653,o,null,o.userContentPanelArgs);(l=new TDB.NewSubTemplateInstructionVE(o,s)).addResource(s),this.addChild(l,r,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e),this._ScrollPositionBinding.update(e),this._CssBinding.update(e)},t}(TDB.ViewElement);e.CsuggestionsClustersDrawerWrapper=o}(j||(j={}));var K=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new q.CsuggestionsClustersWrapper(n),e,t)},t}(t.ClusterStripeResultsPanelVEBase);t.ClusterStripeResultsPanelVE=K;var q;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="ClusterStripeClustersWrapper",this._CssBinding=new i.Css.Binding(r,t,o,this,o.suggestionsClustersWrapperCssArgs),this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.suggestionsClustersWrapperAttrArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.CifClusterStripeTitleEnabled(o),r,null),this.addChild(new e.CifSuggestedContentSectionPoweredByLabel(o),r,null);var a=TDB.watcherTag(17323652,o,null,o.suggestionsClustersArgs),s=new TDB.NewForeachInstructionVE(o,a);s.addResource(a),this.addChild(s,r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._CssBinding.update(e),this._AttrBinding.update(e)},n}(TDB.ViewElement);e.CsuggestionsClustersWrapper=t;var n=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifClusterStripeTitleEnabledArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CsectionTitle(o),t,n)},n}(TDB.IfInstructionVE);e.CifClusterStripeTitleEnabled=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.id="SuggestedContentSectionTitle",o.className="SuggestedContentTitle",this._TextBinding=new i.Text.Binding(o,e,n,this,n.sectionTitleTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CsectionTitle=o;var r=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifSuggestedContentSectionPoweredByLabelArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CsectionLabel(o),t,n)},n}(TDB.IfInstructionVE);e.CifSuggestedContentSectionPoweredByLabel=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.id="SuggestedContentSectionPoweredByLabel",o.className="SuggestedContentPoweredByLabel",this._TextBinding=new i.Text.Binding(o,e,n,this,n.sectionLabelTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CsectionLabel=a}(q||(q={}));var J=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new $.CuserContentWrapper(n),e,t)},t}(t.UserContentClustersPanelVEBase);t.UserContentClustersPanelVE=J;var $;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="ClusterStripeClustersWrapper",this._CssBinding=new i.Css.Binding(r,t,o,this,o.userContentWrapperCssArgs),this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.userContentWrapperAttrArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.CsectionTitle(o),r,null);var a=TDB.watcherTag(17323652,o,null,o.userContentClustersArgs),s=new TDB.NewForeachInstructionVE(o,a,"userContentClusters");s.addResource(a),this.addChild(s,r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._CssBinding.update(e),this._AttrBinding.update(e)},n}(TDB.ViewElement);e.CuserContentWrapper=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.id="UserContentClustersTitle",o.className="SuggestedContentTitle",this._TextBinding=new i.Text.Binding(o,e,n,this,n.sectionTitleTextArgs),this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.sectionTitleAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e),this._AttrBinding.update(e)},t}(TDB.ViewElement);e.CsectionTitle=n}($||($={}));var Q=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new X.Cwrapper(n),e,t)},t}(t.DocumentContentPieceVEBase);t.DocumentContentPieceVE=Q;var X;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var r=this._context,a=document.createElement("div");this.domElement=a,a._context=r,a.setAttribute("role","presentation"),a.className="AddContentDocumentWrapper",this._DraggableBinding=new i.Draggable.Binding(a,t,r,this,r.wrapperDraggableInitArgs(),r.wrapperDraggableOptionsArgs),this._TouchToMouseBinding=new o.TouchToMouse.Binding(a,t,r,this,r.wrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.Ccontent(r),a,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._DraggableBinding.update(e),this._TouchToMouseBinding.update(e)},n.prototype.disposeBindings=function(){this._DraggableBinding.dispose(),this._TouchToMouseBinding.dispose()},n}(TDB.ViewElement);e.Cwrapper=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="AddContentDocument",this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.contentAttrArgs),this._FocusableBinding=o.focusableBinding=new i.Focusable.Binding(r,t,o,this,o.FocusableInitArgs());this.addChild(new e.CifSelectionAdded(o),r,null),this.addChild(new e.C1(o),r,null),this.addChild(new e.C2(o),r,null),this.addChild(new e.C3(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._FocusableBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.Ccontent=n;var r=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifSelectionAddedArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CselectionAdded(o),t,n)},n}(TDB.IfInstructionVE);e.CifSelectionAdded=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,this._StyleBinding=new i.Style.Binding(o,e,n,this,n.selectionAddedStyleArgs),this._CssBinding=new i.Css.Binding(o,e,n,this,n.selectionAddedCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);var r=n.selectedAddedIconArgs();r&&this.addChild(r.build(n),o,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e),this._CssBinding.update(e)},t}(TDB.ViewElement);e.CselectionAdded=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="DocumentImage";var i=n.documentIconArgs();i&&this.addChild(i.build(n),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=s;var l=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="DocumentFooter";this.addChild(new e.CdocumentTitle(o),i,null),o.hasSourceArgs()&&this.addChild(new e.CdocumentSource(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C2=l;var c=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="DocumentTitle",this._TextBinding=new i.Text.Binding(o,e,n,this,n.documentTitleTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CdocumentTitle=c;var d=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="DocumentTitle",this._TextBinding=new i.Text.Binding(o,e,n,this,n.documentSourceTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CdocumentSource=d;var u=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="GalleryThumbnailInner",this._addToDom(e,t)},t}(TDB.ViewElement);e.C3=u}(X||(X={}));var Z=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Y.Cwrapper(n),e,t)},t}(t.FolderContentPieceVEBase);t.FolderContentPieceVE=Z;var Y;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="FolderContentPieceWrapper",this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.wrapperAttrArgs);this.addChild(new e.Ccontent(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e)},n}(TDB.ViewElement);e.Cwrapper=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="FolderContentPiece",this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.contentAttrArgs),this._FocusableBinding=o.focusableBinding=new i.Focusable.Binding(r,t,o,this,o.FocusableInitArgs());this.addChild(new e.CfolderImage(o),r,null),this.addChild(new e.C1(o),r,null),this.addChild(new X.C3(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._FocusableBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.Ccontent=n;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="FolderImage",this._StyleBinding=new i.Style.Binding(o,e,n,this,n.folderImageStyleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e)},t}(TDB.ViewElement);e.CfolderImage=r;var a=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="FolderFooter";this.addChild(new e.CfolderTitle(o),i,null),this.addChild(new e.CfolderContentCount(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,this._TextBinding=new i.Text.Binding(r,e,n,this,n.folderTitleTextArgs),this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.folderTitleClassNameArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e),this._ClassNameBinding.update(e)},t}(TDB.ViewElement);e.CfolderTitle=s;var l=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,this._TextBinding=new i.Text.Binding(r,e,n,this,n.folderContentCountTextArgs),this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.folderContentCountClassNameArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e),this._ClassNameBinding.update(e)},t}(TDB.ViewElement);e.CfolderContentCount=l}(Y||(Y={}));var ee=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new te.Cwrapper(n),e,t)},t}(t.ImageContentPieceVEBase);t.ImageContentPieceVE=ee;var te;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var r=this._context,a=document.createElement("div");this.domElement=a,a._context=r,a.setAttribute("role","presentation"),a.className="ImageContentPieceWrapper",this._StyleBinding=new i.Style.Binding(a,t,r,this,r.wrapperStyleArgs),this._DraggableBinding=new i.Draggable.Binding(a,t,r,this,r.wrapperDraggableInitArgs(),r.wrapperDraggableOptionsArgs),this._TouchToMouseBinding=new o.TouchToMouse.Binding(a,t,r,this,r.wrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.Ccontent(r),a,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._StyleBinding.update(e),this._DraggableBinding.update(e),this._TouchToMouseBinding.update(e)},n.prototype.disposeBindings=function(){this._DraggableBinding.dispose(),this._TouchToMouseBinding.dispose()},n}(TDB.ViewElement);e.Cwrapper=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var r=this._context,a=document.createElement("div");this.domElement=a,a._context=r,this._AttrBinding=new i.Attr.Binding(a,t,r,this,r.contentAttrArgs),this._FocusableBinding=r.focusableBinding=new i.Focusable.Binding(a,t,r,this,r.FocusableInitArgs()),this._ClassNameBinding=new o.ClassName.Binding(a,t,r,this,r.contentClassNameArgs);if(this.addChild(new X.CifSelectionAdded(r),a,null),r.ifDescriptionLabelArgs()&&this.addChild(new e.CdescriptionLabel(r),a,null),r.livingImageFlagVisibleArgs()){var s=r.LivingImageIconArgs();s&&this.addChild(s.build(r),a,null)}this.addChild(new X.C3(r),a,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._FocusableBinding.update(e),this._ClassNameBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.Ccontent=n;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.setAttribute("aria-hidden","true"),o.className="ImageDescriptionLabel",this._TextBinding=new i.Text.Binding(o,e,n,this,n.descriptionLabelTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CdescriptionLabel=r}(te||(te={}));var ne=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new oe.Cwrapper(n),e,t)},t}(t.StatusUpdateContentPieceVEBase);t.StatusUpdateContentPieceVE=ne;var oe;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var r=this._context,a=document.createElement("div");this.domElement=a,a._context=r,a.setAttribute("role","presentation"),a.className="AddContentStatusUpdateWrapper",this._DraggableBinding=new i.Draggable.Binding(a,t,r,this,r.wrapperDraggableInitArgs(),r.wrapperDraggableOptionsArgs),this._TouchToMouseBinding=new o.TouchToMouse.Binding(a,t,r,this,r.wrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.Ccontent(r),a,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._DraggableBinding.update(e),this._TouchToMouseBinding.update(e)},n.prototype.disposeBindings=function(){this._DraggableBinding.dispose(),this._TouchToMouseBinding.dispose()},n}(TDB.ViewElement);e.Cwrapper=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="AddContentStatusUpdate",this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.contentAttrArgs),this._FocusableBinding=o.focusableBinding=new i.Focusable.Binding(r,t,o,this,o.FocusableInitArgs());this.addChild(new X.CifSelectionAdded(o),r,null),this.addChild(new e.CprofileImage(o),r,null),this.addChild(new e.Cname(o),r,null),this.addChild(new e.CuserName(o),r,null);var a=o.attributionIconArgs();a&&this.addChild(a.build(o),r,null),this.addChild(new e.Cbody(o),r,null),o.ifImageWrapperArgs()&&this.addChild(new e.C1(o),r,null),this.addChild(new e.C2(o),r,null),this.addChild(new X.C3(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._FocusableBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.Ccontent=n;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ProfileImage",this._StyleBinding=new i.Style.Binding(o,e,n,this,n.profileImageStyleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e)},t}(TDB.ViewElement);e.CprofileImage=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="Name segoeUI",this._TextBinding=new i.Text.Binding(o,e,n,this,n.nameTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.Cname=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="UserName segoeUI font7",this._TextBinding=new i.Text.Binding(o,e,n,this,n.userNameTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CuserName=s;var l=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="Body segoeUI",this._TextBinding=new i.Text.Binding(o,e,n,this,n.bodyTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.Cbody=l;var c=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o;this.addChild(new e.Cimage(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=c;var d=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("img");this.domElement=o,o._context=n,o.className="Image",this._PropsBinding=new i.Props.Binding(o,e,n,this,n.imagePropsArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._PropsBinding.update(e)},t}(TDB.ViewElement);e.Cimage=d;var u=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.setAttribute("style","clear: both"),this._addToDom(e,t)},t}(TDB.ViewElement);e.C2=u}(oe||(oe={}));var ie=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new re.Cwrapper(n),e,t)},t}(t.VideoContentPieceVEBase);t.VideoContentPieceVE=ie;var re;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var r=this._context,a=document.createElement("div");this.domElement=a,a._context=r,a.setAttribute("role","presentation"),a.className="AddContentVideoWrapper",this._DraggableBinding=new i.Draggable.Binding(a,t,r,this,r.wrapperDraggableInitArgs(),r.wrapperDraggableOptionsArgs),this._TouchToMouseBinding=new o.TouchToMouse.Binding(a,t,r,this,r.wrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.Ccontent(r),a,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._DraggableBinding.update(e),this._TouchToMouseBinding.update(e)},n.prototype.disposeBindings=function(){this._DraggableBinding.dispose(),this._TouchToMouseBinding.dispose()},n}(TDB.ViewElement);e.Cwrapper=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="AddContentVideo",this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.contentAttrArgs),this._FocusableBinding=o.focusableBinding=new i.Focusable.Binding(r,t,o,this,o.FocusableInitArgs());this.addChild(new X.CifSelectionAdded(o),r,null),this.addChild(new e.CvideoImage(o),r,null),this.addChild(new e.C2(o),r,null),this.addChild(new X.C3(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._FocusableBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.Ccontent=n;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="AddContentVideoImage",this._StyleBinding=new i.Style.Binding(r,t,o,this,o.videoImageStyleArgs);this.addChild(new e.C1(o),r,null);var a=o.videoIconArgs();a&&this.addChild(a.build(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._StyleBinding.update(e)},n}(TDB.ViewElement);e.CvideoImage=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="AddContentVideoImageOverlay",this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=a;var s=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="AddContentVideoFooter",i.setAttribute("aria-hidden","true");this.addChild(new e.Ctitle(o),i,null),o.ifDurationArgs()&&this.addChild(new e.Cduration(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C2=s;var l=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.titleClassNameArgs),this._TextBinding=new i.Text.Binding(r,e,n,this,n.titleTextArgs),this._AttrBinding=new i.Attr.Binding(r,e,n,this,n.titleAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._ClassNameBinding.update(e),this._TextBinding.update(e),this._AttrBinding.update(e)},t}(TDB.ViewElement);e.Ctitle=l;var c=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.durationClassNameArgs),this._TextBinding=new i.Text.Binding(r,e,n,this,n.durationTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._ClassNameBinding.update(e),this._TextBinding.update(e)},t}(TDB.ViewElement);e.Cduration=c}(re||(re={}));var ae=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new se.Cwrapper(n),e,t)},t}(t.AudioContentPieceVEBase);t.AudioContentPieceVE=ae;var se;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var r=this._context,a=document.createElement("div");this.domElement=a,a._context=r,a.setAttribute("role","presentation"),a.className="AddContentAudioWrapper",this._DraggableBinding=new i.Draggable.Binding(a,t,r,this,r.wrapperDraggableInitArgs(),r.wrapperDraggableOptionsArgs),this._TouchToMouseBinding=new o.TouchToMouse.Binding(a,t,r,this,r.wrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.Ccontent(r),a,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._DraggableBinding.update(e),this._TouchToMouseBinding.update(e)},n.prototype.disposeBindings=function(){this._DraggableBinding.dispose(),this._TouchToMouseBinding.dispose()},n}(TDB.ViewElement);e.Cwrapper=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="AddContentAudio",this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.contentAttrArgs),this._FocusableBinding=o.focusableBinding=new i.Focusable.Binding(r,t,o,this,o.FocusableInitArgs());this.addChild(new X.CifSelectionAdded(o),r,null),this.addChild(new e.C1(o),r,null),this.addChild(new e.C3(o),r,null),this.addChild(new X.C3(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._FocusableBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.Ccontent=n;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="AddContentAudioImage";this.addChild(new e.C2(o),i,null);var r=o.audioIconArgs();r&&this.addChild(r.build(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="AddContentAudioImageOverlay",this._addToDom(e,t)},t}(TDB.ViewElement);e.C2=a;var s=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="AddContentAudioFooter",i.setAttribute("aria-hidden","true");this.addChild(new e.Ctitle(o),i,null),o.ifDurationArgs()&&this.addChild(new re.Cduration(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C3=s;var l=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.titleClassNameArgs),this._TextBinding=new i.Text.Binding(r,e,n,this,n.titleTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._ClassNameBinding.update(e),this._TextBinding.update(e)},t}(TDB.ViewElement);e.Ctitle=l}(se||(se={}));var le=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new ce.Cwrapper(n),e,t)},t}(t.WikipediaContentPieceVEBase);t.WikipediaContentPieceVE=le;var ce;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var r=this._context,a=document.createElement("div");this.domElement=a,a._context=r,a.setAttribute("role","presentation"),a.className="AddContentWikipediaWrapper",this._DraggableBinding=new i.Draggable.Binding(a,t,r,this,r.wrapperDraggableInitArgs(),r.wrapperDraggableOptionsArgs),this._TouchToMouseBinding=new o.TouchToMouse.Binding(a,t,r,this,r.wrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.Ccontent(r),a,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._DraggableBinding.update(e),this._TouchToMouseBinding.update(e)},n.prototype.disposeBindings=function(){this._DraggableBinding.dispose(),this._TouchToMouseBinding.dispose()},n}(TDB.ViewElement);e.Cwrapper=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="AddContentWikipedia",this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.contentAttrArgs),this._FocusableBinding=o.focusableBinding=new i.Focusable.Binding(r,t,o,this,o.FocusableInitArgs());this.addChild(new X.CifSelectionAdded(o),r,null),this.addChild(new e.CcardImage(o),r,null),this.addChild(new e.Ctitle(o),r,null);var a=o.attributionImageArgs();a&&this.addChild(a.build(o),r,null),this.addChild(new oe.Cbody(o),r,null),this.addChild(new e.C1(o),r,null),this.addChild(new oe.C2(o),r,null),this.addChild(new X.C3(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._FocusableBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.Ccontent=n;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="CardImage",this._StyleBinding=new i.Style.Binding(r,t,o,this,o.cardImageStyleArgs);this.addChild(new e.ChiddenCardImage(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._StyleBinding.update(e)},n}(TDB.ViewElement);e.CcardImage=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("img");this.domElement=o,o._context=n,o.className="HiddenCardImage",this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.hiddenCardImageAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e)},t}(TDB.ViewElement);e.ChiddenCardImage=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="Title segoeUI",this._TextBinding=new i.Text.Binding(o,e,n,this,n.titleTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.Ctitle=s;var l=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="AttributionPart";var i=n.messagePartsArgs();i&&this.addChild(i.build(n),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=l}(ce||(ce={}));var de=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new ue.CifSourceOption(n),e,t)},t}(t.AddSourceOptionVEBase);t.AddSourceOptionVE=de;var ue;!function(e){var t=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifSourceOptionArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.Cwrapper(o),t,n)},n}(TDB.IfInstructionVE);e.CifSourceOption=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="MyDeviceOptionWrapper",this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.wrapperAttrArgs),this._FocusableBinding=o.focusableBinding=new i.Focusable.Binding(r,t,o,this,o.FocusableInitArgs());var a=o.fontIconArgs();a&&this.addChild(a.build(o),r,null),this.addChild(new e.Ctitle(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._FocusableBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.Cwrapper=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("span");this.domElement=o,o._context=n,o.className="SourceOptionTitle",this._TextBinding=new i.Text.Binding(o,e,n,this,n.titleTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.Ctitle=o}(ue||(ue={}));var pe=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new ge.CifSourceOption(n),e,t)},t}(t.MyDeviceOptionVEBase);t.MyDeviceOptionVE=pe;var ge;!function(e){var t=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifSourceOptionArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.Cwrapper(o),t,n)},n}(TDB.IfInstructionVE);e.CifSourceOption=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="MyDeviceOptionWrapper",this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.wrapperAttrArgs),this._FocusableBinding=o.focusableBinding=new i.Focusable.Binding(r,t,o,this,o.FocusableInitArgs());var a=o.fontIconArgs();a&&this.addChild(a.build(o),r,null),this.addChild(new ue.Ctitle(o),r,null),this.addChild(new e.C1(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._FocusableBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.Cwrapper=n;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("form");this.domElement=i,i._context=o,i.setAttribute("method","POST"),i.setAttribute("enctype","multipart/form-data"),i.setAttribute("encoding","multipart/form-data"),i.className="hiddenContent";this.addChild(new e.CinputFilePicker(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("input");this.domElement=r,r._context=n,r.id="fileToUpload",r.setAttribute("name","file"),r.setAttribute("type","file"),r.setAttribute("multiple","multiple"),r.setAttribute("title","Upload"),this._AttrBinding=new i.Attr.Binding(r,e,n,this,n.inputFilePickerAttrArgs),this._AutoUploadBinding=new i.AutoUpload.Binding(r,e,n,this,n.inputFilePickerAutoUploadInitArgs()),this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.inputFilePickerClassNameArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._ClassNameBinding.update(e)},t.prototype.disposeBindings=function(){this._AutoUploadBinding.dispose()},t}(TDB.ViewElement);e.CinputFilePicker=a}(ge||(ge={}));var he=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Ce.CifSourceOption(n),e,t)},t}(t.SourceOptionVEBase);t.SourceOptionVE=he;var Ce;!function(e){var t=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifSourceOptionArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.Cwrapper(o),t,n)},n}(TDB.IfInstructionVE);e.CifSourceOption=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="SourceOptionWrapper",this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.wrapperAttrArgs),this._FocusableBinding=o.focusableBinding=new i.Focusable.Binding(r,t,o,this,o.FocusableInitArgs());o.newFeatureFlagVisibleArgs()&&this.addChild(new e.CnewFeatureFlag(o),r,null),this.addChild(new e.C1(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._FocusableBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.Cwrapper=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("img");this.domElement=o,o._context=n,o.className="SourceOptionNewFeatureImage",this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.newFeatureFlagAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e)},t}(TDB.ViewElement);e.CnewFeatureFlag=o;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="SourceOptionInnerWrapper";switch(o.fontIconPresentArgs()){case!0:var r=o.fontIconArgs();r&&this.addChild(r.build(o),i,null);break;case!1:this.addChild(new e.Cimg(o),i,null)}this.addChild(new ue.Ctitle(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("img");this.domElement=o,o._context=n,o.className="SourceOptionImage",this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.imgAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e)},t}(TDB.ViewElement);e.Cimg=a}(Ce||(Ce={}));var fe=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new me.C1(n),e,t)},t}(t.SourceSelectorVEBase);t.SourceSelectorVE=fe;var me;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="SourceSelectorWrapper";var i=n.selectorArgs();i&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(i),"selectorButton"),o,null),(i=n.flyoutArgs())&&this.addChild(i.build(n),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=t}(me||(me={}));var ye=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new ve.Cwrapper(n),e,t)},t}(t.SourceSelectorFlyoutVEBase);t.SourceSelectorFlyoutVE=ye;var ve;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,r.className="SourceSelectorFlyoutWrapper",this._SlideVisibleBinding=new o.SlideVisible.Binding(r,e,n,this,n.wrapperSlideVisibleInitArgs(),n.wrapperSlideVisibleArgs),this._AttrBinding=new i.Attr.Binding(r,e,n,this,n.wrapperAttrArgs),this._StyleBinding=new i.Style.Binding(r,e,n,this,n.wrapperStyleArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);var a=TDB.watcherTag(17323652,n,null,n.optionsArgs),s=new TDB.NewForeachInstructionVE(n,a);s.addResource(a),this.addChild(s,r,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._SlideVisibleBinding.update(e),this._AttrBinding.update(e),this._StyleBinding.update(e)},t}(TDB.ViewElement);e.Cwrapper=t}(ve||(ve={}));var Se=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Te.C1(n),e,t)},t}(t.UserContentClusterVEBase);t.UserContentClusterVE=Se;var Te;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="SuggestionsClusterButtonWrapper SuggestionsClusterVisualWrapper";this.addChild(new e.Ccontent(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="SuggestionsClusterVisual SuggestionsClusterButton ButtonVE",this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.contentAttrArgs),this._FocusableBinding=o.focusableBinding=new i.Focusable.Binding(r,t,o,this,o.FocusableInitArgs()),this._StyleBinding=new i.Style.Binding(r,t,o,this,o.contentStyleArgs);this.addChild(new X.C3(o),r,null),this.addChild(new e.C3(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._FocusableBinding.update(e),this._StyleBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.Ccontent=n;var o=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="SuggestionsClusterContentWrapper";switch(o.fontIconPresentArgs()){case!0:this.addChild(new e.C4(o),i,null);break;case!1:this.addChild(new e.C5(o),i,null)}this.addChild(new e.Ctext(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C3=o;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="SuggestionsClusterSearchIconWrapperWhite";this.addChild(new e.CuserContentIcon(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C4=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,this._CssBinding=new i.Css.Binding(o,e,n,this,n.userContentIconCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._CssBinding.update(e)},t}(TDB.ViewElement);e.CuserContentIcon=a;var s=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="ClusterIcon";this.addChild(new e.CuserContentImage(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C5=s;var l=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("img");this.domElement=o,o._context=n,this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.userContentImageAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e)},t}(TDB.ViewElement);e.CuserContentImage=l;var c=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="SuggestedClusterTextWhite segoeUISemilight",this._TextBinding=new i.Text.Binding(o,e,n,this,n.textTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.Ctext=c}(Te||(Te={}));var we=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Ae.CifButtonWrapper(n),e,t)},t}(t.SuggestionsClusterVEBase);t.SuggestionsClusterVE=we;var Ae;!function(e){var t=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifButtonWrapperArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.Cwrapper(o),t,n)},n}(TDB.IfInstructionVE);e.CifButtonWrapper=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="SuggestionsClusterButtonWrapper",this._CssBinding=new i.Css.Binding(r,t,o,this,o.wrapperCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.Ccontent(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._CssBinding.update(e)},n}(TDB.ViewElement);e.Cwrapper=n;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="SuggestionsClusterButton ButtonVE",this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.contentAttrArgs),this._FocusableBinding=o.focusableBinding=new i.Focusable.Binding(r,t,o,this,o.FocusableInitArgs()),this._CssBinding=new i.Css.Binding(r,t,o,this,o.contentCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.CifSuggestionsClusterImage(o),r,null),this.addChild(new X.C3(o),r,null),this.addChild(new e.CifSuggestionsSeparators(o),r,null),this.addChild(new e.C4(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._FocusableBinding.update(e),this._CssBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.Ccontent=r;var a=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifSuggestionsClusterImageArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CsuggestionsClusterImage(o),t,n)},n}(TDB.IfInstructionVE);e.CifSuggestionsClusterImage=a;var s=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="SuggestionsClusterImage",this._StyleBinding=new i.Style.Binding(r,t,o,this,o.suggestionsClusterImageStyleArgs);this.addChild(new e.CifSuggestionsDecorator(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._StyleBinding.update(e)},n}(TDB.ViewElement);e.CsuggestionsClusterImage=s;var l=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifSuggestionsDecoratorArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CsuggestionsDecorator(o),t,n)},n}(TDB.IfInstructionVE);e.CifSuggestionsDecorator=l;var c=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,i=document.createElement("div");this.domElement=i,i._context=n,this._ClassNameBinding=new o.ClassName.Binding(i,e,n,this,n.suggestionsDecoratorClassNameArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},t}(TDB.ViewElement);e.CsuggestionsDecorator=c;var d=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifSuggestionsSeparatorsArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C2(o),t,n),this.addChild(new e.C3(o),t,n)},n}(TDB.IfInstructionVE);e.CifSuggestionsSeparators=d;var u=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="SuggestionsClusterLeftSeparator",this._addToDom(e,t)},t}(TDB.ViewElement);e.C2=u;var p=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="SuggestionsClusterRightSeparator",this._addToDom(e,t)},t}(TDB.ViewElement);e.C3=p;var g=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="SuggestionsClusterContentWrapper";this.addChild(new e.CifSuggestionsClusterSearchIcon(o),i,null),this.addChild(new e.Ctext(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C4=g;var h=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifSuggestionsClusterSearchIconArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CsuggestionsClusterSearchIcon(o),t,n)},n}(TDB.IfInstructionVE);e.CifSuggestionsClusterSearchIcon=h;var C=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var i=this._context,r=document.createElement("div");this.domElement=r,r._context=i,this._ClassNameBinding=new o.ClassName.Binding(r,t,i,this,i.suggestionsClusterSearchIconClassNameArgs);this.addChild(new e.C5(i),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},n}(TDB.ViewElement);e.CsuggestionsClusterSearchIcon=C;var f=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ClusterIcon IconsearchLayer1",this._addToDom(e,t)},t}(TDB.ViewElement);e.C5=f;var m=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,this._CssBinding=new i.Css.Binding(o,e,n,this,n.textCssArgs),this._TextBinding=new i.Text.Binding(o,e,n,this,n.textTextArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._CssBinding.update(e),this._TextBinding.update(e)},t}(TDB.ViewElement);e.Ctext=m}(Ae||(Ae={}));var Ee=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new _e.CsuggestedContentTabWrapper(n),e,t)},t}(t.SuggestedContentTabVEBase);t.SuggestedContentTabVE=Ee;var _e;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="SuggestedContentTabWrapper",this._VisibleBinding=new i.Visible.Binding(r,t,o,this,o.suggestedContentTabWrapperVisibleArgs);this.addChild(new e.C1(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._VisibleBinding.update(e)},n}(TDB.ViewElement);e.CsuggestedContentTabWrapper=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="SuggestedContentTabDataWrapper";this.addChild(new e.C2(o),i,null);var r=o.attributionNotificationArgs();r&&this.addChild(r.build(o),i,null),(r=o.statusMessageArgs())&&this.addChild(r.build(o),i,null),this.addChild(new e.CifErrorMessage(o),i,null),(r=o.resultsPanelArgs())&&this.addChild(r.build(o),i,null),(r=o.loadingMessageArgs())&&this.addChild(r.build(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=n;var o=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="SuggestedContentPageHeader";this.addChild(new e.CcontentFilterGroup(o),i,null);var r=o.licenseCheckboxArgs();r&&this.addChild(r.build(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C2=o;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="horizontalRadioGroup",o.setAttribute("role","tablist"),this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.contentFilterGroupAttrArgs);var r=n.contentFilterArgs();r&&this.addChild(r.build(n),o,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e)},t}(TDB.ViewElement);e.CcontentFilterGroup=r;var a=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifErrorMessageArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CerrorMessage(o),t,n)},n}(TDB.IfInstructionVE);e.CifErrorMessage=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="BasicContentPageMessage",o.setAttribute("aria-live","polite"),o.setAttribute("aria-atomic","true"),this._TextBinding=new i.Text.Binding(o,e,n,this,n.errorMessageTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CerrorMessage=s}(_e||(_e={}));var xe=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Be.CifSuggestedContentWrapper(n),e,t)},t}(t.SuggestedContentResultsPanelVEBase);t.SuggestedContentResultsPanelVE=xe;var Be;!function(e){var t=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifSuggestedContentWrapperArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CcontentWrapper(o),t,n)},n}(TDB.IfInstructionVE);e.CifSuggestedContentWrapper=t;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="SuggestedContentTabContentWrapper SuggestedContentTabContentWrapperWithFilter",this._MagazineLiquidLayoutBinding=new i.MagazineLiquidLayout.Binding(r,e,o,this,o.contentWrapperMagazineLiquidLayoutInitArgs(),o.contentWrapperMagazineLiquidLayoutElementsArgs),this._InfinitelyScrollableAreaBinding=new i.InfinitelyScrollableArea.Binding(r,e,o,this,o.contentWrapperInfinitelyScrollableAreaInitArgs()),this._ScrollPositionBinding=new n.ScrollPosition.Binding(r,e,o,this,o.contentWrapperScrollPositionArgs),this._AttrBinding=new i.Attr.Binding(r,e,o,this,o.contentWrapperAttrArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);var a=TDB.watcherTag(17323652,o,null,o.contentPiecesArgs),s=new TDB.KeyedNewForeachInstructionVE(o,a,"contentPieces");s.addResource(a),this.addChild(s,r,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._MagazineLiquidLayoutBinding.update(e),this._ScrollPositionBinding.update(e),this._AttrBinding.update(e)},t.prototype.disposeBindings=function(){this._MagazineLiquidLayoutBinding.dispose(),this._InfinitelyScrollableAreaBinding.dispose()},t}(TDB.ViewElement);e.CcontentWrapper=o}(Be||(Be={}));var be=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new De.Cwrapper(n),e,t)},t}(t.CardAuthorEntryVEBase);t.CardAuthorEntryVE=be;var De;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="CardAuthorEntryWrapper",this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.wrapperAttrArgs);var a=o.iconArgs();a&&this.addChild(a.build(o),r,null),this.addChild(new e.Cname(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e)},n}(TDB.ViewElement);e.Cwrapper=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="CardAuthorEntryText",this._TextBinding=new i.Text.Binding(o,e,n,this,n.nameTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.Cname=n}(De||(De={}));var Me=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Ve.C1(n),e,t)},t}(t.CardAuthorsListVEBase);t.CardAuthorsListVE=Me;var Ve;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="CardAuthorsListWrapper";var i=TDB.watcherTag(17323652,n,null,n.authorEntriesArgs),r=new TDB.NewForeachInstructionVE(n,i);r.addResource(i),this.addChild(r,o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=t}(Ve||(Ve={}));var Ie=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.jack=TDB.methodNewSubtemplateState(o,o.jackArgs),o}return __extends(t,e),t.prototype._create=function(e,t){var n=this;if(n.ifSocketLabelArgs()&&this.addChild(new Pe.CsocketLabel(n),e,t),this.addChild(new Pe.Cwrapper(n),e,t),n.ifShowTweenerArgs()){var o=n.tweenerArgs();o&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"_tweener"),e,t)}},t}(t.AgaveCardVEBase);t.AgaveCardVE=Ie;var Pe;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="SocketLabel segoeUISemibold",this._TextBinding=new i.Text.Binding(o,e,n,this,n.socketLabelTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CsocketLabel=t;var r=function(t){function r(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(r,t),r.prototype._create=function(t,r){var a=this._context,s=document.createElement("div");this.domElement=s,s._context=a,s.className="BasicCard AgaveCard",this._AttrBinding=new i.Attr.Binding(s,t,a,this,a.wrapperAttrArgs),this._DraggableBinding=new i.Draggable.Binding(s,t,a,this,a.wrapperDraggableInitArgs(),a.wrapperDraggableOptionsArgs),this._StyleBinding=new i.Style.Binding(s,t,a,this,a.wrapperStyleArgs),this._CssBinding=new i.Css.Binding(s,t,a,this,a.wrapperCssArgs),this._ScrollIntoViewBinding=new o.ScrollIntoView.Binding(s,t,a,this,a.wrapperScrollIntoViewInitArgs(),a.wrapperScrollIntoViewArgs),this._DistanceFromIPBinding=new n.DistanceFromIP.Binding(s,t,a,this,a.wrapperDistanceFromIPInitArgs()),this._FloatingMenuBinding=new n.FloatingMenu.Binding(s,t,a,this,a.wrapperFloatingMenuInitArgs(),a.wrapperFloatingMenuArgs),this._FocusableBinding=a.focusableBinding=new i.Focusable.Binding(s,t,a,this,a.FocusableInitArgs()),this._TouchToMouseBinding=new o.TouchToMouse.Binding(s,t,a,this,a.wrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.CifCardCopyAvailable(a),s,null);var l=TDB.watcherTag(17323653,a,null,a.cardSelectionOverlayArgs),c=new TDB.NewSubTemplateInstructionVE(a,l,"_selectionStatus");c.addResource(l),this.addChild(c,s,null);var d=a.dropTargetOverlayArgs();d&&this.addChild(d.build(a),s,null);l=TDB.watcherTag(17323653,a,null,a.sidebarArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l)).addResource(l),this.addChild(c,s,null),this.addChild(new e.C1(a),s,null);l=TDB.watcherTag(17323653,a,null,a.menuArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l,"_menu")).addResource(l),this.addChild(c,s,null);l=TDB.watcherTag(17323653,a,null,a.labelArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l)).addResource(l),this.addChild(c,s,null),this.addChild(new e.CcontentWrapper(a),s,null);l=TDB.watcherTag(17323653,a,null,a.selectionBarArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l,"_selectionBar")).addResource(l),this.addChild(c,s,null);var u=a.jack;this.addChild(new TDB.NewSubTemplateInstructionVE(a,u.raw(),void 0,u),s,null);l=TDB.watcherTag(17323653,a,null,a.authorsListArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l)).addResource(l),this.addChild(c,s,null),this._addToDom(t,r)},r.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._DraggableBinding.update(e),this._StyleBinding.update(e),this._CssBinding.update(e),this._ScrollIntoViewBinding.update(e),this._FloatingMenuBinding.update(e),this._FocusableBinding.update(e),this._TouchToMouseBinding.update(e)},r.prototype.disposeBindings=function(){this._DraggableBinding.dispose(),this._DistanceFromIPBinding.dispose(),this._FloatingMenuBinding.dispose(),this._FocusableBinding.dispose(),this._TouchToMouseBinding.dispose(),this._context.focusableBinding=void 0},r}(TDB.ViewElement);e.Cwrapper=r;var a=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifCardCopyAvailableArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CcardCopied(o),t,n)},n}(TDB.IfInstructionVE);e.CifCardCopyAvailable=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,i=document.createElement("div");this.domElement=i,i._context=n,this._ClassNameBinding=new o.ClassName.Binding(i,e,n,this,n.cardCopiedClassNameArgs),this._FadeVisibleBinding=new o.FadeVisible.Binding(i,e,n,this,n.cardCopiedFadeVisibleInitArgs(),n.cardCopiedFadeVisibleArgs);var r=n.cardCopiedIconArgs();r&&this.addChild(r.build(n),i,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._ClassNameBinding.update(e),this._FadeVisibleBinding.update(e)},t.prototype.disposeBindings=function(){this._FadeVisibleBinding.dispose()},t}(TDB.ViewElement);e.CcardCopied=s;var l=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="ThumbnailPane";this.addChild(new e.CimageWrapper(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=l;var c=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var i=this._context,r=document.createElement("div");this.domElement=r,r._context=i,r.className="MediaPlaceholderImageWrapper ThumbnailFrame",this._TouchToMouseBinding=new o.TouchToMouse.Binding(r,t,i,this,i.imageWrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.C2(i),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._TouchToMouseBinding.update(e)},n.prototype.disposeBindings=function(){this._TouchToMouseBinding.dispose()},n}(TDB.ViewElement);e.CimageWrapper=c;var d=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="AgaveImage";var r=o.agaveIconArgs();r&&this.addChild(r.build(o),i,null),this.addChild(new e.CifOverlayLabel(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C2=d;var u=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifOverlayLabelArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C3(o),t,n)},n}(TDB.IfInstructionVE);e.CifOverlayLabel=u;var p=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="OverlayLabelWrapper";this.addChild(new e.CoverlayLabel(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C3=p;var g=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="OverlayLabelText",this._TextBinding=new i.Text.Binding(o,e,n,this,n.overlayLabelTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CoverlayLabel=g;var h=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="AgaveCardContentWrapper",this._CssBinding=new i.Css.Binding(r,t,o,this,o.contentWrapperCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.C4(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._CssBinding.update(e)},n}(TDB.ViewElement);e.CcontentWrapper=h;var C=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="AgaveMessage";this.addChild(new e.CagaveInfoMessage(o),i,null);var r=o.agaveJumpLinkArgs();r&&this.addChild(r.build(o),i,null),this.addChild(new e.CagaveInfoMessagePostfix(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C4=C;var f=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("span");this.domElement=o,o._context=n,this._TextBinding=new i.Text.Binding(o,e,n,this,n.agaveInfoMessageTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CagaveInfoMessage=f;var m=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("span");this.domElement=o,o._context=n,this._TextBinding=new i.Text.Binding(o,e,n,this,n.agaveInfoMessagePostfixTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CagaveInfoMessagePostfix=m}(Pe||(Pe={}));var ke=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.jack=TDB.methodNewSubtemplateState(o,o.jackArgs),o}return __extends(t,e),t.prototype._create=function(e,t){var n=this;if(this.addChild(new Re.Cwrapper(n),e,t),n.ifShowTweenerArgs()){var o=n.tweenerArgs();o&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"_tweener"),e,t)}},t}(t.CodeCardVEBase);t.CodeCardVE=ke;var Re;!function(e){var t=function(t){function r(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(r,t),r.prototype._create=function(t,r){var a=this._context,s=document.createElement("div");this.domElement=s,s._context=a,s.className="BasicCard LabeledCard TextCard CodeCard",this._AttrBinding=new i.Attr.Binding(s,t,a,this,a.wrapperAttrArgs),this._DraggableBinding=new i.Draggable.Binding(s,t,a,this,a.wrapperDraggableInitArgs(),a.wrapperDraggableOptionsArgs),this._StyleBinding=new i.Style.Binding(s,t,a,this,a.wrapperStyleArgs),this._CssBinding=new i.Css.Binding(s,t,a,this,a.wrapperCssArgs),this._ScrollIntoViewBinding=new o.ScrollIntoView.Binding(s,t,a,this,a.wrapperScrollIntoViewInitArgs(),a.wrapperScrollIntoViewArgs),this._DistanceFromIPBinding=new n.DistanceFromIP.Binding(s,t,a,this,a.wrapperDistanceFromIPInitArgs()),this._FloatingMenuBinding=new n.FloatingMenu.Binding(s,t,a,this,a.wrapperFloatingMenuInitArgs(),a.wrapperFloatingMenuArgs),this._FocusableBinding=a.focusableBinding=new i.Focusable.Binding(s,t,a,this,a.FocusableInitArgs()),this._EventsBinding=new i.Events.Binding(s,t,a,this,a.wrapperEventsInitArgs()),this._TouchToMouseBinding=new o.TouchToMouse.Binding(s,t,a,this,a.wrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new Pe.CcardCopied(a),s,null);var l=TDB.watcherTag(17323653,a,null,a.cardSelectionOverlayArgs),c=new TDB.NewSubTemplateInstructionVE(a,l,"_selectionStatus");c.addResource(l),this.addChild(c,s,null);l=TDB.watcherTag(17323653,a,null,a.sidebarArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l)).addResource(l),this.addChild(c,s,null),this.addChild(new e.CcardLabelWrapper(a),s,null),this.addChild(new e.CcontentWrapper(a),s,null);l=TDB.watcherTag(17323653,a,null,a.codeMenuArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l,"codeMenu")).addResource(l),this.addChild(c,s,null);var d=a.editorArgs();d&&this.addChild(new TDB.NewSubTemplateInstructionVE(a,TDB.immutableWatchable(d),"editor"),s,null);l=TDB.watcherTag(17323653,a,null,a.selectionBarArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l,"_selectionBar")).addResource(l),this.addChild(c,s,null);var u=a.jack;this.addChild(new TDB.NewSubTemplateInstructionVE(a,u.raw(),void 0,u),s,null);l=TDB.watcherTag(17323653,a,null,a.authorsListArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l)).addResource(l),this.addChild(c,s,null),this._addToDom(t,r)},r.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._DraggableBinding.update(e),this._StyleBinding.update(e),this._CssBinding.update(e),this._ScrollIntoViewBinding.update(e),this._FloatingMenuBinding.update(e),this._FocusableBinding.update(e),this._TouchToMouseBinding.update(e)},r.prototype.disposeBindings=function(){this._DraggableBinding.dispose(),this._DistanceFromIPBinding.dispose(),this._FloatingMenuBinding.dispose(),this._FocusableBinding.dispose(),this._EventsBinding.dispose(),this._TouchToMouseBinding.dispose(),this._context.focusableBinding=void 0},r}(TDB.ViewElement);e.Cwrapper=t;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,i=document.createElement("div");this.domElement=i,i._context=n,i.className="CardLabelWrapper",this._TouchToMouseBinding=new o.TouchToMouse.Binding(i,e,n,this,n.cardLabelWrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TouchToMouseBinding.update(e)},t.prototype.disposeBindings=function(){this._TouchToMouseBinding.dispose()},t}(TDB.ViewElement);e.CcardLabelWrapper=r;var a=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,this._CssBinding=new i.Css.Binding(r,t,o,this,o.contentWrapperCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.CtextOverlay(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._CssBinding.update(e)},n}(TDB.ViewElement);e.CcontentWrapper=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,this._VisibleBinding=new i.Visible.Binding(r,e,n,this,n.textOverlayVisibleArgs),this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.textOverlayClassNameArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._VisibleBinding.update(e),this._ClassNameBinding.update(e)},t}(TDB.ViewElement);e.CtextOverlay=s}(Re||(Re={}));var Le=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.jack=TDB.methodNewSubtemplateState(o,o.jackArgs),o}return __extends(t,e),t.prototype._create=function(e,t){var n=this;n.ifSocketLabelArgs()&&this.addChild(new Pe.CsocketLabel(n),e,t),this.addChild(new Ue.Cwrapper(n),e,t)},t}(t.ComplexHeadingCardVEBase);t.ComplexHeadingCardVE=Le;var Ue;!function(e){var t=function(t){function r(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(r,t),r.prototype._create=function(t,r){var a=this._context,s=document.createElement("div");this.domElement=s,s._context=a,this._AttrBinding=new i.Attr.Binding(s,t,a,this,a.wrapperAttrArgs),this._DraggableBinding=new i.Draggable.Binding(s,t,a,this,a.wrapperDraggableInitArgs(),a.wrapperDraggableOptionsArgs),this._ClassNameBinding=new o.ClassName.Binding(s,t,a,this,a.wrapperClassNameArgs),this._StyleBinding=new i.Style.Binding(s,t,a,this,a.wrapperStyleArgs),this._CssBinding=new i.Css.Binding(s,t,a,this,a.wrapperCssArgs),this._ScrollIntoViewBinding=new o.ScrollIntoView.Binding(s,t,a,this,a.wrapperScrollIntoViewInitArgs(),a.wrapperScrollIntoViewArgs),this._DistanceFromIPBinding=new n.DistanceFromIP.Binding(s,t,a,this,a.wrapperDistanceFromIPInitArgs()),this._FloatingMenuBinding=new n.FloatingMenu.Binding(s,t,a,this,a.wrapperFloatingMenuInitArgs(),a.wrapperFloatingMenuArgs),this._FocusableBinding=a.focusableBinding=new i.Focusable.Binding(s,t,a,this,a.FocusableInitArgs()),this._EventsBinding=new i.Events.Binding(s,t,a,this,a.wrapperEventsInitArgs()),this._TouchToMouseBinding=new o.TouchToMouse.Binding(s,t,a,this,a.wrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new Pe.CifCardCopyAvailable(a),s,null),this.addChild(new e.CcollapsedOrTeaser(a),s,null);var l=a.jack;this.addChild(new TDB.NewSubTemplateInstructionVE(a,l.raw(),void 0,l),s,null);var c=TDB.watcherTag(17323653,a,null,a.authorsListArgs),d=new TDB.NewSubTemplateInstructionVE(a,c);d.addResource(c),this.addChild(d,s,null),this._addToDom(t,r)},r.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._DraggableBinding.update(e),this._ClassNameBinding.update(e),this._StyleBinding.update(e),this._CssBinding.update(e),this._ScrollIntoViewBinding.update(e),this._FloatingMenuBinding.update(e),this._FocusableBinding.update(e),this._TouchToMouseBinding.update(e)},r.prototype.disposeBindings=function(){this._DraggableBinding.dispose(),this._DistanceFromIPBinding.dispose(),this._FloatingMenuBinding.dispose(),this._FocusableBinding.dispose(),this._EventsBinding.dispose(),this._TouchToMouseBinding.dispose(),this._context.focusableBinding=void 0},r}(TDB.ViewElement);e.Cwrapper=t;var r=function(t){function n(e){var n=this,o=TDB.watcherTag(4519824,e,null,e.collapsedOrTeaserArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n,o){var i=this._context;switch(t){case!1:r=TDB.watcherTag(17323653,i,null,i.menuArgs);(a=new TDB.NewSubTemplateInstructionVE(i,r,"_menu")).addResource(r),this.addChild(a,n,o);r=TDB.watcherTag(17323653,i,null,i.cardExpandedViewArgs);(a=new TDB.NewSubTemplateInstructionVE(i,r,"cardExpandedView")).addResource(r),this.addChild(a,n,o);break;case!0:var r=TDB.watcherTag(17323653,i,null,i.cardDetailButtonArgs),a=new TDB.NewSubTemplateInstructionVE(i,r,"cardDetailButton");a.addResource(r),this.addChild(a,n,o);r=TDB.watcherTag(17323653,i,null,i.cardSelectionOverlayArgs);(a=new TDB.NewSubTemplateInstructionVE(i,r,"_selectionStatus")).addResource(r),this.addChild(a,n,o);r=TDB.watcherTag(17323653,i,null,i.sidebarArgs);(a=new TDB.NewSubTemplateInstructionVE(i,r)).addResource(r),this.addChild(a,n,o),i.ifThumbnailPaneArgs()&&this.addChild(new e.C1(i),n,o);r=TDB.watcherTag(17323653,i,null,i.menuArgs);(a=new TDB.NewSubTemplateInstructionVE(i,r,"_menu")).addResource(r),this.addChild(a,n,o),this.addChild(new Re.CcardLabelWrapper(i),n,o);r=TDB.watcherTag(17323653,i,null,i.labelArgs);(a=new TDB.NewSubTemplateInstructionVE(i,r)).addResource(r),this.addChild(a,n,o),this.addChild(new e.CifTitleWrapper(i),n,o);r=TDB.watcherTag(17323653,i,null,i.selectionBarArgs);(a=new TDB.NewSubTemplateInstructionVE(i,r,"_selectionBar")).addResource(r),this.addChild(a,n,o),this.addChild(new e.CifHintDismissAll(i),n,o)}},n}(TDB.SwitchInstructionVE);e.CcollapsedOrTeaser=r;var a=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="ThumbnailPane";this.addChild(new e.CbackgroundWrapper(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="HeadingCardBackgroundWrapper ThumbnailFrame",this._CssBinding=new i.Css.Binding(o,e,n,this,n.backgroundWrapperCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);var r=TDB.watcherTag(17323653,n,null,n.placeholderCardArgs),a=new TDB.NewSubTemplateInstructionVE(n,r,"_placeholderCard");a.addResource(r),this.addChild(a,o,null);r=TDB.watcherTag(17323653,n,null,n.backgroundCardArgs);(a=new TDB.NewSubTemplateInstructionVE(n,r,"backgroundCard")).addResource(r),this.addChild(a,o,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._CssBinding.update(e)},t}(TDB.ViewElement);e.CbackgroundWrapper=s;var l=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifTitleWrapperArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CcontentWrapper(o),t,n)},n}(TDB.IfInstructionVE);e.CifTitleWrapper=l;var c=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,this._CssBinding=new i.Css.Binding(o,e,n,this,n.contentWrapperCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);var r=TDB.watcherTag(17323653,n,null,n.titleCalloutArgs),a=new TDB.NewSubTemplateInstructionVE(n,r);a.addResource(r),this.addChild(a,o,null);r=TDB.watcherTag(17323653,n,null,n.titleArgs);(a=new TDB.NewSubTemplateInstructionVE(n,r,"titleEditor")).addResource(r),this.addChild(a,o,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._CssBinding.update(e)},t}(TDB.ViewElement);e.CcontentWrapper=c;var d=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifHintDismissAllArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C2(o),t,n)},n}(TDB.IfInstructionVE);e.CifHintDismissAll=d;var u=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="AuthoringHintWrapperMedia";this.addChild(new e.CauthoringHint(o),i,null);var r=o.dismissAllButtonArgs();r&&this.addChild(r.build(o),i,null);var a=TDB.watcherTag(17323653,o,null,o.closeButtonArgs),s=new TDB.NewSubTemplateInstructionVE(o,a);s.addResource(a),this.addChild(s,i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C2=u;var p=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="AuthoringHintTextHeading",this._TextBinding=new i.Text.Binding(o,e,n,this,n.authoringHintTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CauthoringHint=p}(Ue||(Ue={}));var Fe=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.jack=TDB.methodNewSubtemplateState(o,o.jackArgs),o}return __extends(t,e),t.prototype._create=function(e,t){var n=this;if(n.ifSocketLabelArgs()&&this.addChild(new Pe.CsocketLabel(n),e,t),this.addChild(new Ne.Cwrapper(n),e,t),n.ifShowTweenerArgs()){var o=n.tweenerArgs();o&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"_tweener"),e,t)}},t}(t.DocumentCardVEBase);t.DocumentCardVE=Fe;var Ne;!function(e){var t=function(t){function r(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(r,t),r.prototype._create=function(t,r){var a=this._context,s=document.createElement("div");this.domElement=s,s._context=a,s.className="BasicCard CaptionLabeledCard segoeUISemilight",this._AttrBinding=new i.Attr.Binding(s,t,a,this,a.wrapperAttrArgs),this._DraggableBinding=new i.Draggable.Binding(s,t,a,this,a.wrapperDraggableInitArgs(),a.wrapperDraggableOptionsArgs),this._StyleBinding=new i.Style.Binding(s,t,a,this,a.wrapperStyleArgs),this._CssBinding=new i.Css.Binding(s,t,a,this,a.wrapperCssArgs),this._ScrollIntoViewBinding=new o.ScrollIntoView.Binding(s,t,a,this,a.wrapperScrollIntoViewInitArgs(),a.wrapperScrollIntoViewArgs),this._DistanceFromIPBinding=new n.DistanceFromIP.Binding(s,t,a,this,a.wrapperDistanceFromIPInitArgs()),this._FloatingMenuBinding=new n.FloatingMenu.Binding(s,t,a,this,a.wrapperFloatingMenuInitArgs(),a.wrapperFloatingMenuArgs),this._FocusableBinding=a.focusableBinding=new i.Focusable.Binding(s,t,a,this,a.FocusableInitArgs()),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new Pe.CifCardCopyAvailable(a),s,null);var l=TDB.watcherTag(17323653,a,null,a.cardSelectionOverlayArgs),c=new TDB.NewSubTemplateInstructionVE(a,l,"_selectionStatus");c.addResource(l),this.addChild(c,s,null);var d=a.dropTargetOverlayArgs();d&&this.addChild(d.build(a),s,null);l=TDB.watcherTag(17323653,a,null,a.sidebarArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l)).addResource(l),this.addChild(c,s,null),this.addChild(new e.C1(a),s,null);l=TDB.watcherTag(17323653,a,null,a.menuArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l,"_menu")).addResource(l),this.addChild(c,s,null);l=TDB.watcherTag(17323653,a,null,a.labelArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l)).addResource(l),this.addChild(c,s,null),this.addChild(new e.CcontentWrapper(a),s,null),this.addChild(new e.CifErrorMessage1(a),s,null);l=TDB.watcherTag(17323653,a,null,a.selectionBarArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l,"_selectionBar")).addResource(l),this.addChild(c,s,null);var u=a.jack;this.addChild(new TDB.NewSubTemplateInstructionVE(a,u.raw(),void 0,u),s,null);l=TDB.watcherTag(17323653,a,null,a.authorsListArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l)).addResource(l),this.addChild(c,s,null),this._addToDom(t,r)},r.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._DraggableBinding.update(e),this._StyleBinding.update(e),this._CssBinding.update(e),this._ScrollIntoViewBinding.update(e),this._FloatingMenuBinding.update(e),this._FocusableBinding.update(e)},r.prototype.disposeBindings=function(){this._DraggableBinding.dispose(),this._DistanceFromIPBinding.dispose(),this._FloatingMenuBinding.dispose(),this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},r}(TDB.ViewElement);e.Cwrapper=t;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="ThumbnailPane";this.addChild(new e.CimageWrapper(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=r;var a=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var i=this._context,r=document.createElement("div");this.domElement=r,r._context=i,r.className="MediaPlaceholderImageWrapper ThumbnailFrame",this._TouchToMouseBinding=new o.TouchToMouse.Binding(r,t,i,this,i.imageWrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.CifUploadingPlaceholder(i),r,null),this.addChild(new e.CifErrorMessage(i),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._TouchToMouseBinding.update(e)},n.prototype.disposeBindings=function(){this._TouchToMouseBinding.dispose()},n}(TDB.ViewElement);e.CimageWrapper=a;var s=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifUploadingPlaceholderArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C2(o),t,n)},n}(TDB.IfInstructionVE);e.CifUploadingPlaceholder=s;var l=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o;this.addChild(new e.CplaceholderSpinner(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C2=l;var c=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="MediaCardDocumentPlaceholderSpinner",this._StyleBinding=new i.Style.Binding(o,e,n,this,n.placeholderSpinnerStyleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e)},t}(TDB.ViewElement);e.CplaceholderSpinner=c;var d=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifErrorMessageArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C3(o),t,n);var i=TDB.watcherTag(17323653,o,null,o.placeholderIconArgs),r=new TDB.NewSubTemplateInstructionVE(o,i);r.addResource(i),this.addChild(r,t,n)},n}(TDB.IfInstructionVE);e.CifErrorMessage=d;var u=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="MediaCardImageOverlay",this._addToDom(e,t)},t}(TDB.ViewElement);e.C3=u;var p=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="MediaPlaceholderCaptionWrapper",this._CssBinding=new i.Css.Binding(r,t,o,this,o.contentWrapperCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.CstatusMessage(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._CssBinding.update(e)},n}(TDB.ViewElement);e.CcontentWrapper=p;var g=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="segoeUI",this._TextBinding=new i.Text.Binding(o,e,n,this,n.statusMessageTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CstatusMessage=g;var h=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifErrorMessageArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CmediaCardErrorWrapper(o),t,n)},n}(TDB.IfInstructionVE);e.CifErrorMessage1=h;var C=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="MediaCardErrorWrapper",this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.mediaCardErrorWrapperAttrArgs);this.addChild(new e.CerrorMessage(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e)},n}(TDB.ViewElement);e.CmediaCardErrorWrapper=C;var f=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="MediaCardErrorText",this._TextBinding=new i.Text.Binding(o,e,n,this,n.errorMessageTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CerrorMessage=f}(Ne||(Ne={}));var Oe=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.jack=TDB.methodNewSubtemplateState(o,o.jackArgs),o}return __extends(t,e),t.prototype._create=function(e,t){var n=this;if(n.ifSocketLabelArgs()&&this.addChild(new Pe.CsocketLabel(n),e,t),this.addChild(new We.Cwrapper(n),e,t),n.ifShowTweenerArgs()){var o=n.tweenerArgs();o&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"_tweener"),e,t)}},t}(t.ImportingOrEmbeddingDocumentCardVEBase);t.ImportingOrEmbeddingDocumentCardVE=Oe;var We;!function(e){var t=function(t){function r(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(r,t),r.prototype._create=function(t,r){var a=this._context,s=document.createElement("div");this.domElement=s,s._context=a,s.className="BasicCard ImportingOrEmbeddingDocumentCard segoeUISemilight",this._AttrBinding=new i.Attr.Binding(s,t,a,this,a.wrapperAttrArgs),this._DraggableBinding=new i.Draggable.Binding(s,t,a,this,a.wrapperDraggableInitArgs(),a.wrapperDraggableOptionsArgs),this._StyleBinding=new i.Style.Binding(s,t,a,this,a.wrapperStyleArgs),this._CssBinding=new i.Css.Binding(s,t,a,this,a.wrapperCssArgs),this._ScrollIntoViewBinding=new o.ScrollIntoView.Binding(s,t,a,this,a.wrapperScrollIntoViewInitArgs(),a.wrapperScrollIntoViewArgs),this._DistanceFromIPBinding=new n.DistanceFromIP.Binding(s,t,a,this,a.wrapperDistanceFromIPInitArgs()),this._FloatingMenuBinding=new n.FloatingMenu.Binding(s,t,a,this,a.wrapperFloatingMenuInitArgs(),a.wrapperFloatingMenuArgs),this._FocusableBinding=a.focusableBinding=new i.Focusable.Binding(s,t,a,this,a.FocusableInitArgs()),this._EventsBinding=new i.Events.Binding(s,t,a,this,a.wrapperEventsInitArgs()),this._TouchToMouseBinding=new o.TouchToMouse.Binding(s,t,a,this,a.wrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);var l=TDB.watcherTag(17323653,a,null,a.cardSelectionOverlayArgs),c=new TDB.NewSubTemplateInstructionVE(a,l,"_selectionStatus");c.addResource(l),this.addChild(c,s,null);var d=a.dropTargetOverlayArgs();d&&this.addChild(d.build(a),s,null);l=TDB.watcherTag(17323653,a,null,a.sidebarArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l)).addResource(l),this.addChild(c,s,null),this.addChild(new e.C1(a),s,null);l=TDB.watcherTag(17323653,a,null,a.menuArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l,"_menu")).addResource(l),this.addChild(c,s,null);l=TDB.watcherTag(17323653,a,null,a.labelArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l)).addResource(l),this.addChild(c,s,null),this.addChild(new e.CcontentWrapper(a),s,null),this.addChild(new e.CifValidState(a),s,null);l=TDB.watcherTag(17323653,a,null,a.selectionBarArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l,"_selectionBar")).addResource(l),this.addChild(c,s,null);var u=a.jack;this.addChild(new TDB.NewSubTemplateInstructionVE(a,u.raw(),void 0,u),s,null),this._addToDom(t,r)},r.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._DraggableBinding.update(e),this._StyleBinding.update(e),this._CssBinding.update(e),this._ScrollIntoViewBinding.update(e),this._FloatingMenuBinding.update(e),this._FocusableBinding.update(e),this._TouchToMouseBinding.update(e)},r.prototype.disposeBindings=function(){this._DraggableBinding.dispose(),this._DistanceFromIPBinding.dispose(),this._FloatingMenuBinding.dispose(),this._FocusableBinding.dispose(),this._EventsBinding.dispose(),this._TouchToMouseBinding.dispose(),this._context.focusableBinding=void 0},r}(TDB.ViewElement);e.Cwrapper=t;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="ThumbnailPane";this.addChild(new e.CifThumbnailOverlay(o),i,null),this.addChild(new e.CimageWrapper(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=r;var a=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifThumbnailOverlayArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C2(o),t,n)},n}(TDB.IfInstructionVE);e.CifThumbnailOverlay=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="MediaCardImageOverlay",this._addToDom(e,t)},t}(TDB.ViewElement);e.C2=s;var l=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var i=this._context,r=document.createElement("div");this.domElement=r,r._context=i,r.className="MediaPlaceholderImageWrapper ThumbnailFrame",this._TouchToMouseBinding=new o.TouchToMouse.Binding(r,t,i,this,i.imageWrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.CdocumentImageOrSpinner(i),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._TouchToMouseBinding.update(e)},n.prototype.disposeBindings=function(){this._TouchToMouseBinding.dispose()},n}(TDB.ViewElement);e.CimageWrapper=l;var c=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ImportingOrEmbeddingDocumentImageOrSpinner",this._CssBinding=new i.Css.Binding(o,e,n,this,n.documentImageOrSpinnerCssArgs),this._StyleBinding=new i.Style.Binding(o,e,n,this,n.documentImageOrSpinnerStyleArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);var r=TDB.watcherTag(17323653,n,null,n.placeholderIconArgs),a=new TDB.NewSubTemplateInstructionVE(n,r);a.addResource(r),this.addChild(a,o,null),this.addChild(new Pe.CifOverlayLabel(n),o,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._CssBinding.update(e),this._StyleBinding.update(e)},t}(TDB.ViewElement);e.CdocumentImageOrSpinner=c;var d=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="ImportingOrEmbeddingTextWrapper",this._CssBinding=new i.Css.Binding(r,t,o,this,o.contentWrapperCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.CimportingOrEmbeddingDocumentMessage(o),r,null),this.addChild(new e.CimportingOrEmbeddingDocumentError(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._CssBinding.update(e)},n}(TDB.ViewElement);e.CcontentWrapper=d;var u=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ImportingOrEmbeddingDocumentMessage",this._TextBinding=new i.Text.Binding(o,e,n,this,n.importingOrEmbeddingDocumentMessageTextArgs),this._StyleBinding=new i.Style.Binding(o,e,n,this,n.importingOrEmbeddingDocumentMessageStyleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e),this._StyleBinding.update(e)},t}(TDB.ViewElement);e.CimportingOrEmbeddingDocumentMessage=u;var p=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="segoeUI",this._TextBinding=new i.Text.Binding(o,e,n,this,n.importingOrEmbeddingDocumentErrorTextArgs),this._StyleBinding=new i.Style.Binding(o,e,n,this,n.importingOrEmbeddingDocumentErrorStyleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e),this._StyleBinding.update(e)},t}(TDB.ViewElement);e.CimportingOrEmbeddingDocumentError=p;var g=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifValidStateArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CimportingOrEmbeddingDocumentButtonsWrapper(o),t,n)},n}(TDB.IfInstructionVE);e.CifValidState=g;var h=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ImportingOrEmbeddingDocumentButtonsWrapper",this._StyleBinding=new i.Style.Binding(o,e,n,this,n.importingOrEmbeddingDocumentButtonsWrapperStyleArgs);var r=n.importButtonVEArgs();r&&this.addChild(r.build(n),o,null),(r=n.embedButtonVEArgs())&&this.addChild(r.build(n),o,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e)},t}(TDB.ViewElement);e.CimportingOrEmbeddingDocumentButtonsWrapper=h}(We||(We={}));var He=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.jack=TDB.methodNewSubtemplateState(o,o.jackArgs),o}return __extends(t,e),t.prototype._create=function(e,t){var n=this;if(n.ifSocketLabelArgs()&&this.addChild(new Pe.CsocketLabel(n),e,t),this.addChild(new Ge.Cwrapper(n),e,t),n.ifShowTweenerArgs()){var o=n.tweenerArgs();o&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"_tweener"),e,t)}},t}(t.EmbedCardVEBase);t.EmbedCardVE=He;var Ge;!function(e){var t=function(t){function r(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(r,t),r.prototype._create=function(t,r){var a=this._context,s=document.createElement("div");this.domElement=s,s._context=a,s.className="BasicCard EmbedCard",this._AttrBinding=new i.Attr.Binding(s,t,a,this,a.wrapperAttrArgs),this._DraggableBinding=new i.Draggable.Binding(s,t,a,this,a.wrapperDraggableInitArgs(),a.wrapperDraggableOptionsArgs),this._StyleBinding=new i.Style.Binding(s,t,a,this,a.wrapperStyleArgs),this._CssBinding=new i.Css.Binding(s,t,a,this,a.wrapperCssArgs),this._ScrollIntoViewBinding=new o.ScrollIntoView.Binding(s,t,a,this,a.wrapperScrollIntoViewInitArgs(),a.wrapperScrollIntoViewArgs),this._DistanceFromIPBinding=new n.DistanceFromIP.Binding(s,t,a,this,a.wrapperDistanceFromIPInitArgs()),this._FloatingMenuBinding=new n.FloatingMenu.Binding(s,t,a,this,a.wrapperFloatingMenuInitArgs(),a.wrapperFloatingMenuArgs),this._FocusableBinding=a.focusableBinding=new i.Focusable.Binding(s,t,a,this,a.FocusableInitArgs()),this._EventsBinding=new i.Events.Binding(s,t,a,this,a.wrapperEventsInitArgs()),this._TouchToMouseBinding=new o.TouchToMouse.Binding(s,t,a,this,a.wrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new Pe.CifCardCopyAvailable(a),s,null);var l=TDB.watcherTag(17323653,a,null,a.cardSelectionOverlayArgs),c=new TDB.NewSubTemplateInstructionVE(a,l,"_selectionStatus");c.addResource(l),this.addChild(c,s,null);var d=a.dropTargetOverlayArgs();d&&this.addChild(d.build(a),s,null);l=TDB.watcherTag(17323653,a,null,a.sidebarArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l)).addResource(l),this.addChild(c,s,null),this.addChild(new e.C1(a),s,null);l=TDB.watcherTag(17323653,a,null,a.labelArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l)).addResource(l),this.addChild(c,s,null);l=TDB.watcherTag(17323653,a,null,a.menuArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l,"_menu")).addResource(l),this.addChild(c,s,null),this.addChild(new e.CcontentWrapper(a),s,null),this.addChild(new e.CifErrorMessage(a),s,null);l=TDB.watcherTag(17323653,a,null,a.selectionBarArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l,"_selectionBar")).addResource(l),this.addChild(c,s,null);var u=a.jack;this.addChild(new TDB.NewSubTemplateInstructionVE(a,u.raw(),void 0,u),s,null);l=TDB.watcherTag(17323653,a,null,a.authorsListArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l)).addResource(l),this.addChild(c,s,null),this._addToDom(t,r)},r.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._DraggableBinding.update(e),this._StyleBinding.update(e),this._CssBinding.update(e),this._ScrollIntoViewBinding.update(e),this._FloatingMenuBinding.update(e),this._FocusableBinding.update(e),this._TouchToMouseBinding.update(e)},r.prototype.disposeBindings=function(){this._DraggableBinding.dispose(),this._DistanceFromIPBinding.dispose(),this._FloatingMenuBinding.dispose(),this._FocusableBinding.dispose(),this._EventsBinding.dispose(),this._TouchToMouseBinding.dispose(),this._context.focusableBinding=void 0},r}(TDB.ViewElement);e.Cwrapper=t;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="ThumbnailPane";this.addChild(new We.CifThumbnailOverlay(o),i,null),this.addChild(new e.CimageWrapper(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=r;var a=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var i=this._context,r=document.createElement("div");this.domElement=r,r._context=i,r.className="MediaPlaceholderImageWrapper ThumbnailFrame",this._TouchToMouseBinding=new o.TouchToMouse.Binding(r,t,i,this,i.imageWrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.CembedDocumentImageOrSpinner(i),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._TouchToMouseBinding.update(e)},n.prototype.disposeBindings=function(){this._TouchToMouseBinding.dispose()},n}(TDB.ViewElement);e.CimageWrapper=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="EmbedDocumentImageOrSpinner EmbedPlaceholderCard",this._StyleBinding=new i.Style.Binding(o,e,n,this,n.embedDocumentImageOrSpinnerStyleArgs),this._CssBinding=new i.Css.Binding(o,e,n,this,n.embedDocumentImageOrSpinnerCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);var r=TDB.watcherTag(17323653,n,null,n.placeholderIconArgs),a=new TDB.NewSubTemplateInstructionVE(n,r);a.addResource(r),this.addChild(a,o,null),this.addChild(new Pe.CifOverlayLabel(n),o,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e),this._CssBinding.update(e)},t}(TDB.ViewElement);e.CembedDocumentImageOrSpinner=s;var l=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="EmbedTextWrapper",this._CssBinding=new i.Css.Binding(r,t,o,this,o.contentWrapperCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);var a=TDB.watcherTag(17323652,o,null,o.embedMessageInfoArgs),s=new TDB.NewForeachInstructionVE(o,a);s.addResource(a),this.addChild(s,r,null),this.addChild(new e.CviewEmbedCode(o),r,null);var l=o.textAreaArgs();l&&this.addChild(new TDB.NewSubTemplateInstructionVE(o,TDB.immutableWatchable(l),"_textAreaVE"),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._CssBinding.update(e)},n}(TDB.ViewElement);e.CcontentWrapper=l;var c=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="EmbedCardViewEmbedCode",this._StyleBinding=new i.Style.Binding(o,e,n,this,n.viewEmbedCodeStyleArgs),this._TextBinding=new i.Text.Binding(o,e,n,this,n.viewEmbedCodeTextArgs),this._EventsBinding=new i.Events.Binding(o,e,n,this,n.viewEmbedCodeEventsInitArgs()),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e),this._TextBinding.update(e)},t.prototype.disposeBindings=function(){this._EventsBinding.dispose()},t}(TDB.ViewElement);e.CviewEmbedCode=c;var d=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifErrorMessageArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CmediaCardErrorWrapper(o),t,n)},n}(TDB.IfInstructionVE);e.CifErrorMessage=d;var u=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,r.className="EmbedCardErrorWrapper",this._HeightWatcherBinding=new o.HeightWatcher.Binding(r,e,n,this,n.mediaCardErrorWrapperHeightWatcherInitArgs()),this._AttrBinding=new i.Attr.Binding(r,e,n,this,n.mediaCardErrorWrapperAttrArgs);var a=TDB.watcherTag(17323653,n,null,n.errorMessageArgs),s=new TDB.NewSubTemplateInstructionVE(n,a,"_errorMessage");s.addResource(a),this.addChild(s,r,null);a=TDB.watcherTag(17323653,n,null,n.mediaCardErrorOkButtonArgs);(s=new TDB.NewSubTemplateInstructionVE(n,a)).addResource(a),this.addChild(s,r,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e)},t.prototype.disposeBindings=function(){this._HeightWatcherBinding.dispose()},t}(TDB.ViewElement);e.CmediaCardErrorWrapper=u}(Ge||(Ge={}));var ze=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.contentCards=TDB.methodNewForeachState(o,o.contentCardsArgs),o.jack=TDB.methodNewSubtemplateState(o,o.jackArgs),o}return __extends(t,e),t.prototype._create=function(e,t){var n=this;n.ifSocketLabelArgs()&&this.addChild(new Pe.CsocketLabel(n),e,t),this.addChild(new je.CifTeaserMode(n),e,t)},t}(t.GroupCardVEBase);t.GroupCardVE=ze;var je;!function(e){var t=function(t){function n(e){var n=this,o=TDB.watcherTag(4519824,e,null,e.ifTeaserModeArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n,o){var i=this._context;switch(t){case!1:this.addChild(new e.Cwrapper(i),n,o);var r=TDB.watcherTag(17323653,i,null,i.bottomTweenerArgs),a=new TDB.NewSubTemplateInstructionVE(i,r);a.addResource(r),this.addChild(a,n,o);break;case!0:this.addChild(new e.CthumbnailWrapper(i),n,o)}},n}(TDB.SwitchInstructionVE);e.CifTeaserMode=t;var r=function(t){function r(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(r,t),r.prototype._create=function(t,r){var a=this._context,s=document.createElement("div");this.domElement=s,s._context=a,s.className="GroupCard",this._AttrBinding=new i.Attr.Binding(s,t,a,this,a.wrapperAttrArgs),this._DraggableBinding=new i.Draggable.Binding(s,t,a,this,a.wrapperDraggableInitArgs(),a.wrapperDraggableOptionsArgs),this._CssBinding=new i.Css.Binding(s,t,a,this,a.wrapperCssArgs),this._StyleBinding=new i.Style.Binding(s,t,a,this,a.wrapperStyleArgs),this._DistanceFromIPBinding=new n.DistanceFromIP.Binding(s,t,a,this,a.wrapperDistanceFromIPInitArgs()),this._FloatingMenuBinding=new n.FloatingMenu.Binding(s,t,a,this,a.wrapperFloatingMenuInitArgs(),a.wrapperFloatingMenuArgs),this._FocusableBinding=a.focusableBinding=new i.Focusable.Binding(s,t,a,this,a.FocusableInitArgs()),this._TouchToMouseBinding=new o.TouchToMouse.Binding(s,t,a,this,a.wrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new Pe.CifCardCopyAvailable(a),s,null);var l=a.headerArgs();l&&this.addChild(l.build(a),s,null);var c=TDB.watcherTag(17323653,a,null,a.menuArgs),d=new TDB.NewSubTemplateInstructionVE(a,c,"_menu");d.addResource(c),this.addChild(d,s,null),this.addChild(new e.CifStackWrapper(a),s,null);c=TDB.watcherTag(17323653,a,null,a.topTweenerArgs);(d=new TDB.NewSubTemplateInstructionVE(a,c)).addResource(c),this.addChild(d,s,null),this.addChild(new e.CcontentWrapper(a),s,null);c=TDB.watcherTag(17323653,a,null,a.firstRunJackHintArgs);(d=new TDB.NewSubTemplateInstructionVE(a,c)).addResource(c),this.addChild(d,s,null);c=TDB.watcherTag(17323653,a,null,a.cardSelectionOverlayArgs);(d=new TDB.NewSubTemplateInstructionVE(a,c,"_selectionStatus")).addResource(c),this.addChild(d,s,null);var u=a.jack;this.addChild(new TDB.NewSubTemplateInstructionVE(a,u.raw(),void 0,u),s,null);c=TDB.watcherTag(17323653,a,null,a.authorsListArgs);(d=new TDB.NewSubTemplateInstructionVE(a,c)).addResource(c),this.addChild(d,s,null),this._addToDom(t,r)},r.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._DraggableBinding.update(e),this._CssBinding.update(e),this._StyleBinding.update(e),this._FloatingMenuBinding.update(e),this._FocusableBinding.update(e),this._TouchToMouseBinding.update(e)},r.prototype.disposeBindings=function(){this._DraggableBinding.dispose(),this._DistanceFromIPBinding.dispose(),this._FloatingMenuBinding.dispose(),this._FocusableBinding.dispose(),this._TouchToMouseBinding.dispose(),this._context.focusableBinding=void 0},r}(TDB.ViewElement);e.Cwrapper=r;var a=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifStackWrapperArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CstackWrapper(o),t,n)},n}(TDB.IfInstructionVE);e.CifStackWrapper=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="CardStackWrapper",this._CssBinding=new i.Css.Binding(o,e,n,this,n.stackWrapperCssArgs),this._StyleBinding=new i.Style.Binding(o,e,n,this,n.stackWrapperStyleArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new TDB.SubTemplateInstructionVE(!0,n.headingCardArgs()),o,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._CssBinding.update(e),this._StyleBinding.update(e)},t}(TDB.ViewElement);e.CstackWrapper=s;var l=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,r.className="GroupCardContent",this._SlideVisibleBinding=new o.SlideVisible.Binding(r,e,n,this,n.contentWrapperSlideVisibleInitArgs(),n.contentWrapperSlideVisibleArgs),this._CssBinding=new i.Css.Binding(r,e,n,this,n.contentWrapperCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);var a=TDB.watcherTag(17323653,n,null,n.dropTargetOverlayArgs),s=new TDB.NewSubTemplateInstructionVE(n,a);s.addResource(a),this.addChild(s,r,null);var l=n.contentCards;this.addChild(new TDB.NewForeachInstructionVE(n,l.raw(),void 0,l),r,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._SlideVisibleBinding.update(e),this._CssBinding.update(e)},t}(TDB.ViewElement);e.CcontentWrapper=l;var c=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="GroupCardThumbnailWrapper BasicCardTeaser",this._CssBinding=new i.Css.Binding(r,t,o,this,o.thumbnailWrapperCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.C1(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._CssBinding.update(e)},n}(TDB.ViewElement);e.CthumbnailWrapper=c;var d=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="GroupCardThumbnail";this.addChild(new e.CifImage(o),i,null),this.addChild(new e.C3(o),i,null),this.addChild(new e.C4(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=d;var u=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifImageArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new Ne.C3(o),t,n),this.addChild(new e.Cimage(o),t,n)},n}(TDB.IfInstructionVE);e.CifImage=u;var p=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("img");this.domElement=o,o._context=n,o.className="MediaCardImage",this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.imageAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e)},t}(TDB.ViewElement);e.Cimage=p;var g=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="OverlayIconText";this.addChild(new e.CthumbnailIconText(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C3=g;var h=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="GroupCardThumbnailText OverlayLabelText UnselectableText",this._TextBinding=new i.Text.Binding(o,e,n,this,n.thumbnailIconTextTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CthumbnailIconText=h;var C=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="OverlayLabelWrapper";this.addChild(new e.CthumbnailLabel(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C4=C;var f=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="GroupCardThumbnailText OverlayLabelText UnselectableText",this._TextBinding=new i.Text.Binding(o,e,n,this,n.thumbnailLabelTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CthumbnailLabel=f}(je||(je={}));var Ke=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.jack=TDB.methodNewSubtemplateState(o,o.jackArgs),o}return __extends(t,e),t.prototype._create=function(e,t){var n=this;if(n.ifSocketLabelArgs()&&this.addChild(new Pe.CsocketLabel(n),e,t),this.addChild(new qe.Cwrapper(n),e,t),n.ifShowTweenerArgs()){var o=n.tweenerArgs();o&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"_tweener"),e,t)}},t}(t.ImageCardVEBase);t.ImageCardVE=Ke;var qe;!function(e){var t=function(t){function r(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(r,t),r.prototype._create=function(t,r){var a=this._context,s=document.createElement("div");this.domElement=s,s._context=a,s.className="BasicCard CaptionLabeledCard segoeUISemilight",this._AttrBinding=new i.Attr.Binding(s,t,a,this,a.wrapperAttrArgs),this._DraggableBinding=new i.Draggable.Binding(s,t,a,this,a.wrapperDraggableInitArgs(),a.wrapperDraggableOptionsArgs),this._StyleBinding=new i.Style.Binding(s,t,a,this,a.wrapperStyleArgs),this._CssBinding=new i.Css.Binding(s,t,a,this,a.wrapperCssArgs),this._ScrollIntoViewBinding=new o.ScrollIntoView.Binding(s,t,a,this,a.wrapperScrollIntoViewInitArgs(),a.wrapperScrollIntoViewArgs),this._DistanceFromIPBinding=new n.DistanceFromIP.Binding(s,t,a,this,a.wrapperDistanceFromIPInitArgs()),this._FloatingMenuBinding=new n.FloatingMenu.Binding(s,t,a,this,a.wrapperFloatingMenuInitArgs(),a.wrapperFloatingMenuArgs),this._FocusableBinding=a.focusableBinding=new i.Focusable.Binding(s,t,a,this,a.FocusableInitArgs()),this._EventsBinding=new i.Events.Binding(s,t,a,this,a.wrapperEventsInitArgs()),this._TouchToMouseBinding=new o.TouchToMouse.Binding(s,t,a,this,a.wrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new Pe.CifCardCopyAvailable(a),s,null),this.addChild(new e.CcollapsedOrTeaser(a),s,null);var l=a.jack;this.addChild(new TDB.NewSubTemplateInstructionVE(a,l.raw(),void 0,l),s,null);var c=TDB.watcherTag(17323653,a,null,a.authorsListArgs),d=new TDB.NewSubTemplateInstructionVE(a,c);d.addResource(c),this.addChild(d,s,null);c=TDB.watcherTag(17323653,a,null,a.uploadProgressArgs);(d=new TDB.NewSubTemplateInstructionVE(a,c)).addResource(c),this.addChild(d,s,null),this._addToDom(t,r)},r.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._DraggableBinding.update(e),this._StyleBinding.update(e),this._CssBinding.update(e),this._ScrollIntoViewBinding.update(e),this._FloatingMenuBinding.update(e),this._FocusableBinding.update(e),this._TouchToMouseBinding.update(e)},r.prototype.disposeBindings=function(){this._DraggableBinding.dispose(),this._DistanceFromIPBinding.dispose(),this._FloatingMenuBinding.dispose(),this._FocusableBinding.dispose(),this._EventsBinding.dispose(),this._TouchToMouseBinding.dispose(),this._context.focusableBinding=void 0},r}(TDB.ViewElement);e.Cwrapper=t;var r=function(t){function n(e){var n=this,o=TDB.watcherTag(4519824,e,null,e.collapsedOrTeaserArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n,o){var i=this._context;switch(t){case!0:r=TDB.watcherTag(17323653,i,null,i.cardSelectionOverlayArgs);(a=new TDB.NewSubTemplateInstructionVE(i,r,"_selectionStatus")).addResource(r),this.addChild(a,n,o),this.addChild(new e.CifDropTargetOverlay(i),n,o);r=TDB.watcherTag(17323653,i,null,i.sidebarArgs);(a=new TDB.NewSubTemplateInstructionVE(i,r)).addResource(r),this.addChild(a,n,o);r=TDB.watcherTag(17323653,i,null,i.cardDetailButtonArgs);(a=new TDB.NewSubTemplateInstructionVE(i,r,"cardDetailButton")).addResource(r),this.addChild(a,n,o),this.addChild(new e.C1(i),n,o);r=TDB.watcherTag(17323653,i,null,i.menuArgs);(a=new TDB.NewSubTemplateInstructionVE(i,r,"_menu")).addResource(r),this.addChild(a,n,o);r=TDB.watcherTag(17323653,i,null,i.labelArgs);(a=new TDB.NewSubTemplateInstructionVE(i,r)).addResource(r),this.addChild(a,n,o),this.addChild(new e.CifCaptionWrapper(i),n,o);r=TDB.watcherTag(17323653,i,null,i.selectionBarArgs);(a=new TDB.NewSubTemplateInstructionVE(i,r,"_selectionBar")).addResource(r),this.addChild(a,n,o),this.addChild(new e.CauthoringHintWrapper(i),n,o),this.addChild(new Ne.CifErrorMessage1(i),n,o);break;case!1:var r=TDB.watcherTag(17323653,i,null,i.menuArgs),a=new TDB.NewSubTemplateInstructionVE(i,r,"_menu");a.addResource(r),this.addChild(a,n,o);r=TDB.watcherTag(17323653,i,null,i.cardExpandedViewArgs);(a=new TDB.NewSubTemplateInstructionVE(i,r,"cardExpandedView")).addResource(r),this.addChild(a,n,o)}},n}(TDB.SwitchInstructionVE);e.CcollapsedOrTeaser=r;var a=function(e){function t(t){var n=this,o=TDB.watcherTag(4543754,t,null,t.ifDropTargetOverlayArgs);return(n=e.call(this,o)||this).addResource(o),n._context=t,n}return __extends(t,e),t.prototype.buildChildren=function(e,t){var n=this._context,o=n.dropTargetOverlayArgs();o&&this.addChild(o.build(n),e,t)},t}(TDB.IfInstructionVE);e.CifDropTargetOverlay=a;var s=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="ThumbnailPane";this.addChild(new e.CifThumbnailOverlay(o),i,null),this.addChild(new e.CimageWrapper(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=s;var l=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifThumbnailOverlayArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CimageOverlay(o),t,n)},n}(TDB.IfInstructionVE);e.CifThumbnailOverlay=l;var c=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="MediaCardImageOverlay",this._StyleBinding=new i.Style.Binding(o,e,n,this,n.imageOverlayStyleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e)},t}(TDB.ViewElement);e.CimageOverlay=c;var d=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,r.className="MediaPlaceholderImageWrapper ThumbnailFrame",this._CssBinding=new i.Css.Binding(r,e,n,this,n.imageWrapperCssArgs),this._TouchToMouseBinding=new o.TouchToMouse.Binding(r,e,n,this,n.imageWrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);var a=TDB.watcherTag(17323653,n,null,n.placeholderCardArgs),s=new TDB.NewSubTemplateInstructionVE(n,a,"_placeholderCard");s.addResource(a),this.addChild(s,r,null);a=TDB.watcherTag(17323653,n,null,n.mediaCardImageArgs);(s=new TDB.NewSubTemplateInstructionVE(n,a,"_mediaImage")).addResource(a),this.addChild(s,r,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._CssBinding.update(e),this._TouchToMouseBinding.update(e)},t.prototype.disposeBindings=function(){this._TouchToMouseBinding.dispose()},t}(TDB.ViewElement);e.CimageWrapper=d;var u=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifCaptionWrapperArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CcontentWrapper(o),t,n)},n}(TDB.IfInstructionVE);e.CifCaptionWrapper=u;var p=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="MediaPlaceholderCaptionWrapper calibriRegular",this._CssBinding=new i.Css.Binding(r,t,o,this,o.contentWrapperCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.CtextOverlay(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._CssBinding.update(e)},n}(TDB.ViewElement);e.CcontentWrapper=p;var g=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,this._VisibleBinding=new i.Visible.Binding(r,t,o,this,o.textOverlayVisibleArgs);this.addChild(new TDB.NewSubTemplateInstructionVE(o,o.textArgs(),"textSocket"),r,null),this.addChild(new e.C2(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._VisibleBinding.update(e)},n}(TDB.ViewElement);e.CtextOverlay=g;var h=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,this._addToDom(e,t)},t}(TDB.ViewElement);e.C2=h;var C=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="AuthoringHintWrapperMedia",this._VisibleBinding=new i.Visible.Binding(r,t,o,this,o.authoringHintWrapperVisibleArgs);var a=TDB.watcherTag(17323653,o,null,o.closeButtonArgs),s=new TDB.NewSubTemplateInstructionVE(o,a);s.addResource(a),this.addChild(s,r,null),this.addChild(new e.CauthoringHint(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._VisibleBinding.update(e)},n}(TDB.ViewElement);e.CauthoringHintWrapper=C;var f=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,i=document.createElement("div");this.domElement=i,i._context=n,this._ClassNameBinding=new o.ClassName.Binding(i,e,n,this,n.authoringHintClassNameArgs);var r=TDB.watcherTag(17323653,n,null,n.hintTextArgs),a=new TDB.NewSubTemplateInstructionVE(n,r);a.addResource(r),this.addChild(a,i,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},t}(TDB.ViewElement);e.CauthoringHint=f}(qe||(qe={}));var Je=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new $e.Cwrapper(n),e,t)},t}(t.MediaCardImageVEBase);t.MediaCardImageVE=Je;var $e;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="MediaCardImageWrapper",this._CssBinding=new i.Css.Binding(r,t,o,this,o.wrapperCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.CifUploadingPlaceholder(o),r,null),this.addChild(new e.CifThumbnailPaneBackground(o),r,null),this.addChild(new e.CifImage(o),r,null),this.addChild(new e.CifOverlayIcon(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._CssBinding.update(e)},n}(TDB.ViewElement);e.Cwrapper=t;var n=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifUploadingPlaceholderArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C1(o),t,n)},n}(TDB.IfInstructionVE);e.CifUploadingPlaceholder=n;var o=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o;this.addChild(new e.CuploadingSpinner(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=o;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="MediaCardImagePlaceholderSpinner",this._StyleBinding=new i.Style.Binding(o,e,n,this,n.uploadingSpinnerStyleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e)},t}(TDB.ViewElement);e.CuploadingSpinner=r;var a=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifThumbnailPaneBackgroundArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CthumbnailPaneBackground(o),t,n)},n}(TDB.IfInstructionVE);e.CifThumbnailPaneBackground=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ThumbnailPaneBackground",this._StyleBinding=new i.Style.Binding(o,e,n,this,n.thumbnailPaneBackgroundStyleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e)},t}(TDB.ViewElement);e.CthumbnailPaneBackground=s;var l=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifImageArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;switch(o.ifSupportsObjectFitArgs()){case!0:this.addChild(new e.Cimage(o),t,n);break;case!1:this.addChild(new e.CimageDiv(o),t,n)}},n}(TDB.IfInstructionVE);e.CifImage=l;var c=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("img");this.domElement=o,o._context=n,o.className="MediaCardImage",this._StyleBinding=new i.Style.Binding(o,e,n,this,n.imageStyleArgs),this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.imageAttrArgs),this._EventsBinding=new i.Events.Binding(o,e,n,this,n.imageEventsInitArgs()),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e),this._AttrBinding.update(e)},t.prototype.disposeBindings=function(){this._EventsBinding.dispose()},t}(TDB.ViewElement);e.Cimage=c;var d=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ImageDiv",o.setAttribute("role","img"),this._StyleBinding=new i.Style.Binding(o,e,n,this,n.imageDivStyleArgs),this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.imageDivAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e),this._AttrBinding.update(e)},t}(TDB.ViewElement);e.CimageDiv=d;var u=function(e){function t(t){var n=this,o=TDB.watcherTag(4543754,t,null,t.ifOverlayIconArgs);return(n=e.call(this,o)||this).addResource(o),n._context=t,n}return __extends(t,e),t.prototype.buildChildren=function(e,t){var n=this._context,o=n.overlayIconArgs();o&&this.addChild(o.build(n),e,t),this.addChild(new Pe.CifOverlayLabel(n),e,t)},t}(TDB.IfInstructionVE);e.CifOverlayIcon=u}($e||($e={}));var Qe=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.jack=TDB.methodNewSubtemplateState(o,o.jackArgs),o}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Xe.CifCardWrapper(n),e,t)},t}(t.PlaceholderCardVEBase);t.PlaceholderCardVE=Qe;var Xe;!function(e){var t=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifCardWrapperArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.Cwrapper(o),t,n);var i=o.jack;this.addChild(new TDB.NewSubTemplateInstructionVE(o,i.raw(),void 0,i),t,n)},n}(TDB.IfInstructionVE);e.CifCardWrapper=t;var r=function(t){function r(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(r,t),r.prototype._create=function(t,r){var a=this._context,s=document.createElement("div");this.domElement=s,s._context=a,s.className="PlaceholderCard segoeUISemilight",this._StyleBinding=new i.Style.Binding(s,t,a,this,a.wrapperStyleArgs),this._CssBinding=new i.Css.Binding(s,t,a,this,a.wrapperCssArgs),this._ScrollIntoViewBinding=new o.ScrollIntoView.Binding(s,t,a,this,a.wrapperScrollIntoViewInitArgs(),a.wrapperScrollIntoViewArgs),this._DistanceFromIPBinding=new n.DistanceFromIP.Binding(s,t,a,this,a.wrapperDistanceFromIPInitArgs()),this._FloatingMenuBinding=new n.FloatingMenu.Binding(s,t,a,this,a.wrapperFloatingMenuInitArgs(),a.wrapperFloatingMenuArgs),this._FocusableBinding=a.focusableBinding=new i.Focusable.Binding(s,t,a,this,a.FocusableInitArgs()),this._AttrBinding=new i.Attr.Binding(s,t,a,this,a.wrapperAttrArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);var l=a.dropTargetOverlayArgs();l&&this.addChild(new TDB.NewSubTemplateInstructionVE(a,TDB.immutableWatchable(l),"dropTargetOverlayVE"),s,null),this.addChild(new e.CifPlaceholderCardWrapper(a),s,null),this._addToDom(t,r)},r.prototype.onUpdate=function(e){this._StyleBinding.update(e),this._CssBinding.update(e),this._ScrollIntoViewBinding.update(e),this._FloatingMenuBinding.update(e),this._FocusableBinding.update(e),this._AttrBinding.update(e)},r.prototype.disposeBindings=function(){this._DistanceFromIPBinding.dispose(),this._FloatingMenuBinding.dispose(),this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},r}(TDB.ViewElement);e.Cwrapper=r;var a=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifPlaceholderCardWrapperArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C1(o),t,n)},n}(TDB.IfInstructionVE);e.CifPlaceholderCardWrapper=a;var s=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="PlaceholderCardWrapper";var r=o.iconArgs();r&&this.addChild(r.build(o),i,null),this.addChild(new e.Ctext(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=s;var l=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="PlaceholderCardText UnselectableText segoeUISemilight",this._TextBinding=new i.Text.Binding(o,e,n,this,n.textTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.Ctext=l}(Xe||(Xe={}));var Ze=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.contentCards=TDB.methodNewForeachState(o,o.contentCardsArgs),o.jack=TDB.methodNewSubtemplateState(o,o.jackArgs),o}return __extends(t,e),t.prototype._create=function(e,t){var n=this;n.ifSocketLabelArgs()&&this.addChild(new Pe.CsocketLabel(n),e,t),this.addChild(new Ye.CifCardWrapper(n),e,t),this.addChild(new Ye.CifTeaserMode(n),e,t)},t}(t.SetCardVEBase);t.SetCardVE=Ze;var Ye;!function(e){var t=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifCardWrapperArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.Cwrapper(o),t,n),this.addChild(new e.CbottomTweenerWrapper(o),t,n)},n}(TDB.IfInstructionVE);e.CifCardWrapper=t;var r=function(t){function r(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(r,t),r.prototype._create=function(t,r){var a=this._context,s=document.createElement("div");this.domElement=s,s._context=a,s.className="SetCard",this._AttrBinding=new i.Attr.Binding(s,t,a,this,a.wrapperAttrArgs),this._CssBinding=new i.Css.Binding(s,t,a,this,a.wrapperCssArgs),this._ScrollIntoViewBinding=new o.ScrollIntoView.Binding(s,t,a,this,a.wrapperScrollIntoViewInitArgs(),a.wrapperScrollIntoViewArgs),this._DraggableBinding=new i.Draggable.Binding(s,t,a,this,a.wrapperDraggableInitArgs(),a.wrapperDraggableOptionsArgs),this._StyleBinding=new i.Style.Binding(s,t,a,this,a.wrapperStyleArgs),this._DistanceFromIPBinding=new n.DistanceFromIP.Binding(s,t,a,this,a.wrapperDistanceFromIPInitArgs()),this._FloatingMenuBinding=new n.FloatingMenu.Binding(s,t,a,this,a.wrapperFloatingMenuInitArgs(),a.wrapperFloatingMenuArgs),this._FocusableBinding=a.focusableBinding=new i.Focusable.Binding(s,t,a,this,a.FocusableInitArgs()),this._EventsBinding=new i.Events.Binding(s,t,a,this,a.wrapperEventsInitArgs()),this._TouchToMouseBinding=new o.TouchToMouse.Binding(s,t,a,this,a.wrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new Pe.CifCardCopyAvailable(a),s,null);var l=a.headerArgs();l&&this.addChild(l.build(a),s,null);var c=TDB.watcherTag(17323653,a,null,a.cardSelectionOverlayArgs),d=new TDB.NewSubTemplateInstructionVE(a,c,"_selectionStatus");d.addResource(c),this.addChild(d,s,null);c=TDB.watcherTag(17323653,a,null,a.menuArgs);(d=new TDB.NewSubTemplateInstructionVE(a,c,"_menu")).addResource(c),this.addChild(d,s,null),(l=a.topTweenerArgs())&&this.addChild(l.build(a),s,null),this.addChild(new e.CstackWrapper(a),s,null);c=TDB.watcherTag(17323653,a,null,a.sidebarArgs);(d=new TDB.NewSubTemplateInstructionVE(a,c)).addResource(c),this.addChild(d,s,null);c=TDB.watcherTag(17323653,a,null,a.selectionBarArgs);(d=new TDB.NewSubTemplateInstructionVE(a,c,"_selectionBar")).addResource(c),this.addChild(d,s,null);var u=a.jack;this.addChild(new TDB.NewSubTemplateInstructionVE(a,u.raw(),void 0,u),s,null);c=TDB.watcherTag(17323653,a,null,a.authorsListArgs);(d=new TDB.NewSubTemplateInstructionVE(a,c)).addResource(c),this.addChild(d,s,null),this._addToDom(t,r)},r.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._CssBinding.update(e),this._ScrollIntoViewBinding.update(e),this._DraggableBinding.update(e),this._StyleBinding.update(e),this._FloatingMenuBinding.update(e),this._FocusableBinding.update(e),this._TouchToMouseBinding.update(e)},r.prototype.disposeBindings=function(){this._DraggableBinding.dispose(),this._DistanceFromIPBinding.dispose(),this._FloatingMenuBinding.dispose(),this._FocusableBinding.dispose(),this._EventsBinding.dispose(),this._TouchToMouseBinding.dispose(),this._context.focusableBinding=void 0},r}(TDB.ViewElement);e.Cwrapper=r;var a=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="CardStackWrapper",this._CssBinding=new i.Css.Binding(r,t,o,this,o.stackWrapperCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.CcollapseCard(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._CssBinding.update(e)},n}(TDB.ViewElement);e.CstackWrapper=a;var s=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,this._CssBinding=new i.Css.Binding(r,t,o,this,o.collapseCardCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);var a=TDB.watcherTag(17323653,o,null,o.dropTargetOverlayArgs),s=new TDB.NewSubTemplateInstructionVE(o,a);s.addResource(a),this.addChild(s,r,null),this.addChild(new e.CcontentWrapper(o),r,null),this.addChild(new e.CifSmallSpacer(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._CssBinding.update(e)},n}(TDB.ViewElement);e.CcollapseCard=s;var l=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,this._CssBinding=new i.Css.Binding(r,t,o,this,o.contentWrapperCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);var a=o.contentCards;this.addChild(new TDB.NewForeachInstructionVE(o,a.raw(),void 0,a),r,null),this.addChild(new e.CifPlaceholderCard1(o),r,null),this.addChild(new e.CifPlaceholderCard2(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._CssBinding.update(e)},n}(TDB.ViewElement);e.CcontentWrapper=l;var c=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifPlaceholderCard1Args);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C1(o),t,n)},n}(TDB.IfInstructionVE);e.CifPlaceholderCard1=c;var d=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ContainerPlaceholderWrapper ContainerPlaceholderWrapperExpanded BasicCardTeaser";var i=n.placeholderCard1Args();i&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(i),"placeholderCard1"),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=d;var u=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifPlaceholderCard2Args);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C2(o),t,n)},n}(TDB.IfInstructionVE);e.CifPlaceholderCard2=u;var p=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ContainerPlaceholderWrapper ContainerPlaceholderWrapperExpanded BasicCardTeaser";var i=n.placeholderCard2Args();i&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(i),"placeholderCard2"),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C2=p;var g=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifSmallSpacerArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C3(o),t,n)},n}(TDB.IfInstructionVE);e.CifSmallSpacer=g;var h=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="SetCardSmallSpacer",this._addToDom(e,t)},t}(TDB.ViewElement);e.C3=h;var C=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,this._CssBinding=new i.Css.Binding(o,e,n,this,n.bottomTweenerWrapperCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);var r=n.bottomTweenerArgs();r&&this.addChild(r.build(n),o,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._CssBinding.update(e)},t}(TDB.ViewElement);e.CbottomTweenerWrapper=C;var f=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifTeaserModeArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C4(o),t,n)},n}(TDB.IfInstructionVE);e.CifTeaserMode=f;var m=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="SetCardThumbWrapper BasicCardTeaser";this.addChild(new e.C5(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C4=m;var y=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="SetCardThumb";this.addChild(new e.C6(o),i,null),this.addChild(new e.C7(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C5=y;var v=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="OverlayIconText";var i=n.thumbSetCardIconArgs();i&&this.addChild(i.build(n),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C6=v;var S=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="OverlayLabelWrapper";this.addChild(new e.CthumbSetCardText(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C7=S;var T=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="SetCardThumbText OverlayLabelText UnselectableText",this._TextBinding=new i.Text.Binding(o,e,n,this,n.thumbSetCardTextTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CthumbSetCardText=T}(Ye||(Ye={}));var et=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.jack=TDB.methodNewSubtemplateState(o,o.jackArgs),o}return __extends(t,e),t.prototype._create=function(e,t){var n=this;if(n.ifSocketLabelArgs()&&this.addChild(new Pe.CsocketLabel(n),e,t),this.addChild(new tt.Cwrapper(n),e,t),n.ifShowTweenerArgs()){var o=n.tweenerArgs();o&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"_tweener"),e,t)}},t}(t.StatusUpdateCardVEBase);t.StatusUpdateCardVE=et;var tt;!function(e){var t=function(t){function r(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(r,t),r.prototype._create=function(t,r){var a=this._context,s=document.createElement("div");this.domElement=s,s._context=a,s.className="BasicCard CaptionLabeledCard",this._AttrBinding=new i.Attr.Binding(s,t,a,this,a.wrapperAttrArgs),this._DraggableBinding=new i.Draggable.Binding(s,t,a,this,a.wrapperDraggableInitArgs(),a.wrapperDraggableOptionsArgs),this._StyleBinding=new i.Style.Binding(s,t,a,this,a.wrapperStyleArgs),this._CssBinding=new i.Css.Binding(s,t,a,this,a.wrapperCssArgs),this._ScrollIntoViewBinding=new o.ScrollIntoView.Binding(s,t,a,this,a.wrapperScrollIntoViewInitArgs(),a.wrapperScrollIntoViewArgs),this._DistanceFromIPBinding=new n.DistanceFromIP.Binding(s,t,a,this,a.wrapperDistanceFromIPInitArgs()),this._FloatingMenuBinding=new n.FloatingMenu.Binding(s,t,a,this,a.wrapperFloatingMenuInitArgs(),a.wrapperFloatingMenuArgs),this._FocusableBinding=a.focusableBinding=new i.Focusable.Binding(s,t,a,this,a.FocusableInitArgs()),this._EventsBinding=new i.Events.Binding(s,t,a,this,a.wrapperEventsInitArgs()),this._TouchToMouseBinding=new o.TouchToMouse.Binding(s,t,a,this,a.wrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new Pe.CifCardCopyAvailable(a),s,null);var l=TDB.watcherTag(17323653,a,null,a.cardSelectionOverlayArgs),c=new TDB.NewSubTemplateInstructionVE(a,l,"_selectionStatus");c.addResource(l),this.addChild(c,s,null);var d=a.dropTargetOverlayArgs();d&&this.addChild(d.build(a),s,null);l=TDB.watcherTag(17323653,a,null,a.sidebarArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l)).addResource(l),this.addChild(c,s,null),this.addChild(new e.CthumbnailPane(a),s,null);l=TDB.watcherTag(17323653,a,null,a.labelArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l)).addResource(l),this.addChild(c,s,null);l=TDB.watcherTag(17323653,a,null,a.menuArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l,"_menu")).addResource(l),this.addChild(c,s,null),this.addChild(new e.CifStatusUpdateContent(a),s,null);l=TDB.watcherTag(17323653,a,null,a.selectionBarArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l,"_selectionBar")).addResource(l),this.addChild(c,s,null);var u=a.jack;this.addChild(new TDB.NewSubTemplateInstructionVE(a,u.raw(),void 0,u),s,null);l=TDB.watcherTag(17323653,a,null,a.authorsListArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l)).addResource(l),this.addChild(c,s,null),this._addToDom(t,r)},r.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._DraggableBinding.update(e),this._StyleBinding.update(e),this._CssBinding.update(e),this._ScrollIntoViewBinding.update(e),this._FloatingMenuBinding.update(e),this._FocusableBinding.update(e),this._TouchToMouseBinding.update(e)},r.prototype.disposeBindings=function(){this._DraggableBinding.dispose(),this._DistanceFromIPBinding.dispose(),this._FloatingMenuBinding.dispose(),this._FocusableBinding.dispose(),this._EventsBinding.dispose(),this._TouchToMouseBinding.dispose(),this._context.focusableBinding=void 0},r}(TDB.ViewElement);e.Cwrapper=t;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var i=this._context,r=document.createElement("div");this.domElement=r,r._context=i,r.className="ThumbnailPane",this._TouchToMouseBinding=new o.TouchToMouse.Binding(r,t,i,this,i.thumbnailPaneTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new We.CifThumbnailOverlay(i),r,null),this.addChild(new $e.CifOverlayIcon(i),r,null),this.addChild(new e.CimageWrapper(i),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._TouchToMouseBinding.update(e)},n.prototype.disposeBindings=function(){this._TouchToMouseBinding.dispose()},n}(TDB.ViewElement);e.CthumbnailPane=r;var a=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var r=this._context,a=document.createElement("div");this.domElement=a,a._context=r,a.className="StatusUpdateCardImageWrapper ThumbnailFrame",this._CssBinding=new i.Css.Binding(a,t,r,this,r.imageWrapperCssArgs),this._TouchToMouseBinding=new o.TouchToMouse.Binding(a,t,r,this,r.imageWrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);switch(this.addChild(new e.C3(r),a,null),r.ifSupportsObjectFitArgs()){case!0:this.addChild(new e.CbodyImage(r),a,null);break;case!1:this.addChild(new e.CimageDiv(r),a,null)}this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._CssBinding.update(e),this._TouchToMouseBinding.update(e)},n.prototype.disposeBindings=function(){this._TouchToMouseBinding.dispose()},n}(TDB.ViewElement);e.CimageWrapper=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="StatusUpdateBackground",this._addToDom(e,t)},t}(TDB.ViewElement);e.C3=s;var l=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("img");this.domElement=o,o._context=n,o.className="MediaCardImage",this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.bodyImageAttrArgs),this._VisibleBinding=new i.Visible.Binding(o,e,n,this,n.bodyImageVisibleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._VisibleBinding.update(e)},t}(TDB.ViewElement);e.CbodyImage=l;var c=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ImageDiv",o.setAttribute("role","img"),this._StyleBinding=new i.Style.Binding(o,e,n,this,n.imageDivStyleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e)},t}(TDB.ViewElement);e.CimageDiv=c;var d=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifStatusUpdateContentArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CcontentWrapper(o),t,n)},n}(TDB.IfInstructionVE);e.CifStatusUpdateContent=d;var u=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="StatusUpdateContentWrapper",this._CssBinding=new i.Css.Binding(r,t,o,this,o.contentWrapperCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.Cbody(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._CssBinding.update(e)},n}(TDB.ViewElement);e.CcontentWrapper=u;var p=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="StatusUpdateBody",this._TextBinding=new i.Text.Binding(o,e,n,this,n.bodyTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.Cbody=p}(tt||(tt={}));var nt=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.jack=TDB.methodNewSubtemplateState(o,o.jackArgs),o}return __extends(t,e),t.prototype._create=function(e,t){var n=this;if(n.ifSocketLabelArgs()&&this.addChild(new Pe.CsocketLabel(n),e,t),this.addChild(new ot.Cwrapper(n),e,t),n.ifShowTweenerArgs()){var o=n.tweenerArgs();o&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"_tweener"),e,t)}},t}(t.TextCardVEBase);t.TextCardVE=nt;var ot;!function(e){var t=function(t){function r(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(r,t),r.prototype._create=function(t,r){var a=this._context,s=document.createElement("div");this.domElement=s,s._context=a,s.className="BasicCard LabeledCard TextCard",this._AttrBinding=new i.Attr.Binding(s,t,a,this,a.wrapperAttrArgs),this._DraggableBinding=new i.Draggable.Binding(s,t,a,this,a.wrapperDraggableInitArgs(),a.wrapperDraggableOptionsArgs),this._StyleBinding=new i.Style.Binding(s,t,a,this,a.wrapperStyleArgs),this._CssBinding=new i.Css.Binding(s,t,a,this,a.wrapperCssArgs),this._ScrollIntoViewBinding=new o.ScrollIntoView.Binding(s,t,a,this,a.wrapperScrollIntoViewInitArgs(),a.wrapperScrollIntoViewArgs),this._DistanceFromIPBinding=new n.DistanceFromIP.Binding(s,t,a,this,a.wrapperDistanceFromIPInitArgs()),this._FloatingMenuBinding=new n.FloatingMenu.Binding(s,t,a,this,a.wrapperFloatingMenuInitArgs(),a.wrapperFloatingMenuArgs),this._FocusableBinding=a.focusableBinding=new i.Focusable.Binding(s,t,a,this,a.FocusableInitArgs()),this._EventsBinding=new i.Events.Binding(s,t,a,this,a.wrapperEventsInitArgs()),this._TouchToMouseBinding=new o.TouchToMouse.Binding(s,t,a,this,a.wrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);var l=TDB.watcherTag(17323653,a,null,a.pullquoteFreArgs),c=new TDB.NewSubTemplateInstructionVE(a,l);c.addResource(l),this.addChild(c,s,null),this.addChild(new Pe.CifCardCopyAvailable(a),s,null);l=TDB.watcherTag(17323653,a,null,a.cardSelectionOverlayArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l,"_selectionStatus")).addResource(l),this.addChild(c,s,null),this.addChild(new e.CifTeaserOverlay(a),s,null);l=TDB.watcherTag(17323653,a,null,a.menuArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l,"_menu")).addResource(l),this.addChild(c,s,null);l=TDB.watcherTag(17323653,a,null,a.sidebarArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l)).addResource(l),this.addChild(c,s,null),this.addChild(new Re.CcardLabelWrapper(a),s,null);l=TDB.watcherTag(17323653,a,null,a.labelArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l)).addResource(l),this.addChild(c,s,null),this.addChild(new e.CcontentWrapper(a),s,null),this.addChild(new e.CshouldTrackPosition(a),s,null);l=TDB.watcherTag(17323653,a,null,a.selectionBarArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l,"_selectionBar")).addResource(l),this.addChild(c,s,null);l=TDB.watcherTag(17323653,a,null,a.hintCalloutArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l)).addResource(l),this.addChild(c,s,null),this.addChild(new e.CauthoringHintWrapper(a),s,null);var d=a.jack;this.addChild(new TDB.NewSubTemplateInstructionVE(a,d.raw(),void 0,d),s,null);l=TDB.watcherTag(17323653,a,null,a.authorsListArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l)).addResource(l),this.addChild(c,s,null),this._addToDom(t,r)},r.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._DraggableBinding.update(e),this._StyleBinding.update(e),this._CssBinding.update(e),this._ScrollIntoViewBinding.update(e),this._FloatingMenuBinding.update(e),this._FocusableBinding.update(e),this._TouchToMouseBinding.update(e)},r.prototype.disposeBindings=function(){this._DraggableBinding.dispose(),this._DistanceFromIPBinding.dispose(),this._FloatingMenuBinding.dispose(),this._FocusableBinding.dispose(),this._EventsBinding.dispose(),this._TouchToMouseBinding.dispose(),this._context.focusableBinding=void 0},r}(TDB.ViewElement);e.Cwrapper=t;var r=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifTeaserOverlayArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.Coverlay(o),t,n)},n}(TDB.IfInstructionVE);e.CifTeaserOverlay=r;var a=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="TextOverlay",this._CssBinding=new i.Css.Binding(r,t,o,this,o.overlayCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.CifPlaceholder(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._CssBinding.update(e)},n}(TDB.ViewElement);e.Coverlay=a;var s=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifPlaceholderArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C1(o),t,n),this.addChild(new Pe.C3(o),t,n)},n}(TDB.IfInstructionVE);e.CifPlaceholder=s;var l=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="OverlayIconTextCollapsed";var i=n.placeholderIconArgs();i&&this.addChild(i.build(n),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=l;var c=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.setAttribute("style","padding-bottom: 32px;"),this._CssBinding=new i.Css.Binding(r,t,o,this,o.contentWrapperCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.CtextOverlay(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._CssBinding.update(e)},n}(TDB.ViewElement);e.CcontentWrapper=c;var d=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,this._VisibleBinding=new i.Visible.Binding(r,e,n,this,n.textOverlayVisibleArgs),this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.textOverlayClassNameArgs);var a=n.textArgs();a&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(a),"_textControl"),r,null),this.addChild(new qe.C2(n),r,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._VisibleBinding.update(e),this._ClassNameBinding.update(e)},t}(TDB.ViewElement);e.CtextOverlay=d;var u=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.shouldTrackPositionArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CpositionTracker(o),t,n)},n}(TDB.IfInstructionVE);e.CshouldTrackPosition=u;var p=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,i=document.createElement("div");this.domElement=i,i._context=n,i.className="positionTracker",this._InViewportWatcherBinding=new o.InViewportWatcher.Binding(i,e,n,this,n.positionTrackerInViewportWatcherInitArgs()),this._addToDom(e,t)},t.prototype.disposeBindings=function(){this._InViewportWatcherBinding.dispose()},t}(TDB.ViewElement);e.CpositionTracker=p;var g=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="AuthoringHintWrapper",this._VisibleBinding=new i.Visible.Binding(o,e,n,this,n.authoringHintWrapperVisibleArgs);var r=TDB.watcherTag(17323653,n,null,n.closeButtonArgs),a=new TDB.NewSubTemplateInstructionVE(n,r);a.addResource(r),this.addChild(a,o,null),this.addChild(new qe.CauthoringHint(n),o,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._VisibleBinding.update(e)},t}(TDB.ViewElement);e.CauthoringHintWrapper=g}(ot||(ot={}));var it=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.jack=TDB.methodNewSubtemplateState(o,o.jackArgs),o}return __extends(t,e),t.prototype._create=function(e,t){var n=this;if(n.ifSocketLabelArgs()&&this.addChild(new Pe.CsocketLabel(n),e,t),this.addChild(new rt.Cwrapper(n),e,t),n.ifShowTweenerArgs()){var o=n.tweenerArgs();o&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"_tweener"),e,t)}},t}(t.VideoCardVEBase);t.VideoCardVE=it;var rt;!function(e){var t=function(t){function r(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(r,t),r.prototype._create=function(t,r){var a=this._context,s=document.createElement("div");this.domElement=s,s._context=a,s.className="BasicCard CaptionLabeledCard segoeUISemilight",this._AttrBinding=new i.Attr.Binding(s,t,a,this,a.wrapperAttrArgs),this._DraggableBinding=new i.Draggable.Binding(s,t,a,this,a.wrapperDraggableInitArgs(),a.wrapperDraggableOptionsArgs),this._StyleBinding=new i.Style.Binding(s,t,a,this,a.wrapperStyleArgs),this._CssBinding=new i.Css.Binding(s,t,a,this,a.wrapperCssArgs),this._ScrollIntoViewBinding=new o.ScrollIntoView.Binding(s,t,a,this,a.wrapperScrollIntoViewInitArgs(),a.wrapperScrollIntoViewArgs),this._DistanceFromIPBinding=new n.DistanceFromIP.Binding(s,t,a,this,a.wrapperDistanceFromIPInitArgs()),this._FloatingMenuBinding=new n.FloatingMenu.Binding(s,t,a,this,a.wrapperFloatingMenuInitArgs(),a.wrapperFloatingMenuArgs),this._FocusableBinding=a.focusableBinding=new i.Focusable.Binding(s,t,a,this,a.FocusableInitArgs()),this._EventsBinding=new i.Events.Binding(s,t,a,this,a.wrapperEventsInitArgs()),this._TouchToMouseBinding=new o.TouchToMouse.Binding(s,t,a,this,a.wrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new Pe.CifCardCopyAvailable(a),s,null),this.addChild(new e.CcollapsedOrTeaser(a),s,null);var l=a.jack;this.addChild(new TDB.NewSubTemplateInstructionVE(a,l.raw(),void 0,l),s,null);var c=TDB.watcherTag(17323653,a,null,a.authorsListArgs),d=new TDB.NewSubTemplateInstructionVE(a,c);d.addResource(c),this.addChild(d,s,null);c=TDB.watcherTag(17323653,a,null,a.uploadProgressArgs);(d=new TDB.NewSubTemplateInstructionVE(a,c)).addResource(c),this.addChild(d,s,null),this.addChild(new e.CshowProcessingProgress(a),s,null),this.addChild(new e.CshowTransferProgress(a),s,null),this._addToDom(t,r)},r.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._DraggableBinding.update(e),this._StyleBinding.update(e),this._CssBinding.update(e),this._ScrollIntoViewBinding.update(e),this._FloatingMenuBinding.update(e),this._FocusableBinding.update(e),this._TouchToMouseBinding.update(e)},r.prototype.disposeBindings=function(){this._DraggableBinding.dispose(),this._DistanceFromIPBinding.dispose(),this._FloatingMenuBinding.dispose(),this._FocusableBinding.dispose(),this._EventsBinding.dispose(),this._TouchToMouseBinding.dispose(),this._context.focusableBinding=void 0},r}(TDB.ViewElement);e.Cwrapper=t;var r=function(t){function n(e){var n=this,o=TDB.watcherTag(4519824,e,null,e.collapsedOrTeaserArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n,o){var i=this._context;switch(t){case!0:a=TDB.watcherTag(17323653,i,null,i.cardSelectionOverlayArgs);(s=new TDB.NewSubTemplateInstructionVE(i,a,"_selectionStatus")).addResource(a),this.addChild(s,n,o);var r=i.dropTargetOverlayArgs();r&&this.addChild(r.build(i),n,o);a=TDB.watcherTag(17323653,i,null,i.sidebarArgs);(s=new TDB.NewSubTemplateInstructionVE(i,a)).addResource(a),this.addChild(s,n,o);a=TDB.watcherTag(17323653,i,null,i.cardDetailButtonArgs);(s=new TDB.NewSubTemplateInstructionVE(i,a,"cardDetailButton")).addResource(a),this.addChild(s,n,o),this.addChild(new e.C1(i),n,o);a=TDB.watcherTag(17323653,i,null,i.menuArgs);(s=new TDB.NewSubTemplateInstructionVE(i,a,"_menu")).addResource(a),this.addChild(s,n,o);a=TDB.watcherTag(17323653,i,null,i.labelArgs);(s=new TDB.NewSubTemplateInstructionVE(i,a)).addResource(a),this.addChild(s,n,o),this.addChild(new e.CifStatusMessage(i),n,o),this.addChild(new qe.CifCaptionWrapper(i),n,o);a=TDB.watcherTag(17323653,i,null,i.selectionBarArgs);(s=new TDB.NewSubTemplateInstructionVE(i,a,"_selectionBar")).addResource(a),this.addChild(s,n,o),this.addChild(new qe.CauthoringHintWrapper(i),n,o),this.addChild(new Ne.CifErrorMessage1(i),n,o);break;case!1:var a=TDB.watcherTag(17323653,i,null,i.menuArgs),s=new TDB.NewSubTemplateInstructionVE(i,a,"_menu");s.addResource(a),this.addChild(s,n,o);a=TDB.watcherTag(17323653,i,null,i.cardExpandedViewArgs);(s=new TDB.NewSubTemplateInstructionVE(i,a,"cardExpandedView")).addResource(a),this.addChild(s,n,o)}},n}(TDB.SwitchInstructionVE);e.CcollapsedOrTeaser=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ThumbnailPane";this.addChild(new We.CifThumbnailOverlay(n),o,null),this.addChild(new qe.CimageWrapper(n),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=a;var s=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifStatusMessageArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CstatusMessage(o),t,n)},n}(TDB.IfInstructionVE);e.CifStatusMessage=s;var l=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="MediaCardUpLoadingText",o.setAttribute("aria-live","polite"),this._TextBinding=new i.Text.Binding(o,e,n,this,n.statusMessageTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CstatusMessage=l;var c=function(e){function t(t){var n=this,o=TDB.watcherTag(4543754,t,null,t.showProcessingProgressArgs);return(n=e.call(this,o)||this).addResource(o),n._context=t,n}return __extends(t,e),t.prototype.buildChildren=function(e,t){var n=this._context,o=TDB.watcherTag(17323653,n,null,n.processingProgressArgs),i=new TDB.NewSubTemplateInstructionVE(n,o);i.addResource(o),this.addChild(i,e,t)},t}(TDB.IfInstructionVE);e.CshowProcessingProgress=c;var d=function(e){function t(t){var n=this,o=TDB.watcherTag(4543754,t,null,t.showTransferProgressArgs);return(n=e.call(this,o)||this).addResource(o),n._context=t,n}return __extends(t,e),t.prototype.buildChildren=function(e,t){var n=this._context,o=TDB.watcherTag(17323653,n,null,n.transferProgressArgs),i=new TDB.NewSubTemplateInstructionVE(n,o);i.addResource(o),this.addChild(i,e,t)},t}(TDB.IfInstructionVE);e.CshowTransferProgress=d}(rt||(rt={}));var at=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.jack=TDB.methodNewSubtemplateState(o,o.jackArgs),o}return __extends(t,e),t.prototype._create=function(e,t){var n=this;if(n.ifSocketLabelArgs()&&this.addChild(new Pe.CsocketLabel(n),e,t),this.addChild(new st.Cwrapper(n),e,t),n.ifShowTweenerArgs()){var o=n.tweenerArgs();o&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"_tweener"),e,t)}},t}(t.AudioCardVEBase);t.AudioCardVE=at;var st;!function(e){var t=function(t){function r(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(r,t),r.prototype._create=function(t,r){var a=this._context,s=document.createElement("div");this.domElement=s,s._context=a,s.className="BasicCard CaptionLabeledCard segoeUISemilight",this._AttrBinding=new i.Attr.Binding(s,t,a,this,a.wrapperAttrArgs),this._DraggableBinding=new i.Draggable.Binding(s,t,a,this,a.wrapperDraggableInitArgs(),a.wrapperDraggableOptionsArgs),this._StyleBinding=new i.Style.Binding(s,t,a,this,a.wrapperStyleArgs),this._CssBinding=new i.Css.Binding(s,t,a,this,a.wrapperCssArgs),this._ScrollIntoViewBinding=new o.ScrollIntoView.Binding(s,t,a,this,a.wrapperScrollIntoViewInitArgs(),a.wrapperScrollIntoViewArgs),this._DistanceFromIPBinding=new n.DistanceFromIP.Binding(s,t,a,this,a.wrapperDistanceFromIPInitArgs()),this._FloatingMenuBinding=new n.FloatingMenu.Binding(s,t,a,this,a.wrapperFloatingMenuInitArgs(),a.wrapperFloatingMenuArgs),this._FocusableBinding=a.focusableBinding=new i.Focusable.Binding(s,t,a,this,a.FocusableInitArgs()),this._EventsBinding=new i.Events.Binding(s,t,a,this,a.wrapperEventsInitArgs()),this._TouchToMouseBinding=new o.TouchToMouse.Binding(s,t,a,this,a.wrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new Pe.CifCardCopyAvailable(a),s,null),this.addChild(new e.CcollapsedOrTeaser(a),s,null);var l=a.jack;this.addChild(new TDB.NewSubTemplateInstructionVE(a,l.raw(),void 0,l),s,null);var c=TDB.watcherTag(17323653,a,null,a.authorsListArgs),d=new TDB.NewSubTemplateInstructionVE(a,c);d.addResource(c),this.addChild(d,s,null);c=TDB.watcherTag(17323653,a,null,a.uploadProgressArgs);(d=new TDB.NewSubTemplateInstructionVE(a,c)).addResource(c),this.addChild(d,s,null),this.addChild(new rt.CshowProcessingProgress(a),s,null),this.addChild(new rt.CshowTransferProgress(a),s,null),this._addToDom(t,r)},r.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._DraggableBinding.update(e),this._StyleBinding.update(e),this._CssBinding.update(e),this._ScrollIntoViewBinding.update(e),this._FloatingMenuBinding.update(e),this._FocusableBinding.update(e),this._TouchToMouseBinding.update(e)},r.prototype.disposeBindings=function(){this._DraggableBinding.dispose(),this._DistanceFromIPBinding.dispose(),this._FloatingMenuBinding.dispose(),this._FocusableBinding.dispose(),this._EventsBinding.dispose(),this._TouchToMouseBinding.dispose(),this._context.focusableBinding=void 0},r}(TDB.ViewElement);e.Cwrapper=t;var r=function(e){function t(t){var n=this,o=TDB.watcherTag(4519824,t,null,t.collapsedOrTeaserArgs);return(n=e.call(this,o)||this).addResource(o),n._context=t,n}return __extends(t,e),t.prototype.buildChildren=function(e,t,n){var o=this._context;switch(e){case!0:r=TDB.watcherTag(17323653,o,null,o.cardSelectionOverlayArgs);(a=new TDB.NewSubTemplateInstructionVE(o,r,"_selectionStatus")).addResource(r),this.addChild(a,t,n);var i=o.dropTargetOverlayArgs();i&&this.addChild(i.build(o),t,n);r=TDB.watcherTag(17323653,o,null,o.sidebarArgs);(a=new TDB.NewSubTemplateInstructionVE(o,r)).addResource(r),this.addChild(a,t,n);r=TDB.watcherTag(17323653,o,null,o.cardDetailButtonArgs);(a=new TDB.NewSubTemplateInstructionVE(o,r,"cardDetailButton")).addResource(r),this.addChild(a,t,n),this.addChild(new rt.C1(o),t,n);r=TDB.watcherTag(17323653,o,null,o.menuArgs);(a=new TDB.NewSubTemplateInstructionVE(o,r,"_menu")).addResource(r),this.addChild(a,t,n);r=TDB.watcherTag(17323653,o,null,o.labelArgs);(a=new TDB.NewSubTemplateInstructionVE(o,r)).addResource(r),this.addChild(a,t,n),this.addChild(new rt.CifStatusMessage(o),t,n),this.addChild(new qe.CifCaptionWrapper(o),t,n),this.addChild(new Ne.CifErrorMessage1(o),t,n);r=TDB.watcherTag(17323653,o,null,o.selectionBarArgs);(a=new TDB.NewSubTemplateInstructionVE(o,r,"_selectionBar")).addResource(r),this.addChild(a,t,n);break;case!1:var r=TDB.watcherTag(17323653,o,null,o.menuArgs),a=new TDB.NewSubTemplateInstructionVE(o,r,"_menu");a.addResource(r),this.addChild(a,t,n);r=TDB.watcherTag(17323653,o,null,o.cardExpandedViewArgs);(a=new TDB.NewSubTemplateInstructionVE(o,r,"cardExpandedView")).addResource(r),this.addChild(a,t,n)}},t}(TDB.SwitchInstructionVE);e.CcollapsedOrTeaser=r}(st||(st={}));var lt=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new ct.CisVisible(n),e,t)},t}(t.EmptySocketVEBase);t.EmptySocketVE=lt;var ct;!function(e){var t=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.isVisibleArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CsocketWrapper(o),t,n)},n}(TDB.IfInstructionVE);e.CisVisible=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="PlaceholderSocket",r.setAttribute("role","button"),this._FocusableBinding=o.focusableBinding=new i.Focusable.Binding(r,t,o,this,o.FocusableInitArgs()),this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.socketWrapperAttrArgs);this.addChild(new e.CshowSocketMenu(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._FocusableBinding.update(e),this._AttrBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.CsocketWrapper=n;var o=function(t){function n(e){var n=this,o=TDB.watcherTag(4519824,e,null,e.showSocketMenuArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n,o){var i=this._context;switch(t){case!1:this.addChild(new e.C1(i),n,o);break;case!0:var r=i.socketMenuArgs();r&&this.addChild(new TDB.NewSubTemplateInstructionVE(i,TDB.immutableWatchable(r),"socketMenu"),n,o)}},n}(TDB.SwitchInstructionVE);e.CshowSocketMenu=o;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="SocketPlaceholderCard";this.addChild(new e.C2(o),i,null),this.addChild(new e.Cplaceholder(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="PlaceholderSocketOverlay",this._addToDom(e,t)},t}(TDB.ViewElement);e.C2=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="segoeUIRegular EmptySocketPlaceholderText UnselectableText",this._TextBinding=new i.Text.Binding(o,e,n,this,n.placeholderTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.Cplaceholder=s}(ct||(ct={}));var dt=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new ut.Cwrapper(n),e,t)},t}(t.CardDropTargetOverlayVEBase);t.CardDropTargetOverlayVE=dt;var ut;!function(e){var t=function(t){function i(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(i,t),i.prototype._create=function(t,i){var r=this._context,a=document.createElement("div");this.domElement=a,a._context=r,this._DropTargetBinding=new n.DropTarget.Binding(a,t,r,this,r.wrapperDropTargetInitArgs()),this._ClassNameBinding=new o.ClassName.Binding(a,t,r,this,r.wrapperClassNameArgs),this._TouchToMouseBinding=new o.TouchToMouse.Binding(a,t,r,this,r.wrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.Cforeground(r),a,null),this._addToDom(t,i)},i.prototype.onUpdate=function(e){this._ClassNameBinding.update(e),this._TouchToMouseBinding.update(e)},i.prototype.disposeBindings=function(){this._DropTargetBinding.dispose(),this._TouchToMouseBinding.dispose()},i}(TDB.ViewElement);e.Cwrapper=t;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var r=this._context,a=document.createElement("div");this.domElement=a,a._context=r,a.className="CardDropTargetOverlayForground",this._FadeVisibleBinding=new o.FadeVisible.Binding(a,t,r,this,r.foregroundFadeVisibleInitArgs(),r.foregroundFadeVisibleArgs),this._StyleBinding=new i.Style.Binding(a,t,r,this,r.foregroundStyleArgs);this.addChild(new e.CifCardDropTargetOverlayText(r),a,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._FadeVisibleBinding.update(e),this._StyleBinding.update(e)},n.prototype.disposeBindings=function(){this._FadeVisibleBinding.dispose()},n}(TDB.ViewElement);e.Cforeground=r;var a=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifCardDropTargetOverlayTextArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.Ctext(o),t,n)},n}(TDB.IfInstructionVE);e.CifCardDropTargetOverlayText=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="CardDropTargetOverlayText segoeUISemilight",this._TextBinding=new i.Text.Binding(o,e,n,this,n.textTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.Ctext=s}(ut||(ut={}));var pt=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new gt.CcardLabelWrapper(n),e,t)},t}(t.CardLabelVEBase);t.CardLabelVE=pt;var gt;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="CardLabel segoeUISemibold",this._CssBinding=new i.Css.Binding(r,t,o,this,o.cardLabelWrapperCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.Clabel(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._CssBinding.update(e)},n}(TDB.ViewElement);e.CcardLabelWrapper=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="CardLabelText segoeUISemibold",this._TextBinding=new i.Text.Binding(o,e,n,this,n.labelTextArgs),this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.labelAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e),this._AttrBinding.update(e)},t}(TDB.ViewElement);e.Clabel=n}(gt||(gt={}));var ht=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Ct.Cwrapper(n),e,t)},t}(t.CardMenuVEBase);t.CardMenuVE=ht;var Ct;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var r=this._context,a=document.createElement("div");this.domElement=a,a._context=r,this._FadeVisibleBinding=new o.FadeVisible.Binding(a,t,r,this,r.wrapperFadeVisibleInitArgs(),r.wrapperFadeVisibleArgs),this._StyleBinding=new i.Style.Binding(a,t,r,this,r.wrapperStyleArgs),this._ClassNameBinding=new o.ClassName.Binding(a,t,r,this,r.wrapperClassNameArgs);this.addChild(new e.CinnerWrapper(r),a,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._FadeVisibleBinding.update(e),this._StyleBinding.update(e),this._ClassNameBinding.update(e)},n.prototype.disposeBindings=function(){this._FadeVisibleBinding.dispose()},n}(TDB.ViewElement);e.Cwrapper=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var i=this._context,r=document.createElement("div");this.domElement=r,r._context=i,this._ClassNameBinding=new o.ClassName.Binding(r,t,i,this,i.innerWrapperClassNameArgs),this._DynamicMenuBinding=new o.DynamicMenu.Binding(r,t,i,this,i.innerWrapperDynamicMenuChunksArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.CifEditButtons(i),r,null),this.addChild(new e.CcardButtonsWrapper(i),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._ClassNameBinding.update(e),this._DynamicMenuBinding.update(e)},n.prototype.disposeBindings=function(){this._DynamicMenuBinding.dispose()},n}(TDB.ViewElement);e.CinnerWrapper=n;var r=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifEditButtonsArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CeditButtonsWrapper(o),t,n)},n}(TDB.IfInstructionVE);e.CifEditButtons=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,i=document.createElement("div");this.domElement=i,i._context=n,this._ClassNameBinding=new o.ClassName.Binding(i,e,n,this,n.editButtonsWrapperClassNameArgs);var r=TDB.watcherTag(17323653,n,null,n.selectedCountArgs),a=new TDB.NewSubTemplateInstructionVE(n,r);a.addResource(r),this.addChild(a,i,null);var s=n.cardContentControlsArgs();s&&this.addChild(s.build(n),i,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},t}(TDB.ViewElement);e.CeditButtonsWrapper=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,i=document.createElement("div");this.domElement=i,i._context=n,this._ClassNameBinding=new o.ClassName.Binding(i,e,n,this,n.cardButtonsWrapperClassNameArgs);var r=n.cardControlsArgs();r&&this.addChild(r.build(n),i,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},t}(TDB.ViewElement);e.CcardButtonsWrapper=s}(Ct||(Ct={}));var ft=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new mt.C1(n),e,t)},t}(t.CardProgressBarVEBase);t.CardProgressBarVE=ft;var mt;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="CardProgressWrapper";this.addChild(new e.C2(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="CardProgressBackground";this.addChild(new e.Cprogress(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C2=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="CardProgress",this._StyleBinding=new i.Style.Binding(o,e,n,this,n.progressStyleArgs),this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.progressAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e),this._AttrBinding.update(e)},t}(TDB.ViewElement);e.Cprogress=o}(mt||(mt={}));var yt=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new vt.Cwrapper(n),e,t)},t}(t.CodeMenuVEBase);t.CodeMenuVE=yt;var vt;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="CodeMenu",this._EventsBinding=new i.Events.Binding(o,e,n,this,n.wrapperEventsInitArgs()),this._addToDom(e,t)},t.prototype.disposeBindings=function(){this._EventsBinding.dispose()},t}(TDB.ViewElement);e.Cwrapper=t}(vt||(vt={}));var St=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Tt.Cwrapper(n),e,t)},t}(t.CardSelectionBarVEBase);t.CardSelectionBarVE=St;var Tt;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var i=this._context,r=document.createElement("div");this.domElement=r,r._context=i,this._ClassNameBinding=new o.ClassName.Binding(r,t,i,this,i.wrapperClassNameArgs);this.addChild(new e.Ccheckbox(i),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},n}(TDB.ViewElement);e.Cwrapper=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,this._AttrBinding=new i.Attr.Binding(r,e,n,this,n.checkboxAttrArgs),this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.checkboxClassNameArgs),this._FocusableBinding=n.focusableBinding=new i.Focusable.Binding(r,e,n,this,n.FocusableInitArgs());var a=TDB.watcherTag(17323653,n,null,n.checkmarkArgs),s=new TDB.NewSubTemplateInstructionVE(n,a);s.addResource(a),this.addChild(s,r,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._ClassNameBinding.update(e),this._FocusableBinding.update(e)},t.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},t}(TDB.ViewElement);e.Ccheckbox=n}(Tt||(Tt={}));var wt=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new At.CselectionOverlay(n),e,t)},t}(t.CardSelectionStatusVEBase);t.CardSelectionStatusVE=wt;var At;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="ContentCardSelectionOverlay",this._FocusableBinding=o.focusableBinding=new i.Focusable.Binding(r,t,o,this,o.FocusableInitArgs());this.addChild(new e.CcardSelectionStatus(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._FocusableBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.CselectionOverlay=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="CardSelectionStatusLabel",this._TextBinding=new i.Text.Binding(o,e,n,this,n.cardSelectionStatusTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CcardSelectionStatus=n}(At||(At={}));var Et=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new _t.Cwrapper(n),e,t)},t}(t.CardSidebarVEBase);t.CardSidebarVE=Et;var _t;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,r.className="CardSideBar",this._TouchToMouseBinding=new o.TouchToMouse.Binding(r,e,n,this,n.wrapperTouchToMouseArgs),this._CssBinding=new i.Css.Binding(r,e,n,this,n.wrapperCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TouchToMouseBinding.update(e),this._CssBinding.update(e)},t.prototype.disposeBindings=function(){this._TouchToMouseBinding.dispose()},t}(TDB.ViewElement);e.Cwrapper=t}(_t||(_t={}));var xt=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this,o=TDB.watcherTag(17323653,n,null,n.progressBarArgs),i=new TDB.NewSubTemplateInstructionVE(n,o);i.addResource(o),this.addChild(i,e,t),this.addChild(new Bt.C1(n),e,t)},t}(t.CardUploadProgressVEBase);t.CardUploadProgressVE=xt;var Bt;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="CardProgressWrapper";var i=TDB.watcherTag(17323653,n,null,n.secondaryButtonArgs),r=new TDB.NewSubTemplateInstructionVE(n,i);r.addResource(i),this.addChild(r,o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=t}(Bt||(Bt={}));var bt=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Dt.CifContainerCardHeader(n),e,t)},t}(t.ContainerCardHeaderVEBase);t.ContainerCardHeaderVE=bt;var Dt;!function(e){var t=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifContainerCardHeaderArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.Cbackground(o),t,n),this.addChild(new e.Cheader(o),t,n)},n}(TDB.IfInstructionVE);e.CifContainerCardHeader=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ContainerCardHeaderBackground",this._StyleBinding=new i.Style.Binding(o,e,n,this,n.backgroundStyleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e)},t}(TDB.ViewElement);e.Cbackground=n;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,r.className="ContainerCardHeaderHeader segoeUISemibold",this._CssBinding=new i.Css.Binding(r,e,n,this,n.headerCssArgs),this._TouchToMouseBinding=new o.TouchToMouse.Binding(r,e,n,this,n.headerTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);var a=n.headerButtonArgs();a&&this.addChild(a.build(n),r,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._CssBinding.update(e),this._TouchToMouseBinding.update(e)},t.prototype.disposeBindings=function(){this._TouchToMouseBinding.dispose()},t}(TDB.ViewElement);e.Cheader=r}(Dt||(Dt={}));var Mt=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Vt.ClabelWrapper(n),e,t)},t}(t.ContainerCardLabelVEBase);t.ContainerCardLabelVE=Mt;var Vt;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var i=this._context,r=document.createElement("div");this.domElement=r,r._context=i,this._ClassNameBinding=new o.ClassName.Binding(r,t,i,this,i.labelWrapperClassNameArgs);var a=TDB.watcherTag(17323653,i,null,i.fontIconArgs),s=new TDB.NewSubTemplateInstructionVE(i,a);s.addResource(a),this.addChild(s,r,null),this.addChild(new e.Ctext(i),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},n}(TDB.ViewElement);e.ClabelWrapper=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.textClassNameArgs),this._TextBinding=new i.Text.Binding(r,e,n,this,n.textTextArgs),this._StyleBinding=new i.Style.Binding(r,e,n,this,n.textStyleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._ClassNameBinding.update(e),this._TextBinding.update(e),this._StyleBinding.update(e)},t}(TDB.ViewElement);e.Ctext=n}(Vt||(Vt={}));var It=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Pt.CmenuItemWrapper(n),e,t)},t}(t.EmphasisButtonsFlyoutVEBase);t.EmphasisButtonsFlyoutVE=It;var Pt;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,r.className="EmphasisButtonsOverflowWrapper",this._SlideVisibleBinding=new o.SlideVisible.Binding(r,e,n,this,n.menuItemWrapperSlideVisibleInitArgs(),n.menuItemWrapperSlideVisibleArgs),this._AttrBinding=new i.Attr.Binding(r,e,n,this,n.menuItemWrapperAttrArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);var a=TDB.watcherTag(17323652,n,null,n.menuItemsArgs),s=new TDB.NewForeachInstructionVE(n,a);s.addResource(a),this.addChild(s,r,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._SlideVisibleBinding.update(e),this._AttrBinding.update(e)},t}(TDB.ViewElement);e.CmenuItemWrapper=t}(Pt||(Pt={}));var kt=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Rt.CifEmphasisButtons(n),e,t)},t}(t.EmphasisButtonsVEBase);t.EmphasisButtonsVE=kt;var Rt;!function(e){var t=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifEmphasisButtonsArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C1(o),t,n)},n}(TDB.IfInstructionVE);e.CifEmphasisButtons=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="EmphasisButtonsWrapper";this.addChild(new e.CisEmphasisButtonsOverflow(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=n;var o=function(t){function n(e){var n=this,o=TDB.watcherTag(4519824,e,null,e.isEmphasisButtonsOverflowArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n,o){var i=this._context;switch(t){case!0:var r=i.overflowButtonArgs();r&&this.addChild(new TDB.NewSubTemplateInstructionVE(i,TDB.immutableWatchable(r),"overflowButton"),n,o),(r=i.overflowMenuArgs())&&this.addChild(r.build(i),n,o);break;case!1:this.addChild(new e.CemphasisButtonsRadioGroup(i),n,o)}},n}(TDB.SwitchInstructionVE);e.CisEmphasisButtonsOverflow=o;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.emphasisButtonsRadioGroupAttrArgs);var r=TDB.watcherTag(17323653,n,null,n.strictSizingButtonArgs),a=new TDB.NewSubTemplateInstructionVE(n,r);a.addResource(r),this.addChild(a,o,null);var s=TDB.watcherTag(17323652,n,null,n.emphasisButtonsArgs),l=new TDB.NewForeachInstructionVE(n,s);l.addResource(s),this.addChild(l,o,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e)},t}(TDB.ViewElement);e.CemphasisButtonsRadioGroup=r}(Rt||(Rt={}));var Lt=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Ut.Cwrapper(n),e,t)},t}(t.JackVEBase);t.JackVE=Lt;var Ut;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="JackWrapper",this._StyleBinding=new i.Style.Binding(r,t,o,this,o.wrapperStyleArgs);this.addChild(new e.C1(o),r,null);var a=TDB.watcherTag(17323653,o,null,o.menuArgs),s=new TDB.NewSubTemplateInstructionVE(o,a,"menu");s.addResource(a),this.addChild(s,r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._StyleBinding.update(e)},n}(TDB.ViewElement);e.Cwrapper=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="JackIconWrapper";var i=TDB.watcherTag(17323653,n,null,n.jackIconArgs),r=new TDB.NewSubTemplateInstructionVE(n,i);r.addResource(i),this.addChild(r,o,null);i=TDB.watcherTag(17323653,n,null,n.titleJackCalloutArgs);(r=new TDB.NewSubTemplateInstructionVE(n,i)).addResource(i),this.addChild(r,o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=n}(Ut||(Ut={}));var Ft=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Nt.CifButtonWrapper(n),e,t)},t}(t.JackCardOptionVEBase);t.JackCardOptionVE=Ft;var Nt;!function(e){var t=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifButtonWrapperArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.Cwrapper(o),t,n)},n}(TDB.IfInstructionVE);e.CifButtonWrapper=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var i=this._context,r=document.createElement("div");this.domElement=r,r._context=i,this._ClassNameBinding=new o.ClassName.Binding(r,t,i,this,i.wrapperClassNameArgs);this.addChild(new e.CcardButton(i),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},n}(TDB.ViewElement);e.Cwrapper=n;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var r=this._context,a=document.createElement("button");this.domElement=a,a._context=r,this._AttrBinding=new i.Attr.Binding(a,t,r,this,r.cardButtonAttrArgs),this._FocusableBinding=r.focusableBinding=new i.Focusable.Binding(a,t,r,this,r.FocusableInitArgs()),this._ClassNameBinding=new o.ClassName.Binding(a,t,r,this,r.cardButtonClassNameArgs);this.addChild(new e.CoptionImage(r),a,null),this.addChild(new e.CoptionText(r),a,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._FocusableBinding.update(e),this._ClassNameBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.CcardButton=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,i=document.createElement("div");this.domElement=i,i._context=n,this._ClassNameBinding=new o.ClassName.Binding(i,e,n,this,n.optionImageClassNameArgs);var r=n.cardIconArgs();r&&this.addChild(r.build(n),i,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},t}(TDB.ViewElement);e.CoptionImage=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.optionTextClassNameArgs),this._TextBinding=new i.Text.Binding(r,e,n,this,n.optionTextTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._ClassNameBinding.update(e),this._TextBinding.update(e)},t}(TDB.ViewElement);e.CoptionText=s}(Nt||(Nt={}));var Ot=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;n.ifTriangleArgs()&&this.addChild(new Wt.C1(n),e,t),this.addChild(new Wt.Cwrapper(n),e,t)},t}(t.JackMenuVEBase);t.JackMenuVE=Ot;var Wt;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="JackTriangleContainer";this.addChild(new e.C2(o),i,null),this.addChild(new e.C3(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="JackTriangleBrand",this._addToDom(e,t)},t}(TDB.ViewElement);e.C2=n;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="JackTriangleBackground",this._addToDom(e,t)},t}(TDB.ViewElement);e.C3=r;var a=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var r=this._context,a=document.createElement("div");this.domElement=a,a._context=r,a.className="JackMenu",this._SlideVisibleBinding=new o.SlideVisible.Binding(a,t,r,this,r.wrapperSlideVisibleInitArgs(),r.wrapperSlideVisibleArgs),this._StyleBinding=new i.Style.Binding(a,t,r,this,r.wrapperStyleArgs),this._DynamicMenuBinding=new o.DynamicMenu.Binding(a,t,r,this,r.wrapperDynamicMenuChunksArgs),this._ScrollIntoViewBinding=new o.ScrollIntoView.Binding(a,t,r,this,r.wrapperScrollIntoViewInitArgs(),r.wrapperScrollIntoViewArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);r.ifTabsArgs()&&this.addChild(new e.C4(r),a,null);var s=r.jackCardOptionsWrapperArgs();s&&this.addChild(s.build(r),a,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._SlideVisibleBinding.update(e),this._StyleBinding.update(e),this._DynamicMenuBinding.update(e),this._ScrollIntoViewBinding.update(e)},n.prototype.disposeBindings=function(){this._DynamicMenuBinding.dispose()},n}(TDB.ViewElement);e.Cwrapper=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="JackMenuTabHeader",o.setAttribute("role","tablist");this.addChild(new R.C4(n),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C4=s}(Wt||(Wt={}));var Ht=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;TDB.perfMeasurement("CardDeckVE_create",function(){var o=n;n.addChild(new Gt.C1(o),e,t)})},t}(t.CardDeckVEBase);t.CardDeckVE=Ht;var Gt;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="CardDeck",i.setAttribute("role","main");this.addChild(new e.CcardDeckWrapper(o),i,null);var r=TDB.watcherTag(17323653,o,null,o.calloutArgs),a=new TDB.NewSubTemplateInstructionVE(o,r);a.addResource(r),this.addChild(a,i,null),this.addChild(new e.CcardAuthorsStatus(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="CardDeckWrapper",this._StyleBinding=new i.Style.Binding(r,t,o,this,o.cardDeckWrapperStyleArgs);this.addChild(new e.CcardDeckOverlay(o),r,null),this.addChild(new e.CcardDeckFader(o),r,null),this.addChild(new e.Cheader(o),r,null),this.addChild(new e.CinnerWrapper(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._StyleBinding.update(e)},n}(TDB.ViewElement);e.CcardDeckWrapper=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="CardDeckHiddenOverlay",this._VisibleBinding=new i.Visible.Binding(o,e,n,this,n.cardDeckOverlayVisibleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._VisibleBinding.update(e)},t}(TDB.ViewElement);e.CcardDeckOverlay=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,i=document.createElement("div");this.domElement=i,i._context=n,i.className="CardDeckFader",this._FadeVisibleBinding=new o.FadeVisible.Binding(i,e,n,this,n.cardDeckFaderFadeVisibleInitArgs(),n.cardDeckFaderFadeVisibleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._FadeVisibleBinding.update(e)},t.prototype.disposeBindings=function(){this._FadeVisibleBinding.dispose()},t}(TDB.ViewElement);e.CcardDeckFader=s;var l=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var i=this._context,r=document.createElement("div");this.domElement=r,r._context=i,this._ClassNameBinding=new o.ClassName.Binding(r,t,i,this,i.headerClassNameArgs);this.addChild(new e.CifContentSearchVisible(i),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},n}(TDB.ViewElement);e.Cheader=l;var c=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifContentSearchVisibleArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C2(o),t,n)},n}(TDB.IfInstructionVE);e.CifContentSearchVisible=c;var d=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="authoringSearchContainer";var i=n.contentSearchArgs();i&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(i),"contentSearch"),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C2=d;var u=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.innerWrapperAttrArgs),this._CssBinding=new i.Css.Binding(r,t,o,this,o.innerWrapperCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);var a=TDB.watcherTag(17323653,o,null,o.menuArgs),s=new TDB.NewSubTemplateInstructionVE(o,a);s.addResource(a),this.addChild(s,r,null),this.addChild(new e.CcardsWrapper(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._CssBinding.update(e)},n}(TDB.ViewElement);e.CinnerWrapper=u;var p=function(t){function r(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(r,t),r.prototype._create=function(t,r){var a=this._context,s=document.createElement("div");this.domElement=s,s._context=a,s.id="CardsWrapper",this._ClassNameBinding=new o.ClassName.Binding(s,t,a,this,a.cardsWrapperClassNameArgs),this._DragHandlerBinding=new n.DragHandler.Binding(s,t,a,this,a.cardsWrapperDragHandlerInitArgs()),this._EventsBinding=new i.Events.Binding(s,t,a,this,a.cardsWrapperEventsInitArgs()),this._StyleBinding=new i.Style.Binding(s,t,a,this,a.cardsWrapperStyleArgs);this.addChild(new e.C3(a),s,null),this.addChild(new e.CcardsInnerWrapper(a),s,null),this.addChild(new e.C4(a),s,null),this._addToDom(t,r)},r.prototype.onUpdate=function(e){this._ClassNameBinding.update(e),this._StyleBinding.update(e)},r.prototype.disposeBindings=function(){this._DragHandlerBinding.dispose(),this._EventsBinding.dispose()},r}(TDB.ViewElement);e.CcardsWrapper=p;var g=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.id="CardDeckTop",this._addToDom(e,t)},t}(TDB.ViewElement);e.C3=g;var h=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var i=this._context,r=document.createElement("div");this.domElement=r,r._context=i,r.id="CardDeck",this._ClassNameBinding=new o.ClassName.Binding(r,t,i,this,i.cardsInnerWrapperClassNameArgs);var a=i.rootGroupCardArgs();a&&this.addChild(new TDB.NewSubTemplateInstructionVE(i,TDB.immutableWatchable(a),"rootGroupCard"),r,null),this.addChild(new e.CshowPopularityMetric(i),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},n}(TDB.ViewElement);e.CcardsInnerWrapper=h;var C=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.showPopularityMetricArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CpopularityMetric(o),t,n)},n}(TDB.IfInstructionVE);e.CshowPopularityMetric=C;var f=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var i=this._context,r=document.createElement("div");this.domElement=r,r._context=i,this._ClassNameBinding=new o.ClassName.Binding(r,t,i,this,i.popularityMetricClassNameArgs);this.addChild(new e.CpopularityMetricMessagePrefix(i),r,null),this.addChild(new e.CpopularityMetricNumber(i),r,null),this.addChild(new e.CpopularityMetricMessage(i),r,null);var a=i.popularityMetricIconArgs();a&&this.addChild(a.build(i),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},n}(TDB.ViewElement);e.CpopularityMetric=f;var m=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("span");this.domElement=o,o._context=n,o.className="PopularityMetricMessagePrefixStoryline",this._TextBinding=new i.Text.Binding(o,e,n,this,n.popularityMetricMessagePrefixTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CpopularityMetricMessagePrefix=m;var y=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("span");this.domElement=o,o._context=n,o.className="PopularityMetricNumberStoryline",this._TextBinding=new i.Text.Binding(o,e,n,this,n.popularityMetricNumberTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CpopularityMetricNumber=y;var v=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("span");this.domElement=o,o._context=n,o.className="PopularityMetricMessageStoryline",this._TextBinding=new i.Text.Binding(o,e,n,this,n.popularityMetricMessageTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CpopularityMetricMessage=v;var S=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.id="CardDeckBottom",this._addToDom(e,t)},t}(TDB.ViewElement);e.C4=S;var T=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("span");this.domElement=o,o._context=n,o.setAttribute("aria-live","polite"),o.setAttribute("aria-atomic","true"),o.className="inlineScreenReaderOnly",this._TextBinding=new i.Text.Binding(o,e,n,this,n.cardAuthorsStatusTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CcardAuthorsStatus=T}(Gt||(Gt={}));var zt=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new jt.CifCardWrapper(n),e,t)},t}(t.TweenerVEBase);t.TweenerVE=zt;var jt;!function(e){var t=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifCardWrapperArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.Cwrapper(o),t,n)},n}(TDB.IfInstructionVE);e.CifCardWrapper=t;var i=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var i=this._context,r=document.createElement("div");this.domElement=r,r._context=i,r.className="CardDeckTweenerWrapper",this._ClassNameBinding=new o.ClassName.Binding(r,t,i,this,i.wrapperClassNameArgs);this.addChild(new e.Cinner(i),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},n}(TDB.ViewElement);e.Cwrapper=i;var r=function(t){function i(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(i,t),i.prototype._create=function(t,i){var r=this._context,a=document.createElement("div");this.domElement=a,a._context=r,this._DropTargetBinding=new n.DropTarget.Binding(a,t,r,this,r.innerDropTargetInitArgs()),this._ClassNameBinding=new o.ClassName.Binding(a,t,r,this,r.innerClassNameArgs);this.addChild(new e.ChoverWrapper(r),a,null),this._addToDom(t,i)},i.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},i.prototype.disposeBindings=function(){this._DropTargetBinding.dispose()},i}(TDB.ViewElement);e.Cinner=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,i=document.createElement("div");this.domElement=i,i._context=n,this._ClassNameBinding=new o.ClassName.Binding(i,e,n,this,n.hoverWrapperClassNameArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},t}(TDB.ViewElement);e.ChoverWrapper=a}(jt||(jt={}));var Kt=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this,o=n.paneHeaderArgs();o&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"paneHeader"),e,t),this.addChild(new qt.C1(n),e,t)},t}(t.EditImagePaneVEBase);t.EditImagePaneVE=Kt;var qt;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="EditImagePaneContent";var i=n.focusPaneArgs();i&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(i),"focusPane"),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=t}(qt||(qt={}));var Jt=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new $t.C1(n),e,t),this.addChild(new $t.C4(n),e,t),this.addChild(new $t.CresetAllButtonAdditionalDescription(n),e,t),this.addChild(new $t.CfocusPointAdditionalDescription(n),e,t)},t}(t.FocusPaneVEBase);t.FocusPaneVE=Jt;var $t;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.id="focusPaneEditRegion",i.className="FocusPaneEditRegion";this.addChild(new e.CeditText(o),i,null),this.addChild(new e.C2(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="FocusPaneEditRegionText",this._TextBinding=new i.Text.Binding(o,e,n,this,n.editTextTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CeditText=n;var o=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="FocusPaneImageContainer";var r=o.focusImageArgs();r&&this.addChild(new TDB.NewSubTemplateInstructionVE(o,TDB.immutableWatchable(r),"focusImage"),i,null),this.addChild(new e.CifFocusImageEnabled(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C2=o;var r=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifFocusImageEnabledArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C3(o),t,n)},n}(TDB.IfInstructionVE);e.CifFocusImageEnabled=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="FocusPaneOptions";var i=n.keepEntireCheckboxArgs();i&&this.addChild(i.build(n),o,null),(i=n.resetButtonArgs())&&this.addChild(i.build(n),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C3=a;var s=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.id="focusPanePreviewRegion",i.className="FocusPanePreviewRegion";this.addChild(new e.C5(o),i,null),this.addChild(new e.CpreviewText(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C4=s;var l=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="FocusPanePreviews";this.addChild(new e.CpreviewMobile(o),i,null),this.addChild(new e.CpreviewTablet(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C5=l;var c=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="FocusPanePreviewImageMobile",this._StyleBinding=new i.Style.Binding(r,t,o,this,o.previewMobileStyleArgs);this.addChild(new e.C6(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._StyleBinding.update(e)},n}(TDB.ViewElement);e.CpreviewMobile=c;var d=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="FocusPanePreviewCropAreaMobile";this.addChild(new e.CmobileCrop(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C6=d;var u=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="FocusPanePreviewCroppedImage",this._StyleBinding=new i.Style.Binding(o,e,n,this,n.mobileCropStyleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e)},t}(TDB.ViewElement);e.CmobileCrop=u;var p=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="FocusPanePreviewImageTablet",this._StyleBinding=new i.Style.Binding(r,t,o,this,o.previewTabletStyleArgs);this.addChild(new e.C7(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._StyleBinding.update(e)},n}(TDB.ViewElement);e.CpreviewTablet=p;var g=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="FocusPanePreviewCropAreaTablet";this.addChild(new e.CtabletCrop(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C7=g;var h=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="FocusPanePreviewCroppedImage",this._StyleBinding=new i.Style.Binding(o,e,n,this,n.tabletCropStyleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e)},t}(TDB.ViewElement);e.CtabletCrop=h;var C=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="FocusPanePreviewText",this._TextBinding=new i.Text.Binding(o,e,n,this,n.previewTextTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CpreviewText=C;var f=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("p");this.domElement=o,o._context=n,o.id="resetAllButtonAdditionalDescription",o.className="FocusPaneOffscreenDescription",this._TextBinding=new i.Text.Binding(o,e,n,this,n.resetAllButtonAdditionalDescriptionTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CresetAllButtonAdditionalDescription=f;var m=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("p");this.domElement=o,o._context=n,o.id="focusPointAdditionalDescription",o.className="FocusPaneOffscreenDescription",this._TextBinding=new i.Text.Binding(o,e,n,this,n.focusPointAdditionalDescriptionTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CfocusPointAdditionalDescription=m}($t||($t={}));var Qt=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this,o=TDB.watcherTag(17323652,n,null,n.focusPointsArgs),i=new TDB.NewForeachInstructionVE(n,o,"focusPoints");i.addResource(o),this.addChild(i,e,t),this.addChild(new Xt.CifFocusImageEnabled(n),e,t),this.addChild(new Xt.CfocusPointMovingStatus(n),e,t)},t}(t.FocusImageVEBase);t.FocusImageVE=Qt;var Xt;!function(e){var t=function(t){function n(e){var n=this,o=TDB.watcherTag(4519824,e,null,e.ifFocusImageEnabledArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n,o){var i=this._context;switch(t){case!0:this.addChild(new e.CfocusImageWrapper(i),n,o);break;case!1:this.addChild(new e.C1(i),n,o)}},n}(TDB.SwitchInstructionVE);e.CifFocusImageEnabled=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="FocusPaneImageArea",this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.focusImageWrapperAttrArgs),this._StyleBinding=new i.Style.Binding(r,t,o,this,o.focusImageWrapperStyleArgs),this._FocusableBinding=o.focusableBinding=new i.Focusable.Binding(r,t,o,this,o.FocusableInitArgs());this.addChild(new e.CshowFocusPaneImage(o),r,null),this.addChild(new e.CifFocusPaneImageBorder(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._StyleBinding.update(e),this._FocusableBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.CfocusImageWrapper=n;var o=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.showFocusPaneImageArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CfocusPaneImage(o),t,n)},n}(TDB.IfInstructionVE);e.CshowFocusPaneImage=o;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("img");this.domElement=o,o._context=n,o.className="FocusPaneImage",this._EventsBinding=new i.Events.Binding(o,e,n,this,n.focusPaneImageEventsInitArgs()),this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.focusPaneImageAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e)},t.prototype.disposeBindings=function(){this._EventsBinding.dispose()},t}(TDB.ViewElement);e.CfocusPaneImage=r;var a=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifFocusPaneImageBorderArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CfocusPaneImageBorder(o),t,n)},n}(TDB.IfInstructionVE);e.CifFocusPaneImageBorder=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="FocusPaneImageBorder",this._StyleBinding=new i.Style.Binding(o,e,n,this,n.focusPaneImageBorderStyleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e)},t}(TDB.ViewElement);e.CfocusPaneImageBorder=s;var l=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="FocusPaneSmallImageMessage";this.addChild(new e.CfocusPaneSmallImage(o),i,null),this.addChild(new e.CfocusPaneNotifyText(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=l;var c=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="FocusPaneSmallImage",this._StyleBinding=new i.Style.Binding(o,e,n,this,n.focusPaneSmallImageStyleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e)},t}(TDB.ViewElement);e.CfocusPaneSmallImage=c;var d=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="FocusPaneNotifyText",this._TextBinding=new i.Text.Binding(o,e,n,this,n.focusPaneNotifyTextTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CfocusPaneNotifyText=d;var u=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("p");this.domElement=o,o._context=n,o.setAttribute("aria-live","polite"),o.setAttribute("aria-atomic","true"),o.className="FocusPaneOffscreenDescription",this._TextBinding=new i.Text.Binding(o,e,n,this,n.focusPointMovingStatusTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CfocusPointMovingStatus=u}(Xt||(Xt={}));var Zt=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Yt.CfocusPointCircle(n),e,t)},t}(t.FocusPointVEBase);t.FocusPointVE=Zt;var Yt;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,r.className="FocusPoint",this._AttrBinding=new i.Attr.Binding(r,e,n,this,n.focusPointCircleAttrArgs),this._StyleBinding=new i.Style.Binding(r,e,n,this,n.focusPointCircleStyleArgs),this._DraggableBinding=new i.Draggable.Binding(r,e,n,this,n.focusPointCircleDraggableInitArgs(),n.focusPointCircleDraggableOptionsArgs),this._TouchToMouseBinding=new o.TouchToMouse.Binding(r,e,n,this,n.focusPointCircleTouchToMouseArgs),this._FocusableBinding=n.focusableBinding=new i.Focusable.Binding(r,e,n,this,n.FocusableInitArgs()),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._StyleBinding.update(e),this._DraggableBinding.update(e),this._TouchToMouseBinding.update(e),this._FocusableBinding.update(e)},t.prototype.disposeBindings=function(){this._DraggableBinding.dispose(),this._TouchToMouseBinding.dispose(),this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},t}(TDB.ViewElement);e.CfocusPointCircle=t}(Yt||(Yt={}));var en=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new tn.CstyleHintsWrapper(n),e,t)},t}(t.LayoutChooserVEBase);t.LayoutChooserVE=en;var tn;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,i=document.createElement("div");this.domElement=i,i._context=n,this._ClassNameBinding=new o.ClassName.Binding(i,e,n,this,n.styleHintsWrapperClassNameArgs);var r=TDB.watcherTag(17323653,n,null,n.layoutCarouselArgs),a=new TDB.NewSubTemplateInstructionVE(n,r);a.addResource(r),this.addChild(a,i,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},t}(TDB.ViewElement);e.CstyleHintsWrapper=t}(tn||(tn={}));var nn=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new on.C1(n),e,t)},t}(t.LayoutOptionVEBase);t.LayoutOptionVE=nn;var on;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="LayoutOptionButtonWrapper";this.addChild(new e.CcheckboxWrapper(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="LayoutOptionCheckbox",this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.checkboxWrapperAttrArgs),this._FocusableBinding=o.focusableBinding=new i.Focusable.Binding(r,t,o,this,o.FocusableInitArgs());this.addChild(new e.Cimage(o),r,null),this.addChild(new X.C3(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._FocusableBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.CcheckboxWrapper=n;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("img");this.domElement=r,r._context=n,this._AttrBinding=new i.Attr.Binding(r,e,n,this,n.imageAttrArgs),this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.imageClassNameArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._ClassNameBinding.update(e)},t}(TDB.ViewElement);e.Cimage=r}(on||(on={}));var rn=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new an.C1(n),e,t)},t}(t.LayoutCarouselOptionVEBase);t.LayoutCarouselOptionVE=rn;var an;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="LayoutCarouselOptionButtonWrapper";this.addChild(new e.CcheckboxWrapper(o),i,null),this.addChild(new e.ClayoutOptionLabel(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,this._AttrBinding=new i.Attr.Binding(r,e,n,this,n.checkboxWrapperAttrArgs),this._FocusableBinding=n.focusableBinding=new i.Focusable.Binding(r,e,n,this,n.FocusableInitArgs()),this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.checkboxWrapperClassNameArgs);this.addChild(new on.Cimage(n),r,null),this.addChild(new X.C3(n),r,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._FocusableBinding.update(e),this._ClassNameBinding.update(e)},t.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},t}(TDB.ViewElement);e.CcheckboxWrapper=n;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="LayoutOptionButtonLabel",this._TextBinding=new i.Text.Binding(o,e,n,this,n.layoutOptionLabelTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.ClayoutOptionLabel=r}(an||(an={}));var sn=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;TDB.perfMeasurement("AuthoringPaneVE_create",function(){var o=n;n.addChild(new ln.Cpane(o),e,t)})},t}(t.AuthoringPaneVEBase);t.AuthoringPaneVE=sn;var ln;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,r.setAttribute("role","region"),this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.paneClassNameArgs),this._EventsBinding=new i.Events.Binding(r,e,n,this,n.paneEventsInitArgs()),this._StyleBinding=new i.Style.Binding(r,e,n,this,n.paneStyleArgs),this._AttrBinding=new i.Attr.Binding(r,e,n,this,n.paneAttrArgs),this._FadeVisibleBinding=new o.FadeVisible.Binding(r,e,n,this,n.paneFadeVisibleInitArgs(),n.paneFadeVisibleArgs);var a=n.paneContentArgs();a&&this.addChild(a,r,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._ClassNameBinding.update(e),this._StyleBinding.update(e),this._AttrBinding.update(e),this._FadeVisibleBinding.update(e)},t.prototype.disposeBindings=function(){this._EventsBinding.dispose(),this._FadeVisibleBinding.dispose()},t}(TDB.ViewElement);e.Cpane=t}(ln||(ln={}));var cn=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new dn.Cwrapper(n),e,t)},t}(t.CardOptionVEBase);t.CardOptionVE=cn;var dn;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var r=this._context,a=document.createElement("div");this.domElement=a,a._context=r,a.className="CardOptionWrapper",a.setAttribute("role","presentation"),this._DraggableBinding=new i.Draggable.Binding(a,t,r,this,r.wrapperDraggableInitArgs(),r.wrapperDraggableOptionsArgs),this._TouchToMouseBinding=new o.TouchToMouse.Binding(a,t,r,this,r.wrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.CcardButton(r),a,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._DraggableBinding.update(e),this._TouchToMouseBinding.update(e)},n.prototype.disposeBindings=function(){this._DraggableBinding.dispose(),this._TouchToMouseBinding.dispose()},n}(TDB.ViewElement);e.Cwrapper=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var r=this._context,a=document.createElement("div");this.domElement=a,a._context=r,this._AttrBinding=new i.Attr.Binding(a,t,r,this,r.cardButtonAttrArgs),this._FocusableBinding=r.focusableBinding=new i.Focusable.Binding(a,t,r,this,r.FocusableInitArgs()),this._ClassNameBinding=new o.ClassName.Binding(a,t,r,this,r.cardButtonClassNameArgs);this.addChild(new e.C1(r),a,null),this.addChild(new Nt.CoptionText(r),a,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._FocusableBinding.update(e),this._ClassNameBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.CcardButton=n;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="CardOptionImage";var i=n.cardIconArgs();i&&this.addChild(i.build(n),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=r}(dn||(dn={}));var un=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new pn.C1(n),e,t)},t}(t.PaneHeaderVEBase);t.PaneHeaderVE=un;var pn;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="SidePaneHeader";this.addChild(new e.CheaderTitle(o),i,null);var r=o.closeButtonArgs();r&&this.addChild(new TDB.NewSubTemplateInstructionVE(o,TDB.immutableWatchable(r),"closeButton"),i,null),this.addChild(new oe.C2(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,this._AttrBinding=new i.Attr.Binding(r,e,n,this,n.headerTitleAttrArgs),this._TextBinding=new i.Text.Binding(r,e,n,this,n.headerTitleTextArgs),this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.headerTitleClassNameArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._TextBinding.update(e),this._ClassNameBinding.update(e)},t}(TDB.ViewElement);e.CheaderTitle=n}(pn||(pn={}));var gn=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new hn.C1(n),e,t)},t}(t.StylePaneHeaderVEBase);t.StylePaneHeaderVE=gn;var hn;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="StylePaneHeader";this.addChild(new pn.CheaderTitle(o),i,null),this.addChild(new e.C2(o),i,null);var r=o.closeButtonArgs();r&&this.addChild(new TDB.NewSubTemplateInstructionVE(o,TDB.immutableWatchable(r),"closeButton"),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="StylePaneRemixWrapper";var i=TDB.watcherTag(17323653,n,null,n.remixHeaderArgs),r=new TDB.NewSubTemplateInstructionVE(n,i,"remixHeader");r.addResource(i),this.addChild(r,o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C2=n}(hn||(hn={}));var Cn=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new fn.Cwrapper(n),e,t)},t}(t.RemixDropdownVEBase);t.RemixDropdownVE=Cn;var fn;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var i=this._context,r=document.createElement("div");this.domElement=r,r._context=i,r.className="RemixDropdownWrapper",this._SlideVisibleBinding=new o.SlideVisible.Binding(r,t,i,this,i.wrapperSlideVisibleInitArgs(),i.wrapperSlideVisibleArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.C1(i),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._SlideVisibleBinding.update(e)},n}(TDB.ViewElement);e.Cwrapper=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="RemixDropdownInviteWrapper";this.addChild(new e.CtitleDescription(o),i,null),this.addChild(new e.C2(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=n;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="RemixDropdownTitle",this._TextBinding=new i.Text.Binding(o,e,n,this,n.titleDescriptionTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CtitleDescription=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n;var i=n.designTextBoxArgs();i&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(i),"designTextBox"),o,null),(i=n.designTextButtonArgs())&&this.addChild(i.build(n),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C2=a}(fn||(fn={}));var mn=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new yn.CifHeaderWrapper(n),e,t)},t}(t.RemixHeaderVEBase);t.RemixHeaderVE=mn;var yn;!function(e){var t=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifHeaderWrapperArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.Cwrapper(o),t,n)},n}(TDB.IfInstructionVE);e.CifHeaderWrapper=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,i=document.createElement("div");this.domElement=i,i._context=n,this._ClassNameBinding=new o.ClassName.Binding(i,e,n,this,n.wrapperClassNameArgs);var r=TDB.watcherTag(17323653,n,null,n.calloutArgs),a=new TDB.NewSubTemplateInstructionVE(n,r);a.addResource(r),this.addChild(a,i,null);var s=n.remixButtonArgs();s&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(s),"_remixButton"),i,null),(s=n.remixDropdownArgs())&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(s),"_remixMenu"),i,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},t}(TDB.ViewElement);e.Cwrapper=n}(yn||(yn={}));var vn=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Sn.C1(n),e,t),this.addChild(new Sn.C3(n),e,t),this.addChild(new Sn.C4(n),e,t)},t}(t.StyleCustomizationPaneVEBase);t.StyleCustomizationPaneVE=vn;var Sn;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="DesignPaneSelectionSection";this.addChild(new e.C2(o),i,null);var r=o.backButtonArgs();r&&this.addChild(new TDB.NewSubTemplateInstructionVE(o,TDB.immutableWatchable(r),"backButton"),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="DesignPaneSelectionPreviewClip";this.addChild(new e.CpreviewImage(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C2=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("img");this.domElement=o,o._context=n,o.className="DesignPaneSelectionPreview",this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.previewImageAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e)},t}(TDB.ViewElement);e.CpreviewImage=o;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="StylePaneOptionsWrapper StylePaneCustomizeScroller native-scroller";var i=n.colorChooserArgs();i&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(i),"_colorChooser"),o,null),(i=n.fontSetChooserArgs())&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(i),"_fontSetChooserVE"),o,null),(i=n.animationChooserArgs())&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(i),"_animationChooser"),o,null),(i=n.fontScaleChooserArgs())&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(i),"_fontScaleChooser"),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C3=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="calloutWrapper";var i=TDB.watcherTag(17323653,n,null,n.customColorCalloutArgs),r=new TDB.NewSubTemplateInstructionVE(n,i);r.addResource(i),this.addChild(r,o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C4=a}(Sn||(Sn={}));var Tn=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this,o=n.paneHeaderArgs();o&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"paneHeader"),e,t),this.addChild(new wn.CstyleChooserPane(n),e,t),this.addChild(new wn.CstyleCustomizationPaneWrapper(n),e,t)},t}(t.StylePaneVEBase);t.StylePaneVE=Tn;var wn;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,i=document.createElement("div");this.domElement=i,i._context=n,this._ClassNameBinding=new o.ClassName.Binding(i,e,n,this,n.styleChooserPaneClassNameArgs);var r=n.styleChooserArgs();r&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(r),"styleChooser"),i,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},t}(TDB.ViewElement);e.CstyleChooserPane=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,i=document.createElement("div");this.domElement=i,i._context=n,this._ClassNameBinding=new o.ClassName.Binding(i,e,n,this,n.styleCustomizationPaneWrapperClassNameArgs);var r=TDB.watcherTag(17323653,n,null,n.styleCustomizationPaneArgs),a=new TDB.NewSubTemplateInstructionVE(n,r,"styleCustomizationPane");a.addResource(r),this.addChild(a,i,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},t}(TDB.ViewElement);e.CstyleCustomizationPaneWrapper=n}(wn||(wn={}));var An=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new En.C1(n),e,t)},t}(t.AnimationLevelChooserVEBase);t.AnimationLevelChooserVE=An;var En;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="CustomizeStyleSliderContainer";var r=o.slidebarArgs();r&&this.addChild(new TDB.NewSubTemplateInstructionVE(o,TDB.immutableWatchable(r),"_slidebarVE"),i,null),this.addChild(new e.Cmessage(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.messageAttrArgs),this._StyleBinding=new i.Style.Binding(o,e,n,this,n.messageStyleArgs),this._TextBinding=new i.Text.Binding(o,e,n,this,n.messageTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._StyleBinding.update(e),this._TextBinding.update(e)},t}(TDB.ViewElement);e.Cmessage=n}(En||(En={}));var _n=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new xn.C1(n),e,t)},t}(t.FontScaleChooserVEBase);t.FontScaleChooserVE=_n;var xn;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="CustomizeStyleSliderContainer";var i=n.slidebarArgs();i&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(i),"_slidebarVE"),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=t}(xn||(xn={}));var Bn=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new bn.CColorInspirationHeader(n),e,t);var o=TDB.watcherTag(17323653,n,null,n.colorOptionsCarouselArgs),i=new TDB.NewSubTemplateInstructionVE(n,o,"colorOptionsCarousel");i.addResource(o),this.addChild(i,e,t),this.addChild(new bn.CcustomColorEntryContainerWrapper(n),e,t),this.addChild(new bn.CPaletteChoiceHeader(n),e,t),this.addChild(new bn.CifPaletteChoiceMessage(n),e,t);o=TDB.watcherTag(17323653,n,null,n.colorPalettesCarouselArgs);(i=new TDB.NewSubTemplateInstructionVE(n,o)).addResource(o),this.addChild(i,e,t)},t}(t.ColorChooserVEBase);t.ColorChooserVE=Bn;var bn;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,this._TextBinding=new i.Text.Binding(r,e,n,this,n.ColorInspirationHeaderTextArgs),this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.ColorInspirationHeaderClassNameArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e),this._ClassNameBinding.update(e)},t}(TDB.ViewElement);e.CColorInspirationHeader=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="CustomColorEntryContainerWrapper",this._StyleBinding=new i.Style.Binding(o,e,n,this,n.customColorEntryContainerWrapperStyleArgs);var r=TDB.watcherTag(17323653,n,null,n.customColorEntryArgs),a=new TDB.NewSubTemplateInstructionVE(n,r,"customColorEntry");a.addResource(r),this.addChild(a,o,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e)},t}(TDB.ViewElement);e.CcustomColorEntryContainerWrapper=n;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,this._TextBinding=new i.Text.Binding(r,e,n,this,n.PaletteChoiceHeaderTextArgs),this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.PaletteChoiceHeaderClassNameArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e),this._ClassNameBinding.update(e)},t}(TDB.ViewElement);e.CPaletteChoiceHeader=r;var a=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifPaletteChoiceMessageArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CPaletteChoiceMessage(o),t,n)},n}(TDB.IfInstructionVE);e.CifPaletteChoiceMessage=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,this._TextBinding=new i.Text.Binding(r,e,n,this,n.PaletteChoiceMessageTextArgs),this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.PaletteChoiceMessageClassNameArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e),this._ClassNameBinding.update(e)},t}(TDB.ViewElement);e.CPaletteChoiceMessage=s}(bn||(bn={}));var Dn=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Mn.Cwrapper(n),e,t)},t}(t.ColorDefaultOptionVEBase);t.ColorDefaultOptionVE=Dn;var Mn;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="ColorOption ColorDefaultOption",this._FocusableBinding=o.focusableBinding=new i.Focusable.Binding(r,t,o,this,o.FocusableInitArgs()),this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.wrapperAttrArgs);this.addChild(new e.C1(o),r,null),this.addChild(new e.C2(o),r,null),this.addChild(new e.C3(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._FocusableBinding.update(e),this._AttrBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.Cwrapper=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="ColorDefaultOptionSwatchClip";this.addChild(new e.Cimage(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("img");this.domElement=o,o._context=n,o.className="ColorDefaultOptionSwatchImage",this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.imageAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e)},t}(TDB.ViewElement);e.Cimage=o;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="ColorOptionImmutableLabelBox";this.addChild(new e.Clabel(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C2=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ColorOptionLabel",this._TextBinding=new i.Text.Binding(o,e,n,this,n.labelTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.Clabel=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ComplexGalleryThumbnailInner",this._addToDom(e,t)},t}(TDB.ViewElement);e.C3=s}(Mn||(Mn={}));var Vn=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new In.C1(n),e,t)},t}(t.ColorOptionVEBase);t.ColorOptionVE=Vn;var In;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("li");this.domElement=i,i._context=o,i.className="StyleLayoutOptionListItem",i.setAttribute("role","presentation");this.addChild(new e.Cwrapper(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="ColorOption",this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.wrapperAttrArgs),this._FocusableBinding=o.focusableBinding=new i.Focusable.Binding(r,t,o,this,o.FocusableInitArgs());this.addChild(new e.Cimage(o),r,null),this.addChild(new X.C3(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._FocusableBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.Cwrapper=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("img");this.domElement=o,o._context=n,o.className="ColorOptionImage",this._StyleBinding=new i.Style.Binding(o,e,n,this,n.imageStyleArgs),this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.imageAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e),this._AttrBinding.update(e)},t}(TDB.ViewElement);e.Cimage=o}(In||(In={}));var Pn=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new kn.C1(n),e,t)},t}(t.ColorPaletteVEBase);t.ColorPaletteVE=Pn;var kn;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("li");this.domElement=i,i._context=o,i.className="StyleLayoutOptionListItem",i.setAttribute("role","presentation");this.addChild(new e.Cwrapper(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("button");this.domElement=r,r._context=o,r.className="MoodOption ButtonVE",this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.wrapperAttrArgs),this._FocusableBinding=o.focusableBinding=new i.Focusable.Binding(r,t,o,this,o.FocusableInitArgs());this.addChild(new e.C2(o),r,null),this.addChild(new X.C3(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._FocusableBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.Cwrapper=n;var o=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="MoodOptionClip";this.addChild(new e.Cimage(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C2=o;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("img");this.domElement=o,o._context=n,o.className="MoodOptionImage",this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.imageAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e)},t}(TDB.ViewElement);e.Cimage=r}(kn||(kn={}));var Rn=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this,o=n.dropdownListArgs();o&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"dropdownList"),e,t)},t}(t.FontSetChooserVEBase);t.FontSetChooserVE=Rn;var Ln=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Un.C1(n),e,t)},t}(t.FontSetOptionVEBase);t.FontSetOptionVE=Ln;var Un;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="FontSetOptionMenuItem";this.addChild(new e.Cwrapper(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var r=this._context,a=document.createElement("button");this.domElement=a,a._context=r,this._ClassNameBinding=new o.ClassName.Binding(a,t,r,this,r.wrapperClassNameArgs),this._AttrBinding=new i.Attr.Binding(a,t,r,this,r.wrapperAttrArgs),this._FocusableBinding=r.focusableBinding=new i.Focusable.Binding(a,t,r,this,r.FocusableInitArgs());this.addChild(new e.CfontSetOptionImage(r),a,null);var s=r.chevronIconArgs();s&&this.addChild(s.build(r),a,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._ClassNameBinding.update(e),this._AttrBinding.update(e),this._FocusableBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.Cwrapper=n;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("img");this.domElement=o,o._context=n,o.setAttribute("role","presentation"),this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.fontSetOptionImageAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e)},t}(TDB.ViewElement);e.CfontSetOptionImage=r}(Un||(Un={}));var Fn=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this,o=n.layoutChooserArgs();o&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"layoutChooser"),e,t),this.addChild(new Nn.C1(n),e,t),this.addChild(new Nn.CstylePaneOptionsWrapper(n),e,t)},t}(t.StyleChooserVEBase);t.StyleChooserVE=Fn;var Nn;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="DesignPaneSelectionSection";this.addChild(new e.C2(o),i,null),this.addChild(new e.C3(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="DesignPaneSelectionPreviewClip";this.addChild(new e.CstylePreviewImage(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C2=n;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("img");this.domElement=o,o._context=n,o.className="DesignPaneSelectionPreview",this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.stylePreviewImageAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e)},t}(TDB.ViewElement);e.CstylePreviewImage=r;var a=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="DesignPaneSelectionDescription segoeUI font10";this.addChild(new e.CselectionDescription(o),i,null);var r=o.styleCustomizeButtonArgs();r&&this.addChild(new TDB.NewSubTemplateInstructionVE(o,TDB.immutableWatchable(r),"customizeButton"),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C3=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="DesignPaneSelectionDescriptionText",this._TextBinding=new i.Text.Binding(o,e,n,this,n.selectionDescriptionTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CselectionDescription=s;var l=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var i=this._context,r=document.createElement("div");this.domElement=r,r._context=i,this._ClassNameBinding=new o.ClassName.Binding(r,t,i,this,i.stylePaneOptionsWrapperClassNameArgs);this.addChild(new e.CstylePaneOptionsWrapperLoading(i),r,null),this.addChild(new TDB.ForeachInstructionVE(!0,i.styleOptionCarouselsArgs()),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},n}(TDB.ViewElement);e.CstylePaneOptionsWrapper=l;var c=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.stylePaneOptionsWrapperLoadingClassNameArgs),this._TextBinding=new i.Text.Binding(r,e,n,this,n.stylePaneOptionsWrapperLoadingTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._ClassNameBinding.update(e),this._TextBinding.update(e)},t}(TDB.ViewElement);e.CstylePaneOptionsWrapperLoading=c}(Nn||(Nn={}));var On=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new kn.C1(n),e,t)},t}(t.StyleOptionVEBase);t.StyleOptionVE=On;var Wn=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Hn.CdisplayTextBoxLabel(n),e,t);var o=n.displayTextBoxArgs();o&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"_displayTextBox"),e,t),this.addChild(new Hn.ClinkTextBoxLabel(n),e,t),(o=n.linkTextBoxArgs())&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"_linkTextBox"),e,t),this.addChild(new Hn.ClinkErrorBody(n),e,t),(o=n.removeLinkButtonArgs())&&this.addChild(o.build(n),e,t)},t}(t.TextLinkDialogContentVEBase);t.TextLinkDialogContentVE=Wn;var Hn;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="TextLinkInputBoxLabel",this._TextBinding=new i.Text.Binding(o,e,n,this,n.displayTextBoxLabelTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CdisplayTextBoxLabel=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="TextLinkInputBoxLabel",this._TextBinding=new i.Text.Binding(o,e,n,this,n.linkTextBoxLabelTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.ClinkTextBoxLabel=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="TextLinkErrorBody",this._TextBinding=new i.Text.Binding(o,e,n,this,n.linkErrorBodyTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.ClinkErrorBody=o}(Hn||(Hn={}));var Gn=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this,o=n.paneHeaderArgs();o&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"paneHeader"),e,t),this.addChild(new zn.C1(n),e,t)},t}(t.TransformChooserVEBase);t.TransformChooserVE=Gn;var zn;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="TransformWrapper native-scroller";this.addChild(new e.CtransformChooserOptionsWrapper(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="TransformChooserOptionsWrapper native-scroller",r.setAttribute("role","radiogroup"),this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.transformChooserOptionsWrapperAttrArgs);this.addChild(new e.C2(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e)},n}(TDB.ViewElement);e.CtransformChooserOptionsWrapper=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n;var i=TDB.watcherTag(17323652,n,null,n.transformOptionsArgs),r=new TDB.NewForeachInstructionVE(n,i,"transformOptions");r.addResource(i),this.addChild(r,o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C2=o}(zn||(zn={}));var jn=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Kn.CtransformOptionWrapper(n),e,t)},t}(t.TransformOptionVEBase);t.TransformOptionVE=jn;var Kn;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var i=this._context,r=document.createElement("div");this.domElement=r,r._context=i,this._ClassNameBinding=new o.ClassName.Binding(r,t,i,this,i.transformOptionWrapperClassNameArgs);this.addChild(new e.Ctitle(i),r,null),this.addChild(new e.CcheckboxWrapper(i),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},n}(TDB.ViewElement);e.CtransformOptionWrapper=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,this._TextBinding=new i.Text.Binding(r,e,n,this,n.titleTextArgs),this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.titleClassNameArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e),this._ClassNameBinding.update(e)},t}(TDB.ViewElement);e.Ctitle=n;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="TransformOptionCheckbox",this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.checkboxWrapperAttrArgs),this._FocusableBinding=o.focusableBinding=new i.Focusable.Binding(r,t,o,this,o.FocusableInitArgs());this.addChild(new e.Cimage(o),r,null),this.addChild(new X.C3(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._FocusableBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.CcheckboxWrapper=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("img");this.domElement=o,o._context=n,o.className="TransformOptionImage",this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.imageAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e)},t}(TDB.ViewElement);e.Cimage=a}(Kn||(Kn={}));var qn=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Jn.C1(n),e,t)},t}(t.SubPaneHeaderVEBase);t.SubPaneHeaderVE=qn;var Jn;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="AccessibilityCheckerSubPaneHeadingWrapper";var r=o.backButtonArgs();r&&this.addChild(r.build(o),i,null),this.addChild(new e.C2(o),i,null),this.addChild(new e.CsubPaneHeading(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="VerticalDivider",this._addToDom(e,t)},t}(TDB.ViewElement);e.C2=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="AccessibilityCheckerSubPaneHeading",this._TextBinding=new i.Text.Binding(o,e,n,this,n.subPaneHeadingTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CsubPaneHeading=o}(Jn||(Jn={}));var $n=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Qn.Cwrapper(n),e,t)},t}(t.IssuesStatusButtonVEBase);t.IssuesStatusButtonVE=$n;var Qn;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var r=this._context,a=document.createElement("div");this.domElement=a,a._context=r,a.className="IssuesStatusButtonWrapper",this._ClassNameBinding=new o.ClassName.Binding(a,t,r,this,r.wrapperClassNameArgs),this._AttrBinding=new i.Attr.Binding(a,t,r,this,r.wrapperAttrArgs),this._FocusableBinding=r.focusableBinding=new i.Focusable.Binding(a,t,r,this,r.FocusableInitArgs());this.addChild(new e.C1(r),a,null);var s=r.browseIssuesIconArgs();s&&this.addChild(s.build(r),a,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._ClassNameBinding.update(e),this._AttrBinding.update(e),this._FocusableBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.Cwrapper=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="IssueInformationWrapper";switch(o.ifContainIssuesArgs()){case!0:this.addChild(new e.CnumberIndicatorWrapper(o),i,null);break;case!1:this.addChild(new e.C2(o),i,null)}this.addChild(new e.CissueLabel(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=n;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var i=this._context,r=document.createElement("div");this.domElement=r,r._context=i,this._ClassNameBinding=new o.ClassName.Binding(r,t,i,this,i.numberIndicatorWrapperClassNameArgs);this.addChild(new e.CnumberOfIssues(i),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},n}(TDB.ViewElement);e.CnumberIndicatorWrapper=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("span");this.domElement=o,o._context=n,o.className="TextLabel",this._TextBinding=new i.Text.Binding(o,e,n,this,n.numberOfIssuesTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CnumberOfIssues=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="GreyBadge";var i=n.noIssueCheckmarkArgs();i&&this.addChild(i.build(n),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C2=s;var l=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("span");this.domElement=o,o._context=n,o.className="IssueLabel",this._TextBinding=new i.Text.Binding(o,e,n,this,n.issueLabelTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CissueLabel=l}(Qn||(Qn={}));var Xn=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Zn.C1(n),e,t),this.addChild(new Zn.C2(n),e,t)},t}(t.AccessibilityCheckerResultsGroupVEBase);t.AccessibilityCheckerResultsGroupVE=Xn;var Zn;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="AccessibilityCheckerResultsGroup";this.addChild(new e.CsectionTitle(o),i,null);var r=o.listIssueButtonsArgs();r&&this.addChild(r.build(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="AccessibilityCheckerResultGroupTitle",this._TextBinding=new i.Text.Binding(o,e,n,this,n.sectionTitleTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CsectionTitle=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="HorizontalDivider",this._addToDom(e,t)},t}(TDB.ViewElement);e.C2=o}(Zn||(Zn={}));var Yn=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new eo.C1(n),e,t)},t}(t.AccessibilityCheckerSummaryVEBase);t.AccessibilityCheckerSummaryVE=Yn;var eo;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="AccessibilityCheckerSummaryRegion";var r=TDB.watcherTag(17323653,o,null,o.issuesGroupArgs),a=new TDB.NewSubTemplateInstructionVE(o,r);a.addResource(r),this.addChild(a,i,null);r=TDB.watcherTag(17323653,o,null,o.improvementsGroupArgs);(a=new TDB.NewSubTemplateInstructionVE(o,r)).addResource(r),this.addChild(a,i,null);r=TDB.watcherTag(17323653,o,null,o.reviewAllGroupArgs);(a=new TDB.NewSubTemplateInstructionVE(o,r)).addResource(r),this.addChild(a,i,null),this.addChild(new e.CifShowNoIssuesText(o),i,null),this.addChild(new e.C3(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifShowNoIssuesTextArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CnoIssueIntro(o),t,n),this.addChild(new Zn.C2(o),t,n)},n}(TDB.IfInstructionVE);e.CifShowNoIssuesText=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="TextLabel",this._TextBinding=new i.Text.Binding(o,e,n,this,n.noIssueIntroTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CnoIssueIntro=o;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="AccessibilityCheckerTipsLinkWrapper";var i=n.tipsLinkArgs();i&&this.addChild(i.build(n),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C3=r}(eo||(eo={}));var to=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new no.C1(n),e,t)},t}(t.EditHyperlinkVEBase);t.EditHyperlinkVE=to;var no;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="EditHyperlinkRegion";var r=o.subPaneHeaderArgs();r&&this.addChild(r.build(o),i,null);var a=TDB.watcherTag(17323653,o,null,o.contentDeletedMessageArgs),s=new TDB.NewSubTemplateInstructionVE(o,a);s.addResource(a),this.addChild(s,i,null),o.ifShowIssueModifyingContentArgs()&&(this.addChild(new e.C2(o),i,null),this.addChild(new e.C3(o),i,null),this.addChild(new e.C4(o),i,null)),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="EditHyperlinkWrapper";this.addChild(new e.CdisplayTextTextBoxLabel(o),i,null);var r=o.displayTextBoxArgs();r&&this.addChild(new TDB.NewSubTemplateInstructionVE(o,TDB.immutableWatchable(r),"displayTextBox"),i,null),this.addChild(new e.ClinkTextBoxLabel(o),i,null),(r=o.linkTextBoxArgs())&&this.addChild(new TDB.NewSubTemplateInstructionVE(o,TDB.immutableWatchable(r),"linkTextBox"),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C2=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("label");this.domElement=o,o._context=n,o.className="HyperlinkInputBoxLabel",this._TextBinding=new i.Text.Binding(o,e,n,this,n.displayTextTextBoxLabelTextArgs),this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.displayTextTextBoxLabelAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e),this._AttrBinding.update(e)},t}(TDB.ViewElement);e.CdisplayTextTextBoxLabel=o;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("label");this.domElement=o,o._context=n,o.className="HyperlinkInputBoxLabel",this._TextBinding=new i.Text.Binding(o,e,n,this,n.linkTextBoxLabelTextArgs),this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.linkTextBoxLabelAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e),this._AttrBinding.update(e)},t}(TDB.ViewElement);e.ClinkTextBoxLabel=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="NavigationHorizontalDivider",this._addToDom(e,t)},t}(TDB.ViewElement);e.C3=a;var s=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="NavigationGroupWrapper";this.addChild(new e.C5(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C4=s;var l=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="NavigationGroupInnerWrapper";this.addChild(new e.CnavigationStatusLabel(o),i,null),this.addChild(new e.C6(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C5=l;var c=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="NavigationStatusLabel",this._TextBinding=new i.Text.Binding(o,e,n,this,n.navigationStatusLabelTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CnavigationStatusLabel=c;var d=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="NavigationButtonWrapper";var i=TDB.watcherTag(17323653,n,null,n.previousIssueButtonArgs),r=new TDB.NewSubTemplateInstructionVE(n,i);r.addResource(i),this.addChild(r,o,null);i=TDB.watcherTag(17323653,n,null,n.nextIssueButtonArgs);(r=new TDB.NewSubTemplateInstructionVE(n,i)).addResource(i),this.addChild(r,o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C6=d}(no||(no={}));var oo=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new io.C1(n),e,t)},t}(t.EditImageAltTextVEBase);t.EditImageAltTextVE=oo;var io;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="EditImageAltTextRegion";var r=o.subPaneHeaderArgs();r&&this.addChild(r.build(o),i,null);var a=TDB.watcherTag(17323653,o,null,o.contentDeletedMessageArgs),s=new TDB.NewSubTemplateInstructionVE(o,a);s.addResource(a),this.addChild(s,i,null),o.ifShowIssueModifyingContentArgs()&&(this.addChild(new e.C2(o),i,null),this.addChild(new e.C3(o),i,null),this.addChild(new no.C3(o),i,null),this.addChild(new no.C4(o),i,null)),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="EditImageAltTextPreviewImageWrapper";var i=n.imageVisualizatorArgs();i&&this.addChild(i.build(n),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C2=n;var o=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="EditImageAltTextWrapper";this.addChild(new e.CaltTextTextAreaLabel(o),i,null);var r=o.altTextEditorArgs();r&&this.addChild(new TDB.NewSubTemplateInstructionVE(o,TDB.immutableWatchable(r),"altTextEditor"),i,null),(r=o.decorativeImageCheckboxArgs())&&this.addChild(r.build(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C3=o;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("label");this.domElement=o,o._context=n,o.setAttribute("for","editImageAltTextTextArea"),o.className="EditImageAltTextTextAreaLabel",this._TextBinding=new i.Text.Binding(o,e,n,this,n.altTextTextAreaLabelTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CaltTextTextAreaLabel=r}(io||(io={}));var ro=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new ao.C1(n),e,t)},t}(t.EditExternalContentVEBase);t.EditExternalContentVE=ro;var ao;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="EditExternalContentRegion";var r=o.subPaneHeaderArgs();r&&this.addChild(r.build(o),i,null);var a=TDB.watcherTag(17323653,o,null,o.contentDeletedMessageArgs),s=new TDB.NewSubTemplateInstructionVE(o,a);s.addResource(a),this.addChild(s,i,null),o.ifShowIssueModifyingContentArgs()&&(this.addChild(new e.C2(o),i,null),this.addChild(new no.C3(o),i,null),this.addChild(new no.C4(o),i,null)),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="EditExternalContentWrapper";this.addChild(new e.Cintro(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C2=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="TextLabel",this._TextBinding=new i.Text.Binding(o,e,n,this,n.introTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.Cintro=o}(ao||(ao={}));var so=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this,o=n.paneHeaderArgs();o&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"paneHeader"),e,t),this.addChild(new lo.C1(n),e,t)},t}(t.AccessibilityCheckerPaneVEBase);t.AccessibilityCheckerPaneVE=so;var lo;!function(t){var n=function(e){function n(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(n,e),n.prototype._create=function(e,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="AccessibilityCheckerPaneContent";this.addChild(new t.CpaneState(o),i,null),this._addToDom(e,n)},n}(TDB.ViewElement);t.C1=n;var o=function(t){function n(e){var n=this,o=TDB.watcherTag(4519824,e,null,e.paneStateArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n,o){var i=this._context;switch(t){case e.View.ViewModel.AccessibilityCheckerPaneViewState.EditHyperlink:r=TDB.watcherTag(17323653,i,null,i.editHyperlinkContentArgs);(a=new TDB.NewSubTemplateInstructionVE(i,r,"editHyperlinkContent")).addResource(r),this.addChild(a,n,o);break;case e.View.ViewModel.AccessibilityCheckerPaneViewState.EditImageAltText:r=TDB.watcherTag(17323653,i,null,i.editImageAltTextContentArgs);(a=new TDB.NewSubTemplateInstructionVE(i,r,"editImageAltTextContent")).addResource(r),this.addChild(a,n,o);break;case e.View.ViewModel.AccessibilityCheckerPaneViewState.EditExternalContent:var r=TDB.watcherTag(17323653,i,null,i.editExternalContentArgs),a=new TDB.NewSubTemplateInstructionVE(i,r,"editExternalContent");a.addResource(r),this.addChild(a,n,o);break;case e.View.ViewModel.AccessibilityCheckerPaneViewState.Summary:var s=i.accessibilityCheckerSummaryArgs();s&&this.addChild(s.build(i),n,o)}},n}(TDB.SwitchInstructionVE);t.CpaneState=o}(lo||(lo={}));var co=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this,o=TDB.watcherTag(17323652,n,null,n.menuItemsArgs),i=new TDB.NewForeachInstructionVE(n,o);i.addResource(o),this.addChild(i,e,t),this.addChild(new uo.CifOverflowWrapper(n),e,t);var r=TDB.watcherTag(17323653,n,null,n.deleteButtonArgs),a=new TDB.NewSubTemplateInstructionVE(n,r);a.addResource(r),this.addChild(a,e,t)},t}(t.CardControlsVEBase);t.CardControlsVE=co;var uo;!function(e){var t=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifOverflowWrapperArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C1(o),t,n)},n}(TDB.IfInstructionVE);e.CifOverflowWrapper=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="CardMenuOverflowButtonWrapper";var i=n.overflowButtonArgs();i&&this.addChild(i.build(n),o,null),(i=n.overflowMenuArgs())&&this.addChild(i.build(n),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=n}(uo||(uo={}));var po=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this,o=TDB.watcherTag(17323652,n,null,n.menuItemsArgs),i=new TDB.NewForeachInstructionVE(n,o);i.addResource(o),this.addChild(i,e,t),this.addChild(new uo.CifOverflowWrapper(n),e,t)},t}(t.CardContentControlsVEBase);t.CardContentControlsVE=po;var go=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new ho.Cmessage(n),e,t),this.addChild(new ho.C1(n),e,t),this.addChild(new ho.C2(n),e,t)},t}(t.FailedUploadDialogContentVEBase);t.FailedUploadDialogContentVE=go;var ho;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("p");this.domElement=o,o._context=n,this._TextBinding=new i.Text.Binding(o,e,n,this,n.messageTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.Cmessage=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("br");this.domElement=o,o._context=n,this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=n;var o=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("table");this.domElement=i,i._context=o,i.className="dialogTable";this.addChild(new e.C3(o),i,null),this.addChild(new e.C5(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C2=o;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("thead");this.domElement=i,i._context=o;this.addChild(new e.C4(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C3=r;var a=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("tr");this.domElement=i,i._context=o;this.addChild(new e.CfilenameHeader(o),i,null),this.addChild(new e.CerrorHeader(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C4=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("th");this.domElement=o,o._context=n,this._TextBinding=new i.Text.Binding(o,e,n,this,n.filenameHeaderTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CfilenameHeader=s;var l=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("th");this.domElement=o,o._context=n,this._TextBinding=new i.Text.Binding(o,e,n,this,n.errorHeaderTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CerrorHeader=l;var c=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("tbody");this.domElement=i,i._context=o;o.ifGeneralFileErrorArgs()&&this.addChild(new e.C6(o),i,null),o.ifTooLargeArgs()&&this.addChild(new e.C7(o),i,null),o.ifEmptyFileArgs()&&this.addChild(new e.C8(o),i,null),o.ifFileTypeArgs()&&this.addChild(new e.C9(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C5=c;var d=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("tr");this.domElement=i,i._context=o;this.addChild(new e.CfilenameGeneralError(o),i,null),this.addChild(new e.CerrorGeneralError(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C6=d;var u=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("td");this.domElement=o,o._context=n,this._TextBinding=new i.Text.Binding(o,e,n,this,n.filenameGeneralErrorTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CfilenameGeneralError=u;var p=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("td");this.domElement=o,o._context=n,this._TextBinding=new i.Text.Binding(o,e,n,this,n.errorGeneralErrorTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CerrorGeneralError=p;var g=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("tr");this.domElement=i,i._context=o;this.addChild(new e.CfilenameFileTooLarge(o),i,null),this.addChild(new e.CerrorFileTooLarge(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C7=g;var h=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("td");this.domElement=o,o._context=n,this._TextBinding=new i.Text.Binding(o,e,n,this,n.filenameFileTooLargeTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CfilenameFileTooLarge=h;var C=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("td");this.domElement=o,o._context=n,this._TextBinding=new i.Text.Binding(o,e,n,this,n.errorFileTooLargeTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CerrorFileTooLarge=C;var f=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("tr");this.domElement=i,i._context=o;this.addChild(new e.CfilenameEmptyFile(o),i,null),this.addChild(new e.CerrorEmpty(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C8=f;var m=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("td");this.domElement=o,o._context=n,this._TextBinding=new i.Text.Binding(o,e,n,this,n.filenameEmptyFileTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CfilenameEmptyFile=m;var y=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("td");this.domElement=o,o._context=n,this._TextBinding=new i.Text.Binding(o,e,n,this,n.errorEmptyTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CerrorEmpty=y;var v=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("tr");this.domElement=i,i._context=o;this.addChild(new e.CfilenameFileType(o),i,null),this.addChild(new e.CerrorFileType(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C9=v;var S=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("td");this.domElement=o,o._context=n,this._TextBinding=new i.Text.Binding(o,e,n,this,n.filenameFileTypeTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CfilenameFileType=S;var T=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("td");this.domElement=o,o._context=n,this._TextBinding=new i.Text.Binding(o,e,n,this,n.errorFileTypeTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CerrorFileType=T}(ho||(ho={}));var Co=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.jack=TDB.methodNewSubtemplateState(o,o.jackArgs),o}return __extends(t,e),t.prototype._create=function(e,t){var n=this;if(n.ifSocketLabelArgs()&&this.addChild(new Pe.CsocketLabel(n),e,t),this.addChild(new fo.Cwrapper(n),e,t),n.ifShowTweenerArgs()){var o=n.tweenerArgs();o&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"_tweener"),e,t)}},t}(t.TableCardVEBase);t.TableCardVE=Co;var fo;!function(e){var t=function(t){function r(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(r,t),r.prototype._create=function(t,r){var a=this._context,s=document.createElement("div");this.domElement=s,s._context=a,s.className="BasicCard TableCard",this._AttrBinding=new i.Attr.Binding(s,t,a,this,a.wrapperAttrArgs),this._DraggableBinding=new i.Draggable.Binding(s,t,a,this,a.wrapperDraggableInitArgs(),a.wrapperDraggableOptionsArgs),this._StyleBinding=new i.Style.Binding(s,t,a,this,a.wrapperStyleArgs),this._CssBinding=new i.Css.Binding(s,t,a,this,a.wrapperCssArgs),this._ScrollIntoViewBinding=new o.ScrollIntoView.Binding(s,t,a,this,a.wrapperScrollIntoViewInitArgs(),a.wrapperScrollIntoViewArgs),this._DistanceFromIPBinding=new n.DistanceFromIP.Binding(s,t,a,this,a.wrapperDistanceFromIPInitArgs()),this._FloatingMenuBinding=new n.FloatingMenu.Binding(s,t,a,this,a.wrapperFloatingMenuInitArgs(),a.wrapperFloatingMenuArgs),this._FocusableBinding=a.focusableBinding=new i.Focusable.Binding(s,t,a,this,a.FocusableInitArgs()),this._TouchToMouseBinding=new o.TouchToMouse.Binding(s,t,a,this,a.wrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new Pe.CifCardCopyAvailable(a),s,null);var l=TDB.watcherTag(17323653,a,null,a.cardSelectionOverlayArgs),c=new TDB.NewSubTemplateInstructionVE(a,l,"_selectionStatus");c.addResource(l),this.addChild(c,s,null);var d=a.dropTargetOverlayArgs();d&&this.addChild(d.build(a),s,null);l=TDB.watcherTag(17323653,a,null,a.sidebarArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l)).addResource(l),this.addChild(c,s,null),this.addChild(new e.C1(a),s,null);l=TDB.watcherTag(17323653,a,null,a.menuArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l,"_menu")).addResource(l),this.addChild(c,s,null);l=TDB.watcherTag(17323653,a,null,a.labelArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l)).addResource(l),this.addChild(c,s,null),this.addChild(new e.CcontentWrapper(a),s,null);l=TDB.watcherTag(17323653,a,null,a.selectionBarArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l,"_selectionBar")).addResource(l),this.addChild(c,s,null);var u=a.jack;this.addChild(new TDB.NewSubTemplateInstructionVE(a,u.raw(),void 0,u),s,null);l=TDB.watcherTag(17323653,a,null,a.authorsListArgs);(c=new TDB.NewSubTemplateInstructionVE(a,l)).addResource(l),this.addChild(c,s,null),this._addToDom(t,r)},r.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._DraggableBinding.update(e),this._StyleBinding.update(e),this._CssBinding.update(e),this._ScrollIntoViewBinding.update(e),this._FloatingMenuBinding.update(e),this._FocusableBinding.update(e),this._TouchToMouseBinding.update(e)},r.prototype.disposeBindings=function(){this._DraggableBinding.dispose(),this._DistanceFromIPBinding.dispose(),this._FloatingMenuBinding.dispose(),this._FocusableBinding.dispose(),this._TouchToMouseBinding.dispose(),this._context.focusableBinding=void 0},r}(TDB.ViewElement);e.Cwrapper=t;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="ThumbnailPane";this.addChild(new e.CimageWrapper(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,i=document.createElement("div");this.domElement=i,i._context=n,i.className="MediaPlaceholderImageWrapper ThumbnailFrame",this._TouchToMouseBinding=new o.TouchToMouse.Binding(i,e,n,this,n.imageWrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);var r=TDB.watcherTag(17323653,n,null,n.imageRepresentationCardArgs),a=new TDB.NewSubTemplateInstructionVE(n,r,"imageRepresentationCard");a.addResource(r),this.addChild(a,i,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TouchToMouseBinding.update(e)},t.prototype.disposeBindings=function(){this._TouchToMouseBinding.dispose()},t}(TDB.ViewElement);e.CimageWrapper=a;var s=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="TableCardContentWrapper",this._CssBinding=new i.Css.Binding(r,t,o,this,o.contentWrapperCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.C2(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._CssBinding.update(e)},n}(TDB.ViewElement);e.CcontentWrapper=s;var l=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="TableMessage";this.addChild(new e.CtableInfoMessage(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C2=l;var c=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("span");this.domElement=o,o._context=n,this._TextBinding=new i.Text.Binding(o,e,n,this,n.tableInfoMessageTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CtableInfoMessage=c}(fo||(fo={}));var mo=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o._subscribeToWatchable(o._setFadeTimerWatcher=TDB.watcherTag(5796370,o,o,o.setFadeTimer),TDB.UpdatePhase.ReadWrite),o}return __extends(t,e),t.prototype._create=function(e,t){var n=this;TDB.perfMeasurement("AuthoringPlayAppBarVE_create",function(){var o=n;n.addChild(new yo.CappbarPlaceholder(o),e,t),n.receivePhaseNotification(TDB.UpdatePhase.ReadWrite)})},t.prototype.onUpdate=function(e){e===TDB.UpdatePhase.ReadWrite&&this._setFadeTimerWatcher.resolve()},t}(t.AuthoringPlayAppBarVEBase);t.AuthoringPlayAppBarVE=mo;var yo;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var r=this._context,a=document.createElement("div");this.domElement=a,a._context=r,a.setAttribute("role","banner"),this._EventsBinding=new i.Events.Binding(a,t,r,this,r.appbarPlaceholderEventsInitArgs()),this._StyleBinding=new i.Style.Binding(a,t,r,this,r.appbarPlaceholderStyleArgs),this._ClassNameBinding=new o.ClassName.Binding(a,t,r,this,r.appbarPlaceholderClassNameArgs),this._AttrBinding=new i.Attr.Binding(a,t,r,this,r.appbarPlaceholderAttrArgs);this.addChild(new e.Cwrapper(r),a,null),this.addChild(new e.CifSearchVisible(r),a,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._StyleBinding.update(e),this._ClassNameBinding.update(e),this._AttrBinding.update(e)},n.prototype.disposeBindings=function(){this._EventsBinding.dispose()},n}(TDB.ViewElement);e.CappbarPlaceholder=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var r=this._context,a=document.createElement("div");this.domElement=a,a._context=r,a.className="appBarCollapsableContainer",this._FadeVisibleBinding=new o.FadeVisible.Binding(a,t,r,this,r.wrapperFadeVisibleInitArgs(),r.wrapperFadeVisibleArgs),this._StyleBinding=new i.Style.Binding(a,t,r,this,r.wrapperStyleArgs);this.addChild(new e.C1(r),a,null);var s=r.shareDropdownArgs();s&&this.addChild(new TDB.NewSubTemplateInstructionVE(r,TDB.immutableWatchable(s),"shareDropdown"),a,null),(s=r.overflowMenuArgs())&&this.addChild(new TDB.NewSubTemplateInstructionVE(r,TDB.immutableWatchable(s),"overflowMenu"),a,null),(s=r.consumptionSettingsMenuArgs())&&this.addChild(new TDB.NewSubTemplateInstructionVE(r,TDB.immutableWatchable(s),"consumptionSettingsMenu"),a,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._FadeVisibleBinding.update(e),this._StyleBinding.update(e)},n.prototype.disposeBindings=function(){this._FadeVisibleBinding.dispose()},n}(TDB.ViewElement);e.Cwrapper=n;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="appBarButtonGroups";this.addChild(new TDB.NewForeachInstructionVE(n,TDB.immutableWatchable(n.buttonGroupsArgs()),"buttonGroups"),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=r;var a=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifSearchVisibleArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C2(o),t,n)},n}(TDB.IfInstructionVE);e.CifSearchVisible=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="consumptionSearchContainer";var i=n.contentSearchArgs();i&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(i),"contentSearch"),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C2=s}(yo||(yo={}));var vo=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new So.Cwrapper(n),e,t)},t}(t.PasswordAudienceFlyoutVEBase);t.PasswordAudienceFlyoutVE=vo;var So;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,i=document.createElement("div");this.domElement=i,i._context=n,i.className="PasswordAudienceFlyoutWrapper",i.setAttribute("role","group"),this._SlideVisibleBinding=new o.SlideVisible.Binding(i,e,n,this,n.wrapperSlideVisibleInitArgs(),n.wrapperSlideVisibleArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);for(var r=n.buttonsArgs(),a=r.length,s=0;s<a;++s)this.addChild(r[s].build(n),i,null);this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._SlideVisibleBinding.update(e)},t}(TDB.ViewElement);e.Cwrapper=t}(So||(So={}));var To=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new wo.C1(n),e,t)},t}(t.PasswordManagementDialogContentVEBase);t.PasswordManagementDialogContentVE=To;var wo;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="PasswordManagementDialogContent";this.addChild(new e.C2(o),i,null),this.addChild(new e.CifShowErrorMessage(o),i,null);var r=o.audienceTypeButtonArgs();r&&this.addChild(new TDB.NewSubTemplateInstructionVE(o,TDB.immutableWatchable(r),"audienceButton"),i,null),(r=o.audienceTypeFlyoutArgs())&&this.addChild(new TDB.NewSubTemplateInstructionVE(o,TDB.immutableWatchable(r),"audienceTypeFlyout"),i,null),this.addChild(new e.CnarratorMessage(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="PasswordManagementTextBoxWrapper";this.addChild(new e.C3(o),i,null);var r=o.passwordTextBoxArgs();r&&this.addChild(new TDB.NewSubTemplateInstructionVE(o,TDB.immutableWatchable(r),"passwordTextBox"),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C2=n;var o=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="SpinnerWrapper";this.addChild(new e.CifShowLoadingSpinner(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C3=o;var r=function(t){function n(e){var n=t.call(this,e.ifShowLoadingSpinnerArgs())||this;return n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CloadingSpinner(o),t,n)},n}(TDB.IfInstructionVE);e.CifShowLoadingSpinner=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("img");this.domElement=o,o._context=n,o.setAttribute("role","progressbar"),o.className="LoadingSpinner",o.setAttribute("aria-busy","true"),this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.loadingSpinnerAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e)},t}(TDB.ViewElement);e.CloadingSpinner=a;var s=function(t){function n(e){var n=t.call(this,e.ifShowErrorMessageArgs())||this;return n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CerrorMessage(o),t,n)},n}(TDB.IfInstructionVE);e.CifShowErrorMessage=s;var l=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="PasswordErrorMessage",o.setAttribute("aria-live","assertive"),this._TextBinding=new i.Text.Binding(o,e,n,this,n.errorMessageTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CerrorMessage=l;var c=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("span");this.domElement=o,o._context=n,o.className="inlineScreenReaderOnly",o.setAttribute("aria-live","assertive"),o.setAttribute("aria-atomic","true"),this._TextBinding=new i.Text.Binding(o,e,n,this,n.narratorMessageTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CnarratorMessage=c}(wo||(wo={}));var Ao=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Eo.CsuggestedPersonWrapper(n),e,t)},t}(t.SuggestedPersonVEBase);t.SuggestedPersonVE=Ao;var Eo;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="suggestedPersonWrapper",r.setAttribute("role","option"),this._FocusableBinding=o.focusableBinding=new i.Focusable.Binding(r,t,o,this,o.FocusableInitArgs());var a=o.suggestedPersonImageArgs();a&&this.addChild(a.build(o),r,null),this.addChild(new e.C1(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._FocusableBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.CsuggestedPersonWrapper=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="suggestedPersonInfo";this.addChild(new e.CsuggestedPersonName(o),i,null),this.addChild(new e.CsuggestedPersonEmail(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="suggestedPersonName",this._TextBinding=new i.Text.Binding(o,e,n,this,n.suggestedPersonNameTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CsuggestedPersonName=o;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="suggestedPersonEmail",this._TextBinding=new i.Text.Binding(o,e,n,this,n.suggestedPersonEmailTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CsuggestedPersonEmail=r}(Eo||(Eo={}));var _o=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new xo.CstoryUserThumbnailWrapper(n),e,t)},t}(t.StoryUserThumbnailVEBase);t.StoryUserThumbnailVE=_o;var xo;!function(e){var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var i=this._context,r=document.createElement("div");this.domElement=r,r._context=i,r.setAttribute("aria-hidden","true"),this._ClassNameBinding=new o.ClassName.Binding(r,t,i,this,i.storyUserThumbnailWrapperClassNameArgs);this.addChild(new e.CcurrentStoryUserThumbnailType(i),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},n}(TDB.ViewElement);e.CstoryUserThumbnailWrapper=n;var r=function(n){function o(e){var t=this,o=TDB.watcherTag(4519824,e,null,e.currentStoryUserThumbnailTypeArgs);return(t=n.call(this,o)||this).addResource(o),t._context=e,t}return __extends(o,n),o.prototype.buildChildren=function(n,o,i){var r=this._context;switch(n){case t.StoryUserThumbnailType.Thumbnail:this.addChild(new e.Cthumbnail(r),o,i);break;case t.StoryUserThumbnailType.DoughBoy:var a=r.fontIconArgs();a&&this.addChild(a.build(r),o,i);break;case t.StoryUserThumbnailType.Initials:this.addChild(new e.C1(r),o,i)}},o}(TDB.SwitchInstructionVE);e.CcurrentStoryUserThumbnailType=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="StoryUserThumbnail",this._StyleBinding=new i.Style.Binding(o,e,n,this,n.thumbnailStyleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e)},t}(TDB.ViewElement);e.Cthumbnail=a;var s=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="StoryUserInitialsWrapper";this.addChild(new e.CstoryUserInitials(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=s;var l=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="StoryUserInitials",this._TextBinding=new i.Text.Binding(o,e,n,this,n.storyUserInitialsTextArgs),this._StyleBinding=new i.Style.Binding(o,e,n,this,n.storyUserInitialsStyleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e),this._StyleBinding.update(e)},t}(TDB.ViewElement);e.CstoryUserInitials=l}(xo||(xo={}));var Bo=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new TDB.NewForeachInstructionVE(n,TDB.immutableWatchable(n.itemsArgs()),"storyUsers"),e,t)},t}(t.StoryUsersWrapperVEBase);t.StoryUsersWrapperVE=Bo;var bo=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Do.Cwrapper(n),e,t)},t}(t.StoryUserPopupVEBase);t.StoryUserPopupVE=bo;var Do;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var r=this._context,a=document.createElement("div");this.domElement=a,a._context=r,a.className="StoryUserPopupWrapper",this._SlideVisibleBinding=new o.SlideVisible.Binding(a,t,r,this,r.wrapperSlideVisibleInitArgs(),r.wrapperSlideVisibleArgs),this._AttrBinding=new i.Attr.Binding(a,t,r,this,r.wrapperAttrArgs),this._StyleBinding=new i.Style.Binding(a,t,r,this,r.wrapperStyleArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.CstoryUserName(r),a,null),this.addChild(new e.CstoryUserEmail(r),a,null),r.ifEditingNowArgs()&&this.addChild(new e.CeditingNow(r),a,null),this.addChild(new e.CshouldShowSwspButtons(r),a,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._SlideVisibleBinding.update(e),this._AttrBinding.update(e),this._StyleBinding.update(e)},n}(TDB.ViewElement);e.Cwrapper=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="StoryUserName",this._TextBinding=new i.Text.Binding(o,e,n,this,n.storyUserNameTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CstoryUserName=n;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="StoryUserEmail",this._TextBinding=new i.Text.Binding(o,e,n,this,n.storyUserEmailTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CstoryUserEmail=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="StoryUserEditingNow",this._TextBinding=new i.Text.Binding(o,e,n,this,n.editingNowTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CeditingNow=a;var s=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.shouldShowSwspButtonsArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C1(o),t,n),this.addChild(new e.C2(o),t,n)},n}(TDB.IfInstructionVE);e.CshouldShowSwspButtons=s;var l=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ConvertUserButtonWrapper";var i=n.convertUserButtonArgs();i&&this.addChild(i.build(n),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=l;var c=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="RemoveUserButtonWrapper";var i=n.removeUserButtonArgs();i&&this.addChild(i.build(n),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C2=c}(Do||(Do={}));var Mo=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Vo.CstoryUserWrapper(n),e,t)},t}(t.StoryUserVEBase);t.StoryUserVE=Mo;var Vo;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var i=this._context,r=document.createElement("div");this.domElement=r,r._context=i,this._ClassNameBinding=new o.ClassName.Binding(r,t,i,this,i.storyUserWrapperClassNameArgs);this.addChild(new e.C1(i),r,null);var a=i.storyUserPopupArgs();a&&this.addChild(new TDB.NewSubTemplateInstructionVE(i,TDB.immutableWatchable(a),"storyUserPopup"),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},n}(TDB.ViewElement);e.CstoryUserWrapper=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="StoryUserCommon";this.addChild(new e.Cwrapper(o),i,null),this.addChild(new e.CifShowSpinner(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=n;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("button");this.domElement=r,r._context=n,this._FocusableBinding=n.focusableBinding=new i.Focusable.Binding(r,e,n,this,n.FocusableInitArgs()),this._AttrBinding=new i.Attr.Binding(r,e,n,this,n.wrapperAttrArgs),this._EventsBinding=new i.Events.Binding(r,e,n,this,n.wrapperEventsInitArgs()),this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.wrapperClassNameArgs),this._PropsBinding=new i.Props.Binding(r,e,n,this,n.wrapperPropsArgs);var a=n.storyUserThumbnailArgs();a&&this.addChild(a.build(n),r,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._FocusableBinding.update(e),this._AttrBinding.update(e),this._ClassNameBinding.update(e),this._PropsBinding.update(e)},t.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._EventsBinding.dispose(),this._context.focusableBinding=void 0},t}(TDB.ViewElement);e.Cwrapper=r;var a=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifShowSpinnerArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CstoryUserSpinner(o),t,n)},n}(TDB.IfInstructionVE);e.CifShowSpinner=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("img");this.domElement=o,o._context=n,o.setAttribute("role","progressbar"),o.className="StoryUserSpinner",o.setAttribute("aria-busy","true"),this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.storyUserSpinnerAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e)},t}(TDB.ViewElement);e.CstoryUserSpinner=s}(Vo||(Vo={}));var Io=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Po.C1(n),e,t)},t}(t.ShareMoreOptionsVEBase);t.ShareMoreOptionsVE=Io;var Po;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o;var r=o.moreOptionsToggleArgs();r&&this.addChild(r.build(o),i,null),this.addChild(new e.CmoreOptionsWrapper(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.id="showMoreOptionsWrapper",r.className="shareMoreOptionsWrapper",this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.moreOptionsWrapperAttrArgs);this.addChild(new e.CifShowMoreOptions(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e)},n}(TDB.ViewElement);e.CmoreOptionsWrapper=n;var o=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifShowMoreOptionsArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C2(o),t,n),o.showRevokeLinkArgs()&&this.addChild(new e.C3(o),t,n)},n}(TDB.IfInstructionVE);e.CifShowMoreOptions=o;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="shareMoreOptionsCheckboxes";this.addChild(new e.CifShowPasswordManagement(o),i,null);var r=TDB.watcherTag(17323653,o,null,o.blockShareButtonCheckboxArgs),a=new TDB.NewSubTemplateInstructionVE(o,r,"blockShareButtonCheckbox");a.addResource(r),this.addChild(a,i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C2=r;var a=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifShowPasswordManagementArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.ChasPassword(o),t,n)},n}(TDB.IfInstructionVE);e.CifShowPasswordManagement=a;var s=function(e){function t(t){var n=this,o=TDB.watcherTag(4519824,t,null,t.hasPasswordArgs);return(n=e.call(this,o)||this).addResource(o),n._context=t,n}return __extends(t,e),t.prototype.buildChildren=function(e,t,n){var o=this._context;switch(e){case!0:(i=o.removePasswordArgs())&&this.addChild(new TDB.NewSubTemplateInstructionVE(o,TDB.immutableWatchable(i),"removePassword"),t,n);break;case!1:var i=o.setPasswordButtonArgs();i&&this.addChild(new TDB.NewSubTemplateInstructionVE(o,TDB.immutableWatchable(i),"setPasswordButton"),t,n)}},t}(TDB.SwitchInstructionVE);e.ChasPassword=s;var l=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="moreOptionsRevoke";var i=n.revokeLinkArgs();i&&this.addChild(i.build(n),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C3=l}(Po||(Po={}));var ko=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Ro.CshareLevelWrapper(n),e,t)},t}(t.ShareLevelSelectorVEBase);t.ShareLevelSelectorVE=ko;var Ro;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="shareLevelWrapper",r.setAttribute("role","radiogroup"),this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.shareLevelWrapperAttrArgs);switch(this.addChild(new e.Ctitle(o),r,null),o.ifTenantOwnerArgs()){case!0:var a=o.sharingLevelsArgs();a&&this.addChild(new TDB.NewSubTemplateInstructionVE(o,TDB.immutableWatchable(a),"sharingLevels"),r,null);break;case!1:this.addChild(new e.C1(o),r,null)}this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e)},n}(TDB.ViewElement);e.CshareLevelWrapper=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("h1");this.domElement=o,o._context=n,this._TextBinding=new i.Text.Binding(o,e,n,this,n.titleTextArgs),this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.titleAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e),this._AttrBinding.update(e)},t}(TDB.ViewElement);e.Ctitle=n;var o=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="shareLevelInfoWrapper";var r=o.sharingLevelIconArgs();r&&this.addChild(r.build(o),i,null),this.addChild(new e.CsharingLevelMessage(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=o;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="SharingLevelMessage",this._TextBinding=new i.Text.Binding(o,e,n,this,n.sharingLevelMessageTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CsharingLevelMessage=r}(Ro||(Ro={}));var Lo=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Uo.C1(n),e,t)},t}(t.ShareHeaderVEBase);t.ShareHeaderVE=Lo;var Uo;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="AppBarFarSideHeaderWrapper";var i=n.shareButtonArgs();i&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(i),"shareButton"),o,null),(i=n.shareDropdownArgs())&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(i),"shareDropdown"),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=t}(Uo||(Uo={}));var Fo=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new No.C1(n),e,t)},t}(t.SharedSwayDialogContentVEBase);t.SharedSwayDialogContentVE=Fo;var No;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="sharedSwayContentDialogWrapper";this.addChild(new e.Cmesssage(o),i,null),this.addChild(new e.Clink(o),i,null);var r=o.copyLinkArgs();r&&this.addChild(new TDB.NewSubTemplateInstructionVE(o,TDB.immutableWatchable(r),"copyLink"),i,null),this.addChild(new e.CaccessibilityMessage(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="sharedSwayContentDialogMessage",this._TextBinding=new i.Text.Binding(o,e,n,this,n.messsageTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.Cmesssage=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.id="sharedSwayContentDialogLink",o.className="sharedSwayContentDialogLink",this._TextBinding=new i.Text.Binding(o,e,n,this,n.linkTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.Clink=o;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("span");this.domElement=o,o._context=n,o.className="inlineScreenReaderOnly",o.setAttribute("aria-live","polite"),o.setAttribute("aria-atomic","true"),this._TextBinding=new i.Text.Binding(o,e,n,this,n.accessibilityMessageTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CaccessibilityMessage=r}(No||(No={}));var Oo=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Wo.Cwrapper(n),e,t)},t}(t.ShareDropdownVEBase);t.ShareDropdownVE=Oo;var Wo;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,r=document.createElement("div");this.domElement=r,r._context=n,r.id="shareDropdown",this._SlideVisibleBinding=new o.SlideVisible.Binding(r,e,n,this,n.wrapperSlideVisibleInitArgs(),n.wrapperSlideVisibleArgs),this._AttrBinding=new i.Attr.Binding(r,e,n,this,n.wrapperAttrArgs),this._ClassNameBinding=new o.ClassName.Binding(r,e,n,this,n.wrapperClassNameArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);var a=n.contentArgs();a&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(a),"content"),r,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._SlideVisibleBinding.update(e),this._AttrBinding.update(e),this._ClassNameBinding.update(e)},t}(TDB.ViewElement);e.Cwrapper=t}(Wo||(Wo={}));var Ho=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Go.CifDisableOverlay(n),e,t);var o=n.sharingLevelsArgs();o&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"shareLevelSelector"),e,t),this.addChild(new Go.C1(n),e,t),(o=n.invitePeopleArgs())&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"invitePeople"),e,t);var i=TDB.watcherTag(17323653,n,null,n.shareButtonsArgs),r=new TDB.NewSubTemplateInstructionVE(n,i);switch(r.addResource(i),this.addChild(r,e,t),n.shouldShowEditorsAndViewersListsArgs()){case!0:this.addChild(new Go.CshouldShowEditorsList(n),e,t),this.addChild(new Go.CshouldShowViewersList(n),e,t);break;case!1:this.addChild(new Go.CifCoAuthWrapper(n),e,t)}this.addChild(new Go.C1(n),e,t),(o=n.moreOptionsArgs())&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"moreOptions"),e,t),this.addChild(new Go.CaccessibilityMessage(n),e,t)},t}(t.ShareDropdownContentVEBase);t.ShareDropdownContentVE=Ho;var Go;!function(e){var t=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifDisableOverlayArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CdisableOverlay(o),t,n)},n}(TDB.IfInstructionVE);e.CifDisableOverlay=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,i=document.createElement("div");this.domElement=i,i._context=n,this._ClassNameBinding=new o.ClassName.Binding(i,e,n,this,n.disableOverlayClassNameArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},t}(TDB.ViewElement);e.CdisableOverlay=n;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="shareDropdownDivider",this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=r;var a=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.shouldShowEditorsListArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C2(o),t,n)},n}(TDB.IfInstructionVE);e.CshouldShowEditorsList=a;var s=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="StoryUsersSectionWrapper";this.addChild(new e.C3(o),i,null),this.addChild(new e.C4(o),i,null),this.addChild(new e.CshouldShowSwspEditorsError(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C2=s;var l=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="StoryUsersTitle";this.addChild(new e.CswspEditors(o),i,null),this.addChild(new e.CifSwspEditorsSpinner(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C3=l;var c=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.id="swspEditorsTitle",this._TextBinding=new i.Text.Binding(o,e,n,this,n.swspEditorsTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CswspEditors=c;var d=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifSwspEditorsSpinnerArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CswspEditorsSpinner(o),t,n)},n}(TDB.IfInstructionVE);e.CifSwspEditorsSpinner=d;var u=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("img");this.domElement=o,o._context=n,o.setAttribute("role","progressbar"),o.className="StoryUsersSpinner",o.setAttribute("aria-busy","true"),this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.swspEditorsSpinnerAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e)},t}(TDB.ViewElement);e.CswspEditorsSpinner=u;var p=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="StoryUsersWrapper",o.setAttribute("role","listbox"),o.setAttribute("aria-labelledby","swspEditorsTitle");var i=TDB.watcherTag(17323653,n,null,n.swspEditorsListArgs),r=new TDB.NewSubTemplateInstructionVE(n,i,"swspEditorsList");r.addResource(i),this.addChild(r,o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C4=p;var g=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.shouldShowSwspEditorsErrorArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CswspEditorsErrorMessage(o),t,n)},n}(TDB.IfInstructionVE);e.CshouldShowSwspEditorsError=g;var h=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="StoryUsersListErrorMessage",this._TextBinding=new i.Text.Binding(o,e,n,this,n.swspEditorsErrorMessageTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CswspEditorsErrorMessage=h;var C=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.shouldShowViewersListArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C5(o),t,n)},n}(TDB.IfInstructionVE);e.CshouldShowViewersList=C;var f=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="StoryUsersSectionWrapper";this.addChild(new e.C6(o),i,null),this.addChild(new e.C7(o),i,null),this.addChild(new e.CshouldShowSwspViewersError(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C5=f;var m=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="StoryUsersTitle";this.addChild(new e.CswspViewers(o),i,null),this.addChild(new e.CifSwspViewersSpinner(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C6=m;var y=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.id="swspViewersTitle",this._TextBinding=new i.Text.Binding(o,e,n,this,n.swspViewersTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CswspViewers=y;var v=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifSwspViewersSpinnerArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CswspViewersSpinner(o),t,n)},n}(TDB.IfInstructionVE);e.CifSwspViewersSpinner=v;var S=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("img");this.domElement=o,o._context=n,o.setAttribute("role","progressbar"),o.className="StoryUsersSpinner",o.setAttribute("aria-busy","true"),this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.swspViewersSpinnerAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e)},t}(TDB.ViewElement);e.CswspViewersSpinner=S;var T=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="StoryUsersWrapper",o.setAttribute("role","listbox"),o.setAttribute("aria-labelledby","swspViewersTitle");var i=TDB.watcherTag(17323653,n,null,n.swspViewersListArgs),r=new TDB.NewSubTemplateInstructionVE(n,i,"swspViewersList");r.addResource(i),this.addChild(r,o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C7=T;var w=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.shouldShowSwspViewersErrorArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CswspViewersErrorMessage(o),t,n)},n}(TDB.IfInstructionVE);e.CshouldShowSwspViewersError=w;var A=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="StoryUsersListErrorMessage",this._TextBinding=new i.Text.Binding(o,e,n,this,n.swspViewersErrorMessageTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CswspViewersErrorMessage=A;var E=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifCoAuthWrapperArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C8(o),t,n)},n}(TDB.IfInstructionVE);e.CifCoAuthWrapper=E;var _=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="StoryUsersSectionWrapper";this.addChild(new e.CtitleAuthors(o),i,null),this.addChild(new e.C9(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C8=_;var x=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.id="coauthorsTitle",o.className="StoryUsersTitle",this._TextBinding=new i.Text.Binding(o,e,n,this,n.titleAuthorsTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CtitleAuthors=x;var B=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="StoryUsersWrapper",o.setAttribute("role","listbox"),o.setAttribute("aria-labelledby","coauthorsTitle");var i=TDB.watcherTag(17323653,n,null,n.storyUsersWrapperArgs),r=new TDB.NewSubTemplateInstructionVE(n,i,"storyUsersWrapper");r.addResource(i),this.addChild(r,o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C9=B;var b=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="inlineScreenReaderOnly",o.setAttribute("aria-live","assertive"),this._TextBinding=new i.Text.Binding(o,e,n,this,n.accessibilityMessageTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CaccessibilityMessage=b}(Go||(Go={}));var zo=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new jo.Cwrapper(n),e,t)},t}(t.ShareFrameVEBase);t.ShareFrameVE=zo;var jo;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ShareFrameWrapper",this._PositionBinding=n.wrapperPositionBinding=new i.Position.Binding(o,e,n,this);var r=n.contentArgs();r&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(r),"content"),o,null),this._addToDom(e,t)},t.prototype.disposeBindings=function(){this._context.wrapperPositionBinding=void 0},t}(TDB.ViewElement);e.Cwrapper=t}(jo||(jo={}));var Ko=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new qo.C1(n),e,t)},t}(t.ShareButtonsVEBase);t.ShareButtonsVE=Ko;var qo;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="shareButtonsWrapper";var i=TDB.watcherTag(17323652,n,null,n.shareButtonsArgs),r=new TDB.NewForeachInstructionVE(n,i);r.addResource(i),this.addChild(r,o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=t}(qo||(qo={}));var Jo=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new $o.C1(n),e,t)},t}(t.SelectedPersonVEBase);t.SelectedPersonVE=Jo;var $o;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="selectedUserOrGroupWrapper flexCenter";this.addChild(new e.CifSpinner(o),i,null),this.addChild(new e.CselectedPersonWrapper(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(t){function n(e){var n=this,o=TDB.watcherTag(4519824,e,null,e.ifSpinnerArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n,o){var i=this._context;switch(t){case!0:this.addChild(new e.CwaitingSpinner(i),n,o);break;case!1:var r=i.getGroupMembersButtonArgs();r&&this.addChild(new TDB.NewSubTemplateInstructionVE(i,TDB.immutableWatchable(r),"groupMembersButton"),n,o)}},n}(TDB.SwitchInstructionVE);e.CifSpinner=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("img");this.domElement=o,o._context=n,o.setAttribute("role","progressbar"),o.className="selectedPersonSpinner",o.setAttribute("aria-busy","true"),this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.waitingSpinnerAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e)},t}(TDB.ViewElement);e.CwaitingSpinner=o;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="selectedPersonWrapper",r.setAttribute("role","option"),this._FocusableBinding=o.focusableBinding=new i.Focusable.Binding(r,t,o,this,o.FocusableInitArgs()),this._EventsBinding=new i.Events.Binding(r,t,o,this,o.selectedPersonWrapperEventsInitArgs());var a=o.selectedPersonImageArgs();a&&this.addChild(a.build(o),r,null),this.addChild(new e.CselectedPersonName(o),r,null),(a=o.removePersonButtonArgs())&&this.addChild(a.build(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._FocusableBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._EventsBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.CselectedPersonWrapper=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="selectedPersonName",this._TextBinding=new i.Text.Binding(o,e,n,this,n.selectedPersonNameTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CselectedPersonName=a}($o||($o={}));var Qo=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Xo.C1(n),e,t)},t}(t.RemovePasswordVEBase);t.RemovePasswordVE=Qo;var Xo;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="RemovePasswordWrapper";this.addChild(new e.CpasswordScopeLabel(o),i,null),this.addChild(new e.CspinnerVisible(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="RemovePasswordLabel",this._TextBinding=new i.Text.Binding(o,e,n,this,n.passwordScopeLabelTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CpasswordScopeLabel=n;var o=function(t){function n(e){var n=this,o=TDB.watcherTag(4519824,e,null,e.spinnerVisibleArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n,o){var i=this._context;switch(t){case!0:this.addChild(new e.CloadingSpinner(i),n,o);break;case!1:var r=i.removePasswordButtonArgs();r&&this.addChild(r.build(i),n,o)}},n}(TDB.SwitchInstructionVE);e.CspinnerVisible=o;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("img");this.domElement=o,o._context=n,o.setAttribute("role","progressbar"),o.className="shareMoreOptionsRemovePasswordSpinner",o.setAttribute("aria-busy","true"),this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.loadingSpinnerAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e)},t}(TDB.ViewElement);e.CloadingSpinner=r}(Xo||(Xo={}));var Zo=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Yo.C1(n),e,t)},t}(t.InvitePeopleVEBase);t.InvitePeopleVE=Zo;var Yo;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="invitePeopleWrapper";if(o.islinkTypeSelectorVisibleArgs()){this.addChild(new e.CinvitePeopleTitle(o),i,null);var r=o.linkTypeRadioGroupArgs();r&&this.addChild(new TDB.NewSubTemplateInstructionVE(o,TDB.immutableWatchable(r),"linkTypeRadioGroup"),i,null)}this.addChild(new e.C2(o),i,null),this.addChild(new e.CisPickerVisible(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="invitePeopleTitle",this._TextBinding=new i.Text.Binding(o,e,n,this,n.invitePeopleTitleTextArgs),this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.invitePeopleTitleAttrArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e),this._AttrBinding.update(e)},t}(TDB.ViewElement);e.CinvitePeopleTitle=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="inviteLinkWrapper";var i=TDB.watcherTag(17323653,n,null,n.inputTextBoxArgs),r=new TDB.NewSubTemplateInstructionVE(n,i,"inputTextBox");r.addResource(i),this.addChild(r,o,null);var a=n.copyTextButtonArgs();a&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(a),"copyLinkButton"),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C2=o;var r=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.isPickerVisibleArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C3(o),t,n)},n}(TDB.IfInstructionVE);e.CisPickerVisible=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="invitePeoplePickerWrapper";var i=TDB.watcherTag(17323653,n,null,n.peoplePickerArgs),r=new TDB.NewSubTemplateInstructionVE(n,i,"peoplePicker");r.addResource(i),this.addChild(r,o,null);var a=n.inviteTextButtonArgs();a&&this.addChild(a.build(n),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C3=a}(Yo||(Yo={}));var ei=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new ti.C1(n),e,t)},t}(t.JackCardOptionsWrapperVEBase);t.JackCardOptionsWrapperVE=ei;var ti;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="JackMenuOptions",o.setAttribute("role","tablist");var i=TDB.watcherTag(17323652,n,null,n.cardOptionsArgs),r=new TDB.NewForeachInstructionVE(n,i,"cardOptions");r.addResource(i),this.addChild(r,o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=t}(ti||(ti={}));var ni=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new oi.C1(n),e,t)},t}(t.CustomColorOptionVEBase);t.CustomColorOptionVE=ni;var oi;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("li");this.domElement=i,i._context=o,i.className="StyleLayoutOptionListItem",i.setAttribute("role","presentation");this.addChild(new e.Cwrapper(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="ColorOption",this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.wrapperAttrArgs),this._FocusableBinding=o.focusableBinding=new i.Focusable.Binding(r,t,o,this,o.FocusableInitArgs());this.addChild(new e.CcustomColor(o),r,null),this.addChild(new Mn.C2(o),r,null),this.addChild(new Mn.C3(o),r,null),this.addChild(new e.CifIsSelected(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._FocusableBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.Cwrapper=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="CustomColorOptionColor",this._StyleBinding=new i.Style.Binding(o,e,n,this,n.customColorStyleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e)},t}(TDB.ViewElement);e.CcustomColor=o;var r=function(e){function t(t){var n=this,o=TDB.watcherTag(4543754,t,null,t.ifIsSelectedArgs);return(n=e.call(this,o)||this).addResource(o),n._context=t,n}return __extends(t,e),t.prototype.buildChildren=function(e,t){var n=this._context,o=n.deleteButtonArgs();o&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"deleteButton"),e,t)},t}(TDB.IfInstructionVE);e.CifIsSelected=r}(oi||(oi={}));var ii=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new ri.Cwrapper(n),e,t)},t}(t.NewCustomColorOptionVEBase);t.NewCustomColorOptionVE=ii;var ri;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="ColorOption StyleLayoutOptionListItem",this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.wrapperAttrArgs),this._FocusableBinding=o.focusableBinding=new i.Focusable.Binding(r,t,o,this,o.FocusableInitArgs());this.addChild(new e.C1(o),r,null),this.addChild(new e.C2(o),r,null),this.addChild(new e.C3(o),r,null),this.addChild(new Mn.C2(o),r,null),this.addChild(new Mn.C3(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._FocusableBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.Cwrapper=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="CustomColorOptionColor",this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="CustomColorOptionDiagonalLine",this._addToDom(e,t)},t}(TDB.ViewElement);e.C2=o;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="NewCustomColorOptionPlusRegion";this.addChild(new e.C4(o),i,null),this.addChild(new e.C5(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C3=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="NewCustomColorOptionPlusVerticalLine",this._addToDom(e,t)},t}(TDB.ViewElement);e.C4=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="NewCustomColorOptionPlusHorizontalLine",this._addToDom(e,t)},t}(TDB.ViewElement);e.C5=s}(ri||(ri={}));var ai=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new si.C1(n),e,t)},t}(t.CustomColorEntryVEBase);t.CustomColorEntryVE=ai;var si;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="CustomColorEntryWrapper";var r=TDB.watcherTag(17323653,o,null,o.textBoxArgs),a=new TDB.NewSubTemplateInstructionVE(o,r,"textBox");a.addResource(r),this.addChild(a,i,null),this.addChild(new e.CentryButton(o),i,null),this.addChild(new e.CaccessibilityMessage(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("button");this.domElement=r,r._context=o,r.className="CustomColorEntryButton ButtonVE",this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.entryButtonAttrArgs),this._PropsBinding=new i.Props.Binding(r,t,o,this,o.entryButtonPropsArgs),this._EventsBinding=new i.Events.Binding(r,t,o,this,o.entryButtonEventsInitArgs());this.addChild(new e.CcustomColorEntryColor(o),r,null),this.addChild(new e.CnotValidColor(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._PropsBinding.update(e)},n.prototype.disposeBindings=function(){this._EventsBinding.dispose()},n}(TDB.ViewElement);e.CentryButton=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="CustomColorOptionColor",this._StyleBinding=new i.Style.Binding(o,e,n,this,n.customColorEntryColorStyleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e)},t}(TDB.ViewElement);e.CcustomColorEntryColor=o;var r=function(e){function t(t){var n=this,o=TDB.watcherTag(4543754,t,null,t.notValidColorArgs);return(n=e.call(this,o)||this).addResource(o),n._context=t,n}return __extends(t,e),t.prototype.buildChildren=function(e,t){var n=this._context;this.addChild(new ri.C2(n),e,t)},t}(TDB.IfInstructionVE);e.CnotValidColor=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="inlineScreenReaderOnly",o.setAttribute("aria-live","polite"),this._TextBinding=new i.Text.Binding(o,e,n,this,n.accessibilityMessageTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CaccessibilityMessage=a}(si||(si={}));var li=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new ci.C1(n),e,t)},t}(t.ClosedCaptionUploaderVEBase);t.ClosedCaptionUploaderVE=li;var ci;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("form");this.domElement=i,i._context=o,i.setAttribute("method","POST"),i.setAttribute("enctype","multipart/form-data"),i.setAttribute("encoding","multipart/form-data"),i.className="hiddenContent";this.addChild(new e.CinputFilePicker(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("input");this.domElement=o,o._context=n,o.setAttribute("name","file"),o.setAttribute("type","file"),o.setAttribute("title","Upload"),o.className="MyDeviceOptionFilePicker",this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.inputFilePickerAttrArgs),this._AutoUploadBinding=new i.AutoUpload.Binding(o,e,n,this,n.inputFilePickerAutoUploadInitArgs()),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e)},t.prototype.disposeBindings=function(){this._AutoUploadBinding.dispose()},t}(TDB.ViewElement);e.CinputFilePicker=n}(ci||(ci={}));var di=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new ui.CrecordingDialogWrapper(n),e,t)},t}(t.RecordingDialogVEBase);t.RecordingDialogVE=di;var ui;!function(e){var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="recordingDialogWrapper",this._StyleBinding=new i.Style.Binding(r,t,o,this,o.recordingDialogWrapperStyleArgs);this.addChild(new e.CrecordingDialog(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._StyleBinding.update(e)},n}(TDB.ViewElement);e.CrecordingDialogWrapper=n;var o=function(n){function o(e){var t=this,o=TDB.watcherTag(4519824,e,null,e.recordingDialogArgs);return(t=n.call(this,o)||this).addResource(o),t._context=e,t}return __extends(o,n),o.prototype.buildChildren=function(n,o,i){var r=this._context;switch(n){case t.RecordingDialogState.Preparing:this.addChild(new e.Ccountdown(r),o,i);a=TDB.watcherTag(17323653,r,null,r.closeButtonArgs);(s=new TDB.NewSubTemplateInstructionVE(r,a)).addResource(a),this.addChild(s,o,i);break;case t.RecordingDialogState.Recording:this.addChild(new e.CrecordingDuration(r),o,i),this.addChild(new e.CouterCircle(r),o,i),this.addChild(new e.CinnerCircle(r),o,i);a=TDB.watcherTag(17323653,r,null,r.stopButtonArgs);(s=new TDB.NewSubTemplateInstructionVE(r,a)).addResource(a),this.addChild(s,o,i);a=TDB.watcherTag(17323653,r,null,r.pauseButtonArgs);(s=new TDB.NewSubTemplateInstructionVE(r,a)).addResource(a),this.addChild(s,o,i);break;case t.RecordingDialogState.Finished:var a=TDB.watcherTag(17323653,r,null,r.addToSwayButtonArgs),s=new TDB.NewSubTemplateInstructionVE(r,a);s.addResource(a),this.addChild(s,o,i),this.addChild(new e.C1(r),o,i);a=TDB.watcherTag(17323653,r,null,r.reRecordButtonArgs);(s=new TDB.NewSubTemplateInstructionVE(r,a)).addResource(a),this.addChild(s,o,i);a=TDB.watcherTag(17323653,r,null,r.deleteButtonArgs);(s=new TDB.NewSubTemplateInstructionVE(r,a)).addResource(a),this.addChild(s,o,i)}},o}(TDB.SwitchInstructionVE);e.CrecordingDialog=o;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="recordingDialogGetReady",o.setAttribute("aria-live","assertive"),this._TextBinding=new i.Text.Binding(o,e,n,this,n.countdownTextArgs),this._CssBinding=new i.Css.Binding(o,e,n,this,n.countdownCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e),this._CssBinding.update(e)},t}(TDB.ViewElement);e.Ccountdown=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="recordingDialogDuration",this._TextBinding=new i.Text.Binding(o,e,n,this,n.recordingDurationTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CrecordingDuration=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="stopButtonOuterCircle",this._CssBinding=new i.Css.Binding(o,e,n,this,n.outerCircleCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._CssBinding.update(e)},t}(TDB.ViewElement);e.CouterCircle=s;var l=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="stopButtonInnerCircle",this._CssBinding=new i.Css.Binding(o,e,n,this,n.innerCircleCssArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._CssBinding.update(e)},t}(TDB.ViewElement);e.CinnerCircle=l;var c=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="inDialogAudioPlayerWrapper";var i=TDB.watcherTag(17323653,n,null,n.recordingDialogPlayerArgs),r=new TDB.NewSubTemplateInstructionVE(n,i);r.addResource(i),this.addChild(r,o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=c}(ui||(ui={}));var pi=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.contentCards=TDB.methodNewForeachState(o,o.contentCardsArgs),o}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new gi.CifSocketLabel(n),e,t),this.addChild(new gi.C1(n),e,t)},t}(t.ClosedCaptionsSocketContainerCardVEBase);t.ClosedCaptionsSocketContainerCardVE=pi;var gi;!function(e){var t=function(e){function t(t){var n=this,o=TDB.watcherTag(4543754,t,null,t.ifSocketLabelArgs);return(n=e.call(this,o)||this).addResource(o),n._context=t,n}return __extends(t,e),t.prototype.buildChildren=function(e,t){var n=this._context;this.addChild(new Pe.CsocketLabel(n),e,t)},t}(TDB.IfInstructionVE);e.CifSocketLabel=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ClosedCaptionsSocketContainerWrapper";var i=n.contentCards;this.addChild(new TDB.NewForeachInstructionVE(n,i.raw(),void 0,i),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=n}(gi||(gi={}));var hi=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Ci.CviewSettingsLabel(n),e,t);var o=n.allowDuplicationCheckboxArgs();o&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"allowDuplicationCheckbox"),e,t),(o=n.allowPrintCheckboxArgs())&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"allowPrintCheckbox"),e,t),(o=n.allowExportCheckboxArgs())&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"allowExportCheckbox"),e,t),(o=n.allowConsumptionWorldSwitchCheckboxArgs())&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"allowConsumptionWorldSwitchCheckbox"),e,t);var i=TDB.watcherTag(17323653,n,null,n.hideEndOfSwayCheckboxArgs),r=new TDB.NewSubTemplateInstructionVE(n,i,"hideEndOfSwayCheckbox");r.addResource(i),this.addChild(r,e,t)},t}(t.ViewSettingsVEBase);t.ViewSettingsVE=hi;var Ci;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="SwaySettingsPaneSubheading",this._TextBinding=new i.Text.Binding(o,e,n,this,n.viewSettingsLabelTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CviewSettingsLabel=t}(Ci||(Ci={}));var fi=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new mi.C1(n),e,t);var o=n.slidebarArgs();o&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"timingSlidebar"),e,t),(o=n.loopCheckboxArgs())&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(o),"loopCheckbox"),e,t)},t}(t.AuthoringAutoplaySettingsVEBase);t.AuthoringAutoplaySettingsVE=fi;var mi;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="SwaySettingsPaneAutoPlaySubheadingWrapper";this.addChild(new e.CautoPlayLabel(o),i,null),this.addChild(new e.C2(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="SwaySettingsPaneSubheading",this._TextBinding=new i.Text.Binding(o,e,n,this,n.autoPlayLabelTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CautoPlayLabel=n;var o=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="SwaySettignsPaneToggleAutoPlayWrapper";this.addChild(new e.CtoggleAutoPlayLabel(o),i,null);var r=o.toggleAutoPlayArgs();r&&this.addChild(new TDB.NewSubTemplateInstructionVE(o,TDB.immutableWatchable(r),"toggleAutoPlay"),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C2=o;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="SwaySettignsPaneToggleAutoPlayLabel",this._TextBinding=new i.Text.Binding(o,e,n,this,n.toggleAutoPlayLabelTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CtoggleAutoPlayLabel=r}(mi||(mi={}));var yi=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new vi.C1(n),e,t)},t}(t.SwaySettingsPaneVEBase);t.SwaySettingsPaneVE=yi;var vi;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="SwaySettingsPaneEntirePaneWrapper";var r=o.paneHeaderArgs();r&&this.addChild(r.build(o),i,null),this.addChild(new e.C2(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="SwaySettingsPaneSettingsWrapper";this.addChild(new e.C3(o),i,null),o.shouldShowViewSettingsArgs()&&(this.addChild(new e.C4(o),i,null),this.addChild(new e.C5(o),i,null)),this.addChild(new e.CautoplaySettingsVisible(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C2=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="SwaySettingsPaneContainer";var i=n.languageDropdownListArgs();i&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(i),"languageDropdownList"),o,null),(i=n.showTextDirectionButtonCheckboxArgs())&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(i),"showTextDirectionButtonCheckbox"),o,null),(i=n.rtlLayoutCheckboxArgs())&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(i),"rtlLayoutCheckbox"),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C3=o;var i=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="SwaySettingsPaneHorizontalDivider",this._addToDom(e,t)},t}(TDB.ViewElement);e.C4=i;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="SwaySettingsPaneContainer";var i=n.viewSettingsArgs();i&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(i),"viewSettings"),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C5=r;var a=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.autoplaySettingsVisibleArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C4(o),t,n),this.addChild(new e.C7(o),t,n)},n}(TDB.IfInstructionVE);e.CautoplaySettingsVisible=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="SwaySettingsPaneContainer";var i=n.autoplaySettingsArgs();i&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(i),"autoplaySettings"),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C7=s}(vi||(vi={}));var Si=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Ti.Cwrapper(n),e,t)},t}(t.LanguageOptionVEBase);t.LanguageOptionVE=Si;var Ti;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var r=this._context,a=document.createElement("button");this.domElement=a,a._context=r,this._ClassNameBinding=new o.ClassName.Binding(a,t,r,this,r.wrapperClassNameArgs),this._AttrBinding=new i.Attr.Binding(a,t,r,this,r.wrapperAttrArgs),this._FocusableBinding=r.focusableBinding=new i.Focusable.Binding(a,t,r,this,r.FocusableInitArgs());this.addChild(new e.Clanguage(r),a,null);var s=r.chevronIconArgs();s&&this.addChild(s.build(r),a,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._ClassNameBinding.update(e),this._AttrBinding.update(e),this._FocusableBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.Cwrapper=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="SwaySettingsPaneLanguageText",this._TextBinding=new i.Text.Binding(o,e,n,this,n.languageTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.Clanguage=n}(Ti||(Ti={}));var wi=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Ai.CselectedCount(n),e,t)},t}(t.MultiSelectCardLabelVEBase);t.MultiSelectCardLabelVE=wi;var Ai;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="CardMenuSelectedCountText",this._TextBinding=new i.Text.Binding(o,e,n,this,n.selectedCountTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CselectedCount=t}(Ai||(Ai={}));var Ei=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new _i.ChasUrl(n),e,t)},t}(t.HintTextRunVEBase);t.HintTextRunVE=Ei;var _i;!function(e){var t=function(t){function n(e){var n=this,o=TDB.watcherTag(4519824,e,null,e.hasUrlArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n,o){var i=this._context;switch(t){case!0:this.addChild(new e.CTextSpan(i),n,o);break;case!1:this.addChild(new e.CTextSpan1(i),n,o)}},n}(TDB.SwitchInstructionVE);e.ChasUrl=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("a");this.domElement=o,o._context=n,this._FocusableBinding=n.focusableBinding=new i.Focusable.Binding(o,e,n,this,n.FocusableInitArgs()),this._TextBinding=new i.Text.Binding(o,e,n,this,n.TextSpanTextArgs),this._PropsBinding=new i.Props.Binding(o,e,n,this,n.TextSpanPropsArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._FocusableBinding.update(e),this._TextBinding.update(e),this._PropsBinding.update(e)},t.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},t}(TDB.ViewElement);e.CTextSpan=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("span");this.domElement=o,o._context=n,this._TextBinding=new i.Text.Binding(o,e,n,this,n.TextSpanTextArgs),this._PropsBinding=new i.Props.Binding(o,e,n,this,n.TextSpanPropsArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e),this._PropsBinding.update(e)},t}(TDB.ViewElement);e.CTextSpan1=o}(_i||(_i={}));var xi=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Bi.Cwrapper(n),e,t)},t}(t.ImageSocketVEBase);t.ImageSocketVE=xi;var Bi;!function(e){var t=function(t){function o(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(o,t),o.prototype._create=function(t,o){var r=this._context,a=document.createElement("div");this.domElement=a,a._context=r,a.className="ImageSocket",this._AttrBinding=new i.Attr.Binding(a,t,r,this,r.wrapperAttrArgs),this._DistanceFromIPBinding=new n.DistanceFromIP.Binding(a,t,r,this,r.wrapperDistanceFromIPInitArgs()),this._FocusableBinding=r.focusableBinding=new i.Focusable.Binding(a,t,r,this,r.FocusableInitArgs());var s=TDB.watcherTag(17323653,r,null,r.menuArgs),l=new TDB.NewSubTemplateInstructionVE(r,s,"_menu");l.addResource(s),this.addChild(l,a,null),this.addChild(new e.Cimage(r),a,null);var c=r.overlayIconArgs();c&&this.addChild(c.build(r),a,null),this._addToDom(t,o)},o.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._FocusableBinding.update(e)},o.prototype.disposeBindings=function(){this._DistanceFromIPBinding.dispose(),this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},o}(TDB.ViewElement);e.Cwrapper=t;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("img");this.domElement=o,o._context=n,o.className="ImageInImageSocket",this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.imageAttrArgs),this._StyleBinding=new i.Style.Binding(o,e,n,this,n.imageStyleArgs),this._EventsBinding=new i.Events.Binding(o,e,n,this,n.imageEventsInitArgs()),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._StyleBinding.update(e)},t.prototype.disposeBindings=function(){this._EventsBinding.dispose()},t}(TDB.ViewElement);e.Cimage=o}(Bi||(Bi={}));var bi=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Di.C1(n),e,t)},t}(t.SocketMenuVEBase);t.SocketMenuVE=bi;var Di;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="SocketMenu";for(var i=n.cardOptionsArgs(),r=i.length,a=0;a<r;++a)this.addChild(i[a].build(n),o,null);this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=t}(Di||(Di={}));var Mi=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o.expandedCardContent=TDB.methodNewForeachState(o,o.expandedCardContentArgs),o}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Vi.Cbackground(n),e,t),this.addChild(new Vi.CcollapseButtonWrapper(n),e,t);var o=n.expandedCardContent;this.addChild(new TDB.NewForeachInstructionVE(n,o.raw(),void 0,o),e,t)},t}(t.ExpandedCardVEBase);t.ExpandedCardVE=Mi;var Vi;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ContainerCardHeaderBackground",this._StyleBinding=new i.Style.Binding(o,e,n,this,n.backgroundStyleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e)},t}(TDB.ViewElement);e.Cbackground=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ContainerCardHeaderHeader segoeUISemibold",this._StyleBinding=new i.Style.Binding(o,e,n,this,n.collapseButtonWrapperStyleArgs);var r=TDB.watcherTag(17323653,n,null,n.collapseButtonArgs),a=new TDB.NewSubTemplateInstructionVE(n,r,"collapseButton");a.addResource(r),this.addChild(a,o,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e)},t}(TDB.ViewElement);e.CcollapseButtonWrapper=n}(Vi||(Vi={}));var Ii=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Pi.C1(n),e,t),this.addChild(new Pi.Cmessage(n),e,t),this.addChild(new Pi.CifShowCheckboxes(n),e,t)},t}(t.ReportContentPieceDialogContentVEBase);t.ReportContentPieceDialogContentVE=Ii;var Pi;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="ReportDialogImageWrapper";var r=o.imageVisualizatorArgs();r&&this.addChild(r.build(o),i,null),this.addChild(new e.CifShowImageOverlay(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=t;var n=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifShowImageOverlayArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CwholeImageOverlay(o),t,n)},n}(TDB.IfInstructionVE);e.CifShowImageOverlay=n;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var i=this._context,r=document.createElement("div");this.domElement=r,r._context=i,this._ClassNameBinding=new o.ClassName.Binding(r,t,i,this,i.wholeImageOverlayClassNameArgs);this.addChild(new e.CifShowSpinner(i),r,null),this.addChild(new e.CifShowSubmitted(i),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._ClassNameBinding.update(e)},n}(TDB.ViewElement);e.CwholeImageOverlay=r;var a=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifShowSpinnerArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C2(o),t,n)},n}(TDB.IfInstructionVE);e.CifShowSpinner=a;var s=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="SpinnerImageOverlay";var i=n.reportingInProgressSpinnerArgs();i&&this.addChild(i.build(n),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C2=s;var l=function(e){function t(t){var n=this,o=TDB.watcherTag(4543754,t,null,t.ifShowSubmittedArgs);return(n=e.call(this,o)||this).addResource(o),n._context=t,n}return __extends(t,e),t.prototype.buildChildren=function(e,t){var n=this._context,o=n.submittedOverlayIconArgs();o&&this.addChild(o.build(n),e,t)},t}(TDB.IfInstructionVE);e.CifShowSubmitted=l;var c=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ReportDialogMessage",this._TextBinding=new i.Text.Binding(o,e,n,this,n.messageTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.Cmessage=c;var d=function(e){function t(t){var n=this,o=TDB.watcherTag(4543754,t,null,t.ifShowCheckboxesArgs);return(n=e.call(this,o)||this).addResource(o),n._context=t,n}return __extends(t,e),t.prototype.buildChildren=function(e,t){for(var n=this._context,o=n.reportReasonCheckboxesArgs(),i=o.length,r=0;r<i;++r)this.addChild(o[r].build(n),e,t)},t}(TDB.IfInstructionVE);e.CifShowCheckboxes=d}(Pi||(Pi={}));var ki=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Ri.CifOnSurfaceTextEditor(n),e,t)},t}(t.OnSurfaceTextEditorVEBase);t.OnSurfaceTextEditorVE=ki;var Ri;!function(e){var t=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifOnSurfaceTextEditorArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.C1(o),t,n)},n}(TDB.IfInstructionVE);e.CifOnSurfaceTextEditor=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="OnSurfaceTextEditor";this.addChild(new TDB.SubTemplateInstructionVE(!1,n.textEditorArgs()),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=n}(Ri||(Ri={}));var Li=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Ui.CParagraph(n),e,t)},t}(t.AuthoringHintVEBase);t.AuthoringHintVE=Li;var Ui;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.ParagraphAttrArgs),this._PropsBinding=new i.Props.Binding(o,e,n,this,n.ParagraphPropsArgs);var r=TDB.watcherTag(17323652,n,null,n.runChildrenArgs),a=new TDB.NewForeachInstructionVE(n,r);a.addResource(r),this.addChild(a,o,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._PropsBinding.update(e)},t}(TDB.ViewElement);e.CParagraph=t}(Ui||(Ui={}));var Fi=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Ni.CifButtonWrapper(n),e,t)},t}(t.ContainerCardHeaderButtonVEBase);t.ContainerCardHeaderButtonVE=Fi;var Ni;!function(e){var t=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifButtonWrapperArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.Cwrapper(o),t,n)},n}(TDB.IfInstructionVE);e.CifButtonWrapper=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var r=this._context,a=document.createElement("button");this.domElement=a,a._context=r,this._FocusableBinding=r.focusableBinding=new i.Focusable.Binding(a,t,r,this,r.FocusableInitArgs()),this._ClassNameBinding=new o.ClassName.Binding(a,t,r,this,r.wrapperClassNameArgs),this._StyleBinding=new i.Style.Binding(a,t,r,this,r.wrapperStyleArgs),this._AttrBinding=new i.Attr.Binding(a,t,r,this,r.wrapperAttrArgs);this.addChild(new e.C1(r),a,null);var s=TDB.watcherTag(17323653,r,null,r.labelArgs),l=new TDB.NewSubTemplateInstructionVE(r,s);l.addResource(s),this.addChild(l,a,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._FocusableBinding.update(e),this._ClassNameBinding.update(e),this._StyleBinding.update(e),this._AttrBinding.update(e)},n.prototype.disposeBindings=function(){this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},n}(TDB.ViewElement);e.Cwrapper=n;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="CenteredIcon";var i=n.collapseIconArgs();i&&this.addChild(i.build(n),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=r}(Ni||(Ni={}));var Oi=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Wi.Cwrapper(n),e,t)},t}(t.ClosedCaptionSocketVEBase);t.ClosedCaptionSocketVE=Oi;var Wi;!function(e){var t=function(t){function r(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(r,t),r.prototype._create=function(t,r){var a=this._context,s=document.createElement("div");this.domElement=s,s._context=a,s.className="BasicCard LabeledCard ClosedCaptionSocketCard",this._AttrBinding=new i.Attr.Binding(s,t,a,this,a.wrapperAttrArgs),this._DraggableBinding=new i.Draggable.Binding(s,t,a,this,a.wrapperDraggableInitArgs(),a.wrapperDraggableOptionsArgs),this._StyleBinding=new i.Style.Binding(s,t,a,this,a.wrapperStyleArgs),this._CssBinding=new i.Css.Binding(s,t,a,this,a.wrapperCssArgs),this._ScrollIntoViewBinding=new o.ScrollIntoView.Binding(s,t,a,this,a.wrapperScrollIntoViewInitArgs(),a.wrapperScrollIntoViewArgs),this._DistanceFromIPBinding=new n.DistanceFromIP.Binding(s,t,a,this,a.wrapperDistanceFromIPInitArgs()),this._FloatingMenuBinding=new n.FloatingMenu.Binding(s,t,a,this,a.wrapperFloatingMenuInitArgs(),a.wrapperFloatingMenuArgs),this._FocusableBinding=a.focusableBinding=new i.Focusable.Binding(s,t,a,this,a.FocusableInitArgs()),this._EventsBinding=new i.Events.Binding(s,t,a,this,a.wrapperEventsInitArgs()),this._TouchToMouseBinding=new o.TouchToMouse.Binding(s,t,a,this,a.wrapperTouchToMouseArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);this.addChild(new e.C1(a),s,null),this.addChild(new e.CifErrorMessage(a),s,null),this._addToDom(t,r)},r.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._DraggableBinding.update(e),this._StyleBinding.update(e),this._CssBinding.update(e),this._ScrollIntoViewBinding.update(e),this._FloatingMenuBinding.update(e),this._FocusableBinding.update(e),this._TouchToMouseBinding.update(e)},r.prototype.disposeBindings=function(){this._DraggableBinding.dispose(),this._DistanceFromIPBinding.dispose(),this._FloatingMenuBinding.dispose(),this._FocusableBinding.dispose(),this._EventsBinding.dispose(),this._TouchToMouseBinding.dispose(),this._context.focusableBinding=void 0},r}(TDB.ViewElement);e.Cwrapper=t;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="ClosedCaptionLabelWrapper";var r=TDB.watcherTag(17323653,o,null,o.labelArgs),a=new TDB.NewSubTemplateInstructionVE(o,r);a.addResource(r),this.addChild(a,i,null),this.addChild(new e.C2(o),i,null),this.addChild(new e.ClanguageSpinnerWrapper(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ClosedCaptionMenuWrapper";var i=TDB.watcherTag(17323653,n,null,n.menuArgs),r=new TDB.NewSubTemplateInstructionVE(n,i,"_menu");r.addResource(i),this.addChild(r,o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C2=a;var s=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="ClosedCaptionLanguageSpinnerWrapper",this._PositionBinding=o.languageSpinnerWrapperPositionBinding=new i.Position.Binding(r,t,o,this);this.addChild(new e.ClanguageDropdownPlaceholderVisible(o),r,null);var a=TDB.watcherTag(17323653,o,null,o.languageDropdownListArgs),s=new TDB.NewSubTemplateInstructionVE(o,a,"languageDropdownList");s.addResource(a),this.addChild(s,r,null),this.addChild(new e.Cspinner(o),r,null),this._addToDom(t,n)},n.prototype.disposeBindings=function(){this._context.languageSpinnerWrapperPositionBinding=void 0},n}(TDB.ViewElement);e.ClanguageSpinnerWrapper=s;var l=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.languageDropdownPlaceholderVisibleArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.ClanguageDropdownPlaceholder(o),t,n)},n}(TDB.IfInstructionVE);e.ClanguageDropdownPlaceholderVisible=l;var c=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ClosedCaptionSocketLanguagePickerPlaceholder",this._TextBinding=new i.Text.Binding(o,e,n,this,n.languageDropdownPlaceholderTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.ClanguageDropdownPlaceholder=c;var d=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ClosedCaptionSocketCardSpinner",this._StyleBinding=new i.Style.Binding(o,e,n,this,n.spinnerStyleArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._StyleBinding.update(e)},t}(TDB.ViewElement);e.Cspinner=d;var u=function(t){function n(e){var n=this,o=TDB.watcherTag(4543754,e,null,e.ifErrorMessageArgs);return(n=t.call(this,o)||this).addResource(o),n._context=e,n}return __extends(n,t),n.prototype.buildChildren=function(t,n){var o=this._context;this.addChild(new e.CclosedCaptionErrorWrapper(o),t,n)},n}(TDB.IfInstructionVE);e.CifErrorMessage=u;var p=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="ClosedCaptionErrorWrapper",this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.closedCaptionErrorWrapperAttrArgs);this.addChild(new e.CerrorMessage(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e)},n}(TDB.ViewElement);e.CclosedCaptionErrorWrapper=p;var g=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="ClosedCaptionErrorText",this._TextBinding=new i.Text.Binding(o,e,n,this,n.errorMessageTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CerrorMessage=g}(Wi||(Wi={}));var Hi=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Gi.Cwrapper(n),e,t)},t}(t.AudioThumbnailSocketVEBase);t.AudioThumbnailSocketVE=Hi;var Gi;!function(e){var t=function(t){function o(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(o,t),o.prototype._create=function(t,o){var r=this._context,a=document.createElement("div");this.domElement=a,a._context=r,a.className="AudioThumbnailSocket",this._AttrBinding=new i.Attr.Binding(a,t,r,this,r.wrapperAttrArgs),this._DistanceFromIPBinding=new n.DistanceFromIP.Binding(a,t,r,this,r.wrapperDistanceFromIPInitArgs()),this._FocusableBinding=r.focusableBinding=new i.Focusable.Binding(a,t,r,this,r.FocusableInitArgs());var s=TDB.watcherTag(17323653,r,null,r.menuArgs),l=new TDB.NewSubTemplateInstructionVE(r,s,"_menu");l.addResource(s),this.addChild(l,a,null),this.addChild(new e.Cimage(r),a,null),this._addToDom(t,o)},o.prototype.onUpdate=function(e){this._AttrBinding.update(e),this._FocusableBinding.update(e)},o.prototype.disposeBindings=function(){this._DistanceFromIPBinding.dispose(),this._FocusableBinding.dispose(),this._context.focusableBinding=void 0},o}(TDB.ViewElement);e.Cwrapper=t;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("img");this.domElement=o,o._context=n,o.className="ImageInAudioThumbnailSocket",this._AttrBinding=new i.Attr.Binding(o,e,n,this,n.imageAttrArgs),this._EventsBinding=new i.Events.Binding(o,e,n,this,n.imageEventsInitArgs()),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._AttrBinding.update(e)},t.prototype.disposeBindings=function(){this._EventsBinding.dispose()},t}(TDB.ViewElement);e.Cimage=o}(Gi||(Gi={}));var zi=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new ji.C1(n),e,t)},t}(t.CastDoneHeaderVEBase);t.CastDoneHeaderVE=zi;var ji;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="shareCastDoneWrapper";var i=n.castDoneButtonArgs();i&&this.addChild(i.build(n),o,null);var r=TDB.watcherTag(17323653,n,null,n.calloutArgs),a=new TDB.NewSubTemplateInstructionVE(n,r);a.addResource(r),this.addChild(a,o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=t}(ji||(ji={}));var Ki=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new qi.CmenuItemWrapper(n),e,t)},t}(t.CardMenuOverflowVEBase);t.CardMenuOverflowVE=Ki;var qi;!function(e){var t=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,i=document.createElement("div");this.domElement=i,i._context=n,i.className="CardMenuOverflowWrapper",this._SlideVisibleBinding=new o.SlideVisible.Binding(i,e,n,this,n.menuItemWrapperSlideVisibleInitArgs(),n.menuItemWrapperSlideVisibleArgs),this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite);var r=TDB.watcherTag(17323652,n,null,n.menuItemsArgs),a=new TDB.NewForeachInstructionVE(n,r);a.addResource(r),this.addChild(a,i,null),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._SlideVisibleBinding.update(e)},t}(TDB.ViewElement);e.CmenuItemWrapper=t}(qi||(qi={}));var Ji=function(e){function t(t,n){var o=e.call(this,t,n)||this;return o._subscribeToWatchable(o._updateScrollingWatcher=TDB.watcherTag(5796370,o,o,o.updateScrolling),TDB.UpdatePhase.ReadWrite),o}return __extends(t,e),t.prototype._create=function(e,t){this.receivePhaseNotification(TDB.UpdatePhase.ReadWrite)},t.prototype.onUpdate=function(e){e===TDB.UpdatePhase.ReadWrite&&this._updateScrollingWatcher.resolve()},t}(t.AutoScrollerVEBase);t.AutoScrollerVE=Ji;var $i=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Qi.Cwrapper(n),e,t)},t}(t.HelpUsImproveSurveyVEBase);t.HelpUsImproveSurveyVE=$i;var Qi;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,r=document.createElement("div");this.domElement=r,r._context=o,r.className="helpUsImproveSurvey",this._AttrBinding=new i.Attr.Binding(r,t,o,this,o.wrapperAttrArgs);this.addChild(new e.CsurveyHeading(o),r,null),this.addChild(new e.CrateSwayQuestion(o),r,null);var a=o.ratingStarsSliderArgs();a&&this.addChild(new TDB.NewSubTemplateInstructionVE(o,TDB.immutableWatchable(a),"ratingStarsSlider"),r,null),(a=o.textAreaFeedbackArgs())&&this.addChild(new TDB.NewSubTemplateInstructionVE(o,TDB.immutableWatchable(a),"textAreaFeedback"),r,null),this.addChild(new e.C1(o),r,null),this.addChild(new e.C2(o),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._AttrBinding.update(e)},n}(TDB.ViewElement);e.Cwrapper=t;var n=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="feedbackSurveyHeading segoeUISemilight",this._TextBinding=new i.Text.Binding(o,e,n,this,n.surveyHeadingTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CsurveyHeading=n;var o=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="rateSwayQuestion segoeUIRegular",this._TextBinding=new i.Text.Binding(o,e,n,this,n.rateSwayQuestionTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.CrateSwayQuestion=o;var r=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="helpUsImproveCheckBoxWrapper";var i=n.copySwayCheckboxArgs();i&&this.addChild(new TDB.NewSubTemplateInstructionVE(n,TDB.immutableWatchable(i),"copySwayCheckbox"),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C1=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="feedbackSurveyButtonsWrapper";var i=n.submitButtonArgs();i&&this.addChild(i.build(n),o,null),(i=n.dismissButtonArgs())&&this.addChild(i.build(n),o,null),this._addToDom(e,t)},t}(TDB.ViewElement);e.C2=a}(Qi||(Qi={}));var Xi=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype._create=function(e,t){var n=this;this.addChild(new Zi.Cwrapper(n),e,t)},t}(t.OfflineVellumVEBase);t.OfflineVellumVE=Xi;var Zi;!function(e){var t=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var i=this._context,r=document.createElement("div");this.domElement=r,r._context=i,r.className="offlineVellum",r.setAttribute("aria-describedby","offlineVellumDescription"),r.setAttribute("role","group"),this._FadeVisibleBinding=new o.FadeVisible.Binding(r,t,i,this,i.wrapperFadeVisibleInitArgs(),i.wrapperFadeVisibleArgs);this.addChild(new e.C1(i),r,null),this._addToDom(t,n)},n.prototype.onUpdate=function(e){this._FadeVisibleBinding.update(e)},n.prototype.disposeBindings=function(){this._FadeVisibleBinding.dispose()},n}(TDB.ViewElement);e.Cwrapper=t;var n=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="offlineVellumWrapper",i.setAttribute("role","presentation");this.addChild(new e.C2(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C1=n;var r=function(t){function n(e){var n=t.call(this,null)||this;return n._context=e,n}return __extends(n,t),n.prototype._create=function(t,n){var o=this._context,i=document.createElement("div");this.domElement=i,i._context=o,i.className="offlineVellumContentWrapper",i.setAttribute("role","presentation");this.addChild(new e.Cdescription(o),i,null),this._addToDom(t,n)},n}(TDB.ViewElement);e.C2=r;var a=function(e){function t(t){var n=e.call(this,null)||this;return n._context=t,n}return __extends(t,e),t.prototype._create=function(e,t){var n=this._context,o=document.createElement("div");this.domElement=o,o._context=n,o.className="offlineVellumDescription",this._TextBinding=new i.Text.Binding(o,e,n,this,n.descriptionTextArgs),this._addToDom(e,t)},t.prototype.onUpdate=function(e){this._TextBinding.update(e)},t}(TDB.ViewElement);e.Cdescription=a}(Zi||(Zi={}))}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.AuthoringModel,o=StoryApp.Model.RM,i=StoryApp.View.ViewElements,r=e.View.ViewElements,a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.commandType=r.CommandType.CopyLink,t.buttonArgs={buttonId:ClientAction.ButtonId.Edit_Canvas_OOUI_CopyLinkButton,fontIconName:FontIcons.CopyLinkContextIcon,fontIconSizeClass:FontIcons.CopyLinkContextIconSize,text:Resources.ContextMenuCopyLinkButton},t}return __extends(t,e),t.prototype.isSupported=function(e){return CommonSettings.ContentNavigationEnabled},t.prototype.clickAction=function(e,t){var r=t.groupChild;switch(t.contentType){case o.ContentType.Title:case o.ContentType.Caption:case o.ContentType.Text:r=n.currentStoryController().get(this.args.pageId).findParent(r)}var a=i.RestoreState.generateRestoreUrl(r?r.id:null,!1);return ActionLogger.RecordClientAction(new ClientAction.ShareStoryDataFromContextualUI(ClientAction.ActionType.Edit_Canvas_OOUI_CopyLinkAction,!!a,"","",o.ContentType[t.contentType])),a&&i.StoryShareAction.shareViewLink(a,ClientAction.ButtonId.Edit_Canvas_OOUI_CopyLinkButton,this.args.sharingManager),this.args.selectionManager.deselectElements(),TDB.EventPropagation.Bypass},t}(t.GlyphCommandButtonViewModel);t.CopyLinkCommandViewModel=a}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.Model.RM,o=function(o){function i(){var e=null!==o&&o.apply(this,arguments)||this;return e.commandType=EditVE.CommandType.Delete,e.buttonArgs={buttonId:ClientAction.ButtonId.OOUI_Delete,fontIconName:FontIcons.DeleteContextIcon,fontIconSizeClass:FontIcons.DeleteContextIconSize,text:Resources.ContextMenuDeleteButton},e}return __extends(i,o),i.prototype.isSupported=function(e){return t.DeleteAction.isAvailable([e.groupChild],this.args.pageId,e.contentType)},i.prototype.clickAction=function(o,i){var r=this;return ActionLogger.RecordClientAction(new ClientAction.ContextualUIData(ClientAction.ActionType.Edit_Canvas_OOUI_DeleteAction,"User deleted an item","","",n.ContentType[i.contentType])),e.Model.currentUndoManager().get(this.args.pageId).captureUserUpdate(function(){i.contentType==n.ContentType.Title?EditVE.DeleteHeaderTextAction.execute([i.groupChild]):t.DeleteAction.execute([i.groupChild],r.args.pageId,"OOUI Delete"),r.args.selectionManager.deselectElements()},"User used the delete button via OOUI"),TDB.EventPropagation.Bypass},i}(t.GlyphCommandButtonViewModel);t.DeleteCommandViewModel=o}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=StoryApp.Model.RM,i=e.View.ViewElements,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.commandType=i.CommandType.Edit,t.buttonArgs={buttonId:ClientAction.ButtonId.OOUI_Edit,fontIconName:FontIcons.EditContextIcon,fontIconSizeClass:FontIcons.EditContextIconSize,text:Resources.ContextMenuEditButton},t}return __extends(t,e),t.prototype.isSupported=function(e){return i.EditAction.isAvailable([e.groupChild])},t.prototype.clickAction=function(e,t){ActionLogger.RecordClientAction(new ClientAction.ContextualUIData(ClientAction.ActionType.Edit_Canvas_OOUI_EditAction,"User invoked the short text editor","","",o.ContentType[t.contentType]));var r={shortTextUX:this.args.shortTextEditor,selectedParagraph:t.originalGroupChild instanceof n.Paragraph?t.originalGroupChild:void 0};return this.args.selectionManager.hideSelectionUX(),i.EditAction.execute([t.groupChild],r),TDB.EventPropagation.Bypass},t}(t.GlyphCommandButtonViewModel);t.EditCommandViewModel=r}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=StoryApp.Model.RM,o=e.View.ViewElements,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.commandType=o.CommandType.EditImage,t.buttonArgs={buttonId:ClientAction.ButtonId.OOUI_Focus,fontIconName:FontIcons.FocusPointsContextIcon,fontIconSizeClass:FontIcons.FocusPointsContextIconSize,text:Resources.ContextMenuEditImageButton},t}return __extends(t,e),t.prototype.isSupported=function(e){return StoryPageEditSettings.SmartFocusUIEnabled&&o.EditImageAction.isAvailable([e.groupChild])},t.prototype.clickAction=function(e,t){return ActionLogger.RecordClientAction(new ClientAction.ContextualUIData(ClientAction.ActionType.Edit_Canvas_OOUI_EditImageAction,"User opened edit image pane","","",n.ContentType[t.contentType])),this.args.contextMenu.isVisible()&&this.args.contextMenu.exit(),o.EditImageAction.execute([t.groupChild],this.args.paneStateManager),TDB.EventPropagation.Bypass},t}(t.GlyphCommandButtonViewModel);t.EditImageCommandViewModel=i}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=StoryApp.Model.RM,n=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.commandType=EditVE.CommandType.Emphasis,t.buttonArgs={buttonId:ClientAction.ButtonId.OOUI_Emphasis,fontIconName:FontIcons.CardMenuOptionsIcon,fontIconSizeClass:FontIcons.CardMenuOptionsIconSize,text:Resources.CardDeckMenuEmphasisLabel,useGlyphIconText:!0,isActive:function(e){return t.isActive(e)}},t}return __extends(n,e),n.prototype.isActive=function(e){return this.args.contextMenu.getFlyoutType(e)===EditVE.ContextMenuFlyoutType.Emphasis},n.prototype.isSupported=function(e){return EditVE.SetEmphasisAction.isAvailable([e.groupChild],this.args.pageId)},n.prototype.clickAction=function(e,n){return ActionLogger.RecordClientAction(new ClientAction.ContextualUIData(ClientAction.ActionType.Edit_Canvas_OOUI_EmphAction,"User entered the emphasis submenu","","",t.ContentType[n.contentType])),this.args.contextMenu.toggleEmphasisFlyout(),TDB.EventPropagation.Bypass},n}(e.ToggleCommandButtonViewModel);e.EmphasisCommandViewModel=n}(e.ViewModel||(e.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Model.SM,o=e.Model.AuthoringModel,i=e.View.ViewElements,r=function(t){function r(e){var n=t.call(this,e)||this;return n.commandType=i.CommandType.Emphasis,n.emphasisLevel=e.emphasisLevel,n.buttonArgs=n.getButtonArgs(),n}return __extends(r,t),r.prototype.getButtonArgs=function(){var e,t,o,i=this;switch(this.emphasisLevel){case n.EmphasisLevel.None:e=ClientAction.ButtonId.OOUI_NoneEmphasis,t=FontIcons.EmphasisNoneIcon,o=Resources.StyleHintsEmphasis1;break;case n.EmphasisLevel.More:e=ClientAction.ButtonId.OOUI_MoreEmphasis,t=FontIcons.EmphasisMoreIcon,o=Resources.StyleHintsEmphasis2;break;case n.EmphasisLevel.Very:e=ClientAction.ButtonId.OOUI_VeryEmphasis,t=FontIcons.EmphasisVeryIcon,o=Resources.StyleHintsEmphasis3;break;default:TDB.raiseRecoverableError("unknown emphasis level"),e=ClientAction.ButtonId.OOUI_NoneEmphasis,t=FontIcons.EmphasisNoneIcon,o=Resources.StyleHintsEmphasis1}return{fontIconSizeClass:FontIcons.EmphasisIconSize,isActive:function(e){return i.calculateActive(e)},buttonId:e,fontIconName:t,text:o}},r.prototype.isSupported=function(e){return!0},r.prototype.calculateCssClass=function(e){return"ContextHeroCommandButton"},r.prototype.calculateActive=function(e){var t=e.watchValue(this.args.contextMenu.element);if(!t||!o.StoryController.isModelObjectValid(t.groupChild))return!1;var i=o.ObjectController.calculateActiveEmphasisLevel([t.groupChild]);return i===n.EmphasisLevel.Auto&&(i=n.EmphasisLevel.None),i===this.args.emphasisLevel},r.prototype.clickAction=function(t,r){var a=this,s=o.ObjectController.calculateActiveEmphasisLevel([r.groupChild]);return e.Model.currentUndoManager().get(this.args.contextMenu.getPageId()).captureUserUpdate(function(){i.SetEmphasisAction.execute([r.groupChild],{emphasisLevel:a.args.emphasisLevel},a.args.contextMenu.getPageId())},"User used the emphasis button via OOUI"),ActionLogger.RecordClientAction(new ClientAction.EmphasisLevelData(Diag.ULSCat.msoulscat_Story_ContextualUI,ClientAction.ActionType.Edit_Canvas_OOUI_ChangeEmphAction,"User changed the emphasis level",[n.EmphasisLevel[s]],n.EmphasisLevel[this.args.emphasisLevel],[r.groupChild.id])),this.args.selectionManager.deselectElements(),TDB.EventPropagation.Bypass},r}(t.ToggleCommandButtonViewModel);t.EmphasisLevelCommandViewModel=r}(t.ViewModel||(t.ViewModel={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryAppEdit;!function(e){!function(t){!function(t){var n=e.Server.Decomposition.WP,o=StoryApp.View.Common.FRE,i=e.Model.AuthoringModel,r=function(e){function r(n,o){var i=this,r=new t.AddContentVE(n,{cardsContainer:o.cardsContainer,commonSettings:CommonSettings,fileUploader:o.fileUploader,resourceFactory:o.resourceFactory,storyPageEditSettings:StoryPageEditSettings,pageFactory:new t.AddContentPageFactory,paneStateManager:n.getPaneStateManager(),contentSourcesManager:o.contentSourcesManager});return i=e.call(this,n,{content:r,paneType:t.AuthoringPaneType.Content,css:"AddContentPane",paneStateManager:o.paneStateManager,storyPageState:o.storyPageState})||this,i._addContent=r,i.addResource(i._addContent),i.sourceCardType=TDB.watchableTag(596473299,i,void 0),i.resourceFactory=o.resourceFactory,i.contentSourcesManager=o.contentSourcesManager,i}return __extends(r,e),r.prototype.setFocus=function(){var e=this;this.parent.addContentSourceDropdownFirstRun.getValue()&&!CommonSettings.FREAddContentPaneEnabled?(this._addContent.sourceSelector.openFlyout(),TDB.applyUpdate(function(){e.parent.addContentSourceDropdownFirstRun.setValue(!1)})):this._addContent.sourceSelector.getSelectorButton().setFocus()},r.prototype.selectPrefferedSource=function(e){var n=[];if(void 0===e||!t.AddContentVE.sourceFilteringEnabled(StoryPageEditSettings))return null;n=StoryPageEditSettings.PrefferedContentSources[t.CardType[e].toString()];for(var o=this,i=0;i<n.length;i++){var r=function(e){var t=o.contentSourcesManager.getContentSources().firstOrDefault(function(t){return t.displayName===n[e]});if(null!=t)return{value:t}}(i);if("object"==typeof r)return r.value}return null},r.prototype.setSourceCardType=function(e){var t=this;TDB.applyUpdate(function(){t.sourceCardType.setValue(e)})},r.prototype.setVisible=function(r){var a=this,s=e.prototype.isVisible.call(this);if(e.prototype.setVisible.call(this,r),r){var l=this.selectPrefferedSource(this.sourceCardType.getValue());null!=l&&TDB.applyUpdate(function(){a._addContent.sourceSelector.sourceClicked(l,a.sourceCardType.getValue())}),this._addContent.searchClustersEnabled()&&ArrayExtensions.contains(StoryPageEditSettings.ClusterStripeEnabledPanes,this._addContent.getContentSource().providerType)&&this._addContent.clusterStripe.requestSuggestedClusters(n.SuggestionsRequestType.FocusChanged);var c=this._addContent.getSelectedContentPage();if(c&&c.onNavigateTo(),CommonSettings.FREAddContentPaneEnabled&&!s&&!o.StoryFirstRunHelper.ignoreContentPaneShowHide()){var d=this._addContent.getSelectedContentPage(),u=!d||d.canSearch();o.FirstRunTriggers.contentPaneOpened(!i.StoryController.isStoryEmpty(!0),u)}}else CommonSettings.FREAddContentPaneEnabled&&s&&!o.StoryFirstRunHelper.ignoreContentPaneShowHide()&&o.FirstRunTriggers.contentPaneClosed();var p=this._addContent.selectedSource.getValue(),g=r?ClientAction.ActionType.Edit_AddContentUI_Open:ClientAction.ActionType.Edit_AddContentUI_Close,h=void 0===this.sourceCardType.getValue()?"":t.CardType[this.sourceCardType.getValue()].toString(),C=new ClientAction.AddContentUIPaneData(g,"",p?p.providerType:void 0,h);ActionLogger.RecordClientAction(C)},r.prototype.getAddContent=function(){return this._addContent},r}(t.AuthoringPaneVE);t.ContentPaneVE=r}(t.ViewElements||(t.ViewElements={}))}(e.View||(e.View={}))}(StoryAppEdit||(StoryAppEdit={}));var StoryEditPageMain;!function(e){var t=StoryAppEdit.Model.SM,n=StoryAppEdit.Model.AuthoringModel,o=StoryAppEdit.Server.AuthorsManager,i=StoryAppEdit.Server.NotificationBus,r=StoryApp.View.ViewElements,a=StoryApp.View.Common,s=StoryAppEdit.View.ViewElements,l=StoryAppEdit.View.ViewModel,c=StoryApp.Common,d=function(){function d(){}return d.prototype.setupForInitialize=function(e){return Task.fromResult(e)},d.prototype.setupEditorManager=function(e,t){d.setupEditorManagerBase(e,t)},d.setupEditorManagerBase=function(e,t){var n=new o.AuthorsManagerAPI(c.UrlHelper.getInstance()),r=new o.AuthorsManager(i.currentNotificationManager().get(t),n,e.clientId,e.authors);o.currentAuthorsManager().set(t,r)},d.prototype.createView=function(e,t,n,o,i,r){var l=new a.CurrentStory(StoryPageSettings,StoryApp.Model.RenderModel,o),c=new s.ContentUploaderFactory,u=d.appBarButtonsToCreate(),p=d.overflowMenuButtonsToCreate();d.createViewBase(e,l,t,o,{contentUploaderFactory:c,sharingManager:i,resourceFactory:n},u,p,n,i,r)},d.prototype.deleteView=function(){d.viewModel=null},d.appBarButtonsToCreate=function(){return[r.AppBarButtonLabel.Home,r.AppBarButtonLabel.Panels,r.AppBarButtonLabel.Remix,r.AppBarButtonLabel.Undo,r.AppBarButtonLabel.DeveloperCdn,r.AppBarButtonLabel.InternalFeatures,r.AppBarButtonLabel.Play,r.AppBarButtonLabel.Cast,r.AppBarButtonLabel.Authors,r.AppBarButtonLabel.Share,r.AppBarButtonLabel.TutorialVideos,r.AppBarButtonLabel.Overflow]},d.overflowMenuButtonsToCreate=function(){var e=[r.OverflowButtonLabel.InternalFeatures,r.OverflowButtonLabel.PremiumFeatures,r.OverflowButtonLabel.MyStories,r.OverflowButtonLabel.CreateNew,r.OverflowButtonLabel.DuplicateStory,r.OverflowButtonLabel.SaveAsTemplate,r.OverflowButtonLabel.Download,r.OverflowButtonLabel.Feedback,r.OverflowButtonLabel.Help,r.OverflowButtonLabel.User,r.OverflowButtonLabel.SignOut,r.OverflowButtonLabel.AccessibilityView];return CommonSettings.IsExportStoryEnabled&&(e.push(r.OverflowButtonLabel.ExportStory),e.push(r.OverflowButtonLabel.PrintStory)),StoryPageEditSettings.SwaySettingsPaneEnabled&&e.push(r.OverflowButtonLabel.SwaySettingsPane),StoryPageSettings.AccessibilityCheckerEnabled&&e.push(r.OverflowButtonLabel.AccessibilityChecker),e},d.createViewBase=function(e,t,n,o,i,a,l,u,p,g){return d.viewModel=new s.StoryPageEditVE(e,{textAggregator:n,userState:c.UserState.getInstance(),currentStory:t,syncManager:o,authoringPageArgs:i,appBarButtonsToCreate:a,overflowMenuButtonsToCreate:l,sharingManager:p,resourceFactory:u,scrollPositionTelemetry:r.ScrollPositionTelemetry.getInstance(),historyClientId:g}),r.ViewModel=d.viewModel,d.viewModel},d.prototype.setupView=function(e,t,n,o){d.setupViewBase(e,t,n,o)},d.setupViewBase=function(e,t,n,o){d.viewModel.setup(e,t,n,o)},d.prototype.setInitDomFocus=function(){d.viewModel.initDomFocus()},d.prototype.initializeUndo=function(e,t,n){d.initializeUndoBase(e,t,n)},d.initializeUndoBase=function(e,n,o){StoryAppEdit.Model.currentUndoManager().get(o).initialize(e[t.StoryModel.ModelType],n,d.viewModel.getAuthoringModel().getFocusableViewElement(),d.viewModel.isEditMode)},d.prototype.setupUponStoryLoad=function(){d.setupUponStoryLoadBase()},d.setupUponStoryLoadBase=function(){ActionLogger.RecordClientAction(new ClientAction.PageLoadActionData(r.PageRootScenario[r.PageRootScenario.OpenStory_Edit],document.referrer,r.ViewModel.getWorldId().toString(),r.ViewModel.getLayoutStyleId().toString())),CommonSettings.ContextualFirstRunEnabled||d.viewModel.getAuthoringModel().firstRunManager.setup()},d.prototype.createTextAggregator=function(){return d.createTextAggregatorBase()},d.createTextAggregatorBase=function(){return new l.TextAggregator},d.prototype.initializeAgaveEditMode=function(e){d.initializeAgaveEditModeBase(e)},d.initializeAgaveEditModeBase=function(e){var t=function(t,o){if(t){var i=n.currentStoryController().get(e).getModel().getModelObject(t);if(i&&i.setAgaveSettings){if(r.ViewModel&&r.ViewModel.previewVE){var a=r.ViewModel.previewVE._root.getValue();a&&a.setBlockUpdateBindings(!0)}StoryAppEdit.Model.currentUndoManager().get(e).captureIgnorableUpdate(function(){i.setAgaveSettings(o)},t)}}};StoryApp.Agaves.setSaveSettingsCallback(t)},d.prototype.syncResponseCallback=function(){},d.prototype.emptySyncResponseCallback=function(){StoryLog.TraceTag(596475907,Diag.ULSCat.msoulscat_Story_RequestManager,Diag.ULSTraceLevel.info,"Received sync response with no changes")},d.prototype.acknowledgeSyncResponse=function(e){return $.Deferred().resolve()},d.prototype.shouldRefreshImmediately=function(){return!1},d.prototype.getShouldPostAsString=function(){return!1},d.prototype.refreshPage=function(){location.reload()},d.prototype.stopRefreshingEditors=function(e){var t=o.currentAuthorsManager().get(e);t&&t.stopRefreshingAuthors()},d.prototype.createControllers=function(e){n.ControllersFactory.createControllers(e)},d.prototype.createFirstModelJoiner=function(){return new e.FirstModelJoiner},d}();e.SetupHelpers=d,e.createSetupHelpers=function(){return new d}}(StoryEditPageMain||(StoryEditPageMain={}));var SharingUiInit;!function(e){function t(t,s){StoryPageSettings.VisualLinkMode=VisualLinkMode.Disabled,CommonSettings.PasswordProtectedSwaysEnabled=!1,n("",s);var l=new i.ShareDropdownViewModel({shareEnabled:TDB.immutableWatchable(!0),titleWatcher:TDB.immutableWatchable(t),sharingManager:StoryPageMain.createSharingManager(),authorsManager:o.currentAuthorsManager().get(s),getStoryTitle:function(){return t},context:i.ShareDropdownContext.Edit,showLinkTypeSelector:!1,showEmbedButton:!1}),c={contentArgs:{closeMenu:e.closeMenu,onShowDialog:function(){},onRevokeLinkSuccess:a,model:l}};return function(e){return new r.ShareFrameVE(e,c)}}function n(e,t){var n={createListener:function(){return{listen:function(){return $.Deferred()}}},sendMessage:function(){return $.Deferred()}},i=new o.AuthorsManagerAPI(StoryAppCommon.UrlHelper.getInstance()),r=new o.AuthorsManager(n,i,e,[]);o.currentAuthorsManager().set(t,r)}var o=StoryAppEdit.Server.AuthorsManager,i=StoryAppEdit.View.ViewModel,r=StoryAppEdit.View.ViewElements;e.CreateAuthorSharingFrame=t;var a=function(e){window.parent.postMessage(JSON.stringify({name:"share_linkrevoked",newUrl:e}),CommonSettings.SiteRootUrl)}}(SharingUiInit||(SharingUiInit={}));var StoryAppEdit;!function(e){!function(e){!function(e){var t=function(){function e(){}return e.TitleId="Title",e.rootSectionId="RootSection",e.TextId="Text",e.HeaderId="Header",e.SubHeaderId="SubHeader",e.SectionId="Section",e.SubSectionId="SubSection",e.ImageId="Image",e.StatusUpdateId="Tweet",e.VideoId="Video",e.GroupId="Group",e.DocumentId="Document",e.ImportingDocumentId="ImportingDocument",e.EmbedId="Embed",e.StackId="Stack",e.ComparisonId="Comparison",e.GalleryId="Gallery",e.UniformGridId="UniformGrid",e.CodeId="Code",e.ChartId="Chart",e.AudioId="Audio",e.PowerBiId="PowerBi",e.SharePointId="SharePoint",e.SwayId="Sway",e.SketchfabId="Sketchfab",e.VimeoId="Vimeo",e.TwitterId="Twitter",e.TableId="Table",e}();e.ManualCardType=t}(e.AuthoringModel||(e.AuthoringModel={}))}(e.Model||(e.Model={}))}(StoryAppEdit||(StoryAppEdit={}));